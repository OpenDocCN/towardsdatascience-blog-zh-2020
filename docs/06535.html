<html>
<head>
<title>How to create Voronoi regions with Geospatial data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中使用地理空间数据创建Voronoi区域</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-voronoi-regions-with-geospatial-data-in-python-adbb6c5f2134?source=collection_archive---------7-----------------------#2020-05-24">https://towardsdatascience.com/how-to-create-voronoi-regions-with-geospatial-data-in-python-adbb6c5f2134?source=collection_archive---------7-----------------------#2020-05-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9c1b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">地理数据科学</h2><div class=""/><div class=""><h2 id="e901" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在Python中创建和绘制Voronoi图的逐步指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/566fe798a1ffa4889dd42a4126e23a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*38hPxtPELDZKks0U"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">安迪·福尔摩斯在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3db9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设你打算步行去车站取一辆小型摩托车。附近有很多车站。你应该去哪家取滑板车骑？</p><p id="5ada" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最近的车站，对！</p><p id="2ae5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是，你怎么知道离你家最近的车站呢？</p><p id="2132" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输入Voronoi图。</p><blockquote class="me mf mg"><p id="ed84" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">Voronoi图是多边形的集合，所有点都在最接近单个对象的平面上。</p></blockquote><p id="34b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">换句话说，每个多边形分区都与一个对象相关联，并且包含与该对象最近的所有点。</p><h2 id="53ce" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">应用程序</h2><p id="0486" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">Voronoi图的应用很多，通常包括确定哪个特征最接近任何给定点。例如，确定在邻近区域的给定点上哪所学校最近。或者哪个手机发射塔离我手机最近才能打电话。</p><p id="11e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">据说，1854年约翰·斯诺绘制的霍乱爆发图在五天内导致500人死亡，该图在一张图表上绘制了水泵数据，并有效地构建了伦敦内部街区的Voronoi图。</p><p id="92f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们不能在这里列出Voronoi图所有可能的用例。尽管如此，它的应用是深远的，包括人类学和考古学，统计学和数据分析，市场营销和气象学。<a class="ae lh" href="https://www.ics.uci.edu/~eppstein/gina/scot.drysdale.html" rel="noopener ugc nofollow" target="_blank">这里有一长串它的应用</a>。</p><h2 id="e21f" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">用Python创建Voronoi区域</h2><p id="c4ea" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">在本教程中，我们使用幼儿园数据集创建一个Voronoi图。该数据集包含瑞典乌普萨拉县的所有幼儿园。为了创建Voronoi图，我们将使用几个库，包括<a class="ae lh" href="https://geopandas.org/" rel="noopener ugc nofollow" target="_blank"> Geopandas </a>和<a class="ae lh" href="https://github.com/WZBSocialScienceCenter/geovoronoi" rel="noopener ugc nofollow" target="_blank"> Geovoronoi </a>。</p><p id="e3bc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们先导入库并读取数据。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="296b" class="ml mm it nj b gy nn no l np nq">import numpy as np<br/>import geopandas as gpd<br/>import contextily as ctx<br/>import matplotlib.pyplot as plt</span><span id="645e" class="ml mm it nj b gy nr no l np nq">from shapely.ops import cascaded_union</span><span id="c4de" class="ml mm it nj b gy nr no l np nq">from geovoronoi.plotting import subplot_for_map, plot_voronoi_polys_with_points_in_area<br/>from geovoronoi import voronoi_regions_from_coords, points_to_coords</span><span id="4c6d" class="ml mm it nj b gy nr no l np nq">gdf = gpd.read_file("data/preschools.shp")<br/>gdf.head()</span></pre><p id="9f3d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如数据的前几行所示，我们有一个几何列，其中包含点和一些其他属性，如县、邮政地址等..</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ns"><img src="../Images/c086fae0b02c29b99d097572f120a429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cVdKScRDwlXc23V0HAdMg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">学前教育数据</p></figure><p id="2aed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以绘制点数据。为了给出一些背景，我们还读取了县的边界，并在其上绘制了点。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="f962" class="ml mm it nj b gy nn no l np nq">boundary = gpd.read_file(“data/uppsala.shp”)</span><span id="c38a" class="ml mm it nj b gy nr no l np nq">fig, ax = plt.subplots(figsize=(12, 10))<br/>boundary.plot(ax=ax, color=”gray”)<br/>gdf.plot(ax=ax, markersize=3.5, color=”black”)<br/>ax.axis(“off”)<br/>plt.axis(‘equal’)<br/>plt.show()</span></pre><p id="0d83" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输出是显示瑞典乌普萨拉县所有幼儿园(黑点)的地图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/9f9fee36d6e73b7fab92deb05b5f1f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*_KoWDwVQkxv68_jPw9BICQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">乌普萨拉的幼儿园</p></figure><p id="56df" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们计算Voronoi区域之前，我们需要确定两件事。首先，我们需要检查数据的投影，然后将其转换为Web墨卡托投影(epsg=339599。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="13dc" class="ml mm it nj b gy nn no l np nq">boundary = boundary.to_crs(epsg=3395)<br/>gdf_proj = gdf.to_crs(boundary.crs)</span></pre><p id="d2b0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，我们需要将数据准备成Geovoronoi库可以使用的格式。这里，我们将边界几何转换为多边形的并集。我们还将Geopandas点对象的地理序列转换为NumPy坐标数组。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="7218" class="ml mm it nj b gy nn no l np nq">boundary_shape = cascaded_union(boundary.geometry)</span><span id="67be" class="ml mm it nj b gy nr no l np nq">coords = points_to_coords(gdf_proj.geometry)</span></pre><p id="67f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">计算Voronoi区域</strong></p><p id="0b95" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们已经准备好了数据，我们可以简单地使用Geovoronoi的方法<strong class="lk jd"> voronoi_regions_from_coords()来计算Voronoi区域。</strong></p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="b3f2" class="ml mm it nj b gy nn no l np nq"># Calculate Voronoi Regions<br/>poly_shapes, pts, poly_to_pt_assignments = voronoi_regions_from_coords(coords, boundary_shape)</span></pre><p id="e2c8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输出包含形状、点以及两者之间的标识链接。</p><p id="6109" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">绘制Voronoi图</strong></p><p id="64bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了绘制Voronoi图，我们还使用了geo Voronoi—<strong class="lk jd">plot _ Voronoi _ polys _ with _ points _ in _ area()的功能。</strong>这里，我们提供了上述Voronoi计算的所有输出和边界形状。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="2169" class="ml mm it nj b gy nn no l np nq">fig, ax = subplot_for_map()</span><span id="1c3d" class="ml mm it nj b gy nr no l np nq">plot_voronoi_polys_with_points_in_area(ax, boundary_shape, poly_shapes, pts, poly_to_pt_assignments)</span><span id="48a8" class="ml mm it nj b gy nr no l np nq">ax.set_title('Voronoi regions of Schools in Uppsala')</span><span id="5241" class="ml mm it nj b gy nr no l np nq">plt.tight_layout()<br/>plt.show()</span></pre><p id="8579" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输出是一个Voronoi图，它将学校点划分为离每个位置最近的区域。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/84ce3cecd322d0049a341ecdeb2d0fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*7lpOhlpYsO1-YplaUwJY8A.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Voronoi图</p></figure><p id="91b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的地图很小，但好处是我们可以使用熟悉的Matplotlib接口来调整它。让我们先看看plot _ Voronoi _ polys _ with _ points _ in _ area()函数的参数和文档。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="9b03" class="ml mm it nj b gy nn no l np nq">plot_voronoi_polys_with_points_in_area<strong class="nj jd">(<br/></strong>    ax<strong class="nj jd">,<br/></strong>    area_shape<strong class="nj jd">,<br/></strong>    poly_shapes<strong class="nj jd">,<br/></strong>    points<strong class="nj jd">,<br/></strong>    poly_to_pt_assignments<strong class="nj jd">=None,<br/></strong>    area_color<strong class="nj jd">='white',<br/></strong>    area_edgecolor<strong class="nj jd">='black',<br/></strong>    voronoi_and_points_cmap<strong class="nj jd">='tab20',<br/></strong>    voronoi_color<strong class="nj jd">=None,<br/></strong>    voronoi_edgecolor<strong class="nj jd">=None,<br/></strong>    points_color<strong class="nj jd">=None,<br/></strong>    points_markersize<strong class="nj jd">=5,<br/></strong>    points_marker<strong class="nj jd">='o',<br/></strong>    voronoi_labels<strong class="nj jd">=None,<br/></strong>    voronoi_label_fontsize<strong class="nj jd">=10,<br/></strong>    voronoi_label_color<strong class="nj jd">=None,<br/></strong>    point_labels<strong class="nj jd">=None,<br/></strong>    point_label_fontsize<strong class="nj jd">=7,<br/></strong>    point_label_color<strong class="nj jd">=None,<br/></strong>    plot_area_opts<strong class="nj jd">=None,<br/></strong>    plot_voronoi_opts<strong class="nj jd">=None,<br/></strong>    plot_points_opts<strong class="nj jd">=None,<br/>)</strong><br/><strong class="nj jd">Docstring:</strong><br/>All-in-one function to plot Voronoi region polygons `poly_shapes` and the respective points `points` inside a<br/>geographic area `area_shape` on a matplotlib Axes object `ax`. By default, the regions will be blue and the points<br/>black. Optionally pass `poly_to_pt_assignments` to show Voronoi regions and their respective points with the same<br/>color (which is randomly drawn from color map `voronoi_and_points_cmap`). Labels for Voronoi regions can be passed<br/>as `voronoi_labels`. Labels for points can be passed as `point_labels`. Use style options to customize the plot.<br/>Pass additional (matplotlib) parameters to the individual plotting steps as `plot_area_opts`, `plot_voronoi_opts` or<br/>`plot_points_opts` respectively.</span></pre><p id="11de" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，我们可以使用许多参数来格式化可视化。文档也非常清晰和有用。</p><p id="a1dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以增加点的图形大小和标记大小。我们也可以使用Matplotlib Colormap改变颜色。这只是一种方式，还有其他方式可以调整，我留给你。</p><pre class="ks kt ku kv gt ni nj nk nl aw nm bi"><span id="a6f1" class="ml mm it nj b gy nn no l np nq">fig, ax = plt.subplots(figsize=(14,12))</span><span id="06c1" class="ml mm it nj b gy nr no l np nq">plot_voronoi_polys_with_points_in_area(ax, boundary_shape, poly_shapes, pts, poly_to_pt_assignments,<br/> voronoi_and_points_cmap=’tab20c’,<br/> points_markersize=20)</span><span id="5741" class="ml mm it nj b gy nr no l np nq">ax.set_title(‘Upssalla Preschools — Voronoi Regions’)<br/>ax.axis(“off”)<br/>plt.tight_layout()<br/>plt.show()</span></pre><p id="fbff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在的输出贴图与之前的默认贴图相比要好得多。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nv"><img src="../Images/a83308b4a01fadc98e444a79261aed66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CEeR04SIZ5UL-4Ev-C6jLg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">沃罗诺伊——乌普萨拉幼儿园</p></figure><h2 id="8c69" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">结论</h2><p id="0bab" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">Voronoi图是有用的，并且在许多地理应用中广泛使用。在本教程中，我们已经介绍了如何使用Python创建Voronoi图。</p><p id="f98e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文的代码和数据可以在这个Github存储库中找到。</p><div class="nw nx gp gr ny nz"><a href="https://github.com/shakasom/voronoi" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jd gy z fp oe fr fs of fu fw jc bi translated">shakasom/voronoi</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">用Python制作Voronoi图。在GitHub上创建一个帐户，为shakasom/voronoi的发展做出贡献。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on lb nz"/></div></div></a></div></div></div>    
</body>
</html>