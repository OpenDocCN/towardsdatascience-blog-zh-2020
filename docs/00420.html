<html>
<head>
<title>Build a Motion Heatmap Video Using OpenCV With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 OpenCV 和 Python 构建运动热图视频</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-motion-heatmap-videousing-opencv-with-python-fd806e8a2340?source=collection_archive---------6-----------------------#2020-01-13">https://towardsdatascience.com/build-a-motion-heatmap-videousing-opencv-with-python-fd806e8a2340?source=collection_archive---------6-----------------------#2020-01-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d7be" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">OpenCV 是一个强大的图像和视频操作库，在这个故事中，我想创建一个运动热图，用于检测运动，物体或人的流动方向，例如，在投影公共区域时为建筑师提供帮助。</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kp"><img src="../Images/d7594907a8884e9843a2a468fe7ab2e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rhb23-T0EAKWbCEGNUWmjw.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">本指南中描述的最终结果的屏幕截图。</p></figure><h1 id="e2cd" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">简介:</h1><p id="cd52" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">OpenCV，或(<em class="mo">开源计算机视觉</em>)是英特尔在 1999 年开发的主要针对计算机视觉和实时视频操作的库，它是用 C++编写的，但它支持不同的语言，其中包括 Python。</p><h1 id="dcac" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">工作流程:</h1><p id="fd46" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">这个程序是基于一种被称为高斯背景减法的技术。这种技术广泛用于用稳定的摄像机检测运动物体。</p><p id="0fd4" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">背景减法创建一个表示帧背景(图像的静态部分)的遮罩，并且对于每一帧，它减去前一帧。</p><p id="6ec6" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">让我们对该算法如何工作的两个主要步骤有一个简单的概述:</p><ul class=""><li id="e5d1" class="mu mv it lu b lv mp ly mq mb mw mf mx mj my mn mz na nb nc bi translated">背景初始化:在这个第一步中，通过<em class="mo">冻结</em>第一帧来计算背景的模型。</li><li id="1819" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated">更新:在该第二步骤中，从前一帧中减去下一帧，因此，如果在两帧之间发生了变化(运动),则帧的差异将反映该变化，这可以通过应用过滤器来实现。</li></ul><p id="1ee8" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">以下是应用于从城市摄像机录制的短视频的背景遮罩示例:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kp"><img src="../Images/91e8d625c33266b395a82281762f8257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRqHSbeUf0l21dIFl-f-cw.jpeg"/></div></div></figure><h1 id="b41c" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">代码:</h1><p id="5666" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">对于整个项目库，请在此处勾选<a class="ae ni" href="https://github.com/robertosannazzaro/motion-heatmap-opencv/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"><strong class="lu iu"/></a><strong class="lu iu">。</strong></p><p id="576b" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">代码从读取输入视频文件开始，并初始化一些需要的变量:</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="7194" class="no lb it nk b gy np nq l nr ns">capture = cv2.VideoCapture('input.mp4')</span><span id="8b5a" class="no lb it nk b gy nt nq l nr ns">background_subtractor = cv2.bgsegm.createBackgroundSubtractorMOG()<br/>length = int(capture.get(cv2.CAP_PROP_FRAME_COUNT))</span></pre><p id="3fbf" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">然后，<code class="fe nu nv nw nk b">for</code>循环开始遍历帧:</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="5b0b" class="no lb it nk b gy np nq l nr ns">for i in range(0, length):<br/><br/>    ret, frame = capture.read()<br/><br/>    # If first frame<br/>    if first_iteration_indicator == 1:<br/><br/>        first_frame = copy.deepcopy(frame)<br/>        height, width = frame.shape[:2]<br/>        accum_image = np.zeros((height, width), np.uint8)</span></pre><p id="5321" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">第一个<code class="fe nu nv nw nk b">if</code>块检查该帧是否是视频的第一帧，这样做是为了初始化我们的背景，以便进行背景减法，然后用对应于该帧尺寸的尺寸初始化<code class="fe nu nv nw nk b">accum_image</code>阵列。</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="aae1" class="no lb it nk b gy np nq l nr ns">filter = background_subtractor.apply(frame)  # remove the background<br/><br/>threshold = 2<br/>maxValue = 2<br/>ret, th1 = cv2.threshold(filter, threshold, maxValue, cv2.THRESH_BINARY)<br/><br/>accum_image = cv2.add(accum_image, th1)<br/><br/>color_image_video = cv2.applyColorMap(accum_image, cv2.COLORMAP_HOT)</span></pre><p id="6b47" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">为了去除少量的运动，如风、小鸟飞翔或一些噪音，一个<code class="fe nu nv nw nk b">threshold</code>和<code class="fe nu nv nw nk b">maxValue</code>一起应用到遮罩上。</p><p id="1161" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">屏蔽的结果然后被添加到<code class="fe nu nv nw nk b">accum_image</code>阵列，该操作对每一帧执行。结果由<code class="fe nu nv nw nk b">accum_image</code>数组组成，用于存储视频中发生的每个动作。</p><p id="ad4d" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">此外，因此，在最后，当已经对每一帧完成了先前描述的操作时，色彩映射表被应用于遮罩，并且遮罩与当前帧合并。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nx"><img src="../Images/a3f0ad422d6f46c159e8cd52919ef8f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSW0pfpHZyuVOI5OYm6d1A.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">从上到下，从左到右:当前帧、当前最终帧、过滤后的当前帧、应用了从帧 0 开始的所有遮罩的帧。</p></figure><p id="c34c" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated">更进一步，可以制作一个视频，显示热图逐帧淡入淡出。为了实现这一点，每一帧都被导出，并且再次使用<code class="fe nu nv nw nk b">cv2</code>，通过将所有帧合并在一起来生成视频:</p><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="d95f" class="no lb it nk b gy np nq l nr ns">video = cv2.VideoWriter('output.avi', fourcc, 30.0, (width, height))</span><span id="6eb3" class="no lb it nk b gy nt nq l nr ns">for image in images:<br/>    video.write(cv2.imread(os.path.join(image_folder, image)))<br/><br/>cv2.destroyAllWindows()</span></pre><p id="4e4b" class="pw-post-body-paragraph ls lt it lu b lv mp ju lx ly mq jx ma mb mr md me mf ms mh mi mj mt ml mm mn im bi translated"><strong class="lu iu">最终结果:</strong></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/488b3dce2c4b900bcfc3ab3983d88513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*-FVx0gvL0jQhCyl0R3QErg.gif"/></div></figure></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><pre class="ki kj kk kl gt nj nk nl nm aw nn bi"><span id="fd3f" class="no lb it nk b gy np nq l nr ns"><strong class="nk iu">I have a newsletter 📩.</strong></span><span id="9ae7" class="no lb it nk b gy nt nq l nr ns">Every week I’ll send you a brief findings of articles, links, tutorials, and cool things that caught my attention. If tis sounds cool to you subscribe.</span><span id="16f2" class="no lb it nk b gy nt nq l nr ns"><em class="mo">That means </em><strong class="nk iu"><em class="mo">a lot</em></strong><em class="mo"> for me.</em></span></pre><div class="og oh gp gr oi oj"><a href="https://relentless-creator-2481.ck.page/68d9def351" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">米尔斯形式</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">编辑描述</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">无情-创造者-2481.ck.page</p></div></div></div></a></div></div></div>    
</body>
</html>