<html>
<head>
<title>Understanding Face Detection with the Viola-Jones Object Detection Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Viola-Jones对象检测框架理解人脸检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-face-detection-with-the-viola-jones-object-detection-framework-c55cc2a9da14?source=collection_archive---------11-----------------------#2020-05-22">https://towardsdatascience.com/understanding-face-detection-with-the-viola-jones-object-detection-framework-c55cc2a9da14?source=collection_archive---------11-----------------------#2020-05-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2e3a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解最流行的人脸检测框架之一</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f8f8c81fb84e925b4e4854ed6e5c8c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jtqVyOFXPSkOlKcEabF7Nw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在我的毕业照中检测到面孔</p></figure><h1 id="849c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">一.动机</h1><p id="fc19" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">从Instagram滤镜到自动驾驶汽车，计算机视觉技术现在已经深深融入了许多人的生活方式。一个重要的计算机视觉应用是让计算机检测图像中的物体的能力。在这些对象中，人脸最受关注，因为它在安全和娱乐方面有许多有用的应用。因此，本文主要关注一个流行的人脸检测框架，称为Viola-Jones对象检测框架。</p><blockquote class="mm mn mo"><p id="d3af" class="lq lr mp ls b lt mq ju lv lw mr jx ly ms mt mb mc mu mv mf mg mw mx mj mk ml im bi translated">这里的目的是向您提供对框架的理解，以便您可以放心地使用OpenCV提供的开源实现。我想帮助您理解幕后发生的事情，并希望让您更加欣赏OpenCV这样的库为您处理所有的复杂性。如果你想要一个“从头开始”的实现，可以参考Anmol Parande的这个<a class="ae my" href="https://github.com/aparande/FaceDetection" rel="noopener ugc nofollow" target="_blank"> Python实现</a>。我也推荐你看看Ramsri关于这个话题的<a class="ae my" href="https://youtu.be/WfdYYNamHZ8" rel="noopener ugc nofollow" target="_blank">视频</a>。</p></blockquote><h1 id="e2f6" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">二。概念</h1><p id="b3c9" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">由Paul Viola和Michael Jones早在2001年开发的Viola-Jones对象检测框架可以快速准确地检测图像中的对象，并且特别适合人脸(Viola &amp; Jones，2001)。尽管年代久远，该框架仍然是人脸检测领域的领军人物，与其CNN的许多对应部分不相上下。Viola-Jones对象检测框架结合了<em class="mp">类Haar特征</em>、<em class="mp">积分图像</em>、<em class="mp">AdaBoost算法</em>和<em class="mp">级联分类器</em>的概念，创建了一个快速准确的对象检测系统。因此，为了理解框架，我们首先需要单独理解这些概念，然后弄清楚它们是如何连接在一起形成框架的。</p><blockquote class="mm mn mo"><p id="bdac" class="lq lr mp ls b lt mq ju lv lw mr jx ly ms mt mb mc mu mv mf mg mw mx mj mk ml im bi translated">如果您已经了解下面的概念，并且只是想知道这些概念是如何协同工作的，您可以跳到第三部分。</p></blockquote><h2 id="b92a" class="mz kz it bd la na nb dn le nc nd dp li lz ne nf lk md ng nh lm mh ni nj lo nk bi translated">类哈尔特征</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4e7dd3591c9b709e55e7298c64e40a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8KJBkCHHgw7EuLNXS8--Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:类哈尔特征(上)和如何计算它们(下)。</p></figure><p id="3e1f" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">通常在计算机视觉中，特征是从输入图像中提取的，而不是直接使用它们的强度(RGB值等)。类似哈尔的特征就是一个例子。其他例子包括<a class="ae my" href="https://en.wikipedia.org/wiki/Histogram_of_oriented_gradients" rel="noopener ugc nofollow" target="_blank">方向梯度直方图</a>(HOG)<a class="ae my" href="https://en.wikipedia.org/wiki/Local_binary_patterns" rel="noopener ugc nofollow" target="_blank"/>(LBP)等。类哈尔特征由暗区域和亮区域组成。它通过取亮区域的强度之和并减去暗区域的强度之和来产生单个值。有许多不同类型的Haar-like特征，但是Viola-Jones对象检测框架只使用图1中的那些。不同类型的Haar-like特征让我们从图像中提取有用的信息，例如边缘、直线和对角线，我们可以用它们来识别对象(即人脸)。</p><h2 id="aca5" class="mz kz it bd la na nb dn le nc nd dp li lz ne nf lk md ng nh lm mh ni nj lo nk bi translated">整体图像</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/ad6a174c17d1df450425fa0da030b29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhO9vGKpbx9p8x7uS49v-g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:原始图像到积分图像的转换(上)以及如何使用积分图像计算矩形区域(下)</p></figure><p id="9efe" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">积分图像是图像的中间表示，其中积分图像上的位置值(<em class="mp"> x </em>，y)等于原始图像上(<em class="mp"> x 【T7，<em class="mp"> y </em>)位置上方和左侧(包括两端)的像素之和(Viola &amp; Jones，2001)。这种中间表示是必不可少的，因为它允许快速计算矩形区域。为了说明，图3示出了红色区域D的总和可以在恒定时间内计算，而不是必须遍历该区域中的所有像素。由于提取Haar-like特征的过程包括计算暗/亮矩形区域的总和，积分图像的引入大大减少了完成这项任务所需的时间。</em></p><h2 id="181a" class="mz kz it bd la na nb dn le nc nd dp li lz ne nf lk md ng nh lm mh ni nj lo nk bi translated">AdaBoost算法</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/37409991cc88091dadd276a8e42e0cd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOnRFtHFo1wTwX1ykrB8MQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:使用AdaBoost算法的目的是从n个特征中提取最佳特征。注意:最佳特征也称为弱分类器。</p></figure><p id="f34b" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">AdaBoost(自适应增强)算法是一种机器学习算法，用于在所有可用特征中选择最佳特征子集。该算法的输出是一个分类器(也称为预测函数、假设函数)，称为<em class="mp">“强分类器”</em>。强分类器由<em class="mp">【弱分类器】</em>(最佳特征)的线性组合组成。从高层次来看，为了找到这些弱分类器，该算法运行<em class="mp"> T </em>次迭代，其中<em class="mp"> T </em>是要找到的弱分类器的数量，由您设置。在每次迭代中，该算法会找出所有特征的错误率，然后选择该次迭代中错误率最低的特征。</p><blockquote class="mm mn mo"><p id="b160" class="lq lr mp ls b lt mq ju lv lw mr jx ly ms mt mb mc mu mv mf mg mw mx mj mk ml im bi translated">你可以参考StatQuest的这个有趣的<a class="ae my" href="https://www.youtube.com/watch?v=LsK-xG1cLYA" rel="noopener ugc nofollow" target="_blank">视频</a>来更详细地了解AdaBoost算法</p></blockquote><h2 id="4bb0" class="mz kz it bd la na nb dn le nc nd dp li lz ne nf lk md ng nh lm mh ni nj lo nk bi translated">级联分类器</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/90a0099c9657c870aa0c41e51418d760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hxwci_y3MQE81lmr2No3Ag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:级联分类器</p></figure><p id="e0cb" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">级联分类器是一种多级分类器，可以快速准确地进行检测。每个阶段由AdaBoost算法产生的强分类器组成。从一个阶段到另一个阶段，强分类器中的弱分类器的数量增加。输入是按顺序(逐级)评估的。如果用于特定阶段的分类器输出否定结果，则输入被立即丢弃。如果输出为正，则输入被转发到下一级。根据Viola &amp; Jones (2001)，这种多阶段方法允许构建更简单的分类器，然后可以用于快速拒绝大多数负面(非面部)输入，同时在正面(面部)输入上花费更多时间。</p><h1 id="3de2" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">三。基于Viola-Jones目标检测框架的人脸检测</h1><p id="1c78" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在学习了Viola-Jones对象检测框架中使用的主要概念后，您现在可以学习这些概念是如何协同工作的了。该框架包括两个阶段:培训和测试/应用。让我们一个一个来看。</p><h2 id="fcff" class="mz kz it bd la na nb dn le nc nd dp li lz ne nf lk md ng nh lm mh ni nj lo nk bi translated">培养</h2><p id="e4fd" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这一阶段的目标是为一个人脸生成一个级联分类器，它能够准确地对人脸进行分类，并快速丢弃非人脸。为此，您必须首先准备好训练数据，然后通过对该训练数据使用改进的AdaBoost算法来构建级联分类器。</p><ol class=""><li id="1e1a" class="nm nn it ls b lt mq lw mr lz no md np mh nq ml nr ns nt nu bi translated"><strong class="ls iu">数据准备</strong></li></ol><blockquote class="mm mn mo"><p id="6ff5" class="lq lr mp ls b lt mq ju lv lw mr jx ly ms mt mb mc mu mv mf mg mw mx mj mk ml im bi translated">概念:积分图像+类哈尔特征</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/945d47229b0b281f3d175891eed563fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BzNzRF3LXI013QSKvcHofw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:数据准备过程</p></figure><p id="a9fb" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">假设你已经有了一个由正样本(人脸)和负样本(非人脸)组成的训练集，第一步就是从那些样本图像中提取特征。Viola &amp; Jones (2001)推荐图像为24 x 24。由于每种类型的Haar-like特征在24×24窗口中可以具有不同的大小和位置，因此可以提取超过160，000个Haar-like特征。尽管如此，在这个阶段，需要计算所有160，000+ Haar-like特征。幸运的是，积分图像的引入有助于加速这一过程。图5展示了数据准备的整个过程。</p><p id="8657" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated"><strong class="ls iu"> 2。用改进的AdaBoost算法构建级联分类器</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/a862cc3317fc36004923178d0304ae45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLtqds4oujBH4IjUgJ3e1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:构建级联分类器的过程</p></figure><blockquote class="mm mn mo"><p id="93dd" class="lq lr mp ls b lt mq ju lv lw mr jx ly ms mt mb mc mu mv mf mg mw mx mj mk ml im bi translated">概念:AdaBoost算法+级联分类器。</p></blockquote><p id="101e" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">可以想象，直接使用全部160，000+个特征，计算效率很低。Viola &amp; Jones (2001)提出了两种解决方案。首先，使用AdaBoost算法将特征数量减少到只有少数有用的特征。其次，将剩余的特性分成几个阶段，并以逐阶段(级联)的方式评估每个输入。Viola &amp; Jones (2001)设计了AdaBoost算法的修改版本，以便能够训练级联分类器。图6显示了Ramsri在其视频(Ramsri，2012)中提供的算法的简化版本。</p><blockquote class="mm mn mo"><p id="0f39" class="lq lr mp ls b lt mq ju lv lw mr jx ly ms mt mb mc mu mv mf mg mw mx mj mk ml im bi translated">在他们的论文中，Viola &amp; Jones (2001)提到他们的级联分类器有38个阶段(38个强分类器)，由超过6000个特征组成。</p></blockquote><p id="27dd" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated"><strong class="ls iu">测试/应用</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/5625be6d8568872f2a5a65034f50c9dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e1dpoI93l5nGbKklqHNjdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7:Viola-Jones对象检测框架中的滑动窗口检测过程</p></figure><p id="7931" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">想象一下，我们需要检测上图中的人脸。Viola &amp; Jones (2001)使用滑动窗口方法，其中不同比例的窗口在整个图像上滑动。比例因子和移动步长是供您决定的参数。所以对于上图，有<em class="mp"> m </em>子窗口来评估。对于子窗口<em class="mp"> i </em>，框架将该子窗口的图像大小调整为24 x 24的基本大小(以匹配训练数据)，将其转换为完整的图像，并通过在训练阶段产生的级联分类器进行馈送。如果子窗口通过级联分类器中的所有阶段，则检测到人脸。</p><h1 id="c989" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">四。结论</h1><p id="cd5f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">总之，您已经了解了Viola-Jones对象检测框架及其在人脸检测中的应用。今天的许多技术都受益于保罗·维奥拉和迈克尔·琼斯的工作。通过理解框架如何工作，你可以自信地实现你自己的工作版本，或者使用OpenCV提供的开源实现。我希望我的解释能让你朝着那个方向前进，并促使你使用这个令人敬畏的框架创造出令人惊叹的技术。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="d3ec" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated"><em class="mp">喜欢这篇文章并想表达您的支持？关注我或者给我买咖啡</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="http://buymeacoffee.com/socretlee"><div class="gh gi oc"><img src="../Images/69716627feab2505c60838bbd29241a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gS6Sh6i8g535gOafY4Wl1w.png"/></div></a></figure><h1 id="54cc" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">参考</h1><p id="1c13" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">岑，K. (2016)。<em class="mp">Viola-Jones实时人脸检测器的研究</em>。检索自<a class="ae my" href="https://web.stanford.edu/class/cs231a/prev_projects_2016/cs231a_final_report.pdf" rel="noopener ugc nofollow" target="_blank">https://web . Stanford . edu/class/cs 231 a/prev _ projects _ 2016/cs 231 a _ final _ report . pdf</a></p><p id="805e" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">h .詹森(2008年)。<em class="mp">实现Viola-Jones人脸检测算法</em>。DTU丹麦技术大学博士论文。检索自<a class="ae my" href="https://pdfs.semanticscholar.org/40b1/0e330a5511a6a45f42c8b86da222504c717f.pdf" rel="noopener ugc nofollow" target="_blank">https://pdfs . semantic scholar . org/40 B1/0e 330 a 5511 a 6a 45 f 42 c8 b 86 da 222504 c 717 f . pdf</a></p><p id="f97b" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">Mordvintsev和k . Abid(2013年)。基于哈尔级联的人脸检测。<em class="mp"> OpenCV-Python教程</em>。检索自<a class="ae my" href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_objdetect/py_face_detection/py_face_detection.html" rel="noopener ugc nofollow" target="_blank">https://opencv-python-tutro als . readthedocs . io/en/latest/py _ tutorials/py _ obj detect/py _ face _ detection/py _ face _ detection . html</a></p><p id="de90" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">帕帕乔治欧，C. P .，柳文欢，m .，&amp;波焦，T. (1998)。一个通用的目标检测框架。<em class="mp">第六届国际计算机视觉会议。</em>555–562。doi:101109/iccv . 1998.710772</p><p id="e864" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">拉姆斯瑞。(2012年9月16日)。<em class="mp"> Viola Jones人脸检测与跟踪讲解</em>。从https://youtu.be/WfdYYNamHZ8<a class="ae my" href="https://youtu.be/WfdYYNamHZ8" rel="noopener ugc nofollow" target="_blank">取回</a></p><p id="177c" class="pw-post-body-paragraph lq lr it ls b lt mq ju lv lw mr jx ly lz mt mb mc md mv mf mg mh mx mj mk ml im bi translated">维奥拉，p .和琼斯，M. (2001)。使用简单特征的增强级联的快速对象检测。<em class="mp">2001年IEEE计算机学会计算机视觉和模式识别会议论文集，1 </em>，I-511 — I-518。doi: 10.1109/CVPR</p></div></div>    
</body>
</html>