<html>
<head>
<title>Working with Amazon S3 buckets with Boto3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过 Boto3 使用亚马逊 S3 桶</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-with-amazon-s3-buckets-with-boto3-785252ea22e0?source=collection_archive---------7-----------------------#2020-07-13">https://towardsdatascience.com/working-with-amazon-s3-buckets-with-boto3-785252ea22e0?source=collection_archive---------7-----------------------#2020-07-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="054d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">完整的备忘单。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6600ad655167e15a8713ff8170bd32e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ZmBq26_1Ewir__cJLdC_A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@kingmaphotos?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杰夫·金玛</a>在<a class="ae ky" href="https://unsplash.com/s/photos/bucket?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="963d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">亚马逊简单存储服务(Amazon Simple Storage Service，简称 S3)通过微调访问控制提供了存储、保护和共享数据的空间。当使用 Python 时，人们可以通过 Boto3 包轻松地与 S3 进行交互。在这篇文章中，我将把我在使用 S3 时经常用到的 Python 命令汇总在一起。希望你会觉得有用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4fa79d8e1efffb34c1c49ca6a5ee5eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hnd_TV9wu8KY5sWnN_sTw.png"/></div></div></figure><p id="1c67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从关于 S3 数据结构的几句话开始。在你自己的电脑上，你将<strong class="lb iu">文件</strong>存储在<strong class="lb iu">文件夹</strong>中。在 S3，这些文件夹被称为<strong class="lb iu">桶</strong>。在桶里面，你可以存储<strong class="lb iu">对象</strong>，比如。csv 文件。您可以通过名称<strong class="lb iu">来引用存储桶，而通过关键字<strong class="lb iu">来引用对象。为了使代码块更易处理，我们将使用表情符号。以下是符号的关键:</strong></strong></p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="2a11" class="mb mc it lx b gy md me l mf mg">🗑 — a bucket’s name, e.g. “mybucket”</span><span id="622c" class="mb mc it lx b gy mh me l mf mg">🔑 — an object’s key, e.g. "myfile_s3_name.csv"</span><span id="dd6c" class="mb mc it lx b gy mh me l mf mg">📄 - a file's name on your computer, e.g. "myfile_local_name.csv"</span></pre><p id="bd96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🗑和🔑可以表示 S3 上已经存在的名称，也可以表示您希望为新创建的桶或对象指定的名称。📄表示您已经拥有或希望拥有在您的计算机本地某处的文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4fa79d8e1efffb34c1c49ca6a5ee5eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hnd_TV9wu8KY5sWnN_sTw.png"/></div></div></figure><h2 id="48bd" class="mb mc it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">设置客户端</h2><p id="3446" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要用 Boto3 访问任何 AWS 服务，我们必须用一个客户机连接到它。在这里，我们创建一个 S3 客户端。我们指定数据所在的区域。我们还必须传递访问密钥和密码，这可以在 AWS 控制台中生成，如这里的<a class="ae ky" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey" rel="noopener ugc nofollow" target="_blank">所述</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="9854" class="mb mc it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">存储桶:列出、创建和删除</h2><p id="5dbd" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要列出 S3 上现有的存储桶，删除一个或创建一个新的，我们只需分别使用<code class="fe ng nh ni lx b">list_buckets()</code>、<code class="fe ng nh ni lx b">create_bucket()</code>和<code class="fe ng nh ni lx b">delete_bucket()</code>函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="d46e" class="mb mc it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">对象:列表、下载、上传和删除</h2><p id="def3" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在一个桶中，存在对象。我们可以用<code class="fe ng nh ni lx b">list_objects()</code>把它们列出来。<code class="fe ng nh ni lx b">MaxKeys</code>参数设置列出的对象的最大数量；这就像在打印结果之前调用<code class="fe ng nh ni lx b">head()</code>一样。我们还可以使用<code class="fe ng nh ni lx b">Prefix</code>参数只列出键(名称)以特定前缀开头的对象。<br/>我们可以使用<code class="fe ng nh ni lx b">upload_file()</code>上传一个名为📄以这个名字去 S3🔑。同样，<code class="fe ng nh ni lx b">download_file()</code>会保存一个名为🔑在 S3 当地以这个名字📄。<br/>为了获得一些关于对象的元数据，比如创建或修改时间、权限或大小，我们可以调用<code class="fe ng nh ni lx b">head_object()</code>。<br/>删除一个对象的工作方式与删除一个桶相同:我们只需要将桶名和对象键传递给<code class="fe ng nh ni lx b">delete_object()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="bb53" class="mb mc it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">将多个文件加载到单个数据框中</h2><p id="0b70" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">通常，数据分布在几个文件中。例如，您可以将不同商店或地区的销售数据保存在具有匹配列名的不同 CSV 文件中。对于分析或建模，我们可能希望将所有这些数据放在一个 pandas 数据框中。下面的代码块就可以做到这一点:下载🗑境内名称以“some_prefix”开头的所有数据文件，并将其放入单个数据框中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="3165" class="mb mc it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">使用访问控制列表(ACL)将对象设为公共或私有</h2><p id="f426" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在 S3 上管理访问权限的一种方法是使用访问控制列表或 ACL。默认情况下，所有文件都是私有的，这是最好的(也是最安全的！)练习。您可以将文件指定为<code class="fe ng nh ni lx b">"public-read"</code>，在这种情况下，每个人都可以访问它，或者指定为<code class="fe ng nh ni lx b">"private"</code>，使您自己成为唯一授权的人。查看<a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl" rel="noopener ugc nofollow" target="_blank">此处</a>获取访问选项的详细列表。<br/>当文件已经在 S3 上时，你可以使用<code class="fe ng nh ni lx b">put_object_acl()</code>来设置它的 ACL，也可以在上传时通过将适当的<code class="fe ng nh ni lx b">ExtraArgs</code>传递给<code class="fe ng nh ni lx b">upload_file()</code>来设置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="2d71" class="mb mc it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">使用预签名的 URL 访问私有文件</h2><p id="da8c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您还可以通过使用<code class="fe ng nh ni lx b">generate_presigned_url()</code>函数生成一个临时的预签名 URL 来授予任何人对私有文件的短期访问权。这将产生一个字符串，可以直接插入到 pandas 的<code class="fe ng nh ni lx b">read_csv()</code>中，例如，下载数据。您可以通过<code class="fe ng nh ni lx b">ExpiresIn</code>参数指定该临时访问链接的有效时间。这里，我们创建一个有效期为 1 小时(3600 秒)的链接。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4fa79d8e1efffb34c1c49ca6a5ee5eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hnd_TV9wu8KY5sWnN_sTw.png"/></div></div></figure><p id="b259" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p><p id="38aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，为什么不在我的新文章上<a class="ae ky" href="https://michaloleszak.medium.com/subscribe" rel="noopener"> <strong class="lb iu">订阅电子邮件更新</strong> </a>？通过<a class="ae ky" href="https://michaloleszak.medium.com/membership" rel="noopener"> <strong class="lb iu">成为媒介会员</strong> </a>，你可以支持我的写作，并无限制地访问其他作者和我自己的所有故事。</p><p id="d2af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要咨询？你可以问我任何事情，也可以在这里 预定我 1:1 <a class="ae ky" href="http://hiretheauthor.com/michal" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">。</strong></a></p><p id="cbf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以试试<a class="ae ky" href="https://michaloleszak.github.io/blog/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">我的其他文章</strong> </a>中的一篇。不能选择？从这些中选择一个:</p><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/working-with-amazon-sns-with-boto3-7acb1347622d"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">通过 Boto3 使用 Amazon SNS</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">完整的备忘单。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/boost-your-grasp-on-boosting-acf239694b1"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">增强你对助推的把握</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">揭秘著名的竞赛获奖算法。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/a-comparison-of-shrinkage-and-selection-methods-for-linear-regression-ee4dd3a71f16"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">线性回归中收缩法和选择法的比较</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">详细介绍 7 种流行的收缩和选择方法。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="oc l nx ny nz nv oa ks nm"/></div></div></a></div></div></div>    
</body>
</html>