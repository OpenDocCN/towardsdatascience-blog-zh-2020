<html>
<head>
<title>Visualizing large datasets with H2O</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用H2O可视化大型数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-large-datasets-with-h2o-ffe9af40371b?source=collection_archive---------26-----------------------#2020-11-12">https://towardsdatascience.com/visualizing-large-datasets-with-h2o-ffe9af40371b?source=collection_archive---------26-----------------------#2020-11-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d17" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用H2O聚合器函数有效地减少数据量。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2d7aaf2351a2453e5290289d19d5e8cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nhKBE9w0LeSrgf7q"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">梅尔·普尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f8a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">探索性数据分析是任何数据处理管道的基本部分之一。然而，当数据量很大时，这些可视化就变得模糊了。如果我们要绘制数百万个数据点，就不可能区分各个数据点。在这种情况下，可视化的输出看起来很舒服，但是对分析人员来说没有统计上的好处。研究人员设计了几种方法来驯服海量数据集，以便更好地进行分析。这篇短文将着眼于<strong class="lb iu"> H2O图书馆</strong>如何聚集大规模数据集，然后可以轻松地可视化。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4338" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目标</h1><p id="f70c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.h2o.ai/products/h2o/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> H2O </strong> </a>是一个完全开源的、分布式内存机器学习平台，具有线性可扩展性。通过使用Python和R社区，H2O支持大多数领先的和广泛使用的机器学习算法。我们将使用一个公开可用的<a class="ae ky" href="https://s3.amazonaws.com/h2o-public-test-data/bigdata/laptop/airlines_all.05p.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">航空公司数据集</strong> </a> <strong class="lb iu"> </strong>来证明我们的观点。这是一个包含超过500万条记录的庞大数据集，非常适合这种情况。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e4fc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="6740" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在继续操作之前，请确保您的系统上安装了最新版本的H2O。我们将使用H2O 3.32——H2O的<a class="ae ky" href="https://www.h2o.ai/blog/h2o-release-3-32-zermelo/" rel="noopener ugc nofollow" target="_blank">最新版本</a>以<a class="ae ky" href="https://en.wikipedia.org/wiki/Ernst_Zermelo" rel="noopener ugc nofollow" target="_blank">恩斯特·策梅洛</a>命名。关于安装库的详细说明可以在文档的<a class="ae ky" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/downloading.html#downloading-installing-h2o" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">下载&amp;安装</strong> </a>部分找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="26c4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">可视化大数据</h1><p id="2593" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在让我们看看如何利用H2O来可视化一个大型数据集。</p><h2 id="f66b" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">1️⃣.初始化H2O集群</h2><p id="60b8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">H2O有一个R和Python接口以及一个名为Flow的web GUI。然而，在本文中，我们将使用H2O的Python接口。每个新会话都从初始化python客户端和H2O集群之间的连接开始。</p><blockquote class="nl nm nn"><p id="a1a1" class="kz la no lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">一个<a class="ae ky" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/glossary.html" rel="noopener ugc nofollow" target="_blank">集群</a>是一组协同工作的H2O节点；当作业提交到集群时，集群中的所有节点都处理作业的一部分。</p></blockquote><p id="3388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检查是否一切就绪，请打开Jupyter笔记本，键入以下内容:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="aedd" class="mz md it nt b gy nx ny l nz oa">% matplotlib inline<br/>import matplotlib.pyplot as plt<br/>plt.style.use('fivethirtyeight')</span><span id="a088" class="mz md it nt b gy ob ny l nz oa">import h2o<br/>h2o.init()</span></pre><p id="9cb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个本地的H2O集群。在执行单元时，一些信息将以表格形式打印在屏幕上，显示节点数量、总内存、Python版本等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/fea6c12cc6dc51b86932bb8188a2ff82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/0*YAdg8UvIMgfLbKal.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户运行H2O . init()(Python中)| Image</p></figure><h2 id="ab68" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">2️⃣.第一次看数据👀</h2><p id="a511" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">接下来，我们将导入航空公司数据集并进行快速浏览。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="2590" class="mz md it nt b gy nx ny l nz oa">path = "https://s3.amazonaws.com/h2o-public-test-data/bigdata/laptop/airlines_all.05p.csv"</span><span id="78e5" class="mz md it nt b gy ob ny l nz oa"> airlines = h2o.import_file(path=path)</span></pre><ul class=""><li id="e8b2" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated">让我们检查数据集的前十行。</li></ul><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="230f" class="mz md it nt b gy nx ny l nz oa">airlines.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/6252ccc9760a98f03ec4f5f09e6ff304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d3hkozeN8c4UhnsU37l23Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按作者排列的数据帧|图像的前十行</p></figure><p id="d0aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们上面所说的叫做H2O框架。类似于<code class="fe on oo op nt b">Pandas’ dataframe </code>或者<code class="fe on oo op nt b">R’s data.frame</code>。一个关键的区别是<br/>数据通常不保存在内存中。相反，它位于一个(可能是远程的)H2O集群上，因此H2OFrame仅仅代表该数据的一个句柄。</p><p id="b3c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用如下所示的<code class="fe on oo op nt b">.describe()</code>命令查看数据集的快速统计摘要</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="a7e7" class="mz md it nt b gy nx ny l nz oa">airlines.describe</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/b47af2c88b38dbcfed5382bf24c0174f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*bl93JK5tMbTrzkOz13WATQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按作者统计的数据帧|图像摘要</p></figure><h2 id="2999" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">3️⃣.可视化数据</h2><p id="ad9d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据集大约有500万行和31列。现在让我们快速绘制一个<code class="fe on oo op nt b">Year</code>列的直方图，看看数据中是否有某种模式。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="b0c4" class="mz md it nt b gy nx ny l nz oa">%matplotlib inline<br/>airlines["Year"].hist()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/4e00e1b48a542d39c19da1788bd589c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*th4kcsLGrOD41FHhpy7lgA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">航班频率|作者图片</p></figure><p id="adf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，直方图显示我们没有某些年份的数据。这就是EDA带给分析的力量。它有助于快速查明数据集中的异常，如缺失值、异常值等。</p><p id="baa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们画出<code class="fe on oo op nt b">Departure</code>和<code class="fe on oo op nt b">Arrival time</code>的对比图，看看两者之间是否有关系。这次我们将绘制一个<strong class="lb iu">散点图</strong>，这样我们就可以看到各个点。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="0fca" class="mz md it nt b gy nx ny l nz oa"># Convert H2O Frame into Pandas dataframe for plotting with matplotlib</span><span id="3a68" class="mz md it nt b gy ob ny l nz oa">airlines_pd = airlines.as_data_frame(use_pandas = True)</span><span id="7f6d" class="mz md it nt b gy ob ny l nz oa">plt.scatter(airlines_pd.DepTime, airlines_pd.ArrTime)<br/>plt.xlabel("Departure Time")<br/>plt.ylabel("Arrival Time")<br/></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/c8615b5ac2dbee99d115c76ae230453d.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*EOnC57WwnfPhaFWOEewTxw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe on oo op nt b">Scatterplot of Departure</code>对<code class="fe on oo op nt b">Arrival time | Image by Author</code></p></figure><p id="4259" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，我们确实得到了一个散点图，但是很难辨别出各个点。大量的重叠点使得很难看出数据中的总体趋势。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="96fe" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">H2O 3号的聚合器救援方法</h1><p id="69fe" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">仅仅查看整个数据没有多大意义。相反，我们可以研究一部分数据，只要它反映了整个数据集的属性。这就是<a class="ae ky" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/aggregator.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> H2O-3的聚合器</strong> </a>方法的用武之地。H2O聚合器方法是一种基于聚类的方法，用于将数值/分类数据集缩减为行数较少的数据集。</p><blockquote class="nl nm nn"><p id="0bfc" class="kz la no lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">“聚合器方法的行为就像任何其他无监督模型一样。您可以忽略列，这些列将在距离计算时被删除。</p></blockquote><p id="ff90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">聚合的输出是一个新的聚合框架，可以在R和Python中访问。</p><h2 id="9b15" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">为什么不能用随机抽样来代替？</h2><p id="4e25" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这种方法优于随机抽样，因为聚合器将保持数据的形状。随机抽样经常会导致异常值被意外删除。</p><h2 id="3ffa" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">使用H2O-3的聚合器减少数据量</h2><p id="ece7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在让我们将数据的大小减少到1000个数据点。我们将首先创建一个包含大约1000条记录的聚合框架，然后使用这个聚合框架创建一个新的数据框架。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="00b9" class="mz md it nt b gy nx ny l nz oa">from h2o.estimators.aggregator import H2OAggregatorEstimator</span><span id="83e3" class="mz md it nt b gy ob ny l nz oa"># Build an aggregated frame with around 1000 records<br/>agg_frame = H2OAggregatorEstimator(target_num_exemplars = 1000)<br/>agg_frame.train(training_frame=airlines)</span><span id="7600" class="mz md it nt b gy ob ny l nz oa"># Use the aggregated model to create a new dataframe using aggregated_frame<br/>small_airlines_data = agg_frame.aggregated_frame</span></pre><p id="9ed6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看新数据帧的尺寸</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="6bbc" class="mz md it nt b gy nx ny l nz oa">small_airlines_data.dim</span><span id="94f0" class="mz md it nt b gy ob ny l nz oa">[979, 32]</span></pre><p id="21ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，我们现在有大约1000个数据点，但是我们也有一个额外的列。如果您注意到，列数增加了一。让我们看看新数据帧的所有列。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="6d4e" class="mz md it nt b gy nx ny l nz oa">small_airlines.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/b00a0560c2276c393edbda7a54710b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gLdK86IJ0GAX-CIuSSbjyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者新创建的聚合数据帧|图像</p></figure><p id="aabb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，创建了一个新的<strong class="lb iu">计数</strong>列。<a class="ae ky" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/aggregator.html" rel="noopener ugc nofollow" target="_blank">聚合器将异常值保持为异常值，但是将密集的聚类聚集到样本中，并附带显示成员点的计数列。</a></p><h2 id="89f3" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">可视化简化的数据帧</h2><p id="9261" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在让我们想象一下新的数据帧。我们将创建与上面相同的散点图来比较两者。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="7a78" class="mz md it nt b gy nx ny l nz oa">small_airlines_pd = small_airlines.as_data_frame(use_pandas = True)<br/>plt.scatter(small_airlines_pd.DepTime, small_airlines_pd.ArrTime)<br/>plt.xlabel("DepTime")<br/>plt.ylabel("ArrTime")<br/></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/4da49121e5313bfdd2e01e1416590c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*KvauyBE4nBoaOGWVHasF7A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe on oo op nt b">Scatterplot of Departure</code>对<code class="fe on oo op nt b">Arrival time — Reduced dataframe| Image by Author</code></p></figure><p id="ec44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如预期的那样，这一步花费的时间要少得多，而且输出的数据点清晰易辨。</p><h2 id="d3c6" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">正在关闭集群</h2><p id="74f6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">完成实验后，记得使用下面的命令关闭集群。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="2c1e" class="mz md it nt b gy nx ny l nz oa">h2o.cluster().shutdown()</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1b01" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="2698" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我们研究了一种使用H2O聚合器方法将数值/分类数据集缩减为行数更少的数据集的方法。在如上所述的情况下，我们需要可视化大数据集，这种用途是显而易见的。如果你有兴趣深入挖掘，论文— <a class="ae ky" href="https://www.cs.uic.edu/~wilkinson/Publications/outliers.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">威尔金森，利兰。“可视化离群值。”(2016)</strong></a>——一定会引起你的兴趣。本文提出了一种新的检测多维异常值的算法，将帮助您理解聚合器方法的功能。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6251" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">承认</h1><p id="6a56" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢H2O.ai的高级客户数据科学家<a class="ae ky" href="https://www.linkedin.com/in/megan-kurka-36336569/" rel="noopener ugc nofollow" target="_blank"> Megan Kurka </a>，为本文编写代码。代码已经与H2O 3库的其他实现一起公开发布。</p></div></div>    
</body>
</html>