<html>
<head>
<title>DevOps — Serverless OCR-NLP Pipeline using Amazon EKS, ECS and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DevOps —使用亚马逊EKS、ECS和Docker的无服务器OCR-NLP管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/devops-serverless-ocr-nlp-pipeline-using-amazon-eks-ecs-and-docker-9c439ebbce01?source=collection_archive---------41-----------------------#2020-10-07">https://towardsdatascience.com/devops-serverless-ocr-nlp-pipeline-using-amazon-eks-ecs-and-docker-9c439ebbce01?source=collection_archive---------41-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e247" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们如何使用由Docker和Kubernetes驱动的事件驱动微服务架构，自动扩展光学字符识别管道，每天将数千份PDF文档转换为文本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d27f6c369e114719a0c0b414d1f8db00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfFFZtaQCAjRIFPRakp4Gg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/mohamed_hassan-5229782/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4114070" rel="noopener ugc nofollow" target="_blank">穆罕默德·哈桑</a>拍摄，来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4114070" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a></p></figure><p id="85bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在最近的一个项目中，我们被要求创建一个能够将PDF文档转换为文本的管道。收到的PDF文档通常有100页，可以包含打字和手写文本。这些PDF文档由用户上传到SFTP。正常情况下，平均每小时会有30-40个文档，但在高峰时期会高达100个。由于他们的业务不断增长，客户表示每天需要<strong class="lb iu"> OCR </strong>多达一千份文档。这些文件然后被输入到一个NLP管道中做进一步的分析。</p><h2 id="be29" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">让我们做一个概念验证——我们的发现</h2><p id="f27e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">转换100页文档的时间— 10分钟</p><p id="588d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行OCR的Python进程消耗了大约6GB RAM和4个CPU。</p><blockquote class="mt"><p id="7861" class="mu mv it bd mw mx my mz na nb nc lu dk translated">我们需要找到一种渠道，不仅能满足我们的常规需求，还能在高峰期自动扩展。</p></blockquote><h2 id="c492" class="lv lw it bd lx ly nd dn ma mb ne dp md li nf mf mg lm ng mi mj lq nh ml mm mn bi translated">最终实施</h2><p id="6e7e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们决定使用事件驱动的微服务来构建一个无服务器管道。整个过程细分如下:</p><ul class=""><li id="c7e4" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">以PDF格式上传的文档—使用SFTP的AWS Transfer处理</li><li id="5449" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">当上传新的PDF文档时触发S3事件通知—触发Lambda函数</li><li id="19be" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">Lambda函数在Kinesis流中添加OCR事件</li><li id="db46" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">OCR微服务被触发-使用Tesseract库(每页一个)将PDF转换为文本。在MongoDB中将文本输出保存为JSON文档</li><li id="8d32" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">在Kinesis流中添加NLP事件</li><li id="0240" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">NLP微服务从MongoDB读取JSON。NLP的最终结果保存回MongoDB</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/f439fcd4e93a0f27bd27be7ce97c94ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytjlqudnZYy_XShqHuIkpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="2ea0" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">技术栈</h2><p id="7d20" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">数据接收— </strong> AWS SFTP服务</p><p id="0059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">微服务— </strong>存储在亚马逊弹性容器注册表(ECR)中的Docker图像</p><p id="5e5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">容器编排</strong>—EC2节点上的亚马逊弹性库本内特服务(亚马逊EKS)</p><p id="27a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">用于容器的无服务器计算引擎— </strong> AWS Fargate</p><p id="2316" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">基础设施供应— </strong>地形</p><p id="f415" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">消息传递— </strong>亚马逊Kinesis流</p><h2 id="3229" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">网络体系结构</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/fb5a19ff34ba5dc0020144c13447606e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g_-T7yHxaUpAV_y4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="3fec" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">聚类自动缩放</h2><p id="18f7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用水平和垂直缩放的组合来实现集群自动缩放，如下所示:</p><p id="26e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">垂直缩放—容器</strong></p><p id="2c68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据我们的计算，我们能够在给定的EC2节点上支持25个正在运行的容器。我们用3个副本容器(minReplicas=3)启动OCR微服务，并将最大值设置为25 (maxReplicas=25)。我们还设置targetAverageUtilization=15，这意味着如果容器CPU利用率超过15%，即容器正在处理一个文档，那么<strong class="lb iu">在给定的EKS节点上将一个新容器加速到最大值25。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/34a92cc687f99fb59d644b70296a5e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*Icfa2K5cJr7uYdyV"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bdc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">水平缩放— EKS节点</strong></p><p id="de97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果当前ELS节点已满<strong class="lb iu"/>，即25个并发运行的容器，则EKS会自动提供一个新的EKS节点。此后，垂直扩展接管新节点并旋转新容器。</p><p id="b397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这种方式，基础架构能够支持数百个OCR和NLP流程。高峰需求满足后，等待期开始。在等待期到期后，新部署的EKS节点和容器会缩减，以便达到最佳资源分配。</p><p id="f31e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章有助于启动您的DevOps知识。这些主题是由<a class="ae ky" href="http://www.datafence.com" rel="noopener ugc nofollow" target="_blank"> Datafence Cloud Academy </a>提供的DevOps课程的一部分。</p></div></div>    
</body>
</html>