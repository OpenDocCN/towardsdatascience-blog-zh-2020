<html>
<head>
<title>Image Processing using Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Streamlit进行图像处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/image-processing-using-streamlit-d650fb0ccf8?source=collection_archive---------16-----------------------#2020-11-01">https://towardsdatascience.com/image-processing-using-streamlit-d650fb0ccf8?source=collection_archive---------16-----------------------#2020-11-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8aa5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用OpenCV了解Streamlit</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/21b10e7eaabaec30f7a040245859025a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kXigF2ZIW5UR3t1s7cn6IA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fd3a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将了解如何将Streamlit与图像处理技术和对象检测算法结合使用。我假设您已经在系统上安装并运行了Streamlit。如果你不知道如何从streamlit开始，那么你可以参考我的<a class="ae lr" rel="noopener" target="_blank" href="/data-visualization-using-streamlit-151f4c85c79a">以前的文章</a>,在那里我简单地解释了一下。</p><p id="8a08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我还在streamlit共享上部署了这个Streamlit应用程序。在进一步阅读这篇文章之前，你可以先看一下。</p><p id="fe5c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是链接:<a class="ae lr" href="https://share.streamlit.io/aniketwattamwar/image-processing-with-streamlit/main/main.py" rel="noopener ugc nofollow" target="_blank">使用Streamlit的图像处理</a></p><p id="54da" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们深入研究代码。</p><p id="0e3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先导入必要的库</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="d256" class="lx ly iq lt b gy lz ma l mb mc">import streamlit as st<br/>from PIL import Image<br/>import cv2 <br/>import numpy as np</span></pre><p id="19d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经创建了main函数，这是代码的起点。在这个函数中，你会看到一个我创建的侧边栏。Streamlit为您提供了边栏选择框功能，可以轻松创建一个。在侧边栏中，我添加了一些值，每个值都与一个函数相关联。当用户点击它们中的任何一个时，相应的功能被触发。默认情况下，选择第一个值，即welcome字符串，if语句调用Welcome()函数。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="2cbd" class="lx ly iq lt b gy lz ma l mb mc">def main():</span><span id="886c" class="lx ly iq lt b gy md ma l mb mc">selected_box = st.sidebar.selectbox(<br/>    'Choose one of the following',<br/>    ('Welcome','Image Processing', 'Video', 'Face Detection', 'Feature Detection', 'Object Detection')<br/>    )<br/>    <br/>    if selected_box == 'Welcome':<br/>        welcome() <br/>    if selected_box == 'Image Processing':<br/>        photo()<br/>    if selected_box == 'Video':<br/>        video()<br/>    if selected_box == 'Face Detection':<br/>        face_detection()<br/>    if selected_box == 'Feature Detection':<br/>        feature_detection()<br/>    if selected_box == 'Object Detection':<br/>        object_detection()</span><span id="2bef" class="lx ly iq lt b gy md ma l mb mc">if __name__ == "__main__":<br/>    main()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi me"><img src="../Images/04fd64bbc11ce80850b99e9daba0a57b.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*WzAaQWxn_H6aGKUdqQjyew.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="96a8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下图显示了欢迎页面。让我们看看欢迎函数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/6d707bb6ce64a2bf70ce57675eed211f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7REgOkDHzuilc3JC8yHEQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="038d" class="lx ly iq lt b gy lz ma l mb mc">def welcome():<br/>    <br/>    st.title('Image Processing using Streamlit')<br/>    <br/>    st.subheader('A simple app that shows different image processing algorithms. You can choose the options'<br/>             + ' from the left. I have implemented only a few to show how it works on Streamlit. ' + <br/>             'You are free to add stuff to this app.')<br/>    <br/>    st.image('hackershrine.jpg',use_column_width=True)</span></pre><p id="9c9a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用st.title你可以创建一个粗体标题，用st.subheader你可以有一个较低字体大小的粗体。使用st.image，您可以在streamlit应用程序上显示任何图像。请确保将列宽设置为true，以使其合适。</p><p id="5d45" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们在侧边栏中有图像处理部分。在这里，我们将看到阈值，边缘检测和轮廓。为了方便用户，我使用了一个滑块来改变阈值。要制作一个交互式滑块，只需在streamlit中编写st.slider。在OpenCV的帮助下，我们正在进行RGB到灰度的转换，然后使用OpenCV中的阈值函数。我们在阈值函数中传递滑块的值。所以当我们移动滑块时，值会改变并存储在thresh1中。然后我们使用st.image来显示thresh1图像。确保将clamp设置为True。</p><p id="e56b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们有一个显示该图像的条形图。您可以使用streamlit中的条形图功能来完成此操作。传递的值是用cv2.calchist函数计算的。您可以使用不同的直方图和图来分析您的图像。</p><p id="dd4d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们有精明的边缘检测技术。我做了一个按钮，当用户点击它时，它运行算法并显示输出。您可以简单地通过编写st.button和if语句来创建一个按钮。如果你写了边缘检测代码。</p><p id="8db2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于轮廓，我再次使用滑块来改变图像，使轮廓发生变化。在OpenCV中，您可以在传递图像的地方找到轮廓和绘制轮廓。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ba70" class="lx ly iq lt b gy lz ma l mb mc">def photo():</span><span id="198a" class="lx ly iq lt b gy md ma l mb mc">st.header("Thresholding, Edge Detection and Contours")<br/>    <br/>    if st.button('See Original Image of Tom'):<br/>        <br/>        original = Image.open('tom.jpg')<br/>        st.image(original, use_column_width=True)<br/>        <br/>    image = cv2.imread('tom.jpg')<br/>    image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)<br/>    <br/>    x = st.slider('Change Threshold value',min_value = 50,max_value = 255)</span><span id="d81a" class="lx ly iq lt b gy md ma l mb mc">ret,thresh1 = cv2.threshold(image,x,255,cv2.THRESH_BINARY)<br/>    thresh1 = thresh1.astype(np.float64)<br/>    st.image(thresh1, use_column_width=True,clamp = True)<br/>    <br/>    st.text("Bar Chart of the image")<br/>    histr = cv2.calcHist([image],[0],None,[256],[0,256])<br/>    st.bar_chart(histr)<br/>    <br/>    st.text("Press the button below to view Canny Edge Detection Technique")<br/>    if st.button('Canny Edge Detector'):<br/>        image = load_image("jerry.jpg")<br/>        edges = cv2.Canny(image,50,300)<br/>        cv2.imwrite('edges.jpg',edges)<br/>        st.image(edges,use_column_width=True,clamp=True)<br/>      <br/>    y = st.slider('Change Value to increase or decrease contours',min_value = 50,max_value = 255)     <br/>    <br/>    if st.button('Contours'):<br/>        im = load_image("jerry1.jpg")<br/>          <br/>        imgray = cv2.cvtColor(im,cv2.COLOR_BGR2GRAY)<br/>        ret,thresh = cv2.threshold(imgray,y,255,0)<br/>        image, contours, hierarchy = cv2.findContours(thresh,cv2.RETR_TREE,cv2.CHAIN_APPROX_SIMPLE)<br/>        <br/>        img = cv2.drawContours(im, contours, -1, (0,255,0), 3)<br/> <br/>        <br/>        st.image(thresh, use_column_width=True, clamp = True)<br/>        st.image(img, use_column_width=True, clamp = True)</span></pre><p id="fef1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们接下来要看的是人脸检测。对于人脸检测，我使用的是哈尔级联文件。使用cascadeClassifier，我们将加载XML文件。我们有detectMultiScale函数，我们传递图像来寻找图像中的人脸。如果我们找到图像，然后在脸部周围画一个矩形。如果您希望保存图像，那么您可以使用写入功能。然后，我们使用Streamlit使用st.image显示图像。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="cc84" class="lx ly iq lt b gy lz ma l mb mc">def face_detection():<br/>    <br/>    st.header("Face Detection using haarcascade")<br/>    <br/>    if st.button('See Original Image'):<br/>        <br/>        original = Image.open('friends.jpeg')<br/>        st.image(original, use_column_width=True)<br/>    <br/>    <br/>    image2 = cv2.imread("friends.jpeg")</span><span id="a139" class="lx ly iq lt b gy md ma l mb mc">face_cascade = cv2.CascadeClassifier("haarcascade_frontalface_default.xml")<br/>    faces = face_cascade.detectMultiScale(image2)<br/>    print(f"{len(faces)} faces detected in the image.")<br/>    for x, y, width, height in faces:<br/>        cv2.rectangle(image2, (x, y), (x + width, y + height), color=(255, 0, 0), thickness=2)<br/>    <br/>    cv2.imwrite("faces.jpg", image2)<br/>    <br/>    st.image(image2, use_column_width=True,clamp = True)</span></pre><p id="6eea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我想展示的最后一部分是对象检测。我已经使用挂钟和眼哈尔级联文件做对象检测。与人脸检测类似，我们将加载XML文件并使用检测多尺度函数。如果找到了相应的对象，我们将在该对象周围绘制一个矩形。下图显示了输出。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="26be" class="lx ly iq lt b gy lz ma l mb mc">def object_detection():<br/>    <br/>    st.header('Object Detection')<br/>    st.subheader("Object Detection is done using different haarcascade files.")<br/>    img = load_image("clock.jpg")<br/>    img_gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY) <br/>    img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB) <br/>    <br/>    clock = cv2.CascadeClassifier('haarcascade_wallclock.xml')  <br/>    found = clock.detectMultiScale(img_gray,  <br/>                                   minSize =(20, 20)) <br/>    amount_found = len(found)<br/>    st.text("Detecting a clock from an image")<br/>    if amount_found != 0:  <br/>        for (x, y, width, height) in found:<br/>     <br/>            cv2.rectangle(img_rgb, (x, y),  <br/>                          (x + height, y + width),  <br/>                          (0, 255, 0), 5) <br/>    st.image(img_rgb, use_column_width=True,clamp = True)<br/>    <br/>    <br/>    st.text("Detecting eyes from an image")<br/>    <br/>    image = load_image("eyes.jpg")<br/>    img_gray_ = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) <br/>    img_rgb_ = cv2.cvtColor(image, cv2.COLOR_BGR2RGB) <br/>        <br/>    eye = cv2.CascadeClassifier('haarcascade_eye.xml')  <br/>    found = eye.detectMultiScale(img_gray_,  <br/>                                       minSize =(20, 20)) <br/>    amount_found_ = len(found)<br/>        <br/>    if amount_found_ != 0:  <br/>        for (x, y, width, height) in found:<br/>         <br/>            cv2.rectangle(img_rgb_, (x, y),  <br/>                              (x + height, y + width),  <br/>                              (0, 255, 0), 5) <br/>        st.image(img_rgb_, use_column_width=True,clamp = True)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/c14035c585baa7dcc0580fe46135fd88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_mXkOGfs0I4jqNQCvyF6g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">检测挂钟|作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/bca1c11deaa11e3c89acbcf43343551c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDlg4s2krX9Xx3z-FlP4HA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">检测眼睛|作者图片</p></figure><p id="287c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在我的<a class="ae lr" href="https://github.com/aniketwattamwar/Image-Processing-with-Streamlit" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到代码。我还为此制作了一个视频。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="a210" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于图像处理和机器学习的进一步阅读，可以参考这篇资料丰富的文章。</p><p id="f476" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://neptune.ai/blog/what-image-processing-techniques-are-actually-used-in-the-ml-industry" rel="noopener ugc nofollow" target="_blank">https://Neptune . ai/blog/what-image-processing-techniques-is-actual-used-in-the-ml-industry</a></p><p id="682a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">和平！</p></div></div>    
</body>
</html>