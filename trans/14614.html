<html>
<head>
<title>Introducing GraMi — a Data Migration Tool for Grakn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraMi简介Grakn的数据迁移工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-grami-a-data-migration-tool-for-grakn-d4051582f867?source=collection_archive---------41-----------------------#2020-10-08">https://towardsdatascience.com/introducing-grami-a-data-migration-tool-for-grakn-d4051582f867?source=collection_archive---------41-----------------------#2020-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a82d19c072282d3ed08827cc6bd2612c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vvbXAZLUaKIEl6rE"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">艾莉娜·格鲁布尼亚克在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><p id="4a67" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你和我一样，没多久你就会对<a class="ae jd" href="https://grakn.ai/" rel="noopener ugc nofollow" target="_blank"> Grakn </a>感到兴奋。如果你像我一样，最令人兴奋的部分是数据建模、规则推理及其查询和分析功能。</p><p id="14c8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在经历了如何迁移数据的官方示例之后，我确信只有几天时间可以远离所有的乐趣。然后，我花了几周时间构建了一个可靠且健壮的数据迁移器，它具有以下特性:</p><ul class=""><li id="148e" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">可扩展性和性能</li><li id="f2b3" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">基本数据清理</li><li id="1acc" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">数据有效性</li><li id="4204" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">记录</li><li id="31d0" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">故障恢复</li></ul><p id="45a9" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它叫做<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami" rel="noopener ugc nofollow" target="_blank"> GraMi </a> (Grakn Migrator)。如果你想，你也可以用它。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lw"><img src="../Images/823d70b1bc0831f0c2404b46c7d7d480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qp2kz056iVVqOL6MfJbMwg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami" rel="noopener ugc nofollow" target="_blank">在Github上找到GraMi</a></p></figure><h1 id="52ca" class="mb mc jg bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">格拉米是什么？</h1><p id="2622" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">GraMi从文件中流式传输表格数据，并生成有效的Graql insert查询，然后提交到您选择的Grakn服务器。更具体地说:</p><h2 id="029d" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated"><strong class="ak">数据输入:</strong></h2><ul class=""><li id="1ee4" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">数据从文件中流出，以保持低内存占用</li><li id="3028" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">支持任何表格数据文件(即:csv，。tsv，。*sv…)，是否压缩</li></ul><h2 id="d300" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated"><strong class="ak">实体和关系迁移:</strong></h2><ul class=""><li id="48b2" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">迁移Grakn中任何可用类型的必需/可选属性(字符串、布尔、长整型、双精度、日期时间)</li><li id="2f71" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">迁移必需/可选的角色扮演者</li><li id="127e" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">将类似列表的属性列作为n个属性迁移(Grakn推荐)</li></ul><h2 id="3665" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated"><strong class="ak">数据清理和验证:</strong></h2><ul class=""><li id="7295" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">基本数据清理(删除前导和尾随空格以及不一致的特殊字符)</li><li id="a5f8" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">在写入Grakn之前，验证基于每个数据行<strong class="kf jh">的插入查询</strong></li><li id="6ba3" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">记录所有无效数据记录，以便于分析(例如，缺少属性/球员或数据记录格式不正确)</li></ul><h2 id="b0c0" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated"><strong class="ak">表现:</strong></h2><ul class=""><li id="d078" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">在单线程和并行异步写入Grakn之间进行选择，以充分利用您的硬件配置</li></ul><h2 id="89f9" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated"><strong class="ak">故障恢复:</strong></h2><ul class=""><li id="20f2" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">跟踪迁移进度，允许停止/重启和(硬件)故障恢复</li></ul><h1 id="bcf7" class="mb mc jg bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">为什么是格兰米？</h1><h2 id="2fa9" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">数据输入:</h2><ul class=""><li id="4409" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">大多数数据将来自现有系统或结构化文件，并且大多数系统可以导出为表格格式</li><li id="546b" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">如果您有大量数据，您会希望以压缩格式存储</li></ul><h2 id="a3a8" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">实体和关系迁移:</h2><ul class=""><li id="ab24" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">模板逻辑是为大型数据集复制的多种形式，大型数据集具有许多实体和必需/可选属性/参与者的关系以及具有属性列表的列</li></ul><h2 id="184a" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">数据清理和验证:</h2><p id="4ac8" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">如果你对数据很认真，你会使用大量的数据，并且非常关心数据的质量。所以你可能想:</p><ul class=""><li id="7196" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">记录所有不符合模式和数据建模约束的行</li><li id="012e" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">防止对Grakn的无效/空写入，浪费时间和无意义的迁移</li></ul><h2 id="fa05" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">性能:</h2><ul class=""><li id="c94d" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">如果您有数百万条记录，就不能缓慢插入</li><li id="ee47" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">批处理和并行化代码并不简单，而且在Grakn Discord上经常被请求</li></ul><h2 id="d495" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">故障恢复:</h2><p id="f68c" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">在处理大量不同质量的数据时，硬件和软件最终会出现故障/变得不可用，因此您需要跟踪迁移进度，并能够从中断的地方重新开始。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="913b" class="mb mc jg bd md me nt mg mh mi nu mk ml mm nv mo mp mq nw ms mt mu nx mw mx my bi translated">它是如何工作的</h1><p id="e4b9" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">GraMi要求你指定一个<em class="ny">处理器配置</em>文件(<em class="ny">处理器配置</em>)和一个<em class="ny">数据配置</em>文件(<em class="ny">数据配置</em>)。<em class="ny">处理器配置</em>充当你的模式、它的实体、关系、属性、播放器、值类型以及<em class="ny">数据配置</em>之间的粘合剂。<em class="ny">数据配置</em>描述了数据是如何格式化的，以及哪些列包含哪些模式概念。</p><h2 id="2099" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">配置约定:</h2><ul class=""><li id="8453" class="lb lc jg kf b kg mz kk na ko nq ks nr kw ns la lg lh li lj bi translated">对于模式中指定的每个实体和关系，在<em class="ny">处理器配置</em>中必须至少有一个处理器(至少如果您希望GraMi插入它的话)</li><li id="03dc" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">每个数据文件只包含一个模式概念(即一个实体或关系以及它们相应的属性和参与者)</li><li id="f95f" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">每个数据文件必须包含具有唯一列名的标题行</li></ul><p id="ca47" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将构建你可以在github 上找到的<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example" rel="noopener ugc nofollow" target="_blank"> grami-example项目。这是对Grakn的电话呼叫示例的详细描述，扩展到显示GraMi此时的所有功能。</a></p><p id="1d80" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从这个例子中可以看出，下面是如何使用处理器和数据配置将数据映射到模式的概述:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nz"><img src="../Images/3bed4d64ca13ac1f32f925799583060b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pm514GG7a3XhFUOKIaexA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图1 —使用GraMi的处理器和数据配置将数据映射到模式。</p></figure><p id="ca8d" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从左到右(模式到数据):</p><ul class=""><li id="488d" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">给定一个模式概念(用黄色标记)，在本例中是实体<em class="ny"> person </em> …</li><li id="bc60" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf jh">处理器配置</strong>定义了一个名为<em class="ny">人</em>的<em class="ny">处理器</em>，它创建了schemaType <em class="ny">人</em>的<em class="ny">实体</em>的实例。对于<em class="ny"> person </em>的每个属性，我们指定属性的<em class="ny">值类型</em>以及是否<em class="ny">需要将记录插入到Grakn中(read中的<em class="ny"> first-name </em>，蓝色的<em class="ny"> nick-name </em>)。<strong class="kf jh">注意:</strong>关键属性应该始终是必需的；但是，对于所有其他记录，如果缺少某些属性，这将使您能够排除对您的域没有用处的记录。</em></li><li id="903a" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf jh">数据配置</strong>包含每个<em class="ny">数据文件</em>的一个条目。每个文件映射到<strong class="kf jh">处理器配置</strong>中的<em class="ny">处理器</em>(黄色框)，然后将数据文件中的每一列映射到所选<em class="ny">处理器</em>中的<em class="ny">属性生成器</em>。如果该列实际上是一个值列表(对于<em class="ny">昵称</em>，您可以指定<em class="ny">列表分隔字符</em>。</li></ul><h1 id="d3cd" class="mb mc jg bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">辅导的</h1><p id="d44c" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">让我们来看一下扩展电话呼叫的例子(完整的项目，包括模式、数据和配置可以在<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example" rel="noopener ugc nofollow" target="_blank">这里</a>找到)。</p><h2 id="7598" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">步骤1-实体的处理器配置</h2><p id="ab78" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">对于我们模式中的以下<em class="ny">人</em>实体(在这里找到完整模式<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example/blob/master/src/main/resources/schema.gql" rel="noopener ugc nofollow" target="_blank">):</a></p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e887" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对应的<em class="ny">处理器配置</em>条目将是:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><ol class=""><li id="3d1e" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la oc lh li lj bi translated">你的<em class="ny">处理者</em>的ID——这里是<em class="ny">人——</em>行2</li><li id="7844" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">创建一个<em class="ny">实体— </em>行3</li><li id="6c42" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">类型<em class="ny">人— </em>第4行</li><li id="5b1b" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">具有以下<em class="ny">属性:</em></li><li id="047a" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">您的<em class="ny">属性生成器的ID—这里的</em>是<em class="ny">名字</em>，w <em class="ny">是第7行</em></li><li id="3aac" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">创建<em class="ny">名字</em>属性—第8行</li><li id="eaf3" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated"><em class="ny">值类型的</em>字符串(其他可能是:long、double、boolean、datetime) —第9行</li><li id="beac" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">那是<em class="ny">不需要的— </em>第10行</li><li id="10bb" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">或者<em class="ny">必填</em>(在电话示例中，电话号码是必填的)—第16行</li></ol><p id="d333" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，在为关系定义处理器配置时，将会考虑到实体的“播放”定义。对于实体，只需指定属性生成器。</p><p id="d61f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对模式中的所有实体执行上述操作。点击查看电话示例<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example/blob/master/src/main/resources/processorConfig.json" rel="noopener ugc nofollow" target="_blank">的完整处理器配置。</a></p><h2 id="054d" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">步骤2—关系的处理器配置</h2><p id="790a" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">对于我们的<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example/blob/master/src/main/resources/schema.gql" rel="noopener ugc nofollow" target="_blank">模式</a>中的以下<em class="ny">调用</em>关系:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="796a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对应的<em class="ny">处理器配置</em>条目将是:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><ol class=""><li id="c633" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la oc lh li lj bi translated">你的<em class="ny">处理器</em>的ID——这里<em class="ny">调用——</em>行2</li><li id="f725" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">创建一个<em class="ny">关系— </em>行3</li><li id="2716" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">类型为<em class="ny">的调用— </em>第4行</li><li id="da55" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">与以下<em class="ny">玩家:</em> —第6行</li><li id="d73c" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">你的<em class="ny">玩家生成器的ID——此处</em>为<em class="ny">呼叫者</em>，w <em class="ny">为</em>第7行</li><li id="a5d5" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">匹配类型为<em class="ny"> person </em>的实体—第8行</li><li id="2632" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">使用属性<em class="ny">电话号码</em>识别<em class="ny">人</em> —第9行</li><li id="9813" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">属于<em class="ny">值类型</em>字符串—第10行</li><li id="e73f" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">插入<em class="ny">人</em>作为扮演<em class="ny">呼叫者</em>的角色—第11行</li><li id="08e4" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">对于每个<em class="ny">调用</em>记录-第12行，哪一个是<em class="ny">必需的</em>角色</li></ol><p id="3f6a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有关系及其参与者都是如此。如果一个关系有属性，如<em class="ny">调用</em>的情况，只需为每个属性添加属性生成器，如步骤1实体所述。</p><h2 id="3344" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">步骤3-实体的数据配置</h2><p id="41e9" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">我们现在将数据映射到刚刚创建的<em class="ny">处理器配置</em>。让我们来看看我们的<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example/blob/master/src/main/resources/person.csv" rel="noopener ugc nofollow" target="_blank"> <em class="ny"> person.csv </em> </a>数据文件:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e1a3" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的数据配置条目如下所示:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><ol class=""><li id="7536" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la oc lh li lj bi translated">对于迁移步骤“person”——第1行</li><li id="292a" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">我们指定<em class="ny">文件路径</em>——第2行</li><li id="77b6" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">表格列的<em class="ny">分隔字符</em>—第3行</li><li id="b882" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">通过ID从<em class="ny">处理器配置</em>中选择<em class="ny">处理器</em>，这里是<em class="ny">p</em>person—line 4</li><li id="a0e2" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">我们设置<em class="ny">批次大小</em>——见下文</li><li id="60fd" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">以及用于迁移的<em class="ny">线程</em>的数量——见下文</li><li id="4115" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">然后，我们在数据文件中的<em class="ny">列名</em>和在<em class="ny">处理器配置中指定的<em class="ny">属性生成器</em>之间提供一个映射</em></li><li id="41af" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated">如果列包含值列表，您可以指定<em class="ny">列表分隔字符</em> —第21行</li></ol><p id="26bb" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用4个<em class="ny">线程</em>的2000年<em class="ny">批次大小意味着每批2000条记录中，每个线程将向Grakn写入和提交大约500个插入查询。</em></p><p id="b23d" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GraMi根据插入查询的长度将其均匀地分配给线程，这样每个线程都有大致相同数量的实体/关系和属性/播放器要插入——这可以防止一个线程在处理下一批之前比其他线程花费更长的时间来关闭，从而防止CPU浪费。不均匀的insert语句通常是由包含属性列表的列造成的，其中每个列表的值的数量在记录之间有很大差异。</p><h2 id="e48f" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">步骤4-关系的数据配置</h2><p id="3889" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">继续这些关系，我们现在通过我们的<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example/blob/master/src/main/resources/call.csv" rel="noopener ugc nofollow" target="_blank"> <em class="ny"> calls.csv </em> </a>数据文件来工作:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6887" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据条目如下所示:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2229" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里唯一的新东西是第7-16行，在这里我们定义了从包含唯一标识关系<em class="ny"> call </em>的角色玩家的属性的<em class="ny">列</em>到步骤2中的<em class="ny">处理器配置</em>中的适当玩家生成器的映射。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="bce2" class="mb mc jg bd md me nt mg mh mi nu mk ml mm nv mo mp mq nw ms mt mu nx mw mx my bi translated">使用GraMi</h1><p id="274f" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">完成我们的<em class="ny">处理器</em>和<em class="ny">数据配置</em>后，我们准备开始迁移。有两种使用GraMi的方法:作为Maven/Gradle Java项目中的依赖项或作为独立的可执行文件(适用于Linux和Mac):</p><h2 id="5eee" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">在您的Maven/Gradle项目中使用GraMi</h2><p id="6947" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">使用Maven导入GraMi:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="cd75" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者使用Gradle导入GraMi:(参见完整的<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example/blob/master/build.gradle" rel="noopener ugc nofollow" target="_blank"> build.gradle这里</a>)</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="29f8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，您可以在代码中使用GraMi，如下所示:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1a47" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">布尔标志<em class="ny"> cleanAndMigrate </em>设置为<strong class="kf jh">真</strong>，如所示</p><pre class="lx ly lz ma gt od oe of og aw oh bi"><span id="275d" class="ne mc jg oe b gy oi oj l ok ol">GraknMigrator mig = new GraknMigrator(migrationConfig, migrationStatus, true);</span></pre><p id="1854" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果存在，将删除模式和给定键空间中的所有数据。<br/>如果设置为<strong class="kf jh">假</strong>，GraMi将根据迁移状态继续之前的迁移——这意味着它将从之前停止的地方继续(关于迁移状态的更多细节——见下文)。<br/> <br/>至于吗</p><pre class="lx ly lz ma gt od oe of og aw oh bi"><span id="22ad" class="ne mc jg oe b gy oi oj l ok ol">mig.migrate(true, true);</span></pre><p id="d6fb" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ny"> migrateEntities </em>和<em class="ny"> migrateRelations </em>标志总共有四种可能性，分别为:</p><ol class=""><li id="99e3" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la oc lh li lj bi translated"><strong class="kf jh">真，真</strong> -迁移<em class="ny">数据配置</em>中的所有内容</li><li id="7c0c" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated"><strong class="kf jh">真，假</strong> -仅迁移实体(对调试有用)</li><li id="b231" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated"><strong class="kf jh">假，假</strong> -仅迁移模式(注意:<em class="ny">如上所述的cleanAndMigrate </em>标志也必须为<strong class="kf jh">真)</strong></li><li id="120a" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la oc lh li lj bi translated"><strong class="kf jh">假，真</strong> -不能迁移没有实体的关系-设置为与3相同。</li></ol><h2 id="d474" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">在Java项目中配置GraMi日志记录</h2><p id="4caf" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">要获得对GraMi日志记录的控制，请将以下内容添加到log4j2.xml配置文件中:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6fe7" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了跟踪迁移进度，GraMi的建议日志级别是<em class="ny"> INFO。</em>对于更详细的输出，在你空闲的时候将级别设置为<em class="ny">调试</em>或<em class="ny">跟踪</em>——以及错误报告...</p><h2 id="8388" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">使用GraMi作为CLI应用程序</h2><p id="46a4" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">在确保你的机器上安装了Java 8之后，在这里下载<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami/releases" rel="noopener ugc nofollow" target="_blank">GraMi</a>。解包后，您可以直接在/bin目录下运行它，如下所示:</p><pre class="lx ly lz ma gt od oe of og aw oh bi"><span id="173d" class="ne mc jg oe b gy oi oj l ok ol">./bin/grami \<br/>-d /path/to/dataConfig.json \<br/>-p /path/to/processorConfig.json \<br/>-m /path/to/migrationStatus.json \<br/>-s /path/to/schema.gql \<br/>-k yourFavoriteKeyspace \<br/>-cf</span></pre><p id="064f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只需确保您调整了文件的路径，并选择了您最喜欢的键空间。还要确保将dataConfig.json中指定的文件路径调整为本地路径。你可以在这里找到所有的数据和配置文件。</p><p id="085b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用-h标志，您可以找到GraMi的所有选项和标志:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/9e7bc4352a6afc52797ab3101f4f833d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TdoKEIPUXZrmJQuPaVnjEw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图2— GraMi CLI</p></figure><h2 id="5aae" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">格拉米伐木公司</h2><p id="e831" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">GraMi生成两个日志:应用程序日志和数据日志。</p><p id="be3a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应用程序日志可让您跟踪迁移进度，如果发生异常，它会写出异常或给出软件崩溃原因的信息。对于成功的迁移，您可能会看到如下内容:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="0325" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据日志记录了与您的数据相关的所有问题。例如，当列应该是某种值类型，但不是时:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="62b1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，所有违反数据有效性检查的数据记录(缺少必需的属性或玩家、空行等)都会被记录下来:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3950" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这使您可以快速找到数据文件中的问题，并在重试之前调整您的预处理(或者不调整，因为不应插入违反您的约束的记录，即需要的属性/球员)。</p><p id="7af8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计划在下一个版本中为每个包含所有未插入Grakn的原始数据记录的数据文件创建一个相应的错误文件，这将进一步简化错误分析和修复。</p><h2 id="4ce2" class="ne mc jg bd md nf ng dn mh nh ni dp ml ko nj nk mp ks nl nm mt kw nn no mx np bi translated">GraMi迁移状态</h2><p id="db23" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">GraMi通过记录为每个文件处理的数据记录数量来跟踪迁移过程。如果失败，GraMi可以重新启动，或者跳过<em class="ny"> -cf </em>标志(如果用作应用程序)，或者在应用程序代码中将<em class="ny"> cleanAndMigrate </em>设置为false(见上文)。GraMi将读取您的<em class="ny"> migrationStatus.json </em>文件，可能如下所示:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6610" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果一个文件已经被完整地处理，则<em class="ny"> isCompleted </em>被设置为真。否则为假，文件中处理的行数记录在<em class="ny"> migratedRows </em>下。如果继续中止的迁移，GraMi将跳过所有已完成的文件和每个未完全迁移的文件中的<em class="ny">迁移行</em>(如上面的<em class="ny"> call.csv </em>所示)，然后继续下一个数据记录。欢迎您对此进行测试，方法是手动中止迁移，然后按照说明重新启动。</p><h1 id="4d30" class="mb mc jg bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">摘要</h1><p id="4c76" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">如果您已经按照上述教程进行了操作，并且从您的Maven/Gradle项目中或者通过使用GraMi作为独立的应用程序来运行示例迁移，那么您的<em class="ny">应用程序日志</em> ( <em class="ny"> grami-log.log </em>)应该与代码/应用程序运行的目录<em class="ny"> ) </em>类似:</p><figure class="lx ly lz ma gt is"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="de06" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，您可以使用以下查询使用<a class="ae jd" href="https://dev.grakn.ai/docs/workbase/overview" rel="noopener ugc nofollow" target="_blank"> Grakn Workbase </a>来浏览数据集:</p><pre class="lx ly lz ma gt od oe of og aw oh bi"><span id="2341" class="ne mc jg oe b gy oi oj l ok ol">match $e (caller: $caller, callee: $callee) isa call; get; offset 0; limit 5;</span></pre><p id="8842" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您应该会看到类似这样的内容:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div class="gh gi on"><img src="../Images/15e5fd0781bb8152f2e3a2b612a086e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*akmyft4Anbj9LCX7Ew41Qw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图3 —使用<a class="ae jd" href="https://dev.grakn.ai/docs/workbase/overview" rel="noopener ugc nofollow" target="_blank"> Grakn工作库</a>探索电话呼叫</p></figure><p id="f2da" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">至此，您已经成功地完成了教程，现在可以使用GraMi获取您自己的数据了(希望不到几周)！</p><p id="9598" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有，请通过Github联系我或在下面留下评论…</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="740f" class="mb mc jg bd md me nt mg mh mi nu mk ml mm nv mo mp mq nw ms mt mu nx mw mx my bi translated">链接和资源</h1><p id="9cff" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated"><a class="ae jd" href="https://github.com/graknlabs/grakn" rel="noopener ugc nofollow" target="_blank">Github上的Grakn</a></p><p id="11ed" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">格拉克工作基地</p><p id="18a1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami" rel="noopener ugc nofollow" target="_blank"> GraMi on Github </a></p><p id="21d2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example" rel="noopener ugc nofollow" target="_blank">Github上的GraMi示例项目</a></p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="3dee" class="mb mc jg bd md me nt mg mh mi nu mk ml mm nv mo mp mq nw ms mt mu nx mw mx my bi translated">贡献</h1><p id="308b" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">GraMi是在语义和知识图技术小组@ <a class="ae jd" href="https://www.bayer.com/" rel="noopener ugc nofollow" target="_blank"> Bayer AG </a>的工程师@ <a class="ae jd" href="https://github.com/orgs/graknlabs/people" rel="noopener ugc nofollow" target="_blank"> Grakn Labs的<strong class="kf jh">大力支持下建立的！</strong></a></p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="2228" class="mb mc jg bd md me nt mg mh mi nu mk ml mm nv mo mp mq nw ms mt mu nx mw mx my bi translated">批准</h1><p id="a33f" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">GraMi 和<a class="ae jd" href="https://github.com/bayer-science-for-a-better-life/grami-example" rel="noopener ugc nofollow" target="_blank">GraMi-示例</a>存储库包括在<a class="ae jd" href="https://www.bayer.com/" rel="noopener ugc nofollow" target="_blank">拜耳公司</a>开发的软件。它是在GNU-3通用公共许可证下发布的。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="424b" class="mb mc jg bd md me nt mg mh mi nu mk ml mm nv mo mp mq nw ms mt mu nx mw mx my bi translated">信用</h1><p id="7efb" class="pw-post-body-paragraph kd ke jg kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">来自<a class="ae jd" href="https://www.flaticon.com/" rel="noopener ugc nofollow" target="_blank"> Flaticon </a>的<a class="ae jd" href="https://www.flaticon.com/de/autoren/smashicons" rel="noopener ugc nofollow" target="_blank"> Smashicons </a>横幅中的图标。</p></div></div>    
</body>
</html>