<html>
<head>
<title>Meet the hardest functions of Pandas, Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">认识熊猫最难的功能，第二部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/meet-the-hardest-functions-of-pandas-part-ii-f8029a2b0c9b?source=collection_archive---------1-----------------------#2020-10-10">https://towardsdatascience.com/meet-the-hardest-functions-of-pandas-part-ii-f8029a2b0c9b?source=collection_archive---------1-----------------------#2020-10-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7d7f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">用熊猫重塑数据框</h2><div class=""/><div class=""><h2 id="d377" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">掌握<code class="fe kr ks kt ku b">crosstab()</code>的时间和方式</h2></div><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/26c56682e791529a1ef3c8cc816a0dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_d2eFZ6YqbKj0coOn-3-CQ.jpeg"/></div></div></figure><h2 id="c82f" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">介绍</h2><p id="0a33" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi mv translated">我记得自己在DataCamp上参加了一个名为“Seaborn中级数据可视化”的课程。它为DV教授了非常棒的情节和方法。当谈到热图时，不知从哪里冒出来的讲师介绍了一个全新的<code class="fe kr ks kt ku b">pandas</code>功能<code class="fe kr ks kt ku b">crosstab()</code>。然后，赶紧说:“<code class="fe kr ks kt ku b">crosstab()</code>是一个很有用的函数，可以计算交叉制表表……”</p><p id="cb1b" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">我在那里迷路了。显然，我的第一反应是查看该函数的文档。我刚刚开始觉得我可以处理Matplotlib之后的任何文档，但是…我错了。甚至这些例子都是在<code class="fe kr ks kt ku b">numpy</code>阵列上给出的，而我本应该使用该死的函数创建热图🤦‍♂️.</p><p id="792a" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">在我练习过之后，我知道这也是其他人会为之奋斗的事情。所以，我在这里写了一整篇文章。</p><p id="f2b8" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">在本文的最后一部分，我谈到了为什么有些课程不教你<code class="fe kr ks kt ku b">crosstab()</code>这样的高级功能。很难创建这样的函数有用的上下文，同时保持初学者的水平。此外，大多数课程使用小型或玩具数据集。此类功能的优势在更复杂的数据科学环境中更为明显，通常由更有经验的用户使用<code class="fe kr ks kt ku b">pandas</code>。</p><p id="408e" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">在这篇文章中，我将教你如何使用<code class="fe kr ks kt ku b">crosstab()</code>，以及你选择它而不是其他类似函数的情况。尽情享受吧！</p><div class="nj nk gp gr nl nm"><a href="https://ibexorigin.medium.com/membership" rel="noopener follow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">通过我的推荐链接加入Medium-BEXGBoost</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">获得独家访问我的所有⚡premium⚡内容和所有媒体没有限制。支持我的工作，给我买一个…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa lf nm"/></div></div></a></div><p id="c0bb" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">获得由强大的AI-Alpha信号选择和总结的最佳和最新的ML和AI论文:</p><div class="nj nk gp gr nl nm"><a href="https://alphasignal.ai/?referrer=Bex" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">阿尔法信号|机器学习的极品。艾总结的。</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">留在循环中，不用花无数时间浏览下一个突破；我们的算法识别…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">alphasignal.ai</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa lf nm"/></div></div></a></div></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="f93d" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">可点击的目录(仅限网络)</h2><p id="009b" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">∘ <a class="ae oj" href="#c82f" rel="noopener ugc nofollow">简介</a> <br/> ∘ <a class="ae oj" href="#f5ba" rel="noopener ugc nofollow">设置</a> <br/> ∘ <a class="ae oj" href="#d10e" rel="noopener ugc nofollow">熊猫交叉表()，基础知识</a> <br/> ∘ <a class="ae oj" href="#1bf9" rel="noopener ugc nofollow">熊猫交叉表()与pivot_table()和groupby()的比较</a> <br/> ∘ <a class="ae oj" href="#6f16" rel="noopener ugc nofollow">熊猫交叉表()，进一步定制</a> <br/> ∘ <a class="ae oj" href="#7569" rel="noopener ugc nofollow">熊猫交叉表()，多个分组</a></p><blockquote class="ok ol om"><p id="f4d6" class="mc md on me b mf ne kd mh mi nf kg mk oo ng mm mn op nh mp mq oq ni ms mt mu im bi translated">你可以在<a class="ae oj" href="https://github.com/BexTuychiev/medium_stories/tree/master/hardest_of_pandas2" rel="noopener ugc nofollow" target="_blank"> this </a> GitHub repo上下载这篇文章的笔记本。</p></blockquote></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="f5ba" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">设置</h2><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="0bfb" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">对于样本数据，我将使用Seaborn内置的<code class="fe kr ks kt ku b">diamonds</code>数据集。它足够大，并且具有可以用<code class="fe kr ks kt ku b">crosstab()</code>概括的变量:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/f5055945b0b03577978f279d7c1f670f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*m0zXiaXNNhaDp5vRtj6iSQ.png"/></div></figure><blockquote class="ok ol om"><p id="d1b4" class="mc md on me b mf ne kd mh mi nf kg mk oo ng mm mn op nh mp mq oq ni ms mt mu im bi translated">从现在开始，在每个函数的文档第一次出现时，我都使用了超链接。</p></blockquote></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="d10e" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">熊猫<code class="fe kr ks kt ku b">crosstab()</code>，基础知识</h2><p id="94ed" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">像许多计算分组汇总统计数据的函数一样，<code class="fe kr ks kt ku b"><a class="ae oj" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.crosstab.html" rel="noopener ugc nofollow" target="_blank">crosstab()</a></code>处理分类数据。它可用于将两个或多个变量分组，并为每个组的给定值执行计算。当然，这样的操作使用<code class="fe kr ks kt ku b"><a class="ae oj" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank">groupby()</a></code>或<code class="fe kr ks kt ku b"><a class="ae oj" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html" rel="noopener ugc nofollow" target="_blank">pivot_table()</a></code>是可能的，但是正如我们将在后面看到的，<code class="fe kr ks kt ku b">crosstab()</code>给你的日常工作流程带来了许多好处。</p><p id="e01d" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated"><code class="fe kr ks kt ku b">crosstab()</code>函数接受两个或多个列表、<code class="fe kr ks kt ku b">pandas</code>系列或dataframe列，并默认返回每个组合的频率。我总是喜欢从例子开始，这样你可以更好地理解定义，然后我会继续解释语法。</p><p id="3ff1" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated"><code class="fe kr ks kt ku b">crosstab()</code>总是返回一个数据帧，下面是一个例子。数据框是来自<code class="fe kr ks kt ku b">diamonds</code>的两个变量的交叉列表:<code class="fe kr ks kt ku b">cut</code>和<code class="fe kr ks kt ku b">color</code>。交叉制表只是指取一个变量，将其分组显示为索引，取另一个变量，将其分组显示为列。</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/8348199177b533f4fa76a703aea64878.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ruD_gKzp-RTTcg5ZIfbATQ.png"/></div></figure><p id="50cd" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">语法相当简单。<code class="fe kr ks kt ku b">index</code>用于将变量分组并显示为索引(行)，与<code class="fe kr ks kt ku b">columns</code>相同。如果没有给定聚合函数，每个单元格将计算每个组合中的观察值数量。例如，左上角的单元格告诉我们有2834颗<strong class="me jd"> <em class="on">理想切割的</em> </strong>钻石，颜色代码为<strong class="me jd"> <em class="on"> D </em> </strong>。</p><p id="42dd" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">接下来，对于每个组合，我们希望看到它们的平均价格。<code class="fe kr ks kt ku b">crosstab()</code>提供<code class="fe kr ks kt ku b">values</code>参数，以引入第三个数值变量进行汇总:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/587b7216d49e0a49bec8d8269617afb2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZVYm-9MgQG8o8id2_xQDaw.png"/></div></figure><p id="7fde" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">现在，每个单元格包含每种切割和颜色组合的平均价格。为了告诉我们要计算平均价格，我们将<code class="fe kr ks kt ku b">price</code>列传递给<code class="fe kr ks kt ku b">values</code>。请注意，您必须同时使用<code class="fe kr ks kt ku b">values</code>和<code class="fe kr ks kt ku b">aggfunc</code>。否则，您将得到一个错误。我还用<code class="fe kr ks kt ku b">round()</code>把答案四舍五入了。</p><p id="8414" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">即使它有点高级，当您将它们传递到<code class="fe kr ks kt ku b">seaborn</code>的热图中时，您将充分利用<code class="fe kr ks kt ku b">crosstab()</code>表的好处。让我们在热图中查看上表:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/faa301c58f957321c7df3f45241a4063.png" data-original-src="https://miro.medium.com/v2/format:webp/1*zNl7NSRWBL4X9KoTF_nWww.png"/></div></figure><p id="0708" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated"><code class="fe kr ks kt ku b">seaborn</code>可以自动将<code class="fe kr ks kt ku b">crosstab()</code>表格变成热图。我将注释设置为<code class="fe kr ks kt ku b">True</code>，并用颜色条显示热图。<code class="fe kr ks kt ku b">seaborn</code>还为列名和索引名添加样式(<code class="fe kr ks kt ku b">fmt = 'g'</code>将数字显示为整数，而不是科学记数法)。</p><p id="fd0d" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">热图更容易解读。你不希望你的终端用户看着满是数字的表格时眼睛<strong class="me jd">流血。所以，我会在需要的时候把每个<code class="fe kr ks kt ku b">crosstab()</code>结果放到热图中。为了避免重复，我创建了一个有用的函数:</strong></p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="1bf9" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">熊猫交叉表()与pivot_table()和groupby()的比较</h2><p id="6c76" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">在我们开始更有趣的东西之前，我想我需要澄清计算分组汇总统计的三个函数之间的区别。</p><p id="adb4" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">我在文章的第一部分的<a class="ae oj" rel="noopener" target="_blank" href="/meet-the-hardest-functions-of-pandas-part-i-7d1f74597e92">中提到了<code class="fe kr ks kt ku b">pivot_table()</code>和<code class="fe kr ks kt ku b">groupby()</code>的区别。对于<code class="fe kr ks kt ku b">crosstab()</code>，三者的区别在于语法和结果的形状。让我们使用所有三个来计算最后一个<code class="fe kr ks kt ku b">crosstab()</code>表:</a></p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/587b7216d49e0a49bec8d8269617afb2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZVYm-9MgQG8o8id2_xQDaw.png"/></div><p class="ou ov gj gh gi ow ox bd b be z dk translated">数据透视表的输出</p></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/587b7216d49e0a49bec8d8269617afb2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZVYm-9MgQG8o8id2_xQDaw.png"/></div><p class="ou ov gj gh gi ow ox bd b be z dk translated">交叉表的输出</p></figure><p id="84c8" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">我想你已经知道你的最爱了。<code class="fe kr ks kt ku b">groubpy()</code>返回一个序列，而另外两个返回相同的数据帧。然而，可以将<code class="fe kr ks kt ku b">groupby</code>系列转换成相同的数据帧，如下所示:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/587b7216d49e0a49bec8d8269617afb2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZVYm-9MgQG8o8id2_xQDaw.png"/></div></figure><blockquote class="ok ol om"><p id="1bcf" class="mc md on me b mf ne kd mh mi nf kg mk oo ng mm mn op nh mp mq oq ni ms mt mu im bi translated">如果你不理解<code class="fe kr ks kt ku b">pivot_table()</code>和<code class="fe kr ks kt ku b">unstack()</code>的语法，我强烈建议你阅读文章的<a class="ae oj" rel="noopener" target="_blank" href="/meet-the-hardest-functions-of-pandas-part-i-7d1f74597e92">第一部分</a>。</p></blockquote><p id="28a5" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">说到速度，<code class="fe kr ks kt ku b">crosstab()</code>比<code class="fe kr ks kt ku b">pivot_table()</code>快，但都比<code class="fe kr ks kt ku b">groupby()</code>慢得多:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="1d3b" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">如你所见，即使与<code class="fe kr ks kt ku b">unstack()</code>链接在一起，<code class="fe kr ks kt ku b">groupby()</code>也比其他两个快3倍。这告诉我们，如果您只想分组和计算汇总统计数据，那么您应该使用相同的ol' <code class="fe kr ks kt ku b">groupby()</code>。当我链接其他方法如simple <code class="fe kr ks kt ku b">round()</code>时，速度差异甚至更大。</p><p id="de64" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">剩下的比较将主要是关于<code class="fe kr ks kt ku b">pivot_table()</code>和<code class="fe kr ks kt ku b">crosstab()</code>。如您所见，两个函数的结果形状是相同的。两者的第一个区别是<code class="fe kr ks kt ku b">crosstab()</code>可以处理任何数据类型。</p><p id="e4b2" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">它可以接受任何类似数组的对象，如列表、<code class="fe kr ks kt ku b">numpy</code>数组、数据框列(是<code class="fe kr ks kt ku b">pandas</code>系列)。相比之下，<code class="fe kr ks kt ku b">pivot_table()</code>只对数据帧有效。在一个有用的StackOverflow <a class="ae oj" href="https://stackoverflow.com/questions/36267745/how-is-a-pandas-crosstab-different-from-a-pandas-pivot-table" rel="noopener ugc nofollow" target="_blank">线程</a>中，我发现如果你在一个数据帧上使用<code class="fe kr ks kt ku b">crosstab()</code>，它会在后台调用<code class="fe kr ks kt ku b">pivot_table()</code>。</p><p id="1550" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">接下来是参数。有些参数只存在于一个中，反之亦然。第一个最受欢迎的是<code class="fe kr ks kt ku b">crosstab()</code>的<code class="fe kr ks kt ku b">normalize</code>。<code class="fe kr ks kt ku b">normalize</code>接受这些选项(来自文档):</p><ul class=""><li id="1ce8" class="oy oz it me b mf ne mi nf lq pa lu pb ly pc mu pd pe pf pg bi translated">如果通过<code class="fe kr ks kt ku b">all</code>或<code class="fe kr ks kt ku b">True</code>，将对所有值进行标准化。</li><li id="a7c1" class="oy oz it me b mf ph mi pi lq pj lu pk ly pl mu pd pe pf pg bi translated">如果通过,<code class="fe kr ks kt ku b">index</code>将对每行进行标准化。</li><li id="b558" class="oy oz it me b mf ph mi pi lq pj lu pk ly pl mu pd pe pf pg bi translated">如果通过<code class="fe kr ks kt ku b">columns</code>将对每一列进行标准化。</li></ul><p id="d7cf" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">让我们看一个简单的例子:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/75d135abde5c18d373fa78fa533f463b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jAJh5gspZaWZTTr7NRbvFg.png"/></div><p class="ou ov gj gh gi ow ox bd b be z dk translated">数量最多的钻石是带有<strong class="bd pm"> <em class="pn">理想切工</em> </strong>和色码<strong class="bd pm"> <em class="pn"> G </em> </strong>的。</p></figure><p id="acaa" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">如果通过<code class="fe kr ks kt ku b">all</code>，对于每个单元格，<code class="fe kr ks kt ku b">pandas</code>将计算总量的百分比:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="02d8" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">如果通过，<code class="fe kr ks kt ku b">index</code>或<code class="fe kr ks kt ku b">columns</code>，则按列或行执行相同的操作:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/bbbf978ee49318a33647ba19677a39aa.png" data-original-src="https://miro.medium.com/v2/format:webp/1*fI7-cAOg1Gpp1UM8dGxc6g.png"/></div><p class="ou ov gj gh gi ow ox bd b be z dk translated">按行规范化。看来在几乎所有类型的钻石切工中，它们的最高编号都有颜色代码<strong class="bd pm"> <em class="pn"> G </em> </strong>。</p></figure><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/c7878935b15633f0aab4c9a8c2ebef2e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*g0uA9uxRPiuqaYMLlUXw5w.png"/></div><p class="ou ov gj gh gi ow ox bd b be z dk translated">按列规范化。热图再次显示，在数据集中，对于每种颜色代码，理想切割的<strong class="bd pm">钻石数量要高得多。</strong></p></figure><p id="d1e9" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">在<code class="fe kr ks kt ku b">crosstab()</code>中，您还可以使用<code class="fe kr ks kt ku b">rownames</code>和<code class="fe kr ks kt ku b">colnames</code>在函数中直接更改索引和列名。您不必在之后手动操作。当我们一次按多个变量分组时，这两个参数非常有用，稍后您将会看到。</p><p id="d456" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">参数<code class="fe kr ks kt ku b">fill_value</code>只存在于<code class="fe kr ks kt ku b">pivot_table()</code>中。有时，当您按许多变量分组时，不可避免地会有<code class="fe kr ks kt ku b">NaN</code> s。在<code class="fe kr ks kt ku b">pivot_table()</code>中，您可以使用<code class="fe kr ks kt ku b">fill_value</code>将它们更改为自定义值:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="d425" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">但是，如果您使用<code class="fe kr ks kt ku b">crosstab()</code>，您可以通过在数据帧上链接<code class="fe kr ks kt ku b">fillna()</code>来实现同样的事情:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="6f16" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">熊猫交叉表()，进一步定制</h2><p id="e92c" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated"><code class="fe kr ks kt ku b">crosstab()</code>的另外两个有用参数是<code class="fe kr ks kt ku b">margins</code>和<code class="fe kr ks kt ku b">margins_name</code>(两者也存在于<code class="fe kr ks kt ku b">pivot_table()</code>中)。当设置为<code class="fe kr ks kt ku b">True</code>时，<code class="fe kr ks kt ku b">margins</code>计算每行和每列的小计。让我们看一个例子:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/f4b9b1872663b5b44a24b364f5a8aa1d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*n7cm4Pz8RLNsKeoIVps8dw.png"/></div></figure><p id="d61f" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated"><code class="fe kr ks kt ku b">pandas</code>自动添加最后一行和最后一列，默认名称为<code class="fe kr ks kt ku b">All</code>。控制行为:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/ab8151e82558d368acceae7c37da0d4f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2uRwl_E43b47SxoewLPxeA.png"/></div></figure><p id="5d01" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">如果<code class="fe kr ks kt ku b">normalize</code>被设置为<code class="fe kr ks kt ku b">True</code>，右下角的单元格将始终包含观察的总数或1:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/637f068904d1cef52d8979e65f785e81.png" data-original-src="https://miro.medium.com/v2/format:webp/1*GptiI9m2JyJ6a0cQgxd9kg.png"/></div></figure><blockquote class="ok ol om"><p id="fa62" class="mc md on me b mf ne kd mh mi nf kg mk oo ng mm mn op nh mp mq oq ni ms mt mu im bi translated">请注意，如果将<code class="fe kr ks kt ku b">margins</code>设置为<code class="fe kr ks kt ku b">True</code>，热图是没有用的。</p></blockquote></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="7569" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">熊猫<code class="fe kr ks kt ku b">crosstab()</code>，多组</h2><p id="e288" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">对于<code class="fe kr ks kt ku b">index</code>和<code class="fe kr ks kt ku b">columns</code>参数，可以传递多个变量。结果将是一个带有<strong class="me jd">多级索引</strong>的数据帧。这次让我们插入所有的分类变量:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/8536bbece835b9eafc615d557f7a1beb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JsP7IDWSrQYWehWBod_QDg.png"/></div></figure><p id="1083" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">对于指数，我通过了<code class="fe kr ks kt ku b">color</code>和<code class="fe kr ks kt ku b">cut</code>。如果我将它们传递给<code class="fe kr ks kt ku b">columns</code>，结果将是一个有40列的数据帧。如果您注意的话，多级索引如预期的那样被命名为<code class="fe kr ks kt ku b">cut</code>和<code class="fe kr ks kt ku b">clarity</code>。对于存在多级索引或列名的情况，<code class="fe kr ks kt ku b">crosstab()</code>有方便的参数来更改它们的名称:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="ab gu cl ot"><img src="../Images/7cad9305c0b7d81ba3cccbb899616afa.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2drMBpMeVGv0biPKHZ9OUw.png"/></div></figure><p id="a42e" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">您传递一个相应名称的列表来将索引名称更改为<code class="fe kr ks kt ku b">rownames</code>。对于控制列名的<code class="fe kr ks kt ku b">colnames</code>,过程是相同的。</p><p id="da83" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">让我惊讶的一件事是，如果你把多个函数传递给<code class="fe kr ks kt ku b">aggfunc</code>，<code class="fe kr ks kt ku b">pandas</code>会抛出一个错误。再说一次，StackOverflow上的人认为这是一个bug，已经超过6年没有解决了。如果你有任何想法，请在评论中留下，这样我们都可以学习🙌。</p><p id="6884" class="pw-post-body-paragraph mc md it me b mf ne kd mh mi nf kg mk lq ng mm mn lu nh mp mq ly ni ms mt mu im bi translated">最后要注意的是，在<code class="fe kr ks kt ku b">pivot_table()</code>和<code class="fe kr ks kt ku b">crosstab()</code>中，都有一个<code class="fe kr ks kt ku b">dropna</code>参数，如果设置为<code class="fe kr ks kt ku b">True</code>，则删除所有<code class="fe kr ks kt ku b">NaN</code>的列或行。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="7d39" class="po li it bd lj pp pq pr lm ps pt pu lp ki pv kj lt kl pw km lx ko px kp mb py bi translated">如果你喜欢这篇文章，请分享并留下反馈。作为一名作家，你的支持对我来说意味着一切！</h1><p id="a136" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">阅读更多与主题相关的文章:</p><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/meet-the-hardest-functions-of-pandas-part-i-7d1f74597e92"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">认识熊猫最难的功能，第一部分</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">掌握pivot_table()、stack()、unstack()的时机和方式</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="pz l nx ny nz nv oa lf nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/meet-the-hardest-functions-of-pandas-part-ii-f8029a2b0c9b"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">认识熊猫最难的功能，第二部分</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">掌握交叉表的时间和方式()</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="qa l nx ny nz nv oa lf nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/shape-tables-like-jelly-with-pandas-melt-and-pivot-f2e13e666d6"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">认识熊猫最难的功能，第三部分</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">形状像果冻的桌子有熊猫旋转()和融化()</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="qb l nx ny nz nv oa lf nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/masteriadsf-246b4c16daaf"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">掌握连接:Pandas合并、连接、追加方法</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">从半连接/反连接到验证数据合并</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="qc l nx ny nz nv oa lf nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/how-i-customarily-bin-data-with-pandas-9303c9e4d946"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">我习惯如何将数据与熊猫绑定</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">您可能只使用了默认值</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="qd l nx ny nz nv oa lf nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/from-kagglers-best-project-setup-for-ds-and-ml-ffb253485f98"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">来自Kagglers:DS和ML的最佳项目设置</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">来自顶级Kagglers的项目成功最佳实践的集合</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="qe l nx ny nz nv oa lf nm"/></div></div></a></div></div></div>    
</body>
</html>