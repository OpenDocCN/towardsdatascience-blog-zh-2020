<html>
<head>
<title>Is Your Model’s Log-Loss Better Than Random Guessing Log-Loss?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的模型的对数损失比随机猜测的对数损失好吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/estimate-model-performance-with-log-loss-like-a-pro-9f47d13c8865?source=collection_archive---------23-----------------------#2020-10-04">https://towardsdatascience.com/estimate-model-performance-with-log-loss-like-a-pro-9f47d13c8865?source=collection_archive---------23-----------------------#2020-10-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0aeb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在二元或多类分类问题中，如何获得考虑类不平衡的随机猜测对数损失基线得分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1274b46db5452c7ebdd410fd67e9ed19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oBMo0n2X7xb7tGl2"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@patrickian4?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">帕特里克·福尔</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="98ca" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="a593" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你做了一个分类模型。</p><p id="d5e6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您在某处读到过关于对数损失作为一种评估模型性能的方法。关于对数损失幻数。</p><p id="9363" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但与准确性不同，使用它并衡量你的模型得到的对数损失是好是坏并不是很直观，对吗？尤其是当你的班级不平衡的时候。</p><p id="d8ec" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果是，那么你点击了正确的链接！</p><p id="62ac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这篇文章中，我试图回答这些问题:</p><ol class=""><li id="e713" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">为什么是日志丢失？</li><li id="3825" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">什么是日志丢失？</li><li id="0c22" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">与随机猜测相比，如何衡量模型性能？</li><li id="a7b3" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">班级不平衡怎么办？</li><li id="f3bd" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">当目标是多类时该怎么办？</li><li id="ca2a" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">你能给我适用于所有这些情况的代码吗？(当然，我可以！)</li></ol></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="9047" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">为什么是日志丢失？</h1><p id="7a84" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">建立一个模型只是完成了一半的工作。需要有一个评估指标来衡量模型的性能。在行业中，不同种类的度量标准被用来评估模型。度量标准的选择是模型类型和目标的函数。对于分类任务，混淆矩阵提供了几个度量标准可供选择，如准确度、精确度和召回率。</p><p id="d737" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然分类准确性是最广泛使用的度量标准，但它可能是最容易误导的。准确度被定义为正确预测与总预测的比率。事实上，准确性并不能给出错误预测的信息。</p><p id="d73a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">具体来说，在两种情况下，准确性度量失败。第一，两个班以上的时候。模型可能会忽略一个或多个类。在这种情况下，该指标不会给出关于每个类别的个体准确性的信息。第二，当数据存在不平衡类时。例如，如果二进制分类数据集具有90:10的类别不平衡比率，那么具有90%分类准确度的模型是不提供信息的模型。</p><p id="6b82" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了解决这些限制，F1分数是另一个度量，它被定义为精确度和召回率的调和平均值。精度是被正确识别的阳性病例的比例，而召回是被正确识别的实际阳性病例的比例。提高F1分数有助于同时提高准确率和召回率。取调和平均值是有意义的，因为与算术平均值相比，调和平均值对极值的惩罚更大。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/001a79c92a489abaf43650a6108a8c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCLzjUK4L-jWjOmeKy5euw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><blockquote class="nq nr ns"><p id="cf1f" class="lo lp nt lq b lr mk jr lt lu ml ju lw nu mm lz ma nv mn md me nw mo mh mi mj ij bi translated">尽管作为一种度量，F1分数比准确性好，但在分类模型中仍然存在缺点，其中类别预测是基于类别概率的。</p></blockquote><p id="e6c1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">考虑两个模型，其中对于特定观察，第一个模型预测概率为0.6的类别，而另一个模型预测概率为0.9的类别。F1分数将对这些模型一视同仁，因为这两个模型都预测了此次观察的相同类别。它没有考虑预测的确定性。如果实际值为1，那么两个模型都是正确的。但是第二种模式显然更好，不是吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/3a88449500b701fccba6ef125834e129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBpWN4yvVKuYYh45foiNHw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">比较精确度和F1与对数损失(图片由作者提供)</p></figure><p id="da02" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了考虑分类概率，可以使用对数损失。Log-loss是每个实例的校正预测概率对数的负平均值。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="aef1" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">什么是日志丢失？</h1><blockquote class="nq nr ns"><p id="072b" class="lo lp nt lq b lr mk jr lt lu ml ju lw nu mm lz ma nv mn md me nw mo mh mi mj ij bi translated">Log-loss是每个实例的校正预测概率对数的负平均值。</p></blockquote><p id="c0be" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于具有真实标签y <strong class="lq ir"> ∈ </strong> {0，1}和概率估计p=Pr(y=1)的二元分类，每个样本的对数损失是给定真实标签的分类器的负对数似然性:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/0a17eed73ce47f822ff64399e433d56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5pNZvMc8sxmGzL2WelHhA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a0aa" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这延伸到如下的多类情况。假设一组样本的真实标签被编码为1-of-K二进制指示矩阵y，即如果样本I具有取自一组k个标签的标签k，则yᵢ,ₖ = 1。设p是概率估计的矩阵，pᵢ,ₖ = Pr(tᵢ,ₖ=1).那么整个集合的对数损失为</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/f887a4ccd43a305acc170da01484d9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0l5ABe2BHfeZgPJhlnI0NQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4226" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好了，理论到此为止。让我们直接讨论眼前的问题，好吗？？</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="8684" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">与随机猜测相比，如何衡量模型性能？</h1><p id="a0f9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">想象一下。我有一盒巧克力。它有5块黑巧克力和5块白巧克力。如果我让你不偷看盒子里的巧克力并猜它是哪一种，你会说有50%的机会是黑色的，对吗？换句话说，你的随机猜测准确率是50%。</p><p id="4ea8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">也就是说，准确度分数在50%以上的模型比随机猜测要好。在这里，你直观的知道100%的准确率是最好的，0%是最差的。</p><p id="456b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于日志丢失，事情不那么明显，也不那么直观。你需要把你的猜测代入上面给出的公式。</p><p id="9092" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">考虑一个有10个观察值的数据集。目标y有五个1代表黑巧克力，五个0代表白巧克力。如果你随机猜测，得到一个黑巧克力的概率，p = Pr(y =黑)=0.5。用1代替黑巧克力，用0代替白巧克力，上面的公式给出了下面的计算。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/56c78165c9a379e901934629d5191aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0ERI_GjP421qNrjiFRB4w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">平衡二元分类的随机猜测对数损失(图片由作者提供)</p></figure><p id="a06d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">取最后一列的平均值，瞧！你有你的随机猜测日志损失。因此，如果你的模型的对数损失小于(损失是负的，记住！？)0.693，肯定比乱猜强！</p><p id="4157" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这就引出了我们的下一个问题，如果机会不是50-50呢？</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="301f" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">班级不平衡怎么办？</h1><p id="ebfa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">还记得我那盒著名的巧克力吗？如果现在我告诉你它有三块黑巧克力和七块白巧克力，你不会说取出黑巧克力的机会是50-50，对吗？</p><p id="4be1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这里选一个黑巧克力的概率就变成了，p = Pr(y =黑)=3/10=0.3。现在，用1代替黑巧克力，用0代替白巧克力，看看下面的计算。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/c353b684d044583262b10e34ee58ae80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MlWlJwirYQhS3juxTFlgEw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不平衡二元分类的随机猜测对数损失(图片由作者提供)</p></figure><p id="88af" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">看看随机猜测log-loss是怎么从0.693降到0.611的？这意味着酒吧被设置了更严格的条件，嗯？该模型的性能需要优于0.611。</p><p id="b55f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，让我们看看当你的盒子里有更多种类的巧克力时会发生什么！美味，不是吗！？</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="3092" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">当目标是多类时该怎么办？</h1><p id="ce85" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这次我在盒子里放了10块牛奶巧克力。现在计算更加不直观了，但是请耐心听我说。这次我们有三种标签——黑巧克力、白巧克力和牛奶巧克力。</p><p id="0abd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注意y代表拿起一种巧克力的事件。之前我们取y=1代表黑巧克力。于是1-y自动变成了白巧克力。然而，这一次，我们明确地说出了巧克力的类型。我们取y1 =拿起一块黑巧克力的事件，y2 =拿起一块白巧克力的事件，y3 =拿起一块牛奶巧克力的事件。然后，根据随机猜测，</p><p id="d1e7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">选择黑巧克力的概率=3/20=0.15</p><p id="291f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">选择白巧克力的概率=7/20=0.35</p><p id="c5fc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">选牛奶巧克力的概率=10/20=0.5</p><p id="ee41" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在这些计算就有意义了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/192c0ee05c50fc9deadae5d7a91d36b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxwBLkdvFT1fUG5bhMFjVA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不平衡多类分类的随机猜测对数损失(图片由作者提供)</p></figure><p id="5544" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这就对了。这个不平衡多类问题的随机猜测对数损失为0.999。</p><p id="cf6d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">请注意，每行的最后一个单元格表示上一节中给出的公式的内部求和。当将列相加时，在计算平均值时，表示外部求和。</p><p id="9b88" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好的，你明白了，但是当你遇到一个具有不同类别和患病率的新数据集时，该怎么办呢？你接着读下一部分，傻瓜。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="c125" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">你能给我适用于所有这些情况的代码吗？</h1><p id="1aa6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这是一个python函数，它将类的比率列表作为输入，并输出一个随机猜测的对数损失。如果你的模型的对数损失小于这个数字，你的工作就完成了！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="783b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">看到那个论点“多”了吗？我用它来按照输入的比率创建随机的观察样本。如果您给multi=1000，代码将按照提供的比率创建1000个观察值。然后使用sklearn的log-loss函数得到你的基线。整洁，是吧！？</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="7419" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">结论</h1><p id="1d49" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本文中，我解释了为什么log-loss是评估分类模型性能的好选择。我解释了它是什么，并展示了如何针对三种场景计算它——平衡二进制、不平衡二进制和不平衡多类分类。最后提供的python函数可以帮助您获得分类问题的基线。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="948d" class="of kx iq bd ky og oh dn lc oi oj dp lg lx ok ol li mb om on lk mf oo op lm oq bi translated">参考</h2><p id="e3f1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://scikit-learn.org/stable/modules/model_evaluation.html#log-loss" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/model _ evaluation . html # log-loss</a></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="1673" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<a class="ae kv" href="https://www.linkedin.com/in/mohannishant/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上和我联系！</p><p id="b2eb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<a class="ae kv" href="https://github.com/mohannishant6" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上看看我的一些很酷的项目！</p></div></div>    
</body>
</html>