<html>
<head>
<title>Election Special: Detect Fake News using Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">选举特辑:使用变形金刚检测假新闻</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/election-special-detect-fake-news-using-transformers-3e38d0c5b5c7?source=collection_archive---------36-----------------------#2020-10-30">https://towardsdatascience.com/election-special-detect-fake-news-using-transformers-3e38d0c5b5c7?source=collection_archive---------36-----------------------#2020-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cb22" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用数据做很酷的事情</h2></div><h1 id="1de4" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">介绍</h1><p id="9dce" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">美国2020年大选在即。在选举前后，社交媒体上发布的假新闻是一个巨大的问题。虽然有些假新闻是为了歪曲选举结果或通过广告赚快钱而故意制作的，但虚假信息也可以由被误导的个人在其社交媒体帖子中分享。这些帖子可以迅速成为病毒模糊。大多数人相信被很多人喜欢的帖子一定是真的。</p><p id="85d7" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">对于机器学习模型来说，检测假新闻并不是一件容易的事情。这些故事中有许多写得非常好。机器学习仍然有帮助，因为:</p><ul class=""><li id="a864" class="mb mc it lc b ld lw lg lx lj md ln me lr mf lv mg mh mi mj bi translated">它可以检测到该书写风格与它的数据库中被标记为假的相似</li><li id="288d" class="mb mc it lc b ld mk lg ml lj mm ln mn lr mo lv mg mh mi mj bi translated">故事中事件的版本与已知的真实情况相矛盾</li></ul><p id="5421" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在这篇博客中，我们使用BERT和T5变压器模型构建了一个假新闻检测器。T5模型在检测2016年选举前后发布的真实假新闻方面表现非常好，准确率高达80%。</p><p id="ed73" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">“假新闻检测器”的完整代码在我的Github <a class="ae mp" href="https://github.com/priya-dwivedi/Deep-Learning/tree/master/T5-Fake-News-Detector" rel="noopener ugc nofollow" target="_blank"> <em class="mq">这里</em> </a>公开。</p><p id="9282" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在<a class="ae mp" href="https://deeplearninganalytics.org/" rel="noopener ugc nofollow" target="_blank">深度学习分析</a>，我们非常热衷于使用数据科学和机器学习来解决现实世界的问题。请联系我们，与我们讨论NLP项目。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mr"><img src="../Images/db43e5c8b231879a560f96711408ff46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7MxMY7lc7xpDfmH9KNKgQ.jpeg"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">Unsplash的免版税—<a class="ae mp" href="https://unsplash.com/photos/EQSPI11rf68" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/EQSPI11rf68</a></p></figure><h1 id="111c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">数据集</h1><p id="33bf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对于这篇博客，我们使用了<a class="ae mp" href="https://www.kaggle.com/mrisdal/fake-news" rel="noopener ugc nofollow" target="_blank"> Kaggle数据集</a>——了解假新闻的真相。它包含被BS Detector标记为虚假或有偏见的新闻和故事，BS Detector是Daniel Sieradski的Chrome扩展。BS检测器将一些网站标记为假网站，然后从这些网站上抓取的任何新闻都被标记为假新闻。</p><p id="5e3d" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">数据集包含大约1500个新闻故事，其中大约1000个是假的，500个是真的。我喜欢这个数据集的原因是，它包含了在2016年大选最后几天捕捉到的故事，这使得它与检测选举期间的假新闻非常相关。然而，给假新闻贴上标签的挑战之一是，需要花费时间和精力来审查故事及其正确性。这里采用的方法是认为所有来自标有BS的网站的故事都是假的。情况可能并不总是如此。</p><p id="d8d3" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">标记为真实的故事的一个例子是:</p><pre class="ms mt mu mv gt nh ni nj nk aw nl bi"><span id="aea8" class="nm kj it ni b gy nn no l np nq">ed state  \nfox news sunday reported this morning that anthony weiner is cooperating with the fbi which has reopened yes lefties reopened the investigation into hillary clintons classified emails watch as chris wallace reports the breaking news during the panel segment near the end of the show \nand the news is breaking while were on the air our colleague bret baier has just sent us an email saying he has two sources who say that anthony weiner who also had coownership of that laptop with his estranged wife huma abedin is cooperating with the fbi investigation had given them the laptop so therefore they didnt need a warrant to get in to see the contents of said laptop pretty interesting development \ntargets of federal investigations will often cooperate hoping that they will get consideration from a judge at sentencing given weiners wellknown penchant for lying its hard to believe that a prosecutor would give weiner a deal based on an agreement to testify unless his testimony were very strongly corroborated by hard evidence but cooperation can take many forms  and as wallace indicated on this mornings show one of those forms could be signing a consent form to allow   the contents of devices that they could probably get a warrant for anyway well see if weiners cooperation extends beyond that more related</span></pre><p id="4a8a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">一个假的故事是:</p><pre class="ms mt mu mv gt nh ni nj nk aw nl bi"><span id="2aa9" class="nm kj it ni b gy nn no l np nq">for those who are too young or too unwilling to remember a trip down memory lane \n  debut hillary speaks at wellesley graduation insults edward brooke senates lone black member \n  watergate committee says chief counsel jerry zeifman of hillarys performance she was a liar she was an unethical dishonest lawyer she conspired to violate the constitution the rules of the house the rules of the committee and the rules of confidentiality \n  cattlegate as wife of arkansas governor she invests  in cattle futures makes  \n  whitewater clintons borrow money to launch whitewater development corporations several people go to prison over it clintons dont \n  bimbo eruptions bill and hillary swear to steve kroft on  minutes bill had nothing to do with gennifer flowers \n  private investigators we reached out to them hillary tells cbs steve kroft of bills women i met with two of them to reassure them they were friends of ours they also hire pis to bribe andor threaten as many as twodozen of them \n  health care reform hillary heads secret healthcare task force sued successfully for violating open meeting laws subsequent plan killed by democraticcontrolled house \n  ....</span></pre><p id="e26a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这些故事平均有311个单词，有些故事超过1000个单词。</p><h1 id="b4cb" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">模特培训</h1><p id="254f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这个练习中，我们训练了来自<a class="ae mp" href="https://github.com/huggingface/transformers" rel="noopener ugc nofollow" target="_blank"> HuggingFace </a> — 1的两个模型。具有序列分类头的BERT和具有条件生成头的第二个T5变换器模型。BERT模型在验证集上检测假新闻的准确率为75%，而T5模型能够达到80%的准确率。因此，我们将在博客的其余部分集中讨论如何训练<a class="ae mp" href="https://arxiv.org/abs/1910.10683" rel="noopener ugc nofollow" target="_blank"> T5模型</a>。</p><p id="12aa" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">T5是文本到文本模型，这意味着它可以被训练成从一种格式的输入文本到一种格式的输出文本。这使得该模型非常通用。我个人用它来训练文本摘要。在这里查看我的博客<a class="ae mp" rel="noopener" target="_blank" href="/fine-tuning-a-t5-transformer-for-any-summarization-task-82334c64c81"/>。并使用它来建立一个琐事机器人，它可以在没有任何上下文的情况下从内存中检索答案。点击查看这篇博客<a class="ae mp" href="https://medium.com/analytics-vidhya/build-a-trivia-bot-using-t5-transformer-345ff83205b6" rel="noopener">。</a></p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nr"><img src="../Images/dce690d47170fbdd7b2776a6e92be8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ax8c9rvc75i8wtCvCbox5g.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">T5 —文本到文本转换转换器。图片来自<a class="ae mp" href="https://arxiv.org/pdf/1910.10683.pdf" rel="noopener ugc nofollow" target="_blank"> T5纸。</a></p></figure><h2 id="98fe" class="nm kj it bd kk ns nt dn ko nu nv dp ks lj nw nx ku ln ny nz kw lr oa ob ky oc bi translated">将我们的分类问题转换为文本到文本的格式</h2><p id="8895" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae mp" href="https://huggingface.co/transformers/model_doc/t5.html" rel="noopener ugc nofollow" target="_blank"> Huggingface T5 </a>实现包含一个条件生成头，可以用于任何任务。对于我们的任务，我们的输入是真实的新闻故事，输出是文本——真实的/虚假的。</p><p id="61bc" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">对于输入文本，我们将最大标记长度设置为512。如果故事小于512，那么将在结尾添加一个<pad>标记。如果故事比较大，那么它们会被截断。对于输出，令牌长度设置为3。下面是它的代码片段。请在这里找到我的Github <a class="ae mp" href="https://github.com/priya-dwivedi/Deep-Learning/tree/master/T5-Fake-News-Detector" rel="noopener ugc nofollow" target="_blank">上的完整代码。</a></pad></p><pre class="ms mt mu mv gt nh ni nj nk aw nl bi"><span id="b658" class="nm kj it ni b gy nn no l np nq">source = self.tokenizer.batch_encode_plus([input_], max_length=self.input_length, <br/>                                                padding='max_length', truncation=True, return_tensors="pt")<br/>        <br/>targets = self.tokenizer.batch_encode_plus([target_], max_length=3, <br/>                                                     padding='max_length', truncation=True, return_tensors="pt")</span></pre><h2 id="1cd0" class="nm kj it bd kk ns nt dn ko nu nv dp ks lj nw nx ku ln ny nz kw lr oa ob ky oc bi translated">定义T5模型类</h2><p id="167a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，我们定义T5模型微调类。模型正向传递与其他变压器模型相同。因为T5是文本-文本模型，所以输入和目标都被标记化，并且它们的注意力屏蔽被传递给模型。</p><pre class="ms mt mu mv gt nh ni nj nk aw nl bi"><span id="f1db" class="nm kj it ni b gy nn no l np nq"><strong class="ni iu">def</strong> forward(self, input_ids, attention_mask=<strong class="ni iu">None</strong>, decoder_input_ids=<strong class="ni iu">None</strong>, decoder_attention_mask=<strong class="ni iu">None</strong>, lm_labels=<strong class="ni iu">None</strong>):<br/>        <strong class="ni iu">return</strong> self.model(<br/>                input_ids,<br/>                attention_mask=attention_mask,<br/>                decoder_input_ids=decoder_input_ids,<br/>                decoder_attention_mask=decoder_attention_mask,<br/>                labels=lm_labels<br/>            )</span></pre><p id="a0c4" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在生成步骤中，解码器的输出被限制为令牌长度3，如下所示:</p><pre class="ms mt mu mv gt nh ni nj nk aw nl bi"><span id="a8ee" class="nm kj it ni b gy nn no l np nq"><strong class="ni iu">def</strong> _generative_step(self, batch) :<br/>        <br/>        t0 = time.time()<br/>        <em class="mq"># print(batch)</em><br/>        inp_ids = batch["source_ids"]<br/>        <br/>        generated_ids = self.model.generate(<br/>            batch["source_ids"],<br/>            attention_mask=batch["source_mask"],<br/>            use_cache=<strong class="ni iu">True</strong>,<br/>            decoder_attention_mask=batch['target_mask'],<br/>            max_length=3<br/><br/>        )<br/>        preds = self.ids_to_clean_text(generated_ids)<br/>        target = self.ids_to_clean_text(batch["target_ids"]</span></pre><p id="9036" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">该模型通过检查生成的标签(假/真)是否与实际标签匹配来测量准确度分数。</p><h1 id="caff" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">模型训练和结果</h1><p id="e91b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用8的批量大小训练t5 small 30个时期。这个模型花了大约一个小时来训练。权重和偏差用于监控训练。在线Github代码已经将wandb集成到Pytorch Lightning中用于培训。</p><p id="1b88" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我在令牌长度512和1024上训练了一个T5 small。这两个模型表现相似，准确率接近80%</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/66c7e978015c0bf8c697c6d661ede625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*-FnIudO9egIs02cRZ37S7Q.png"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">T5小型假新闻检测器— Val集合准确度分数</p></figure><p id="66aa" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在val集上测试T5表明，该模型具有令人印象深刻的检测假新闻的能力。</p><pre class="ms mt mu mv gt nh ni nj nk aw nl bi"><span id="2036" class="nm kj it ni b gy nn no l np nq">Input Text: classify: russias most potent weapon hoarding gold shtfplancom this article was written by jay syrmopoulos and originally published at the free thought project editors comment he who holds the gold makes the rules fresh attempts at containing russia and continuing the empire have been met with countermoves russia appears to be building strength in every way putin and his country have no intention of being under the american thumb and are developing rapid resistance as the us petrodollar loses its grip and china russia and the east shift into new currencies and shifting<br/>world order what lies ahead it will be a strong hand for the countries that have the most significant backing in gold and hard assets and china and russia have positioned themselves very<br/>well prepare for a changing economic landscape and one in which selfreliance might be all we have russia is hoarding gold at an alarming rate the next world war will be fought with currencies by jay syrmopoulos with all eyes on russias unveiling their latest nuclear intercontinental ballistic missile icbm which nato has dubbed the satan missile as tensions with the us increase moscows most potent weapon may be something drastically different the rapidly evolving geopolitical weapon brandished by russia is an ever increasing stockpile of gold as well as russias native currency the<br/>ruble take a look at the symbol below as it could soon come to change the entire hierarchy of the international order potentially ushering in a complete international paradigm shift...<br/><br/>Actual Class: Fake<br/><br/>Predicted Class from T5: Fake</span></pre><h1 id="198d" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="5673" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">T5是一款很棒的车型。有了足够的数据，针对任何NLP问题微调转换器变得很容易。这篇博客表明T5可以很好地检测假新闻。</p><p id="5c7d" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我希望您尝试一下代码，并训练自己的模型。请在下面的评论中分享你的经历。</p><p id="744a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在<a class="ae mp" href="https://deeplearninganalytics.org/" rel="noopener ugc nofollow" target="_blank">深度学习分析</a>，我们非常热衷于使用机器学习来解决现实世界的问题。我们已经帮助许多企业部署了创新的基于人工智能的解决方案。如果你看到合作的机会，请通过我们的网站<a class="ae mp" href="https://deeplearninganalytics.org/contact-us/" rel="noopener ugc nofollow" target="_blank">这里</a>联系我们。</p><h1 id="d1a1" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">参考</h1><ul class=""><li id="043c" class="mb mc it lc b ld le lg lh lj oe ln of lr og lv mg mh mi mj bi translated"><a class="ae mp" href="https://arxiv.org/abs/1910.10683" rel="noopener ugc nofollow" target="_blank"> T5变压器</a></li><li id="2e22" class="mb mc it lc b ld mk lg ml lj mm ln mn lr mo lv mg mh mi mj bi translated"><a class="ae mp" href="https://huggingface.co/transformers/model_doc/t5.html" rel="noopener ugc nofollow" target="_blank">拥抱脸变形金刚</a></li><li id="08a3" class="mb mc it lc b ld mk lg ml lj mm ln mn lr mo lv mg mh mi mj bi translated">真实新闻与假新闻</li></ul></div></div>    
</body>
</html>