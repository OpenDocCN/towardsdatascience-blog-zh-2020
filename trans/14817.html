<html>
<head>
<title>Instacart Users Segmentation and Market Basket Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Instacart用户细分和购物篮分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/instacart-users-segmentation-and-market-basket-analysis-d88378f75f73?source=collection_archive---------49-----------------------#2020-10-12">https://towardsdatascience.com/instacart-users-segmentation-and-market-basket-analysis-d88378f75f73?source=collection_archive---------49-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="96e5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解客户在Instacart上的购物行为，并做出有效的推荐</h2></div><p id="995c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编剧:<a class="lb lc ep" href="https://medium.com/u/c4de36e239a7?source=post_page-----d88378f75f73--------------------------------" rel="noopener" target="_blank">颖园(瓦莱丽)张</a>、<a class="lb lc ep" href="https://medium.com/u/cdb36961304e?source=post_page-----d88378f75f73--------------------------------" rel="noopener" target="_blank">雨桐(璇)朱</a>、【德克兰】向、<a class="lb lc ep" href="https://medium.com/u/81ad6d74f0bd?source=post_page-----d88378f75f73--------------------------------" rel="noopener" target="_blank">辛雨</a></p><p id="85dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新冠肺炎在2020年已经是一个世界传播的疫情。因此，纽约人遵循隔离政策，彼此保持社交距离。众所周知，在纽约最受欢迎的交通方式是地铁。然而，地铁是传播新冠肺炎最危险的交通工具之一，这可能会增加地铁乘客感染新冠肺炎的风险。因此，外出获取日常所需成了纽约人头疼的问题。杂货店里的人保持社交距离是不实际的。在新冠肺炎疫情爆发期间，纽约市发布了“呆在家里”的命令，这增加了对网上购物的需求。Instacart是一个杂货交付平台，在新冠肺炎危机期间经历了快速增长。现在，用户获得了呆在家里的价值，以使曲线变平，并降低他们自己感染病毒的风险。</p><p id="4203" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">主要研究目标是基于时间间隔进行用户细分，并基于用户的产品选择建立推荐系统。本研究期望在不违反社会距离规则的前提下，优化供应方的库存分配，增加顾客获得必需品的概率。</p><h2 id="a19d" class="ld le iq bd lf lg lh dn li lj lk dp ll ko lm ln lo ks lp lq lr kw ls lt lu lv bi translated">首先，我们来探究一下数据！</h2><p id="c19b" class="pw-post-body-paragraph kf kg iq kh b ki lw jr kk kl lx ju kn ko ly kq kr ks lz ku kv kw ma ky kz la ij bi translated">主要数据来源于Instacart的2017年匿名化客户随时间的订单(Stanley，2017)。它包含订单文件、产品文件、订单和产品文件、过道文件和部门文件。数据集中的每个实体都有一个关联的唯一id。</p><p id="3347" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在订单数据集中，它包含用户id、订单id、订单购买日期(order_dow)、订单购买时间(order_hour_of_the_day)、自上次购买以来的天数(day_since_prior)以及订单所属的指示符(eval_set)。如果是第一次购买，则自上次购买后的天数为NaN。在部门数据集中，它包含唯一的部门id和关联的部门名称。在过道数据集中，它有过道id和过道名称。在产品数据集中，它包含产品id、产品名称、过道id和部门id。</p><p id="5455" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了制定用户订单的时间间隔，我们首先以天为单位划分用户订单。我们这里使用的数据是order.csv，列名为“dow”。从图1来看，用户订单最多的日子是第0天和第1天。查看数据说明后，我们没有找到第0天到第6天的定义。我们认为0和1这两个繁忙的日子应该是周日和周一。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/e0b54643adb2f374eea6e74345714a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/0*_Kged-7Y22_Cg7uS"/></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">图1(作者图片)</p></figure><p id="7e8d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了更详细的视图，我们选择小时作为单位来绘制订单频率条形图。两条尾巴表明Instacart在早上和傍晚时间没有太多的交付。大多数订单是在时间间隔小时[9，16]下的，平均每小时约有25000个订单。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/8d9f2fbbf1c4f14a10b0de0063834381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uXFSHxeacFHykL3y"/></div></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">图2(作者图片)</p></figure><p id="26e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结合上面的两个数字，我们决定使用热图来检查最受欢迎的订单时间。y轴是按天计数的订单，x轴是按小时计数的订单。从图3来看，较暗的部分意味着用户订单密度较高的时间段，大约是第0天和第1天的上午9点到下午4点。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi ms"><img src="../Images/e6125e8e59dd4cced775432eb19d7590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/0*0H1DsMv0q6Z6T8FW"/></div></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">图3(作者图片)</p></figure><p id="a53e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图4显示了下降趋势。大部分用户在频率区间[0，40]下单。少数用户订单在60以上。超过100的唯一订单被计为一组。x轴限制了将所有计数订单放在一个图表上。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/ac435242e4c48f6f0075b6abb209c4ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*Uxj0B3e9dQv1nJQP"/></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">图4(作者图片)</p></figure><p id="dd76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个有趣的发现是，从图5中，我们发现超过400，000个用户可能会将香蕉添加到他们的订单中。名单上大部分产品都是有机蔬菜和水果！</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mu"><img src="../Images/28e58fb127ca9d680668ab8e639e5664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mh45Ds5hgkr5rKBK"/></div></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">图5(作者图片)</p></figure><h1 id="8856" class="mv le iq bd lf mw mx my li mz na nb ll jw nc jx lo jz nd ka lr kc ne kd lu nf bi translated">机器学习建模:</h1><p id="aade" class="pw-post-body-paragraph kf kg iq kh b ki lw jr kk kl lx ju kn ko ly kq kr ks lz ku kv kw ma ky kz la ij bi translated"><strong class="kh ir">K-表示:</strong></p><p id="dc61" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基于EDA的结果，很可能得出这样的结论:消费者更有可能在上午10点到下午4点之间购买。此外，如图所示，在第0天和第1天，Instacart的交易量与其他日期相比相对较高。为了进一步了解消费者的购买行为并进行具体的消费者细分，我们使用了k-means聚类。不仅基于在星期几、星期几购买的订单，还基于自上次购买以来的天数和添加到购物车订单，来计算每个用户使用Instacart的频率和每个订单购买的商品的中位数。</p><p id="4ce9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，利用轮廓得分选择k-means中的最佳聚类数。</p><p id="5427" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于处理量大，我们对5%的数据集(超过10，000条用户记录)进行了五次采样，以生成训练数据集的准确轮廓分数。正如它所建议的，我们在k-means算法中设置了3个聚类。在应用PCA降低维度之后，我们能够绘制每个聚类(图6)。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/00c5d811f42d8b84b4fe5a641b1935d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/0*r5qQ396SV8SONbnB"/></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">图6(作者图片)</p></figure><p id="9a3d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">随机森林:</strong></p><p id="3ee7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在进行k-means聚类和标记数据后，我们使用聚类0，1，2来训练我们的第一个K-means模型。我们希望将我们的模型从无监督学习转移到有监督学习。因此，我们将数据集分为训练样本和测试样本。通过使用GridSearchCV，我们发现应该使用21作为我们的估计量，使用97作为我们的最大叶节点。<strong class="kh ir">在训练我们的模型并拟合测试集之后，</strong>我们计算了多类别ROC AUC得分，该得分为0.999，这意味着我们的随机森林模型很好地分离了三个类别。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5485f4c703a55029393dfb4f419d1e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/0*mKpUklzflJYErYrL"/></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">特征重要性(作者图片)</p></figure><p id="8114" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">推荐系统</strong></p><p id="9af2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的推荐系统模型中，输出是大多数其他客户会购买但输入客户不经常购买的部门和通道。由于输出不仅基于大多数训练数据，而且基于输入客户购买历史的皮尔逊相似性，我们的模型考虑了不同组的客户偏好。</p><p id="d374" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">出于节省时间和计算的原因，我们使用来自前10，000个用户的数据来训练我们的模型。通过从每个集群中随机抽取5个用户作为输入，结果证明了我们的假设。对于每个集群中的5个用户和5个推荐的部门和通道，我们在25个值中寻找共享最多的前3个常用名称。</p><p id="0cf9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">推荐部门:</p><ul class=""><li id="5e0d" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">第0类:酒精、散装、婴儿</li><li id="11f7" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">第1类:酒、干粮和散装面食</li><li id="e5e6" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">第2组:酒类、散装、肉类和海鲜</li></ul><p id="ad7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">推荐过道:</p><ul class=""><li id="758a" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">第0类:面部护理、皮肤护理、头发护理</li><li id="4def" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">集群1:散装谷物大米干货，面部护理，皮肤护理</li><li id="293e" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">第二组:护肤、烈酒、面部护理</li></ul><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nw"><img src="../Images/82a640c8fa28aefea70a792304d8f04e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lobMBMsmQBhxSspCJDPMOw.png"/></div></div></figure><p id="23e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从该表中，我们可以看出，集群0和集群1中的客户(占总用户的64.6%)是Instacart的忠实用户，他们可能有很高的需求，并在新冠肺炎期间给Instacart的运营带来巨大压力。</p></div></div>    
</body>
</html>