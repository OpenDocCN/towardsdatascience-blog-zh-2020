<html>
<head>
<title>Create TFRecords Dataset and use it to train an ML model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建TFRecords数据集并使用它来训练ML模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-tfrecords-dataset-and-use-it-to-train-an-ml-model-da26fe9f0c2c?source=collection_archive---------14-----------------------#2020-10-01">https://towardsdatascience.com/create-tfrecords-dataset-and-use-it-to-train-an-ml-model-da26fe9f0c2c?source=collection_archive---------14-----------------------#2020-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dbaa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有益于处理顺序学习模型的人</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5f523d158832768bb92de8c2bd8dd46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PU5ZrD6SfxDKycpNMuOd1w.png"/></div></div></figure><p id="a48c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">嗨，极客们，</p><p id="ada3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">希望你一切安好。</p><p id="eec0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个故事中，你将了解到。什么是TFRecords？<br/> 2。如何将数据保存为tfrecords文件？<br/> 3。提取TFRecord数据。<br/> 4。如何使用tfrecord中的数据集来训练模型？</p><p id="60d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">PS——如果你只是来拿代码的话。从<a class="ae lq" href="https://github.com/Raghavsharma15832/Useful/blob/master/train_from_tfrecord.py" rel="noopener ugc nofollow" target="_blank">这里</a>开始享用吧！</p><h1 id="20d1" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">什么是TFRecords？</h1><p id="dbc7" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">TFRecord是一种Tensorflow格式，用于存储二进制记录序列。除了顺序数据，TFrecord还可以用于存储图像和1D矢量。在本文中，我们将看到如何存储和读取以下类型的数据:<br/> (i) Integer。(int64，uint8等。)<br/>(二)花车。<br/>(三)琴弦。<br/>(四)图像。<br/> TFRecord只能按顺序读写。因此，它通常被用于序列模型，如RNN，LSTM等。但这并不意味着我们只能用它来进行连续学习。</p><h1 id="ba31" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">如何将数据保存为tfrecords文件？</h1><p id="e044" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">要将任何数据存储到tfrecords，我们首先需要创建TensorFlow示例。这些张量流示例可以使用<em class="mo"> tf.train.examples </em>函数创建。这个函数将创建一个包含一些特性的示例对象。代码如下-</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="22d8" class="mu ls it mq b gy mv mw l mx my">example = tf.train.Example(features = tf.train.Features(feature = {        }))</span></pre><p id="b044" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">功能中应该有什么？</strong></p><p id="2bb9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些特征包含我们的图像、数据，还包含该数据的文件名。如果有人使用监督算法，图像的相应标签也会出现在特征中。因此，创建特征的典型代码是—</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c50b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意- </strong>图像和相应的标签已经以字节格式保存。</p><p id="a8ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们创建了一个图像的例子，我们需要把它写入一个trfrecord文件。这些可以使用tfrecord writer来完成。下面代码中的tfrecord_file_name是我们要存储图像的tfrecord的文件名。TensorFlow会自动创建这些文件。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="436c" class="mu ls it mq b gy mv mw l mx my">writer = tf.python_io.TFRecordWriter(tfrecord_file_name)<br/>writer.write(example.SerializeToString())</span></pre><p id="e336" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">存储图像的代码</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="1f69" class="lr ls it bd lt lu ni lw lx ly nj ma mb jz nk ka md kc nl kd mf kf nm kg mh mi bi translated">提取TFRecord数据</h1><p id="d373" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">如果你知道写它们的正确方法，读tfrecord文件就简单多了。过程是一样的。首先，我们需要创建一个用于编写rfrecord文件的特性字典。然后我们将使用<em class="mo">TF . train . tfrecorddataset</em>函数创建一个dataset对象。</p><p id="fe86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建数据集对象后，我们将使用下面给出的代码将该数据集对象映射到我们想要的数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ce8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面这段代码中，函数<em class="mo"> _extract_fn </em>将数据集映射到我们想要的东西的列表中(文件名、图像、标签、图像形状)。为此，我们首先解析我们在tfrecords生成过程中制作的示例。解析之后，我们需要使用<em class="mo"> tf.io.decode_raw() </em>函数将解析后的示例解码成图像。</p><h1 id="b715" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">如何使用tfrecord中的数据集来训练模型？</h1><p id="af0a" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">为了使用从tfrecord提取的数据来训练模型，我们将在dataset对象上创建一个迭代器。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="6155" class="mu ls it mq b gy mv mw l mx my">iterator = tf.compat.v1.data.make_initializable_iterator(batch_dataset)</span></pre><p id="9552" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建这个迭代器后，我们将循环进入这个迭代器，这样我们就可以在从这个迭代器中提取的每个图像上训练模型。函数<em class="mo"> extract_image </em>通过使用iterator.get_next()对tfrecord中出现的每个图像执行此操作。关于这个函数，请参考下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="e8aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">希望你现在对tfrecord有所了解，以及我们如何利用它们来训练模型。</p><p id="de8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编码快乐！</p></div></div>    
</body>
</html>