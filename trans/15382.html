<html>
<head>
<title>The Debate Drinking Game, with data science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">辩论喝酒游戏，用数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-debate-drinking-game-with-data-science-7a0c0692e5a?source=collection_archive---------34-----------------------#2020-10-22">https://towardsdatascience.com/the-debate-drinking-game-with-data-science-7a0c0692e5a?source=collection_archive---------34-----------------------#2020-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c231" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用文本挖掘技术分析特朗普、拜登的演讲</h2></div><p id="b1b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新冠肺炎可能取消了我们的现场辩论观看派对，但这并没有阻止我们用它来做一个饮酒游戏！在我最新的Youtube视频中，我使用文本挖掘技术为即将到来的总统辩论开发了<em class="lc">终极</em>数据驱动的饮酒游戏规则。这篇文章将带你了解我是如何做到的。</p><p id="57d2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我从竞选集会、演讲和过去几周发生的任何其他活动中搜集了一些抄本，这些活动中拜登或特朗普(或两者都有！)说话了。我搜集的完整事件列表可以在这个项目的<a class="ae lb" href="https://github.com/vastava/data-science-projects/tree/master/debate-drinking-game" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中看到(见“辩论. csv”文件)。</p><p id="3ad3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我从rev.com那里刮来了成绩单(在他们的允许下！)因为它似乎有最详尽的2020年选举事件列表，还因为文字记录遵循标准化格式，这使得收集过程更容易。下面是我用来刮抄本的函数:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="c093" class="lm ln iq li b gy lo lp l lq lr">def scrapeTranscriptFormat1(url, sep):<br/>    html = requests.get(url)<br/>    html = html.text<br/>    bs = BeautifulSoup(html, "lxml")<br/>    paragraphs = bs.findAll("p")<br/>    for paragraph in paragraphs:<br/>        try:<br/>            paragraph.find('u').decompose()<br/>        except:<br/>            continue<br/>    speaker = []<br/>    speech = []<br/>    pattern = r'\[.*?\]'</span><span id="8ef8" class="lm ln iq li b gy ls lp l lq lr">    for paragraph in paragraphs:<br/>        try:<br/>            speechText = paragraph.text.replace(u'\xa0', u'') <br/>            speechText = re.sub(pattern, '', speechText) <br/>            if sep == "parenthesis":<br/>                speech.append(re.search("[0-9]{2}\)[\r\n]+(.*)", speechText).group(1).strip(" ")) <br/>            else:<br/>                speech.append(re.search(":[\r\n]+(.*)", speechText).group(1).strip(" ")) # search for speaker's speech, append to list<br/>            speaker.append(re.search("^(.*?):", speechText).group(1)) # search for speaker name, append to list            <br/>        except:<br/>            continue<br/>    return pd.DataFrame({'name': speaker, 'speech': speech})</span></pre><p id="949c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的函数接受两个参数——rev.com上的脚本的URL和“分隔符”“分隔符”是指用来表示每行发言人的字符；对于大多数抄本，分隔符是“括号”(例如，遵循下面的格式)。</p><blockquote class="lt lu lv"><p id="6136" class="kf kg lc kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">克里斯·华莱士:(<a class="ae lb" href="https://www.rev.com/transcript-editor/shared/C-8bDp99BJeCjsjMD_TLZx3mzKMYLQlRNcIpn01gIDIitp25MT_XakH7HIktIkzYjsjgbemzC1JlO5zsFuPOVzteEGE?loadFrom=PastedDeeplink&amp;ts=80.33" rel="noopener ugc nofollow" target="_blank"> 01:20 </a> ) <br/>晚上好，来自……的健康教育校园</p></blockquote><p id="8c79" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果分隔符不是括号，我假设我写的正则表达式假设它是一个冒号(例如，遵循下面的格式)。根据抄本的格式，您可能需要修改正则表达式。</p><blockquote class="lt lu lv"><p id="3c7e" class="kf kg lc kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">克里斯·华莱士:<br/>晚上好，来自……的健康教育校园</p></blockquote><p id="8751" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">scraping函数应该返回一个类似于下面的数据帧。</p><figure class="ld le lf lg gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi lz"><img src="../Images/07814047256e2fc68b4051deae8029c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OgMk-y30kVGVnmQBJb8IHA.png"/></div></div><p class="mh mi gj gh gi mj mk bd b be z dk translated">抄本的数据框架。图片作者。</p></figure><p id="ed58" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你收集了所有的抄本并连接了数据框架，我们就可以开始文本分析了！</p><p id="2c11" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在开始语篇分析之前，我们必须准备好数据框架。尽管我是从同一个网站上搜集来的文字记录，但命名惯例并不一致——例如，拜登有时被称为“乔·拜登”，有时被称为“副总统乔·拜登”</p><p id="cc99" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我只是在dataframe的“name”列上调用了pd.unique()，这样我就可以看到每个候选人的所有名字变化。然后，我创建了一个字典，并使用pd.replace()替换所有这些变体。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="cd06" class="lm ln iq li b gy lo lp l lq lr">name_variations = {"name": <br/>                   {<br/>                     'Chris Wallace':"moderator", 'Vice President Joe Biden':"Joe Biden",<br/>       'President Donald J. Trump':"Donald Trump", 'Moderator':"moderator", 'Ilia Calderón':"moderator",<br/>       'Joe Biden':"Joe Biden", 'Bernie Sanders':"bernie", 'Dr. Sanjay Gupta':"moderator",<br/>       'Amy Langenfeld':"moderator", 'John':"moderator", 'Donald Trump':"Donald Trump", 'President Trump':"Donald Trump",<br/>       'Hannah Cannon':"moderator", 'President Donald Trump':"Donald Trump", 'Justin Gaethje':"moderator"<br/>                       <br/>                   }<br/>                }<br/>                      <br/>df.replace(name_variations, inplace=<strong class="li ir">True</strong>)</span></pre><p id="bbfe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后可以使用下面的“getSpeech”函数和代码来构造语料库。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="63bc" class="lm ln iq li b gy lo lp l lq lr">def getSpeech(name):<br/>    candidate = df[df['name']==name].reset_index()<br/>    candidateSpeech = ""<br/>    for row in range(0,len(candidate)):<br/>        candidateSpeech = candidateSpeech + " " + candidate['speech'][row]<br/>    return candidateSpeech<br/>    candidateSpeech = candidateSpeech.translate(str.maketrans('', '', string.punctuation))<br/>    candidateSpeech = candidateSpeech.strip(" ")<br/>    stop_words = set(stopwords.words('english')) <br/>    word_tokens = word_tokenize(candidateSpeech)<br/>    filtered_sentence = [w for w in word_tokens if not w in stop_words]<br/>    filtered_sentence = []<br/>    for w in word_tokens: <br/>        if w not in stop_words: <br/>            filtered_sentence.append(w)<br/>    return ' '.join(word.lower() for word in filtered_sentence)</span><span id="010b" class="lm ln iq li b gy ls lp l lq lr">biden = getSpeech("Joe Biden") <br/>trump = getSpeech("Donald Trump") <br/>moderator = getSpeech("moderator")  corpus = {'Moderator': moderator, 'Biden':biden, 'Trump':trump}</span></pre><p id="6a37" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我使用sklearn库来计算“tf-idf”统计数据。Tf-Idf代表术语频率-逆文档频率，是计算单词重要性的好方法。它不仅考虑了短语的频率，还贬低了两位候选人可能会说的一般短语(如“谢谢你的问题……”)，这确保了最后的短语将是特朗普或拜登独有的。</p><p id="10f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在计算了语料库中每个对象的tf-idf分数并转换了列之后，您将得到如下所示的数据帧:</p><div class="ld le lf lg gt ab cb"><figure class="ml ma mm mn mo mp mq paragraph-image"><img src="../Images/e9a06ecb7efc02e400a10a85844fb67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*6eMWicUf5bcvtLdlniu0IQ.png"/></figure><figure class="ml ma mr mn mo mp mq paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><img src="../Images/3a31855fb3aa371ed8099da2b12cf887.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*GVg3hGYq6moUA2-wAFJfKQ.png"/></div><p class="mh mi gj gh gi mj mk bd b be z dk ms di mt mu translated">左:特朗普的得分短语。右图:拜登的得分短语。作者图片。</p></figure></div><p id="587a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有几点需要注意:首先，这个脚本只识别三到四个单词短语(不包括停用词)。因此，像“a”、“to”和“the”这样的词被删除了，这使得一些短语变得难以理解。例如，“don know don”的完整短语是“我不知道，我不知道。”“竞选自豪的民主党人”的完整短语是“作为一个自豪的民主党人竞选。”</p><p id="27b6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二，输出数据帧中的这些短语只有三或四个单词长，这一事实会带来许多问题。这意味着关键的词可能会被省略——“提高税收”的完整短语实际上是“<em class="lc">而不是</em>提高税收。”这也意味着较长的短语可能会被分成较小的块，并且在表中出现过多。拜登更常用的一句话是“上帝保佑你们所有人，愿上帝保护军队”，这句话被分成数据框中的第7、9、10和11行。</p><p id="36a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，tf-idf分数并不表示<em class="lc">频率</em>——它是一个短语的频率和唯一性的组合。这就是为什么“谢谢，谢谢，谢谢”这个词在两位候选人身上都出现了——它不是唯一的，但被说了很多次，以至于出现在了前10名中。尽管它是最常见的，但它并不在列表的首位。(值得注意的是，拜登和川普<em class="lc">都没有说过这句话。它指的是当主持人说“谢谢你，总统先生。谢谢主席。谢谢您…。”当候选人随时间推移)。</em></p><p id="723b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了计算每个短语被说了多少次，你必须手动浏览你的辩论记录CSV。或者至少，我是这么做的。</p><p id="dba8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在清理替换停用词和按频率重新排序短语后，我们终于有了周四总统辩论的饮酒游戏规则！</p><div class="ld le lf lg gt ab cb"><figure class="ml ma mv mn mo mp mq paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><img src="../Images/421fa18e73e35737bf063b20943d5f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*WrineuBJMY98x4eQs_Uuwg.png"/></div></figure><figure class="ml ma mv mn mo mp mq paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><img src="../Images/26014adda0a3e928dbf05e8b5b2584dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*V_yxQZ5EIwEfr_VH48cypA.png"/></div><p class="mh mi gj gh gi mj mk bd b be z dk mw di mx mu translated">左:拜登的饮酒游戏规则。右图:为川普制定饮酒游戏规则。作者图片。</p></figure></div><p id="0d25" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对其中一些短语感到困惑？我在我的视频中解释了这些短语背后的背景，看看吧！</p><figure class="ld le lf lg gt ma"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="694e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喝酒开心！请记得喝酒(还有投票！)负责任。</p></div></div>    
</body>
</html>