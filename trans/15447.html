<html>
<head>
<title>3 Python Tricks to Read, Create, and Run Multiple Models Automatically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动读取、创建和运行多个模型的3个Python技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-python-tricks-to-read-create-and-run-multiple-files-automatically-5221ebaad2ba?source=collection_archive---------2-----------------------#2020-10-24">https://towardsdatascience.com/3-python-tricks-to-read-create-and-run-multiple-files-automatically-5221ebaad2ba?source=collection_archive---------2-----------------------#2020-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cbc9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Python和Bash For Loop自动化枯燥的东西</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9b58d1bcecf2bc9cd07984ed2dacd16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aB3nbWna6nPec8sN"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@sincerelymedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">真诚媒体</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="3712" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">动机</h1><p id="4c2b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">将代码投入生产时，您很可能需要组织代码文件。读取、创建和运行许多数据文件非常耗时。本文将向您展示如何自动</p><ul class=""><li id="7d4c" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated">遍历目录中的文件</li><li id="7a11" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">如果嵌套文件不存在，则创建嵌套文件</li><li id="3dec" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">使用bash for循环运行一个具有不同输入的文件</li></ul><p id="348c" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">这些技巧让我在从事数据科学项目时节省了大量时间。我希望你也会发现它们很有用！</p><h1 id="5d29" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">遍历目录中的文件</h1><p id="aa41" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果我们有多个数据要像这样读取和处理:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="f0e4" class="ni kx iq ne b gy nj nk l nl nm">├── data<br/>│   ├── data1.csv<br/>│   ├── data2.csv<br/>│   └── data3.csv<br/>└── main.py</span></pre><p id="c9ee" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">我们可以尝试一次手动读取一个文件</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c332" class="ni kx iq ne b gy nj nk l nl nm">import pandas as pd </span><span id="f220" class="ni kx iq ne b gy nn nk l nl nm">def process_data(df):<br/>   pass</span><span id="6b0b" class="ni kx iq ne b gy nn nk l nl nm">df = pd.read_csv(data1.csv)<br/>process_data(df)</span><span id="cfad" class="ni kx iq ne b gy nn nk l nl nm">df2 = pd.read_csv(data2.csv)<br/>process_data(df2)</span><span id="ee25" class="ni kx iq ne b gy nn nk l nl nm">df3 = pd.read_csv(data3.csv)<br/>process_data(df3)</span></pre><p id="aaa8" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">当我们有3个以上的数据时，这种方法是可行的，但效率不高。如果我们在上面的脚本中唯一改变的是数据，为什么不使用for循环来访问每个数据呢？</p><p id="28d8" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">下面的脚本允许我们遍历指定目录中的文件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="dfbd" class="ni kx iq ne b gy nj nk l nl nm">data/data3.csv<br/>data/data2.csv<br/>data/data1.csv</span></pre><p id="b539" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">以下是对上述脚本的解释</p><ul class=""><li id="251c" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated"><code class="fe nq nr ns ne b"><em class="nt">for</em> filename <em class="nt">in</em> os.listdir(<em class="nt">directory</em>)</code>:遍历特定目录下的文件</li><li id="b6b8" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><code class="fe nq nr ns ne b">if filename.endswith(".csv")</code>:访问以'结尾的文件。csv '</li><li id="83e9" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated"><code class="fe nq nr ns ne b">file_directory = os.path.join(<em class="nt">directory</em>, filename)</code>:连接父目录(‘数据’)和目录内的文件。</li></ul><p id="44b2" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">现在我们可以访问“数据”目录中的所有文件了！</p><h1 id="575d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">如果嵌套文件不存在，则创建嵌套文件</h1><p id="a6f8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时我们可能想要创建嵌套文件来组织我们的代码或模型，这使得我们将来更容易找到它们。例如，我们可以使用“模型1”来指定特定的特征工程。</p><p id="7dcc" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">在使用模型1时，我们可能希望使用不同类型的机器学习模型来训练我们的数据(“模型1/XGBoost”)。</p><p id="08a6" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">在使用每个机器学习模型时，由于模型使用的超参数的差异，我们甚至可能希望保存模型的不同版本。</p><p id="4917" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">因此，我们的模型目录可能看起来像下面这样复杂</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5c64" class="ni kx iq ne b gy nj nk l nl nm">model<br/>├── model1<br/>│   ├── NaiveBayes<br/>│   └── XGBoost<br/>│       ├── version_1<br/>│       └── version_2<br/>└── model2<br/>    ├── NaiveBayes<br/>    └── XGBoost<br/>        ├── version_1<br/>        └── version_2</span></pre><p id="f02a" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">为我们创建的每个模型手动创建一个嵌套文件可能会花费我们很多时间。有没有一种方法可以让这个过程自动化？是的，用<code class="fe nq nr ns ne b">os.makedirs(datapath).</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="fefe" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">运行上面的文件，您应该看到自动创建的嵌套文件“model/model2/XGBoost/version_2 ”!</p><p id="604f" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">现在您可以将您的模型或数据保存到新目录中了！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><h1 id="24fb" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">Bash for循环:用不同的参数运行一个文件</h1><p id="ec94" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果我们想用不同的参数运行一个文件呢？例如，我们可能希望使用相同的脚本来预测使用不同模型的数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="e41b" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">如果一个脚本需要很长时间来运行，并且我们有多个模型要运行，那么等待脚本运行完毕然后运行下一个脚本将会非常耗时。有没有办法让电脑运行模型1，2，3，..，10，然后去做别的事情。</p><p id="7139" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">是的，我们可以用for bash for loop。首先，我们使用<code class="fe nq nr ns ne b">sys.argv</code>来解析命令行参数。如果你想在命令行中覆盖你的配置文件，你也可以使用像<a class="ae kv" href="https://hydra.cc/" rel="noopener ugc nofollow" target="_blank"> hydra </a>这样的工具。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5159" class="ni kx iq ne b gy nj nk l nl nm">&gt;&gt;&gt; python train.py XGBoost 1<br/>Loading model from model/model1/XGBoost/version_1 for training</span></pre><p id="eb0c" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">太棒了。我们刚刚告诉我们的脚本使用模型XGBoost，版本1来预测命令行上的数据。现在我们可以使用bash for循环遍历模型的不同版本。</p><p id="6d88" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">如果你可以用Python做for循环，你也可以在终端上这样做，如下所示</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="f369" class="ni kx iq ne b gy nj nk l nl nm">$ for version in 2 3 4<br/>&gt; do<br/>&gt; python train.py XGBoost $version<br/>&gt; done</span></pre><p id="4d4b" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">键入Enter来分隔各行</p><p id="f294" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">输出:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="4316" class="ni kx iq ne b gy nj nk l nl nm">Loading model from model/model1/XGBoost/version_1 for training<br/>Loading model from model/model1/XGBoost/version_2 for training<br/>Loading model from model/model1/XGBoost/version_3 for training<br/>Loading model from model/model1/XGBoost/version_4 for training</span></pre><p id="44a9" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">现在，您可以在让您的脚本使用不同的模型运行的同时做其他事情！多方便啊！</p><h1 id="03e9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="8104" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">恭喜你！您刚刚学习了如何一次自动读取和创建多个文件。您还学习了如何使用不同的参数运行一个文件。现在，您可以将手动读取、写入和运行文件的时间节省下来，用于更重要的任务。</p><p id="6d8f" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">如果你对文章中的某些部分感到困惑，我在这个<a class="ae kv" href="https://github.com/khuyentran1401/Data-science/tree/master/python/python_tricks" rel="noopener ugc nofollow" target="_blank">回购</a>中创建了具体的例子。</p><p id="9863" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在<a class="ae kv" href="https://www.linkedin.com/in/khuyen-tran-1ab926151/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae kv" href="https://twitter.com/KhuyenTran16" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我。</p><p id="25dc" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx na lz ma mb nb md me mf nc mh mi mj ij bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="nu nv gp gr nw nx"><a rel="noopener follow" target="_blank" href="/how-to-get-a-notification-when-your-training-is-complete-with-python-2d39679d5f0f"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">使用Python获得通知的3种方式</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">现在，您可以在等待培训完成的同时从事其他项目</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kp nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a rel="noopener follow" target="_blank" href="/how-to-create-reusable-command-line-f9a2bb356bc9"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">如何创建可重用的命令行</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">你能把你的多个有用的命令行打包成一个文件以便快速执行吗？</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol kp nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a rel="noopener follow" target="_blank" href="/how-to-create-fake-data-with-faker-a835e5b7a9d9"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">如何用Faker创建假数据</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">您可以收集数据或创建自己的数据</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="on l oi oj ok og ol kp nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a rel="noopener follow" target="_blank" href="/cython-a-speed-up-tool-for-your-python-function-9bab64364bfd"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">cy thon——Python函数的加速工具</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">当调整你的算法得到小的改进时，你可能想用Cython获得额外的速度，一个…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="oo l oi oj ok og ol kp nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a rel="noopener follow" target="_blank" href="/timing-the-performance-to-choose-the-right-python-object-for-your-data-science-project-670db6f11b8e"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">高效Python代码的计时</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">如何比较列表、集合和其他方法的性能</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="op l oi oj ok og ol kp nx"/></div></div></a></div></div></div>    
</body>
</html>