<html>
<head>
<title>Reinforcement Learning based Energy Optimization in Factories</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于强化学习的工厂能源优化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reinforcement-learning-based-energy-optimization-dea8fb687cda?source=collection_archive---------10-----------------------#2020-11-14">https://towardsdatascience.com/reinforcement-learning-based-energy-optimization-dea8fb687cda?source=collection_archive---------10-----------------------#2020-11-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="35a1" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">面向可持续未来的工厂暖通空调优化</h2></div><p id="19aa" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><strong class="kl iv"> <em class="lf">摘要。</em> </strong> <em class="lf">供暖、通风和空调(HVAC)单位负责维持建筑物内的温度和湿度设置。研究表明，暖通空调占建筑能耗的近50%，占全球用电量的10%。因此，暖通空调优化有可能为我们的可持续发展目标做出重大贡献，减少能耗和二氧化碳排放。在这项工作中，我们探索优化工厂HVAC控制的方法。不幸的是，这是一个复杂的问题，因为它需要考虑多个可变因素来计算最佳状态，例如，占用、制造进度、运行机器的温度要求、建筑物内的气流动态、外部天气条件、节能等。我们提出了一种基于强化学习(RL)的能源优化模型，该模型已在我们的工厂中得到应用。我们表明RL是一个很好的选择，因为它能够实时学习和适应多参数系统动力学。它比以前使用的比例-积分-微分(PID)控制器节能约25%。</em></p><p id="b43d" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这篇论文的<strong class="kl iv">发表版本</strong>如下，发表在2020年6月第11届美国计算机学会电子能源会议论文集(<a class="ae lg" href="https://www.slideshare.net/DebmalyaBiswas/reinforcement-learning-based-hvac-optimization-in-factories-238645532" rel="noopener ugc nofollow" target="_blank">PPT</a>)<a class="ae lg" href="https://dl.acm.org/doi/10.1145/3396851.3402363" rel="noopener ugc nofollow" target="_blank">https://dl.acm.org/doi/10.1145/3396851.3402363</a></p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj lh"><img src="../Images/eb13c2581b835257269f9b0562625eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9mPJ8_eCjC_N9Xu1"/></div></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图一。可持续发展的能源优化(来自<a class="ae lg" href="https://www.pexels.com/photo/sky-clouds-building-industry-39553/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae lg" href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>摄影)</p></figure><h1 id="6e90" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">1导言</h1><p id="676c" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">供暖、通风和空调(HVAC)装置负责维持建筑物内的温度和湿度设置。在这项工作中，我们特别考虑了它们在工厂中的使用，其中HVAC装置的主要目标是将温度和(相对)湿度保持在规定的制造公差范围内。这需要与节能和减少二氧化碳排放相平衡，以抵消运行它们对环境的影响。</p><blockquote class="mu"><p id="92fa" class="mv mw iu bd mx my mz na nb nc nd le dk translated">因为它们不仅普遍存在于工厂，而且存在于家庭和办公楼中；任何有效的控制逻辑都有可能对环境影响做出重大贡献。不幸的是，考虑到HVAC单元的复杂性，设计有效的控制逻辑是一个困难的优化问题。</p></blockquote><p id="da11" class="pw-post-body-paragraph kj kk iu kl b km ne jv ko kp nf jy kr ks ng ku kv kw nh ky kz la ni lc ld le in bi translated">控制逻辑需要考虑多个可变因素，例如，占用、制造进度、运行机器的温度要求、建筑物内的气流动态、外部天气条件、节能等。；以便决定该区域的加热、冷却或湿度。</p><p id="df9b" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">HVAC优化文献可以大致分为两类:(I)了解优化参数之间的循环模式，以更好地调度HVAC功能，以及(ii)建立HVAC单元的模拟模型，并评估模型上的不同控制策略，以确定最有效的策略。</p><p id="8e85" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">第一类的例子包括[1，2]，其采用建筑热力学模型来预测建筑的温度演变。不幸的是，这并不真正适用于我们的工厂，那里的制造工作量每天都在变化，而且没有可以预测的时间表。另外值得一提的是，大多数此类模型每次只考虑一个优化参数，即控制加热/冷却来调节温度；而在我们的情况下，我们需要同时调节温度和(相对)湿度，以保持最佳的制造条件。</p><p id="ea73" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">第二类基于模型的方法适用于PID和RL控制器。PID(比例积分微分)控制器[3]使用控制回路反馈机制来控制过程变量。不幸的是，基于PID的控制器需要相对于基础HVAC单元进行大量的校准，以便能够有效地控制它们。[4]概述了一种基于模拟工具组合的PID校准方法。</p><p id="00aa" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">基于强化学习(RL) [5]的方法[6，7]最近被提出来解决这些问题，因为它们能够实时学习和优化多参数系统。基于RL的方法需要初始(离线)训练阶段，因为在实时设置(在线)中训练RL算法可能需要时间来收敛，从而在RL代理探索其状态空间时导致潜在的危险违反。[6，7]根据基于暖通空调装置模拟模型的EnergyPlus，概述执行该离线培训的解决方案。EnergyPlus [8]是美国能源部的一款开源HVAC模拟器，可用于模拟能耗(供暖、制冷、通风、照明、插头和过程负载)和建筑用水。不幸的是，开发HVAC单元的精确的基于能量+的仿真模型是一个重要的、耗时且昂贵的过程；因此是他们在离线训练中使用的一个障碍。</p><blockquote class="mu"><p id="39d8" class="mv mw iu bd mx my mz na nb nc nd le dk translated">在这项工作中，我们提出了一个有效的基于RL的HVAC优化算法，它能够在几周内学习并适应一个实时HVAC系统。该算法可以独立部署，或作为“训练模块”来生成可用于执行RL模型离线训练的数据，以进一步优化HVAC控制逻辑。这使得所开发的RL模型的部署快速且具有成本效益。</p></blockquote><p id="87e7" class="pw-post-body-paragraph kj kk iu kl b km ne jv ko kp nf jy kr ks ng ku kv kw nh ky kz la ni lc ld le in bi translated">此外,[6，7]中的模型输出是最佳温度和湿度设定值，这些设定值依赖于HVAC控制逻辑，以确保以有效的方式达到规定的设定值。在这项工作中，我们提出了一个更细粒度的RL模型，其输出是加热、冷却、再加热和加湿器单元的实际阀门打开百分比。这实现了一种更加自给自足的方法，RL输出绕过任何内置的HVAC控制逻辑(消除任何依赖性并使其冗余),从而实现更加独立于供应商(平台)的解决方案。</p><p id="5357" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">文章的其余部分组织如下:第2节介绍了基础知识，提供了暖通空调优化问题的RL公式。第3节概述了RL逻辑，其最初被部署来生成用于离线训练的训练数据，从而导致第4节中的(训练的)RL模型实时提供推荐的阀门打开百分比。在第5节中，我们提供了已开发的RL模型的一些基准测试结果，该模型已部署在我们的一个工厂区域中。初步研究表明，我们能够在现有PID控制器逻辑的基础上实现<em class="lf"> 25 </em> %的能效。第5节对论文进行了总结，并为未来的工作提供了方向。</p><h1 id="bdd1" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">2问题场景</h1><h1 id="52b5" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">2.1暖通空调</h1><p id="a2ad" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">图2显示了HVAC装置的能量平衡。简而言之，HVAC装置必须使再循环空气和新鲜空气的混合达到将区域温度和(相对)湿度保持在所需水平所需的温度和湿度。通过计算流出空气和流入空气的能量之差，很容易监控所需的理论能量，将该量与机组所需的能量进行比较，即可得出HVAC机组的能效。</p><p id="0932" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">能量流可以根据介质(空气、热水、冷水、蒸汽)的流量以及介质供应和回流之间的温差来确定。和消耗的电能。</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div class="gi gj nj"><img src="../Images/7f6330cbd56e86ad4f0866d24aaabc2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/0*fDM5Sx8sncsEtHus.png"/></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图二。暖通空调控制(图片由作者提供)</p></figure><h1 id="1f3f" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">2.2强化学习</h1><p id="55f1" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">RL指的是人工智能(AI)的一个分支，它能够通过实时最大化一个奖励函数来实现复杂的目标。奖励功能的工作原理类似于用糖果和打屁股来激励孩子，这样算法在做出错误决定时会受到惩罚，在做出正确决定时会受到奖励——这就是强化。有关RL框架的详细介绍，感兴趣的读者可以参考[5]。</p><h1 id="8836" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">2.3 RL公式</h1><p id="29a6" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">我们现在将场景映射到我们的HVAC设置。在任何时间点，工厂区域都处于以区域内外观察到的温度和(相对)湿度值为特征的状态。</p><p id="57aa" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">在这种情况下，游戏规则对应于温度和湿度的容许水平，其基本要求区域温度和湿度值应分别在:<em class="lf">19–25</em>度和<em class="lf">45–55</em>%的范围内。在这种情况下，可用的动作集是冷却、加热、再加热和加湿器阀门打开百分比(%)。</p><p id="fd58" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">总的来说，根据(内部和外部)温度和湿度值给定区域状态，RL模型需要决定将冷却、加热、再加热和加湿器阀门打开多少。为了在这种情况下做出明智的决定，RL模型需要首先了解HVAC系统的行为，例如通过将冷却阀打开到<em class="lf"> X </em> %,可以预期区域温度下降多少？</p><p id="f459" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">一旦RL模型理解了HVAC系统的行为，最后一步是设计控制策略，或RL术语中的“策略”。例如，RL模型现在必须选择是否在区域温度达到<em class="lf"> 23 </em>度时将冷却阀打开至25%，或者等到区域温度达到<em class="lf"> 24 </em>度时再将冷却阀打开至<em class="lf"> 40 </em> %。注意，在打开阀门之前等待的时间越长，对降低能耗有积极的作用；然而，由于外部天气条件总是不可预测的，这就有违反温度/湿度耐受水平的风险。因此，如果等待时间更长，它可能实际上不得不将冷却阀打开到更高的百分比，从而消耗更多的能量。上述概率由RL术语中的奖励函数(等式1)量化，该函数基于以下三个参数为每个可能的行为分配奖励:</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj nk"><img src="../Images/cfff678ddc46cd517c5a70853f5ae31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13OdXivb3ZIakaSWf-qkbg.png"/></div></div></figure><p id="3c9f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">控制策略是决定三个参数的权重:设定点接近度(SC)、能量成本(EC)、公差违反(TV)。能源成本体现在电力消耗和二氧化碳排放方面。例如,“安全”控制策略会为违反容差的行为分配非常高的负权重(惩罚),确保它们永远不会发生，尽管会付出更高的能源成本。同样,“能源优化政策”会将节能置于其他两个参数之上。设定值接近度鼓励“商业友好”政策，RL模型试图将区域温度保持在尽可能接近温度/湿度设定值的水平，这无疑降低了违规风险，但能源成本较高。</p><blockquote class="mu"><p id="b03a" class="mv mw iu bd mx my mz na nb nc nd le dk translated">我们选择“平衡”控制策略，最大化节能和设定值接近度，同时最小化违反公差的风险。</p></blockquote><p id="0c22" class="pw-post-body-paragraph kj kk iu kl b km ne jv ko kp nf jy kr ks ng ku kv kw nh ky kz la ni lc ld le in bi translated">图3中示出了上述RL公式。</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div class="gi gj nl"><img src="../Images/58e4d6e1343cbbf3d33f34cdea05324e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/0*6jBUB7Fwao8x5V-Q.png"/></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图3。暖通空调强化学习公式(图片由作者提供)</p></figure><h1 id="4e17" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">基于3 RL的暖通空调优化</h1><blockquote class="mu"><p id="8b8f" class="mv mw iu bd mx my mz na nb nc nd le dk translated">我们概述了RL算法，该算法基于当前室内温度和湿度(在时间<em class="nm"> t </em>)以及先前的加热、冷却、加湿器、再加热阀打开百分比值、时间<em class="nm"> t-1 </em>的室内温度和湿度值，输出在时间<em class="nm"> t </em>打开加热、冷却、加湿器和再加热阀的程度。</p></blockquote><p id="3e98" class="pw-post-body-paragraph kj kk iu kl b km ne jv ko kp nf jy kr ks ng ku kv kw nh ky kz la ni lc ld le in bi translated"><em class="lf"> rl_hvac </em>功能运行，每隔<em class="lf"> 1 </em>分钟实时计算新的阀门开度值。</p><pre class="li lj lk ll gu nn no np nq aw nr bi"><span id="0fb6" class="ns ly iu no b gz nt nu l nv nw"><strong class="no iv">#input values:</strong><br/>i_tl #Indoor Temp (previous, at time t-1)<br/>i_hl #Indoor Humidity (previous)<br/>i_t  #Indoor Temp (current, at time t)<br/>i_h  #Indoor Humidity (current)<br/>y_hl #Heating Valve Opening (previous, at time t-1)<br/>y_ul #Humidifier Valve Opening (previous)<br/>y_rl #Re-heating Valve Opening (previous)<br/>y_cl #Cooling Valve Opening (previous)</span><span id="743c" class="ns ly iu no b gz nx nu l nv nw"><strong class="no iv">#output values:<br/></strong>y_h  #Heating Valve Opening (current, at time t)<br/>y_u  #Humidifier Valve Opening (current)<br/>y_r  #Re-heating Valve Opening (current)<br/>y_c  #Cooling Valve Opening (current)</span><span id="36d3" class="ns ly iu no b gz nx nu l nv nw"><strong class="no iv">#static variables:<br/></strong>hiW  #Heating step increment<br/>uiW  #Humidifier step increment<br/>riW  #Re-heating step increment<br/>ciW  #Cooling step increment</span><span id="179e" class="ns ly iu no b gz nx nu l nv nw"><em class="lf">#invoked every 1 min<br/></em><strong class="no iv"><em class="lf">rl_hvac</em></strong><em class="lf"> (i_tl, i_hl, i_t, i_h, y_hl, y_ul, y_rl, y_cl)</em></span><span id="b0b2" class="ns ly iu no b gz nx nu l nv nw"><strong class="no iv"># Heat and Humidify</strong><br/>if (i_t &lt; 22.0) and (i_h &lt; 50.0):    <br/>    if (i_t &lt; i_tl):<br/>        inc = hiW + abs((i_t - i_tl) / 0.1)<br/>        y_h += inc<br/>    if (i_h &lt; i_hl):<br/>        inc = uiW + abs((i_h - i_hl) / 0.1)<br/>        y_u += inc<br/>    y_r = 0.0<br/>    y_c = 0.0<br/><strong class="no iv"># Cool and Reheat</strong><br/>if (i_t &gt; 22.0) and (i_h &gt; 50.0):<br/>    if (i_t &gt; i_tl):<br/>        inc = ciW + abs((i_t - i_tl) / 0.1)<br/>        y_c += inc<br/>    if (i_h &gt; i_hl):<br/>        inc = riW + abs((i_h - i_hl) / 0.1)<br/>        y_r += inc<br/>    y_h = 0.0<br/>    y_u = 0.0<br/><strong class="no iv"># Heat, Cool and Reheat</strong><br/>if (i_t &lt; 22.0) and (i_h &gt; 50.0):<br/>    if (i_t &lt; i_tl):<br/>        inc = hiW + abs((i_t - i_tl) / 0.1)<br/>        y_h += inc<br/>    if (i_h &gt; i_hl):<br/>        inc = ((ciW + riW) / 2.0) + abs((i_h - i_hl) / 0.1)<br/>        y_c += inc<br/>        y_r += inc<br/>    y_u = 0.0<br/><strong class="no iv"># Cool and Humidify</strong><br/>if (i_t &gt; 22.0) and (i_h &lt; 50.0):<br/>    if (i_t &gt; i_tl):<br/>        inc = ciW + abs((i_t - i_tl) / 0.1)<br/>        y_c += inc<br/>    if (i_h &lt; i_hl):<br/>        inc = uiW + abs((i_h - i_hl) / 0.1)<br/>        y_u += inc<br/>    y_h = 0.0<br/>    y_r = 0.0</span><span id="2d9f" class="ns ly iu no b gz nx nu l nv nw"><strong class="no iv"><em class="lf">return</em></strong><em class="lf"> (y_h, y_u, y_r, y_c)</em></span></pre><p id="5d7e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">RL逻辑可以解释如下:回想一下，我们希望保持的温度和(相对)湿度设定值是<em class="lf"> 22 </em>度和<em class="lf"> 50 </em> %;允许公差范围分别为<em class="lf"> 3 </em>和<em class="lf"> 5 </em>。在每次迭代(<em class="lf"> 1 </em>分钟)时，<em class="lf"> rl-hvac </em>功能根据以下控制逻辑确定打开哪个阀门:</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div class="gi gj ny"><img src="../Images/e58085f2db139d3b16a62dff3cd06702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/0*L28x9soLE3COoCAN.png"/></div></figure><p id="25c5" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">知道打开哪个(些)阀，每个阀打开多少取决于奖励值，该奖励值作为先前(输出)阀打开的“有效性”的度量来计算。例如，假设室内温度目前为<em class="lf"> 20.5 </em>度(低于温度设定值)，这意味着需要打开供暖阀。在前一次迭代期间，室内温度也低于设定值，比如说<em class="lf"> 21.0 </em>度，导致<em class="lf"> rl_hvac </em>功能建议在比如说<em class="lf"> 15 </em> %时打开加热阀。考虑到当前的室内温度甚至更低(<em class="lf"> 20.5 </em>度)，我们推断先前的加热阀打开不够有效——赋予其负奖励——并且加热更多，其量与当前和先前的室内温度之间的差成比例。其他阀门的行为可以类似地解释。这是一种强化，确保阀门能够有效地平衡奖励函数(等式1)的“设定点接近度”和“能量成本”参数。</p><p id="713b" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">奖励函数的剩余参数是“公差违反”,其中如果室内温度/湿度违反了允许的公差范围，则需要施加惩罚。在我们的情况下，违规意味着相应的阀门需要更快地反应。这由步进增量常数调节:<em class="lf"> hiW，ciW，uiW，riW </em>。我们以离线方式调整它们，以便在给定时间段内，如果公差违反的数量超过某个阈值，则调整它们的值。</p><pre class="li lj lk ll gu nn no np nq aw nr bi"><span id="11be" class="ns ly iu no b gz nt nu l nv nw"><strong class="no iv"># Check tolerance violations and adapt respective increment values</strong><br/>if (count (i_t &gt; 25.0) &gt; n):    <br/>    ciW += 1.0<br/>if (count (i_t &lt; 20.0) &gt; n):    <br/>    hiW += 1.0<br/>if (count (i_h &gt; 55.0) &gt; n):    <br/>    riW += 1.0<br/>if (count (i_h &lt; 45.0) &gt; n):    <br/>    uiW += 1.0</span></pre><h1 id="3e09" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">4连续RL优化</h1><p id="227c" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">在本节中，我们扩展了RL模型，以适应“长期回报”，用RL术语中的Q值来量化。(回想一下，上一节中概述的RL算法中的奖励函数是随机的，在某种意义上，它仅取决于最后的状态。)状态-动作对<em class="lf"> (s，a) </em>的Q值被定义为从当前状态<em class="lf"> s </em>开始的所有未来步骤的期望回报值的加权和，假设在状态<em class="lf"> s </em>采取动作<em class="lf"> a </em>。</p><p id="aa21" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">为了适应“长期回报”，我们将原来的问题扩展到一个连续的空间设置。该设置中的每个事件对应于室内温度和(或)湿度开始偏离其各自设定值的时间，以及室内条件返回其各自设定值的时间——这是打开相关阀门的结果。</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj nz"><img src="../Images/31001c5fbdcee5fc897c641ad7ceab71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xl3nYk9vJCEZHjsi.png"/></div></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图4。阀门倾点计算(图片由作者提供)</p></figure><p id="a201" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在让我们来关注一个这样的插曲(在一个连续的空间设置中)。假设随机RL算法(第3节)总是在<em class="lf"> 0.0% </em>开始打开阀门，温度和(或)湿度与设定值的偏差持续增加，直到阀门打开百分比达到临界点，之后偏差再次开始减小，直到变为<em class="lf"> 0 </em>。这种阶段性行为如图4所示。为了简单起见，我们只显示了温度——冷却曲线，但是对于其他情况，包括那些涉及湿度的情况，可以预期类似的行为。图4中的能量成本对应于阴影区域。鉴于这种行为，很容易看出，如果我们事先知道冷却临界点是<em class="lf"> 22.3 </em>度，我们可以更早地将冷却阀打开到临界点——导致更低的能量成本(由虚线阴影区域描绘)。这里需要注意的是，需要正确估计所有阀门的临界点，否则打开阀门超过临界点的百分比实际上可能会导致更高的能源成本。</p><blockquote class="mu"><p id="9d6a" class="mv mw iu bd mx my mz na nb nc nd le dk translated">接下来，我们将展示如何将第3节中RL算法生成的数据用作训练数据，以开发一个模型来预测工厂区域每个状态的阀门“临界点”。</p></blockquote><p id="a0e3" class="pw-post-body-paragraph kj kk iu kl b km ne jv ko kp nf jy kr ks ng ku kv kw nh ky kz la ni lc ld le in bi translated">对于每个时间点<em class="lf"> t </em>,(第3部分)RL算法数据可被认为由以下输入和值组成:(室内温度、室内湿度、加热阀开度%、冷却阀开度%、加湿器阀开度%、再加热阀开度%)。我们对该数据应用以下过滤标准(仅针对湿度)来提取训练数据:</p><pre class="li lj lk ll gu nn no np nq aw nr bi"><span id="75a1" class="ns ly iu no b gz nt nu l nv nw"><strong class="no iv"># Extraction filter (for humidity) — to extract the training data<br/></strong># loop through rows of the generated data<br/>for i in range(1, dataset.shape[0]):<br/>   cRow = dataset.iloc[i] #current row<br/>   pRow = dataset.iloc[i-1] #previous row<br/>   <br/>   if cRow['Indoor Humidity'] &gt; 50.0 and cRow['Indoor Humidity'] &lt; pRow['Indoor Humidity']:<br/>       ctr = ctr + 1<br/>       #write row to training data<br/>   <br/>   if cRow['Indoor Humidity'] &lt; 50.0 and cRow['Indoor Humidity'] &gt; pRow['Indoor Humidity']:<br/>       ctr = ctr + 1<br/>       #write row to training data</span></pre><p id="2eba" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">通过这一更新(粗体)，RL算法能够引导阀门开启百分比，因此每次事件将以训练模型提供的相应“临界点”值开始(而不是从<em class="lf"> 0.0% </em>开始)，从而降低能源成本，如图4所示。</p><pre class="li lj lk ll gu nn no np nq aw nr bi"><span id="1a21" class="ns ly iu no b gz nt nu l nv nw"><strong class="no iv"># Heat and Humidify</strong><br/>if (i_t &lt; 22.0) and (i_h &lt; 50.0):<br/>    if (y_h == 0.0):<br/>        y_h = <strong class="no iv">loaded_h_model.predict(Xnew)</strong><br/>    elif (i_t &lt; i_tl):<br/>        inc = hiW + abs((i_t - i_tl) / 0.1)<br/>        y_h += inc<br/>    if (y_u == 0.0):<br/>        y_u = <strong class="no iv">loaded_u_model.predict(Xnew)</strong><br/>    elif (i_h &lt; i_hl):<br/>        inc = uiW + abs((i_h - i_hl) / 0.1)<br/>        y_u += inc<br/>    y_r = 0.0<br/>    y_c = 0.0</span></pre><h1 id="c006" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">5基准测试RL与PID</h1><p id="4415" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">提出的RL模型已经部署在我们罗马尼亚工厂的一个区域中。指定区域有五个(类似的)HVAC单元，其中HVAC单元的示意图如下图5所示。</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj oa"><img src="../Images/e6ecd7da427f0b052939b955cba3e998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DiLmAQjxV5FQRhMl.png"/></div></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图5。暖通空调示意图(图片由作者提供)</p></figure><p id="3d02" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">对于该区域，我们首先给出(图6)一周内运行带PID控制器的HVAC的室内条件和HVAC阀门开启百分比(约10，000个读数，相当于每分钟一个读数)。</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj ob"><img src="../Images/4956de0f509cb92ff68750c67b2a6e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cmOGLcD-QSplqUMs.png"/></div></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图6。基于PID的HVAC控制读数(图片由作者提供)</p></figure><p id="55f3" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">对于同一个区域，我们随后运行了由RL模型控制的HVAC单元的基准测试。我们确保两种情况下的制造工作负载相似。我们首先运行第3节中概述的RL算法一周。接下来，应用第4节中概述的过滤器来生成训练数据。然后使用AWS Sagemaker Autopilot [9]训练四个模型:<em class="lf"> h_model、u_model、r_model、c _ model</em>，以产生基于XGBoost的回归模型，其验证误差(来自超参数调整的MSE)约为<em class="lf"> 25.0 </em>。训练好模型后，我们又运行了一周第4节中介绍的RL算法(同样，使用类似的生产工作负载)。结果显示在图7中。</p><figure class="li lj lk ll gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj oc"><img src="../Images/5b2cff10b049c9f25f710edc2f139d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QfBwQZQTZmPSGaiP.png"/></div></div><p class="lt lu gk gi gj lv lw bd b be z dk translated">图7。基于RL的HVAC控制读数(图片由作者提供)</p></figure><blockquote class="mu"><p id="9f26" class="mv mw iu bd mx my od oe of og oh le dk translated">比较平均阀门开启百分比(由图6和图7中的红色边界框突出显示)，我们可以看到所有基于RL的阀门开启百分比较低；从加热阀的<em class="nm"> 10 </em> %节约到再加热阀的几乎<em class="nm"> 45 </em> %节约—平均节约<em class="nm"> 25 </em> %。</p></blockquote><h1 id="c449" class="lx ly iu bd lz ma mb mc md me mf mg mh ka oi kb mj kd oj ke ml kg ok kh mn mo bi translated">6结论</h1><p id="d49e" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">在这项工作中，我们考虑了工厂中的暖通空调能源优化问题，这有可能在节能和减少二氧化碳排放方面产生重大的环境影响。为了解决问题的复杂性，我们概述了一种基于RL的HVAC控制器，它能够学习并适应现实生活中的工厂设置，而无需任何离线培训。据我们所知，这是在实际工厂中报告RL-HVAC模型现场部署的首批作品之一。我们提供的基准测试结果显示，在能效方面有可能节省高达<em class="lf"> 25 </em> %。</p><p id="1e10" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">请注意，我们认为节能与阀门开启百分比成正比(越低越好)。实际上，不同阀门的能量消耗和CO2排放可能不成比例，即根据基本机制，打开相同百分比的加热和冷却阀门<em class="lf"> </em>可能消耗不同数量的能量。我们将此作为将来的工作来调整RL逻辑，以适应能耗和CO2排放方面。</p><h1 id="2a86" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">参考</h1><p id="0e99" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">[1] F. Oldewurtel等人<em class="lf">使用随机模型预测控制和天气预测进行节能建筑气候控制</em>。事故赔偿委员会，2010年。</p><p id="4fed" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[2] Y. Ma等<em class="lf">建筑制冷系统运行的模型预测控制</em>。IEEE控制系统技术汇刊，20(3):796–803，2012。</p><p id="899f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[3] F .皮科克。<em class="lf">PID算法的白痴指南</em>。https://www.pidcontrol.net/index.html<a class="ae lg" href="https://www.pidcontrol.net/index.html" rel="noopener ugc nofollow" target="_blank"/></p><p id="05b3" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[4] C .布拉斯科等人<em class="lf">根据能效和舒适度标准</em>对暖通空调系统进行建模和PID控制。In:能源和建筑的可持续性。智能创新，系统和技术，第12卷(2012)。</p><p id="32bd" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[5] Harmon，m . e . Harmon，S.S.: <em class="lf">强化学习:教程</em>。<a class="ae lg" href="http://www.cs.toronto.edu/~zemel/documents/411/rltutorial.pdf" rel="noopener ugc nofollow" target="_blank">http://www . cs . Toronto . edu/~ zemel/documents/411/rl tutorial . pdf</a></p><p id="c8e6" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[6] T. Weiand等人.."<em class="lf">建筑暖通空调控制的深度强化学习</em> l "第54届年度设计自动化会议论文集，第22页，2017。</p><p id="9e14" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[7] T. Moriyama等人<em class="lf">用于功耗优化的强化学习试验台</em>。《第18届亚洲模拟会议(AsiaSim)论文集》，第45–59页，2018年。</p><p id="39b4" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[8] EnergyPlus，<a class="ae lg" href="https://energyplus.net/" rel="noopener ugc nofollow" target="_blank">https://energyplus.net</a></p><p id="5794" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">[9]亚马逊SageMaker自动驾驶，<a class="ae lg" href="https://aws.amazon.com/sagemaker/autopilot/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/sagemaker/autopilot/</a></p></div></div>    
</body>
</html>