<html>
<head>
<title>Engineering best practices for Data Science projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学项目的工程最佳实践</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/engineering-best-practices-for-data-science-projects-195e0687c642?source=collection_archive---------43-----------------------#2020-11-07">https://towardsdatascience.com/engineering-best-practices-for-data-science-projects-195e0687c642?source=collection_archive---------43-----------------------#2020-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="34af" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的数据科学项目更加可靠、可测试和可部署</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/441d219fc227991a4a31db4dc614e946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1XWGl1-gkwLLSQgA4GS0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">乔恩·泰森在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="b9cf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="b5e1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本帖中，我们将学习一些最佳实践来提高生产数据科学代码的质量和可靠性。</p><p id="fb8d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意:这里提到的大多数东西对软件工程界来说并不陌生，但是在数据科学的实验世界中，它们经常被忽略/错过。</p><p id="63ef" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇文章中，我将简要地提到一些主题和我们可以做的事情，以使我们的项目更加可靠，我将创建一些后续文章，使用一个项目示例来更详细地描述这些步骤。此外，在这篇文章中，我将假设一个Python (pyspark)数据科学项目，但是这些想法可以应用于任何其他编程语言或项目。</p><p id="513b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">希望你觉得有用。</p><h1 id="80c5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码重构</h1><p id="ca1d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是拥有更好代码的第一步。它是简化现有代码设计而不改变其行为的过程。</p><p id="8d54" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">数据科学项目大部分时间都写在jupyter笔记本上，很容易失控。强烈建议在将代码投入生产之前进行代码重构。</p><h2 id="c3a9" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="2aa9" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">提高代码可读性——让我们的团队更容易理解</li><li id="4e87" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">降低复杂性——更小、更易维护的功能/模块</li></ul><h2 id="43ec" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="e3fb" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">将代码分解成更小的函数</li><li id="19f4" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">注释功能</li><li id="e55c" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">更好的命名标准</li><li id="2a06" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">移除未使用的代码位</li></ul><h1 id="70df" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">单元测试</h1><p id="f735" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">单元测试是一种测试代码中每个功能的方法。目的是验证代码中的每个函数都按预期执行。</p><p id="0037" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在数据科学项目中，测试几乎总是被忽略。您的项目中有一些部分可能不需要测试用例，但是在一个项目中，有许多其他组件可以很容易地进行单元测试。</p><p id="db59" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，模型评估是在实验阶段完成的，我们可能不需要在单元测试中再次测试，但是数据清理和数据转换是绝对可以进行单元测试的部分。</p><h2 id="eff2" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="0025" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">这有助于尽早修复错误</li><li id="e709" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">它有助于新手理解代码的作用</li><li id="8b27" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">支持快速代码更改</li><li id="e127" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">确保不良代码不会合并到</li></ul><h2 id="15b8" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="dc28" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">创建接受所有必需参数作为参数的函数，而不是在函数内进行计算。这使得它们更容易测试</li><li id="1d99" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">如果函数读取函数中的spark数据帧，请更改函数以接受数据帧作为参数。然后我们可以传递手工制作的数据帧来测试这些功能。</li><li id="9797" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">我们将为每个功能编写一系列单元测试</li><li id="93a1" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">我们将使用python框架，如unittest、pytest等。对于单元测试</li><li id="b518" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">测试将是代码库的一部分，将确保没有坏代码被合并</li><li id="3534" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">我们的CI/CD管道将进一步使用这些测试来阻止不良代码的部署</li></ul><h1 id="94bc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">集成测试</h1><p id="e5e4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">集成测试将系统作为一个整体进行测试。它检查所有功能组合在一起时是否工作正常。</p><p id="1147" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">很多时候，项目会依赖外部系统，例如，您的pyspark代码可能会向Cassandra读取/写入数据。我们可以创建集成测试，将整个项目作为一个单元进行测试，或者测试项目在外部依赖下的表现。</p><h2 id="8b3c" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="39bf" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">它确保整个项目正常运行。</li><li id="4254" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">它检测与多个模块协同工作相关的错误。</li></ul><h2 id="6320" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="27a3" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">我们将创建一个本地基础设施来测试整个项目</li><li id="d53f" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">外部依赖可以在Docker容器上本地创建</li><li id="5f79" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">pytest或unittest等测试框架将用于编写集成测试</li><li id="169c" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">代码将根据本地基础设施运行，并测试正确性</li></ul><h1 id="24ec" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码林挺</h1><p id="030b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在jupyter笔记本上编写项目本质上并不遵循最佳的命名或编程模式，因为笔记本的重点是速度。林挺帮助我们识别python代码中的语法和风格问题。</p><h2 id="dc93" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="bb2f" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">它有助于检测样式错误</li><li id="69fa" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">强制更好/最佳的写作风格</li><li id="5b88" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">检测结构问题，如使用未初始化或未定义的变量</li><li id="7a56" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">让代码更容易使用</li></ul><h2 id="ad5c" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="dcba" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">Flake8或black将用于检测逻辑和代码风格的最佳实践。</li><li id="7301" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">下一步，Lint测试将被集成到CI/CD中，以使基于不良写作风格的构建失败</li></ul><h1 id="b25e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码覆盖率</h1><p id="d679" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">代码覆盖率帮助我们发现我们通过测试用例测试了多少代码。这是一个很好的质量指示器，可以告知项目的哪些部分需要更多的测试。</p><h2 id="04a1" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="f5de" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">监控测试了多少代码。</li></ul><h2 id="98c2" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="685a" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">像coverage.py或pytest-cov这样的工具将用于测试我们的代码覆盖率。</li></ul><h1 id="d094" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">GitHub回购分支机构权限</h1><p id="ba84" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将设置权限来控制谁可以读取和更新Git repo分支中的代码。这将保持我们的主(部署分支)干净，并强制基于拉请求+构建测试的过程将代码合并到主中。</p><p id="80e4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，强制同行评审过程和自动化测试可以确保我们的代码库中有更少的错误合并，并且其他团队成员会意识到项目中合并的变更。</p><h2 id="a7b8" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="7a88" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">主人总是干净的，随时可以部署</li><li id="6a80" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">强制最佳实践—拉式请求+自动化构建测试</li><li id="d6a3" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">将避免意外删除分支</li><li id="3fbe" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">避免不良代码在主服务器上合并</li></ul><h2 id="e29b" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><p id="b546" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将使用以下内容设置分支设置:</p><ul class=""><li id="17f9" class="ne nf it lt b lu mn lx mo ma ns me nt mi nu mm nj nk nl nm bi translated">主分支不允许重写分支历史记录</li><li id="3195" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">没有拉取请求，我们不能在master中直接合并代码</li><li id="a99d" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">将代码合并到主代码至少需要1次批准</li><li id="4bab" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">只有当所有自动化测试用例都通过后，代码才会合并</li></ul><h1 id="fd2e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">分支上的自动化测试执行</h1><p id="eaac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当我们的拉请求被创建时，在合并之前测试它以避免破坏任何代码/测试是一个好主意。</p><h2 id="efcd" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="f364" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">自动运行测试</li><li id="8c12" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">避免不良代码在主服务器上合并</li></ul><h2 id="418c" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="fb89" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">Github上的CI/CD设置。</li><li id="0af6" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">任何新的分支代码推送都应该触发自动测试</li><li id="d0f4" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">应该在创建拉请求时触发自动测试</li><li id="c510" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">如果所有测试都是绿色的，则将代码部署到生产环境中</li></ul><h1 id="b8cf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">监控和警报</h1><p id="5cba" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是软件工程世界中非常重要的一步，但是对于数据科学项目来说，几乎总是被跳过。我们将监控我们的工作，如果代码中出现运行时错误，我们将发出警报。</p><p id="b41d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">取决于你的项目是否仅仅是做预测，你可能不会非常广泛地发出警报，但是如果项目与几个系统对话并且处理大量的数据/请求，从长远来看，进行监控将会使你的生活变得容易得多。</p><h2 id="fa89" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解决的问题</h2><ul class=""><li id="75cd" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">更多的可见性，而不是黑盒代码执行</li><li id="0a02" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">监控输入和输出处理统计</li><li id="4ce2" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">监控基础架构可用性/依赖性</li><li id="c129" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">过去运行失败/成功趋势</li><li id="b9d4" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">当ML管道失败/崩溃时提醒我们</li></ul><h2 id="4b8c" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">行动项目</h2><ul class=""><li id="c496" class="ne nf it lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">如果您有一个监视工具(强烈推荐)—将输入/输出统计数据的事件发送到监视器</li><li id="18f4" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">如果没有可用的监控工具—在日志文件中记录所有重要的统计信息。</li><li id="aeeb" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">如果没有监控工具——我们可以将重要的跑步统计数据添加到数据库中，以备将来参考</li><li id="10ab" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">构建Slack/微软团队集成，提醒我们管道通过/失败状态</li></ul><h1 id="0639" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">就这样</h1><p id="5ea2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个帖子到此为止。希望这些是有用的提示。请分享您的想法和应用于数据科学项目的最佳实践。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="7ea1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="oc">原载于2020年11月7日</em><a class="ae ky" href="https://confusedcoders.com/random/engineering-best-practices-for-data-science-projects" rel="noopener ugc nofollow" target="_blank"><em class="oc">【https://confusedcoders.com】</em></a><em class="oc">。</em></p></div></div>    
</body>
</html>