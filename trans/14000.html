<html>
<head>
<title>Introduction to Sports Analytics with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫体育分析简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-sports-analytics-with-pandas-ad6303db9e11?source=collection_archive---------28-----------------------#2020-09-26">https://towardsdatascience.com/introduction-to-sports-analytics-with-pandas-ad6303db9e11?source=collection_archive---------28-----------------------#2020-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="12e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">德国德甲足球比赛分析。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a05686d6d96f0690e0aac7ce47724684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJVIcenlSUOyRcPKGscg4Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@bermixstudio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Bermix工作室</a>在<a class="ae ky" href="https://unsplash.com/s/photos/football-analytics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="9154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">体育分析是数据科学的一个主要分支。数据收集技术和数据分析的进步使得团队根据数据分析调整策略变得更有吸引力。</p><p id="70a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据分析为团队表现和球员表现提供了有价值的见解。如果明智而系统地使用，数据分析最有可能让团队领先于竞争对手。</p><p id="8946" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些俱乐部有一整个团队致力于数据分析。利物浦是使用数据分析的先锋，我认为这是他们成功的重要部分。他们是上届英超冠军，也是2019年欧冠冠军。</p><p id="f67f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将使用熊猫从2017-18赛季的德国德甲比赛中得出有意义的结果。这些数据集可以从<a class="ae ky" href="https://figshare.com/collections/Soccer_match_event_dataset/4415000/5" rel="noopener ugc nofollow" target="_blank">的链接</a>下载。我们将使用论文<a class="ae ky" href="https://www.nature.com/articles/s41597-019-0247-7" rel="noopener ugc nofollow" target="_blank">足球比赛时空比赛事件公共数据集</a>中介绍的部分数据集。</p><p id="8b7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集以JSON格式保存，可以很容易地读入pandas数据帧。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c115" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="c5b7" class="ma mb it lw b gy mg md l me mf">events = pd.read_json("/content/events_Germany.json")<br/>matches = pd.read_json("/content/matches_Germany.json")<br/>teams = pd.read_json("/content/teams.json")<br/>players = pd.read_json("/content/players.json")</span><span id="959c" class="ma mb it lw b gy mg md l me mf">events.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/02407b77d7f1974a6f9d23390d153343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gC838OKlqSF8A7KlKtTAaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="6c44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事件数据帧包含比赛中发生的事件的细节。例如，第一行告诉我们，球员15231在比赛2516739的第三秒从位置(50，50)到(50，48)做了一次“简单的传球”。</p><p id="b9a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事件数据帧包括球员和球队id，但不包括球员和球队名称。我们将使用合并功能从球队和球员数据帧中添加他们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/8b3b607598ee20642895be2b956f30c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*wESktiln9P6E7BhnEaa50A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="4430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Id存储在球队和球员数据帧的“wyId”列中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c858" class="ma mb it lw b gy mc md l me mf">#merge with teams<br/>events = pd.merge(<br/>events, teams[['name','wyId']],left_on='teamId',right_on='wyId'<br/>)<br/>events.rename(columns={'name':'teamName'}, inplace=True)<br/>events.drop('wyId', axis=1, inplace=True)</span><span id="2eb4" class="ma mb it lw b gy mg md l me mf">#merge with players<br/>events = pd.merge(<br/>events, players[['wyId','shortName','firstName']],<br/>left_on ='playerId',right_on='wyId'<br/>)<br/>events.rename(columns={'shortName':'playerName', 'firstName':'playerFName'}, inplace=True)<br/>events.drop('wyId', axis=1, inplace=True)</span></pre><p id="d22e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们根据包含id的列合并数据帧，然后重命名新列。最后，删除“wyId”列，因为Id已经存储在events数据帧中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/1bc36e0f769326472995803097768b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*szKpKmbaXLhCfFCTeGQRyw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="7278" class="mr mb it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">每场比赛的平均传球次数</strong></h1><p id="2ecb" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">主导比赛的球队通常传球次数更多。一般来说，他们更有可能赢得这场比赛。当然，也有一些例外。</p><p id="993e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查一下每支球队每场比赛的平均传球次数。我们将首先创建一个数据帧，其中包含球队名称、比赛ID和比赛中完成的传球次数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fed2" class="ma mb it lw b gy mc md l me mf">pass_per_match = events[events.eventName == 'Pass']\[['teamName','matchId','eventName']]\<br/>.groupby(['teamName','matchId']).count()\<br/>.reset_index().rename(columns={'eventName':'numberofPasses'})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/029440d5aa9cdcf2d6b8e6e09a54d8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*RadcvDrNXLnaqH9IQMhCMw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="b16e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">奥格斯堡在比赛2516745中进行了471次传球。这是每场比赛传球数量排名前五的球队名单。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1c72" class="ma mb it lw b gy mc md l me mf">pass_per_match[['teamName','numberofPasses']]\<br/>.groupby('teamName').mean()\<br/>.sort_values(by='numberofPasses', ascending=False).round(1)[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/bb0321dce260e5f53c91c6bf87029ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*Xm2CoeJJFBCsBpqtIGkAJw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="9f0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拜仁慕尼黑传球次数最多并不奇怪。近年来他们一直统治着德甲联赛。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="7002" class="mr mb it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">球员平均传球长度</strong></h1><p id="da15" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">可以基于许多事情来评估一次通过。有些传球非常成功，使得得分变得非常容易。</p><p id="b732" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将关注传球的量化评估，即长度。有些球员非常擅长长传。</p><p id="9c16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">位置列包含球在x和y坐标上的初始和最终位置。我们可以根据这些坐标计算长度。让我们首先创建一个只包含通道的数据帧。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="19f1" class="ma mb it lw b gy mc md l me mf">passes = events[events.eventName=='Pass'].reset_index(drop=True)</span></pre><p id="e4cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以计算长度。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e463" class="ma mb it lw b gy mc md l me mf">pass_length = []<br/>for i in range(len(passes)):<br/>    length = np.sqrt(((passes.positions[i][0]['x'] -    <br/>    passes.positions[i][1]['x'])**2)\ + <br/>    ((passes.positions[i][0]['y'] - <br/>    passes.positions[i][1]['y'])**2))</span><span id="c197" class="ma mb it lw b gy mg md l me mf">pass_length.append(length)</span><span id="090b" class="ma mb it lw b gy mg md l me mf">passes['pass_length'] = pass_length</span></pre><p id="7799" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">groupby函数可以用来计算每个球员的平均传球长度。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6a19" class="ma mb it lw b gy mc md l me mf">passes[['playerName','pass_length']].groupby('playerName')\<br/>.agg(['mean','count']).\<br/>sort_values(by=('pass_length','mean'), ascending=False).round(1)[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/82f6fcf50653f08f2bfe9bbe79dec4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*4uPL2CbnnVBR0iaD-BlckQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="ffbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们列出了平均传球长度和传球次数排名前五的球员。传球次数很重要，因为只传球3次对平均值来说意义不大。因此，我们可以过滤那些少于一定数量的通道。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="196c" class="mr mb it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">胜利和失败的平均传球次数</strong></h1><p id="4b4f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们比较一下胜利和失败比赛的平均传球次数。我将用勒沃库森的比赛作为例子。</p><p id="7848" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先需要从“matches”数据框架中添加比赛的获胜者。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6ce4" class="ma mb it lw b gy mc md l me mf">events = pd.merge(events, matches[['wyId','winner']], left_on='matchId', right_on='wyId')</span><span id="1129" class="ma mb it lw b gy mg md l me mf">events.drop('wyId', axis=1, inplace=True)</span></pre><p id="7079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以创建一个dataframe，它只包含团队ID为2446(b . Leverkusen的Id)的事件。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bad4" class="ma mb it lw b gy mc md l me mf">leverkusen = events[events.teamId == 2446]</span></pre><p id="8740" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果“获胜者”列中的值等于2446，则获胜者是b .勒沃库森。为了计算B. Leverkusen赢得的比赛的平均传球次数，我们需要根据winner和eventName列过滤数据帧。然后我们将应用groupby和count来查看每场比赛的传球次数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d2ec" class="ma mb it lw b gy mc md l me mf">passes_in_win = leverkusen[(leverkusen.winner == 2446) &amp; (leverkusen.eventName == 'Pass')][['matchId','eventName']].groupby('matchId').count()</span><span id="2a48" class="ma mb it lw b gy mg md l me mf">passes_in_notwin = leverkusen[(leverkusen.winner != 2446) &amp; (leverkusen.eventName == 'Pass')][['matchId','eventName']].groupby('matchId').count()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/f8653481f2477cc8ea8cfc5286b68f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*plumfgvRXRmRJ4GOXX9tVg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="f0ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过应用均值函数，我们可以很容易地得到平均通过次数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/b293f01b7f3fd1937189b04fdbabab4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*zLyouTbQodX9FCEi5xQzFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="da50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然多传球并不意味着一定会赢，但它会帮助你控制比赛，增加你得分的机会。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="26bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">体育分析的范围远远超出了我们在这篇文章中所做的。然而，在不熟悉基础知识的情况下，掌握更高级技术的知识将更加困难。</p><p id="9f49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据可视化也是体育分析的基础。球队和球员如何管理球场，射门和传球的位置，以及球场上覆盖最广的区域提供了宝贵的见解。</p><p id="f363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我也会写一些关于某些事件如何在球场上可视化的帖子。感谢您的阅读。如果您有任何反馈，请告诉我。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="7469" class="mr mb it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">参考文献</strong></h1><p id="6b38" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">[1] Pappalardo等，(2019)足球比赛时空匹配事件公共数据集，自然科学数据6:236，<a class="ae ky" href="https://www.nature.com/articles/s41597-019-0247-7" rel="noopener ugc nofollow" target="_blank">https://www.nature.com/articles/s41597-019-0247-7</a></p><p id="febf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]https://figshare.com/articles/Events/7770599<a class="ae ky" href="https://figshare.com/articles/Events/7770599" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>