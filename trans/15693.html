<html>
<head>
<title>Join Pandas Aggregate and SQL Analytic Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">连接熊猫聚合和SQL分析函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/join-pandas-aggregate-and-sql-analytic-functions-41a611d2759b?source=collection_archive---------50-----------------------#2020-10-28">https://towardsdatascience.com/join-pandas-aggregate-and-sql-analytic-functions-41a611d2759b?source=collection_archive---------50-----------------------#2020-10-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="89fd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们使用聚合函数sum、average、min和max实现移动平均、等级项目、累积和</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/09763ef32c80d6365bd1d8b46a912464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPpFSP9ifZ8Tfg4oEwm63w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/photos/HWbxSLvmSww" rel="noopener ugc nofollow" target="_blank"> Naven Krcmarek : unsplash </a></p></figure><p id="4bbc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQL分析函数用于将大型数据集汇总成一个简单的报告。这些功能产生的数据汇总可以很容易地可视化。这些功能有助于数据分析专家轻松分析复杂的数据。</p><p id="ed07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们结合pandas聚合和分析函数来实现SQL分析函数。</p><p id="fdb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQL分析函数有许多种类。我们将逐一介绍这些功能。但首先，让我们了解一下本文中使用的数据。</p><h1 id="817d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">零售数据集</h1><p id="e58c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将使用<a class="ae kv" href="https://www.kaggle.com/manjeetsingh/retaildataset" rel="noopener ugc nofollow" target="_blank"> Kaggle数据集</a>。以下是对数据集每一列的解释。</p><p id="7595" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该数据集的销售日期从2010年2月5日到2012年11月1日。</p><p id="6bfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">商店——商店编号</p><p id="097e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部门——部门编号</p><p id="7999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">日期—代表一周</p><p id="6417" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Weekly_Sales —每个部门的商店每周销售额</p><p id="6bc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IsHoliday表示一周内的假期</p><p id="a741" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是零售数据集的几行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5fb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们从SQL分析函数开始。</p><h1 id="b7f4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.秩和稠密秩函数</h1><p id="751d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">秩和密秩提供了有序数据集的秩。这两个函数有一个小的区别。通过这个例子，我们可以很容易地理解这种差异，我将在本节的最后解释这一点。</p><p id="299a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">等级和密集等级的用例</strong></p><p id="5d1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.您可以使用这些函数来查找世界、大洲或国家的前N名亿万富翁。</p><p id="4503" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.计算商店中前N件商品在一天、一周、一月或一年中的销售额。</p><p id="f80b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.计算一家公司在世界不同地区的增长和业绩。</p><p id="52a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.根据GDP、饥饿指数、人口等对国家进行排名。</p><p id="3391" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">SQL秩和密集秩函数的Pandas等价物</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><ul class=""><li id="f1c5" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">由等级和密集等级函数分配给索引5314和6214的等级是141。并且由等级和密集等级函数分配给索引2794的等级是143和142。这种类型的等级分配将等级函数与密集等级函数区分开来。</li><li id="2d4f" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">将总和替换为中值。agg函数计算平均每周销售排名和密集排名。</li><li id="a4b9" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">使用groupby函数中的其他列可以更好地理解数据和rank/dense rank函数。</li></ul><h1 id="0794" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.百分比等级函数</h1><p id="b9ec" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Percent rank函数考虑一组行来计算一行的百分位值。其值范围在0到1之间。</p><p id="bc0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">百分比等级的用例</strong></p><p id="b5bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.我们在竞争性考试中使用这个函数来根据考生的分数计算他们的百分位数。</p><p id="0f35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.这些公司使用这种方法计算每个员工的收入，同时考虑其他员工的收入。</p><p id="05cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">SQL百分位等级函数的Pandas等价物</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><ul class=""><li id="468e" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">在2011年11月25日，商店4的销售额最高，商店10的销售额次之。索引1404处的Percent_weekly_sales值表示商店10的销售额超过该商店的97%。</li><li id="536c" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">将平均值替换为中的和。agg函数根据每周销售总额计算百分比。</li></ul><h1 id="dd12" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.滚动功能</h1><p id="c974" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">滚动函数计算指定时间范围内数据的平均值。它添加一个旧的数据点，并添加一个新的数据点来计算平均值和均值。但是指定的时间框架是不变的。</p><p id="d72c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">滚动功能使用案例</strong></p><p id="549f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.这种方法将帮助你找到股票的50、100、200天移动平均线。均线是股票交易者的重要技术指标。这将有助于他们预测股票价格的走向。</p><p id="9959" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.你可以用这种方法追踪蔬菜的价格。你可以查一下，淡季蔬菜的移动价格是多少。</p><p id="c6df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">SQL滚动功能的熊猫等价物</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><ul class=""><li id="73ed" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">的。滚动功能输入5表示，当前行+ 4个先前行。的。mean()函数将取5行的平均值，并将结果存储在当前行中。也被称为5移动平均线周销售量。</li><li id="a05f" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">若要避免Weekly_Sales_rolling5列的起始行为空值，请使用min_period=1。</li><li id="9291" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">第4行的Weekly_Sales_rolling5列值表示第0、1、2、3、4行的Weekly_Sales值的平均值。</li></ul><h1 id="a7d7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.行数函数</h1><p id="a0e2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">行号函数为聚合组的每一行分配一个唯一的编号。</p><p id="b022" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">行号功能的用例</strong></p><p id="0120" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.此函数将有助于查找组织中员工的第五大或倒数第二个薪金值。</p><p id="5353" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.您可以使用此函数计算一个组中数据点的总数。</p><p id="cd66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Pandas等价于SQL行号函数</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><ul class=""><li id="b052" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">熊猫。cumcount函数为存储组中的每一行提供一个唯一的编号。由于行的编号从0开始，因此，我们使用。累计()+1。</li><li id="c70a" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">此功能将帮助您找出商店1中销售额第五高的日期。</li></ul><h1 id="653b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="81fb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">SQL分析函数看起来很难理解和实现。但是，你可以很容易地理解或掌握这些分析功能。还有其他类型的分析函数可用于数据分析。但是大多数情况下，我们在数据分析任务中使用上面的SQL函数。</p><p id="cb65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这些函数深入研究数据并发现数据中的模式。</p></div></div>    
</body>
</html>