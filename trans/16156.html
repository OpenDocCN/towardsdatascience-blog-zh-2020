<html>
<head>
<title>How to Make Python Statically Typed — The Essential Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使Python成为静态类型——基本指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-make-python-statically-typed-the-essential-guide-e087cf4fa400?source=collection_archive---------4-----------------------#2020-11-07">https://towardsdatascience.com/how-to-make-python-statically-typed-the-essential-guide-e087cf4fa400?source=collection_archive---------4-----------------------#2020-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="20af" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">类型提示、变量注释和强制运行时类型检查——您需要知道的一切。</h2></div><p id="5854" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python是一种动态类型语言——我相信你知道这一点。这对初学者来说既简单又有趣，因为不需要考虑数据类型。尽管如此，静态类型还是有一些好处。今天我们将探索如何使Python尽可能静态化。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/4c03c69f89b184299ab8d14051fcbde0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O6xRSeF-pmpNlKSb.jpg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated"><a class="ae lu" href="https://unsplash.com/@floriankrumm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">弗洛里安·克拉姆</a>在<a class="ae lu" href="https://unsplash.com/s/photos/keyboard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f552" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不想看书？请观看相关主题的视频:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="590a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lx">那么，动态类型语言是怎么回事呢？简单地说，这意味着没有代码编译，所以Python解释器在代码运行时执行类型检查。因此，允许在整个应用程序中更改变量类型。</em></p><p id="19ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这听起来像是一种优势，但是随着代码库变得越来越大，这可能会导致奇怪且难以跟踪的错误。</p><p id="2c93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，静态类型语言在编译时执行类型检查(想想<em class="lx"> C </em>或<em class="lx"> Java </em>)。此外，它们给了您一些安全感，因为您可以立即判断每个函数的参数类型。</p><p id="fe66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们开始之前，有一个简短的声明——Python将永远是一种动态类型的语言。你不能像Java或c一样把它变成静态的，因为PEP 484 引入了类型提示，所以我们必须利用它。</p><p id="b66c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章的结构如下:</p><ul class=""><li id="e2a2" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">类型提示</li><li id="fa08" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">可变注释</li><li id="49a4" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">表示更高级的数据类型</li><li id="8610" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">在运行时强制类型检查</li><li id="5f85" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">结论</li></ul></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="73d5" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">类型提示</h1><p id="61e6" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">类型提示仅仅是提示。它们向您展示了预期的数据类型，但是没有什么可以阻止您忽略它们。我们稍后将探讨如何通过Python解释器强制进行类型检查，但让我们先来看看基础知识。</p><p id="65de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们做一个没有类型提示的例子。下面是一个将两个数相加并返回总和的函数。Python就是Python，我们不必为参数或返回值指定数据类型:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nq lw l"/></div></figure><p id="a81a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">函数调用的打印结果分别为<em class="lx"> 15 </em>、<em class="lx"> 15.3 </em>和<em class="lx"> BobMark </em>。要引入类型提示，我们必须执行以下操作:</p><ul class=""><li id="c07a" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">对于参数-将冒号(:)放在参数名称的右边，并在后面指定数据类型</li><li id="78d7" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">对于返回值-将箭头符号和数据类型放在括号的右边</li></ul><p id="2dee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是如何给我们的<code class="fe nr ns nt nu b">sum_numbers</code>函数添加类型提示:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nq lw l"/></div></figure><p id="203e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个函数现在看起来更清楚了，但是我们仍然可以传递任何数据类型——表明提示只是提示，而不是义务。</p><p id="d58e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据PEP 8，以下是类型提示建议:</p><ul class=""><li id="1eef" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">对冒号使用常规规则，即冒号前没有空格，冒号后有一个空格</li><li id="76e5" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">将参数注释与默认值结合使用时，请在=符号周围使用空格</li><li id="e4a6" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">在-&gt;箭头周围使用空格</li></ul><p id="e25c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">稍后我们将看到如何<strong class="kk iu">强制</strong>类型检查。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="2f30" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">可变注释</h1><p id="b71d" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">我们还可以为变量提供类型提示。同样，这些只是提示，并不影响代码的运行。</p><p id="8fc7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是一个如何向变量添加类型提示的快速示例:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nq lw l"/></div></figure><p id="cc95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有什么可以阻止你给变量<code class="fe nr ns nt nu b">age</code>赋值32.95，或者给<code class="fe nr ns nt nu b">is_premium</code>赋值no。暗示只是表示不应该。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="f810" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">表示更高级的数据类型</h1><p id="fc89" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">到目前为止，我们所介绍的一切都很好，但是如果您想声明一个字符串列表或一个键和值都是字符串的字典，该怎么办呢？</p><p id="0a3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是<code class="fe nr ns nt nu b">typing</code>模块发挥作用的地方。有了它，您可以使用任何更复杂的数据类型，比如列表、字典和元组。您也可以声明自己的数据类型，但这已经超出了今天的范围。</p><p id="15f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们使用<code class="fe nr ns nt nu b">typing</code>模块来声明一个名字列表，然后是一个电子邮件字典，其中每封电子邮件都属于一个名字。在所有情况下，数据类型都是字符串:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nq lw l"/></div></figure><p id="6a69" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">冗长多了，但感觉更安全。更进一步，让我们看看如何使一个函数参数成为一个整数列表。这很简单:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nq lw l"/></div></figure><p id="91cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您现在知道了如何使用类型提示来声明任何数据类型的变量，但是如何在运行时强制进行类型检查呢？接下来让我们来探索一下。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="62ea" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">在运行时强制类型检查</h1><p id="5143" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">我不知道在笔记本环境中有什么强制类型检查的方法——所以我们将切换到脚本。我做了一个名为<code class="fe nr ns nt nu b">static_typing.py</code>的文件，但是你可以随意命名你的文件。</p><p id="207e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在继续之前，我们必须安装一个名为<code class="fe nr ns nt nu b">mypy</code>的库。它用于在运行时强制进行类型检查，这正是我们所需要的。要安装它，从终端执行<code class="fe nr ns nt nu b">pip install mypy</code>。</p><p id="40dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以走了。<code class="fe nr ns nt nu b">static_typing.py</code>脚本包含以下代码:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nq lw l"/></div></figure><p id="78b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从终端，以传统方式执行脚本——通过编写<code class="fe nr ns nt nu b">python static_typing.py</code></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nv"><img src="../Images/a9e62f17dfe48dab7048211cb26f55aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnTNBV8zB2IfRVc6vDPKug.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">图1 —不带mypy的执行(作者图片)</p></figure><p id="f7cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">代码将运行而不抛出错误。这相当于我们之前在笔记本中所做的。但是我们不希望这样。使用<code class="fe nr ns nt nu b">mypy</code>，我们可以强制进行类型检查。从终端执行以下命令:<code class="fe nr ns nt nu b">mypy static_typing.py</code>:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nw"><img src="../Images/0c95d011a41a43ba9501f487decc2f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ex6Qp6iqXgQSwGyipl379Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">图2 —使用mypy执行(图片由作者提供)</p></figure><p id="eb60" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如你所见，程序崩溃了。这正是我们想要的行为，因为函数需要两个整数，但是我们没有在函数调用中提供数据类型。</p><p id="b9f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是开始时你应该知道的。让我们在下一部分总结一下。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="5d16" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">离别赠言</h1><p id="5599" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">让我们以使用类型提示的利弊来结束这篇文章。</p><p id="c8e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">优点:</p><ul class=""><li id="522b" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">它们有助于记录您的代码——但不能代替docstrings</li><li id="ab2f" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">出于显而易见的原因，它们有助于维护一个更干净的代码库</li><li id="2052" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">它们改进了代码编辑器的林挺功能——例如，如果检测到类型不匹配，PyCharm会显示警告</li></ul><p id="af71" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">缺点:</p><ul class=""><li id="7b2f" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">添加起来可能会很乏味，尤其是如果您不习惯它们的话</li></ul><p id="3310" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总结一下——类型提示不是必需的，但却是很好的实践，尤其是在处理大型代码库时——即使你决定不使用<code class="fe nr ns nt nu b">mypy</code>。</p><p id="6d7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你对类型提示有什么想法？您是一直使用它们，还是只是在代码库变大时才使用它们？请在下面的评论区告诉我。</p><h2 id="68e0" class="nx mu it bd mv ny nz dn mz oa ob dp nd kr oc od nf kv oe of nh kz og oh nj oi bi translated"><a class="ae lu" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">加入我的私人邮件列表，获取更多有用的见解。</a></h2></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="54ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lx">喜欢这篇文章吗？成为</em> <a class="ae lu" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lx">中等会员</em> </a> <em class="lx">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oj ok gp gr ol om"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">medium.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa lo om"/></div></div></a></div></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="08b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lx">原载于2020年11月7日https://betterdatascience.com</em><a class="ae lu" href="https://betterdatascience.com/python-statically-typed/" rel="noopener ugc nofollow" target="_blank"><em class="lx"/></a><em class="lx">。</em></p></div></div>    
</body>
</html>