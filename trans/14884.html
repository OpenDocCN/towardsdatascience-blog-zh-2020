<html>
<head>
<title>How to deploy your first Machine learning models — Part#1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何部署你的第一个机器学习模型——第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exclusive-how-to-deploy-your-first-machine-learning-models-bf0a2109e522?source=collection_archive---------37-----------------------#2020-10-13">https://towardsdatascience.com/exclusive-how-to-deploy-your-first-machine-learning-models-bf0a2109e522?source=collection_archive---------37-----------------------#2020-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7a5d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从描述业务问题到部署，开发定制的ML管道。这份内容广泛的指南包括Docker和包装配置。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/48952ecd7e2c964ecb006803102f4d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lr2glympgCJkfkSGGUecyA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@ninjason?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">梁杰森</a>在<a class="ae ky" href="https://unsplash.com/s/photos/happiness?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="180c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器学习模型只有在交付给最终用户时才会有巨大的价值。最终用户可能是房地产平台上的推荐系统，它向租房者或投资者推荐房产——例如<a class="ae ky" href="https://www.zillow.com/" rel="noopener ugc nofollow" target="_blank"> Zillow </a>。</p><p id="9214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，机器学习项目只有在一个模型被部署，并且它的预测被服务的时候才能成功<em class="lv">。</em></p><p id="931d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很惊讶机器学习部署不寻常地在网上讨论——这是你需要在实践工作流中学习的特殊技能。</p><p id="88c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我试图谷歌这个特定的主题，但我发现了许多关于为机器学习模型设置Flask APIs的博客帖子。然而，这些教程都没有深入细节，开发唯一的端点。</p><p id="de17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我决定在一个关于如何将ML模型部署到产品中的综合教程系列中写一篇关于这个主题的博客。我将首先使用Jupyter笔记本进行初步的统计分析，然后构建一个定制的机器学习框架——包。之后我会用FLASK APP开发一个端点API。最后，我将使用CI/CD管道将机器学习模型部署到Paas平台。</p><p id="511a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们会使用的一些技术有Docker、Gemfury、Flask-API、CircleCI、Kaggle API和Sklearn。太激动了，让我们开始旅程吧。</p><blockquote class="lw lx ly"><p id="4457" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">免责声明，教程更侧重于事物如何工作，而不是代码逐行教程。在任何时候，您都可以使用</strong><a class="ae ky" href="https://github.com/salma71/prediction_app" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Github repo</strong></a><strong class="lb iu">提交历史来引用您的代码，当然，询问您是否需要帮助。</strong></p></blockquote><p id="c636" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个两部分的教程，这是第一部分，包括构建和发布一个机器学习python包。<strong class="lb iu">第二部分</strong>包括构建一个Flask API端点并部署到Heroku。</p><blockquote class="lw lx ly"><p id="33d3" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">请注意，这是一个中级教程，你需要满足一定的要求才能赶上。然而，我通过添加评论和附上资源以供进一步学习和阅读，尽可能地让自己清楚。</p></blockquote><p id="943a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一部分中，我将带您完成开发您自己的机器学习框架所需的步骤，以自动化从获取数据集到发布到云的构建步骤，以便您可以下载和使用。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="2f66" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">先决条件:</h1><p id="eebc" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">本教程假设您对以下方面有一些经验</p><ol class=""><li id="5873" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">python OOP——面向对象编程。</li><li id="7f34" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">拥有Kaggle帐户。</li><li id="1233" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">作为文本编辑器的VScode。</li><li id="dfb6" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">具备shell脚本的基础知识—可选。</li><li id="2bf4" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">了解终端命令的基本知识。</li><li id="18b6" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">拥有CircleCI账户。</li><li id="83a1" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">拥有Github帐户。</li></ol></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="194f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">目录:</h1><ol class=""><li id="6c25" class="ng nh it lb b lc nb lf nc li nu lm nv lq nw lu nl nm nn no bi translated">使用jupyter笔记本浏览数据集。</li><li id="bc76" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">从笔记本迁移到python脚本</li><li id="b54d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">为您的应用程序设置虚拟环境</li><li id="ae5b" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">设置包的体系结构</li><li id="2243" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">包装管理器简介—毒性</li><li id="8483" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">包装要求</li><li id="1c21" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">构建包框架</li><li id="9f2e" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">CircleCI简介</li><li id="3ea3" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">公共与私有软件包Gemfury简介</li></ol></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="860d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">用于此项目的数据集</h1><p id="c841" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本教程中，我将使用Kaggle的房价数据集，它是免费的。我将使用它只是为了演示的目的；我会做一些原始数据处理。可以做更精密的分析；然而，我更喜欢保持简单，因为主要话题已经够复杂了。你可以在<a class="ae ky" href="https://github.com/salma71/prediction_app/tree/master" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中查看完整的项目。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="e71a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第一步:使用笔记本调查数据集</h1><p id="5b51" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在此步骤中，我们将执行以下操作:</p><ol class=""><li id="1e6d" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">探索数据集—汇总统计数据和EDA</li><li id="c773" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">建立回归模型并预测输出。</li><li id="de89" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">使用RMSE、梅度量标准评估模型性能。</li></ol><p id="b2c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将全部细节附在Kaggle笔记本上，并关联了如下链接:</p><ol class=""><li id="5010" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">数据分析<a class="ae ky" href="https://www.kaggle.com/salmaeng/data-exploration-medium-post-1/edit" rel="noopener ugc nofollow" target="_blank"> part_1 </a></li><li id="ba61" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">特色工程— <a class="ae ky" href="https://www.kaggle.com/salmaeng/feature-engineering-medium-post-2/edit" rel="noopener ugc nofollow" target="_blank">第二部分</a></li><li id="8fd3" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">特征选择— <a class="ae ky" href="https://www.kaggle.com/salmaeng/feature-selection-medium-post-3/edit" rel="noopener ugc nofollow" target="_blank">第三部分</a></li><li id="cd05" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">模型构建— <a class="ae ky" href="https://www.kaggle.com/salmaeng/feature-selection-medium-post-4/edit" rel="noopener ugc nofollow" target="_blank">第四部分</a></li></ol></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="b3aa" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第二步:设置包结构</h1><p id="7c74" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有很多好的搭建CLI包可以搭建一个标准的结构，比如<a class="ae ky" href="https://github.com/pyscaffold/pyscaffold" rel="noopener ugc nofollow" target="_blank"> pyscaffold </a>和许多其他的来设置包结构。然而，我发现对于非软件开发背景的人来说，这并不是很令人欣慰。所以我构建了一个脚手架模板，让你不用那么担心调试后端代码。可以参考Github 上的<a class="ae ky" href="https://github.com/salma71/ML_app_scaffold" rel="noopener ugc nofollow" target="_blank">源代码。你需要做的就是克隆或下载回购，然后按照说明开始。</a></p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="379f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第三步:设置脚本文件</h1><p id="a379" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">包树结构如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/f8b700802ec891193959867ccef71f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*445ULtG-V2MBd1h4ygKXPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">软件包主要模块的快照</p></figure><p id="2379" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让您的软件包正常运行是非常重要的。我们需要设置文件，以便包可以预测没有任何问题。在此步骤中，我们将进行以下操作:</p><ul class=""><li id="254d" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu ny nm nn no bi translated">设置<strong class="lb iu"> config.py </strong>文件→包含训练阶段使用的模型常数。</li><li id="dc3b" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu ny nm nn no bi translated">遵循OOP最佳实践，将<strong class="lb iu"> Jupyter笔记本</strong>转换成python脚本。</li><li id="97be" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu ny nm nn no bi translated">利用python中的日志记录→将代码从打印语句升级到日志记录——这在调试会话期间非常有用。</li></ul><ol class=""><li id="bf22" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">在<strong class="lb iu"> <em class="lv"> config.py </em> </strong>文件中，我试图依靠注释来帮助你跟进。在这个文件中，我们设置了在包中使用的常量变量，比如包路径、数据集路径、模型中使用的变量等。所以应该直截了当。</li><li id="f496" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">下载数据集并将其存储到包文件夹中指定的数据集文件夹中。</li><li id="8c8c" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="lv">data _ management . py</em></strong>负责加载数据，保存管道，将模型保存为pickle文件，最后删除之前持久化的旧模型。</li><li id="621f" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="lv"> errors.py </em> </strong>负责在调试会话期间引发自定义错误消息，帮助研究问题。</li><li id="6e05" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="lv"> features.py </em> </strong>包含数据转换逻辑——如果需要，可以随意添加更多转换</li><li id="6643" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="lv">preprocessor . py</em></strong>实现缺失值插补、分类变量编码等数据角力步骤。</li><li id="ec10" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="lv">validation . py</em></strong>确认数据有效——输入数据没有Nulls或NAs。</li><li id="144c" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><em class="lv"> pipeline.py </em>设置管道——构建模型所需执行的步骤。</li><li id="19bd" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="lv">train _ pipeline . py</em></strong>从根文件夹加载数据，将数据拆分成train和test，在训练集上拟合模型，最后保存管道是必不可少的。</li></ol><blockquote class="lw lx ly"><p id="aa5f" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">请注意，我们保留了与版本相关联的文件，这使得工作具有可追溯性和专业性。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="ab14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">10.<strong class="lb iu"> <em class="lv"> predict.py </em> </strong>根据建立的模型获得预测。如终端中所示，保存的模型是有版本的，因此您可以跟踪要选择哪个模型——日志记录非常棒。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预测. py</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/625552507a6bb0433e12adcd8360d785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RCFp3aSF_Lew4_61w5nxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日志消息的终端输出</p></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="f178" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第四步:包构建</h1><p id="95a6" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于包构建，我将使用<a class="ae ky" href="https://setuptools.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">设置工具</a>和<a class="ae ky" href="https://pypi.org/project/wheel/" rel="noopener ugc nofollow" target="_blank">滚轮</a>依赖项。这些允许您有效地构建和分发Python包，尤其是依赖于其他包的包。他们可以生成一个<strong class="lb iu"> <em class="lv"> dist </em> </strong>源分布文件，该文件包含<em class="lv"> .tar.gz </em>和。<em class="lv"> whl </em>也是扩展名文件。</p><p id="2234" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要做的就是更新setup.py文件来设置包元数据。此外，您需要更新tox.ini文件以包含包构建命令。在构建模型之后执行包构建命令是有意义的。一旦完成，这个包就可以在本地<strong class="lb iu">构建和安装了</strong>。在终端中运行以下命令:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="ebbd" class="oh mk it od b gy oi oj l ok ol">tox -e install_locally</span></pre><p id="dd51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在它将选择一个已经在<strong class="lb iu"> <em class="lv"> tox.ini </em> </strong>文件中定义的特定<em class="lv"> tox环境</em>。它将在<strong class="lb iu">内创建一个新的虚拟环境<em class="lv">。</em>托克斯</strong>目录。这个命令在第一次执行时会花费较长的时间，所以不要担心！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="951c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如图所示，输出与之前运行<em class="lv"> tox </em>的日志非常不同。这是因为它指定了所有由<strong class="lb iu"> <em class="lv">设置工具</em> </strong>命令完成的设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/9001dcfa84e2399ed346ccab092b51cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYEaJVlxkBl-KyEaFPIBhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行tox命令后的终端提示符</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/0b609e480bec21e5081a4d0ec4e81d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4M25DPm4Gpz2u4zws9564A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建包后文件夹结构的快照</p></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="d4bb" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第五步:在本地安装软件包</h1><p id="75bf" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在终端中，运行以下命令在本地安装软件包:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="00a6" class="oh mk it od b gy oi oj l ok ol">pip install -e .</span></pre><p id="4818" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">标签是在本地安装包，而。是指定包的根目录。</p><blockquote class="lw lx ly"><p id="3460" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">如果您不在包目录中，您需要指定包的路径而不是点。</p></blockquote><p id="f246" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，我们可以通过使用python启动python命令行来测试它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/da1019ded6ae8f5b5dc3d35f565c3d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*D1I07BDfTR-1i2qYKPL57w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在本地测试包</p></figure><p id="e0ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该软件包现已成功安装在您的计算机上，可以使用了。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="510a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">可选步骤:设置脚本从Kaggle获取数据集</h1><p id="4211" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">专注于构建高效模型的一种方法是从已知的API中自动获取数据集。这是一个有效的方法来确保你没有忘记下载数据或把它放在错误的目录中。我将利用<a class="ae ky" href="https://github.com/Kaggle/kaggle-api" rel="noopener ugc nofollow" target="_blank"> Kaggle API </a>来自动下载数据集。他们有一个友好的CLI工具，它很容易使用，会节省你大量的时间下载数据。</p><ol class=""><li id="bbdd" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">你应该有一个Kaggle账户，如果没有，你可以在这里注册<a class="ae ky" href="https://www.kaggle.com/account/login?phase=startRegisterTab&amp;returnUrl=%2F" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="c26d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">导航到我的帐户→ API →创建新的API令牌→将JSON文件保存在您的本地机器中。</li><li id="bdc8" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">将下面的代码片段放到脚本目录下的<strong class="lb iu"><em class="lv">fetch _ ka ggle _ dataset . sh</em></strong>中。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="7b9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您试图运行该文件，它会抛出一个错误，因为我们还没有设置API键。我们应该在接下来的步骤中设置CircleCI/CD管道时这样做。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="bd24" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第六步:建立CI/CD管道</h1><p id="e6ac" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">自动化包开发的各个阶段是非常必要的。同时，确保如果添加了更新的代码或新的功能，不会出现任何问题。这就是使用持续集成/部署和交付平台(CI/CD管道)的意义所在。根据下图，管道确保流程中的一切正常工作:</p><p id="2c80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">构建→测试→合并→自动发布到公共回购→自动部署</strong></p><p id="60d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多托管平台使用CI/CD管道，仅举几个例子:</p><ol class=""><li id="dd74" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><a class="ae ky" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI </a></li><li id="e9dc" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank">特拉维斯</a></li><li id="7efe" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://docs.gitlab.com/ee/ci/" rel="noopener ugc nofollow" target="_blank"> GitLab </a> CI</li><li id="6cc3" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">詹金斯和许多其他人..等等。</li></ol><p id="f7b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我以前用过Travis和Jenkins，所以我很好奇想在这个项目中尝试一下CircleCI。如果您曾经参与过任何开发-运营管道开发，它会有相同的操作和几乎相同的命令。尽管CircleCI集成了GitHub，但它只提供了一个免费的项目，用于在部署到Paas的过程中构建和禁用其他一些关于速度和缓存的特性。然而，其他主机平台的配置几乎相同。</p><blockquote class="lw lx ly"><p id="6b09" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">首先，我们需要使用以下步骤在circleci中设置Kaggle环境变量:</p><p id="3c4c" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">打开为kaggle API令牌下载的文件。</p><p id="cf49" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">进入CircleCI仪表板→项目名称→项目设置(在右上角)→环境变量→添加变量→</p><p id="305c" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">将名称设置为<code class="fe oo op oq od b">KAGGLE_USERNAME</code>，</p><p id="33aa" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">并将<strong class="lb iu"> <em class="it">值保存到你的kaggle用户名的JSON文件</em> </strong>中。</p><p id="f162" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">重复这个过程，将名为<code class="fe oo op oq od b">KAGGLE_KEY</code>的新变量添加到您的密钥值中。</p></blockquote><blockquote class="os"><p id="c866" class="ot ou it bd ov ow ox oy oz pa pb lu dk translated">根据文档，将这些环境变量命名为与上面相同的名称很重要，这样才能成功构建。</p></blockquote><figure class="pc pd pe pf pg kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="691f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用了Circleci文档提供的<a class="ae ky" href="https://circleci.com/docs/2.0/getting-started/#digging-into-your-first-pipeline" rel="noopener ugc nofollow" target="_blank">入门指南</a>；这很容易理解。这个脚本的作用是:</p><ol class=""><li id="da58" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">创建虚拟</li><li id="3f5f" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">激活它</li><li id="2ca0" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">升级pip命令</li><li id="074e" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">在包的根目录下安装requirements.txt文件</li><li id="ef2f" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">授予执行外壳文件的权限</li><li id="4ae6" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">获取数据集</li><li id="9f31" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">运行测试</li></ol><blockquote class="lw lx ly"><p id="375c" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">我在特定的github commit链接了基本的<a class="ae ky" href="https://github.com/salma71/prediction_app/blob/75f69b64512ab23bcf561bc3cb40703012f1dfe7/.circleci/config.yml" rel="noopener ugc nofollow" target="_blank"> config.yml </a>文件供你参考。</p></blockquote><p id="6030" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当一个新的git commit被推送到master，CircleCi就会运行测试，如果它有一个成功的构建，一个绿色的小勾就会出现在GitHub相应的commit附近。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/752425c2cb54cf9c04253aee14dd99af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yWIBebgWKw4JkuhXawNenQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CircleCi仪表板</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/16e910eb3c736faedf845a716f20341d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wdcq2KZIm4IU5r5KRmnsgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Github接口</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj oa l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://media.giphy.com/media/Zc1sReLPQDN6Cxsezw/giphy.gif" rel="noopener ugc nofollow" target="_blank">https://media.giphy.com/media/Zc1sReLPQDN6Cxsezw/giphy.gif</a></p></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="b637" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">第七步:发布到web</h1><p id="58ff" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">发布包有两个选项:</p><ol class=""><li id="15e3" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">将包公开-任何人都可以使用。你可以很容易地在<a class="ae ky" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">pypi.org</a>上发布这个关于pypi 文档的指南。</li><li id="fc0d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">将包设为私有-仅对特定用户可用。</li></ol><p id="f7bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将使包成为私有的，因为这将是你在现实生活中面临的情况。然而，公开软件包的步骤几乎是相同的。所以让我们开始吧。</p><p id="58f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是您需要开始的步骤:</p><ol class=""><li id="7303" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">Gemfury帐户—如果您还没有在此处注册<a class="ae ky" href="https://gemfury.com/" rel="noopener ugc nofollow" target="_blank"/>。Gemfury是一个托管库，可以托管私有包。</li><li id="8709" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">登录并导航至<strong class="lb iu">令牌→完全访问令牌→复制</strong></li><li id="6e56" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">然后导航到</li></ol><p id="2a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> CircleCI仪表盘→项目名称→项目设置(右上角)→环境变量→添加变量→ </strong></p><ul class=""><li id="e723" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu ny nm nn no bi translated">将名称设置为<code class="fe oo op oq od b">PIP_EXTRA_INDEX_URL</code>，</li><li id="d77b" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu ny nm nn no bi translated">和价值</li></ul><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="06b9" class="oh mk it od b gy oi oj l ok ol">https://${Full access token}@pypi.fury.io/${gemfury_username}</span></pre><p id="0913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将完全访问令牌和gemfury用户名替换为您自己的之后，您就可以开始下一步了— <a class="ae ky" href="https://gemfury.com/help/upload-packages/" rel="noopener ugc nofollow" target="_blank">您也可以按照文档</a>进行操作。</p><p id="003b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.在这一步，你需要一个shell脚本来发布这个包——<a class="ae ky" href="https://github.com/salma71/prediction_app/blob/0731f12e5de23492ea7ea0ae5620e63a88b56252/scripts/publish_model.sh" rel="noopener ugc nofollow" target="_blank">publish _ model . sh</a>，我按照这个<a class="ae ky" href="https://gist.github.com/nexdrew/8944bb8725edaaa72afa2509cd715d78" rel="noopener ugc nofollow" target="_blank">代码</a>做了一点调试和大量的<a class="ae ky" href="https://gemfury.com/help/pypi-server/#command-line" rel="noopener ugc nofollow" target="_blank">读取从这里</a>，这里<a class="ae ky" href="https://circleci.com/docs/2.0/using-shell-scripts/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="a208" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候通过添加发布包的新命令来更新Circleci config.yml了。</p><p id="d8d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您登录到您的gemfury帐户，您将会看到在packages选项卡下发布的包。唷！！！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/2b6dcd23263a5d3362d677a951664664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQZdRVi_7-1eIKpwievm2g.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/52b462916af91796d7caa28cd7cec512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSl7epJUMZRin_Zi9vEU9A.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pm oa l"/></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="8951" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论和要点</h1><p id="c050" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这个项目是比较中级的水平。我们探讨了许多需要包含在您的技能组合中的概念。我们探索的一些技能:</p><ol class=""><li id="0c5f" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">坚持练习写python脚本而不是笔记本是最精华的。当处理可伸缩的应用程序时，它将节省大量的时间。</li><li id="eddf" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://realpython.com/tutorials/best-practices/" rel="noopener ugc nofollow" target="_blank"> Python代码的最佳实践</a>。</li><li id="ebf8" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">了解根据您的需求定制软件包的基础知识— <a class="ae ky" href="https://docs.python-guide.org/writing/structure/" rel="noopener ugc nofollow" target="_blank">构建您的项目指南</a>。</li><li id="6e6b" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">分离关注点是保持你的代码有条理和可读性的一个很好的实践— <a class="ae ky" href="https://docs.python-guide.org/writing/style/" rel="noopener ugc nofollow" target="_blank">搭便车的指南代码风格</a>。</li><li id="1ccd" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">自动化流水线减少了错误和bug的机会— <a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"> sklearn文档</a>。</li><li id="43b3" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">将日志记录添加到源代码中，使调试变得更加容易— <a class="ae ky" href="https://www.loggly.com/ultimate-guide/python-logging-basics/" rel="noopener ugc nofollow" target="_blank">您的参考资料，了解关于日志记录和格式化程序</a>以及<a class="ae ky" href="https://docs.python.org/3.5/howto/logging-cookbook.html" rel="noopener ugc nofollow" target="_blank">日志记录指南</a>的更多信息。</li><li id="6bb9" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">花足够的时间规划工作流和架构对于质量非常重要— <a class="ae ky" href="https://realpython.com/python-application-layouts/" rel="noopener ugc nofollow" target="_blank">可选参考</a>。</li><li id="7536" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">了解业务问题并将其分解成小块使其易于管理— <a class="ae ky" href="https://softmedialab.com/blog/machine-learning-for-business/" rel="noopener ugc nofollow" target="_blank">可选参考</a> _1和<a class="ae ky" href="https://freeandopenmachinelearning.readthedocs.io/en/latest/ml-business-use.html" rel="noopener ugc nofollow" target="_blank">参考_2 </a>。</li></ol><blockquote class="lw lx ly"><p id="3dda" class="kz la lv lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">免责声明:如果您导航到</strong><a class="ae ky" href="https://github.com/salma71/prediction_app" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Github repo</strong></a><strong class="lb iu">，您会注意到我禁用了pytest包——单元测试被禁用。这是因为我想专注于部署，忽略单元测试中出现的任何问题。</strong></p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="38ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我完成了如何从头开始开发机器学习python包的第1部分。对我来说，这是一个令人愉快又富有挑战性的项目。在<a class="ae ky" rel="noopener" target="_blank" href="/how-to-deploy-your-first-machine-learning-models-part-2-9e1d0fcfb68">第2部分</a>中，我将利用这个包构建以下内容:</p><ol class=""><li id="e9f2" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">使用Flask app构建REST API端点</li><li id="9091" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">为完整的工作流程构建docker映像</li><li id="d4c3" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">使用Circleci将应用程序部署到Heroku</li><li id="07b6" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">使用streamlit构建前端接口。</li></ol><p id="3615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">敬请关注！</p><p id="5857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇教程让你对机器学习模型的完整生命周期有所了解。有问题就问吧；我很乐意帮忙！快乐学习！</p></div></div>    
</body>
</html>