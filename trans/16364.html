<html>
<head>
<title>How to Generate Time Series Considering Holidays of Any Country in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何生成考虑任何国家节假日的熊猫时间序列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-generate-time-series-considering-holidays-of-any-country-in-pandas-32506bc6abb9?source=collection_archive---------26-----------------------#2020-11-11">https://towardsdatascience.com/how-to-generate-time-series-considering-holidays-of-any-country-in-pandas-32506bc6abb9?source=collection_archive---------26-----------------------#2020-11-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/37512cf6e4f2aa13bfd0cc4673484095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-c1Ojsf8TkFlcjT2"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jg" href="https://unsplash.com/@smallcamerabigpictures?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Joost Crop </a>拍摄</p></figure><div class=""/><div class=""><h2 id="8213" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">如何使用美国假日日历，为任何目的或任何其他国家生成自定义假日日历，如何将日期序列合并到数据集中</h2></div><p id="686e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在时间序列数据分析中，生成日期在现实生活中的许多场合都是必要的。有时我们有数据，但时间没有记录，有时我们可能不得不使用一个国家的数据进行另一个国家的研究，或者今年使用去年的数据。今年的假期与去年不同，或者这个国家与另一个国家不同。这篇文章显示:</p><p id="fe38" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">a.如何使用内置的假日日历？</p><p id="872f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.生成自定义假日日历。</p><p id="ebeb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">c.将一系列日期合并到数据集中。</p><h1 id="2fed" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">考虑假期的时间序列</h1><ol class=""><li id="4681" class="mm mn jj la b lb mo le mp lh mq ll mr lp ms lt mt mu mv mw bi translated">生成一个考虑所有节假日的时间序列。</li></ol><p id="f7c1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">熊猫已经内置了美国假日日历。使用“CustomBusinessDay”功能生成自定义频率，传递内置的美国假日日历。使用此自定义工作日作为频率。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="0a95" class="ng lv jj nc b gy nh ni l nj nk"><strong class="nc jk">from</strong> pandas.tseries.holiday <strong class="nc jk">import</strong> USFederalHolidayCalendar<br/><strong class="nc jk">from</strong> pandas.tseries.offsets <strong class="nc jk">import</strong> CustomBusinessDay</span><span id="d297" class="ng lv jj nc b gy nl ni l nj nk">usb <strong class="nc jk">=</strong> CustomBusinessDay(calendar <strong class="nc jk">=</strong> USFederalHolidayCalendar())<br/>pd.date_range('7/1/2018', '7/10/2018', freq=usb)</span><span id="9891" class="ng lv jj nc b gy nl ni l nj nk">#Output:<br/>DatetimeIndex(['2018-07-02', '2018-07-03', '2018-07-05', '2018-07-06', '2018-07-09', '2018-07-10'],               dtype='datetime64[ns]', freq='C')</span></pre><p id="a008" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我用的范围是7月1日到7月10日。看输出。7月3日之后是7月5日。因为7月4日是假日。</p><p id="c9f5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.现在，我将向你展示如何制作你的定制假日日历。如果你的客户不是美国人，你必须做一个定制的假日日历。因为其他国家的假期和美国不一样。</p><p id="bce1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了简化本教程，假设我是一家大公司的老板。我宣布我的周年纪念日为公司假日。虽然这不太可能。我这样做只是为了演示如何制作一个自定义的假日日历。</p><p id="67f4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">熊猫图书馆让你使用他们的类来修改和制作你自己的。在<a class="ae jg" href="https://github.com/pandas-dev/pandas/blob/master/pandas/tseries/holiday.py" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk">这一页的最后</strong> </a> <strong class="la jk">，</strong>你会发现类‘USFederalHolidayCalendar’是这样的:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="bfca" class="ng lv jj nc b gy nh ni l nj nk">class USFederalHolidayCalendar(AbstractHolidayCalendar):<br/>    """<br/>    US Federal Government Holiday Calendar based on rules specified by:<br/>    <a class="ae jg" href="https://www.opm.gov/policy-data-oversight/" rel="noopener ugc nofollow" target="_blank">https://www.opm.gov/policy-data-oversight/</a><br/>       snow-dismissal-procedures/federal-holidays/<br/>    """<br/>    rules = [<br/>        Holiday("New Years Day", month=1, day=1, observance=nearest_workday),<br/>        USMartinLutherKingJr,<br/>        USPresidentsDay,<br/>        USMemorialDay,<br/>        Holiday("July 4th", month=7, day=4, observance=nearest_workday),<br/>        USLaborDay,<br/>        USColumbusDay,<br/>        Holiday("Veterans Day", month=11, day=11, observance=nearest_workday),<br/>        USThanksgivingDay,<br/>        Holiday("Christmas", month=12, day=25, observance=nearest_workday),<br/>    ]</span></pre><p id="9a93" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，修改名称和规则来制作一个定制的假日日历。我假设我的周年纪念日是3月20日。使用“遵守”作为“最近工作日”。这意味着如果指定的日期是周末，假日日历将自动将最近的工作日作为假日。“遵守”几乎没有其他选择。分别是:<strong class="la jk">'周日_至_周一'，'下周_周一_或_周二'，'之前_周五'，'下周_周一'</strong>。请随意自己尝试。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="f128" class="ng lv jj nc b gy nh ni l nj nk">from pandas.tseries.holiday import AbstractHolidayCalendar, nearest_workday, Holidayclass </span><span id="7a57" class="ng lv jj nc b gy nl ni l nj nk">MyAnniversaryCalendar(AbstractHolidayCalendar):<br/>    rules = [<br/>        Holiday("MyAnniversary", month=3, day=20, observance = nearest_workday)<br/>    ]</span></pre><p id="945f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我做了我的周年日历。使用此类“MyAnniversaryCalendar”自定义频率，并将其用作“freq”参数的值。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="74e0" class="ng lv jj nc b gy nh ni l nj nk">myday = CustomBusinessDay(calendar=MyAnniversaryCalendar())</span><span id="f823" class="ng lv jj nc b gy nl ni l nj nk">pd.date_range('3/15/2020', periods=12, freq=myday)</span><span id="37c3" class="ng lv jj nc b gy nl ni l nj nk">#Output:<br/>DatetimeIndex(['2020-03-16', '2020-03-17', '2020-03-18', '2020-03-19', '2020-03-23', '2020-03-24', '2020-03-25', '2020-03-26',                '2020-03-27', '2020-03-30', '2020-03-31', '2020-04-01'],               dtype='datetime64[ns]', freq='C')</span></pre><p id="8a10" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请看一下输出。3月19日之后，是3月23日。有一个三天的周末！</p><p id="8515" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.一些国家有不同的工作日。例如，像埃及、卡塔尔这样的国家将星期五和星期六作为周末。所以，他们的假日日历应该是不同的。以下是如何定义和使用每周工作日:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="019a" class="ng lv jj nc b gy nh ni l nj nk">b = CustomBusinessDay(weekmask = 'Sun Mon Tue Wed Thu')<br/>pd.date_range('6/20/2020', '6/30/2020', freq=b)</span><span id="3f8e" class="ng lv jj nc b gy nl ni l nj nk">#Output:<br/>DatetimeIndex(['2020-06-21', '2020-06-22', '2020-06-23', '2020-06-24', '2020-06-25', '2020-06-28', '2020-06-29', '2020-06-30'],               dtype='datetime64[ns]', freq='C')</span></pre><p id="c208" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查输出中缺少的日期。你会看到它们是星期五和星期六。</p><h1 id="a60a" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">在数据集中使用日期序列</h1><p id="2f7d" class="pw-post-body-paragraph ky kz jj la b lb mo kk ld le mp kn lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在本节中，我们将使用由date_range函数生成的一系列日期，并在数据集中使用它。在这个练习中，我使用了<a class="ae jg" href="https://github.com/rashida048/Datasets/blob/master/FB_data_with_no_date.csv" rel="noopener ugc nofollow" target="_blank">脸书股票数据集</a>。首先导入数据集:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="82c4" class="ng lv jj nc b gy nh ni l nj nk">df = pd.read_csv('FB_data_with_no_date.csv')<br/>df.head()</span></pre><figure class="mx my mz na gt iv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/bda64c5ea144d04cdceb5e509a5811f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/0*08aCtvZotZVFIK_a.png"/></div></figure><p id="0fd2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，生成时间序列，其中开始日期是2020年1月1日，“周期”是数据集的长度，频率</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="d7b5" class="ng lv jj nc b gy nh ni l nj nk">rng = pd.date_range('1/1/2020', periods = len(df), freq='B')</span></pre><p id="d157" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将此时间序列设置为脸书股票数据集的索引。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="ed1e" class="ng lv jj nc b gy nh ni l nj nk">df.set_index(rng, inplace=True)<br/>df.head()</span></pre><figure class="mx my mz na gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nq"><img src="../Images/51bc14cd97551769473c579b9d56a4ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/0*j_3CuD5EPtCSDJ7Y.png"/></div></div></figure><p id="9990" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是时间序列数据集，可用于时间序列数据分析或预测。</p><h1 id="a732" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">结论</h1><p id="8db4" class="pw-post-body-paragraph ky kz jj la b lb mo kk ld le mp kn lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在时间序列分析中，处理节假日是正常的。在不同的文化和不同的国家，有不同的时区和不同的节日。所以，如果你处理时间序列数据，你会经常用到这个。希望这篇文章对你有帮助！</p><h2 id="fcfb" class="ng lv jj bd lw nr ns dn ma nt nu dp me lh nv nw mg ll nx ny mi lp nz oa mk ob bi translated">更多阅读:</h2><div class="is it gp gr iu oc"><a rel="noopener follow" target="_blank" href="/an-ultimate-cheat-sheet-for-data-visualization-in-pandas-4010e1b16b5c"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jk gy z fp oh fr fs oi fu fw ji bi translated">熊猫数据可视化的终极备忘单</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">熊猫的所有基本视觉类型和一些非常高级的视觉…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ja oc"/></div></div></a></div><div class="is it gp gr iu oc"><a rel="noopener follow" target="_blank" href="/an-ultimate-cheat-sheet-for-numpy-bb1112b0488f"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jk gy z fp oh fr fs oi fu fw ji bi translated">Numpy的终极备忘单</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">对学习也有好处</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq ja oc"/></div></div></a></div><div class="is it gp gr iu oc"><a rel="noopener follow" target="_blank" href="/introduction-to-the-descriptive-statistics-a050b5ec99fb"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jk gy z fp oh fr fs oi fu fw ji bi translated">描述统计学导论</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">对最基本和广泛使用的描述性统计方法有清晰和详细的理解</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq ja oc"/></div></div></a></div><div class="is it gp gr iu oc"><a rel="noopener follow" target="_blank" href="/great-quality-free-courses-to-learn-machine-learning-and-deep-learning-1029048fd0fc"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jk gy z fp oh fr fs oi fu fw ji bi translated">学习机器学习和深度学习的优质免费课程</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">顶级大学高质量免费课程的链接</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="ot l on oo op ol oq ja oc"/></div></div></a></div><div class="is it gp gr iu oc"><a rel="noopener follow" target="_blank" href="/all-the-datasets-you-need-to-practice-data-science-skills-and-make-a-great-portfolio-857a348883b5"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jk gy z fp oh fr fs oi fu fw ji bi translated">练习数据科学技能和制作优秀投资组合所需的所有数据集</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">一些有趣的数据集提升你的技能和投资组合</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="ou l on oo op ol oq ja oc"/></div></div></a></div><div class="is it gp gr iu oc"><a rel="noopener follow" target="_blank" href="/a-complete-recommender-system-from-scratch-in-python-step-by-step-6fc17a4da054"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jk gy z fp oh fr fs oi fu fw ji bi translated">一个完整的推荐系统从零开始:一步一步</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">基于用户评分的线性回归电影推荐系统</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="ov l on oo op ol oq ja oc"/></div></div></a></div></div></div>    
</body>
</html>