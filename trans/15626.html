<html>
<head>
<title>Uprooting anomalies in online user behavior</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">根除在线用户行为中的异常现象</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/uprooting-anomalies-in-online-user-behavior-34d88ab65035?source=collection_archive---------46-----------------------#2020-10-27">https://towardsdatascience.com/uprooting-anomalies-in-online-user-behavior-34d88ab65035?source=collection_archive---------46-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2099" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="777f" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">用于识别异常在线活动根本原因的比较马尔可夫链分析</h2></div><p id="c2a7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">作为一名训练有素的认知神经科学家，我有理解人类行为和信息如何引导决策的经验。现在，随着我转变为一名数据科学家，部分由于我在<a class="ae lk" href="https://insightfellows.com/" rel="noopener ugc nofollow" target="_blank"> Insight </a>的<a class="ae lk" href="https://insightfellows.com/data-science" rel="noopener ugc nofollow" target="_blank">数据科学奖学金</a>，我开始了解到许多其他在更大范围内跟踪和理解行为的媒介和方法。</p><p id="cc0c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在我的研究员生涯中，我为一家软件公司<a class="ae lk" href="https://www.lazylantern.com/" rel="noopener ugc nofollow" target="_blank"> Lazy Lantern </a>做顾问，该公司协助其他公司监控客户如何与他们的在线平台互动。更具体地说，Lazy Lantern为其客户公司提供对其网站和iOS/Android应用程序的自动监控和分析，从而了解这些平台上的客户流量、互动和整体行为。</p><h1 id="5db4" class="ll lm iq bd ln lo lp lq lr ls lt lu lv kf lw kg lx ki ly kj lz kl ma km mb mc bi translated"><strong class="ak">问题</strong></h1><p id="d1cb" class="pw-post-body-paragraph ko kp iq kq b kr md ka kt ku me kd kw kx mf kz la lb mg ld le lf mh lh li lj ij bi translated">为了理解Lazy Lantern如何跟踪客户行为，让我们考虑一个典型零售网站的用户旅程，如下图所示。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mi"><img src="../Images/afe45d3c6bcf8f6df4f777eb2978d19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R1m0DZV2FYIR82I66FVAKQ.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">图一。</strong>这些是反复出现的链接或事件，客户通常会点击这些链接或事件在零售网站上购物。[图片由作者提供]</p></figure><p id="6bb9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在主页上，客户可以点击产品列表，然后锁定感兴趣的产品，将该产品添加到购物车中，最后结账。考虑到在给定的时间内，网站上会有许多这样的客户交互，Lazy Lantern使用时间序列模型Prophet来预测给定链接或事件(如产品列表、产品等)的交互率。)在给定时间段内。Prophet模型每小时评估一次这些事件的预期点击数，并得出给定时间段的预期正常点击数范围。<em class="mz">要了解更多关于Prophet模型如何在Lazy Lantern中使用以及提高其检测效率的方法，请查看我的Insight同事</em> <a class="ae lk" href="https://medium.com/@yeonjoosmith/f17677f8f771" rel="noopener"> <em class="mz"> Yeonjoo Smith的博客这里</em> </a> <em class="mz">。</em></p><p id="a67d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果客户与这些链接的交互次数高于或低于模型预测的范围，算法将触发<strong class="kq ja"> <em class="mz">异常</em> </strong>，并向客户公司发出警报。虽然该模型能够检测出这些事件<em class="mz">中每一个单独</em>的用户交互率的异常，但它无法确定触发的异常是否实际上是平台上事件的<em class="mz">连锁反应的一部分。</em></p><p id="e1e9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">例如，让我们考虑与以前相同的用户旅程，但这次它被中断了，如下图所示。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi na"><img src="../Images/146ee3805e1c712c9f3eaba619be32e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRLlYJDhtwdW_Hfv595r1g.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">图二。有时零售网站上的链接可能会断开，这导致在一系列事件中点击后续链接的用户数量下降。[图片由作者提供]</strong></p></figure><p id="d853" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在这里，客户再次从主页进入，单击产品列表，单击感兴趣的产品，但是由于一些故障，他们无法将产品添加到购物车中。在这种情况下，该算法将对“添加到购物车”和“结账”事件发出异常警报；然而，除此之外，它无法向客户提供任何信息。</p><p id="bfce" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在本例中(<strong class="kq ja">图2 </strong>)，可能是“添加到购物车”按钮被破坏，这导致了级联效应，导致“结账”按钮也被破坏。然而，该算法只是将这些识别为独立的异常，而不一定是事件之间的重叠和关系。<strong class="kq ja">因此，提出了这个项目的中心问题:我们如何识别哪个事件是这些重叠触发异常的潜在根本原因？</strong>查明这些连锁异常效应的根本原因将为客户公司提供关于其平台上潜在问题的更细致的反馈，然后他们可以快速解决这些问题，以确保未来的客户满意度，避免不必要的收入损失。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="a227" class="ll lm iq bd ln lo ni lq lr ls nj lu lv kf nk kg lx ki nl kj lz kl nm km mb mc bi translated"><strong class="ak">数据</strong></h1><p id="0194" class="pw-post-body-paragraph ko kp iq kq b kr md ka kt ku me kd kw kx mf kz la lb mg ld le lf mh lh li lj ij bi translated">虽然在上面的例子中很容易理解什么事件是问题的根本原因，但实际上，答案是…不那么简单。在调查实际公司平台的客户行为时，会发生多个用户和用户交互，但并非所有用户和用户交互都清晰、整齐地对应于触发的异常。为了建立一个可扩展的、通用的模型来封装跨不同平台和用例的潜在用户交互的复杂性，我必须首先收集相关的数据。</p><p id="f464" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对于给定的客户公司，发生的每个事件异常都存储在InfluxDB数据库中，带有相应的事件标签、违规的开始和结束时间以及发生异常的平台(即web、iOS或Android)。累积这些异常计算的原始用户交互存储在MongoDB数据库中，按公司和平台划分；其中包含事件标签、用户身份和用户与事件交互的时间戳。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nn"><img src="../Images/a82b5abf1cf876490f0d92d01c9fa6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ev-GVroPxRjBy582PicD5w.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">图3。</strong>这里描述的解决方案使用的数据分布在InfluxDB和MongoDB上。异常事件通过Prophet算法聚合，原始事件对应于这些异常事件，是单独的交互。[图片由作者提供]</p></figure><p id="7527" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，我评估了异常事件列表，并评估了哪些异常在时间上相互重叠。这些是<em class="mz">连锁异常</em>，在真实数据中，它们通常在2到15个异常事件之间。我们可以将异常之间的时间重叠称为<strong class="kq ja"> <em class="mz">异常周期</em> </strong>。考虑到我们最初的例子,“添加到购物车”和“结帐”这两个异常事件发生的时间段将导致一个这样的异常时间段，因为它们的警报在时间上重叠。</p><p id="d5d2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在生成那些重叠的、连锁的异常的列表之后，我通过在异常时段和原始事件之间进行时间匹配，提取了在结果异常时段内发生的<strong class="kq ja"> <em class="mz">原始事件</em> </strong>。现在有了这些原始事件，我们可以尝试查明哪个事件是级联异常的<em class="mz">起因</em>或<em class="mz">根本原因</em>。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="932c" class="ll lm iq bd ln lo ni lq lr ls nj lu lv kf nk kg lx ki nl kj lz kl nm km mb mc bi translated"><strong class="ak">解决方案</strong></h1><p id="5f8f" class="pw-post-body-paragraph ko kp iq kq b kr md ka kt ku me kd kw kx mf kz la lb mg ld le lf mh lh li lj ij bi translated">有了对应于异常时期的原始事件列表，我现在必须找出异常时期的根本原因是什么。异常时期的原始事件数以千计，当然与时期的长度直接相关。因此，当务之急是找到解决根本原因问题的解决方案，即:</p><ol class=""><li id="f600" class="no np iq kq b kr ks ku kv kx nq lb nr lf ns lj nt nu nv nw bi translated"><strong class="kq ja">快速<br/> </strong>由于在给定的异常时段内需要解析的事件数量庞大，因此需要部署的解决方案必须省时且易于实施。</li><li id="93b2" class="no np iq kq b kr nx ku ny kx nz lb oa lf ob lj nt nu nv nw bi translated"><strong class="kq ja">灵活<br/> </strong>因为Lazy Lantern有超过160家客户公司，每家公司都有多个平台，所以解决方案必须与数据无关，并且不需要过度定制。</li></ol><p id="6135" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">考虑到这些限定条件，我的解决方案是利用马尔可夫链模型并进行一些比较分析。马尔可夫链是一个<a class="ae lk" href="https://brilliant.org/wiki/markov-chains/#:~:text=A%20Markov%20chain%20is%20a,possible%20future%20states%20are%20fixed." rel="noopener ugc nofollow" target="_blank">“根据某些概率规则经历从一种状态到另一种状态的转换的数学系统…其中转换到任何特定状态的概率仅取决于当前状态。”</a>为了将这个定义与手头的问题直接联系起来，马尔可夫链模型将能够告诉你在给定的时间段内用户从一个事件转移到另一个事件的可能性。</p><p id="2bfb" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对于异常时间段，我决定用户如何遍历相关事件，跟踪哪个事件紧跟在前一个事件之后。然后，在对给定事件的所有用户的交互进行平均后，我通过创建逐个事件的马尔可夫矩阵(即矩阵中的所有列总和为1)，生成了用户将从一个事件转移到另一个事件的<strong class="kq ja"><em class="mz"/></strong>。</p><p id="94d1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个转换矩阵在x轴和y轴上向我们展示了用户在这个异常的时间段内经历的所有原始事件。为了公司数据的匿名性，这些事件在图4中用数字表示，但是这些数字本质上对应于初始示例中的事件，例如“将产品添加到购物车”、“结账”等。矩阵中每个单元的值对应于从一个事件(x轴上编号的事件)遍历到下一个事件(y轴上编号的事件)的用户比例。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oc"><img src="../Images/ae78712ddb4b45ed24ad11ec6cf22ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ttCDcl4lPZ2haSwOTugk2w.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">图4。为了查明异常的潜在根本原因，我进行了比较马尔可夫链分析。在这个分析中，我从一个正常的时间段减去了事件转换，从异常的时间段回溯到正好一周之前。这产生了一个差异得分矩阵，它展示了两个时间段之间的概率变化。该矩阵允许人们看到哪个事件转换(x轴上的事件到y轴上的事件)导致两个时间匹配的时间段之间用户之间的事件转换的最大变化。[图片由作者提供]</strong></p></figure><p id="30e1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">既然我已经生成了异常时期的马尔可夫链转移矩阵，我需要某种基线来与之比较。该基线是通过提取在相同的确切时间段内发生的原始事件而获得的，但是回溯到异常时段之前的一周，其中没有检测到异常。我认为这将是一个很好的代理，说明在没有任何站点问题的类似“正常”时间段内，用户的事件遍历是如何发生的。对于这个正常的时间段，我再次以完全相同的方式生成了一个转移矩阵。</p><p id="4899" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在有了异常时段的转移矩阵和相似时间匹配的非异常时段的转移矩阵，我决定用<strong class="kq ja"> <em class="mz">比较</em> </strong>它们之间的概率:从异常矩阵中减去正常矩阵。得到的矩阵将由两个时间段的两个概率的增量变化组成(<strong class="kq ja">图4 </strong>)。</p><p id="f2ab" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个概率差异得分矩阵告诉我们，在两个时间段之间的<em class="mz">相同事件</em>之间，用户的转换可能性有多大差异。回到我们最初的例子，如果我们跟踪正常日子里与我们的零售网站互动的客户的转变(<strong class="kq ja">图1 </strong>)，然后将其与零售网站行为不当的时间(<strong class="kq ja">图2 </strong>)进行比较，从差异得分矩阵中，我们会看到在这两个时间段内转变的比例差异在事件“将产品添加到购物车”和“结账”之间这表明，与网站上的这些事件相对应的最终行动应该得到解决，以便纠正这种异常现象。</p><p id="ea25" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这种解决方案是理想的，因为无论客户及其不同的业务类型和事件如何，它都能很好地执行。具体来说，马尔可夫链矩阵只跟踪客户正在交互的事件，因此不知道具体的数据类型。借助该解决方案，我可以明确指出给定客户端平台上的哪些事件或操作导致了通常的流量行为，从而找到异常的根本原因。凭借这种洞察力，Lazy Lantern可以将客户平台的具体痛点传递给客户，然后客户可以在他们的网站或应用程序上有效地解决这些问题。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="5e73" class="ll lm iq bd ln lo ni lq lr ls nj lu lv kf nk kg lx ki nl kj lz kl nm km mb mc bi translated"><strong class="ak">产品</strong></h1><p id="78f0" class="pw-post-body-paragraph ko kp iq kq b kr md ka kt ku me kd kw kx mf kz la lb mg ld le lf mh lh li lj ij bi translated">为了使解决方案可扩展，我决定创建并部署一个<a class="ae lk" href="https://www.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>仪表板。有了这个仪表板，Lazy Lantern可以在一个地方轻松检查所有客户的消费行为。通过下拉菜单，用户可以选择他们感兴趣的客户端，选择该客户端的特定平台(即web、iOS或Android)，然后从InfluxDB链接列表中选择该特定客户端和平台的相关异常。在选择了特定的异常之后，从MongoDB中提取与该异常及其时间匹配的非异常相对应的原始事件，并部署上述矩阵解决方案。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi od"><img src="../Images/0f6eaa08de3b1c3c85e97133146cab73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-EpGE2xwOzx-Ew3_js-_A.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">图5。</strong>Streamlit仪表盘允许用户专门关注公司、平台和异常情况。结果输出允许判断哪些事件转变导致异常和非异常时间段之间用户行为的最大变化。了解事件转换中的这些变化有助于了解哪些事件可能是异常的根本原因。[图片由作者提供]</p></figure><p id="0c10" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">仪表板输出结果矩阵，如图4所示；Lazy Lantern可以直观地检查差异矩阵，以发现哪些事件导致了两个时间段之间的变化。此外，仪表板还输出一个摘要图(<strong class="kq ja">图5 </strong>)，该图突出显示了导致两个时间段之间最大概率变化(正和负)的前五个事件转换。有了这个摘要，Lazy Lantern可以快速评估客户平台上的哪些事件转换对客户行为的变化影响最大，并相应地提醒他们的客户。</p><p id="e833" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">该仪表板是该解决方案的理想产品，因为人们可以轻松、相对快速地在客户端和异常之间切换，而不必修改内部代码来访问数据并将其与相应的解决方案匹配。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="cacd" class="ll lm iq bd ln lo ni lq lr ls nj lu lv kf nk kg lx ki nl kj lz kl nm km mb mc bi translated"><strong class="ak">未来考虑</strong></h1><p id="8951" class="pw-post-body-paragraph ko kp iq kq b kr md ka kt ku me kd kw kx mf kz la lb mg ld le lf mh lh li lj ij bi translated">这个项目从构思到实施，历时约三周。虽然这里详细描述的解决方案快速灵活，但有了更多的时间和数据，我的解决方案还可以改进，为用户提供更多定制的反馈。在当前的解决方案中，我只研究了给定平台上事件之间的单步转换。其他需要考虑的是多个步骤的事件链，不仅仅是上一次或下一次点击。这将有助于洞察客户采取的多种类型的“典型”活动路线，例如购买商品的路线，阅读更多关于公司的信息并找到其社交媒体平台的另一条路线。这些高阶马尔可夫链将允许向客户提供更多关于异常用户流量的定制反馈。</p><p id="0a9a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">补充该解决方案的另一个考虑可能是为每个客户公司训练定制的隐马尔可夫模型，以获得存在于他们平台中的事件状态的表示。这将为我们提供比我们从当前解决方案中得到的快照分布更稳定的事件转移概率分布。然而，这种方法的一个警告是，它不仅需要大量数据来生成模型，而且它不会如此容易或快速地适应客户可能在平台中做出的更改，并且必须不断更新和重新训练。</p><p id="780b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我要感谢Lazy Lantern，特别是Bastien Beurier，给我机会研究这个问题。这是我第一次提供以业务为中心的解决方案，我非常感谢我得到的支持和反馈。这对您刚刚阅读完的数据解决方案和产品至关重要！你可以在我的GitHub上找到代码和一些样本数据。</p></div></div>    
</body>
</html>