<html>
<head>
<title>How to Handle Typos in Elasticsearch Using Fuzzy Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用模糊查询处理弹性搜索中的错别字</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-handle-typos-in-elasticsearch-using-fuzzy-query-8d3843a8cff3?source=collection_archive---------9-----------------------#2020-10-10">https://towardsdatascience.com/how-to-handle-typos-in-elasticsearch-using-fuzzy-query-8d3843a8cff3?source=collection_archive---------9-----------------------#2020-10-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5087" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="c054" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Elasticsearch轻松处理错别字，改善用户体验</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d3c5841cce9646f28aeae6a868cfd1e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4x5Z4TKEZcPX9EfO"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@dearseymour?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ksenia Makagonova </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a6be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">错别字是经常发生的事情，会降低用户的体验，幸运的是，Elasticsearch可以通过模糊查询轻松处理它。</p><p id="17be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你正在用Elasticsearch构建一个高级的自动完成系统，处理输入错误是必须的。</p><p id="bba8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你想创建一个简单的，你可以阅读我的其他文章“<a class="ae lh" href="https://medium.com/better-programming/create-a-simple-autocomplete-with-elasticsearch-852c47109deb" rel="noopener">用Elasticsearch创建一个简单的自动完成功能</a>”。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="89ed" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">什么是模糊逻辑</h1><p id="5982" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">模糊逻辑是一种数学逻辑，其中变量的真值可以是0到1之间的任何数字。这与只有真值0或1的布尔逻辑不同。</p><p id="8802" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在弹性搜索中，模糊查询意味着查询中的术语不必与倒排索引中的术语完全匹配。</p><p id="8a64" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了计算查询之间的距离，Elasticsearch使用<a class="ae lh" href="https://en.wikipedia.org/wiki/Levenshtein_distance" rel="noopener ugc nofollow" target="_blank"> Levenshtein距离算法</a>。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="13a0" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">如何使用Levenshtein距离算法计算距离</h1><p id="5458" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">用Levenshtein距离算法计算距离很容易。</p><p id="5c2e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你只需要把第一个和第二个单词一个字符一个字符的比较。</p><p id="b258" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果字符不同，那么你可以将单词之间的距离加一。</p><p id="08d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们来看一个例子，如何计算常见错别字<code class="fe ni nj nk nl b">"Gppgle"</code>与正确字<code class="fe ni nj nk nl b">"Google"</code>的距离。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/39099fa05689a2522018ed2541b56ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/0*ZTXaZlcY3de3nuMn"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">弹性搜索模糊查询:Levenshtein距离</p></figure><p id="2e5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们用Levenshtein距离算法计算出<code class="fe ni nj nk nl b">"Gppgle"</code>和<code class="fe ni nj nk nl b">"Google"</code>之间的距离后，我们可以看到距离为2。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="394d" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">弹性搜索中的模糊查询</h1><p id="fa24" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">使用模糊查询处理Elasticsearch中的输入错误也很简单。</p><p id="f82e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们以错别字<code class="fe ni nj nk nl b">"Gppgle"</code>为例。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="7d5b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们使用普通匹配查询时，Elasticsearch将在搜索到Elasticsearch之前首先分析查询<code class="fe ni nj nk nl b">"gppgle"</code>。</p><p id="bf19" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">倒排索引中唯一的术语是<code class="fe ni nj nk nl b">“google”</code>，它与术语<code class="fe ni nj nk nl b">"gppgle"</code>不匹配。因此，Elasticsearch不会返回任何结果。</p><p id="84d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们在匹配查询中尝试Elasticsearch的fuzzy。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="13b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如你所见，使用fuzzy，Elasticsearch返回了一个响应。</p><p id="5c48" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们以前学过<code class="fe ni nj nk nl b">"gppgle"</code>和<code class="fe ni nj nk nl b">"google"</code>的距离是2。</p><p id="f2ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在查询中，我们插入了<code class="fe ni nj nk nl b">"fuzziness":"AUTO"</code>而不是一个数字。为什么会起作用？</p><p id="e762" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们在<code class="fe ni nj nk nl b">"fuzziness"</code>字段中使用<code class="fe ni nj nk nl b">"AUTO"</code>值，Elasticsearch将确定什么样的模糊距离是合适的。</p><p id="be9f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于6个字符，Elasticsearch默认情况下将允许2个编辑距离。</p><p id="dff3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">模糊性更好，但是如果你愿意，你可以用一个精确的数字来调整它。</p><p id="6ba7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们用一个确切的数字来证明<code class="fe ni nj nk nl b">"gppgle"</code>和<code class="fe ni nj nk nl b">"google"</code>的距离为2。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="9f1a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们使用<code class="fe ni nj nk nl b">"fuzziness":"1"</code>时，Elasticsearch没有返回任何结果。</p><p id="5aa9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不过，使用<code class="fe ni nj nk nl b">"fuzziness":"2"</code>，Elasticsearch返回了文档<code class="fe ni nj nk nl b">"google"</code>。</p><p id="aba7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这证明了我们之前用Levenshtein距离算法对<code class="fe ni nj nk nl b">"gppgle"</code>和<code class="fe ni nj nk nl b">"google"</code>的距离计算，结果是2。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="cf5b" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">弹性搜索中的两种模糊查询</h1><p id="64ab" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">在前面的例子中，我们使用模糊查询作为匹配查询中的参数。</p><p id="0846" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是还有另一种方法来使用模糊特性，即模糊查询。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0234" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好像是一样的！那么，它们有什么区别呢？</p><h2 id="dbb8" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">模糊查询</h2><p id="0b35" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">模糊查询的工作方式类似于术语查询，对Elasticsearch的查询不经过分析，也不用于搜索倒排索引。</p><p id="4844" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们再索引一个文档<code class="fe ni nj nk nl b">"Hong Kong"</code>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="7831" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看看分析器用Elasticsearch的Analyze API产生了哪些术语。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="c6b6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，<code class="fe ni nj nk nl b">standard_analyzer</code>产生了两个术语，<code class="fe ni nj nk nl b">"hong"</code>和<code class="fe ni nj nk nl b">"kong"</code>。</p><p id="c38a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你读了我的另一篇文章“<a class="ae lh" href="https://medium.com/better-programming/elasticsearch-text-vs-keyword-2ccb99ec72ae" rel="noopener">elastic search:Text vs . Keyword</a>”，你就会知道如果我们使用一个术语查询来搜索<code class="fe ni nj nk nl b">"Hong Kong"</code>，那么我们不会得到任何结果。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="764d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是因为在Elasticsearch中没有与<code class="fe ni nj nk nl b">"Hong Kong"</code>的编辑距离小于2的术语。</p><p id="7c18" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们用<code class="fe ni nj nk nl b">"Hpng"</code>试试模糊查询。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="7a62" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查询中的术语<code class="fe ni nj nk nl b">"Hpng"</code>和弹性搜索中的术语<code class="fe ni nj nk nl b">"hong"</code>的距离为2。</p><p id="a6bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请记住，被查询的术语和倒排索引中的术语是区分大小写的，距离“2”来自于<code class="fe ni nj nk nl b">"Hp"</code>和<code class="fe ni nj nk nl b">"ho"</code>之间的差值。</p><h2 id="2bef" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">用模糊性参数匹配查询</h2><p id="1c25" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">带模糊参数的匹配查询比模糊查询更好。查询中的分析器将在将查询搜索到倒排索引之前对其进行分析。</p><p id="393e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们尝试与模糊查询部分相同的查询。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="f201" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不出所料，两个查询都返回了结果！</p><p id="498e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第一个查询，<code class="fe ni nj nk nl b">"Hpng Kong"</code>被解析为<code class="fe ni nj nk nl b">"hpng"</code>和<code class="fe ni nj nk nl b">"kong"</code>。术语<code class="fe ni nj nk nl b">"hpng"</code>和<code class="fe ni nj nk nl b">"kong"</code>都存在于倒排索引中。</p><p id="fd6d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ni nj nk nl b">"hpng"</code>和<code class="fe ni nj nk nl b">"hong"</code>匹配距离为1。而<code class="fe ni nj nk nl b">"kong"</code>和<code class="fe ni nj nk nl b">"kong"</code>完美匹配。</p><p id="d1d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您计划使用匹配查询，需要注意的一点是查询中的每个术语都允许模糊性。</p><p id="b844" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以尝试使用<code class="fe ni nj nk nl b">"fuzziness":2</code>用<code class="fe ni nj nk nl b">"hggg kggg"</code>查询，它与<code class="fe ni nj nk nl b">"Hong Kong"</code>的编辑距离为4。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1700" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，Elasticsearch返回了一个结果。</p><p id="912f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是因为分析器将查询<code class="fe ni nj nk nl b">"hggg kggg"</code>分析为术语<code class="fe ni nj nk nl b">"hggg"</code>和<code class="fe ni nj nk nl b">"kggg"</code>。</p><p id="a69b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ni nj nk nl b">"hggg"</code>和<code class="fe ni nj nk nl b">"kggg"</code>在弹性搜索中对<code class="fe ni nj nk nl b">"hong"</code>和<code class="fe ni nj nk nl b">"kong"</code>的编辑距离分别为2。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="c722" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">弹性搜索中模糊查询的调整</h1><p id="cf0a" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">您可以调整模糊查询来匹配您的用例。</p><p id="e91a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这一节中，我将介绍我们可以在查询中更改的参数。</p><h2 id="625f" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">模糊</h2><p id="5a5b" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">模糊性是模糊查询的核心。</p><p id="5346" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们传递给这个参数的值是允许的最大距离。</p><p id="5333" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以传递两种类型的值，一个是精确最大距离的整数，另一个是<code class="fe ni nj nk nl b">"AUTO"</code>。</p><p id="4292" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ni nj nk nl b">"AUTO"</code>值允许查询中的模糊性是动态的。</p><p id="7acb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以在<code class="fe ni nj nk nl b">"AUTO"</code>值中调2个参数，写成<code class="fe ni nj nk nl b">"AUTO:[low],[high]"</code>。如果术语长度低于下限值，查询会将模糊度设置为0。如果术语长度介于低值和高值之间，查询会将模糊度设置为1。最后，如果术语长度大于上限值，查询会将模糊度设置为2。</p><p id="5742" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果未确定高低值，Elasticsearch将使用3和6作为默认值。</p><p id="f654" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们以一个文档“Elasticsearch中的模糊查询允许您处理错别字”为例。</p><p id="70a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以尝试一些查询来证明我们之前描述的AUTO机制。</p><ul class=""><li id="d252" class="oa ob it lk b ll lm lo lp lr oc lv od lz oe md of og oh oi bi translated"><code class="fe ni nj nk nl b">“tp”</code> : 1编辑距离<code class="fe ni nj nk nl b">“to”</code>的距离。</li><li id="cf33" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Fyzzy”</code> : 1编辑距离<code class="fe ni nj nk nl b">“Fuzzy”</code>的距离。</li><li id="5aab" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Fyzyy”</code> : 2编辑距离<code class="fe ni nj nk nl b">“Fuzzy”</code>的距离。</li><li id="aa3d" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Elastissearcc”</code> : 2编辑距离<code class="fe ni nj nk nl b">“Fuzzy”</code>的距离。</li><li id="ea89" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Elestissearcc”</code> : 3编辑距离<code class="fe ni nj nk nl b">“Fuzzy”</code>的距离。</li></ul><p id="ef1a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查询之后，这些查询产生了一个结果:</p><ul class=""><li id="22fa" class="oa ob it lk b ll lm lo lp lr oc lv od lz oe md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Fyzzy”</code></li><li id="836b" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Elastissearcc”</code></li></ul><p id="39f6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些查询不会:</p><ul class=""><li id="2b16" class="oa ob it lk b ll lm lo lp lr oc lv od lz oe md of og oh oi bi translated"><code class="fe ni nj nk nl b">“tp”</code></li><li id="c782" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Fyzyy”</code></li><li id="672e" class="oa ob it lk b ll oj lo ok lr ol lv om lz on md of og oh oi bi translated"><code class="fe ni nj nk nl b">“Elestissearcc”</code></li></ul><h2 id="fafd" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">换位</h2><p id="2b49" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><code class="fe ni nj nk nl b">transpositions</code>将允许您的查询将两个相邻字符(ab - &gt; ba)的换位计算为1个距离。</p><p id="4075" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，如果我们将<code class="fe ni nj nk nl b">transpositions</code>设置为true，那么用<code class="fe ni nj nk nl b">"leasticsearcc"</code>查询就会得到一个结果。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ed9b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是如果我们将其设置为false，那么弹性搜索将不会有任何结果。</p><p id="5ca7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">弹性搜索默认<code class="fe ni nj nk nl b">transpositions</code>设置为真。</p><p id="25ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们无法将此设置设置为匹配查询。匹配查询总是将<code class="fe ni nj nk nl b">transpositions</code>计算为1距离。</p><h2 id="9955" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">最大扩展</h2><p id="54eb" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">将决定您从查询中获得的最大结果。</p><p id="be5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您将<code class="fe ni nj nk nl b">max_expansions</code>设置为1，并且在Elasticsearch中有2个文档适合您的查询，那么Elasticsearch将只返回1。</p><p id="2ee8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意<code class="fe ni nj nk nl b">max_expansions</code>适用于碎片级。因此，如果在Elasticsearch中有许多碎片，即使将<code class="fe ni nj nk nl b">max_expansion</code>设置为1，查询也可能返回更多结果。</p><p id="af20" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ni nj nk nl b">max_expansions</code>的默认值为50。</p><h2 id="3558" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">前缀长度</h2><p id="07e4" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><code class="fe ni nj nk nl b">prefix_length</code>是模糊查询中不考虑的前缀字符数。</p><p id="1a3d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，如果我们将<code class="fe ni nj nk nl b">prefix_length</code>设置为1，那么查询<code class="fe ni nj nk nl b">"llasticsearch"</code>将不会得到任何结果。</p><p id="4f76" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">prefix_length设置默认为0。</p><h2 id="c25a" class="np mm it bd mn nq nr dn mr ns nt dp mv lr nu nv mx lv nw nx mz lz ny nz nb iz bi translated">重写</h2><p id="a68c" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">如果您想改变结果的得分，可以改变<code class="fe ni nj nk nl b">rewrite</code>参数。</p><p id="ba79" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在<a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-term-rewrite.html" rel="noopener ugc nofollow" target="_blank">弹性搜索文档</a>中找到关于<code class="fe ni nj nk nl b">rewrite</code>参数的更多信息。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="bf33" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">结论</h1><p id="2a1c" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">处理Elasticsearch中的输入错误非常容易，可以改善用户体验。</p><p id="324e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">处理输入错误的最简单方法是在匹配查询中添加<code class="fe ni nj nk nl b">"fuzziness":"AUTO"</code>。</p><p id="2841" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您想调优查询，可以更改一些参数，其中<code class="fe ni nj nk nl b">"fuzziness"</code>是最重要的。</p><p id="a08c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">谢谢你一直读到最后！</p></div></div>    
</body>
</html>