<html>
<head>
<title>How to Read Data Files on S3 from Amazon SageMaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从亚马逊SageMaker上读取S3的数据文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-read-data-files-on-s3-from-amazon-sagemaker-f288850bfe8f?source=collection_archive---------1-----------------------#2020-11-16">https://towardsdatascience.com/how-to-read-data-files-on-s3-from-amazon-sagemaker-f288850bfe8f?source=collection_archive---------1-----------------------#2020-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e404" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将您的数据科学工作流保存在云中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a32f325de428adeae82b8ad13d45a5ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JkHqt1hcT4JB0iNq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sayannath?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨彦纳特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank">亚马逊SageMaker </a>是由亚马逊网络服务公司(AWS)提供的强大的云托管Jupyter笔记本服务。它用于创建、训练和部署机器学习模型，但它也非常适合进行探索性数据分析和原型制作。</p><p id="d6fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然它可能不像一些替代品那样对初学者友好，如<a class="ae ky" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> Google CoLab </a>或<a class="ae ky" href="https://www.kaggle.com/kernels" rel="noopener ugc nofollow" target="_blank"> Kaggle Kernels </a>，但有一些很好的理由让你想在Amazon SageMaker内从事数据科学工作。</p><p id="489c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来讨论几个。</p><h2 id="9ea4" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">托管在S3的私有数据</h2><p id="dd52" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">机器学习模型必须在数据上训练。如果您正在处理私有数据，那么在访问这些数据进行模型训练时必须特别小心。将整个数据集下载到您的笔记本电脑上可能违反您公司的政策，或者可能是轻率的。想象一下，您的笔记本电脑丢失或被盗，而您知道其中包含敏感数据。顺便提一下，这是你应该总是使用磁盘加密的另一个原因。</p><p id="9d57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">云中托管的数据也可能太大，不适合放在你个人电脑的磁盘上，所以更简单的做法是将数据托管在云中，直接访问。</p><h2 id="f21a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">计算资源</h2><p id="683e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在云中工作意味着您可以访问强大的计算实例。AWS或您首选的云服务提供商通常会允许您选择和配置您的计算实例。也许你需要高CPU或高内存——比你的个人电脑所能提供的更多。或者您可能需要在GPU上训练您的模型。云提供商提供了许多不同类型的实例。</p><h2 id="f29c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">模型部署</h2><p id="f43f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如何直接从SageMaker部署ML模型是另一篇文章的主题，但是AWS为您提供了这个选项。您不需要构建复杂的部署架构。SageMaker将剥离一个托管计算实例，该实例在一个用于执行推理任务的API后面托管一个经过训练的ML模型的Dockerized版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/eab4ed955b039d2aef9fbaa24eee4331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ccDgWSaUNt4u87as"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由考特尼·摩尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="175e" class="mu lw it bd lx mv mw mx ma my mz na md jz nb ka mg kc nc kd mj kf nd kg mm ne bi translated">将数据加载到SageMaker笔记本中</h1><p id="7af2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在让我们进入这篇文章的主题。我将向您展示如何使用Python加载保存为文件的数据到S3桶中。示例数据是我想加载到我的SageMaker笔记本中的Python字典。</p><p id="3a71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载其他数据类型(如CSV或JSON)的过程类似，但可能需要额外的库。</p><h2 id="3aa2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第一步:知道你把文件放在哪里</h2><p id="5457" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">你需要知道S3桶的名字。文件在S3桶中被表示为“键”，但是从语义上来说，我发现仅仅从文件和文件夹的角度来考虑更容易。</p><p id="6d1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们定义文件的位置:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="4382" class="lv lw it ng b gy nk nl l nm nn">bucket = 'my-bucket'<br/>subfolder = ''</span></pre><h2 id="fb0a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤2:获得从S3桶中读取的权限</h2><p id="25cb" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">SageMaker和S3是AWS提供的独立服务，一个服务要对另一个服务执行操作，需要设置适当的权限。谢天谢地，预计SageMaker用户将从S3读取文件，所以标准权限是没问题的。</p><p id="ff89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，您仍然需要导入必要的执行角色，这并不难。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="ecc3" class="lv lw it ng b gy nk nl l nm nn">from sagemaker import get_execution_role<br/>role = get_execution_role()</span></pre><h2 id="5127" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤3:使用boto3创建一个连接</h2><p id="8ba9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Python库旨在帮助用户以编程方式在AWS上执行操作。它将有助于连接S3桶的SageMaker笔记本。</p><p id="f423" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码列出了S3存储桶上特定子文件夹中包含的所有文件。这对于检查存在什么文件很有用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果要遍历许多文件，可以修改这段代码，用Python创建一个列表对象。</p><h2 id="1dab" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第4步:直接从S3存储桶加载经过酸洗的数据</h2><p id="45ad" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Python中的<code class="fe no np nq ng b">pickle</code>库对于将Python数据结构保存到文件中很有用，以便以后可以加载它们。</p><p id="4c88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我想加载一个Python字典，并将其赋给<code class="fe no np nq ng b">data</code>变量。</p><p id="b5d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这需要使用<code class="fe no np nq ng b">boto3</code>来获得我想要加载的S3上的特定文件对象(pickle)。注意例子中的<code class="fe no np nq ng b">boto3</code>客户端如何返回包含数据流的响应。我们必须用<code class="fe no np nq ng b">pickle</code>库将数据流读入<code class="fe no np nq ng b">data</code>对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与使用<code class="fe no np nq ng b">pickle</code>加载本地文件相比，这种行为有点不同。</p><p id="d474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为这是我总是忘记如何做好的事情，所以我将这些步骤编入了本教程，以便其他人可以受益。</p><h2 id="a159" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">替代方法:下载文件</h2><p id="ae93" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">有时，您可能希望以编程方式从S3下载文件。也许您想将文件下载到本地机器或连接到SageMaker实例的存储器中。</p><p id="427c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，代码略有不同:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h1 id="791e" class="mu lw it bd lx mv mw mx ma my mz na md jz nb ka mg kc nc kd mj kf nd kg mm ne bi translated">结论</h1><p id="4766" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这篇文章中，我主要关注Amazon SageMaker，但是如果你在本地机器上正确安装了<code class="fe no np nq ng b">boto3</code> SDK，你也可以从S3那里读取或下载文件。由于我自己的大部分数据科学工作都是通过SageMaker完成的，您需要记住设置正确的访问权限，所以我想为其他人(以及我未来的自己)提供一个资源。</p><p id="507f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然SageMaker不是镇上唯一的游戏。如今有各种不同的云托管数据科学笔记本环境可供选择，与五年前(2015年)我完成博士学位时相比，这是一个巨大的飞跃</p><p id="e88a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我没有提到的一个考虑是成本:SageMaker不是免费的，而是按使用量计费的。完成后，记得关闭笔记本实例。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="83db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑报名成为一名媒体成员。一个月5美元，这样你就可以接触到我所有的作品以及成千上万其他作家的作品。如果你使用<a class="ae ky" href="https://mikhailklassen.medium.com/membership" rel="noopener">我的链接</a>注册，我会赚一小笔佣金，不需要你额外付费。</p><div class="oa ob gp gr oc od"><a href="https://mikhailklassen.medium.com/membership" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">通过我的推荐链接加入Medium米哈伊尔·克拉森</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">阅读米哈伊尔·克拉森(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">mikhailklassen.medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div></div></div>    
</body>
</html>