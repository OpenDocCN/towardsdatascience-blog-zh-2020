<html>
<head>
<title>Building a Recommendation Engine Using Slash GraphQL — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Slash GraphQL构建推荐引擎—第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-recommendation-engine-using-slash-graphql-part-2-c19e64659af4?source=collection_archive---------52-----------------------#2020-10-28">https://towardsdatascience.com/building-a-recommendation-engine-using-slash-graphql-part-2-c19e64659af4?source=collection_archive---------52-----------------------#2020-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c01a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">【TL；DR:在本系列的第二部分，我微调了最初的推荐引擎，添加了一个辅助数据源，并编写了一个Angular客户端来消费数据。]</p><p id="dc4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<a class="ae ko" rel="noopener" target="_blank" href="/building-an-amazon-like-recommendation-engine-using-slash-graphql-9635f0ce49b1?source=email-2b0f7c850aed-1601911510683-activity.collection_post_published">“使用Spring Boot和斜杠GraphQL </a>构建推荐引擎”的文章中，最近发布的由<a class="ae ko" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> Dgraph </a>托管的<a class="ae ko" href="https://dgraph.io/slash-graphql" rel="noopener ugc nofollow" target="_blank">斜杠GraphQL </a>后端被用作基于Java的推荐引擎的记录系统。图形数据存储非常适合推荐引擎这样的用例，其中数据之间的关系与数据本身一样重要。使用Slash GraphQL允许我以最少的努力快速建立并运行一个完全托管的GraphQL数据库。</p><p id="967a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章还提供了关于如何利用Slope One系列的协同过滤算法，根据现有的评级来预测产品兴趣水平的见解。简而言之，Slope One评级算法将是推荐引擎的核心。</p><p id="55c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">文章最后通过在Spring Boot推荐引擎中提供RESTful URIs来提供来自存储在Dgraph Slash GraphQL SaaS服务产品中的数据的推荐。</p><p id="33c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文将更进一步，介绍一个Angular客户端，以一种更容易使用的方式呈现这些数据……并希望得到赞赏。</p><h1 id="a61c" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">Data Domain的增强功能</h1><p id="78d4" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">虽然最初的文章展示了推荐引擎是如何工作的，但我觉得我的原始数据样本为一些样本客户提供了太多的评级。此外，我觉得我需要为第二个例子增加艺术家的数量。</p><p id="25e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我清除了现有Slash GraphQL数据库中的数据，并重新开始。虽然它很容易更新，但在本练习中，底层模式不必更改，仍然如下所示:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="3a99" class="mb kq it lx b gy mc md l me mf">type Artist {<br/>   name: String! @id @search(by: [hash, regexp])<br/>   ratings: [Rating] @hasInverse(field: about)<br/>}</span><span id="85ee" class="mb kq it lx b gy mg md l me mf">type Customer {<br/>   username: String! @id @search(by: [hash, regexp])<br/>   ratings: [Rating] @hasInverse(field: by)<br/>}</span><span id="68d5" class="mb kq it lx b gy mg md l me mf">type Rating {<br/>   id: ID!<br/>   about: Artist!<br/>   by: Customer!<br/>   score: Int @search<br/>}</span></pre><p id="eaea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用斜线GraphQL用户界面中的以下变化添加了新的<code class="fe mh mi mj lx b">Artist</code>项目列表:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="10c8" class="mb kq it lx b gy mc md l me mf">mutation {<br/> addArtist(input: [<br/>   {name: "Eric Johnson"},<br/>   {name: "Genesis"},<br/>   {name: "Journey"},<br/>   {name: "Led Zeppelin"},<br/>   {name: "Night Ranger"},<br/>   {name: "Rush"},<br/>   {name: "Tool"},<br/>   {name: "Triumph"},<br/>   {name: "Van Halen"},<br/>   {name: "Yes"}]) {<br/>   artist {<br/>     name<br/>   }<br/> }<br/>}</span></pre><p id="c2b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新的<code class="fe mh mi mj lx b">Customer</code>记录也被插入:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="3c01" class="mb kq it lx b gy mc md l me mf">mutation {<br/> addCustomer(input: [<br/>   {username: "David"},<br/>   {username: "Doug"},<br/>   {username: "Jeff"},<br/>   {username: "John"},<br/>   {username: "Russell"},<br/>   {username: "Stacy"}]) {<br/>   customer {<br/>     username<br/>   }<br/> }</span></pre><p id="0641" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用与原始文章相同的突变，根据下表添加评级:</p><figure class="ls lt lu lv gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mk"><img src="../Images/7fdc625400fb2ad178cd00ca7c671721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CEx6ULOCmyzhJaIm.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">作者图片</p></figure><h1 id="7feb" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">H2(内存中)数据库简介</h1><p id="90f3" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在第二篇文章中，我想介绍一个额外的数据源。这样做可以突出信息和事实通常来自多个数据源的事实。我决定使用<a class="ae ko" href="http://h2database.com/html/main.html" rel="noopener ugc nofollow" target="_blank">H2</a>——一个开源的、轻量级的内存Java数据库。使用以下Maven依赖项，可以快速轻松地将H2数据库添加到Spring Boot:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="021d" class="mb kq it lx b gy mc md l me mf">&lt;dependency&gt;<br/>   &lt;groupId&gt;com.h2database&lt;/groupId&gt;<br/>   &lt;artifactId&gt;h2&lt;/artifactId&gt;<br/>   &lt;scope&gt;runtime&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="8fde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">H2数据库将为存储在Slash GraphQL中的<code class="fe mh mi mj lx b">Artist</code>记录提供附加信息。这些记录将被存储在一个名为<code class="fe mh mi mj lx b">Artists</code>的表中，主键就是<code class="fe mh mi mj lx b">Artist</code>的名字:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="070b" class="mb kq it lx b gy mc md l me mf">@Data<br/>@Entity<br/>@Table(name = "artists")</span><span id="88ab" class="mb kq it lx b gy mg md l me mf">public class Artist {<br/>   @Id<br/>   private String name;<br/>   private String yearFormed;<br/>   private boolean active;<br/>   private String imageUrl;<br/>}</span></pre><p id="bcd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个包含该表信息的<code class="fe mh mi mj lx b">data.sql</code>文件被创建并存储在Spring Boot存储库的resources文件夹中。因此，每次服务器启动时，都会填充H2数据库。</p><h1 id="fac2" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">发展推荐引擎</h1><p id="06e5" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">为了在推荐引擎中看到价值，引擎提供的结果需要包括关于推荐的所有必要信息。为了满足这一需求，响应中建议的有效负载被更新为包含更多的<code class="fe mh mi mj lx b">Artist</code>属性，如下所示:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="23ec" class="mb kq it lx b gy mc md l me mf">{<br/>   "matchedCustomer": {<br/>       "username": string<br/>   },</span><span id="a59b" class="mb kq it lx b gy mg md l me mf">   "recommendations": [<br/>       {<br/>           "name": string,<br/>           "yearFormed": string,<br/>           "active": boolean,<br/>           "imageUrl": string,<br/>           "rating": number,<br/>           "score": number<br/>       } ...<br/>   ]<br/>}</span></pre><p id="8da0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">推荐引擎需要增强以接受两种额外形式的元数据:</p><ul class=""><li id="bb90" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">当前选择的艺术家</li><li id="8eee" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">当前客户</li></ul><p id="2364" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过知道当前选择的艺术家，推荐引擎将知道排除对同一艺术家的任何推荐。此外，了解当前客户的能力避免了简单地随机挑选客户的需要。</p><h1 id="0bf2" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">介绍Angular客户端</h1><p id="f474" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">为了快速创建客户端，我决定使用<a class="ae ko" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular CLI </a>。Angular CLI是一个命令行界面，允许您快速轻松地创建和细分组件、服务和基本功能，允许开发人员专注于编写业务逻辑以满足他们当前的需求。对我的技能来说，这是一个理想的选择。</p><p id="12a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在很短的时间内，我能够使用Angular CLI介绍以下项目:</p><ul class=""><li id="b93d" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">与Spring Boot的艺术家、客户和推荐对象相关的服务</li><li id="8551" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">list-artists组件提供艺术家的简单列表</li><li id="b1e3" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">view-artist组件显示对活动客户和艺术家的推荐</li></ul><p id="404b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为有一个强大的Angular和<code class="fe mh mi mj lx b">npm</code>社区，我甚至能够通过几个命令和基本的配置更改，使用<a class="ae ko" href="https://github.com/BioPhoton/angular-star-rating" rel="noopener ugc nofollow" target="_blank"> angular-star-rating </a>和css-star-rating包来包含一个图形化的星级评定解决方案。当然，<a class="ae ko" href="https://ng-bootstrap.github.io/#/home" rel="noopener ugc nofollow" target="_blank"> @ng-bootstrap </a>和bootstrap包也包括在内，这使得造型看起来更像样一些。</p><h1 id="fe59" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">使用Angular客户端</h1><p id="7260" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">配置好Angular客户端并运行Spring Boot推荐引擎后，可以使用以下URL来启动应用程序:</p><p id="0f6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mh mi mj lx b"><a class="ae ko" href="http://localhost:4200" rel="noopener ugc nofollow" target="_blank">http://localhost:4200</a></code></p><p id="cfc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当应用程序加载时，将显示以下屏幕:</p><figure class="ls lt lu lv gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nk"><img src="../Images/8ec50f24cd2685f2bbd0f1d18ef14c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AgPjU7UtIBn0Ykai.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">作者图片</p></figure><p id="3dc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该列表(来自列表艺术家组件)提供了来自H2数据库的信息和来自Dgraph Slash GraphQL数据库的平均评级。</p><p id="1ed4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">单击Rush条目将调用view-artist组件，并显示如下所示的信息:</p><figure class="ls lt lu lv gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nl"><img src="../Images/8123d5128e434cd8e7ee1f52fd26fbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BMbywTx77hCueSdM.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">作者图片</p></figure><p id="ae1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这种情况下，我选择Russell作为当前客户。在屏幕的顶部，显示了相同的信息，并且在右侧显示了乐队的图像。下面是来自Spring Boot服务中推荐API的信息。</p><p id="94f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">结果迎合了名为Russell的客户，并有意避免为名为Rush的乐队做推荐。</p><p id="561a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果客户更改为Stacy，相同的屏幕会更新，如下所示:</p><figure class="ls lt lu lv gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nl"><img src="../Images/28ad510a5e7bd8b079642eba5c63529b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9pHxJLg9DWh2XFqb.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">作者图片</p></figure><p id="13ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然屏幕上半部分的数据保持不变，但推荐部分完全不同，并迎合了新选择的用户。</p><h1 id="15b9" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="90af" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在本文中，推荐引擎被连接到一个客户端应用程序，并被进一步优化以提供比原始文章更多的价值。</p><p id="eb94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然这个例子的设计非常简单，但是所采用的概念和方法可以被合并到一个功能完整的推荐引擎中。</p><p id="cf7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Dgraph的<a class="ae ko" href="https://dgraph.io/slash-graphql" rel="noopener ugc nofollow" target="_blank">斜线GraphQL </a>和Spring Boot当然有助于非常短的上市时间。它们使得基于经验教训的原型设计、分析和采用新设计变得容易。</p><p id="b215" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于那些对完整源代码感兴趣的人，请查看<a class="ae ko" href="https://gitlab.com/johnjvester/slash-graph-ql-angular" rel="noopener ugc nofollow" target="_blank">斜线-图形-ql-angular GitLab资源库</a>。</p><p id="6e63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(经原作者许可发表，<a class="ae ko" href="https://www.linkedin.com/in/johnjvester/" rel="noopener ugc nofollow" target="_blank">约翰·维斯特</a>)</p></div></div>    
</body>
</html>