<html>
<head>
<title>Handling BLANK in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理Power BI中的空白</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/handling-blank-in-power-bi-90eed948d042?source=collection_archive---------11-----------------------#2020-10-15">https://towardsdatascience.com/handling-blank-in-power-bi-90eed948d042?source=collection_archive---------11-----------------------#2020-10-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a7bc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何应对Power BI报表中的空白值？检查这三种可能的解决方案</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/70f62f2e34b9dc7a84b4f22c995d962c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ck1TnRnsZbdZQRYaqJeOHw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">皮查拜在Pexels.com拍摄的照片</p></figure><p id="ee01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在创建报告时，我敢肯定，当您最终得到“(空白)”时，您会面临这样的情况，并且您不希望像这样显示给您的最终用户。当然，在某些情况下保留空白是有意义的，但最常见的情况是您想要显示其他内容而不是它(对于数字来说是0，对于文本来说可能是‘N/A’或‘Unknown’)。</p><h2 id="b5f1" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">可能的解决方案</h2><p id="5c99" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">那么，在Power BI中有哪些处理空白的选项呢？我们直接在那里查吧…</p><p id="ad21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我会用Stack Overflow 2013数据库。这个数据库包含了超过2000万条记录的表，所以如果要衡量性能，绝对比玩Adventure Works或者类似的数据库要好。</p><p id="cb75" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比方说，我想看看每一年有多少评论。首先，由于数据库中没有具体的年份值，我需要使用以下公式创建一个计算列<em class="ms"> Year Comment </em>:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3f4e" class="lu lv it mu b gy my mz l na nb">Year Comment = YEAR(Comments[CreationDate])</span></pre><p id="4c92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是创建一个衡量所有评论的标准。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="15c5" class="lu lv it mu b gy my mz l na nb">Total Comments = COUNT(Comments[Id])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/fd8f0b7e14e0ba6c3e0f74dcd57ab10e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zM4JgyIq1Q1w-kVi6GsL7g.jpeg"/></div></div></figure><p id="1d15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我们得到了每年的评论总数。现在，假设我们要专门计算2012年还剩多少评论。这可以用许多不同的方法来实现，但是我使用下面的公式:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d1f5" class="lu lv it mu b gy my mz l na nb">Comments 2012 =<br/>CALCULATE (<br/>    COUNT ( Comments[Id] ),<br/>    FILTER ( Comments, Comments[Year Comment] = 2012 )<br/>)</span></pre><p id="d88d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我暂停一下，给你介绍一下<a class="ae nd" href="https://daxstudio.org/" rel="noopener ugc nofollow" target="_blank"> DAX工作室</a>。也许你们中的一些人对这个工具很熟悉，但是如果你经常写DAX并且每天都使用Power BI，这个工具是必须的！我不会详细说明它提供了什么功能——我会诚实地说它很棒，也是最重要的——它是完全免费的！所以，马上去下载DAX Studio吧:)…</p><p id="a9c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将使用DAX Studio来测量我的视觉效果的<a class="ae nd" rel="noopener" target="_blank" href="/how-i-speed-up-my-power-bi-report-5x-155255415895">性能。让我们连接我们的。pbix文件，并将我们新创建的度量添加到报告中。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/8b63ec9e66d5228653f1288ef0343bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrQD45PoLfpE_Ynl4HrLeg.jpeg"/></div></div></figure><p id="0ba9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我还打开了Power BI中View选项卡下的Performance Analyzer，以便捕捉将在后台执行的查询。下面是BI生成的显示我们想要的内容的查询:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b9ae" class="lu lv it mu b gy my mz l na nb">// DAX Query<br/>EVALUATE<br/>  TOPN(<br/>    502,<br/>    SUMMARIZECOLUMNS(<br/>      ROLLUPADDISSUBTOTAL('Comments'[Year Comment], "IsGrandTotalRowTotal"),<br/>      "Total_Comments", 'Comments'[Total Comments],<br/>      "Comments_2012", 'Comments'[Comments 2012]<br/>    ),<br/>    [IsGrandTotalRowTotal],<br/>    0,<br/>    'Comments'[Year Comment],<br/>    1<br/>  )<br/>ORDER BY<br/>  [IsGrandTotalRowTotal] DESC, 'Comments'[Year Comment]</span></pre><p id="70f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我停下来，试着解释一下背景中发生了什么。当您在Power BI中与可视化交互时，每次都会生成查询并将其发送到Analysis Services (Tabular)引擎(Vertipaq)，该引擎<a class="ae nd" rel="noopener" target="_blank" href="/vertipaq-brain-muscles-behind-power-bi-eecd6c8891e3">在后台</a>运行并执行“脏”工作。</p><p id="36c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下图中，我们可以看到Vertipaq是如何处理这个查询的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/ced3f046214ff99dabcd7fcbe369b069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovRlrHGwzdn1Yo_UtrA-Sw.jpeg"/></div></div></figure><h2 id="df7b" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">解决方案1:使用IF</h2><p id="cced" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">现在，我们开始处理视觉中的空白值。第一种情况是最明显的，我想也是最常用的。解决空白的措施如下:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5fd1" class="lu lv it mu b gy my mz l na nb">Blank v1 comments =<br/>IF (<br/>    ISBLANK (<br/>        CALCULATE (<br/>            COUNT ( Comments[Id] ),<br/>            FILTER ( Comments, Comments[Year Comment] = 2012 )<br/>        )<br/>    ),<br/>    0,<br/>    [Total Comments]<br/>)</span></pre><p id="1cd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并且，我们得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/385c4d4a2c9ae4edac639d8ae5e2116f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*wpndWvJWQVFoPKMwpFcDyw.jpeg"/></div></figure><p id="1eed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，我们在这里:我们显示的不是空白，而是零。让我们检查一下这个查询是如何执行的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c8825d568bbe2afbf02aed60dc3592d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8F_vFryDQNOqXgTNIOLIg.jpeg"/></div></div></figure><p id="543a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，对于简单的度量，差异不是很大，但是对于复杂的DAX和不同的过滤上下文，在数百万行的表上，差异可能很大。</p><h2 id="d7f1" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">解决方案2: COALESCE()</h2><p id="6d5b" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">最近Power BI推出了一个全新的功能:COALESCE()。对于那些来自SQL世界的人来说，这是一个众所周知的函数，但是让我为那些不熟悉它的人简单解释一下。基本上，<em class="ms"> COALESCE </em>将遍历作为参数传递的值，并返回第一个非空值(在SQL中不是null)。</p><p id="e6d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="ms">聚结(列1，列2，列3…列N) </em> </strong></p><p id="986a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，COALESCE将检查列1，如果值为空，它将检查列2的值。如果它也是空的，它将继续，直到找到第一个非空值。作为最后一个参数，您应该指定在所有检查的参数都返回空白时要返回的值，如下所示:</p><p id="55fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="ms"> COALESCE(column1，column2，column3…columnN，0) </em> </strong></p><p id="459a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们使用COALESCE函数为我们的报告创建一个度量:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5373" class="lu lv it mu b gy my mz l na nb">Blank v2 Comments coal =<br/>COALESCE (<br/>    CALCULATE (<br/>        COUNT ( Comments[Id] ),<br/>        FILTER ( Comments, Comments[Year Comment] = 2012 )<br/>    ),<br/>    0<br/>)</span></pre><p id="605d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果完全相同:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/a6353265c4006bdca83bbbf087b11241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*s5JcWnApvuTfl1UhzpXwoQ.jpeg"/></div></figure><p id="8132" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们检查一下这种方法的性能:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/58ffb88c9af59b15afddf014a344f0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFJOONRC02X6o9fSItH5xg.jpeg"/></div></div></figure><h2 id="2c40" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">解决方案#3技巧用0</h2><p id="4ecc" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">这是我看到王九思用过的一个小技巧。对于那些不知道的人来说，Jeffrey Wang是DAX最知名的名字之一。</p><p id="52bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有什么诀窍？在DAX中，空白+ 0就是0！是的，我知道，对于我们这些来自SQL环境的人来说，他们认为blank是SQL的空孪生兄弟，这是完全出乎意料的行为。尝试在SQL Server Management Studio中运行以下命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="08d2" class="lu lv it mu b gy my mz l na nb">select NULL+0</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/70cce93166a8f9b1f582dde36a806861.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*QqRu-I41F1TJBB6xHVK6lw.jpeg"/></div></figure><p id="b10a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您所想，结果是空的。在SQL中，NULL+something总是NULL…在DAX中，它不是:)</p><p id="9e62" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，让我们在报告中尝试这个解决方案:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6664" class="lu lv it mu b gy my mz l na nb">Blank v3 Comments 0 =<br/>CALCULATE (<br/>    COUNT ( Comments[Id] ),<br/>    FILTER ( Comments, Comments[Year Comment] = 2012 )<br/>) + 0</span></pre><p id="4fbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果还是完全一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8b4c88ec12f9850283d82897050ec7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*g_Yve-0I5DA3IbOI_pNAvg.jpeg"/></div></figure><p id="fb11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们来看看后台发生了什么:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/ff8b5d4ca4afdbb988ba7d554368aab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fe83JyEWh2r9d_1ZzA3iqA.jpeg"/></div></div></figure><p id="10e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没那么差哈:)</p><h2 id="3965" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">结论</h2><p id="5138" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如您所见，在DAX中有多种处理空白值的方式。根据数据集的具体特征，您应该测试不同的可能性，并选择最适合您需求的一个。</p><p id="9cc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p><p id="2dd1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nd" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读Medium上的每一个故事！</a></p></div></div>    
</body>
</html>