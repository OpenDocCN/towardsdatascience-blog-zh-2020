<html>
<head>
<title>SQL On-Demand: An easier way to Query Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">按需SQL:一种更简单的数据查询方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-on-demand-an-easier-way-to-query-data-a9aa6e593f18?source=collection_archive---------21-----------------------#2020-09-29">https://towardsdatascience.com/sql-on-demand-an-easier-way-to-query-data-a9aa6e593f18?source=collection_archive---------21-----------------------#2020-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6c64" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">查询CSV、JSON和Parquet之类的文件，而无需将其从其位置移走</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/30ba4ece1bc49e44d390b954c6ccab76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*3WtKTE_zEBkbEBSfdNEVUw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片(Azure Synapse Workspace)</p></figure><h1 id="a2f7" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">TLDR</h1><ul class=""><li id="92d1" class="lj lk iq ll b lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">关于SQL按需</li><li id="eae3" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw lx ly lz ma bi translated">创建数据源</li><li id="d1bf" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw lx ly lz ma bi translated">获得对Azure存储的访问权限</li><li id="51c8" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw lx ly lz ma bi translated">通过Azure Synapse Workspace查询Azure存储中的文件</li><li id="e5c0" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw lx ly lz ma bi translated">YouTube视频对以下步骤进行了可视化描述</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><h1 id="2f56" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">关于SQL按需</h1><p id="f5ff" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml lq mm mn mo ls mp mq mr lu ms mt mu lw ij bi translated">在我的上一篇<a class="ae mv" rel="noopener" target="_blank" href="/top-10-features-in-azure-synapse-analytics-workspace-ec4618a7fa69">帖子</a>中，我提到了Azure Synapse Analytics的10大特性。Synapse SQL数据库有2个选项:SQL池&amp; SQL On-Demand。在这篇文章中，我将深入探讨第二种选择；SQL随需应变。SQL On-Demand是一个有趣的特性，它将使查询数据变得更加容易。</p><p id="6b5d" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">那么什么是SQL随需应变？根据<a class="ae mv" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/quickstart-sql-on-demand" rel="noopener ugc nofollow" target="_blank">微软文档</a>。这是一个</p><blockquote class="nb nc nd"><p id="78e6" class="mi mj ne ll b lm mw jr mk lo mx ju ml nf my mn mo ng mz mq mr nh na mt mu lw ij bi translated">Synapse SQL on-demand (preview)是一种无服务器查询服务，使您能够对Azure存储中的文件运行SQL查询。</p></blockquote><p id="e0fc" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">那么，您会在存储中找到什么类型的文件呢？这些文件类似于<strong class="ll ir"> CSV </strong>、<strong class="ll ir"> Parquet </strong>文件和<strong class="ll ir"> JSON </strong>。这非常有趣，因为通常您必须将这些文件导入到数据库中，更不用说确保数据格式与目标数据库环境兼容了。</p><h1 id="f6e7" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">不拉文件怎么查询文件？</h1><p id="83ec" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml lq mm mn mo ls mp mq mr lu ms mt mu lw ij bi translated">这是通过创建外部数据源来完成的。数据来源包括:</p><ul class=""><li id="a33c" class="lj lk iq ll b lm mw lo mx lq ni ls nj lu nk lw lx ly lz ma bi translated">万能钥匙</li><li id="720e" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw lx ly lz ma bi translated">数据库范围的凭据</li></ul><h1 id="c7f7" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">如何创建数据源</h1><p id="8d7f" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml lq mm mn mo ls mp mq mr lu ms mt mu lw ij bi translated">首先，确保您在想要创建它的数据库中。那应该不是<em class="ne">大师</em>吧。您可以像这样更改您的数据库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/defd8257d6456960cb224b89f84c03d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1ZFcCt8CmzPEy1g-dlq1g.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><ol class=""><li id="fe30" class="lj lk iq ll b lm mw lo mx lq ni ls nj lu nk lw nq ly lz ma bi translated"><strong class="ll ir">创建主密钥</strong></li></ol><blockquote class="nb nc nd"><p id="85d8" class="mi mj ne ll b lm mw jr mk lo mx ju ml nf my mn mo ng mz mq mr nh na mt mu lw ij bi translated">—创建将保护凭证的主密钥:<br/>通过密码创建主密钥加密= &lt;在此输入非常强的密码&gt;</p></blockquote><p id="8748" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir"> 2。创建数据库范围的凭据</strong></p><p id="69df" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">微软文档有一个公共的URI可以访问，以按需测试SQL</p><blockquote class="nb nc nd"><p id="7340" class="mi mj ne ll b lm mw jr mk lo mx ju ml nf my mn mo ng mz mq mr nh na mt mu lw ij bi translated">—在我们的演示存储帐户中为容器创建凭据<br/>创建数据库范围的凭据sqlondemand <br/>，其中IDENTITY= '共享访问签名'，<br/>SECRET = ' SV = 2018–03–28&amp;ss = BF&amp;SRT = SCO&amp;sp = rl&amp;ST = 2019–10–14t 12% 3a 10% 3a 25 z&amp;se = 2061–12–31t 12% 3a 10%</p></blockquote><p id="8112" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir"> 3。通过创建外部数据源</strong>将所有这些放在一起</p><blockquote class="nb nc nd"><p id="dde0" class="mi mj ne ll b lm mw jr mk lo mx ju ml nf my mn mo ng mz mq mr nh na mt mu lw ij bi translated">用(<br/>LOCATION = '<a class="ae mv" href="https://sqlondemandstorage.blob.core.windows.net'" rel="noopener ugc nofollow" target="_blank">https://sqlondemandstorage . blob . core . windows . net '</a>，<br/> CREDENTIAL = sqlondemand <br/>)创建外部数据源SqlOnDemandDemo</p></blockquote><p id="6cf8" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir">如果需要重新创建外部数据源</strong></p><p id="99da" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">如果您需要重新创建它，您需要以特定的顺序删除它。首先删除外部数据源，其次是作用域凭据，最后是主密钥。</p><p id="d3b0" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">删除外部数据源SqlOnDemandDemo</p><p id="536d" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">删除数据库范围的凭据sqlondemand</p><p id="0e60" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">放下主密钥</p><h1 id="9129" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak">理解共享访问签名</strong></h1><p id="6ac1" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml lq mm mn mo ls mp mq mr lu ms mt mu lw ij bi translated">理解在SQL On-Demand中创建数据源的用例。假设你在Azure存储中有一个文件夹，需要授予某人访问权限。这</p><p id="87e3" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">在上面2的脚本中，我们创建了数据库范围的凭证。这是通过使用所谓的共享访问签名URI又名SAS URI。是凭证给了你访问Azure存储的权限。这是一个非常漂亮的功能，因为你可以安排一个人访问多长时间。</p><p id="c7d4" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir">那么，我为什么需要一个SAS URI？</strong></p><ul class=""><li id="d7dd" class="lj lk iq ll b lm mw lo mx lq ni ls nj lu nk lw lx ly lz ma bi translated">获取Azure存储帐户的访问权限</li><li id="1f2a" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw lx ly lz ma bi translated">为SQL按需外部数据源创建数据库范围的凭据</li></ul><p id="348a" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">如果您在创建数据源之前直接进入存储，那么创建数据源的步骤可能会更有意义。这在现实世界中很有可能发生，因为在查询数据之前，您应该知道/知道您想要提取什么数据。</p><p id="254d" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir">了解Azure存储中有什么？</strong></p><p id="192a" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">要进入存储，你需要使用一个叫做<a class="ae mv" href="https://azure.microsoft.com/en-us/features/storage-explorer/" rel="noopener ugc nofollow" target="_blank"> Azure Storage Explorer </a>的工具。这是描述其功能的最简单的方式。</p><p id="ae4c" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><em class="ne"> Windows资源管理器= &gt; OnPremise </em></p><p id="7ad1" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><em class="ne"> Azure Storage Explorer = &gt;云</em></p><p id="4e5a" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">现在我们了解了Azure Storage Explorer，让我们打开我们试图查询的文件。</p><p id="d19e" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir">设置对Azure Storage Explorer的访问</strong></p><ol class=""><li id="05bc" class="lj lk iq ll b lm mw lo mx lq ni ls nj lu nk lw nq ly lz ma bi translated">单击图标并</li><li id="1299" class="lj lk iq ll b lm mb lo mc lq md ls me lu mf lw nq ly lz ma bi translated">选择“添加帐户”</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nr"><img src="../Images/ae30a53a2c0c0ab3529e996875ae2b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBmqFBAiUE8SSDE2glynCw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者照片</p></figure><p id="46c4" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">3.选择共享访问签名URI</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/4f86a1ce9b7e796d0d07ffb1e530d59a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*UsYDpDWCVLpl6pP3sgQWXQ.png"/></div></figure><p id="ad5d" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">4.附加共享访问签名URI，然后按下一步</p><p id="ea86" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">粘贴在URI。其他所有内容，如显示名称、Blob、文件和队列端点都将自动填充。</p><p id="6f72" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">微软文档已经慷慨地提供了一个公共的URI来按需测试SQL</p><p id="5539" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated"><strong class="ll ir">注:</strong></p><ul class=""><li id="88ea" class="lj lk iq ll b lm mw lo mx lq ni ls nj lu nk lw lx ly lz ma bi translated">将<em class="ne"> Blob端点</em> + <em class="ne">密钥与这个</em> <strong class="ll ir"> /？”</strong></li></ul><p id="38c4" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">斑点终点—<a class="ae mv" href="https://sqlondemandstorage.blob.core.windows.net/?sv=2018-03-28&amp;ss=bf&amp;srt=sco&amp;sp=rl&amp;st=2019-10-14T12%3A10%3A25Z&amp;se=2061-12-31T12%3A10%3A00Z&amp;sig=KlSU2ullCscyTS0An0nozEpo4tO5JAgGBvw%2FJX2lguw%3D" rel="noopener ugc nofollow" target="_blank">https://sqlondemandstorage.blob.core.windows.net</a></p><p id="a9ec" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">加上这个<strong class="ll ir">——</strong><a class="ae mv" href="https://sqlondemandstorage.blob.core.windows.net/?sv=2018-03-28&amp;ss=bf&amp;srt=sco&amp;sp=rl&amp;st=2019-10-14T12%3A10%3A25Z&amp;se=2061-12-31T12%3A10%3A00Z&amp;sig=KlSU2ullCscyTS0An0nozEpo4tO5JAgGBvw%2FJX2lguw%3D" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">/？</strong> </a></p><p id="6890" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">secret—<a class="ae mv" href="https://sqlondemandstorage.blob.core.windows.net/?sv=2018-03-28&amp;ss=bf&amp;srt=sco&amp;sp=rl&amp;st=2019-10-14T12%3A10%3A25Z&amp;se=2061-12-31T12%3A10%3A00Z&amp;sig=KlSU2ullCscyTS0An0nozEpo4tO5JAgGBvw%2FJX2lguw%3D" rel="noopener ugc nofollow" target="_blank">SV = 2018-03-28&amp;ss = BF&amp;SRT = SCO&amp;sp = rl&amp;ST = 2019-10-14t 12% 3a 10% 3a 25 z&amp;se = 2061-12-31t 12% 3a 10% 3a 00 z&amp;SIG = klsu 2 ullcscyts 0 an 0 nozepo 4 to 5 jaggbvw % 2 FJ x2 lguw</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/9c7e8a45a8694d4ac5e207806f68c98d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*_71DzPEYuorXMzC515dtOw.png"/></div></figure><p id="4a86" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">5.选择连接</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/683e65692b9f8b8de2bc6a3de8c28d8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*eHbVL5MkmE02ahQrkQmWsg.png"/></div></figure><p id="1d73" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">现在，您应该能够在Azure存储中看到CSV、Parquet和JSON文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nv"><img src="../Images/89513671ac59b5953b7a68b1bb55553b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6jq3EjiIRSxVeE2iohrVQ.png"/></div></div></figure><h1 id="df01" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">从Azure Synapse工作区查询Azure存储中的文件</h1><p id="81a3" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml lq mm mn mo ls mp mq mr lu ms mt mu lw ij bi translated">现在我们已经了解了要查询的文件，让我们回到Synapse工作区进行查询。</p><p id="d7df" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">这是一个来自微软文档的示例查询。</p><div class="nw nx gp gr ny nz"><a href="https://docs.microsoft.com/en-us/azure/synapse-analytics/quickstart-sql-on-demand" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">快速入门:按需使用SQL-Azure Synapse Analytics</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">Synapse SQL on-demand (preview)是一种无服务器查询服务，使您能够对放置在…中的文件运行SQL查询</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">docs.microsoft.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kl nz"/></div></div></a></div><blockquote class="nb nc nd"><p id="6256" class="mi mj ne ll b lm mw jr mk lo mx ju ml nf my mn mo ng mz mq mr nh na mt mu lw ij bi translated">从OPENROWSET<br/>(<br/>BULK ' CSV/population/*)中选择前10个* <br/>。' csv '，<br/>DATA _ SOURCE = ' SqlOnDemandDemo '，<br/> FORMAT = 'CSV '，PARSER _ VERSION = ' 2.0 '<br/>)<br/>WITH<br/>(<br/>country _ code VARCHAR(5)<br/>，country_name VARCHAR (100) <br/>，year smallint <br/>，population bigint <br/> ) AS r <br/>其中<br/> country_name = 'Luxembourg '且年份= 2017</p></blockquote><p id="d893" class="pw-post-body-paragraph mi mj iq ll b lm mw jr mk lo mx ju ml lq my mn mo ls mz mq mr lu na mt mu lw ij bi translated">我们可以看到熟悉的SQL语句，如SELECT、WITH和WHERE子句。在from语句中，我们有OPENROWSET。这是您设置文件所在的文件夹结构的地方。上面的查询指定遍历文件夹路径“csv/population”中的所有CSV文件，以查找国家名称为卢森堡且年份为2017年的位置。所有这些都无需移动数据。我们可以对Parquet文件和JSON文件做同样的事情。查看my GitHub <a class="ae mv" href="https://github.com/Dayobam/Getting-Started-with-Azure-Synapse-Youtube-Series/blob/master/Getting-Started-with-SQL-On-Demand/QuerySQLonDemand.sql" rel="noopener ugc nofollow" target="_blank">链接</a>获取其他示例。</p><h1 id="ad8a" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结论</h1><p id="5a71" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml lq mm mn mo ls mp mq mr lu ms mt mu lw ij bi translated">SQL On-Demand无疑是Synapse SQL数据库的一个有趣部分。最佳用例之一是将数据保存在一个位置，同时仍然能够运行报告、数据分析和机器学习等。</p></div></div>    
</body>
</html>