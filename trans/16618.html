<html>
<head>
<title>Hidden tricks for running AutoML experiment from Azure Machine Learning SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure机器学习SDK中运行AutoML实验的隐藏技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hidden-tricks-for-running-automl-experiment-from-azure-machine-learning-sdk-915d4e3f840e?source=collection_archive---------19-----------------------#2020-11-16">https://towardsdatascience.com/hidden-tricks-for-running-automl-experiment-from-azure-machine-learning-sdk-915d4e3f840e?source=collection_archive---------19-----------------------#2020-11-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ca21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">自动化机器学习</em>是机器学习社区中一个快速发展的领域，它使用户能够尝试多种算法并对他们的数据进行预处理转换。与可扩展的基于云的计算相结合，可以找到性能最佳的数据模型，而无需大量耗时的手动反复试验。</p><p id="03fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客简要概述了如何从Azure机器学习SDK运行AutoML实验。</p><h1 id="0bc7" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">自动化机器学习任务和算法</h1><p id="6897" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Azure Machine Learning包括对自动化机器学习的支持，称为<a class="ae lp" href="https://docs.microsoft.com/en-us/azure/machine-learning/concept-automated-ml" rel="noopener ugc nofollow" target="_blank"> AutoML </a>，作为Azure云产品之一，通过<a class="ae lp" href="https://ml/azure.com" rel="noopener ugc nofollow" target="_blank">Azure Machine Learning studio</a>中的可视界面，或者使用<a class="ae lp" href="https://docs.microsoft.com/en-us/python/api/overview/azure/ml/?view=azure-ml-py&amp;preserve-view=true" rel="noopener ugc nofollow" target="_blank">SDK</a>提交实验。SDK使数据科学家能够更好地控制自动化机器学习实验的设置，而可视化界面更容易用于代码经验较少或没有代码经验的用户。</p><p id="d26d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure机器学习为以下类型的机器学习任务训练模型:</p><ul class=""><li id="cdc4" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">分类</li><li id="4169" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">回归</li><li id="bac7" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">时间数列预测法</li></ul><p id="82ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，Azure AutoML包括对这些任务的许多常用算法的支持，包括:</p><h2 id="7dd5" class="me kn iq bd ko mf mg dn ks mh mi dp kw jy mj mk la kc ml mm le kg mn mo li mp bi translated">分类算法</h2><ul class=""><li id="8217" class="lq lr iq jp b jq lk ju ll jy mq kc mr kg ms kk lv lw lx ly bi translated">逻辑回归</li><li id="a9a4" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">光梯度推进机</li><li id="2cdf" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">决策图表</li><li id="f47e" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">随机森林</li><li id="192b" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">朴素贝叶斯</li><li id="7b20" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">线性支持向量机(SVM)</li><li id="5e5d" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">XGBoost</li><li id="a219" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">深度神经网络(DNN)分类器</li><li id="f05d" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">其他…</li></ul><h2 id="8193" class="me kn iq bd ko mf mg dn ks mh mi dp kw jy mj mk la kc ml mm le kg mn mo li mp bi translated">回归算法</h2><ul class=""><li id="e4bf" class="lq lr iq jp b jq lk ju ll jy mq kc mr kg ms kk lv lw lx ly bi translated">线性回归</li><li id="238f" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">光梯度推进机</li><li id="b318" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">决策图表</li><li id="1a28" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">随机森林</li><li id="921a" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">弹性网</li><li id="6242" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">拉斯·拉索</li><li id="8f79" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">XGBoost</li><li id="0cbc" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">其他…</li></ul><h2 id="8847" class="me kn iq bd ko mf mg dn ks mh mi dp kw jy mj mk la kc ml mm le kg mn mo li mp bi translated">预测算法</h2><ul class=""><li id="cad7" class="lq lr iq jp b jq lk ju ll jy mq kc mr kg ms kk lv lw lx ly bi translated">线性回归</li><li id="a79d" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">光梯度推进机</li><li id="9b7c" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">决策图表</li><li id="9028" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">随机森林</li><li id="53fa" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">弹性网</li><li id="11df" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">拉斯·拉索</li><li id="326c" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">XGBoost</li><li id="5cba" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">其他…</li></ul><p id="8679" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关支持的算法的完整列表，请参见文档中的<a class="ae lp" href="https://aka.ms/AA70rrr" rel="noopener ugc nofollow" target="_blank">如何定义机器学习任务</a>。</p><h1 id="b431" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">使用SDK配置自动化机器学习实验</h1><p id="4011" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">虽然<a class="ae lp" href="https://docs.microsoft.com/en-us/azure/machine-learning/tutorial-first-experiment-automated-ml" rel="noopener ugc nofollow" target="_blank">用户界面</a>提供了一种直观的方式来为您的自动化机器学习实验选择选项，但使用SDK可以为用户提供更大的灵活性来设置实验和监控运行。在这里，我列出了指导用户通过SDK运行AutoML的七个步骤。</p><h1 id="8ec1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤1:创建计算目标</h1><p id="dc8e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在Azure机器学习中，<em class="kl">计算目标</em>是运行实验的物理或虚拟计算机。</p><p id="7847" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将实验运行分配给特定计算目标的能力有助于您通过以下方式实施灵活的数据科学生态系统:</p><ul class=""><li id="29ed" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">代码可以在本地或低成本计算上开发和测试，然后移动到更具可扩展性的计算上，以满足生产工作负载的需求。</li><li id="9469" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">您可以在计算目标上运行最适合其需求的单个进程。例如，通过使用基于GPU的计算来训练深度学习模型，并切换到更低成本的纯CPU计算来测试和注册训练好的模型。</li></ul><p id="6262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">云计算的核心优势之一是能够通过只为您使用的东西付费来管理成本。在Azure机器学习中，您可以通过定义计算目标来利用这一原则:</p><ul class=""><li id="68e6" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">按需启动，不再需要时自动停止。</li><li id="7add" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">基于工作负载处理需求自动扩展。</li></ul><p id="4ab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关计算目标的完整文档，请查看此处:</p><p id="b3c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure Machine Learning包括在工作空间中创建<em class="kl">计算实例</em>的能力，以提供一个开发环境(Jupyter Notebook、Jupyer Lab、RStudio和SSH)，该环境由工作空间中的所有其他资产管理。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/1ba9d084e029bccaf8dc8a26395b8d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zejo6Fz-mS5TQ-TYi5qlhw.jpeg"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated"><a class="ae lp" href="https://docs.microsoft.com/en-us/azure/machine-learning/overview-what-is-machine-learning-studio" rel="noopener ugc nofollow" target="_blank">Azure机器学习概述(微软官方文档)</a></p></figure><h1 id="438d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤2:为Python安装Azure机器学习SDK</h1><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="10f0" class="me kn iq nk b gy no np l nq nr">pip install azureml-sdk</span></pre><p id="82fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SDK包括可选的额外功能<em class="kl"/>,这些功能不是核心操作所必需的，但在某些情况下会很有用。例如，notebooks extra包括用于在Jupyter笔记本中显示详细输出的小部件，automl extra包括用于自动化机器学习培训的包，explain extra包括用于生成模型解释的包。要安装extras，请在括号中指定它们，如下所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="8192" class="me kn iq nk b gy no np l nq nr">pip install azureml-sdk[notebooks, automl,explain]</span></pre><p id="20b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多信息:关于为Python安装Azure机器学习SDK的更多信息，请参见<a class="ae lp" href="https://aka.ms/AA70rq7" rel="noopener ugc nofollow" target="_blank"> SDK文档</a>。此外，您应该知道SDK会定期更新，并查看最新版本的<a class="ae lp" href="https://aka.ms/AA70zel" rel="noopener ugc nofollow" target="_blank">发行说明。</a></p><h1 id="eb0d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤3:指定培训数据</h1><p id="f2f8" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">自动化机器学习旨在使您能够简单地带来您的数据，并让Azure Machine Learning找出如何最好地从中训练一个模型。</p><p id="9f97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Azure Machine Learning studio中使用自动化机器学习用户界面时，可以创建或选择一个Azure Machine Learning <a class="ae lp" href="https://aka.ms/AA6zxeb" rel="noopener ugc nofollow" target="_blank"> <em class="kl">数据集</em> </a>作为自动化机器学习实验的输入。</p><p id="5325" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用SDK运行自动化机器学习实验时，可以通过以下方式提交数据:</p><ul class=""><li id="2049" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">指定<em class="kl">训练数据</em>的数据集或数据帧，包括待预测的特征和标签。</li><li id="9c4c" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">可选地，指定将用于验证训练模型的第二个<em class="kl">验证数据</em>数据集或数据帧。如果没有提供，Azure Machine Learning将使用训练数据应用交叉验证。</li></ul><p id="1600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者:</p><ul class=""><li id="4e0e" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">指定包含训练特征的dataset、dataframe或numpy数组的<em class="kl"> X </em>值，以及相应的标签值的<em class="kl"> y </em>数组。</li><li id="ac05" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">或者，指定用于验证的<em class="kl"> X_valid </em>和<em class="kl"> y_valid </em>数据集、数据帧或<em class="kl"> X_valid </em>值的numpy数组。</li></ul><p id="1f94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提示1: AML具有数据分析的嵌入功能，允许用户浏览他们注册的数据集:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ns"><img src="../Images/47b81ca2b389521b370b7090446cb042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lAYHUWlJqWZudma_yiKS_Q.jpeg"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">如何监控AML中的数据集(<a class="ae lp" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-monitor-datasets" rel="noopener ugc nofollow" target="_blank">微软官方文档</a>)</p></figure><p id="3cfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想在您的SDK实验中拥有这个特性，您可以使用实际的python包(<code class="fe nt nu nv nk b">pandas_profiling</code>)并且在安装这个包之后，生成[profile report，运行:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="1bcd" class="me kn iq nk b gy no np l nq nr">profile = ProfileReport(df, title="Pandas Profiling Report")</span></pre><p id="a76a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这可以通过简单地显示报告来实现。在Jupyter笔记本中，运行:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="6b40" class="me kn iq nk b gy no np l nq nr">profile.to_widgets()</span></pre><p id="01ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">HTML报告可以包含在Jupyter笔记本中:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/3987c7109315c759c441571bf623fe70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*d8PCi0YyE2PoSZe2QlwNQg.gif"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">包熊猫_剖析(<a class="ae lp" href="https://pandas-profiling.github.io/pandas-profiling/docs/master/index.html" rel="noopener ugc nofollow" target="_blank">官方Github回购)</a></p></figure><p id="56d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下代码:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="e284" class="me kn iq nk b gy no np l nq nr">profile.to_notebook_iframe()</span></pre><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/672a36efc59bbe47b71eb11c36302e6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QKfUipzzOB2sIu49EWbNnw.gif"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">包熊猫_简介(<a class="ae lp" href="https://pandas-profiling.github.io/pandas-profiling/docs/master/index.html" rel="noopener ugc nofollow" target="_blank">Github官方回购)</a></p></figure><h2 id="b3b0" class="me kn iq bd ko mf mg dn ks mh mi dp kw jy mj mk la kc ml mm le kg mn mo li mp bi translated">保存报告</h2><p id="a886" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">如果您想生成一个HTML报告文件，将<code class="fe nt nu nv nk b">ProfileReport</code>保存到一个对象并使用<code class="fe nt nu nv nk b">to_file()</code>函数:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="e7c1" class="me kn iq nk b gy no np l nq nr">profile.to_file("your_report.html")</span></pre><p id="e451" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，您可以获取json格式的数据:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="4763" class="me kn iq nk b gy no np l nq nr"><em class="kl"># As a string</em><br/>json_data = profile.to_json()</span><span id="b878" class="me kn iq nk b gy nx np l nq nr"><em class="kl"># As a file</em><br/>profile.to_file("your_report.json")</span></pre><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/672a36efc59bbe47b71eb11c36302e6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QKfUipzzOB2sIu49EWbNnw.gif"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">包熊猫_剖析(<a class="ae lp" href="https://pandas-profiling.github.io/pandas-profiling/docs/master/index.html" rel="noopener ugc nofollow" target="_blank">官方Github回购)</a></p></figure><h1 id="8dfb" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤4:连接到工作区</h1><p id="a075" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在Python环境中安装SDK包后，您可以编写代码来连接到您的工作空间并执行机器学习操作。连接到工作区的最简单方法是使用工作区配置文件，该文件包括Azure订阅、资源组和工作区详细信息，如下所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="d4bf" class="me kn iq nk b gy no np l nq nr">{     <br/>      "subscription_id": "&lt;subscription-id&gt;",     <br/>      "resource_group": "&lt;resource-group&gt;",     <br/>      "workspace_name": "&lt;workspace-name&gt;" <br/>}</span></pre><p id="fcdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用配置文件连接到工作区，可以使用SDK中workspace类的from_config方法，如下所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="3766" class="me kn iq nk b gy no np l nq nr">from azureml.core import Workspace</span><span id="b51a" class="me kn iq nk b gy nx np l nq nr">subscription_id = '&lt;subscription-id&gt;'<br/>resource_group  = '&lt;resource-group&gt;'<br/>workspace_name  = '&lt;workspace-name&gt;'</span><span id="940d" class="me kn iq nk b gy nx np l nq nr">try:<br/>    ws = Workspace(subscription_id = subscription_id, resource_group = resource_group, workspace_name = workspace_name)<br/>    ws.write_config()<br/>    print('Library configuration succeeded')<br/>except:<br/>    print('Workspace not found')</span></pre><h1 id="4dbb" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤5:配置自动化机器学习实验</h1><p id="b327" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">用户界面提供了一种直观的方式来为您的自动化机器学习实验选择选项。使用SDK时，您有更大的灵活性，并且可以使用AutoMLConfig类设置实验选项，如以下示例所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="efad" class="me kn iq nk b gy no np l nq nr">automl_settings = {<br/>    "n_cross_validations": 3,<br/>    "primary_metric": 'average_precision_score_weighted',<br/>    "enable_early_stopping": <strong class="nk ir">True</strong>,<br/>    "max_concurrent_iterations": 2, <em class="kl"># This is a limit for testing purpose, please increase it as per cluster size</em><br/>    "experiment_timeout_hours": 0.25, <em class="kl"># This is a time limit for testing purposes, remove it for real use cases, this will drastically limit ablity to find the best model possible</em><br/>    "verbosity": logging.INFO,<br/>}<br/><br/>automl_config = AutoMLConfig(task = 'classification',<br/>                             debug_log = 'automl_errors.log',<br/>                             compute_target = compute_target,<br/>                             training_data = training_data,<br/>                             label_column_name = label_column_name,<br/>                             **automl_settings<br/>                            )</span></pre><h1 id="19b5" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤6:提交自动化机器学习实验</h1><p id="c9a5" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">像任何科学学科一样，数据科学包括运行<em class="kl">实验</em>；通常是为了探索数据或构建和评估预测模型。在Azure机器学习中，实验是一个命名的过程，通常是脚本或管道的运行，它可以生成指标和输出，并在Azure机器学习工作区中被跟踪。</p><p id="87f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个实验可以用不同的数据、代码或设置运行多次；Azure Machine Learning跟踪每次运行，使您能够查看运行历史并比较每次运行的结果。</p><p id="a8a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以像提交任何其他基于SDK的实验一样提交自动化机器学习实验:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="3013" class="me kn iq nk b gy no np l nq nr">from azureml.core.experiment import Experiment<br/> <br/>automl_experiment = experiment(ws,'automl_experiment')<br/>automl_run = automl_experiment.submit(automl_config)<br/>automl_run.wait_for_completion(show_output=True)</span></pre><h1 id="fe39" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤7:检索最佳运行及其模型</h1><p id="3dd0" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">你可以很容易地在Azure Machine Learning studio中确定最佳运行，并下载或部署它生成的模型。要使用SDK以编程方式实现这一点，您可以使用如下示例所示的代码:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="6acc" class="me kn iq nk b gy no np l nq nr">best_run, fitted_model = automl_run.get_output()<br/>print(best_run)<br/>print(fitted_model)</span></pre><h1 id="c26f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">提示2:实验运行上下文</h1><p id="cc01" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">除了最佳模型，当您提交一个实验时，您使用它的<em class="kl">运行上下文</em>来初始化和结束Azure Machine Learning中跟踪的实验运行，如以下代码示例所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="544d" class="me kn iq nk b gy no np l nq nr">automl_run = experiment.start_logging()</span><span id="582d" class="me kn iq nk b gy nx np l nq nr">run = automl_run.get_context() # allow_offline=True by default, so can be run locally as well    <br/>...    <br/>run.log("Accuracy", 0.98)    <br/>run.log_row("Performance", epoch=e, error=err)</span></pre><h1 id="536f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">日志记录指标</h1><p id="b767" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">每个实验都会生成日志文件，其中包含在交互执行期间将被写入终端的消息。这使您能够使用简单的<code class="fe nt nu nv nk b">print</code>语句将消息写入日志。但是，如果您想要记录命名的度量，以便在运行之间进行比较，您可以通过使用Run对象来实现；它提供了一系列专门用于此目的的日志功能。其中包括:</p><ul class=""><li id="8324" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">日志:记录单个命名值。</li><li id="5aa2" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">log_list:记录一个命名的值列表。</li><li id="51cd" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">log_row:记录一个有多列的行。</li><li id="af47" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">log_table:将字典记录为表格。</li><li id="80b1" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">log_image:记录图像文件或绘图。</li></ul><blockquote class="ny nz oa"><p id="24f1" class="jn jo kl jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated"><em class="iq">更多信息:有关实验运行期间记录指标的更多信息，请参见Azure机器学习文档中的</em> <a class="ae lp" href="https://aka.ms/AA70zf6" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Monitor Azure ML实验运行和指标</em> </a> <em class="iq">。</em></p></blockquote><h1 id="8ed2" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">检索和查看记录的指标</h1><p id="c284" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">您可以查看Azure Machine Learning studio中运行的实验记录的指标，或者使用笔记本中的RunDetails小部件，如下所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="270b" class="me kn iq nk b gy no np l nq nr">from azureml.widgets import RunDetails<br/>RunDetails(automl_run).show()</span></pre><p id="ebf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以使用Run对象的get_metrics方法检索指标，该方法返回指标的JSON表示，如下所示:</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="87bf" class="me kn iq nk b gy no np l nq nr">best_run_metrics = best_run.get_metrics() # or other runs with runID<br/>for metric_name in best_run_metrics:<br/>     metric = best_run_metrics[metric_name]<br/>     print(metric_name, metric)</span></pre><p id="4e42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">run的另一个好方法是<code class="fe nt nu nv nk b">get_properties</code>,它允许您从服务中获取运行的最新属性，并返回一个dict类型，可以查询特定的属性，如迭代、算法名、类名和许多其他需要提取的有用特性。</p><p id="2757" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个有用的方法<code class="fe nt nu nv nk b">get_status</code>返回的常见值包括“正在运行”、“已完成”和“失败”。</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="156b" class="me kn iq nk b gy no np l nq nr">while automl_run.get_status() not in ['Completed','Failed']: <br/>    print('Run {} not in terminal state'.format(atoml_run.id))<br/>    time.sleep(10) </span></pre><p id="0ccb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的代码示例展示了<code class="fe nt nu nv nk b">list</code>方法的一些用法。</p><pre class="mu mv mw mx gt nj nk nl nm aw nn bi"><span id="958e" class="me kn iq nk b gy no np l nq nr">favorite_completed_runs = automl_run.list(experiment, status='Completed', tags = 'favorite')</span><span id="7fb5" class="me kn iq nk b gy nx np l nq nr">all_distinc_runs = automl_run.list(experiment)</span><span id="06cc" class="me kn iq nk b gy nx np l nq nr">and_their_children = automl_run.list(experiment, include_children=True)</span><span id="e93c" class="me kn iq nk b gy nx np l nq nr">only_script_runs = Run.list(experiment,, type=ScriptRun.RUN_TYPE)</span></pre><p id="cda9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关方法的完整列表，请参见Azure ML API <a class="ae lp" href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.run(class)?view=azure-ml-py" rel="noopener ugc nofollow" target="_blank"> <em class="kl">文档</em> </a>。</p></div></div>    
</body>
</html>