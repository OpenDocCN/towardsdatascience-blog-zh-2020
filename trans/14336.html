<html>
<head>
<title>Zebra Detector — Your third end-to-end CNN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">斑马探测器——您的第三个端到端CNN</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/zebra-detector-your-third-end-to-end-cnn-in-5-minutes-3ffea91d5566?source=collection_archive---------60-----------------------#2020-10-02">https://towardsdatascience.com/zebra-detector-your-third-end-to-end-cnn-in-5-minutes-3ffea91d5566?source=collection_archive---------60-----------------------#2020-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6c52bce186229e895a40df9123ed03fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qziMUnujNAPTkU29"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">罗恩·多芬在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><blockquote class="kd"><p id="d011" class="ke kf iq bd kg kh ki kj kk kl km kn dk translated">第三CNN？</p></blockquote><p id="6375" class="pw-post-body-paragraph ko kp iq kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk kn ij bi translated">这是我在自己动手CNN模型系列的第三篇文章。像往常一样，格式将保持不变。我给你一个Colab文件(非常好用)，你必须在没有任何条件的情况下运行它，然后才能继续。原因是，一旦你自己运行它，你会变得更加重视这个问题，你会得到更深刻的见解。</p><p id="741a" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">你可以在这里查看我以前的文章:</p><ul class=""><li id="9fc5" class="lq lr iq kq b kr ll kv lm kz ls ld lt lh lu kn lv lw lx ly bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/handwritten-digit-classifier-your-first-end-to-end-cnn-in-5-minutes-5be3d9c6c4c0">手写数字分类器</a></li><li id="23d5" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/cats-vs-dogs-your-second-end-to-end-cnn-classifier-in-5-minutes-9adfbde08a09">猫vs狗分类器</a></li></ul></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="8039" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">所以，事不宜迟，让我把Colab <a class="ae kc" href="https://colab.research.google.com/drive/1WYWDYEBLGx4rAGq3z4TQ8DHUpZ5EoVBj?usp=sharing" rel="noopener ugc nofollow" target="_blank">文件</a>交给你🚀。这不是我的作品，而是从各地抄袭来的。我在这里做的唯一一件事是确保它在Colab设置中运行良好(令人惊讶的是，这很难做到)。但是，尽管如此，它现在工作得很好，唷！</p><p id="3c27" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">请随意上传您的图像并检测它们！现在，这个文件看起来可能有点吓人，但实际上并不是这样。像往常一样，我们先从理论开始，稍后将讨论实现细节。此外，根据我以前的文章，我会尽量保持简短和甜蜜。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="5205" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">分类Vs定位Vs检测</h1><p id="4ec6" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">首先，我们所说的检测实际上指的是什么？</p><ul class=""><li id="df84" class="lq lr iq kq b kr ll kv lm kz ls ld lt lh lu kn lv lw lx ly bi translated"><em class="no">分类——在图像中找到主要项目并标记它。</em></li><li id="775f" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><em class="no">定位——找到图像中的主要项目，标记它，并找到它的位置。</em></li><li id="e7d5" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><em class="no">检测—检测图像中的所有项目，找到它们的位置，并标记它们。</em></li></ul><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/f9e514fdd7e259df834d995e2be9fa90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*2RXyBGtjJm3QHXqsTPBMTw.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://theaisummer.com/assets/img/posts/Localization_and_Object_Detection/cv_tasks.jpg" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="15a8" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">目标检测</h1><p id="2e8f" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">对象检测看起来很复杂，但实际上并不复杂。它只是建立在我们已经了解的CNN的基础上。因此，我们早期的细胞神经网络有一些缺点，由于它不适合对象检测。让我们试着找出这些问题，你自己会建议一些调整来克服它们。在这个过程中，我们将理解令人生畏的<em class="no">物体探测器背后的直觉。</em></p><blockquote class="nu nv nw"><p id="f6f4" class="ko kp no kq b kr ll kt ku kv lm kx ky nx ln lb lc ny lo lf lg nz lp lj lk kn ij bi translated">请记住一件事——我们的目标不仅仅是对图像进行分类，还要找到它的位置。事实上，图像中的所有项目都应该被检测、标记和定位。</p></blockquote></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="2ac4" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">缺点1 —输出层</h1><p id="6e18" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">一些快速的问题！</p><ul class=""><li id="6f82" class="lq lr iq kq b kr ll kv lm kz ls ld lt lh lu kn lv lw lx ly bi translated"><em class="no">我们在</em> <a class="ae kc" href="https://medium.com/r?url=https%3A%2F%2Ftowardsdatascience.com%2Fhandwritten-digit-classifier-your-first-end-to-end-cnn-in-5-minutes-5be3d9c6c4c0" rel="noopener"> <em class="no">手写数字分类器</em> </a> <em class="no">中有多少个输出节点？</em></li><li id="d0fb" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><em class="no">我们应该如何在输出中输出被检测项目的位置？</em></li></ul><p id="0668" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">想想吧！这不是火箭科学！！🤔<br/>好了，回答时间！！</p><p id="b046" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">之前我们有10个输出节点。原因是，只有10个标签是可能的(0–9)。现在，如果我们除了标签还想要位置，我们应该怎么做？</p><p id="152b" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">想象一个假想的多边形(<em class="no">中心:(x，y)，宽度:w，高度:h </em>)可以包围那个数字。现在，我们只需要输出矩形和万岁的坐标，我们也将有本地化信息。仅此而已！因此，如果你会看到，我们刚刚在输出层添加了一些信息，以获得位置信息。</p><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/8ce425e173ae9f47599228806327fa41.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*3CAsLiDtZXI-qLpTZ9anyw.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="8814" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated"><strong class="kq ir"> <em class="no">上一次输出:</em></strong><em class="no">【0，0，0，1，0，0，0，0，0】<br/></em><strong class="kq ir"><em class="no">新输出:</em></strong><em class="no">【0，0，0，0，1，0，0，</em> <strong class="kq ir"> <em class="no"> x，y，h，w</em></strong><em class="no"/></p><p id="1739" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">因此，这里前面的输出表示我们的输出数组的一位热编码，因此只有3是1，其他的输出是0。物体探测器会再增加4个坐标来让我们知道它的位置。瞧啊。所有其他反向传播将一如既往地工作(因为只多了4个输出)。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="e33d" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">缺点2-多重检测的输出层</h1><p id="127a" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">现在，当一幅图像只有一次检测时，我们之前所做的工作是有效的。当一个图像可以有多个检测时，我们该怎么办？！</p><p id="883a" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">想想吧！？我们只需要一种方法来解决如何在输出中发送所有检测的多个坐标。</p><ul class=""><li id="c7a5" class="lq lr iq kq b kr ll kv lm kz ls ld lt lh lu kn lv lw lx ly bi translated"><strong class="kq ir"> <em class="no">上一次输出:</em></strong><em class="no">【0，0，0，1，0，0，0，0，0，0】</em></li><li id="4eeb" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated">你在上面看到了什么？一个有10个元素的数组？还是大小为10的[1*1]矩阵？你想想，个位数不过是个[1*1]矩阵，对吧？</li><li id="dff3" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated">我们能不能用这种新的可视化方式来添加我们的位置信息？</li></ul><p id="5309" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">是的，你认为它是正确的，如果我们有一个[10 * 5]矩阵，我们可以很容易地使用它来容纳所有类别的位置信息。</p><blockquote class="nu nv nw"><p id="e414" class="ko kp no kq b kr ll kt ku kv lm kx ky nx ln lb lc ny lo lf lg nz lp lj lk kn ij bi translated"><em class="iq">有趣的事实！实际上是[5*10]矩阵还是[1*1*5*10]矩阵？坚持这个想法。</em></p></blockquote><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/757f9ee0701023f4666cfbecc011a8ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7zfmgj-1gbY8OsQN5f4Fg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="d18d" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">缺点# 3-多个相同检测的输出层</h1><p id="b081" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">上面的方法可以，但是如果一个图像中有两个3呢？我们的输出层将再次失败。有人可能会说，我们把上面的矩阵更新为[9*10]吧，多容纳一个3。但是，它没有尽头。一个图像可以有100个相同的标签。我们需要想点别的！</p><blockquote class="kd"><p id="6a85" class="ke kf iq bd kg kh oc od oe of og kn dk translated">如果找不到答案，那就改问题！</p></blockquote><p id="bb63" class="pw-post-body-paragraph ko kp iq kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk kn ij bi translated">好吧，这个问题什么时候来？当你有一个巨大的图像，里面有很多物体，对吗？让我们把图像分成更小的块来彻底解决这个问题。</p><p id="cd9e" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">因此，对于每个图像块，将有一个[5*10]矩阵。比方说，我们创建了一幅图像的<em class="no"> N </em>个块，因此我们在输出中将有[ <em class="no"> N </em> *5*10]个矩阵。</p><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/22ac96a2588cded18ef50d9892ce2d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RQqFlEjYM5PMy_esyTeSg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><blockquote class="kd"><p id="315d" class="ke kf iq bd kg kh ki kj kk kl km kn dk translated">有趣的事实——你刚刚学会了YOLO(你只看一次)！！🚀</p></blockquote></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="629a" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">缺点4——CNN将如何处理这些信息？</h1><p id="5e45" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">仔细想想，这里没什么新鲜的。输入图像是一样的，检测数字的内核也是一样的。因此，一切都将以完全相同的方式工作。</p><p id="64f6" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">这里唯一不同的是输入图像的<strong class="kq ir">大小。</strong>比原来的层能处理的<strong class="kq ir"> </strong>大一点。因此，由于尺寸较大，它将有大量的输出。</p><p id="600b" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">所以，早些时候CNN产生了10个输出。这一个将产生更多，因为我们有一个更大的图像，但卷积层的数量保持不变。这就是我们有意要做的。因为现在输出信息增加了(也包括仓位)。</p><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/54135b634db1c251205c35954f6c57b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNonoj2j0N6UIglUv85Q9g.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.oreilly.com/library/view/python-advanced-guide/9781789957211/assets/3fd9cc43-c9e1-433e-a065-fc44c6475b8d.png" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="0d46" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">缺点5——一个项目分成多个块</h1><p id="7a44" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">新的解决方案会带来一系列新的问题。当我们将一幅图像分成多个更小的块时，一幅图像可能存在于多个块中。在这种情况下，一个项目可能会被检测两次。如何解决这个问题？</p><p id="16d2" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">当有100个学生想成为班上的第一名时，你通常如何解决这个问题？你要求他们证明他们的可信度。哪个分数最高，谁就是冠军。一模一样。检测到最高概率和最佳定位位置的任何一个组块都应该得到该项目。简单！</p><p id="8ebb" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">是的，在检测之后，将会有一层来宣布该物品在战斗块中的获胜者。在YOLO，有一个概念叫做并上交集，用于检测战斗块的可信度。如果你愿意，你可以在网上了解更多。</p><blockquote class="kd"><p id="d1e4" class="ke kf iq bd kg kh oc od oe of og kn dk translated">顺便说一句，你刚刚学习了非最大抑制🚀</p></blockquote></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="201c" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">缺点6——一个块中有多个项目</h1><p id="2796" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">如果一个chunk需要检测多个类怎么办？我们来了解一下什么时候能发生这种情况？理想情况下，由于块的尺寸较小，这种情况不应该发生。但是，如果我们在一个图像中有重叠的项目呢？这种情况很有可能发生，对吗？</p><p id="817f" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">但是，多田！我们已经在我们的<em class="no">缺点#3 </em>中解决了。我们的每个块已经能够检测所有的类。很酷很强大，对吧？！</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="3e38" class="ml mm iq bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">履行</h1><p id="8d80" class="pw-post-body-paragraph ko kp iq kq b kr nj kt ku kv nk kx ky kz nl lb lc ld nm lf lg lh nn lj lk kn ij bi translated">Colab文件应该运行得很好。这可能有点令人望而生畏，但是当您阅读代码时，您会意识到这只是:</p><ul class=""><li id="f50e" class="lq lr iq kq b kr ll kv lm kz ls ld lt lh lu kn lv lw lx ly bi translated"><em class="no">创建一个巨大的多层CNN</em></li><li id="02a7" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><em class="no">从预先训练好的模型中加载砝码</em></li><li id="1cf6" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><em class="no">在样本图像上测试它(在我的例子中是斑马)</em></li><li id="7831" class="lq lr iq kq b kr lz kv ma kz mb ld mc lh md kn lv lw lx ly bi translated"><em class="no">然后剩下的代码只是创建一个框来帮助你可视化本地化输出</em></li></ul><p id="c580" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">我强烈建议上传不同的图片，然后玩玩。还有，所有的实现逻辑都是受<a class="ae kc" href="https://github.com/arshren/YOLOV3/blob/master/YOLO%20Step%20by%20Step.ipynb" rel="noopener ugc nofollow" target="_blank">这个</a>和<a class="ae kc" rel="noopener" target="_blank" href="/object-detection-using-yolov3-using-keras-80bf35e61ce1">这个</a>的启发。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="512a" class="pw-post-body-paragraph ko kp iq kq b kr ll kt ku kv lm kx ky kz ln lb lc ld lo lf lg lh lp lj lk kn ij bi translated">这就是物体探测器的全部内容。我只是有意提到了YOLO。其他技术将覆盖某一层。</p></div></div>    
</body>
</html>