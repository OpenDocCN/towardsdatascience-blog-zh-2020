<html>
<head>
<title>Sharpe Ratio, Sortino Ratio and Calmar Ratio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">夏普比率、索提诺比率和卡尔马尔比率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sharpe-ratio-sorino-ratio-and-calmar-ratio-252b0cddc328?source=collection_archive---------29-----------------------#2020-10-12">https://towardsdatascience.com/sharpe-ratio-sorino-ratio-and-calmar-ratio-252b0cddc328?source=collection_archive---------29-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f383" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这篇短篇小说中，我们将探讨夏普比率的不足之处，以及我们如何用索蒂诺比率和卡尔马尔比率对其进行补充，以更清楚地了解投资组合的表现。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1513837d67eda7dee28fc950c5533070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLGxxHtOUzV_hFZWwrdpHw.png"/></div></div></figure><p id="a0fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在投资组合业绩分析中，夏普比率通常是人们首先关注的数字。然而，它并没有告诉我们整个故事(没有什么能告诉我们……)。因此，让我们花些时间来看看更多一些有时非常有用的指标。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h2 id="f3f6" class="lx ly it bd lz ma mb dn mc md me dp mf ld mg mh mi lh mj mk ml ll mm mn mo mp bi translated">夏普比率再探</h2><p id="734e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">夏普比率是平均回报率除以年回报率的标准差的比率。我们在之前的<a class="ae mv" href="https://medium.com/the-innovation/portfolio-analysis-basics-volatility-sharpe-ratio-d7521d79ba0" rel="noopener">故事</a>中有过介绍。</p><p id="8146" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们用一个测试价格时间序列再来看一下。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="e639" class="lx ly it mx b gy nb nc l nd ne">import pandas as pd<br/>import numpy as np<br/><br/>from pandas.tseries.offsets import BDay<br/><br/><br/>def daily_returns(prices):<br/><br/>    res = (prices/prices.shift(1) - 1.0)[1:]<br/>    res.columns = ['return']<br/><br/>    return res<br/><br/><br/>def sharpe(returns, risk_free=0):<br/>    adj_returns = returns - risk_free<br/>    return (np.nanmean(adj_returns) * np.sqrt(252)) \<br/>        / np.nanstd(adj_returns, ddof=1)<br/><br/><br/>def test_price1():<br/><br/>    start_date = pd.Timestamp(2020, 1, 1) + BDay()<br/><br/>    len = 100<br/><br/>    bdates = [start_date + BDay(i) for i in range(len)]<br/>    price = [10.0 + i/10.0 for i in range(len)]<br/><br/>    return pd.DataFrame(data={'date': bdates,<br/>                              'price1': price}).set_index('date')<br/><br/><br/>def test_price2():<br/><br/>    start_date = pd.Timestamp(2020, 1, 1) + BDay()<br/><br/>    len = 100<br/><br/>    bdates = [start_date + BDay(i) for i in range(len)]<br/>    price = [10.0 + i/10.0 for i in range(len)]<br/><br/>    price[40:60] = [price[40] for i in range(20)]<br/><br/>    return pd.DataFrame(data={'date': bdates,<br/>                              'price2': price}).set_index('date')<br/><br/><br/>def test_price3():<br/><br/>    start_date = pd.Timestamp(2020, 1, 1) + BDay()<br/><br/>    len = 100<br/><br/>    bdates = [start_date + BDay(i) for i in range(len)]<br/>    price = [10.0 + i/10.0 for i in range(len)]<br/><br/>    price[40:60] = [price[40] - i/10.0 for i in range(20)]<br/><br/>    return pd.DataFrame(data={'date': bdates,<br/>                              'price3': price}).set_index('date')<br/><br/><br/>def test_price4():<br/><br/>    start_date = pd.Timestamp(2020, 1, 1) + BDay()<br/><br/>    len = 100<br/><br/>    bdates = [start_date + BDay(i) for i in range(len)]<br/>    price = [10.0 + i/10.0 for i in range(len)]<br/><br/>    price[40:60] = [price[40] - i/8.0 for i in range(20)]<br/><br/>    return pd.DataFrame(data={'date': bdates,<br/>                              'price4': price}).set_index('date')<br/><br/><br/>price1 = test_price1()<br/>return1 = daily_returns(price1)<br/><br/>price2 = test_price2()<br/>return2 = daily_returns(price2)<br/><br/>price3 = test_price3()<br/>return3 = daily_returns(price3)<br/><br/>price4 = test_price4()<br/>return4 = daily_returns(price4)<br/><br/>print('price1')<br/>print(f'sharpe: {sharpe(return1)}')<br/><br/>print('price2')<br/>print(f'sharpe: {sharpe(return2)}')<br/><br/>print('price3')<br/>print(f'sharpe: {sharpe(return3)}')<br/><br/>print('price4')<br/>print(f'sharpe: {sharpe(return4)}')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b4566e19fc939ff3b297d0cdb360e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XB2uchJQHanHMFltg4NEOQ.png"/></div></div></figure><p id="c9d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如你在这个例子中看到的，我有4个测试价格时间序列。第一个，price1，是一条简单的直线(不要介意曲线，这是由于周末被遗漏了)。第二个价格时间序列price2有一个平坦区域。第三个价格时间序列price3有一个向下倾斜的区域。最后一个时间序列price4的下降幅度稍大。</p><p id="cc42" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每种价格的夏普比率计算如下:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="70ee" class="lx ly it mx b gy nb nc l nd ne">'''<br/>price1<br/>sharpe: 78.59900981328562<br/>price2<br/>sharpe: 7.9354707022912825<br/>price3<br/>sharpe: 3.61693599695678<br/>price4<br/>sharpe: 3.151996500460301</span><span id="8999" class="lx ly it mx b gy nf nc l nd ne">'''</span></pre><p id="56b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如你所见，由于几乎不存在波动性，price1具有非常高的夏普比率。由于平坦区域的存在，Price2的夏普比率几乎低10倍。由于向下倾斜，价格3和价格4比价格2低大约两倍，价格4的夏普比率略低于价格3的夏普比率。</p><p id="e3d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看着这些数字，有一件事可能看起来有点奇怪，那就是夏普比率仅仅因为平坦区域的存在而降低了多少。毕竟总回报没变，根本不存在降额。对于投资者来说，价格1和价格2没有太大区别。</p><p id="874a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一方面，价格3和价格4有相当大的下降，然而夏普比率下降了大约一半，而价格1和价格2之间下降了10倍。<strong class="kw iu">这似乎是夏普比率在告诉我们价格时间序列有多可取的能力上的一个缺陷。</strong></p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="635d" class="ng ly it bd lz nh ni nj mc nk nl nm mf jz nn ka mi kc no kd ml kf np kg mo nq bi translated"><strong class="ak">排序比</strong></h1><p id="3b7e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">为了解决夏普比率不能线性反映时间序列下行的问题，Sortino比率有时是一个很好的指标。</p><p id="7ed1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">排序比率=平均收益/下跌风险</p><p id="93a0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其中下跌风险是时间序列内的平均负收益。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="827b" class="lx ly it mx b gy nb nc l nd ne">def downside_risk(returns, risk_free=0):<br/>    adj_returns = returns - risk_free<br/>    sqr_downside = np.square(np.clip(adj_returns, np.NINF, 0))<br/>    return np.sqrt(np.nanmean(sqr_downside) * 252)<br/><br/><br/>def sortino(returns, risk_free=0):<br/>    adj_returns = returns - risk_free<br/>    drisk = downside_risk(adj_returns)<br/><br/>    if drisk == 0:<br/>        return np.nan<br/><br/>    return (np.nanmean(adj_returns) * np.sqrt(252)) \<br/>        / drisk</span></pre><p id="cdd6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将sortino比率应用于我们的测试价格:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="32ce" class="lx ly it mx b gy nb nc l nd ne">'''<br/>price1<br/>sortino: nan<br/>price2<br/>sortino: nan<br/>price3<br/>sortino: 2.210224924119601<br/>price4<br/>sortino: 1.7688718895750382<br/>'''</span></pre><p id="5d30" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">价格price1和price2根本没有负收益，所以对它们来说不存在排序比。对于价格3，排序比是2.2，而对于价格4，排序比是1.8，这是因为根据需要，向下的斜率更大。</p><p id="a857" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们再看一个例子:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="a8d1" class="lx ly it mx b gy nb nc l nd ne">def test_price5():<br/><br/>    start_date = pd.Timestamp(2020, 1, 1) + BDay()<br/><br/>    len = 100<br/><br/>    bdates = [start_date + BDay(i) for i in range(len)]<br/>    price = [10.0 + i/10.0 for i in range(len)]<br/><br/>    price[40:60] = [price[40] - i/10.1 for i in range(20)]<br/><br/>    price[80] = 15<br/><br/>    return pd.DataFrame(data={'date': bdates,<br/>                              'price5': price}).set_index('date')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/531ebd0883dc215e78503d69c40b8c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBa4iFuRGnglZHDPseAQdA.png"/></div></div></figure><p id="941c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个新的价格时间序列price5中，我们在price3的基础上增加了一个下降，你会认为这个下降会降低sortino比率，对吗？让我们来看看:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="9910" class="lx ly it mx b gy nb nc l nd ne">'''<br/>price3<br/>sharpe: 3.61693599695678<br/>sortino: 2.210224924119601<br/>price4<br/>sharpe: 3.151996500460301<br/>sortino: 1.7688718895750382<br/>price5<br/>sharpe: 2.945329220777157<br/>sortino: 0.4660330265232954<br/>'''</span></pre><p id="a381" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是啊！Sortino比率确实反映了下降。但是你不觉得变化有点太大了吗？由于价格下跌，索蒂诺比从1.8下降到0.5，降幅超过3倍。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="4815" class="ng ly it bd lz nh ni nj mc nk nl nm mf jz nn ka mi kc no kd ml kf np kg mo nq bi translated">卡尔马尔比率</h1><p id="275c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在努力控制异常值引起的失真时，就像我们之前展示的那样，另一个比率有助于检测它们。这是卡尔马尔比率。</p><p id="b731" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">卡尔马尔比率=回报的几何平均值/最大下降</p><p id="8271" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经在之前的<a class="ae mv" href="https://medium.com/the-innovation/portfolio-analysis-basics-returns-and-drawdowns-70c5f7a0eb3d" rel="noopener">故事</a>中解释了最大压降。</p><p id="61c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回报的几何平均值是按时间周期长度缩放的累积回报。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="a4f1" class="lx ly it mx b gy nb nc l nd ne">def annual_returns(returns):<br/><br/>    num_years = len(returns) / 252<br/><br/>    cum_ret_final = (returns + 1).prod().squeeze()<br/><br/>    return cum_ret_final ** (1 / num_years) - 1<br/><br/><br/>def calmar(returns):<br/><br/>    max_dd = max_drawdown(cumulative_returns(returns))<br/>    if max_dd &lt; 0:<br/>        return annual_returns(returns) / abs(max_dd)<br/><br/>    return np.nan</span><span id="dcb0" class="lx ly it mx b gy nf nc l nd ne">'''<br/>price1<br/>sharpe: 78.59900981328562<br/>sortino: nan<br/>calmar: nan<br/>price2<br/>sharpe: 7.9354707022912825<br/>sortino: nan<br/>calmar: nan<br/>price3<br/>sharpe: 3.61693599695678<br/>sortino: 2.210224924119601<br/>calmar: 35.10246841328119<br/>price4<br/>sharpe: 3.151996500460301<br/>sortino: 1.7688718895750382<br/>calmar: 28.081974730625276<br/>price5<br/>sharpe: 2.945329220777157<br/>sortino: 0.4660330265232954<br/>calmar: 29.404801742258666</span><span id="6161" class="lx ly it mx b gy nf nc l nd ne">'''</span></pre><p id="1c65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如您在结果中看到的，对于price4和price5，calmar比率分别为28和29。它没有受到异常值的过多影响，还因为price5的向下斜率实际上比price4小一点点(注意price5定义中的10.1！)，它的calmar比居然增加了一点！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="19c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> <em class="nr">来自《走向数据科学》编辑的提示:</em> </strong> <em class="nr">虽然我们允许独立作者根据我们的</em> <a class="ae mv" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="nr">规则和指导方针</em> </a> <em class="nr">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae mv" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="nr">读者术语</em> </a> <em class="nr">。</em></p></div></div>    
</body>
</html>