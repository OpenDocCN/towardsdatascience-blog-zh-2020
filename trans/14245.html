<html>
<head>
<title>Building Deep Learning Projects with fastai — From Model Training to Deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用fastai构建深度学习项目——从模型训练到部署</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-projects-with-fastai-from-model-training-to-deployment-2be3135bd757?source=collection_archive---------20-----------------------#2020-10-01">https://towardsdatascience.com/deep-learning-projects-with-fastai-from-model-training-to-deployment-2be3135bd757?source=collection_archive---------20-----------------------#2020-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6936" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用fastai开发计算机视觉应用的入门指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/98e835adac456ab74c518b877dbb07b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YECeOxlko9KoOJNw8RNm3A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/s/photos/neural-network" rel="noopener ugc nofollow" target="_blank">去飞溅</a></p></figure><p id="cb55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">深度学习正在引发许多学科的革命性变化。随着TensorFlow、PyTorch和现在的<strong class="lb iu"> fastai </strong>等库的出现，领域专家和人工智能爱好者也越来越容易访问它。</p><p id="0404" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以民主化深度学习为使命，<strong class="lb iu"> fastai </strong>是一家研究机构，致力于帮助每个人，从初级程序员到熟练的深度学习实践者，通过该领域最新研究的最先进模型和技术实现世界级的结果。</p><h1 id="541c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目标</h1><p id="f535" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这篇博文将带你了解使用<strong class="lb iu"> fastai </strong>开发<strong class="lb iu">狗分类器</strong>的过程。目标是学习如何轻松地开始深度学习模型，并能够使用预先训练的模型，用有限的数据量获得近乎完美的结果。</p><h1 id="8072" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="0df9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">开始的唯一先决条件是你<strong class="lb iu">知道如何用python </strong>编码，并且你熟悉高中数学。</p><h1 id="365b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">你会学到什么</h1><ol class=""><li id="eab0" class="ms mt it lb b lc mn lf mo li mu lm mv lq mw lu mx my mz na bi translated">导入库并设置笔记本</li><li id="15ab" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">使用Microsoft Azure收集影像数据</li><li id="e95d" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">将下载的数据转换为DataLoader对象</li><li id="91a2" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">数据扩充</li><li id="c8f0" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">使用模型训练清理数据</li><li id="a9e2" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">导出定型模型</li><li id="e116" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">用你的Jupyter笔记本构建一个应用程序</li></ol></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="da29" class="lv lw it bd lx ly nn ma mb mc no me mf jz np ka mh kc nq kd mj kf nr kg ml mm bi translated">导入库并设置笔记本</h1><p id="6aec" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我们开始构建我们的模型之前，我们需要从名为<a class="ae ky" href="https://github.com/fastai/fastbook" rel="noopener ugc nofollow" target="_blank"> fastbook </a>的笔记本<a class="ae ky" href="https://github.com/fastai/fastbook" rel="noopener ugc nofollow" target="_blank">集合中导入所需的库和实用函数，该集合旨在介绍使用fastai和PyTorch的深度学习。</a></p><p id="98fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们安装fastbook包来设置笔记本:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="8983" class="nx lw it nt b gy ny nz l oa ob">!pip install -Uqq fastbook<br/>import fastbook<br/>fastbook.setup_book()</span></pre><p id="a780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，让我们从fastbook包和fastai vision widgets API导入所有函数和类:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="8404" class="nx lw it nt b gy ny nz l oa ob">from fastbook import *<br/>from fastai.vision.widgets import *</span></pre><h1 id="1b9d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用Microsoft Azure收集影像数据</h1><p id="d3ce" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">对于大多数类型的项目，你可以从各种<a class="ae ky" rel="noopener" target="_blank" href="/data-repositories-for-almost-every-type-of-data-science-project-7aa2f98128b?source=---------6----------------------------">数据仓库和网站</a>找到在线数据。为了开发一个狗分类器，我们需要有狗的图像，在互联网上有很多狗的图像。</p><p id="df3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了下载这些图片，我们将使用微软Azure提供的<a class="ae ky" href="https://azure.microsoft.com/en-us/services/cognitive-services/bing-image-search-api/" rel="noopener ugc nofollow" target="_blank"> Bing图片搜索API </a>。因此，在Microsoft Azure上注册一个免费帐户，您将获得价值200美元的点数。</p><p id="166a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到您的门户网站，使用<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account?tabs=multiservice%2Clinux" rel="noopener ugc nofollow" target="_blank">快速入门创建一个新的认知服务资源。</a>启用Bing图像搜索API，然后从左侧面板中的<code class="fe oc od oe nt b">Keys and Endpoint</code>选项将<strong class="lb iu">键</strong>复制到您的资源中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/1dca70f83655527d506b624c226e3b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwD565gdtgwUj3axQyVeYQ.png"/></div></div></figure><p id="966a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用检索到的密钥，将这些密钥设置为环境，如下所示:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="6441" class="nx lw it nt b gy ny nz l oa ob">key = os.environ.get('AZURE_SEARCH_KEY', '&lt;YOUR_KEY&gt;')</span></pre><p id="afb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，fastbook附带了几个实用函数，如<code class="fe oc od oe nt b">search_images_bing</code>，它返回与您的搜索查询相对应的URL。我们可以使用帮助功能了解这些功能:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="5ffb" class="nx lw it nt b gy ny nz l oa ob">help(fastbook)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d2ad150ab5270a18ae0a4e452d820911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYLz3Cj_fprP8J3rXuJBXA.png"/></div></div></figure><p id="3416" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以查看本帮助指南中的<code class="fe oc od oe nt b">search_image_bing</code>功能。该函数接受您在上面定义的资源和搜索查询的关键字，我们可以使用<code class="fe oc od oe nt b">attrgot</code>方法访问搜索结果的URL:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="4eae" class="nx lw it nt b gy ny nz l oa ob">results = search_images_bing(key, 'german shepherd dogs')<br/>images = results.attrgot('content_url')<br/>len(images)</span></pre><p id="6b43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有150个德国牧羊犬图片的网址:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/310d8a5538accd203673def04ad4b608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HER9nLOi5C6U8ryNUk-xMA.png"/></div></div></figure><p id="f35c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用<code class="fe oc od oe nt b">download_url</code>功能下载这些图像。但是让我们首先定义我们想要的狗的类型。在本教程中，我将和三种类型的狗一起工作，德国牧羊犬、黑狗和拉布拉多。</p><p id="0655" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，让我们定义一个狗的类型列表:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="85d5" class="nx lw it nt b gy ny nz l oa ob">dog_types = ['german shepherd', 'black', 'labrador']<br/>path = Path('dogs')</span></pre><p id="5c4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你需要定义你的图片下载的路径，以及每一类狗的文件夹的语义名称。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="0bab" class="nx lw it nt b gy ny nz l oa ob">if not path.exists():<br/>    path.mkdir()<br/>    for t in dog_types:<br/>        dest = (path/t)<br/>        print(dest)<br/>        dest.mkdir(exist_ok=True)<br/>        results = search_images_bing(key, '{} dog'.format(t))<br/>        download_images(dest, urls=results.attrgot('content_url'))</span></pre><p id="88db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个“狗”目录，其中进一步包含每种类型的狗图像的3个目录。</p><p id="6bb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们传递了搜索查询(也就是dog_type)和搜索函数的键，然后是下载函数，从搜索结果中下载所有的URL到它们各自的目的地(<code class="fe oc od oe nt b">dest</code>)目录中。</p><p id="9c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe oc od oe nt b">get_image_file</code>功能检查下载到某个路径的图像:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="1335" class="nx lw it nt b gy ny nz l oa ob">files = get_image_files(path)<br/>files</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/aff71aa5757c5c432d7aba59935d9e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tUshCSQZfcKOp4MIVRZghg.png"/></div></div></figure><h2 id="f014" class="nx lw it bd lx oj ok dn mb ol om dp mf li on oo mh lm op oq mj lq or os ml ot bi translated">验证图像</h2><p id="8895" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您还可以检查文件中损坏文件/图像的数量:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="8c79" class="nx lw it nt b gy ny nz l oa ob">corrupt = verify_images(files)<br/>corrupt</span><span id="2dd2" class="nx lw it nt b gy ou nz l oa ob">##output: (#0) []</span></pre><p id="2d70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将unlink方法映射到损坏文件列表，可以删除所有损坏的文件(如果有):</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="f1d4" class="nx lw it nt b gy ny nz l oa ob">corrupt.map(Path.unlink);</span></pre><p id="5f2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们准备了379张狗的图片来训练和验证我们的模型。</p><h1 id="4d86" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将下载的数据转换为DataLoader对象</h1><p id="7fb2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，我们需要一种机制来为我们的模型提供数据，fastai有数据加载器的概念，它存储传递给它的多个数据加载器对象，并使它们作为<code class="fe oc od oe nt b">training</code>和<code class="fe oc od oe nt b">validation</code>集合可用。</p><p id="42c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，要将下载的数据转换成DataLoader对象，我们必须提供四样东西:</p><ul class=""><li id="e294" class="ms mt it lb b lc ld lf lg li ov lm ow lq ox lu oy my mz na bi translated">我们正在处理什么样的数据</li><li id="1f59" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated">如何获取项目列表</li><li id="f472" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated">如何给这些物品贴标签</li><li id="793b" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated">如何创建验证集</li></ul><p id="29cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，为了创建这些数据加载器对象以及上面提到的信息，fastai提供了一个称为<strong class="lb iu"> <em class="oz">数据块API的灵活系统。</em> </strong>我们可以使用API提供的参数和一系列转换方法来指定数据加载器创建的所有细节:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="dd2e" class="nx lw it nt b gy ny nz l oa ob">dogs = DataBlock(<br/>        blocks=(ImageBlock, CategoryBlock),<br/>        get_items=get_image_files,<br/>        splitter=RandomSplitter(valid_pct=0.2, seed=41),<br/>        get_y=parent_label,<br/>        item_tfms=Resize(128)<br/>        )</span></pre><p id="ba69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们有一堆我们应该理解的论点:</p><ul class=""><li id="9b87" class="ms mt it lb b lc ld lf lg li ov lm ow lq ox lu oy my mz na bi translated"><strong class="lb iu">块</strong> —指定特征变量(图像)和目标变量(每个图像的类别)</li><li id="b5b8" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated"><strong class="lb iu"> get_items </strong> —检索底层项目，在我们的例子中是图像，我们有<code class="fe oc od oe nt b"><strong class="lb iu">get_image_files</strong></code>函数返回该路径中所有图像的列表。</li><li id="5334" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated"><strong class="lb iu">拆分器</strong> —按照提供的方法拆分数据；我们使用随机分割，为验证集保留20%的数据，并指定种子在每次运行时得到相同的分割。</li><li id="19a7" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated"><strong class="lb iu"> get_y — </strong>目标变量称为y；为了创建标签，我们使用了<code class="fe oc od oe nt b"><strong class="lb iu">parent_label</strong></code>函数，它获取文件所在文件夹的名称作为标签。</li><li id="f2ff" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated"><strong class="lb iu"> item_tfms </strong> —我们有不同大小的图像，这导致了一个问题，因为我们总是向模型发送一批文件，而不是单个文件；因此，我们需要对这些图像进行预处理，将它们调整到标准大小，然后将它们分组到一个张量中以通过模型。我们在这里使用了<code class="fe oc od oe nt b"><strong class="lb iu">Resize</strong></code>转换。</li></ul><p id="d077" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了DataBlock对象，需要通过提供数据集的路径将它转换为DataLoader:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="01ff" class="nx lw it nt b gy ny nz l oa ob">dls<!-- --> <!-- -->=<!-- --> <!-- -->dogs.dataloaders(path)</span></pre><p id="d93f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用<code class="fe oc od oe nt b">show_batch</code>方法检查dataloader对象中的图像:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="c618" class="nx lw it nt b gy ny nz l oa ob">dls.valid.show_batch()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/5044666452675d8576158064bfee3c97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*5imw91sV-S4HSzPivrxsPA.png"/></div></figure><h1 id="07f4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据扩充</h1><p id="4715" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们可以向这些图像添加变换，以创建输入图像的随机变化，这样它们看起来不同，但仍然代表相同的事实。</p><p id="34c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以旋转、扭曲、翻转或改变图像的亮度/对比度来创造这些变化。我们也有一套标准的增强功能封装在<code class="fe oc od oe nt b">aug_transforms</code>函数中，对于大多数计算机视觉数据集来说都非常适用。</p><p id="0e6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以将这些变换应用于整批图像，因为所有图像都具有相同的大小(224像素，图像分类问题的标准)，现在使用如下:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="0613" class="nx lw it nt b gy ny nz l oa ob">##adding item transformations</span><span id="3a7f" class="nx lw it nt b gy ou nz l oa ob">dogs = dogs.new(<br/>                item_tfms=RandomResizedCrop(224, min_scale=0.5), <br/>                batch_tfms=aug_transforms(mult=2)<br/>               )<br/>dls = dogs.dataloaders(path)<br/>dls.train.show_batch(max_n=8, nrows=2, unique=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/530fc38ec92201d9a988415710cd0363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*1a59GeB-kVPXL_2eknND9w.png"/></div></figure><h1 id="d58a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">模型训练和数据清理</h1><p id="d056" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">是时候用这些数量有限的图片来训练模型了。fastai提供了许多可供使用的架构，这使得使用迁移学习变得非常容易。我们可以使用适用于大多数应用程序/数据集的预训练模型来创建卷积神经网络(CNN)模型。</p><p id="662e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用ResNet架构，它对于许多数据集和问题来说既快速又准确。<code class="fe oc od oe nt b"><strong class="lb iu">resnet18</strong></code>中的18代表神经网络的层数。我们还使用来自数据加载器的验证集传递度量来测量模型预测的质量。我们使用<strong class="lb iu"> error_rate </strong>来说明模型做出错误预测的频率:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="fa44" class="nx lw it nt b gy ny nz l oa ob">model = cnn_learner(dls, resnet18, metrics=error_rate)<br/>model.fine_tune(4)</span></pre><p id="af76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe nt b">fine_tune</code>方法类似于其他ML库中的<code class="fe oc od oe nt b">fit()</code>方法。现在，为了训练模型，我们需要指定我们想要在每个图像上训练模型的次数(时期)。</p><p id="3e94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们只训练4个时期:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/5035c602244f76e386b2410cf7ca8e9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*LV1XA_McLkeiQTqewaI3Rg.png"/></div></div></figure><p id="043d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用混淆矩阵将预测可视化并与实际标签进行比较:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="4880" class="nx lw it nt b gy ny nz l oa ob">interp = ClassificationInterpretation.from_learner(learn)<br/>interp.plot_confusion_matrix()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/6645b3f8819f2e5ade5960429b8ed6bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*gDNsL80FIaRIsKLUV850dA.png"/></div></figure><p id="bff1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，我们只有五个不正确的预测。让我们检查一下最大损失，即数据集中损失最大的图像:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="9118" class="nx lw it nt b gy ny nz l oa ob">interp.plot_top_losses(6, nrows=3)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/29c0a377df6c6c29bd65c17d72d4e243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*EISpXCDyRDUKBvBH_QE8sQ.png"/></div></figure><p id="882a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以看到模型混淆了黑色和拉布拉多。因此，我们可以使用ImageClassifierCleaner类将这些图像指定到特定的类别中。</p><p id="7651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将模型传递给班级，它将打开一个带有直观GUI的小部件，用于数据清理。我们可以更改训练集和验证集图像的标签，并查看损失最大的图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/a1fb33ee1e0c0f6f517e9efeadbd1bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8ZtGHgUnaOTUJTBIOkKpg.png"/></div></div></figure><p id="9114" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将每个图像添加到它们各自正确的类后，我们必须使用以下命令将它们移动到正确的目录:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="ebd5" class="nx lw it nt b gy ny nz l oa ob">for idx,cat in cleaner.change():<br/>    shutil.move(str(cleaner.fns[idx]), str(path/cat).split('.')[0] +"_fixed.jpg")</span></pre><h1 id="8e01" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">导出定型模型</h1><p id="c5c3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在几轮超参数调整之后，一旦您对您的模型满意了，您就需要保存它，以便我们可以将它部署到服务器上用于生产。</p><p id="f55f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当保存一个模型时，我们拥有对我们有价值的模型架构和训练参数。fastai提供了用扩展名<code class="fe oc od oe nt b">.pkl</code>将模型保存在pickle文件中的<code class="fe oc od oe nt b">export()</code>方法。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="1635" class="nx lw it nt b gy ny nz l oa ob">model.export()<br/>path = Path()<br/>path.ls(file_exts='.pkl')</span></pre><p id="d839" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以加载模型，并通过向加载的模型传递图像来进行推断:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="0eb0" class="nx lw it nt b gy ny nz l oa ob">model_inf = load_learner(path/'export.pkl')</span></pre><p id="d91d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个加载的模型进行推理:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="7419" class="nx lw it nt b gy ny nz l oa ob">model_inf.predict('dogs/labrador/00000000.jpg')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/5f4c32ecf77bd713e8b3c02f72f414b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*GnqOVarumPTzW8tYU6Tyfw.png"/></div></figure><p id="8212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从模型数据加载器词汇表中检查标签:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="539c" class="nx lw it nt b gy ny nz l oa ob">model_inf.dls.vocab</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/bae38ab1ec1da30c99eac35ec450128d.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*yZKUjerv_4vV4bbhOq5o7A.png"/></div></figure><h1 id="06b2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用你的Jupyter笔记本构建一个应用程序</h1><p id="0958" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">下一步是创建一个我们可以与朋友、同事、招聘人员等分享的应用程序。要创建一个应用程序，我们需要添加交互式元素，以便我们可以尝试和测试应用程序的功能，我们需要将它作为一个网页在web上提供，包括通过一些框架(如flask)或简单地使用Voila来部署它。</p><p id="4738" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以简单地使用Voila将这个Jupyter笔记本转换成一个独立的应用程序。我在这里没有涉及到它，但是你可以通过我的博客/视频完整地了解它。</p><div class="pi pj gp gr pk pl"><a rel="noopener follow" target="_blank" href="/building-covid-19-analysis-dashboard-using-python-and-voila-ee091f65dcbb"><div class="pm ab fo"><div class="pn ab po cl cj pp"><h2 class="bd iu gy z fp pq fr fs pr fu fw is bi translated">使用Python和Voila构建新冠肺炎分析仪表板</h2><div class="ps l"><h3 class="bd b gy z fp pq fr fs pr fu fw dk translated">用你的jupyter笔记本创建一个具有交互式可视化和灵活性的仪表板。</h3></div><div class="pt l"><p class="bd b dl z fp pq fr fs pr fu fw dk translated">towardsdatascience.com</p></div></div><div class="pu l"><div class="pv l pw px py pu pz ks pl"/></div></div></a></div><h2 id="c92e" class="nx lw it bd lx oj ok dn mb ol om dp mf li on oo mh lm op oq mj lq or os ml ot bi translated">部署</h2><p id="7351" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我已经在我的文章中介绍了ML模型的部署:</p><div class="pi pj gp gr pk pl"><a rel="noopener follow" target="_blank" href="/deploying-a-trained-ml-model-using-flask-541520b3cbe9"><div class="pm ab fo"><div class="pn ab po cl cj pp"><h2 class="bd iu gy z fp pq fr fs pr fu fw is bi translated">使用Flask部署已训练的ML模型</h2><div class="ps l"><h3 class="bd b gy z fp pq fr fs pr fu fw dk translated">端到端ML项目教程系列的第2部分</h3></div><div class="pt l"><p class="bd b dl z fp pq fr fs pr fu fw dk translated">towardsdatascience.com</p></div></div><div class="pu l"><div class="qa l pw px py pu pz ks pl"/></div></div></a></div><p id="ba2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是如果你想要另一种简单自由的方式来部署你的Voila应用程序，你可以使用<a class="ae ky" href="https://mybinder.org/" rel="noopener ugc nofollow" target="_blank"> Binder </a>。按照以下步骤在Binder上部署应用程序:</p><ol class=""><li id="bbef" class="ms mt it lb b lc ld lf lg li ov lm ow lq ox lu mx my mz na bi translated">将你的笔记本添加到一个<a class="ae ky" href="http://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</li><li id="39cb" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">将该回购的URL插入活页夹的URL字段。</li><li id="f802" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">将文件下拉列表改为选择URL。</li><li id="5be3" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">在“要打开的URL”字段中，输入<code class="fe oc od oe nt b">/voila/render/&lt;<em class="oz">name&gt;</em>.ipynb</code></li><li id="b68e" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">单击右下角的剪贴板按钮复制URL并粘贴到安全的地方。</li><li id="b5a9" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">单击启动。</li></ol><p id="5ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就对了，你的狗分类器是活的！</p><p id="44a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢看我执行所有这些步骤，这里有这个博客的视频版本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qb qc l"/></div></figure><h1 id="706b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><a class="ae ky" href="https://www.youtube.com/c/DataSciencewithHarshit?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank">数据科学与Harshit </a></h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="qb qc l"/></div></figure><p id="25a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这个渠道，我计划推出几个覆盖整个数据科学领域的<a class="ae ky" rel="noopener" target="_blank" href="/hitchhikers-guide-to-learning-data-science-2cc3d963b1a2?source=---------8------------------">系列</a>。以下是你应该订阅<a class="ae ky" href="https://www.youtube.com/channel/UCH-xwLTKQaABNs2QmGxK2bQ" rel="noopener ugc nofollow" target="_blank">频道</a>的原因:</p><ul class=""><li id="7094" class="ms mt it lb b lc ld lf lg li ov lm ow lq ox lu oy my mz na bi translated">这些系列将涵盖每个主题和子主题的所有必需/要求的高质量教程，如<a class="ae ky" rel="noopener" target="_blank" href="/python-fundamentals-for-data-science-6c7f9901e1c8?source=---------5------------------">数据科学的Python基础</a>。</li><li id="937f" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated">解释了为什么我们在ML和深度学习中这样做的数学和推导。</li><li id="c0ae" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=a2pkZCleJwM&amp;t=2s" rel="noopener ugc nofollow" target="_blank">与谷歌、微软、亚马逊等公司的数据科学家和工程师以及大数据驱动型公司的首席执行官的播客</a>。</li><li id="c5e8" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu oy my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/building-covid-19-analysis-dashboard-using-python-and-voila-ee091f65dcbb?source=---------2------------------">项目和说明</a>实施到目前为止所学的主题。了解新的认证、训练营以及破解这些认证的资源，如谷歌的<a class="ae ky" href="https://youtu.be/yapSsspJzAw" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> TensorFlow开发者证书考试。</strong> </a></li></ul><p id="5d71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随时在<a class="ae ky" href="https://twitter.com/tyagi_harshit24" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae ky" href="https://www.linkedin.com/in/tyagiharshit/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系。</p></div></div>    
</body>
</html>