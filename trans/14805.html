<html>
<head>
<title>Simple Deployment of a Graph Database: JanusGraph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图形数据库的简单部署:JanusGraph</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simple-deployment-of-a-graph-database-janusgraph-5c8c751d30bf?source=collection_archive---------37-----------------------#2020-10-12">https://towardsdatascience.com/simple-deployment-of-a-graph-database-janusgraph-5c8c751d30bf?source=collection_archive---------37-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/39f1a54bea1e74bb039aafa3fec06ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0UAe2OT0xvNzYe58"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">参考:<a class="ae kf" href="https://unsplash.com/photos/ZiQkhI7417A" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/ZiQkhI7417A</a></p></figure><p id="c313" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我最近一直在寻找一个开源的分布式图形数据库，因为我需要在某个地方持久地存储大量的图形数据。我的主要要求是，我想尽可能多地控制上述数据库背后的底层存储和索引系统。</p><p id="12c9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我偶然发现了<a class="ae kf" href="https://janusgraph.org/" rel="noopener ugc nofollow" target="_blank"> JanusGraph </a>，这是Linux基金会下的一个图形数据库项目，它建立在<a class="ae kf" href="https://tinkerpop.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache TinkerPop </a>之上，包括<a class="ae kf" href="https://en.wikipedia.org/wiki/Gremlin_(query_language)" rel="noopener ugc nofollow" target="_blank"> Gremlin查询语言</a>。Tinkerpop还支持其他许多图形数据库，如neo4j、Amazon Neptune、DataStax、Azure Cosmos DB等。我选择JanusGraph是因为它的即插即用方法，例如，我可以替换后端存储(如Cassandra、HBase、BerkeleyDB、ScyllaDB或Google Cloud Bigtable)和索引软件(如Elasticsearch、Solr或Lucene)。我还没有评估所有现有的图形数据库，所以我不能说太多关于JanusGraph与其他解决方案相比如何。我的意图是首先了解底层技术是如何工作的，然后我才会冒险尝试其他数据库。</p><p id="f379" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽管如此，由于它的可定制性，探索JanusGraph在开始时可能会感到有点令人生畏，至少对于像我这样的第一次尝试者来说是这样。这也是我写这篇文章的原因。我想尽可能简洁地总结我的学习之旅，并指导您完成在远程服务器中部署JanusGraph、执行查询和可视化数据集所需的步骤。</p><h1 id="6f48" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">服务器端设置</h1><p id="3c7b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在服务器中部署JanusGraph包括以下步骤。</p><p id="3a7e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">设置一个服务器</strong>。在我的情况下，我选择了一个云提供商的廉价虚拟机(25 GB SSD + 1024 MB RAM，Ubuntu 18.04)。因为JanusGraph默认运行在端口8182上，所以我将这个端口开放给公众访问。为了简单起见(不是最安全的方式)，我简单地通过iptables来实现。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="32a8" class="mq lf it mm b gy mr ms l mt mu">iptables -A INPUT -p tcp -m tcp — dport 8182 -j ACCEPT</span></pre><p id="e0c9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">记下您服务器的IP地址</strong>为$ {服务器IP地址}。您可以通过运行以下命令来做到这一点。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="4c64" class="mq lf it mm b gy mr ms l mt mu">ifconfig</span></pre><p id="35de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">拉下并运行骏图docker。骏利已经提供了其系统的文档化实现。默认的是BerkeleyDB作为存储，Lucene作为索引。下面的代码将从docker存储库中提取最新的janusgraph图像。</strong></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="201b" class="mq lf it mm b gy mr ms l mt mu">docker run -it -p 8182:8182 janusgraph/janusgraph</span></pre><p id="1c64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">将图形数据集复制到docker。</strong> JanusGraph支持几种数据格式，其中一种叫做graphml。在引擎盖下，这些基本上都是邻接矩阵或列表。在我们的实验中，我们将使用kelvinlawrence.net的《T2》教程中的机场航线数据集。<em class="mv"> air-routes.graphml </em>数据集可以从<a class="ae kf" href="https://github.com/krlawrence/graph/blob/master/sample-data/air-routes.graphml" rel="noopener ugc nofollow" target="_blank">这里</a>下载。我们需要将graphml数据复制到janusgraph容器(<em class="mv"> /opt/janusgraph/data/ </em>)，以便稍后可以通过客户端发出的命令将它加载到janusgraph。您可以通过运行<em class="mv"> docker ps </em>来获取<em class="mv">$ { Janus graph _ DOCKER _ ID }</em>。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="883f" class="mq lf it mm b gy mr ms l mt mu">docker cp ${YOUR_CUSTOM_LOCATION}/air-routes.graphml ${JANUSGRAPH_DOCKER_ID}:/opt/janusgraph/data/.</span></pre><h1 id="1e8f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">客户端设置</h1><p id="0a33" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们将使用三种方法连接服务器:gremlin控制台、gremlin python和graphexp。</p><h2 id="c1c6" class="mq lf it bd lg mw mx dn lk my mz dp lo kr na nb ls kv nc nd lw kz ne nf ma ng bi translated">Gremlin控制台</h2><p id="2b83" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们将使用来自Tinkerpop的janusgraph分叉版本的专用gremlin控制台将数据集加载到janusgraph。</p><p id="763f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">下载并解压最新发布的骏图。</strong>你可以从<a class="ae kf" href="https://github.com/JanusGraph/janusgraph/releases" rel="noopener ugc nofollow" target="_blank">这里</a>得到文件。</p><p id="5ed7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">为gremlin远程连接设置创建一个remote.yaml文件</strong>。我们将这个文件称为<em class="mv">$ { REMOTE _ YAML _ LOC }/REMOTE . YAML</em></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="8fc2" class="mq lf it mm b gy mr ms l mt mu">hosts: [${SERVER_IP_ADDRESS}]<br/>port: 8182<br/>serializer: { className: org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV3d0, config: { serializeResultToString: true }}</span></pre><p id="c45c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">运行小妖精控制台。我们将在控制台中做一些事情。</strong></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="8fc1" class="mq lf it mm b gy mr ms l mt mu">${janusgraph_latest_release}/bin/gremlin.sh</span></pre><p id="b7ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们将连接到远程janusgraph服务器。这是因为数据存在于服务器中，而这个客户端gremlin控制台将仅用于将任何查询转发给前者。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="db0c" class="mq lf it mm b gy mr ms l mt mu">:remote connect tinkerpop.server <em class="mv">${REMOTE_YAML_LOC}/remote.yaml </em>session</span><span id="3a52" class="mq lf it mm b gy nh ms l mt mu">:remote console</span></pre><p id="c66a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">接下来，我们将把air-routes.graphml数据加载到janusgraph中。我们将使用janusgraph的一个名为graph.io的API。</strong></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="98af" class="mq lf it mm b gy mr ms l mt mu">graph.io(graphml()).readGraph(‘/opt/janusgraph/data/air-routes.graphml’)</span></pre><h2 id="9fa7" class="mq lf it bd lg mw mx dn lk my mz dp lo kr na nb ls kv nc nd lw kz ne nf ma ng bi translated">小精灵蟒蛇</h2><p id="dd2f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们现在想使用python查询图表。这个想法是，我们可以获得一些子图，并在本地客户端内存中使用现有的python库(如networkx)进一步分析它们。如果您想要处理整个原始图形(例如，运行PageRank)，将整个图形加载到您的本地客户端内存可能并不明智。选择TinkerPop的GraphComputer API，您可以通过VertexProgram运行OLAP算法。更多详情见<a class="ae kf" href="http://tinkerpop.apache.org/docs/current/reference/#graphcomputer" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="23ed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">用pip安装gremlin-python。</strong></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="ffb1" class="mq lf it mm b gy mr ms l mt mu">pip install gremlinpython</span></pre><p id="266d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">与远程服务器的janusgraph </strong>建立连接。加载图形遍历对象为<em class="mv"> g </em>。在python控制台中完成这项工作。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="0e18" class="mq lf it mm b gy mr ms l mt mu">from gremlin_python.process.anonymous_traversal import traversal</span><span id="d365" class="mq lf it mm b gy nh ms l mt mu">from gremlin_python.driver.driver_remote_connection import DriverRemoteConnection</span><span id="1ba3" class="mq lf it mm b gy nh ms l mt mu">g = traversal().withRemote(<br/>DriverRemoteConnection(‘ws://${SERVER_IP_ADDRESS}:8182/gremlin’,’g’))</span></pre><p id="3f3c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">运行查询。</strong>例如，如果我们想要获得机场列表，我们可以运行以下gremlin查询。要获得更多关于可以执行哪些查询的指导，请参考<a class="ae kf" href="https://tinkerpop.apache.org/gremlin.html" rel="noopener ugc nofollow" target="_blank"> Gremlin API </a>。这是因为JanusGraph是建立在Gremlin之上的，因此你也可以参考后者的文档来获得更多信息。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="db34" class="mq lf it mm b gy mr ms l mt mu">g.V().hasLabel(‘airport’).valueMap().toList()</span></pre><h2 id="0628" class="mq lf it bd lg mw mx dn lk my mz dp lo kr na nb ls kv nc nd lw kz ne nf ma ng bi translated">Graphexp</h2><p id="a7cc" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">有一些第三方库是为与JanusGraph接口而构建的。我发现<a class="ae kf" href="https://github.com/bricaud/graphexp" rel="noopener ugc nofollow" target="_blank"> graphexp </a>是最容易使用的软件之一。可以从<a class="ae kf" href="https://github.com/bricaud/graphexp" rel="noopener ugc nofollow" target="_blank">这个github repo </a>下载。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="b916" class="mq lf it mm b gy mr ms l mt mu">git clone <a class="ae kf" href="https://github.com/bricaud/graphexp" rel="noopener ugc nofollow" target="_blank">https://github.com/bricaud/graphexp</a></span></pre><p id="af80" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">运行graphexp。只需从浏览器中打开graphexp.html。</strong></p><p id="456e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输入您的远程服务器地址和端口，执行查询</strong>。在这个例子中，我正在查询新加坡樟宜机场的ego网络。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/a1235e902a332ff8b90a0895746463ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRwsejcLB80Jv2Lue8dpUg.png"/></div></div></figure><p id="2534" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">瞧啊。现在，您在远程服务器上有了一个正在运行的图形数据库，您可以从任何客户端计算机上进行查询。</p><p id="5e7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">参考文献</strong></p><ol class=""><li id="ad7b" class="nj nk it ki b kj kk kn ko kr nl kv nm kz nn ld no np nq nr bi translated"><a class="ae kf" href="https://kelvinlawrence.net/book/Gremlin-Graph-Guide.html" rel="noopener ugc nofollow" target="_blank">https://kelvinlawrence.net/book/Gremlin-Graph-Guide.html</a></li><li id="5645" class="nj nk it ki b kj ns kn nt kr nu kv nv kz nw ld no np nq nr bi translated"><a class="ae kf" href="https://docs.janusgraph.org/" rel="noopener ugc nofollow" target="_blank">https://docs.janusgraph.org/</a></li></ol><h1 id="3b02" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">附加说明</strong></h1><p id="e322" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在某些情况下，您可能希望在数据库中存储多个独立的图形。为此，您必须在部署之前修改您的janusgraph yaml配置文件。步骤几乎与gremlin server的设置相似(因为JanusGraph是建立在gremlin server之上的)。粗略地说，您需要做一些事情(这个例子是为gremlin服务器中的TinkerGraph做的)。</p><p id="6a9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">首先，</strong>编辑gremlin-server yaml文件。在这种情况下，我想要创建两个图形，因此我在yaml文件的<em class="mv"> graphs </em>设置中添加了<em class="mv"> graphA和graphB </em>。每个图形都在conf/下的属性文件中定义。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="3872" class="mq lf it mm b gy mr ms l mt mu">graphs: {<br/>  graphA: conf/tinkergraph-empty.properties,<br/>  graphB: conf/tinkergraph-empty.properties<br/>}</span></pre><p id="6511" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">其次，</strong>更新初始groovy脚本。我们基本上想同时加载<em class="mv"> graphA </em>和<em class="mv"> graphB </em>。我们还想为它们创建遍历对象。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="55fa" class="mq lf it mm b gy mr ms l mt mu">...<br/>org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerFactory.generateModern(graphA)<br/>org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerFactory.generateModern(graphB)</span><span id="5818" class="mq lf it mm b gy nh ms l mt mu">...</span><span id="5459" class="mq lf it mm b gy nh ms l mt mu">globals &lt;&lt; [<br/>  gA : graphA.traversal().<br/>withStrategies(ReferenceElementStrategy.instance()),</span><span id="4ca4" class="mq lf it mm b gy nh ms l mt mu">  gB : graphB.traversal().<br/>withStrategies(ReferenceElementStrategy.instance())<br/>]</span><span id="8e7a" class="mq lf it mm b gy nh ms l mt mu">...</span></pre><p id="16ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JanusGraph的另一个有用特性是模式管理(就像任何典型的数据库一样)。然而，这超出了本文的范围。有关如何使用JanusGraph的openManagement API管理图表的更多信息，请查看这个全面的<a class="ae kf" href="https://medium.com/enharmonic/evolving-data-models-with-janusgraph-d0ecf6d3fda3" rel="noopener">教程</a>。</p></div></div>    
</body>
</html>