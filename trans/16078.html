<html>
<head>
<title>Database Machine Learning — Made Simple</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库机器学习—变得简单</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/in-database-machine-learning-made-simple-6b3284fa77ed?source=collection_archive---------18-----------------------#2020-11-05">https://towardsdatascience.com/in-database-machine-learning-made-simple-6b3284fa77ed?source=collection_archive---------18-----------------------#2020-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7ada" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">包含代码的端到端指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a0f4eba1dd6cf75b06b2de3c9f933cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugScQJZVV76s5Glzh3gB0w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://stock.adobe.com/contributor/206257799/pickup?load_type=author&amp;prev_url=detail" rel="noopener ugc nofollow" target="_blank">皮卡</a>在<a class="ae kv" href="https://stock.adobe.com/" rel="noopener ugc nofollow" target="_blank">土坯库存</a>上根据许可从Zer0到5ive拍摄</p></figure><p id="90ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">*免责声明:我是拼接机</em>的机器学习负责人</p><p id="90d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你点击了这篇文章，我不需要说服你，机器学习是一个改变游戏规则的工具。构建ML模型现在是可访问的、容易的、初学者友好的(大部分时间)。然而，部署这些模型是另一回事。简单性、可伸缩性和推理速度只是您必须克服的一些障碍。</p><p id="f788" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建ML模型的最大问题之一是，模型是在对部署无用的环境中构建的。也许你已经用Python启动了单实例Jupyter笔记本。您可以集成Spark进行大数据处理，这很好，但由此产生的推理速度非常慢。也许您已经用Flask创建了一个将您的单个模型投入生产的管道，这是可行的，但是它缺少可再现性(和潜在的可伸缩性)。也许Python对于您的实时用例来说太慢了。</p><p id="704b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根本的问题是，机器学习部署是一个年轻和不成熟的领域，它还没有开发出数据库或软件开发所拥有的工具包。例如，数据库广泛可用，稳定，(有时)可扩展，速度极快。正因为如此，我们将借鉴数据库工程师已经完成的工作，并利用他们的工具为我们服务。这里，我们将重点关注使用横向扩展RDBMS进行模型部署。</p><p id="3ed5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将带您使用熟悉的工具构建一个机器学习模型，并将其部署到数据库中。为了获得完整的体验，你可以在这里创建一个免费的沙盒环境<a class="ae kv" href="https://cloud.splicemachine.io/register?redirect=%2F_%2Fdashboard%2Factivity" rel="noopener ugc nofollow" target="_blank">，和我一起浏览这些例子。</a></p><p id="181a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">TL；</strong>博士笔记本位于<a class="ae kv" href="https://github.com/Ben-Epstein/Medium-Aritcles/tree/master/in_db_ml" rel="noopener ugc nofollow" target="_blank">这里</a>，有输出的笔记本的要点是<a class="ae kv" href="https://nbviewer.jupyter.org/gist/Ben-Epstein/66a7a15c86d8d83fd8f64f2b75a283e7" rel="noopener ugc nofollow" target="_blank">这里</a>。要直接跳到本文的模型部署部分，请单击这里的<a class="ae kv" href="#1b95" rel="noopener ugc nofollow">按钮</a></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="0658" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">获取环境</h1><p id="fbe9" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">首先，在这里创建一个免费的沙盒环境<a class="ae kv" href="https://cloud.splicemachine.io/register?redirect=%2F_%2Fdashboard%2Factivity" rel="noopener ugc nofollow" target="_blank">。准备好数据库后，单击数据库名称进入仪表板。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e156696e316b05e4bf5ddcc91416e0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/0*uC9f6uKncp0XCAwT"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据库名称</p></figure><p id="1a4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在那里，您可以单击“检索数据库密码”来获得您的登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/bcc2756d328f8348a6a667a56cecedbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/0*70P8p5F6-5p2XxTl"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">获取数据库用户名和口令</p></figure><p id="5b9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你有了，点击“笔记本”来启动你的Jupyter笔记本实例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/718d3d3814b9bfaf85cd359b24fe0a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PoUFJ0moLkSL3bTt"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">启动您的Jupyter笔记本</p></figure><p id="dc1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被提示输入您的用户名和密码，这是您刚刚在仪表板上看到的。这需要一分钟左右的时间。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="297f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经进入了笔记本环境，您将创建一个新的笔记本，选择Python 3作为您的内核。使用的整个笔记本将在<a class="ae kv" href="https://github.com/Ben-Epstein/Medium-Aritcles/tree/master/in_db_ml" rel="noopener ugc nofollow" target="_blank">这里</a>可用</p><p id="6987" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将构建一个Spark模型来预测<a class="ae kv" href="https://scikit-learn.org/stable/auto_examples/datasets/plot_iris_dataset.html" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>，以保持演示简短，但这可以扩展到任何数据集(任何大小)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6d64536aa41eebdcd772f9a4ef0ce3d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/0*kxXXglSbl1wD-rGf"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择你的环境</p></figure><p id="da42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您将创建您的Spark会话。配置设置是在幕后为您处理的，所以只需运行下面几行就可以开始了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建Spark会话</p></figure><p id="899e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在任何时候，您都可以通过运行以下代码来检查您的Spark控制台</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">获取Spark UI</p></figure><p id="a5ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将返回一个交互式窗口，您可以在其中观察您的Spark作业，并在它们运行时深入研究它们。</p><p id="29fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然已经有了Spark会话，就可以获得MLFlow会话和本机数据库连接了。你可以在这里了解更多关于MLflow <a class="ae kv" href="https://www.mlflow.org/docs/1.8.0/tracking.html" rel="noopener ugc nofollow" target="_blank">的信息，在这里</a>了解更多关于原生Spark数据源<a class="ae kv" href="https://pysplice.readthedocs.io/en/latest/splicemachine.spark.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MLFlow和NSDS的设置</p></figure><p id="96e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些行将自动配置您的MLflow会话并将其连接到数据库。</p><p id="fe7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您将开始您的MLflow实验，并运行以表明您即将构建您的第一个模型。就像使用Spark一样，您可以使用类似的命令查看MLflow UI。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MLFlow开始实验并运行</p></figure><h1 id="ab36" class="ma mb iq bd mc md nd mf mg mh ne mj mk jw nf jx mm jz ng ka mo kc nh kd mq mr bi translated">建立模型</h1><p id="9033" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">现在您已经连接了，您将加载数据并构建您的第一个模型。这一部分将会更短，因为它侧重于部署，但是您可以通过单击“拼接笔记本”文件夹，然后单击“7”来访问您的试用集群的Jupyter笔记本中更长、更深入的示例。MLManager "</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/d1839111466461d3b3dccda986a0f1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8iWi9DP3jp4w7VyQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">访问拼接笔记本文件夹</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/5a44b0bf7e4aaf00264f5e471df585a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lVWqL3_4tgd15Xna"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">访问更多MLManager示例</p></figure><p id="44f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您将加载iris数据集，并将其转换为用于训练的Spark数据帧。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f060" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将在这里为分类构建一个简单的决策树模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">建立火花模型</p></figure><p id="29a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你愿意，你可以在MLflow中记录一些信息来跟踪你做了什么。至关重要的是，您将把您的模型记录到MLflow中，以便您可以部署它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将参数、度量和模型记录到MLFlow</p></figure><h1 id="bafd" class="ma mb iq bd mc md nd mf mg mh ne mj mk jw nf jx mm jz ng ka mo kc nh kd mq mr bi translated">部署您的模型</h1><p id="1b95" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">就是这样！您已经创建了一个简单的Spark模型。现在是时候将它部署到数据库中，并利用SQL与它进行交互。您将使用deploy_db函数来实现这一点。这个函数有许多可选参数，您可以在这里深入研究<a class="ae kv" href="https://pysplice.readthedocs.io/en/latest/splicemachine.mlflow_support.html#splicemachine.mlflow_support.mlflow_support._deploy_db" rel="noopener ugc nofollow" target="_blank">，但是现在，简单地说:</a></p><ul class=""><li id="0992" class="nk nl iq ky b kz la lc ld lf nm lj nn ln no lr np nq nr ns bi translated">方案名:要部署到的表的方案</li><li id="3adb" class="nk nl iq ky b kz nt lc nu lf nv lj nw ln nx lr np nq nr ns bi translated">表名:要部署到的表</li><li id="2e18" class="nk nl iq ky b kz nt lc nu lf nv lj nw ln nx lr np nq nr ns bi translated">运行ID:存储模型的运行ID</li><li id="675f" class="nk nl iq ky b kz nt lc nu lf nv lj nw ln nx lr np nq nr ns bi translated">创建模型表:是否为我们创建表</li><li id="4829" class="nk nl iq ky b kz nt lc nu lf nv lj nw ln nx lr np nq nr ns bi translated">Df:作为表格基础的数据帧</li><li id="f1e0" class="nk nl iq ky b kz nt lc nu lf nv lj nw ln nx lr np nq nr ns bi translated">主键:表的唯一标识符列</li><li id="ccf2" class="nk nl iq ky b kz nt lc nu lf nv lj nw ln nx lr np nq nr ns bi translated">类别:类别标签名称(鸢尾属、弗吉尼亚属、刚毛属)</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">部署ML模型</p></figure><p id="4700" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这么简单。幕后发生的事情是，作业被提交给代表您处理请求的服务器。最后一行调用watch_job获取从服务器自动传入的日志，这样您就可以实时看到发生了什么，并在出现问题时进行调试。</p><p id="d246" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经部署了您的模型，您将进行一些预测。通过用%%sql启动单元格，您可以在笔记本中运行SQL。这是一个定制的<a class="ae kv" href="https://www.tutorialspoint.com/jupyter/ipython_magic_commands.htm" rel="noopener ugc nofollow" target="_blank">魔术</a>，允许你直接对你正在工作的拼接机器数据库运行SQL。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用SQL调用模型</p></figure><p id="288e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，你可以停止你的火花会议，结束你的跑步。这不会影响SQL，并且您可以通过插入新行来继续与部署的模型进行交互。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">结束我们的会话</p></figure><h1 id="aca0" class="ma mb iq bd mc md nd mf mg mh ne mj mk jw nf jx mm jz ng ka mo kc nh kd mq mr bi translated">包扎</h1><p id="842f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">就是这样！您已经创建了您的机器学习模型，对其进行了跟踪，并将其部署到数据库中，以提高可扩展性、可用性和速度。这个简单的例子可以扩展到Scikit-learn(可以在文件夹“7。MLManager”)或大规模数据集和复杂管道的困难问题。您甚至可以用触发器将模型(表)链接在一起。要查看其他一些示例，请参见<strong class="ky ir"> 7中的<a class="ae kv" href="http://cloud.splicemachine.io" rel="noopener ugc nofollow" target="_blank">笔记本实例</a>附带的<strong class="ky ir"> splice_notebooks </strong>文件夹。MLManager </strong>文件夹。</p><p id="391a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您坚持使用我的例子！如果你有任何问题，请在文章中发表，我一定会回复。</p></div></div>    
</body>
</html>