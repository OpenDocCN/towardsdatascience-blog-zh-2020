<html>
<head>
<title>A Step-By-Step Guide To Web Scraping With R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一步一步的使用R进行网页抓取的指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-scraping-with-r-easier-than-python-c06024f6bf52?source=collection_archive---------23-----------------------#2020-10-19">https://towardsdatascience.com/web-scraping-with-r-easier-than-python-c06024f6bf52?source=collection_archive---------23-----------------------#2020-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们用R开发一个实时web抓取应用程序——比用Python简单多了</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d279852ea92ac08adfca2cb931f52e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdnuraT1b_4penpCxb5xtg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.freepik.com/vectors/technology" rel="noopener ugc nofollow" target="_blank">rawpixel.com<a class="ae ky" href="http://www.freepik.com" rel="noopener ugc nofollow" target="_blank">创建的技术向量</a></a></p></figure><p id="adfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的数据集很难找到。这是意料之中的，但没什么好担心的。像网络抓取这样的技术使我们能够随时随地获取数据——如果你知道怎么做的话。今天我们将探索用<em class="lv"> R </em>抓取网络数据有多简单，并通过R Shiny漂亮的GUI界面来实现。</p><p id="b128" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">那么，什么是网页抓取呢？</em>简单来说，就是从各种网站收集数据的技术。在以下情况下可以使用它:</p><ul class=""><li id="984a" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">没有可用于所需分析的数据集</li><li id="b368" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">没有可用的公共API</li></ul><p id="632f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，你还是应该经常查看网站关于网络抓取的政策，以及这篇关于<a class="ae ky" rel="noopener" target="_blank" href="/ethics-in-web-scraping-b96b18136f01">网络抓取伦理</a>的文章。在这之后，你应该能够用常识来决定刮擦是否值得。</p><p id="0913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如果感觉不对，就不要做。</strong></p><p id="6169" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，有些网站完全是为了练习抓取网页而制作的。其中之一是<a class="ae ky" href="http://books.toscrape.com/" rel="noopener ugc nofollow" target="_blank">books.toscrape.com</a>，顾名思义，它列出了各种流派的书籍:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/f447c5e0b244a696f764fa768013380a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xfjBnFX_NgKFSzUZ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图来自<a class="ae ky" href="http://books.toscrape.com" rel="noopener ugc nofollow" target="_blank">http://books.toscrape.com</a></p></figure><p id="3a7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们接下来刮那个混蛋，好吗？</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="1555" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">行动（或活动、袭击）计划</h1><p id="5c14" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">打开网页，点击任意两个类别(左侧边栏)，检查网址。以下是我们的选择:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="3f24" class="nu mt it nq b gy nv nw l nx ny">http://books.toscrape.com/catalogue/category/books/<strong class="nq iu">travel_2</strong>/index.html<br/>http://books.toscrape.com/catalogue/category/books/<strong class="nq iu">mystery_3</strong>/index.html</span></pre><p id="d666" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">这些网址有什么共同点？嗯，除了加粗的部分。那就是品类本身。不知道编号是怎么回事，但事实就是如此。每一页都包含一个书单，一本书看起来像这样:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/d9a22e2ab25b6aa5396a739280cb4afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/0*ojeFMgAU_N-BBdcP.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="http://books.toscrape.com/catalogue/category/books/mystery_3/index.html" rel="noopener ugc nofollow" target="_blank">推理类</a>单本书截图</p></figure><p id="58b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的工作是获取一个类别中每本书的信息。这样做需要一点HTML知识，但它是一种简单的标记语言，所以我不认为这有什么问题。</p><p id="0e37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想刮:</p><ul class=""><li id="30eb" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">标题— <strong class="lb iu"> h3 &gt; a &gt;标题</strong>房产</li><li id="e9ec" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">等级— <strong class="lb iu">星级&gt;等级</strong>属性</li><li id="628b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">价格— <strong class="lb iu">部门产品价格&gt;部门价格颜色&gt;文本</strong></li><li id="434b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">可用性— <strong class="lb iu">部门产品价格&gt;部门库存&gt;文本</strong></li><li id="4358" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">图书URL—<strong class="lb iu">div . image _ container&gt;a&gt;href</strong>属性</li><li id="f996" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">缩略图URL—<strong class="lb iu">div . image _ container&gt;img&gt;src</strong>属性</li></ul><p id="4c98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你现在什么都知道了，所以接下来让我们从刮痧开始。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="3584" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">刮书</h1><p id="0b21" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在R中使用<code class="fe oa ob oc nq b">rvest</code>包来执行web抓取任务。由于管道操作员的使用和一般行为，它与著名的数据分析包<code class="fe oa ob oc nq b">dplyr</code>非常相似。我们知道如何到达某些元素，但是如何在R中实现这个逻辑呢？</p><p id="0738" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个如何在旅游类别中搜集书名的例子:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="d9f3" class="nu mt it nq b gy nv nw l nx ny">library(rvest)<br/><br/>url &lt;- 'http://books.toscrape.com/catalogue/category/books/travel_2/index.html'<br/>titles &lt;- read_html(url) %&gt;% <br/>  html_nodes('h3') %&gt;%<br/>  html_nodes('a') %&gt;% <br/>  html_text()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d58687013175ee4660f8a5600c242351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ROeiKnu2pNbHHnM-.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4af4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那不是很容易吗？类似地，我们可以刮去其他所有东西。剧本是这样的:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="2513" class="nu mt it nq b gy nv nw l nx ny">library(rvest)<br/>library(stringr)<br/><br/>titles &lt;- read_html(url) %&gt;% <br/>  html_nodes('h3') %&gt;%<br/>  html_nodes('a') %&gt;% <br/>  html_text()<br/><br/>urls &lt;- read_html(url) %&gt;%<br/>  html_nodes('.image_container') %&gt;% <br/>  html_nodes('a') %&gt;% <br/>  html_attr('href') %&gt;% <br/>  str_replace_all('../../../', '/')<br/><br/>imgs &lt;- read_html(url) %&gt;% <br/>  html_nodes('.image_container') %&gt;%<br/>  html_nodes('img') %&gt;%<br/>  html_attr('src') %&gt;%<br/>  str_replace_all('../../../../', '/')<br/><br/>ratings &lt;- read_html(url) %&gt;% <br/>  html_nodes('p.star-rating') %&gt;% <br/>  html_attr('class') %&gt;% <br/>  str_replace_all('star-rating ', '')<br/><br/>prices &lt;- read_html(url) %&gt;% <br/>  html_nodes('.product_price') %&gt;% <br/>  html_nodes('.price_color') %&gt;% <br/>  html_text()<br/><br/>availability &lt;- read_html(url) %&gt;% <br/>  html_nodes('.product_price') %&gt;% <br/>  html_nodes('.instock') %&gt;% <br/>  html_text() %&gt;% <br/>  str_trim()</span></pre><p id="8f42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">厉害！最后一步，让我们将所有这些粘合在一个单独的<strong class="lb iu">数据帧</strong>中:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="0839" class="nu mt it nq b gy nv nw l nx ny">scraped &lt;- data.frame(<br/>  Title = titles, <br/>  URL = urls, <br/>  SourceImage = imgs, <br/>  Rating = ratings, <br/>  Price = prices, <br/>  Availability = availability<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/4abdf72dd11bf2bf997722fe221e8eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A8JSI9B-ePEBXeho.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="33a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里结束这篇文章，今天就到此为止，但是我们还可以在此基础上构建一些东西——一个简单易用的web应用程序。让我们接下来做那件事。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="a08c" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">用于抓取的Web应用程序</h1><p id="de2d" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">r有一个非常棒的web/dashboard开发库— <code class="fe oa ob oc nq b">Shiny</code>。它比Python中任何类似的东西都容易使用，所以我们将坚持使用它。首先，创建一个新的R文件，并将以下代码粘贴到其中:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="cc61" class="nu mt it nq b gy nv nw l nx ny">library(shiny)<br/>library(rvest)<br/>library(stringr)<br/>library(glue)<br/><br/>ui &lt;- fluidPage()<br/><br/>server &lt;- function(input, output) {}<br/><br/>shinyApp(ui=ui, server=server)</span></pre><p id="cc6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是每个闪亮的应用程序都需要的样板。接下来，让我们来设计UI的样式。我们需要:</p><ul class=""><li id="f88c" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">标题——只是在所有内容之上的一个大而粗的文本(可选)</li><li id="6fbc" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">侧栏—包含一个下拉菜单，用于选择图书流派</li><li id="c428" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">中央区域—一旦数据被擦除，显示表格输出</li></ul><p id="14ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码如下:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="f058" class="nu mt it nq b gy nv nw l nx ny">ui &lt;- fluidPage(<br/>  column(12, tags$h2('Real-time web scraper with R')),<br/>  sidebarPanel(<br/>    width=3,<br/>    selectInput(<br/>      inputId='genreSelect',<br/>      label='Genre',<br/>      choices=c('Business', 'Classics', 'Fiction', 'Horror', 'Music'),<br/>      selected='Business',<br/>    )<br/>  ),<br/>  mainPanel(<br/>    width=9,<br/>    tableOutput('table')<br/>  )<br/>)</span></pre><p id="bd5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要配置<strong class="lb iu">服务器</strong>功能。它必须将我们精心格式化的输入重新映射到一个URL部分(例如，“Business”到“business_35”)，并抓取所选流派的数据。我们已经知道如何这样做。下面是服务器函数的代码:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="6609" class="nu mt it nq b gy nv nw l nx ny">server &lt;- function(input, output) {<br/>  output$table &lt;- renderTable({<br/>    mappings &lt;- c('Business' = 'business_35', 'Classics' = 'classics_6', 'Fiction' = 'fiction_10',<br/>                  'Horror' = 'horror_31', 'Music' = 'music_14') <br/>    <br/>    url &lt;- glue('http://books.toscrape.com/catalogue/category/books/', mappings[input$genreSelect], '/index.html')<br/>    <br/>    titles &lt;- read_html(url) %&gt;% <br/>      html_nodes('h3') %&gt;%<br/>      html_nodes('a') %&gt;% <br/>      html_text()<br/>    <br/>    urls &lt;- read_html(url) %&gt;%<br/>      html_nodes('.image_container') %&gt;% <br/>      html_nodes('a') %&gt;% <br/>      html_attr('href') %&gt;% <br/>      str_replace_all('../../../', '/')<br/>    <br/>    imgs &lt;- read_html(url) %&gt;% <br/>      html_nodes('.image_container') %&gt;%<br/>      html_nodes('img') %&gt;%<br/>      html_attr('src') %&gt;%<br/>      str_replace_all('../../../../', '/')<br/>    <br/>    ratings &lt;- read_html(url) %&gt;% <br/>      html_nodes('p.star-rating') %&gt;% <br/>      html_attr('class') %&gt;% <br/>      str_replace_all('star-rating ', '')<br/>    <br/>    prices &lt;- read_html(url) %&gt;% <br/>      html_nodes('.product_price') %&gt;% <br/>      html_nodes('.price_color') %&gt;% <br/>      html_text()<br/>    <br/>    availability &lt;- read_html(url) %&gt;% <br/>      html_nodes('.product_price') %&gt;% <br/>      html_nodes('.instock') %&gt;% <br/>      html_text() %&gt;% <br/>      str_trim()<br/>    <br/>    data.frame(<br/>      Title = titles, <br/>      URL = urls, <br/>      SourceImage = imgs, <br/>      Rating = ratings, <br/>      Price = prices, <br/>      Availability = availability<br/>    )<br/>  })<br/>}</span></pre><p id="f6e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们现在可以运行应用程序并检查行为！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/a8fd82a5f579f39e96c08583229e25aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oBmgOAmOTXEXzRKATxTCMA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者GIF</p></figure><p id="306f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正是我们想要的——简单，但仍然完全可以理解。让我们在下一部分总结一下。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="fc99" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">离别赠言</h1><p id="21a9" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在短短几分钟内，我们从零到一个工作的网页抓取应用程序。扩展它的选项是无穷无尽的——添加更多的类别、处理视觉效果、包含更多的数据、更好地格式化数据、添加过滤器等等。</p><p id="18e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你已经设法跟上，你能够看到网络抓取的力量。这是一个虚拟的网站和一个虚拟的例子，但是方法保持不变，与数据源无关。</p><p id="1a9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p><p id="8015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入我的私人邮件列表，获取更多有用的见解。</strong> </a></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="350b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">喜欢这篇文章吗？成为 <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="og oh gp gr oi oj"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ks oj"/></div></div></a></div></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="fcda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于2020年10月19日</em><a class="ae ky" href="https://betterdatascience.com/r-web-scraping/" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://betterdatascience.com</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>