<html>
<head>
<title>Efficient Euclidean distance computation in pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫中有效的欧几里德距离计算</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/efficient-euclidean-distance-computation-in-pandas-66b472f6b0ba?source=collection_archive---------20-----------------------#2020-09-24">https://towardsdatascience.com/efficient-euclidean-distance-computation-in-pandas-66b472f6b0ba?source=collection_archive---------20-----------------------#2020-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/23d38a1db9bfcfbdaf20b6d6c417ac70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGqCS0SSsiB6GRt9oYphmw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">马库斯·斯皮斯克在<a class="ae jg" href="https://unsplash.com/s/photos/ruler?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><div class=""><h2 id="3f91" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">-一个巧妙的小把戏</h2></div><p id="3c9a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在数据科学中，我们经常会遇到地理问题，比如经典的房价预测问题。在大多数情况下，作为特性工程的一部分，使用<a class="ae jg" href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" rel="noopener ugc nofollow" target="_blank">k-nearest neighborhood</a>(k-NN)或类似策略来计算基于位置的参考价格不会有什么坏处。</p><p id="dca1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">k-NN中最重要的超参数是距离度量，欧几里德距离是地理空间问题的明显选择。也称为“直线”距离或L范数，使用以下公式计算:</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/189922552fd40a74080da5c71e19af45.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*0PvAwd4-Dab3Q1xfydJwIw.png"/></div></figure><p id="bd33" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用k-NN进行特征训练的问题在于，理论上，它是一个<em class="lz"> O </em> (n)运算:每个数据点都需要将每隔一个数据点视为潜在的最近邻。在没有像<a class="ae jg" href="https://en.wikipedia.org/wiki/Spatial_database#Spatial_index" rel="noopener ugc nofollow" target="_blank">空间索引</a>这样的专门技术的情况下，我们可以通过一些矢量化来加快速度。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="3bdc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从一组地理空间数据点开始:</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9738" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们通常不直接从<code class="fe mj mk ml mm b">latitude</code>和<code class="fe mj mk ml mm b">longitude</code>计算欧氏距离。相反，它们被投影到地理上适当的坐标系中，其中<code class="fe mj mk ml mm b">x</code>和<code class="fe mj mk ml mm b">y</code>共享相同的单位。我将在以后的帖子中详细阐述这一点，但请注意</p><blockquote class="mn mo mp"><p id="c233" class="ky kz lz la b lb lc kk ld le lf kn lg mq li lj lk mr lm ln lo ms lq lr ls lt im bi translated">在地球上的大多数地方，东北纬度与经度不同。离赤道越远，这种差异就越大。</p></blockquote><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="a638" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">非矢量化欧几里得距离计算如下所示:</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="0a01" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的例子中，我们计算相对于第一个数据点的欧几里得距离。因为我们使用了<code class="fe mj mk ml mm b">pandas.Series.apply</code>，所以我们循环了<code class="fe mj mk ml mm b">data['xy']</code>中的每个元素。如果我们对每个数据点重复这个过程，函数<code class="fe mj mk ml mm b">euclidean</code>将被连续调用n次。我们可以通过矢量化来提高效率。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="7706" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">计算现在是矢量化的。但是它的可读性较差，并且有许多中间变量。有没有更干净的方法？</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="494d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实证明，高效的欧几里德距离计算的诀窍在于一个不起眼的数字函数:<code class="fe mj mk ml mm b">numpy.absolute</code>。</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mt"><img src="../Images/255a895897b38d36cbd8fb4105e2cdee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMJqqCs7aEPa7IPmXh_xyA.png"/></div></div></figure><p id="8909" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Python的一个经常被忽视的特性是复数是内置的原语。我们可以将它们转换成复数，而不是将<code class="fe mj mk ml mm b">xy</code>表示为二元元组。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="ba23" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意数据类型已经从<code class="fe mj mk ml mm b">object</code>变成了<code class="fe mj mk ml mm b">complex128</code>。</p><p id="2efb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除非你是受过纯数学训练的人，否则你可能直到现在才意识到(像我一样)复数可以有绝对值，并且绝对值对应于离原点的欧几里得距离。应用这些知识，我们可以将代码简化为:</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="bed2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有最后一个问题:如果您需要持久化您的表，复数并不容易序列化。幸运的是，把一个复数分解回它的实部和虚部并不太难。</p><figure class="lv lw lx ly gt iv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9ff3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">希望你会发现这是有用的。</p></div></div>    
</body>
</html>