<html>
<head>
<title>Eye-catching animated maps in R — a simple introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引人注目的R动画地图——简单介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/eye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1?source=collection_archive---------7-----------------------#2020-10-24">https://towardsdatascience.com/eye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1?source=collection_archive---------7-----------------------#2020-10-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0f76" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用<strong class="ak">传单</strong>和<strong class="ak">闪亮</strong>轻松制作美丽地图的动画。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/63bc56f8474647b535015817af365182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T8qlxJ2z_aCnlv-h"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@timowielink?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">提莫·维林克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为数据科学家和数据分析师，我们每天都要处理不同种类的数据。我们都知道，数据和我们的发现的可视化是关键，尤其是在向同事或客户展示时。毕竟，用图表来讲述一个故事比用简单的数字或文本要容易得多。当您通过仪表板呈现数据时，不仅静态可视化变得重要，您还希望动态显示数据的变化。</p><p id="736c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将展示如何使用r中的<strong class="lb iu">活页</strong>和<strong class="lb iu">闪亮</strong>库轻松制作基于地理空间数据的图表。</p><h1 id="7401" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.介绍</h1><p id="419b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然在R中绘制地图有许多方法(例如使用<strong class="lb iu"> ggplot2 </strong>或<strong class="lb iu"> tmap </strong>)，但<strong class="lb iu">传单</strong>库是我个人最喜欢的，原因如下:</p><ul class=""><li id="05b3" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">简单</li><li id="14e7" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">高度定制化</li><li id="8cf3" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">漂亮的交互式地图</li><li id="3f94" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">适用于所有主要的桌面和移动平台</li></ul><p id="3648" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> leaflet </strong> R库建立在<a class="ae ky" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank"> leaflet.js </a>之上，这是领先的用于移动友好的交互式地图的开源JavaScript库。R实现让我们只用几行代码就能生成简单的地图。例如，只需一行代码，您就可以显示以下地图，放大奥地利美丽的维也纳:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/580cabf31c9e1cc31878ee5f20c1f469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DV87BCHLHzaIB1kw8WhAhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本传单地图(图片由作者提供)</p></figure><p id="4260" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管创建这个地图非常简单，但是它还没有显示任何数据。最终我们想要的是这样的东西:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/40b741fb656245f9f3be91f2d988e12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*AW9Y_NsXtefZCu5vDh1xeQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">附有数据的基本传单地图(图片由作者提供)</p></figure><p id="3201" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想要用数据覆盖我们的地图(就像在上面的例子中，我们已经添加了一些圆圈标记)，或者甚至根据一些底层数据给我们的地图着色(所谓的<a class="ae ky" href="https://en.wikipedia.org/wiki/Choropleth_map" rel="noopener ugc nofollow" target="_blank"> Choropleth </a>)。最后，我们希望能够动画显示数据随时间的变化，以便将我们的地图包含在一个漂亮的仪表板中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/5446bcabf6e216d9276bbdcc5e11573a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ApzpHBXYtdI85dFBn0FrRg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本动画(图片由作者提供)</p></figure><p id="8f17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在接下来的部分，我将简要演示如何制作一个类似于上面的动画，以及如何创建一个动画的Choropleth。</p><h1 id="50e0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.数据</h1><p id="b381" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们需要两种类型的数据:我们需要显示我们想要的地图和我们有兴趣显示的数据。</p><p id="3601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于地图数据，我们使用<strong class="lb iu">活页</strong>有两个主要选项:</p><ul class=""><li id="aeea" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">瓷砖</li><li id="1de4" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">GeoJSON或TopJSON文件形式的地理空间数据</li></ul><p id="ac55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经看到了如何使用上面图表中的基本图块，简单地使用默认为<a class="ae ky" href="https://www.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a>图块的<em class="nl"> addTiles() </em>函数。我们也可以通过使用<em class="nl"> addProviderTiles() </em>函数来使用其他第三方图块集。有关可用图块的完整列表，请参见此处的<a class="ae ky" href="http://leaflet-extras.github.io/leaflet-providers/preview/index.html" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="b462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以从GeoJSON或TopJSON文件中读取地理空间数据，并将它们转换为r中的空间对象。为了创建我们的Choropleth，我们必须使用一个名为<em class="nl"> addPolygons() </em>的函数，它要求我们使用这样的空间数据。虽然这整个过程一开始听起来复杂而吓人，但实际上非常简单。</p><p id="2931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将重点展示国家级别的数据。我们可以很容易地从<a class="ae ky" href="http://www.thematicmapping.org" rel="noopener ugc nofollow" target="_blank">www.thematicmapping.org</a>获得所需的空间数据，它提供了“<a class="ae ky" href="http://thematicmapping.org/downloads/world_borders.php" rel="noopener ugc nofollow" target="_blank">世界边界数据集</a>”。下面的代码片段展示了如何从r下载、解压缩和加载这些数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="7a89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成的空间面数据框包含所有国家的信息，例如国家代码、名称、经度和纬度坐标。对象中包含的基本数据可以通过以下方式访问:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/5b8c0910f43ff4a430ad429a55d4a697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*7QPI2gjoym563Yge5CaYBA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">世界边界数据集概述(图片由作者提供)</p></figure><p id="390c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于绘制Choropleth来说，重要的是对象中包含的多边形数据。这基本上是用来绘制国家边界的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/18d846a7b619b74446bcf827f10468c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*QI-fmRRu5Tox47731Ka_2A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多边形数据(图片由作者提供)</p></figure><p id="16a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们需要的所有数据，用来创建我们将要使用的基本地图。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="3852" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将要显示的数据与当前的重要主题相关:正在进行的新冠肺炎疫情的案例数据。世界卫生组织以csv格式发布所有国家的每日病例统计数据，我们可以随时查阅。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/7a7ee7250ab31394199060d954ada108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSG4tVUkQTY1ms4g-Nlzjg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">世卫组织Covid数据集(图片由作者提供)</p></figure><p id="d49b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集为我们提供了自2020年初以来的每日统计数据，并且每天都在更新。</p><h1 id="6df9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.基本地图</h1><p id="4b60" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这一节中，我将展示如何创建地图的基本版本，我们将在后面制作动画。</p><p id="f8d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将把空间数据与选定日期的COVID案例结合起来，定义将要显示的标签文本，并为数据和图表图例设置调色板。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="79dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用圆形标记来创建地图的第一个版本，以显示COVID案例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/5877cef301c66dd95481b1e1e68960dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvWzbyS4PJo0jsT-Br3_4w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本圆形标记图(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="6602" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很简单！我们所要做的就是使用<em class="nl"> addCircleMarkers() </em>函数，使用我们的数据集中包含的经度和纬度坐标作为圆的中点，并使它们的半径和颜色取决于案例的数量。我们还添加了出现在鼠标悬停时的标签文本以及左下角的图例。所有这些都不费吹灰之力！</p><p id="d0b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建Choropleth版本同样简单。不使用<em class="nl"> addCircleMarkers() </em>函数，我们只需使用<em class="nl"> addPolygons() </em>函数，并且不使用坐标，我们需要使用空间多边形数据框中包含的多边形。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/fbd485597c28fb75b12b1cacac420c93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-yoqr1oRzNShmgk_h0vTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本Choropleth地图示例(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="719f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再说一遍，超级简单！在下一节中，我们将使用<strong class="lb iu">闪亮的</strong>为我们创建的两个版本的地图制作动画。</p><h1 id="1704" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.动画</h1><p id="746d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"/></p><p id="a2bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然<strong class="lb iu">传单</strong>本身无法帮助我们完成显示数据随时间变化的任务，但我们可以使用<strong class="lb iu"> shiny </strong>中的简单设置来完成这一任务。我们所要做的就是使用一个<em class="nl"> sliderInput </em>小部件为我们选择日期，并将animate参数设置为TRUE。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9f8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个输入部件在右下角有一个小的播放按钮，如果我们在这个部件中观察地图的变化，我们将得到我们的模拟！</p><p id="8ad9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免每次改变时都要重新绘制整个地图的开销，我们可以使用<em class="nl"> leafletProxy() </em>函数，它是专门为在闪亮的上下文中使用而设计的。它允许我们访问已经绘制的地图并改变其特征。</p><p id="9bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于地图的标记版本，我们只需通过<em class="nl"> clearMarkers() </em>清除现有标记，并在观察到所选日期发生变化时添加新标记。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/ef4d7cff43674e381769451eca23b67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MpQx60OwYaEclzlKnQeeDg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">闪亮的动画标记地图(图片由作者提供)</p></figure><p id="686f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，重新绘制多边形在计算上更加昂贵，并且会在我们的<strong class="lb iu">闪亮的</strong>应用程序中引入显著的延迟。在撰写本文时，<strong class="lb iu">传单</strong>库中还没有直接的方法允许我们简单地改变绘制的多边形的特征。然而，使用一点JavaScript就像这里详细描述的<a class="ae ky" href="https://github.com/rstudio/leaflet/issues/496" rel="noopener ugc nofollow" target="_blank">一样</a>将允许我们做我们想做的事情。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/eb82fe13144a215b63498cbce36554b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*odD0Z_Qlb5vQURuaJ_s6BA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">闪亮的动画Choropleth地图(图片由作者提供)</p></figure><p id="c7d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如承诺的那样，你可以在下面找到<strong class="lb iu">闪亮</strong>应用的完整代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="6234" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.结论</h1><p id="0d79" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这就把我们带到了本文的结尾，在这篇文章中，我演示了如何使用<strong class="lb iu">传单</strong>和<strong class="lb iu">闪亮的</strong> R库轻松创建引人注目的动画地图。希望这能让你自己通过几个简单的步骤创建令人惊奇的交互式地图，并在一个漂亮的仪表板上分享它！</p><p id="d6f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对我在本文中展示的内容有任何反馈或问题，请务必让我知道，并在这些不确定的时期保持安全！</p></div></div>    
</body>
</html>