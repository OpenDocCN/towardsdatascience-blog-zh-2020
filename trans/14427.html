<html>
<head>
<title>Making Heat Maps with Literal Maps: How to Use Python to Construct a Chloropleth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用文字地图制作热图:如何使用Python构建一个Chloropleth</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-heat-maps-with-literal-maps-how-to-use-python-to-construct-a-chloropleth-6b65e4e33905?source=collection_archive---------6-----------------------#2020-10-05">https://towardsdatascience.com/making-heat-maps-with-literal-maps-how-to-use-python-to-construct-a-chloropleth-6b65e4e33905?source=collection_archive---------6-----------------------#2020-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3332" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你有没有读过一篇新闻文章，读到一半时，你看到了一幅文章所讨论的任何内容的漂亮的图形表示？它是完美的——这是一张地理地图，某些区域阴影的深浅对应于该区域特定统计趋势的存在或强度。你心里想，“哇，真不错。我真的理解为什么他们说一张照片胜过千言万语。因为这篇文章只花了我五分钟的时间告诉我一些我可以单独从这张图中收集到的东西。强大。我敢打赌，你必须是某种数学奇才或计算机天才，才能弄明白如何制作其中的一个。”</p><p id="ef5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很高兴告诉你一些关于这个时刻的事情。第一，我完全同意你的观点；这些图表很简洁。它们被称为氯普图，它们可以提供大量的信息。你可能会比你意识到的更经常地看到这些(我们正处于美国最激烈的选举季节，所以我觉得我每周都要被它们轰炸好几次)。第二，你不需要成为一名电脑大师来制造一台电脑；事实上，用一些基本的Python技巧就可以很容易地构建它们。在博客的其余部分，我将向你展示如何制作这样一个图表，这样你就可以给你所有的朋友留下深刻印象。本指南将假设您对Python和Pandas包有基本的了解(如果您没有，您真正需要知道的是如何从您的计算机上打开一个Jupyter笔记本，并用您的计算机终端导航到文件夹；理论上你可以复制粘贴剩下的部分)。</p><p id="4309" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步:安装Geopandas </strong></p><p id="1988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以你需要做的第一件事就是安装一个名为<em class="kl"> Geopandas的新python包。</em>这基本上只允许我们导入形状文件，并使用Python绘制图形。要安装<em class="kl"> Geopandas </em>，只需在您的终端中运行以下代码行:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="f74c" class="kv kw iq kr b gy kx ky l kz la">conda install geopandas</span></pre><p id="cc5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到软件包下载，好消息，您已经上路了！</p><p id="f21f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步:获取一些数据</strong></p><p id="e4f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们要下载一些数据来使用。你想做什么地图？！因为我住在纽约州的布鲁克林，而且这里每个人脑子里无处不在的话题是新冠肺炎，所以我将使用我在下面的GitHub页面上找到的一些最近的测试数据:<a class="ae lb" href="https://github.com/nychealth/coronavirus-data" rel="noopener ugc nofollow" target="_blank">https://github.com/nychealth/coronavirus-data</a></p><p id="dbae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">具体来说，我将使用每个邮政编码最近的正COVID测试率，并将它们绘制在纽约市的地图上，该地图恰好按邮政编码划分。</p><p id="2dc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您确实可以使用任何您想要的数据，但是对于您自己的修补，您至少需要在您的数据中有一个. csv文件和一个. shp文件。第一个是您想要使用的类似电子表格的实际数据列表，第二个是实际绘制地图的形状文件。你要确保你的。csv文件。shp使用相同的惟一键对地区进行分类(在我的例子中，这些惟一的地区是邮政编码)。将这些文件下载到计算机后，打开终端，导航到包含这些项目的相应文件夹，然后运行以下代码:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="b1fe" class="kv kw iq kr b gy kx ky l kz la">jupyter notebook</span></pre><p id="0dc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到类似下图的内容。只是为了检查一下你的。csv和。shp文件应该列在屏幕的左侧:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lc"><img src="../Images/ab68b6de32c22925af354fc81067167b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zestj2R_bxO4Hv7AxVNMnA.png"/></div></div></figure><p id="57b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个页面中，通过点击右上角的“new”按钮创建一个新的Python笔记本，我们终于可以开始构建我们的图表了。</p><p id="b239" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第三步:导入Python中的相关包和文件</strong></p><p id="696b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的笔记本中，我们希望首先导入相关的Python包和我们下载的数据。为此，请使用以下代码:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="9534" class="kv kw iq kr b gy kx ky l kz la"># import relevant packages<br/>import geopandas as gpd<br/>import pandas as pd<br/>import matplotlib.pyplot as plt</span><span id="ca77" class="kv kw iq kr b gy lk ky l kz la"># import relevant data<br/>nyc_map = gpd.read_file("Geography-resources/MODZCTA_2010.shp")<br/>stats=pd.read_csv("recent/recent-4-week-by-modzcta.csv")</span></pre><p id="3e53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用自己的数据，只需确保用您实际的文件路径/名称替换最后两行中引号内的文本。作为参考，分配包含在我的。csv文件中的数据保存到名为“stats”的变量中。shp文件保存到名为“nyc_map”的变量中。如果您要查看我们刚刚导入的任何一个文件，它们看起来会像这样:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ll"><img src="../Images/f01c70fe0e14502976ba3bc71b38b3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5IiUThv5AE0nVJj3JD6eQ.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">我的。csv文件</p></figure><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lq"><img src="../Images/8eaa055c588ef36f5938b7bf64d1c58a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFuXubU_D6xv8OujtZNkSw.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">我的。shp文件</p></figure><p id="a45d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我想让大家注意两件事。首先，浏览一下我的“几何”专栏。shp文件。你会看到它看起来有点像一个坐标列表。差不多就是这样。存储在该列中的是Geopandas绘制一个形状(或者在我们的例子中是多个形状)所需的所有几何数据。其次，检查“MODZCTA”列，注意这个列出现在我的文件的<em class="kl">和</em>中。这些是我前面提到的唯一的区域键，它们很重要，因为它们允许我们将。csv文件中的几何数据。shp文件。</p><p id="f3d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第四步:准备绘图数据</strong></p><p id="b439" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我们如何执行这种数据婚姻呢？我们将通过合并两个表来创建一个包含地理和统计数据的新数据框架。我们使用以下代码来执行此操作:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="dadf" class="kv kw iq kr b gy kx ky l kz la">map_and_stats=nyc_map.merge(stats, on="MODZCTA")</span></pre><p id="bf58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我把我的“纽约市地图”数据(的。shp文件)，并使用“MODZCTA”列中的邮政编码，附加我的“stats”中的所有数据。csv文件)。我将这个新表命名为“map_and_stats”(我知道这很有想象力)。我们可以看看新的数据框来验证:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lr"><img src="../Images/20acaca7d98dca585377ef7bdc1e3014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NVHuE0Y4HkghqSVVPxJmg.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">我的组合“地图和统计”数据框架</p></figure><p id="3d6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看吧，我们现在把所有信息都放在一个地方了。我们准备好策划了。</p><p id="4524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第五步:绘制数据</strong></p><p id="266a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我们一直在等待的时刻，我们数据的实际绘图。首先，我们要建立我们的情节和大小(我使用8“x8”大小)。我还将把我们的x轴标签旋转90度，只是为了让内容更具可读性。我们用下面的代码实现了这一点:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="c0e8" class="kv kw iq kr b gy kx ky l kz la">fig, ax = plt.subplots(1, figsize=(8, 8))<br/>plt.xticks(rotation=90)</span></pre><p id="6cc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们希望专门绘制上一步中连接的新数据帧中的数据。具体来说，我想看看我的数据中名为“最新利率”的一栏。您可以在这里调整其他属性(线条粗细、阴影颜色等。)，但我会把它留给你们去玩。该图形的代码如下:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="8a2c" class="kv kw iq kr b gy kx ky l kz la">map_and_stats.plot(column="Latest Rates", cmap="Reds", linewidth=0.4, ax=ax, edgecolor=".4")</span></pre><p id="be87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们执行此操作时，会得到下图:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ls"><img src="../Images/df37e8aa18efe419f5dd7dad12465265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*evYH74NJDU12x0kR2q8ELg.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">纽约市的COVID检测率</p></figure><p id="3ac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很酷，是吧？我们也可以做一些装饰。标题、轴标签等。可以像添加其他支线剧情一样添加，但是让我们在这里添加一个颜色标尺，这样我们就可以告诉人们这些红色的阴影实际上意味着什么。我们可以通过下面的代码实现这一点:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="0f02" class="kv kw iq kr b gy kx ky l kz la">bar_info = plt.cm.ScalarMappable(cmap="Reds", norm=plt.Normalize(vmin=0, vmax=120))<br/>bar_info._A = []<br/>cbar = fig.colorbar(bar_info)</span></pre><p id="7854" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要注意的是，色阶的界限是通过上面看到的“vmin”和“vmax”属性设置的。在我的数据中，最大的阳性测试率大约是100，所以我决定将我的最大值设为120。在任何情况下，如果您现在绘制图表，您可以看到以下内容:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ls"><img src="../Images/1fb84a0da4030159eaad6048a1b99f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xn-TQQOtbBbReEnwAGJgJA.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">纽约市使用色标的COVID测试率</p></figure><p id="40a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇，看看我们看起来多专业。我们有了这张图，但是假设我对其中的某个部分感兴趣。再说一次，我住在布鲁克林，所以也许我想放大那个地区。我们可以通过在图表上设置x和y的极限来达到这个目的。你可以在轴上看到，我们有类似坐标的数字，Geopandas用来绘制我们的地图。我们使用这些相同的坐标来有效地放大感兴趣的区域。我要查看的区域在x轴上介于970000和1010000之间，在y轴上介于140000和200000之间，因此我将使用以下代码将我们的图像限制在这些范围内(然后出于美观的原因关闭我们的轴):</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="5c70" class="kv kw iq kr b gy kx ky l kz la">ax.set_xlim(970000, 1010000)<br/>ax.set_ylim(140000, 200000)<br/>ax.axis("off")</span></pre><p id="6f76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们执行时，我们得到下面的图形:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lt"><img src="../Images/62e96ba9596ca83b185c1c56b4434cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CE_n2z6BMmFQXu6uEEw3AA.png"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">布鲁克林的COVID测试率与色标</p></figure><p id="869b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太棒了，对吧？现在你要做的就是保存你的形象，打印出来，向你所有的朋友和家人吹嘘你有多专业。</p></div></div>    
</body>
</html>