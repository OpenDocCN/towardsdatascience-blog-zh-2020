<html>
<head>
<title>How to predict an image using CNN with Keras?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用带有Keras的CNN预测一个图像？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-predict-an-image-with-keras-ca97d9cd4817?source=collection_archive---------0-----------------------#2020-10-01">https://towardsdatascience.com/how-to-predict-an-image-with-keras-ca97d9cd4817?source=collection_archive---------0-----------------------#2020-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5cbe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">图片里有什么？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/05bf17f840e236bb2e27175cd7b377a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XmWrGHcgEI9eJh3O"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@karsten116?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡斯滕·怀恩格特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="0c84" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何预测图像的类型？</h1><p id="a6de" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">确定图像包含什么对象有以下六个步骤？</p><ul class=""><li id="3f8d" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">加载图像。</li><li id="b4ff" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">将其调整为预定义的大小，如224 x 224像素。</li><li id="8e38" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">将像素值缩放到范围[0，255]。</li><li id="c039" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">选择预先训练的模型。</li><li id="b422" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">运行预先训练的模型。</li><li id="26c0" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">显示结果。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/15b8f9b1ebb4805a7f2a6ecf2405ef98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6tjtOoyIeTIpZzdfGmPbw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何预测图像的类型</p></figure><h1 id="a888" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">使用Keras实施解决方案</h1><h2 id="1075" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">要求</h2><p id="e1b5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">安装TensorFlow和Keras。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="ae95" class="ne la it nr b gy nv nw l nx ny">pip install tensorflow</span></pre><h2 id="5303" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">设置您的环境</h2><p id="3f3f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，我们设置环境。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="fd4c" class="ne la it nr b gy nv nw l nx ny"># TensorFlow and tf.keras</span><span id="cd07" class="ne la it nr b gy nz nw l nx ny">import tensorflow as tf<br/>from tensorflow.keras.applications.resnet50 import preprocess_input, decode_predictions<br/>from tensorflow.keras.preprocessing import image</span><span id="9e36" class="ne la it nr b gy nz nw l nx ny"># Helper libraries<br/>import numpy as np<br/>import matplotlib.pyplot as pl</span><span id="8499" class="ne la it nr b gy nz nw l nx ny">print(tf.__version__)</span></pre><h2 id="983f" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">加载图像</h2><p id="54d5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">然后，我们加载并尝试显示我们想要预测的图像。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="0743" class="ne la it nr b gy nv nw l nx ny">img_path<!-- --> <!-- -->=<!-- --> <!-- -->"./samples/<!-- -->dog_1100x628.jpg<!-- -->"</span><span id="3dc0" class="ne la it nr b gy nz nw l nx ny">plt.imshow(img)<br/>plt.show()</span></pre><p id="27a6" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma oa mc md me ob mg mh mi oc mk ml mm im bi translated">它展示了一只维兹拉狗，那么我们的模型如何预测这个图像呢？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d06118688496aa7f2e633103703945f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJ0XybGQVvkyxR_9UoEkqw.png"/></div></div></figure><h2 id="4a6a" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">调整图像大小</h2><p id="25d5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">请记住，在将任何图像输入Keras之前，我们需要将其转换为标准格式，因为预先训练的模型希望输入具有特定的大小。在这种情况下，我们需要将图像的大小调整为224 x 224像素。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="c0f4" class="ne la it nr b gy nv nw l nx ny">img<!-- --> <!-- -->=<!-- --> <!-- -->image.load_img(img_path,<!-- --> <!-- -->target_size=(224,<!-- --> <!-- -->224))</span></pre><p id="ddd9" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma oa mc md me ob mg mh mi oc mk ml mm im bi translated">第二是大多数深度学习模型期望一批图像作为输入。在这种情况下，我们创建一批一个图像。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="00a0" class="ne la it nr b gy nv nw l nx ny">img_array<!-- --> <!-- -->=<!-- --> <!-- -->image.img_to_array(img)<br/>img_batch<!-- --> <!-- -->=<!-- --> <!-- -->np.expand_dims(img_array,<!-- --> <!-- -->axis=0)</span></pre><h2 id="66f5" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">将像素值缩放到一致的范围</h2><p id="5f51" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第三，当数据在一个一致的范围内时，模型表现良好。在这种情况下，图像像素值的范围是从0到255。因此，如果我们在输入图像上运行Keras的<code class="fe oe of og nr b">preprocess_input()</code>函数，就会将每个像素标准化到一个标准范围。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="29d8" class="ne la it nr b gy nv nw l nx ny">img_preprocessed = preprocess_input(img_batch)</span></pre><h2 id="ad36" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">选择预先训练的模型</h2><p id="a33f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这里，我们将使用一个名为ResNet-50的CNN网络。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="a1af" class="ne la it nr b gy nv nw l nx ny">model = tf.keras.applications.resnet50.ResNet50()</span></pre><h2 id="463f" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">运行预先训练的模型</h2><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="ce65" class="ne la it nr b gy nv nw l nx ny">prediction = model.predict(img_preprocessed)</span></pre><h2 id="740b" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">显示结果</h2><p id="318e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Keras还提供了<code class="fe oe of og nr b">decode_predictions</code>函数，它告诉我们图像中包含的每一类对象的概率。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="9fab" class="ne la it nr b gy nv nw l nx ny">print(decode_predictions(prediction, top=3)[0])</span></pre><p id="7976" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma oa mc md me ob mg mh mi oc mk ml mm im bi translated">下面是运行这个程序时的输出。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="7bde" class="ne la it nr b gy nv nw l nx ny">[(‘n02099601’, ‘golden_retriever’, 0.75317645), <br/>(‘n02100583’, ‘vizsla’, 0.061531797), <br/>(‘n02099267’, ‘flat-coated_retriever’, 0.04048888)]</span></pre><p id="2d26" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma oa mc md me ob mg mh mi oc mk ml mm im bi translated">该图像的预测类别是各种类型的狗。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/b0d5cd0db905e1d86da6d4814b29d661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eXGeRLjhdNyo2NLPthFfRQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三种狗</p></figure><p id="e0f8" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma oa mc md me ob mg mh mi oc mk ml mm im bi translated">完整的源代码完成。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="0bd6" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma oa mc md me ob mg mh mi oc mk ml mm im bi translated">很简单，对吧？</p><h1 id="96e1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><p id="307c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://github.com/housecricket/how_to_predict_an_image_with_keras" rel="noopener ugc nofollow" target="_blank">https://github . com/house cricket/how _ to _ predict _ an _ image _ with _ keras</a></p></div></div>    
</body>
</html>