<html>
<head>
<title>Using Docopt in python, the most user-friendly command-line parsing library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在python中使用Docopt，这是最用户友好的命令行解析库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-docopt-in-python-the-most-user-friendly-command-line-parsing-library-5c6aeac14deb?source=collection_archive---------9-----------------------#2020-10-17">https://towardsdatascience.com/using-docopt-in-python-the-most-user-friendly-command-line-parsing-library-5c6aeac14deb?source=collection_archive---------9-----------------------#2020-10-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/50c51cb4c70cb5e5be5c6864290a8b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2fm55DWaP30JZgc5"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:<a class="ae jg" href="https://unsplash.com/@priscilladupreez" rel="noopener ugc nofollow" target="_blank">普里西拉·杜·普里兹</a>，<a class="ae jg" href="https://unsplash.com/photos/bZQJLStVYWs" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><div class=""/><div class=""><h2 id="3f21" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">在每个项目的运行文件中，将参数解析成python文件是必不可少的。本文向您展示了Docopt的实践</h2></div><p id="d079" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当你处理一个有很多参数的文件时，总是在python文件中改变这些参数是很费时间的，而且对用户也不友好。已经实现了一些库来解决这个问题，称为命令行解析库。在python中，它们是三种不同的解决方案:<a class="ae jg" href="http://docopt.org/" rel="noopener ugc nofollow" target="_blank"> Docopt </a>、<a class="ae jg" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank"> Argparse </a>和<a class="ae jg" href="https://click.palletsprojects.com/en/7.x/" rel="noopener ugc nofollow" target="_blank"> Click </a>。</p><p id="5a20" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将深入探讨Docopt的使用，而不是Argparse或Click。我做出这个选择是因为在使用了所有这三种方法之后，我意识到Docopt是迄今为止将参数解析到文件中最用户友好的方式。</p><p id="eb15" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我展示Docopt库的方式是向您展示一个带有<strong class="la jk"> setup.py </strong>和<strong class="la jk"> requirements.txt </strong>文件的<strong class="la jk"> docopt.py </strong>文件示例。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5efc" class="md me jj lz b gy mf mg l mh mi">### docopt.py file </span><span id="a410" class="md me jj lz b gy mj mg l mh mi">'''<br/>Usage:</span><span id="b49c" class="md me jj lz b gy mj mg l mh mi">docopt.py square [options] [operation] [square-option]</span><span id="aa9a" class="md me jj lz b gy mj mg l mh mi">docopt.py rectangle [options] [operation] [triangle-option]</span><span id="57e6" class="md me jj lz b gy mj mg l mh mi">operation:<br/>   --area=&lt;bool&gt;       Calculate the area if the argument==True<br/>   --perimeter=&lt;bool&gt;  Calculate the perimeter if the argument==True</span><span id="d480" class="md me jj lz b gy mj mg l mh mi">square-option:<br/>   --edge=&lt;float&gt;      Edge of the square. [default: 2]</span><span id="326c" class="md me jj lz b gy mj mg l mh mi">rectangle-option:<br/>   --height=&lt;float&gt;    Height of the rectangle <br/>   --width=&lt;float&gt;     Width of the rectangle </span><span id="d081" class="md me jj lz b gy mj mg l mh mi">'''<br/>from docopt import docopt</span><span id="6b15" class="md me jj lz b gy mj mg l mh mi">def area(args):<br/>   """<br/>   This method computes the area of a square or a rectangle <br/>   """   <br/>   if bool(args['square']):<br/>      if args['--edge']:<br/>         area = float(args['edge']) ** 2<br/>      else:<br/>         print("You must specify the edge")<br/>   elif bool(args['rectangle']):<br/>      if args['--height'] and args['--width']:<br/>         area = float(args['--height']) * float(args['--width'])<br/>      else:<br/>         print("You have forgotten to specify either the height or       the width or both")<br/>   return area<br/></span><span id="42a8" class="md me jj lz b gy mj mg l mh mi">def perimeter(args):<br/>   """<br/>   This method computes the perimeter of a square or a rectangle <br/>   """<br/>   if bool(args['square']):<br/>      if args['--edge']:<br/>         perimeter = float(args['edge']) * 2<br/>      else:<br/>         print("You must specify the edge")<br/>   elif bool(args['rectangle']):<br/>      if args['--height'] and args['--width']:<br/>         perimeter = float(args['--height']) + float(args['--width'])<br/>      else:<br/>         print("You have forgotten to specify either the height or       the width or both")<br/>   return perimeter</span><span id="01f6" class="md me jj lz b gy mj mg l mh mi">def main():<br/>   args = docopt(__doc__)</span><span id="fa5c" class="md me jj lz b gy mj mg l mh mi">   if args['--area']:<br/>      area(args)<br/>   elif args['--perimeter']:<br/>      perimeter(args)<br/>   else:<br/>      print("command not found")</span><span id="ef60" class="md me jj lz b gy mj mg l mh mi">if __name__=='__main__':<br/>   main()</span></pre><p id="ad65" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它们是<strong class="la jk"> docopt.py </strong>文件中的两部分:</p><ul class=""><li id="f83a" class="mk ml jj la b lb lc le lf lh mm ll mn lp mo lt mp mq mr ms bi translated">文档字符串中参数的定义</li><li id="8baf" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">您想要/需要调用的不同方法</li></ul><h1 id="952b" class="my me jj bd mz na nb nc nd ne nf ng nh kp ni kq nj ks nk kt nl kv nm kw nn no bi translated">参数定义</h1><p id="9d72" class="pw-post-body-paragraph ky kz jj la b lb np kk ld le nq kn lg lh nr lj lk ll ns ln lo lp nt lr ls lt im bi translated">在用法部分，你写下你的命令行在终端中的调用格式。因此，如果我想在边长为5的正方形上调用面积运算，我将执行以下操作。：</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="f27f" class="md me jj lz b gy mf mg l mh mi">python -m docopt.py square --area=True --edge=5  </span></pre><p id="f92e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，在“<strong class="la jk">用法</strong>”部分，我们可以定义默认值，但是如果我们像使用“<strong class="la jk"> — edge </strong>参数那样在命令行中指定值，这些值将被覆盖。</p><p id="abd8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以让我们分解命令行:</p><ul class=""><li id="f1cc" class="mk ml jj la b lb lc le lf lh mm ll mn lp mo lt mp mq mr ms bi translated"><strong class="la jk"> docopt.py </strong>:是您想要运行的python文件的名称</li><li id="03bc" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated"><strong class="la jk">正方形</strong>或<strong class="la jk">矩形</strong>是我们需要在命令行中给出的两个必要参数，以正确运行它</li><li id="c6c7" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">[ <strong class="la jk"> options </strong> ]:是一个必要的括号参数，声明下面的元素将是可选参数</li><li id="91ee" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">【<strong class="la jk">运算</strong>】:由两个不同的参数组成，分别是“—面积”和“—周长”。对于这两个参数，我们需要在命令行中输入的值是一个布尔值。' = &lt; bool &gt;'是可选的，但是给出了用户需要输入哪种元素的提示。</li><li id="4ffd" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">【<strong class="la jk">方形选项</strong>】:由一个参数组成，默认值为</li></ul><h1 id="a541" class="my me jj bd mz na nb nc nd ne nf ng nh kp ni kq nj ks nk kt nl kv nm kw nn no bi translated">方法</h1><p id="3da9" class="pw-post-body-paragraph ky kz jj la b lb np kk ld le nq kn lg lh nr lj lk ll ns ln lo lp nt lr ls lt im bi translated">在这一部分，我将通过'<strong class="la jk">区</strong>'和'<strong class="la jk">周边</strong>'的方法。但是在这样做之前，您注意到您需要导入docopt包，并且在此之前您需要安装它。然而，暂时忘记安装，我会给你一个干净的方法来做。</p><p id="ab87" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您会注意到，在这两种方法中，当我需要来自docopt的参数时，我需要将其转换为正确的类型。例如args['square']是一个布尔值，但我需要显式地将其转换为布尔值。</p><p id="53d0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，计算面积和周长的方法是非常基本的方法，但是是可选的方法。</p><p id="82fc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在文件的末尾有两行是正确运行该文件所必需的:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="cca8" class="md me jj lz b gy mf mg l mh mi">if __name__=='__main__':<br/>   main()</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="5394" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们已经创建了我们的<strong class="la jk"> docopt.py </strong>文件，我们可以创建一个<strong class="la jk"> setup.py </strong>文件，只要一个requirements.txt文件，使我们的项目更加用户友好。</p><p id="d750" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个<a class="ae jg" href="https://docs.python.org/3/distutils/setupscript.html" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk"> setup.py </strong> </a>文件是一个python文件，在其中你描述了你的模块向Distutils的分布，以便在你的模块上操作的各种命令做正确的事情。在这个文件中，您可以指定要运行项目中的哪些文件，以及运行项目所需的哪些包。</p><p id="3f01" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在进入<strong class="la jk"> setup.py </strong>文件之前，您的项目中需要有以下架构:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="c171" class="md me jj lz b gy mf mg l mh mi">/docopt-demo<br/>   docopt.py<br/>   requirements.txt<br/>   setup.py</span></pre><p id="7d22" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有一个关于这个项目的<strong class="la jk"> setup.py </strong>文件的例子:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="2d40" class="md me jj lz b gy mf mg l mh mi">### setup.py file </span><span id="8eff" class="md me jj lz b gy mj mg l mh mi">from setuptools import setup</span><span id="8ebb" class="md me jj lz b gy mj mg l mh mi">with open("requirements.txt", "r") as fh:<br/>    requirements = fh.readlines()</span><span id="f3f7" class="md me jj lz b gy mj mg l mh mi">setup(<br/>   name = 'docopt-demo',<br/>   author = 'JonathanL',<br/>   description = 'Example of the setup file for the docopt demo',<br/>   version = '0.1.0',<br/>   packages = ['docopt-demo'],<br/>   install_requires = [req for req in requirements if req[:2] != "# "],<br/>   include_package_data=True,<br/>   entry_points = {<br/>      'console_scripts': [<br/>         'docopt = docopt-demo.docopt:main'<br/>      ]<br/>   }<br/>)</span></pre><p id="b9f2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是requirements.txt文件:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9bbb" class="md me jj lz b gy mf mg l mh mi"># Argument parser packages</span><span id="ad11" class="md me jj lz b gy mj mg l mh mi">docopt==0.6.2</span></pre><h1 id="586d" class="my me jj bd mz na nb nc nd ne nf ng nh kp ni kq nj ks nk kt nl kv nm kw nn no bi translated">解释setup.py文件</h1><p id="d1f1" class="pw-post-body-paragraph ky kz jj la b lb np kk ld le nq kn lg lh nr lj lk ll ns ln lo lp nt lr ls lt im bi translated">你必须做的第一个元素是从<strong class="la jk"> setuptools </strong>中<strong class="la jk">导入设置</strong>，但是这个包是python自带的，所以如果你的电脑上有python，它就会存在。</p><p id="115e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，您需要创建一个所有必需包的列表，您将在安装模块的<strong class="la jk"> install_requires </strong>参数中解析这些包。</p><p id="aff7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在设置模块中，您需要了解一些要素:</p><ul class=""><li id="305c" class="mk ml jj la b lb lc le lf lh mm ll mn lp mo lt mp mq mr ms bi translated"><strong class="la jk">包</strong>:应该和你所在的文件夹同名，所以对我们来说是‘doc opt-demo’</li><li id="191a" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">在'<strong class="la jk"> console_script </strong>中，您可以为特定文件指定快捷方式。在我们的例子中，不是在终端中键入:</li></ul><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="b64c" class="md me jj lz b gy mf mg l mh mi">python -m docopt square --area=True --edge=5</span></pre><p id="6631" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们只需要输入:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="f34f" class="md me jj lz b gy mf mg l mh mi">docopt square --area=True --edge=5</span></pre><p id="f0de" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实上，我们将单词'<strong class="la jk"> docopt </strong>'与操作'<strong class="la jk">doc opt-demo . doc opt:main</strong>'相关联，该操作启动docopt.py文件中的主函数。</p><h1 id="9e37" class="my me jj bd mz na nb nc nd ne nf ng nh kp ni kq nj ks nk kt nl kv nm kw nn no bi translated">解释要求. txt文件</h1><p id="2b22" class="pw-post-body-paragraph ky kz jj la b lb np kk ld le nq kn lg lh nr lj lk ll ns ln lo lp nt lr ls lt im bi translated">在这个文件中，您指定了正确运行项目所需安装的所有包。</p><p id="1617" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您有两种选择来指定版本:</p><ul class=""><li id="b6fb" class="mk ml jj la b lb lc le lf lh mm ll mn lp mo lt mp mq mr ms bi translated">要么你告诉确切的版本，你想使用，你会使用' == '符号</li><li id="bf10" class="mk ml jj la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">或者您也可以使用像' &gt; = '这样的操作符来指定包的旧版本</li></ul><h1 id="954b" class="my me jj bd mz na nb nc nd ne nf ng nh kp ni kq nj ks nk kt nl kv nm kw nn no bi translated">结论</h1><p id="4412" class="pw-post-body-paragraph ky kz jj la b lb np kk ld le nq kn lg lh nr lj lk ll ns ln lo lp nt lr ls lt im bi translated">在本文中，我将展示如何使用Docopt python包，这是一种将参数解析到文件中的非常好的方法。</p><p id="b032" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你在这篇文章中找到了你来这里的目的，并在接下来的图像识别之旅中与我在一起！</p><p id="2033" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，考虑注册成为一名灵媒成员。每月5美元，你可以无限制地阅读媒体上的故事。如果你使用<a class="ae jg" href="http://If you enjoy reading stories like these and want to support me as a writer consider signing up to become a Medium member. It's $5 a month, giving you unlimited access to stories on Medium. If you sign up using my link, I will earn a small commission and you will still pay $5. Thank you !! https://medium.com/@jonathan_leban/membership" rel="noopener ugc nofollow">我的链接</a>注册，我将赚取一小笔佣金，你仍需支付5美元。谢谢大家！！</p><div class="is it gp gr iu ob"><a href="https://medium.com/@jonathan_leban/membership" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd jk gy z fp og fr fs oh fu fw ji bi translated">通过我的推荐链接加入媒体-乔纳森·莱班</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">阅读乔纳森·莱班的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接支持…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ja ob"/></div></div></a></div><p id="d5ec" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="oq"> PS:我目前是Unity Technologies的机器学习工程师，刚刚从加州大学伯克利分校的工程硕士毕业，如果你想讨论这个话题，请随时联系我。</em> <a class="ae jg" href="http://jonathan_leban@berkeley.edu/" rel="noopener ugc nofollow" target="_blank"> <em class="oq">这里的</em> </a> <em class="oq">是我的邮箱。</em></p></div></div>    
</body>
</html>