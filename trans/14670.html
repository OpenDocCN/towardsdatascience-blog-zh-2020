<html>
<head>
<title>How to Create an Animated Map of Bike Rentals in Chicago</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建芝加哥自行车租赁的动画地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710?source=collection_archive---------45-----------------------#2020-10-09">https://towardsdatascience.com/how-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710?source=collection_archive---------45-----------------------#2020-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a684" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向使用Python包Bokeh创建的可视化添加动画</h2></div><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div><p class="km kn gj gh gi ko kp bd b be z dk translated">图片由作者上传至gfycat</p></figure><p id="e6ce" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><em class="lm">本文假设读者已经知道如何使用Python中的散景库绘制地理数据。关于精彩透彻的解释，请看这篇</em> <a class="ae ln" rel="noopener" target="_blank" href="/exploring-and-visualizing-chicago-transit-data-using-pandas-and-bokeh-part-ii-intro-to-bokeh-5dca6c5ced10"> <em class="lm">文章</em> </a> <em class="lm">作者</em> <a class="ae ln" href="https://towardsdatascience.com/@colinpatrickreid" rel="noopener" target="_blank"> <em class="lm">科林·帕特里克·里德</em> </a> <em class="lm">。</em></p><p id="dbc3" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">您的数据已经过处理，并且您已经成功地改编了Colin的代码，在散景中创建了您自己的漂亮可视化效果，但是您希望传达比静态图像更多的信息。你来对地方了！</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="4cdf" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">初始设置</strong> <br/>我们将从这个已经<a class="ae ln" href="https://github.com/mthomp12/mthomp12.github.io/blob/master/assets/images/divvy_data.csv" rel="noopener ugc nofollow" target="_blank">处理过的数据</a>开始，该数据结合了自行车租赁数据和芝加哥历史日平均气温以及以下代码:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div></figure><p id="b018" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这将生成以下静态图像:</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/fcab82b08ff779c38e798ff8ed81662f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*N0s8ViRxCSE0gmMVFXaKZg.png"/></div><p class="km kn gj gh gi ko kp bd b be z dk translated">作者图片</p></figure><p id="b204" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">添加动画<br/> </strong>要创建一个动画图形，我们需要添加一个周期性回调函数，在指定的时间过后更新数据。为此，代码需要引用从Python脚本自动创建的JavaScript文档。因此，我们需要更新到<em class="lm"> curdoc()，而不是使用<em class="lm"> show(p) </em>来显示我们的代码。add_root(列(p)) </em>。注意我们需要确保从bokeh.plotting导入<em class="lm"> curdoc </em>并从bokeh.layouts导入<em class="lm">列</em>。这一改变要求脚本从命令行运行，这将在下面进一步解释。</p><p id="837e" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">该数据集中的每一行代表从给定自行车站租赁的自行车数量，根据平均温度(四舍五入到最接近的5°F)计算这些天的平均值。每次更新都将数据刷新到下一个5 F时段，从30 F到80 F。图表数据存储在字典中，包含x和y坐标以及圆的大小。每次回调都会更新字典，以获得代表下一个温度桶的新圆圈尺寸。为了进行更新，将散景圆对象存储在一个变量中，然后用更新的数据字典更新<em class="lm">variable _ name . data _ source . data</em>。</p><p id="3bc6" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">平滑和调步<br/> </strong>数据被分组到5°F的桶中，以确保每个温度都有足够数量的数据点，并使总体趋势更容易解释。如果我们直接从一个温度区间过渡到下一个温度区间，动画会非常不连贯，很难从图表中获得洞察力。为了平滑动画，每一帧都会插入自行车租赁的数量以及上一桶和下一桶之间的温度(四舍五入到最接近的度数)。</p><p id="bfd7" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我发现每桶20帧会产生平滑的动画。这相当于每度4帧(每5f 20帧=每1f 4帧)。每80毫秒刷新一次数据会导致每个温度显示0.32秒(0.08秒* 4帧)，总运行时间为16秒(0.32 * 50个温度)。</p><p id="c3d3" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">附加代码:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div><p class="km kn gj gh gi ko kp bd b be z dk translated">完整的代码可以在这里找到<a class="ae ln" href="https://github.com/mthomp12/Animated_Bike_Graph/blob/master/AnimatedGraph.py" rel="noopener ugc nofollow" target="_blank">。</a></p></figure><p id="fe08" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">创建GIF <br/> </strong>添加回调函数并通过<em class="lm"> curdoc </em>方法调用图形足以创建一个将在您的浏览器中的localhost上运行的动画图形，但是如果您想要创建一个动画文件(可能包括在PowerPoint演示文稿中)，那么您将需要创建一个. GIF文件。</p><p id="86b3" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">要创建gif，通过bokeh.io中的<em class="lm"> export_png </em>方法将动画的每一帧保存到一个. png文件中(参见上面的代码)。然后使用imageio库中的<em class="lm"> imread </em>函数从png文件创建gif:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div></figure><p id="3585" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">注意:我建议在保存任何png文件之前，完成你的散景服务器代码(包括平滑和调步)。保存所有的png文件比生成服务器要花更多的时间，所以对服务器进行错误检查比对生成的gif进行错误检查要快得多。</p><p id="83d6" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir"> Bokeh服务器vs GIF运行时</strong> <br/>观察力敏锐的读者可能注意到了，我计算出GIF有16秒长，但本文开头的动画实际上运行了20秒。为什么会有差异？从这段代码创建的散景服务器确实运行了16秒，但是我没有在从png文件创建gif的代码中指定帧率。默认值为每秒10帧(fps)，而在Bokeh服务器代码中使用的是每秒12.5帧(1帧/80毫秒回调周期)，这解释了gif的20秒运行时间(gif中的12.5 fps/Bokeh服务器中的10 fps * 16秒)。</p><p id="e678" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">如果散景服务器的速度与生成的gif不同，请记住这一点。您可以通过fps参数在<em class="lm"> mimsave </em>函数中指定所需的帧速率，或者将周期性回调刷新率设置为100毫秒(相当于<em class="lm"> mimsave </em>的默认值10 fps)。</p><p id="f7bf" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">运行您的代码<br/> </strong>静态图像可以直接从您的IDE中运行，但是如前所述，<em class="lm"> curdoc </em>方法需要从命令行中运行，这<a class="ae ln" href="https://docs.bokeh.org/en/latest/docs/user_guide/server.html#userguide-server-applications" rel="noopener ugc nofollow" target="_blank">使散景</a>能够在每次浏览器连接到服务器时创建一个新的绘图。若要运行代码，请从命令提示符运行以下代码:</p><p id="58cf" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><em class="lm">散景服务-显示AnimatedGraph.py </em></p><p id="0cec" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">注意，我使用Python的Anaconda发行版，所以我实际上使用Anaconda提示符来运行这个命令。从您的计算机执行该命令可能需要一些额外的配置。</p><p id="5c29" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">结果<br/> </strong>制作图形动画的额外努力值得吗？我认为是的，因为它让我从数据中发现了我可能没有的洞察力，并以一种非常容易理解的方式来说明它。</p><p id="236a" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">您可能注意到，一旦温度达到大约55°f，标记的湖岸位置的需求就会激增。这非常有意义，因为天气温暖时人们更有可能去海滩，但我不确定如果没有动画可视化，我是否会意识到这一点。我可能认为这些目的地总体上更受欢迎，就像河流南支以西的地方(芝加哥读者会认为这是来自郊区的通勤列车)，与温度有线性关系。</p><p id="4c2e" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">根据这一认识，我能够证明这些湖岸位置的需求随温度呈二次方增长，而其他位置则呈线性增长:</p><div class="kf kg kh ki gt ab cb"><figure class="ly kj lz ma mb mc md paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/e9394619e4f802f47f8210061648ec16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1-XcA_LmHunC7tatr8jeIA.png"/></div></figure><figure class="ly kj lz ma mb mc md paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><img src="../Images/deaf04780ae12b20b0e2ed389ec9bc56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*NreM5QpypQ8KZ4OLetbQTA.png"/></div><p class="km kn gj gh gi ko kp bd b be z dk mi di mj mk translated">作者图片</p></figure></div><p id="5153" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这是有用的信息，因为它表明估计海滩位置的需求可能应该使用不同于其他位置的模型，这可以改进补货策略。</p></div></div>    
</body>
</html>