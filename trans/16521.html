<html>
<head>
<title>GitHub Actions For the Win</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GitHub为胜利而行动</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/github-actions-for-the-win-8a215d390c1b?source=collection_archive---------30-----------------------#2020-11-14">https://towardsdatascience.com/github-actions-for-the-win-8a215d390c1b?source=collection_archive---------30-----------------------#2020-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3378" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用GitHub Actions进行持续集成轻而易举</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6b57f7b3b2aeeeefa24d9e7debf5a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aOz07v2-6DV_GO1l"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">威廉·冈克尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="dca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你用GitHub做版本控制吗？你喜欢测试你的代码吗？对许多人来说，问题1的答案是肯定的，每个人都应该对问题2做出肯定的回答。很好，现在我们在同一页上，让我们来谈谈GitHub的行动。</p><p id="767c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub Actions是一个自动化工作流的框架。工作流在YAML创建，并在GitHub存储库上自动运行。下面的链接很好地概述了GitHub的动作。</p><div class="lv lw gp gr lx ly"><a href="https://docs.github.com/en/free-pro-team@latest/actions" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">GitHub操作</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">使用GitHub Actions在您的存储库中自动化、定制和执行您的软件开发工作流。你…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">docs.github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="0081" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的文档很好地介绍了GitHub动作和工作流文件语法。本文介绍了几个基本的工作流，用于在GitHub项目上添加持续集成。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7152" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><strong class="ak">入门</strong></h1><p id="746e" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">第一个例子涵盖了py27hash存储库中的一个工作流。</p><div class="lv lw gp gr lx ly"><a href="https://github.com/neuml/py27hash" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">neuml/py27hash</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">对于依赖于旧的散列/迭代顺序的应用程序，这个包有助于简化从Python 2到3的迁移…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="nr l mj mk ml mh mm ks ly"/></div></div></a></div><p id="adde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的GitHub库都准备好了GitHub动作。下面的截图显示了GitHub Actions工作流的位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/49245de2c203b92a38ef9ccc2abc3160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BaqzXltGwcqjftcxoHXERg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub操作选项卡</p></figure><p id="1220" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub将自动运行存储在<em class="nt">中的任何工作流文件。github/workflows </em>目录。例如，py27hash存储库有一个名为<em class="nt"> build.yml </em>的工作流文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/506271491c1b3ccde6c2adef73b67c23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mKLPSXv2We5RDd16kW8__A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">下的build.yml文件。github/工作流文件夹</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="2fbc" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">工作流文件</h1><p id="308a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">下面的代码片段显示了存储在py27hash存储库中的build.yml工作流文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="18ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个构建文件运行在推和拉请求上。该工作流在Ubuntu Linux虚拟机上运行，检查代码并运行一系列Python单元测试。如果这些都成功了，那么测试覆盖率就被发送到了。</p><p id="3ea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们回顾一下下面的语法(记得查看<a class="ae ky" href="https://docs.github.com/en/free-pro-team@latest/actions" rel="noopener ugc nofollow" target="_blank">https://docs.github.com/en/free-pro-team@latest/actions</a>以获得更详细的工作流文档)。</p><p id="7226" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置工作流名称。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="3800" class="oc mv it ny b gy od oe l of og">name<strong class="ny iu">: </strong>build</span></pre><p id="32d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置触发工作流的操作。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="5d4a" class="oc mv it ny b gy od oe l of og">on: ["push", "pull_request"]</span></pre><p id="3772" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置虚拟环境。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="0121" class="oc mv it ny b gy od oe l of og">jobs:<br/>  build:<br/>    runs-on: ubuntu-latest</span></pre><p id="d5e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">准备构建环境。下面的步骤从GitHub中签出代码，并为测试设置Python 3.6运行时环境。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="f9c2" class="oc mv it ny b gy od oe l of og">steps:                             <br/>  - uses: actions/checkout@v2                             <br/>  - uses: actions/setup-python@v2                              <br/>    with: <br/>      python-version: 3.6</span></pre><p id="2950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装依赖项并运行测试。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="c3a5" class="oc mv it ny b gy od oe l of og">- name: Build                               <br/>  run: |                                 <br/>    pip install -U pip wheel coverage coveralls           <br/>    python --version                                 <br/>    ./scripts/tests.sh skipslow</span></pre><p id="424a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果测试成功，发送测试覆盖报告给工作服。注意最后一行，<em class="nt">秘密。GITHUB_TOKEN </em>，这是一个内置的，当提交到工作服时验证当前用户。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="75e9" class="oc mv it ny b gy od oe l of og">- name: Test Coverage                               <br/>  run: coveralls                               <br/>    env:<br/>      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}</span></pre><p id="3e2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是GitHub的另一个优势，我们不需要授权外部服务访问我们的GitHub库。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="91b3" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">查看工作流状态</h1><p id="6f37" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">下面显示了“操作”标签中的工作流状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/04f9a3072225026d0696ffd7a6fffad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2uxwsBjgxkyKZiwgZKPgyw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">py27hash的GitHub操作选项卡</p></figure><p id="b563" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，对py27hash存储库的两次提交触发了build.yml工作流。每次运行的详细信息可以通过单击运行找到。下面是一个例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/b1f37399b06d4f7b79b9d7f4b45ddef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NcMqGE2NaHCN3UzefKIIaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub操作工作流运行详细信息</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="6f41" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><strong class="ak">多种环境</strong></h1><p id="72d3" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果我们的项目支持多个平台或版本会怎样？没问题，GitHub Actions已经处理好了。接下来，我们将回顾作为txtai存储库一部分的工作流文件。</p><div class="lv lw gp gr lx ly"><a href="https://github.com/neuml/txtai" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">neuml/txtai</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">txtai在文本部分建立了一个人工智能索引。txtai支持构建文本索引来执行相似性…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="oj l mj mk ml mh mm ks ly"/></div></div></a></div><p id="5a8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建工作流文件如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="4f21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再次回顾一下工作流语法，只包括这个文件中的新项目。</p><p id="a6b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置多个环境是通过构建矩阵建立的。下面的配置为Ubuntu、macOS和Windows建立了构建环境。同样的方法也可以用来测试Python的多个版本。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="aa35" class="oc mv it ny b gy od oe l of og">jobs:                         <br/>  build:                           <br/>    runs-on: ${{ matrix.os }}                           <br/>    strategy:                             <br/>      matrix:                               <br/>        os: [ubuntu-latest, macos-latest, windows-latest]</span></pre><p id="b349" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，每个环境都会运行工作流中的所有步骤。但是条件步骤也可以在每个环境中执行。以下步骤分别为macOS和Windows安装依赖项。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="f648" class="oc mv it ny b gy od oe l of og">- name: Install dependencies - MacOS                                 <br/>  run: brew install libomp                               <br/>  if: matrix.os == 'macos-latest'                                                   </span><span id="4271" class="oc mv it ny b gy ok oe l of og">- name: Install dependencies - Windows                                <br/>  run: python -m pip install torch==1.6.0+cpu torchvision==0.7.0+cpu -f https://download.pytorch.org/whl/torch_stable.html                               <br/>  if: matrix.os == 'windows-latest'</span></pre><p id="fc54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其余步骤同上。唯一的例外是测试覆盖只针对单一环境(Ubuntu)。</p><p id="a52c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，将为每个环境创建一个单独的工作流状态部分。只有在所有环境中都成功的情况下，构建才是成功的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/54249e38a5688277ca026adc55c4c9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*dykH46Gh97TdR_1a8ISJJw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多个构建环境</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="6628" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结论</h1><p id="ef8b" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">本文给出了GitHub动作的一个非常简短的概述，涵盖了自动化测试的几个基本工作流程。有大量的附加功能可以自动执行部署、标记和其他操作。</p><p id="3131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与外部构建系统相比，它的性能非常好，并且是一种更简单、更安全的运行持续集成的方式。试一试吧，它一定不会让人失望的！</p></div></div>    
</body>
</html>