<html>
<head>
<title>Animations of Multiple Linear Regression with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python制作多元线性回归动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/animations-of-multiple-linear-regression-with-python-73010a4d7b11?source=collection_archive---------32-----------------------#2020-10-07">https://towardsdatascience.com/animations-of-multiple-linear-regression-with-python-73010a4d7b11?source=collection_archive---------32-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="08e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们的目标是扩展我们的能力，可视化梯度下降到多元线性回归。这是《<a class="ae ko" rel="noopener" target="_blank" href="/gradient-descent-animation-1-simple-linear-regression-e49315b24672?source=your_stories_page---------------------------">渐变下降动画》的后续文章:1。简单线性回归</a>”。正如我们之前所做的，我们的目标是建立一个模型，使用批量梯度下降将模型拟合到我们的训练数据，同时存储每个时期的参数值。之后，我们可以使用我们存储的数据，通过Python的<a class="ae ko" href="https://pypi.org/project/celluloid/" rel="noopener ugc nofollow" target="_blank">赛璐珞</a>模块来创建动画。</p><p id="b8b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kp">这是我在7月20日上传的一篇关于同一主题的文章的修订版。主要改进包括封面照片和一些动画。</em></p><h1 id="e255" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">建立模型</h1><p id="de86" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">多元线性回归是简单线性回归的扩展版本，其中多个预测变量<em class="kp"> X </em>用于预测单个因变量<em class="kp"> Y </em>。对于<em class="kp"> n个</em>预测变量，这可以用数学方法表示为</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/565ff6f5d9cfabedc53912c6f618efb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*JBNejdH9B2rtueiZuGFKYw.png"/></div></figure><p id="602d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/7f8c56f83d38d558811af74518ef55c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*h02VjOVj5bdcqZ5dxkZ47g.png"/></div></figure><p id="15cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而<em class="kp"> b </em>代表我们回归平面的y截距(“偏差”)。我们的目标是找到使训练数据点和超平面之间的均方距离最小化的超平面。梯度下降使我们能够确定我们的模型参数<em class="kp"> θ </em>的最佳值，包括我们的权重<em class="kp"> w </em>和我们的偏差项<em class="kp"> b </em>，以最小化观测数据点<em class="kp"> y </em>和我们用回归模型<em class="kp">预测的数据点【ŷ).</em>在训练期间，我们的目标是根据以下公式更新我们的参数值，直到我们达到收敛:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/dac01d41244c383efe9d99f3667b903b.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*nQrFm8AY8yt1xCdUgIKI5Q.png"/></div></figure><p id="2716" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其中∇ <em class="kp"> J(θ) </em>表示我们的成本函数<em class="kp"> J </em>相对于我们的模型参数<em class="kp"> θ的梯度。</em>学习率用<em class="kp"> α </em>表示。每个权重的偏导数和偏差项与我们的<a class="ae ko" rel="noopener" target="_blank" href="/gradient-descent-animation-1-simple-linear-regression-e49315b24672?source=your_stories_page---------------------------">简单线性回归模型</a>中的相同。然而，这一次，我们想要建立一个(多元)线性回归模型，它对预测变量的数量是灵活的，并引入一个权重矩阵来同时调整所有权重。此外，我们在拟合过程中直接将参数值存储在数组中，这在计算上比我们在上一篇文章中使用for循环和列表要快。我决定将权重的初始参数值设置为3，将偏差的初始参数值设置为-1。在Python中，我们导入一些库并建立我们的模型:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="f26b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们打算让我们的模型适应一些任意的训练数据。虽然我们的模型理论上可以处理任何数量的预测变量，但我选择了一个具有两个预测变量的训练数据集。我们有意使用一个特别小的学习率，<em class="kp"> α </em> =0.001，以避免动画中过大的步长。由于本文关注的是动画而不是统计推断，我们简单地忽略了线性回归的假设(例如，不存在多重共线性等。)目前来说。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="9002" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了确保我们拟合的参数收敛到它们的真实值，我们使用<a class="ae ko" href="https://scikit-learn.org/0.20/modules/generated/sklearn.linear_model.LinearRegression.html" rel="noopener ugc nofollow" target="_blank"> sklearn的先天线性回归模型</a>来验证我们的结果:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="e990" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们终于可以创作出我们的第一部动画了。像以前一样，我们希望从可视化值开始，我们的成本函数和参数在绘制3-D中的相应回归平面时相对于时期呈现。如前所述，我们打算只绘制选定时期的值，因为最大的步长通常在梯度下降开始时观察到。在每个for循环之后，我们对我们的绘图进行快照。通过<a class="ae ko" href="https://pypi.org/project/celluloid/" rel="noopener ugc nofollow" target="_blank">相机的动画功能</a>，我们可以将快照变成动画。为了获得所需的回归平面，我们通过<a class="ae ko" href="https://numpy.org/doc/stable/reference/generated/numpy.meshgrid.html" rel="noopener ugc nofollow" target="_blank"> numpy.meshgrid </a>引入一个坐标网格(M1，M2)，并定义一个函数“pred_meshgrid()”来计算在某个时期与模型参数相关的相应z值。下面动画中看到的虚连接线可以通过训练数据点和预测点之间的线图获得。通过返回最终的参数值(参见注释掉的代码！)我们在我们的动画中获得，我们确保我们粗略地可视化了模型收敛，尽管没有使用我们在拟合过程中存储的参数值的全部范围。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/91d88f98134eb7dd6f9af150aaeb617c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AFGGAF1vlM9j1-hqRn8o5g.gif"/></div></div></figure><p id="53d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管很简单，但分别绘制每个时期的参数值实际上是可视化具有两个以上模型参数的梯度下降的最具信息量和最现实的方式。这是因为我们只能以这种方式同时见证成本和所有模型参数的变化。</p><h1 id="a8d7" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">固定截距模型:</h1><p id="1069" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">当创建更复杂的渐变下降动画时，特别是在3d中，我们必须关注两个模型参数，同时保持第三个参数“固定”。我们通常对多重线性回归模型的权重比偏差项更感兴趣。为了直观显示成本如何随着我们调整后的权重(w₀、w₁)稳步下降，我们必须建立一个新的线性回归模型，其中偏差项<em class="kp"> b </em>是固定的。这可以通过将<em class="kp"> b </em>的初始值设置为预定义值<em class="kp"> b_fixed </em>并删除新模型中更新<em class="kp"> b </em>的代码部分来轻松完成。<em class="kp"> b_fixed </em>可以取任何值。在这种情况下，我们只是将它设置为前一个模型收敛到的y截距值:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="3905" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在用我们的新模型积累新数据后，我们再次为下面的动画创建另一个坐标网格(N1，N2)。这个坐标网格使我们能够在给定的数字范围内，为每一对可能的w₀和w₁绘制成本图。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><h2 id="83ff" class="mk kr it bd ks ml mm dn kw mn mo dp la kb mp mq le kf mr ms li kj mt mu lm mv bi translated">等值线图表</h2><p id="75e4" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">等高线图允许我们通过等高线和填充等高线在二维平面上可视化三维表面。在我们的例子中，我们希望将w₀和w₁分别绘制在x轴和y轴上，成本<em class="kp"> J </em>作为等高线。我们可以用<a class="ae ko" href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.contour.html" rel="noopener ugc nofollow" target="_blank"> Matplotlib的轮廓函数</a>标记图形中的特定轮廓级别。因为我们知道我们的最终成本大约是76，我们可以设置我们的最后轮廓水平为80。</p><p id="bbc4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当y轴截距允许变化时，我们看到了参数值和成本随后期的显著变化，这是我们不想在回归和参数图中遗漏的。然而，随着<em class="kp"> b </em>被固定，大部分“动作”似乎被限制在前400个纪元。因此，我们将我们打算在下面的动画中可视化的时期限制为400，这在计算上花费较少，并且产生更吸引人的动画。为了证实这种印象，我们可以将最终参数值(100，000个时期后返回的固定截距模型)与400个时期后获得的参数值进行比较(参见下面注释掉的代码！).因为参数值和成本值通常是匹配的，尽管限制了被可视化的时期的数量，我们还是可视化了模型收敛，这是公平的。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/e6e4f0d5fed9256deb7db8e419112ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*j171iCmPHKmiYz_tbHBPXg.gif"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">动画回归平面和等高线图(<a class="ae ko" href="https://s1.gifyu.com/images/MultiLinReg_2_large.gif" rel="noopener ugc nofollow" target="_blank">大</a>)</p></figure><h2 id="7866" class="mk kr it bd ks ml mm dn kw mn mo dp la kb mp mq le kf mr ms li kj mt mu lm mv bi translated">表面图</h2><p id="a006" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">对于最后一个图，我们希望包含与等高线图相同的时期。然而，这一次，我们希望使用曲面图在三维空间中可视化梯度下降。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="md me l"/></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/b1375ef0bfe1c93c084a7fa1337e211c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xFr8is01v7M9LHNgThTq8g.gif"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">动画回归平面和曲面图(<a class="ae ko" href="https://s1.gifyu.com/images/MultiLinReg_3_Large.gif" rel="noopener ugc nofollow" target="_blank">大</a>)</p></figure><p id="f490" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">理论上，在x-y平面上绘制梯度下降的轨迹——就像我们绘制等高线图一样——对应于梯度下降的“真实”轨迹。与上面的曲面图相反，梯度下降实际上根本不涉及z方向的移动，因为只有参数可以自由变化。更深入的解释见<a class="ae ko" href="https://blog.paperspace.com/intro-to-optimization-in-deep-learning-gradient-descent/amp/" rel="noopener ugc nofollow" target="_blank">此处</a>。最后，我想指出用赛璐珞制作动画是非常耗时的。尤其是涉及曲面出图的动画可能需要40分钟才能返回所需的结果。尽管如此，我还是更喜欢赛璐珞，因为它简单明了。一如既往，创造性的投入和建设性的批评是赞赏！</p><p id="d3b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望这篇文章对你有所帮助。如果有任何问题或者你发现了任何错误，请随时发表评论。在本系列的下一篇文章中，我将致力于以逻辑回归为例的梯度下降动画。完整的笔记本可以在我的<a class="ae ko" href="https://github.com/BundleOfKent/MultipleLinearRegression" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="89d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的关注！</p><p id="617a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">参考文献</strong>:</p><div class="na nb gp gr nc nd"><a href="https://blog.paperspace.com/intro-to-optimization-in-deep-learning-gradient-descent/amp/" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd iu gy z fp ni fr fs nj fu fw is bi translated">深度学习中的优化介绍:梯度下降</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">图片来源:奥莱利媒体深度学习，在很大程度上，真的是关于解决大规模讨厌的优化…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">blog.paperspace.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr lz nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a href="https://en.wikipedia.org/wiki/Linear_regression#Simple_and_multiple_linear_regression" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd iu gy z fp ni fr fs nj fu fw is bi translated">线性回归</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">在统计学中，线性回归是一种建模标量响应(或变量)之间关系的线性方法</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">en.wikipedia.org</p></div></div><div class="nm l"><div class="ns l no np nq nm nr lz nd"/></div></div></a></div><p id="b311" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">附录</strong>:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f05d4341de13f301148300a6448634d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/1*o_ZrNQXcd9sUEqfSRti8LQ.gif"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">缩小版(特色图片)</p></figure></div></div>    
</body>
</html>