<html>
<head>
<title>Monitoring your BigQuery costs and reports usage with Data Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Data Studio监控您的BigQuery成本并报告使用情况</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monitoring-your-bigquery-costs-and-reports-usage-with-data-studio-b77819ffd9fa?source=collection_archive---------3-----------------------#2020-09-23">https://towardsdatascience.com/monitoring-your-bigquery-costs-and-reports-usage-with-data-studio-b77819ffd9fa?source=collection_archive---------3-----------------------#2020-09-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="964b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单有效的仪表板。具有实际的报告名称、用户和标签。包含方便的模板</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4a0f47da81eab60ed64e587226c9c41d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9z7v4OAJYNQhfDnIaAk1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">BigQuery和Data Studio成本监控仪表板。(<em class="ky">图片作者</em>)</p></figure><p id="7a0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您是一个BigQuery用户，并且您使用Data Studio可视化您的数据，那么您可能想要回答以下<strong class="lb iu">问题</strong>:</p><ul class=""><li id="2171" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">昨天每个数据工作室报告的成本是多少？</li><li id="2e99" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每个查询/报告运行了多少次，由谁运行？</li><li id="7082" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">查询带有标签X的表、数据集(例如生产/暂存/分析)的成本是多少？</li><li id="b586" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果计费字节数突然激增，我能得到通知吗？</li></ul><p id="1914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">标准的谷歌计费仪表板不会回答这些问题。</p><blockquote class="mj"><p id="f132" class="mk ml it bd mm mn mo mp mq mr ms lu dk translated">根据谷歌官方文件，目前<strong class="ak">你不能</strong>为BigQuery工作使用标签。</p></blockquote><p id="4f73" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">在这里阅读更多:<a class="ae my" href="https://cloud.google.com/bigquery/docs/filtering-labels" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/filtering-labels</a></p><blockquote class="mj"><p id="2b80" class="mk ml it bd mm mn mo mp mq mr ms lu dk translated">但是，如果我们想知道到底是谁运行了这个查询，以及它花费了我们多少钱呢？</p></blockquote><p id="3015" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">在本文中，我将向您介绍设置BigQuery成本监控仪表板的完整过程。</p><p id="70d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用了谷歌数据工作室的标准谷歌广告模板。我觉得它看起来不错，我根据自己的需要稍微做了些改动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/5aacf4c8d8a7f7415afee8df89010c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t58SDXLZvX6reXeT.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(<em class="ky">图片作者</em>)</p></figure><p id="552d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你愿意，你可以复制<a class="ae my" href="https://datastudio.google.com/u/0/reporting/de01deda-04d8-4d74-a90e-5038e94ddd9c/page/FQ1YB/preview" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">模板</strong> </a> <strong class="lb iu"> </strong>，包括所有相关的设置和部件。如下面的<code class="fe na nb nc nd b">bq_cost_analysis.sql</code>所示，只需调整每个小工具的数据源(创建自己的数据源)</p><p id="b1cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">先决条件</strong>:</p><ul class=""><li id="bb67" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a> (GCP)账号</li><li id="bbe1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">BigQuery</li><li id="a935" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">数据工作室</li></ul><p id="1e8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将使用<a class="ae my" href="https://cloud.google.com/logging/docs/audit/" rel="noopener ugc nofollow" target="_blank">云审计日志</a>进行BigQuery。我们将使用这些事件数据，将其导出到BigQuery并进行分析。</p><blockquote class="mj"><p id="9bf9" class="mk ml it bd mm mn mo mp mq mr ms lu dk translated">Google推荐的最佳实践是使用<strong class="ak">基于自定义日志的指标</strong>。</p></blockquote><p id="83be" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">转到<a class="ae my" href="https://cloud.google.com/logging/docs/audit/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">记录</strong> </a>并创建一个<strong class="lb iu">接收器</strong>。点击阅读更多关于创建水槽的信息<a class="ae my" href="https://cloud.google.com/logging/docs/export/configure_export_v2" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/398cbc08372fd01b98a354360cffdb67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GX2xP3DN5sciMWrEq3yPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(<em class="ky">图片作者</em>)</p></figure><p id="8aa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将把来自<strong class="lb iu">云审计日志</strong>服务的所有BigQuery `query_job_completed `日志事件输出到您的BigQuery表中。</p><p id="56bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这种方式，您可以导出任何日志以供进一步分析，我发现这非常有用。</p><p id="dbd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，只会导出新日志，但是您也可以在<strong class="lb iu">日志控制台</strong>中过滤和缩小您正在调查的日志:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/43e81778ecd28a8bed4bc74e05dc1c1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jiY_m1EdeFvx6HzBuzHKxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">json输出。(<em class="ky">作者图片</em>)</p></figure><p id="62aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，现在当我有<strong class="lb iu"> BigQuery </strong>事件数据流入我的<code class="fe na nb nc nd b">logs</code>数据集时，我将基于我拥有的数据创建一个视图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/f1ae180b9ac1a3d61eeebdb664741590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2uMW-DYm_TCvtMkjui2dA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(<em class="ky">图片作者</em>)</p></figure><p id="f149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们需要计算大查询成本(每个查询或作业)的地方:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/03704c14229721d216d1162a73dd172c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BE7ghbyZYQT-0M2eMM7hqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TotalBilledBytes。(<em class="ky">图片作者</em>)</p></figure><p id="2ff8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以简单地乘以:<code class="fe na nb nc nd b">cost per TB processed</code> * <code class="fe na nb nc nd b">numbers of TB processed</code>。</p><h2 id="0fc3" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">数据源</h2><p id="e18b" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">这是一个自定义查询<code class="fe na nb nc nd b">bq_cost_analysis.sql:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="3e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经将<code class="fe na nb nc nd b">processedBytes</code>与相关的<code class="fe na nb nc nd b">cost per user</code>和<code class="fe na nb nc nd b">per query</code>很好地组合在一起:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/350ab409fa3b821c97c6b6fcdecf1f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0tEC6Q5dcM4YxX9iFM2dA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">BigQuery结果。(<em class="ky">图片作者</em>)</p></figure><p id="af9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能注意到我在<code class="fe na nb nc nd b">bq_cost_analysis.sql</code>中添加了一个<strong class="lb iu">查询标签</strong></p><blockquote class="mj"><p id="2034" class="mk ml it bd mm mn mo mp mq mr ms lu dk translated">这是一个小技巧，将有助于<strong class="ak">成本分组</strong>，并让我们使用实际的标签(目前不支持)。</p></blockquote><p id="16b0" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">只需调整SQL并为您<code class="fe na nb nc nd b">tagged</code>查询添加一列。它可以是任何东西，数据工作室中的一个<strong class="lb iu">报告</strong>，表名<strong class="lb iu">或者一个<strong class="lb iu">预定查询</strong>:</strong></p><pre class="kj kk kl km gt oj nd ok ol aw om bi"><span id="bd5a" class="ni nj it nd b gy on oo l op oq"><strong class="nd iu">substr(</strong>protopayload_auditlog.servicedata_v1_bigquery.jobCompletedEvent.job.jobConfiguration.query.query,0,30<strong class="nd iu">) as report</strong></span></pre><p id="b5ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者类似这样的事情可能会更好:</p><pre class="kj kk kl km gt oj nd ok ol aw om bi"><span id="e705" class="ni nj it nd b gy on oo l op oq">select REGEXP_EXTRACT(‘ --tag: some report — tag ends/’, r’--tag: (.*) - tag ends/’) <strong class="nd iu">as report</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4ffd4e7721d83c21878655513cdd0e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9wqXJ6kZabh5OSGd-oCLUg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Data Studio / BigQuery每个用户/报告的成本。(<em class="ky">图片作者</em>)</p></figure><p id="89df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，您也可以通过查询来汇总成本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/22b63894ba0d5023b9efc3e2b833e700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W8KH-wpO2G8dfuwAUdf3dg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Data Studio中每次查询的成本。(<em class="ky">图片作者</em>)</p></figure><p id="dda7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将底部的表格设置为每页只显示<em class="ot">一条记录</em> ( <em class="ot">一个查询</em>)，这将使查询成本分析变得非常简单。</p><blockquote class="mj"><p id="9211" class="mk ml it bd mm mn mo mp mq mr ms lu dk translated">添加小时和分钟的滑块也非常有用。</p></blockquote><p id="bcb6" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">另一件有趣的事。<strong class="lb iu">缓存</strong>。如果您想省钱，您应该在Data Studio报告中启用<strong class="lb iu">预取缓存</strong>，您必须使用<code class="fe na nb nc nd b">owner's credentials</code>并启用缓存选项(数据新鲜度)。在这里阅读更多关于缓存的信息:<a class="ae my" href="https://cloud.google.com/bigquery/docs/cached-results" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/cached-results</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/23991e996f5ec66f14b81e713a0ed8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1gi7M1y8yASfdFdCYvsxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Data Studio预取缓存。(<em class="ky">图片作者</em>)</p></figure><p id="55ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，如果您与任何其他用户共享对您的报告的访问权限，他们将使用您的凭据来访问数据，您将在您的成本报告中看到的只是您的帐户名称。</p><blockquote class="mj"><p id="ff92" class="mk ml it bd mm mn mo mp mq mr ms lu dk translated">如果你想为你的成本报告启用其他用户，你应该使用<code class="fe na nb nc nd b">Viewer's credentials</code>并授予他们访问底层数据集的权限。</p></blockquote><p id="e557" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li mv lk ll lm mw lo lp lq mx ls lt lu im bi translated">我发现这真的很烦人，但这就是Data Studio的工作方式。</p><p id="bc4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里阅读更多谷歌官方文档:<a class="ae my" href="https://developers.google.com/datastudio/solution/blocks/enforce-viewer-creds" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/data studio/solution/blocks/enforce-viewer-creds</a>。</p><h2 id="6492" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">为各个Data Studio用户创建角色</h2><p id="e939" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">如果您在Data Studio中使用查看者凭据，您将需要它。</p><p id="8ac5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们转到<a class="ae my" href="https://console.cloud.google.com/iam-admin/iam" rel="noopener ugc nofollow" target="_blank"> IAM </a>角色，并创建名为<strong class="lb iu"> Data Studio用户的角色。为此，我们需要对数据集中的<code class="fe na nb nc nd b">view</code>和<code class="fe na nb nc nd b">list</code>表的权限。您可以简单地添加预定义的<strong class="lb iu"> BigQuery数据查看器</strong>角色。</strong></p><p id="33d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于来自<strong class="lb iu"> <em class="ot"> Data Studio </em> </strong>的<code class="fe na nb nc nd b">run</code>报告，我们还需要添加<strong class="lb iu"> bigquery.jobs.create </strong>权限的<strong class="lb iu"> BigQuery作业用户</strong>角色。<br/>在这里阅读更多关于预定义角色的信息:<a class="ae my" href="https://cloud.google.com/bigquery/docs/access-control" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/access-control</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/8b748f765a133930e8615ef09f93ad70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRP34NkHj8_PHR39NoFUWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建Data Studio用户角色。(<em class="ky">图片作者</em>)</p></figure><p id="e9d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以将这个角色分配给任何用户，让他们在<strong class="lb iu"> Data Studio </strong>中使用<strong class="lb iu">查看者的凭证</strong>。只需点击数据集名称，然后点击<strong class="lb iu">共享数据集。当只授予最小范围的权限时，这符合Google最佳安全实践。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/6476167b3d29c61b08cb68f2be460293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUCI1OyRFWP0fGVwoLMp7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">授予权限。(<em class="ky">图片作者</em>)</p></figure><h1 id="f1d3" class="ox nj it bd nk oy oz pa nn pb pc pd nq jz pe ka nt kc pf kd nw kf pg kg nz ph bi translated">创建计费预警</h1><p id="4bb6" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">我还希望在计费字节数突然激增时得到通知。</p><p id="3c82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建此<code class="fe na nb nc nd b">Alert</code>，首先进入<a class="ae my" href="https://console.cloud.google.com/monitoring/dashboards" rel="noopener ugc nofollow" target="_blank">仪表盘</a>，点击<strong class="lb iu">添加图表</strong>并选择<strong class="lb iu">扫描字节计费</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/4e5cd4f9a8d90994337b4266a55832bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hm3hDAbHxGraJtF61_5qGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正在为BilledBytes创建BigQuery使用率警报。(<em class="ky">图片作者</em>)</p></figure><p id="dfc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择<em class="ot">聚合器</em>和<em class="ot">对准器</em>到<strong class="lb iu">求和</strong>。一个<strong class="lb iu">聚合器</strong>描述了如何在多个时间序列上聚合数据点<strong class="lb iu">，以及在<strong class="lb iu">分组中使用标签的情况下使用</strong>。<strong class="lb iu">对齐器</strong>描述如何将每个单独时间序列中的数据点放入相等的时间段。阅读更多关于<a class="ae my" href="https://cloud.google.com/monitoring/api/ref_v3/rest/v3/projects.alertPolicies?_ga=2.148405559.-181916626.1572688026#Aligner" rel="noopener ugc nofollow" target="_blank">校准器</a>的信息。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/b3246de3e6f336722d7306ebea503578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvwzxokuGgjoBABh6pc8cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置对准器和协议器。(<em class="ky">作者图片</em>)</p></figure><h1 id="ae31" class="ox nj it bd nk oy oz pa nn pb pc pd nq jz pe ka nt kc pf kd nw kf pg kg nz ph bi translated">创建警报策略</h1><p id="eac2" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">现在让我们转到Google <a class="ae my" href="https://console.cloud.google.com/monitoring/alerting" rel="noopener ugc nofollow" target="_blank">警报</a>并创建一个策略:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/abe39eaa541af5dbdc0d93683e223ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXKvcrWkqMLezwPGnpdOIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置警报策略。(<em class="ky">图片作者</em>)</p></figure><p id="9b74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们称之为<strong class="lb iu">“过去15分钟计费字节数超过1Gb”</strong>，这样，在任何15分钟窗口内，每当计费字节总数超过1Gb时，我们都会收到警报:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/7d6e66083a7770f9c923a623fffbd56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zeAVi4ZiPXUdR1ariOj3GQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">警报策略。(<em class="ky">图片作者</em>)</p></figure><p id="11cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们运行任何查询(包括Data Studio报告),并且在过去15分钟内<strong class="lb iu">总计费字节数</strong>的总和超过阈值，系统将会通知我们。</p><p id="bb1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们运行一个超过这个阈值的查询，看看是否可行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/8eb2027fc731327bf3fed6fe743b8d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOpKR2PD1U7dl_9Ho6jSYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试。(<em class="ky">图片作者</em>)</p></figure><p id="d837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会收到一封电子邮件提醒。成功了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/abc3f6083a6d59261440226fe3cd254e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZ-S0jdy2qgYCIx3u8eSEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌快讯。(<em class="ky">图片作者</em>)</p></figure><p id="8a9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您也可以以类似的方式为正在使用的<strong class="lb iu">插槽数量</strong>和<strong class="lb iu">查询执行</strong>时间设置警报。</p><p id="a8d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里阅读更多:<a class="ae my" href="https://cloud.google.com/monitoring/alerts/using-alerting-ui#create-policy" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/monitoring/alerts/using-alerting-ui # create-policy</a></p><h1 id="4570" class="ox nj it bd nk oy oz pa nn pb pc pd nq jz pe ka nt kc pf kd nw kf pg kg nz ph bi translated">就是这样！</h1><p id="cb44" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">现在，您有了一个漂亮的成本监控仪表板，可以在其中看到与每个Data Studio报告相关联的BigQuery成本，使您可以在Google Cloud Billing中更深入地了解基本数据集级别的报告。</p><p id="10e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读，如果您有任何问题，请告诉我。</p><h1 id="3780" class="ox nj it bd nk oy oz pa nn pb pc pd nq jz pe ka nt kc pf kd nw kf pg kg nz ph bi translated">推荐阅读:</h1><ul class=""><li id="8873" class="lv lw it lb b lc ob lf oc li po lm pp lq pq lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/blog/products/data-analytics/taking-a-practical-approach-to-bigquery-cost-monitoring" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/blog/products/data-analytics/taking-a-a-practical-approach-to-big query-cost-monitoring</a></li><li id="323f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/bigquery/docs/access-control?_ga=2.51607977.-181916626.1572688026" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/access-control?_ga=2.51607977。-1819168026</a></li><li id="1364" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/logging/docs/export" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/logging/docs/export</a></li><li id="5e85" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">https://cloud.google.com/bigquery/docs/monitoring<a class="ae my" href="https://cloud.google.com/bigquery/docs/monitoring" rel="noopener ugc nofollow" target="_blank"/></li><li id="ffe5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">【https://cloud.google.com/bigquery/docs/controlling-costs T4】</li><li id="b2b7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/bigquery/docs/best-practices-costs" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/best-practices-costs</a></li><li id="85ab" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://medium.com/google-cloud/visualize-gcp-billing-using-bigquery-and-data-studio-d3e695f90c08" rel="noopener">https://medium . com/Google-cloud/visualize-GCP-billing-using-big query-and-data-studio-d3e 695 f 90 c 08</a></li><li id="24bd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://support.google.com/cloud/answer/7233314?hl=en" rel="noopener ugc nofollow" target="_blank">https://support.google.com/cloud/answer/7233314?hl=en</a></li><li id="7597" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/billing/docs/how-to/export-data-bigquery-setup?hl=en" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/billing/docs/how-to/export-data-big query-setup？hl=en </a></li><li id="5c43" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae my" href="https://cloud.google.com/bigquery/docs/cached-results" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/cached-results</a></li></ul></div></div>    
</body>
</html>