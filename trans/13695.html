<html>
<head>
<title>Elegant Geographic plots in Python and R using GeoPandas and Leaflet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GeoPandas和传单的Python和R语言的优雅地理图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/elegant-geographic-plots-in-python-and-r-using-geopandas-and-leaflet-27126b60bace?source=collection_archive---------22-----------------------#2020-09-20">https://towardsdatascience.com/elegant-geographic-plots-in-python-and-r-using-geopandas-and-leaflet-27126b60bace?source=collection_archive---------22-----------------------#2020-09-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6b8e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用GeoPandas和传单？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/70e08a1f3a641f5a8be9beeb7f5c2fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mtuylI6mNfymXk4M"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@marjan_blan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">марьянблан| @ marjanblan</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4e4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几个地理库可用于在地图上绘制位置信息。我以前在这里写过相同的主题，但是从那以后，我更广泛地使用了这些库，并且了解了新的库。在使用和检查了几个库之后，我发现GeoPandas和Leaflet库是两个最容易使用和高度可定制的库。该代码可作为GitHub repo获得:</p><div class="lv lw gp gr lx ly"><a href="https://github.com/kb22/geo-plotting" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">kb22/地理绘图</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">这个库描述了使用Python中的GeoPandas和R中的Leaflet作为两种非常优雅(和简单)的绘图方式…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><h1 id="147c" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">资料组</h1><p id="7295" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">数据集取自<a class="ae ky" href="https://www.kaggle.com/walla2ae/world-population" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>。它包括世界各国的人口密度(每平方公里的人口数)。该数据集包括从1961年到2015年的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/9cc1fbd080255956e443cc2d46c81ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rhnw3Tayw5DiHIn4XAiRDg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料组</p></figure><p id="c124" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示，在读取数据集时，我们需要跳过前4行，所以我们直接从数据开始。像“1960”这样的列是空的，因此可以删除。此外，比利时等一些国家的数据缺失，因此我们将从收集中删除这些记录。</p><h1 id="5fbd" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">使用GeoPandas的静态图(Python语言)</h1><h2 id="9d48" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">导入库</h2><p id="469f" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">我们将导入库<code class="fe nx ny nz oa b">pandas</code>来读取数据集，然后使用<code class="fe nx ny nz oa b">geopandas</code>绘制地图。注意，为了删除不必要的警告，我添加了特定的命令。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="0137" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">导入数据集</h2><p id="839e" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">接下来，我们将导入数据集。如前所述，我跳过了前4行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="c054" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用<code class="fe nx ny nz oa b">drop()</code>的方法去掉所有多余的不需要的列(“指标名称”、“指标代码”、“1960”、“2016”、“未命名:61”)。我使用<code class="fe nx ny nz oa b">dropna()</code>删除所有具有空值的记录，最后计算1961年到2015年的平均人口密度，放入新列<code class="fe nx ny nz oa b">avgPopulationDensity</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/1d1ced9a89d8b24dbae86194fc68b063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rj5Tz0agfZ9LHexuTM2pLQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果数据集</p></figure><h2 id="a438" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">绘图数据</h2><p id="1208" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">我们首先直接从geopandas加载世界基图，然后将我们上面细化的数据集与这个基图数据合并。然后，我们简单地用<code class="fe nx ny nz oa b">avgPopulationDensity</code>列中的值绘制数据<code class="fe nx ny nz oa b">world</code>。我们在<code class="fe nx ny nz oa b">Reds</code>色图中给国家加阴影，这意味着平均人口密度较高的国家比其他国家更暗。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/617e69120110a481f906f9e566202d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSVrTriE8w0UkejoLpSz0g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平均人口密度图(使用GeoPandas)</p></figure><blockquote class="of og oh"><p id="d00d" class="kz la oi lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">我们可以清楚地看到，亚洲国家有更多的人口密度值，特别是印度，孟加拉国，韩国和日本。</p></blockquote><h1 id="e8c4" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">使用传单的互动情节(R)</h1><h2 id="4191" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">导入库</h2><p id="1491" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">我们将加载用于生成绘图的<code class="fe nx ny nz oa b">leaflet</code>库和用于读取shapefiles的<code class="fe nx ny nz oa b">sf</code>库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="9e6b" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">导入数据集</h2><p id="ad17" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">就像在Python中一样，我们跳过前4行导入数据集，删除多余的列，删除缺少值的行，并创建<code class="fe nx ny nz oa b">avgPopulationDensity</code>列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="82c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是，我们还要加载绘图所需的shapefile。因此，我们使用<code class="fe nx ny nz oa b">st_read</code>方法，将带有这个shapefile的数据集合并到一个名为<code class="fe nx ny nz oa b">shapes</code>的变量中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="7c0f" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">绘图数据</h2><p id="a80d" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在绘制数据之前，我们首先定义想要使用的调色板。我为不同的箱子定义了红色的阴影，基于此，我将对结果图进行着色。由于这是一个自定义调色板，它的颜色将不同于我们在GeoPandas图中看到的颜色。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="338a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们绘制传单geoplot。<code class="fe nx ny nz oa b">leaflet()</code>开始创建地图,<code class="fe nx ny nz oa b">addTiles()</code>添加国家地图。接下来，我们通过定义纬度和经度值以及缩放比例来设置地图视图，这样我们就可以一次看到整个地图。如果需要，我们可以更改这些值，但由于它是一个交互式地图，我们也可以动态地这样做。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="bd34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，基于<code class="fe nx ny nz oa b">avgPopulationDensity</code>列，我们对整个地块进行颜色分级，并附上国家名称作为标签。我们通过添加笔画(<code class="fe nx ny nz oa b">STROKE = TRUE</code>)来定制每个国家的外观，然后用<code class="fe nx ny nz oa b">weight = 1</code>将它们设置为<code class="fe nx ny nz oa b">black</code>，定义每个边界的宽度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/b3f0cacbf99c55a689717fd8da64761e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPtgWMhMItPTjcQ3jrSx_A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平均人口密度图(使用传单)</p></figure><blockquote class="of og oh"><p id="feba" class="kz la oi lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">我们观察到亚洲国家如印度、孟加拉国、中国、日本和其他国家的人口密度比其他国家高。</p></blockquote><h1 id="824d" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">结论</h1><p id="b527" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">从上面的两个例子中，我们可以看到创建漂亮的静态和动态地理图是多么容易。此外，我们还可以添加大量定制内容。</p></div><div class="ab cl on oo hx op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="im in io ip iq"><p id="ad7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有任何建议、问题或想法，请在下面告诉我。</p></div></div>    
</body>
</html>