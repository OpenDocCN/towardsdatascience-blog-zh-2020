<html>
<head>
<title>Dynamically display tasks in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Power BI中动态显示任务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dynamically-display-tasks-in-power-bi-cd19425acc4b?source=collection_archive---------47-----------------------#2020-10-26">https://towardsdatascience.com/dynamically-display-tasks-in-power-bi-cd19425acc4b?source=collection_archive---------47-----------------------#2020-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2f43" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">棘手的任务有时可以比你想象的更容易解决，用一点DAX魔法！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0878a1bfde93ae4cd754bd1071b78f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISsRby4G0XRFGM7MFftnQQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼克·费因斯在Unsplash.com拍摄的照片</p></figure><p id="a95e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">几周前，我正在处理客户支持部门的一个请求。从本质上来说，业务请求是为了让主管能够<a class="ae lu" rel="noopener" target="_blank" href="/dynamic-filtering-in-power-bi-5a3e2d2c1856">动态地过滤</a>需要执行的任务。</p><p id="a821" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于主管也有他们自己的任务，他们应该能够在他们自己的任务和来自所有代表的任务之间动态地切换视图。</p><h2 id="88c6" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">USERNAME() &amp; USERPRINCIPALNAME()函数</h2><p id="ba57" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">像往常一样，DAX为您的挑战提供了便捷的解决方案。这一次，我将使用其中一个信息函数…或者更准确地说，不是一个，而是两个，它们非常相似，但在不同的环境下仍然会产生不同的结果。</p><p id="16b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从<em class="mt"> USERNAME() </em>函数开始。这个函数将返回当前连接的域名和用户名。所以，如果我创建这样的度量:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2d48" class="lv lw it mv b gy mz na l nb nc">My User = USERNAME()<br/>My User Principal = USERPRINCIPALNAME()</span></pre><p id="08bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">把它放在一个简单的卡片上，这是我得到的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/e995009accaffc15fb8484e72cdadbef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*vFFiIvnZ87YTiTiOhm2-Zg.png"/></div></figure><p id="2b50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mt"> USERPRINCIPALNAME() </em>将返回UPN(用户主体名)。根据您的设置，在Power BI Desktop中，结果可以与<em class="mt"> USERNAME() </em>函数完全相同(就像我的例子一样)，或者它可以返回登录到Power BI Desktop的用户的电子邮件地址。</p><p id="4ea3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，一旦您将报告发布到Power BI Service，这两个函数将表现相同，并将电子邮件地址作为一个值返回:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/3e110df34067204d380520724dbced61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBZlzvh5LPYilnQ-fPWH-w.png"/></div></div></figure><h2 id="8c3b" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">解决原始问题</h2><p id="3fe8" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在，回到我最初的问题，这里是我们如何利用这些函数找到一个优雅的解决方案。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/430c1a4cfa0abbd815d4fb8dc60f8f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*wl9CjcA0G5k0g-HBs8IdBQ.png"/></div></figure><p id="7214" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个包含与任务相关的数据的表格。如您所见，我有一个任务被分配到的用户、任务ID和任务创建的日期。</p><p id="cc7b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一个表包含关于用户的数据(我创建了一个虚拟的第二个用户，只是为了模拟真实的场景):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3d71fdce6a1254278aeb0e962788590b.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*D63w6c13cS-JfRTRFin5VQ.png"/></div></figure><p id="49ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">两个表通过用户本地列连接，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9b99567581dee1e1163b9d52640ddc1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pr59PtxXiyNJahkoTT8TxQ.png"/></div></div></figure><p id="26e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最重要的一步是定义一个计算“我的”任务的方法——当我说“我的”时，我指的是浏览报表的用户的任务。</p><p id="dc04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下措施将有助于我们实现这一目标:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="50da" class="lv lw it mv b gy mz na l nb nc">My Tasks = CALCULATE(<br/>                    COUNTROWS(Tasks), <br/>                    KEEPFILTERS(Users[User Local] = USERNAME()<br/>                    )<br/>                    )</span></pre><p id="7220" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<em class="mt"> KEEPFILTERS() </em>函数，我们正在修改<em class="mt"> CALCULATE </em>函数的默认行为，因为在<em class="mt"> CALCULATE </em>函数中定义的过滤器参数将替换指定列上的所有现有过滤器。</p><p id="72bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">应用<em class="mt"> KEEPFILTERS </em>，如果<em class="mt">计算</em>过滤器替换当前上下文，<em class="mt"> KEEPFILTERS </em>会将过滤器添加到当前上下文。</p><p id="254e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也就是说，如果我将这种方法用于卡片视觉，我会得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/9c0fd22e4c8818d8ed855559f9f7f0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*aSu0MeEotFGA-b_3PCUFfw.png"/></div></figure><p id="2a85" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我以NIKOLAI\nickk的身份登录，我看到有5项任务分配给了我，这是正确的。</p><h2 id="3946" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">最终抛光以获得更好的体验</h2><p id="e290" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在，我希望我的主管用户能够选择他希望在报告中看到的内容:所有任务或仅分配给她/他的那些任务。为此，我将使用<a class="ae lu" rel="noopener" target="_blank" href="/build-pro-slicer-pane-in-power-bi-911248b39348">书签</a>并在我的报告页面中做一些调整。</p><p id="753e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一步是创建现有表的副本，并对其应用筛选器，以便只显示我的任务度量值大于0的行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/b4d61b10f65ff615494faff1ddc6e87e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7XeKuqPatmzljE4MvlzSQ.png"/></div></div></figure><p id="df95" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将这个新表放在旧表的正上方，旧表显示所有任务。我将切换标题的背景颜色，这样用户也可以根据颜色来区分表格。</p><p id="033d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来是我的解决方案的最后润色:我将在报告画布上放置一个<a class="ae lu" rel="noopener" target="_blank" href="/drillthrough-like-a-pro-in-power-bi-ed92effcfe72">按钮，使我的用户能够在两个不同的视图之间动态切换。或者，更好的是，我将把两个按钮一个放在另一个上面，以节省报告页面的空间，同时保留书签操作的全部功能。</a></p><p id="a150" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一步是创建书签，并为每个书签定义适当的操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/502172f264fbcd94bd66dac462c37ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prtdDRQoaHQUnRzoi7UeYA.png"/></div></div></figure><p id="1402" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“所有任务”书签将隐藏两个视觉效果(请参见上图)，而“我的任务”书签将应用类似的逻辑，但方向相反:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/86cf0cd3e221b1f5229d10e9ba21c686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QpKz-tvaQee23PC5S3BkTQ.png"/></div></div></figure><p id="0e92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，让我们为按钮定义操作，以便能够在刚刚创建的两个书签之间导航:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/de1bcd6c7d4ee6edaec5d4a57b07198f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7T9_BHJ_yQtecHzFDd2BA.png"/></div></div></figure><p id="41d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，我们的最终解决方案是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/a254839b217552e0fb14d39136988a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*L1CG-N6zhrs7hMM5yU05WA.gif"/></div></figure><p id="56a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们结束之前，<strong class="la iu"> <em class="mt">一个重要的备注</em> </strong>:为了让这个技巧在Power BI服务中工作，您需要切换我的任务度量中的函数，使用<em class="mt">用户服务</em>而不是<em class="mt">用户本地</em>:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="58b6" class="lv lw it mv b gy mz na l nb nc">My Tasks = CALCULATE(<br/>                    COUNTROWS(Tasks), <br/>                    KEEPFILTERS(Users[User Service] = USERNAME()<br/>                    )<br/>                    )</span></pre><h2 id="fa93" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">结论</h2><p id="c369" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">乍一看，最初的请求似乎很棘手，很有挑战性。然而，通过应用一些基本但有用的DAX函数，并使用书签稍作调整，我们能够为我们的用户提供一个优雅而有效的解决方案。</p><p id="1bde" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p><p id="9627" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读Medium上的每一个故事！</a></p><p id="fc99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">订阅<a class="ae lu" href="http://eepurl.com/gOH8iP" rel="noopener ugc nofollow" target="_blank">此处</a>获取更多有见地的数据文章！</p></div></div>    
</body>
</html>