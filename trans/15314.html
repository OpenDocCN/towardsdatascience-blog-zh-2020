<html>
<head>
<title>Serving a Machine Learning Model Via REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过REST API服务于机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/serving-a-machine-learning-model-via-rest-api-5a4b38c02e90?source=collection_archive---------22-----------------------#2020-10-21">https://towardsdatascience.com/serving-a-machine-learning-model-via-rest-api-5a4b38c02e90?source=collection_archive---------22-----------------------#2020-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d230" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Flask服务于机器学习模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b52adb645dd42d8e90aac3250958829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*agee1VswuAiYKDtL"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lefterisk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Lefteris kallergis </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="5cd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于那些不熟悉我的作品的人，在过去一篇题为“<a class="ae ky" rel="noopener" target="_blank" href="/using-machine-learning-to-detect-fraud-f204910389cf"> <strong class="lb iu"> <em class="lv">使用机器学习检测欺诈</em> </strong> </a>”的帖子中，我们开始制造我们机器学习包的第一部分。</p><p id="39bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，包装完成了，但是我们下一步做什么呢？我们如何将它集成到我们需要使用它的任何地方——Github上的包存储库。</p><div class="lw lx gp gr ly lz"><a href="https://github.com/kurtispykes/credit-card-fraud-detection/tree/master/packages/random_forest_model" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">kurtispykes/信用卡欺诈检测</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ks lz"/></div></div></a></div><p id="0509" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此向大家介绍一下REST API。</p><blockquote class="mo mp mq"><p id="2023" class="kz la lv lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:这个项目很大程度上受到Udemy上的“<a class="ae ky" href="https://www.udemy.com/course/deployment-of-machine-learning-models/" rel="noopener ugc nofollow" target="_blank">部署机器学习模型</a>”课程的启发，因此会有来自那个项目的源代码片段。</p></blockquote><h2 id="c3d4" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">什么是REST API？</h2><p id="e677" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> API </strong>是<strong class="lb iu"> A </strong>应用<strong class="lb iu"> P </strong>编程<strong class="lb iu"> I </strong>接口的缩写。从本质上讲，它是一个软件中介，允许两个应用程序相互对话。如果你不熟悉API，那么你就不会知道你很可能每天都在使用它。不相信我？你上一次发即时短信是什么时候？你当时用的是API。</p><p id="4367" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> REST </strong>缩写代表<strong class="lb iu">RE</strong>presentation<strong class="lb iu">S</strong>state<strong class="lb iu">T</strong>transfer，它决定了API的外观。像任何其他的架构风格一样，REST有它自己的指导约束，如果一个接口被称为RESTful，那么应该满足这些约束——关于REST的更多信息，请参见“<a class="ae ky" href="https://restfulapi.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="lv">什么是REST </em> </strong> </a>”。</p><p id="fac3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地说，REST API将被请求资源的状态传输给客户机。在我们的例子中，请求的资源将是来自我们的机器学习模型的预测。因此，我们的服务器将把预测传递给客户端，客户端可能是从web应用程序到移动设备的任何东西。</p><p id="3d1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为什么要使用REST API？</strong></p><p id="ab0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样设计我们的系统有很多好处。例如，通过REST API服务我们的模型也允许我们这样做；</p><ul class=""><li id="70cb" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">即时提供预测以增加客户数量</li><li id="4f6c" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">可能在不同的API端点组合多个模型</li><li id="aab4" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">通过在负载平衡器后添加更多应用程序实例来进行扩展</li><li id="cd54" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">将我们的模型环境从面向客户的层中分离出来——团队可以独立工作</li></ul><p id="d723" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">烧瓶介绍</strong></p><p id="6497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建我们的API，我们将利用Flask微框架。由于各种原因，例如极其强大、易于使用和非常好的文档，Flask是Python中微服务的流行选择——参见<a class="ae ky" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><blockquote class="mo mp mq"><p id="3c57" class="kz la lv lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">“微型”并不意味着您的整个web应用程序必须适合一个Python文件(尽管它确实可以)，也不意味着Flask缺乏功能。微框架中的“微”意味着Flask旨在保持核心简单但可扩展。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/db6107703e22a94b4bf16712203009df.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/0*FTrSX6lgHgGiPpuy.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd oh">来源</strong> : <a class="ae ky" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank">烧瓶文件</a></p></figure><h2 id="c5b2" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">我们的REST API</h2><p id="66e1" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu">基本结构</strong></p><p id="5620" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先来看看我们的目录结构…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/9ff3e419b9a7d3187ac4aacaa7ff4105.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*keZo9T_km8wllc9H4bwo0Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd oh">图1: </strong>回购目录结构</p></figure><p id="6daa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最顶层的目录是<code class="fe oj ok ol om b">ml_api</code>，在这个目录中有<code class="fe oj ok ol om b">requirements.txt</code>和<code class="fe oj ok ol om b">run.py</code>。<code class="fe oj ok ol om b">requirements.txt</code>就是我们在虚拟环境中需要的产品包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/cd8f9584b36fac24b046933062d8f082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLRu8wuU9Vn2faf4-z12mA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd oh">图2</strong>:requirements . txt的内容—我们正在安装flask版本1.1.2和我们做了包的random _ forest _ model因此，我们将能够执行导入语句来调用包。</p></figure><p id="e52d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们开始用<code class="fe oj ok ol om b">pip install -r path\to\requirements.txt</code>将<code class="fe oj ok ol om b">requirements.txt</code>文件安装到我们的虚拟环境中，这将安装<code class="fe oj ok ol om b">flask</code>并找到我们的<code class="fe oj ok ol om b">random_forest_model</code>包的发行版。</p><p id="7c4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oj ok ol om b">run.py</code>文件是一个入口点，我们将使用在<code class="fe oj ok ol om b">app.py</code>模块中定义的<code class="fe oj ok ol om b">create_app()</code>函数来启动flask。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">图3 </strong>:启动砂箱的入口点。</p></figure><p id="dc7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看<code class="fe oj ok ol om b">app.py</code>模块。从<em class="lv">图1 </em>我们可以看到，我们可以通过<code class="fe oj ok ol om b">api</code>子目录导航到该文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">图4 </strong></p></figure><p id="6926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe oj ok ol om b">app.py</code>中，我们有自己的工厂函数，它创建了我们的flask API并设置了蓝图，蓝图创建了一个位于<code class="fe oj ok ol om b">controller.py</code>中的端点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">图5 </strong></p></figure><p id="22f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">控制器是一个简单的健康端点，在HTTP <strong class="lb iu"> GET </strong>请求期间出现，它返回“工作正常”。</p><p id="72a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们启动这个实例之前，在命令提示符下设置flask应用程序的入口点是很重要的。在命令提示符下导航到我们的<code class="fe oj ok ol om b">ml_api</code>目录，然后简单地输入<code class="fe oj ok ol om b">set FLASK_APP=run.py</code>就可以了。当我们完成后，我们只需输入<code class="fe oj ok ol om b">python run.py</code>,结果如下…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/69caba5e3dcf3b6acdb7715bf11a193c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*yhhjNNPmJuO1YgvQ2-gH_g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd oh">图6 </strong>:终点</p></figure><p id="e566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，我们的终点也如我们所希望的那样工作了。现在我们有了基本的框架，我们可以添加一些更复杂的东西。</p><blockquote class="mo mp mq"><p id="465a" class="kz la lv lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:添加配置和日志超出了本文的范围，但是在更新的存储库中，你会看到它们存在。因此，下一节将讨论添加预测端点。</p></blockquote><p id="af88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是在<code class="fe oj ok ol om b">controller.py</code>中为我们的健康端点添加一个推理端点</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">图7 </strong>:追加预测终点</p></figure><p id="69d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经从我们的<code class="fe oj ok ol om b">random_forest_model</code>包中调用了<code class="fe oj ok ol om b">predict</code>函数来从我们的模型中获取结果。任何软件工程项目的一个非常重要的部分是测试，所以让我们测试我们的端点，看看它是否如我们所期望的那样工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">图8 </strong>:测试我们的预测终点是否按预期工作</p></figure><p id="0be2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PyTest超出了本文的范围，但是为了运行我们的测试，我们必须运行<code class="fe oj ok ol om b">pytest path\to\test_dir</code>，这将运行我们的测试目录中的所有测试——如果我们通过了测试，那么我们的预测端点是健康的并且正在运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/3179c9717d9ea924eb62d1ea21be5cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idQ9HIfLFRZglzUJbV-q5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd oh">图9 </strong>:端点通过测试！</p></figure><p id="cb02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你知道了！</p><p id="9c2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢你看完，我们在LinkedIn上连线吧…</p><div class="lw lx gp gr ly lz"><a href="https://www.linkedin.com/in/kurtispykes/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">Kurtis Pykes -人工智能作家-走向数据科学| LinkedIn</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">在世界上最大的职业社区LinkedIn上查看Kurtis Pykes的个人资料。Kurtis有一个工作列在他们的…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">www.linkedin.com</p></div></div><div class="mi l"><div class="os l mk ml mm mi mn ks lz"/></div></div></a></div></div></div>    
</body>
</html>