<html>
<head>
<title>Guide to implementing Linear Regression in Pyspark and R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pyspark和R中实现线性回归的指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/guide-to-implement-linear-regression-in-pyspark-and-r-26a94fe938a3?source=collection_archive---------38-----------------------#2020-10-07">https://towardsdatascience.com/guide-to-implement-linear-regression-in-pyspark-and-r-26a94fe938a3?source=collection_archive---------38-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ef63b72cbf33be6a2a9fece4b79d0a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LshlcePMBU29OyoO"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">凯利·西克玛在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0d77" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我应该使用哪种编程工具来构建我的线性回归模型？在预测准确性方面有什么不同吗？用几行代码实现哪个更简单？我的训练数据的大小有影响吗？让我们在这篇文章中探讨所有这些问题。</p><h1 id="4f6a" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">资料组</h1><p id="0bcf" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我使用的数据集是一个虚拟数据集，只包含两个变量，<em class="mh">年资</em>和<em class="mh">薪水</em>。我们试图找出一个雇员的工资是否与他的工作年限成线性关系，从逻辑上讲，我们希望这种关系存在。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/441f3ebaab73f7b541a99972c1bd4334.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*oE0qS-PvN3_sjpmcJW2g2w.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">按作者分类的图像-数据集预览</p></figure><h1 id="d4a1" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Pyspark</h1><p id="2d8b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们将利用Pyspark在Python中训练我们的线性回归模型，因为Pyspark能够提升数据处理速度，这在大数据领域非常受重视。由于本文更侧重于实现线性回归模型，所以我不会触及设置Pyspark(即SparkContext、SparkSession、SparkConf)的技术方面，你可以在我之前的<a class="ae kf" rel="noopener" target="_blank" href="/analysing-difference-between-scrum-agile-using-pyspark-c2fc4405217d">帖子</a>中找到。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c6f3" class="ms lf it mo b gy mt mu l mv mw">from pyspark import SQLContext, SparkConf, SparkContext<br/>from pyspark.sql import SparkSession</span><span id="681d" class="ms lf it mo b gy mx mu l mv mw">sc = SparkContext.getOrCreate()</span><span id="43cb" class="ms lf it mo b gy mx mu l mv mw">if (sc is None):<br/>    sc = SparkContext(master="local[*]", appName="Linear Regression")<br/>spark = SparkSession(sparkContext=sc)</span><span id="bcb5" class="ms lf it mo b gy mx mu l mv mw">sqlcontext = SQLContext(sc)<br/>data = sqlcontext.read.csv('./Salary_Data.csv', header = True, inferSchema = True)</span></pre><p id="453d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们将数据导入Pyspark，我们需要告诉它哪些是我们的特征变量，哪些是我们的目标变量。对于这个数据集，很明显<em class="mh">年资</em>是我们的特征变量，而<em class="mh">薪水</em>是我们的目标变量。我们有我们的数据，我们将建立我们的模型，但我们如何知道我们的模型是否表现良好？在数据科学家中，将我们的数据集分成训练和测试数据是一种方法，通常的比例是70:30或80:20。在Pyspark中实现机器学习算法需要注意的另一件事是，我们可以利用<a class="ae kf" href="https://www.bmc.com/blogs/introduction-to-sparks-machine-learning-pipeline/" rel="noopener ugc nofollow" target="_blank">向量汇编器</a>，它将所有特征组合成一个稀疏的单个向量，这大大减少了机器学习模型的训练时间。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="343c" class="ms lf it mo b gy mt mu l mv mw">from pyspark.ml.feature import VectorAssembler</span><span id="99ff" class="ms lf it mo b gy mx mu l mv mw"># defining Salary as our label/predictor variable<br/>dataset = data.select(data.YearsExperience, data.Salary.alias('label'))</span><span id="a5f5" class="ms lf it mo b gy mx mu l mv mw"># split data into 70% training and 30% testing data<br/>training, test = dataset.randomSplit([0.7, 0.3], seed = 100)<br/># assembler to assemble the features into vector form<br/>assembler = VectorAssembler().setInputCols(['YearsExperience',]).setOutputCol('features')<br/>trainingSet = assembler.transform(training)<br/># select only features column and label column since we have already vectorised our features<br/>trainingSet = trainingSet.select("features","label")</span></pre><p id="8dc1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们准备使用我们的训练数据集来训练线性回归模型。如上所述，我们还将利用测试数据集来了解我们的模型表现如何。如下面的输出所示，我们的模型现在包含一个<em class="mh">预测</em>列，当我们将我们的特征列(即<em class="mh">年资</em>)作为测试数据集放入我们的线性回归模型时，该列包含<em class="mh">预测工资</em>。我们可以看到，有些预测值接近实际值，有些则不然。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3c60" class="ms lf it mo b gy mt mu l mv mw">from pyspark.ml.regression import LinearRegression</span><span id="0c73" class="ms lf it mo b gy mx mu l mv mw"># fit the training set to linear regression model<br/>lr = LinearRegression()<br/>lr_Model = lr.fit(trainingSet)</span><span id="d970" class="ms lf it mo b gy mx mu l mv mw"># assembler to assemble the features into vector form<br/>testSet = assembler.transform(test)<br/># select only features column and label column since we have already vectorised our features<br/>testSet = testSet.select("features", "label")<br/># fit the testing data into our linear regression model<br/>testSet = lr_Model.transform(testSet)</span><span id="5e53" class="ms lf it mo b gy mx mu l mv mw">testSet.show(truncate=False)</span></pre><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi my"><img src="../Images/eb21d78f94e9a99263ba483f5688e00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*zBSqiPRd02-df95-Ga9ILA.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">按作者分类的图片Jupyter笔记本输出预测值</p></figure><p id="1c69" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，我们如何衡量线性回归模型的表现呢？我们可以利用<a class="ae kf" href="https://statisticsbyjim.com/regression/interpret-r-squared-regression/" rel="noopener ugc nofollow" target="_blank"> R </a>，它是0到100%之间的拟合优度的度量。我们只用两行代码就可以在Pyspark中轻松实现。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="812d" class="ms lf it mo b gy mt mu l mv mw">from pyspark.ml.evaluation import RegressionEvaluator</span><span id="c782" class="ms lf it mo b gy mx mu l mv mw">evaluator = RegressionEvaluator()<br/>print(evaluator.evaluate(testSet, {evaluator.metricName: "r2"}))</span></pre><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/2b9fdfbe298651d8c5f355ec9142d540.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*8xZyQdyi9edr2fC_J93k1A.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片Pyspark中R度量的Jupyter笔记本输出</p></figure><p id="d8ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">93.9%的R值表明，当我们使用<em class="mh">年的经验拟合我们的训练模型时，我们的线性回归在预测<em class="mh">工资</em>方面表现得非常好。</em></p><h1 id="e003" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">稀有</h1><p id="d6af" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在，让我们在r中构建我们的线性回归模型。我们将数据分为70%的训练数据和30%的测试数据，就像我们在Pyspark中所做的那样。然而，让我们尝试使用我们在Pyspark中使用的相同测试数据，看看在模型的预测中R性能是否有任何差异。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3b41" class="ms lf it mo b gy mt mu l mv mw">data = read.csv("./Salary_Data.csv")</span><span id="c758" class="ms lf it mo b gy mx mu l mv mw"># sample data<br/># set.seed(100)<br/># dt = sort(sample(nrow(data), nrow(data)*.7))<br/>dt = c(5,8,9,10,16,19,20,22,26,27)<br/># split data into training and testing data<br/>trainingSet&lt;-data[-dt,]<br/>testingSet&lt;-data[dt,]</span></pre><p id="1412" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">获得训练和测试数据集后，我们使用训练数据集训练我们的线性回归模型，并使用测试数据集预测<em class="mh">工资</em>。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="1fda" class="ms lf it mo b gy mt mu l mv mw"># fit linear regression model<br/>lm_model = lm(data = trainingSet, Salary~.)<br/># predict the target variable with testing data<br/>predicted_salary = predict(lm_model, testingSet)</span></pre><p id="65ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们通过计算R来测量预测值的拟合优度。注意，在R中，我们不能运行库或命令来直接获得R。因此，我们必须通过获得残差平方和和以及平方和来手动计算它们，这可以在此处进一步探讨<a class="ae kf" href="https://www.statisticshowto.com/residual-sum-squares" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c9d0" class="ms lf it mo b gy mt mu l mv mw"># residual sum of squares<br/>rss &lt;- sum((predicted_salary - testingSet$Salary) ^ 2) <br/># total sum of squares<br/>tss &lt;- sum((testingSet$Salary - mean(testingSet$Salary)) ^ 2) <br/># obtain r^2<br/>rsq &lt;- 1 - rss/tss<br/>rsq</span></pre><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f814c2de1ff0e1e7bf759e1f8223d1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*BA1BVPFrVuKIOvMNBeifiA.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">按作者分类的图像— Jupyter笔记本输出的R度量单位为R</p></figure><h1 id="5ec0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">摘要</h1><p id="a6ea" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们获得了与在Pyspark中相同的R，这意味着就模型的准确性而言，选择Pyspark或R来训练您的模型并不重要。显然，在R中训练线性回归模型比在Pyspark中简单得多。然而，需要注意的一点是，Pyspark在训练大数据方面更为可取，处理速度将明显快于R本身。</p><p id="de18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是我在构建线性回归模型时选择R还是Pyspark的建议:</p><blockquote class="nb"><p id="3da9" class="nc nd it bd ne nf ng nh ni nj nk ld dk translated"><strong class="ak">py spark</strong>-&gt;-<em class="nl">适合处理大量数据</em></p><p id="7add" class="nc nd it bd ne nf ng nh ni nj nk ld dk translated"><strong class="ak">R</strong>-&gt;T22】适合于简单实现</p></blockquote><p id="b215" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">感谢阅读，我将在接下来的几篇文章中研究其他几种机器学习算法，干杯！</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><a href="https://www.buymeacoffee.com/tankahwang"><div class="gh gi nr"><img src="../Images/4bc5de35955c00939383a18fb66b41d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*9vg3-OY14aZN1UpKwIxxZg.png"/></div></a></figure></div></div>    
</body>
</html>