<html>
<head>
<title>Live CNN Training Dashboard: Hyperparameters Tuning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CNN实时培训仪表板:超参数调整</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/live-cnn-training-dashboard-hyperparameters-tuning-6b3382d9e44f?source=collection_archive---------33-----------------------#2020-11-14">https://towardsdatascience.com/live-cnn-training-dashboard-hyperparameters-tuning-6b3382d9e44f?source=collection_archive---------33-----------------------#2020-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="d423" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><h1 id="2219" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">目录</h1><ol class=""><li id="d99b" class="ku kv iq kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated"><strong class="kw ja">为什么我们需要建立一个直播CNN培训仪表板？</strong></li><li id="b8ce" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated"><strong class="kw ja">简介</strong></li><li id="fd2b" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated"><strong class="kw ja">先决条件</strong></li><li id="74b7" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated"><strong class="kw ja">系统描述</strong></li><li id="b881" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated"><strong class="kw ja">如何营造环境，开始训练？</strong></li><li id="d1e8" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated"><strong class="kw ja">结论</strong></li><li id="b3e4" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated"><strong class="kw ja">参考文献</strong></li></ol><h1 id="372d" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">为什么我们需要建立一个现场CNN培训仪表板？</h1><p id="2add" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">当我在数学学校学习的时候，我的老师告诉我理解一件事情的最好方法是把它形象化。例如，我们有一块木板、橡皮泥和金属线来可视化立体测量问题。这对开发视觉思维和解决挑战性任务的技能帮助很大。</p><p id="2dd8" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">我真的相信真正的数据科学家应该理解算法，并且知道如果有些东西不太好，应该如何改进它。尤其是在深度学习领域。在我看来，发展这些技能的最佳方式是观察模型是如何被训练的，当你改变超参数时会发生什么。这就是为什么我想分享如何为CNN直播培训建立一个简单的仪表板，并有机会在线调整一些超参数。</p><p id="d9a6" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">有一个常识，如果我们选择太大的学习率，就会看到我们的损失函数是如何爆炸的(我们的模型不会收敛)；如果我们选择的学习率太小，训练过程可能会持续太长时间。退学怎么办？有一种观点认为辍学减少了过度适应。即使我相信，我也要亲自检查一切，因为知道和相信是两回事。</p><p id="166d" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">下面是我的仪表板的简短演示。损失函数和准确度图上的红点代表训练数据集，蓝点代表测试数据集。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ml"><img src="../Images/45d347dce486ca2cc190dfa63cfd96fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HhRidOhxiPrvrThYqqz3Pg.gif"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">作者图片</p></figure><h1 id="0af7" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h1><p id="3c97" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">仪表板显示以下统计信息:</p><ul class=""><li id="8851" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">时间损失函数值；</li><li id="d407" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">时间上的准确性；</li><li id="946f" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">最后一步的激活映射值的分布；</li><li id="b575" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">超参数变化历史(表)；</li></ul><p id="2e85" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">对于这项任务，我使用AlexNet架构对10类图像进行分类:阿拉斯加雪橇犬、狒狒、针鼹、大熊猫、河马、帝企鹅、骆驼、水獭、小熊猫和袋熊。图像从ImageNet下载。我不会在这篇文章中详述，但是你可以浏览文件<code class="fe nf ng nh ni b"><strong class="kw ja">get_dataset.py</strong></code>。在训练期间，可以调整以下参数:</p><ul class=""><li id="1fe1" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">优化器；<br/>这个参数决定了我们用来优化模型的算法。我只用亚当和SGD与内斯特罗夫的势头。如果你想更多地了解优化技术，我鼓励你观看斯坦福大学的视频<a class="ae nj" href="https://www.youtube.com/watch?v=_JB0AO7QxSA" rel="noopener ugc nofollow" target="_blank">这里</a>。关于优化有许多奇妙的细节。</li><li id="79aa" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">学习率；<br/>该参数决定了我们在更新权重时下坡的速度。权重更新的基本梯度下降公式如下:<code class="fe nf ng nh ni b">w := w — lr * dw.</code></li><li id="0d75" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">重量衰减；<br/>对于我们的情况，它只是简单的L2正则化:<code class="fe nf ng nh ni b">R(W) = SUM(W * W)</code>。人们认为，重量衰减在CNN的背景下没有太大意义，但你可以亲自看看它是如何工作的。你可以在这里阅读一些关于L1和L2规则化技术的描述<a class="ae nj" rel="noopener" target="_blank" href="/l1-and-l2-regularization-methods-ce25e7fc831c">。</a></li><li id="1d87" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">辍学；<br/>神经网络常用正则化策略。这个想法是在每个训练步骤中随机设置一些神经元为零。超参数是丢弃每个神经元的概率。常见值为0.5 (50%)。我们可以选择20到80之间的任意整数值。(百分比)更多细节可以在我为optimizer分享的同一视频中查看。</li></ul><p id="462f" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">可以很容易地更改脚本来添加额外的功能。</p><h1 id="bca4" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">先决条件</h1><p id="9a50" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">我假设您了解什么是CNN，并对以下内容有基本的了解:</p><ul class=""><li id="3be9" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">PostgreSQL(存储实时数据)；</li><li id="385e" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">Dash(建立仪表板，<a class="ae nj" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/dash/</a>)；</li><li id="b76a" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">PyTorch(建立CNN模型)；</li></ul><h1 id="04cb" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">系统描述</h1><p id="b221" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">系统主要有四个部分:<em class="nk">数据集、模型、数据库、仪表盘/UI </em>。这些部分相互作用以成功地运行系统。首先，我将描述每一个部分，之后，我将简要描述它们如何相互作用。</p><h2 id="5021" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">资料组</h2><p id="7cd6" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">在这个练习中，我使用了来自ImageNet的数据集，该数据集包含以下十个类:<em class="nk">阿拉斯加雪橇犬、狒狒、针鼹、大熊猫、河马、帝企鹅、美洲驼、水獭、小熊猫和袋熊。</em>要从ImageNet下载所有图像，我可以从以下位置运行<code class="fe nf ng nh ni b">python board.py</code>:<code class="fe nf ng nh ni b">../cnn_live_training.</code></p><p id="bcf5" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">首先，我必须找到类id并将它们保存到某个变量中:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3f24" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">ImageNet存储图像的URL。一些网址/图片可能不再存在。为了根据类id获取这些URL，我使用了以下函数:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="dbee" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">为了下载所有的图片，我使用了一个循环来逐个下载图片。以下是通过URL下载图像的功能:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b2da" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">完整版本的代码可以在文件<code class="fe nf ng nh ni b"><strong class="kw ja">get_dataset.py</strong></code>中看到。您可以轻松地将这些类更改为其他类，甚至可以将ImageNet更改为您的自定义数据集。</p><h2 id="7d6c" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">模型</h2><p id="17b0" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">在训练中，我默认使用带有Adam的AlexNet架构或带有内斯特罗夫动量优化器的SGD。也可以选择VGG16。模型可以从文件<code class="fe nf ng nh ni b"><strong class="kw ja">models.py</strong></code>或<code class="fe nf ng nh ni b">torchvision.models</code>导入。第二个选项有机会使用预先训练的重量。数据集准备发生在文件<code class="fe nf ng nh ni b"><strong class="kw ja">data_preparation.py</strong></code>中。训练过程发生在<code class="fe nf ng nh ni b"><strong class="kw ja">train.py</strong></code>文件中。</p><p id="aa1e" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">我的目标不是在这篇文章中解释如何建立一个训练CNN的管道，这就是为什么我不在这一部分详细讨论。但我很高兴推荐斯坦福大学的CS231n课程，尤其是HW2(Q4)，在这里你可以一步一步地学习如何建立这条管道。这个作业可以在<a class="ae nj" href="https://cs231n.github.io/assignments2020/assignment2/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="d2b6" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">数据库ˌ资料库</h2><p id="7c3a" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">在运行系统之前，我们必须使用模式<em class="nk"> cnn_live_training </em>在PostgreSQL中创建<em class="nk"> dl_playground </em> DB，该模式包含以下三个表:<em class="nk">参数、统计数据、激活数据</em>。</p><p id="3a42" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated"><strong class="kw ja">参数</strong> <br/>该表仅包含<em class="nk">一行</em>用于训练CNN模型的当前参数。当我们在仪表板(文件<code class="fe nf ng nh ni b"><strong class="kw ja">board.py</strong></code>中更改任何参数时，这些数据将在<em class="nk">参数</em> SQL表中更新。该表包含以下列:</p><ul class=""><li id="6321" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">优化器；<br/>文本数据类型。可以有两个值:“亚当”和“新加坡元+内斯特罗夫”。</li><li id="70db" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">学习_速率；<br/>双精度数据类型。值在0和1之间，步长为0.00005。</li><li id="e53a" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">重量_衰减；<br/>双精度数据类型。值在0和1之间，步长为0.05。</li><li id="b1e9" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">辍学；<br/>整数数据类型。值介于20和80之间。(假设这些值以%为单位。)</li><li id="df28" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">dt _更新；<br/>时间戳数据类型。指示修改数据的日期和时间。</li><li id="a8a4" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">stop _ train<br/>布尔数据类型。表示我们是否必须停止训练。</li></ul><p id="d87c" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated"><strong class="kw ja">统计<br/> </strong>此表包含培训过程的统计。每<code class="fe nf ng nh ni b">--n-print</code>步更新一次数据。该表包含以下列:</p><ul class=""><li id="ba57" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">dt _ started<br/>时间戳数据类型。指示当前培训开始的时间。</li><li id="9ac3" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">型号名称；<br/>文本数据类型。在这种情况下，它只能是“MyAlexNet”。</li><li id="5238" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">纪元；<br/>整数数据类型。表示训练时期的数量。</li><li id="3d83" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">步；<br/>整数数据类型。表示训练步骤的数量。</li><li id="2b8f" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">优化器；<br/>文本数据类型。可以有两个值:“亚当”和“新加坡元+内斯特罗夫”。</li><li id="56b7" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">学习_速率；<br/>双精度数据类型。值在0和1之间，步长为0.00005。</li><li id="bc1b" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">重量_衰减；<br/>双精度数据类型。值在0和1之间，步长为0.05。</li><li id="789a" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">辍学；<br/>整数数据类型。值介于20和80之间。</li><li id="0c08" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">dt；<br/>时间戳数据类型。指示修改数据的日期和时间。</li><li id="7d5f" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">train _ loss<br/>双精度数据类型。最后一步中训练数据集的损失函数值。</li><li id="5a58" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">train _准确性；<br/>双精度数据类型。最后一步中训练数据集的精度值。</li><li id="1973" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">验证_损失；<br/>双精度数据类型。最后一步中验证数据集的损失函数值。</li><li id="3e60" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">validate _准确性；<br/>双精度数据类型。最后一步中验证数据集的精度值。</li></ul><p id="0aba" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated"><strong class="kw ja">激活</strong>该表包含以下列:</p><ul class=""><li id="1285" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">nn _ part<br/>文本数据类型。可以是“特征”或“分类器”。</li><li id="6158" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">layer _ type<br/>文本数据类型。可以是“conv”或“fc”。</li><li id="1300" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">号码；<br/>整数数据类型。表示“nn”部分的层数。</li><li id="afa3" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">重量；<br/> Double[]数据类型。表示箱中重量的平均值。</li><li id="fa86" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">数量_重量；<br/>整数[]数据类型。指示箱中值的数量。</li></ul><h2 id="22f4" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">仪表板/用户界面</h2><p id="501b" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">仪表板由三个主要模块组成:<em class="nk">控制面板、损失函数&amp;准确度和激活图(分布)</em>。这些块是使用dash容器构建的。</p><p id="a024" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated"><strong class="kw ja">控制面板</strong>包含参数过滤器和“提交参数”按钮，可用于将选择的参数发送到上述“参数”表。有四个过滤器:优化器、学习率、权重衰减和退出。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ny"><img src="../Images/015e974182c81774987562aa1d2acbbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gO3qCjmZ2W_t53D2BY5U9g.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">作者图片</p></figure><p id="e206" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">下面是脚本，如何创建一个优化器过滤器(其他过滤器类似):</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1f05" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">之后，我创建了一个包含所有四个过滤器的容器:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="84d0" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">如何创建控制面板的其他部分可以在文件<code class="fe nf ng nh ni b"><strong class="kw ja">board.py</strong></code>中找到。</p><p id="fe60" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated"><strong class="kw ja">损失函数&amp;精度</strong>包含一个使用参数历史的表格和两个随时间变化的训练/测试损失函数和精度值的图表。数据每秒自动更新一次(时间间隔可以改变)。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ny"><img src="../Images/89d1e51fd44f71f57d8750977e5b225f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pnOp9JjL1Si19I9VCmsd-Q.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">作者图片</p></figure><p id="6c1a" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">下面是关于如何在仪表板中创建一个表格和按钮来停止训练的脚本(为了阅读方便，我用短名称替换了真实样式):</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c05d" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">创建绘图模板的脚本如下所示:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c44a" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">使用回调从PostgreSQL动态上传值(为了阅读方便，我只提供模板):</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="6cc0" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">这里我需要使用一个回调函数，因为我想每1秒钟更新一次图表。所以，我必须用这个变量作为输入。</p><p id="d95f" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated"><strong class="kw ja">激活图(分布)</strong>包含最后一步每层激活图的分布图。数据每秒自动更新一次(时间间隔可以改变)。</p><p id="97f9" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">前两层的激活看起来类似于平均值为0的正态分布。这是因为我们对前两层应用了标准化。为了了解更多，我鼓励你在这里观看斯坦福大学的讲座。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/177aa24082bacb0633605994890b9e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hp19LuAebQOoa7F8wZL9dQ.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">作者图片</p></figure><p id="5bfd" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">下面是创建带有地块的容器的脚本。它类似于前面的容器，具有损失函数和精度图:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="abc8" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">激活图的回调类似于“损失功能和准确性”:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="bce9" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">一切是如何运作的</h2><p id="7529" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">是时候结束一切了。回想一下，我的目标是训练CNN直播，并且能够通过改变超参数来控制这个过程。那么它是如何发生的呢？我有一个仪表板，我们可以看到CNN培训的进展，我们可以通过按下按钮“提交参数”来选择和激活一些过滤器。</p><p id="2eb6" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">之后会发生什么？使用文件<code class="fe nf ng nh ni b"><strong class="kw ja">board.py</strong> </code>中的回调和函数<em class="nk"> update_params </em>将所有这些参数发送到PostgreSQL中我的数据库中的表<em class="nk"> parameters </em>:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="41e7" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">同时，脚本<code class="fe nf ng nh ni b"><strong class="kw ja">train.py</strong></code>在每个训练步骤结束时连接到一个数据库，如果参数得到更新，则试图更新优化器:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c2b1" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">来自训练的每个<em class="nk"> n_step </em>步骤数据被保存到PostgreSQL数据库中的<em class="nk">统计</em>和<em class="nk">激活</em>表中；</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="16d3" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">而这个数据同时显示在仪表盘上是因为脚本<code class="fe nf ng nh ni b"><strong class="kw ja">board.py</strong></code>每隔1秒钟显示一次。连接到相同的表:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="63ab" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">通过从表中提取以下信息，所有参数都显示在表中:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ce9f" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">如果我们想提前停止训练，我们可以按桌子下面的“停止训练”按钮。按下按钮后，回调会将我的数据库中<em class="nk">参数表</em>中的变量<em class="nk"> stop_train </em>从<em class="nk"> False </em>变为<em class="nk"> True </em>:</p><figure class="mm mn mo mp gt mq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e5f8" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">同时，脚本<code class="fe nf ng nh ni b"><strong class="kw ja">train.py</strong></code>在每个训练步骤检查该参数，如果<em class="nk">为真</em>，训练将被中断。</p><p id="d5a8" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">如果没有关于使用什么参数开始训练的实用建议，这篇文章将是不完整的。如果你想看到一切正常，但没有时间做实验，你可以从以下参数开始:</p><ul class=""><li id="43e6" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh ne lj lk ll bi translated">优化器:亚当；</li><li id="3457" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">学习率:0.0003；</li><li id="5ea1" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">重量衰减:0；</li><li id="2631" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh ne lj lk ll bi translated">辍学:50%；</li></ul><p id="6ee5" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">想看模型怎么爆炸，把学习率提高到0.01就行了。祝你的实验好运。</p><h1 id="405d" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">如何营造环境，开始训练？</h1><h2 id="69da" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">虚拟环境设置</h2><p id="7114" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">我将使用虚拟环境(<em class="nk"> venv </em>)对Ubuntu做一个简短的描述。</p><ol class=""><li id="d2cb" class="ku kv iq kw b kx mg kz mh lb nb ld nc lf nd lh li lj lk ll bi translated">安装Python 3.8: <code class="fe nf ng nh ni b">sudo apt install python3.8-minimal</code></li><li id="3f62" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated">用Python 3.8安装虚拟环境:<code class="fe nf ng nh ni b">sudo apt-get install python3.8-venv</code></li><li id="65a7" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated">创建虚拟环境:从<code class="fe nf ng nh ni b">cnn_live_training</code>文件夹运行:<code class="fe nf ng nh ni b">python3.8 -m venv venv</code></li><li id="7d76" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated">激活环境:<code class="fe nf ng nh ni b">source venv/bin/activate</code></li><li id="7769" class="ku kv iq kw b kx lm kz ln lb lo ld lp lf lq lh li lj lk ll bi translated">在虚拟环境中安装需要的包:<br/> <code class="fe nf ng nh ni b">pip install -r requirements.txt</code></li></ol><h2 id="bc5c" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">收集数据集</h2><p id="bdac" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">从<code class="fe nf ng nh ni b">../cnn_live_training</code>命令<code class="fe nf ng nh ni b">python get_dataset.py</code>运行</p><h2 id="ee12" class="nl jx iq bd jy nm nn dn kc no np dp kg lb nq nr kk ld ns nt ko lf nu nv ks iw bi translated">开始训练</h2><p id="9abc" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">从<code class="fe nf ng nh ni b">../cnn_live_training</code>文件夹运行以下两个命令</p><pre class="mm mn mo mp gt oa ni ob oc aw od bi"><span id="dd05" class="nl jx iq ni b gy oe of l og oh">python board.py<br/>python train.py</span></pre><h1 id="9eab" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h1><p id="e6e2" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">在这个故事中，我想分享我对如何培养培训CNN的感觉的想法。一方面，想法很简单:建立一个培训管道，创建一个仪表板，并使用数据库将它们连接起来。但是有许多恼人的细节不可能放在一个小故事里。所有脚本和附加细节都可以在我的<a class="ae nj" href="https://github.com/atimashov/cnn_live_training" rel="noopener ugc nofollow" target="_blank"> git存储库</a>中找到。</p><p id="7d47" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">如果这个帖子让某人感兴趣，并提供了额外的知识，我会变得稍微开心一些，因为这意味着我达到了我的目标。我将感谢任何评论、建设性的批评或问题，请随时在下面留下您的反馈，或者您可以通过<a class="ae nj" href="https://www.linkedin.com/in/alexander-timashov/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p><h1 id="316c" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">参考</h1><p id="7ac5" class="pw-post-body-paragraph lr ls iq kw b kx ky lt lu kz la lv lw lb lx ly lz ld ma mb mc lf md me mf lh ij bi translated">[1] L .、R. Krishna和D. Xu，<a class="ae nj" href="http://cs231n.stanford.edu/" rel="noopener ugc nofollow" target="_blank"> CS231n:用于视觉识别的卷积神经网络</a> (2020)，斯坦福大学</p><p id="3fbf" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">[2] A. Krizhevsky，I. Sutskever和G. E. Hinton，<a class="ae nj" href="https://papers.nips.cc/paper/2012/file/c399862d3b9d6b76c8436e924a68c45b-Paper.pdf" rel="noopener ugc nofollow" target="_blank">使用深度卷积神经网络的ImageNet分类</a> (2012)，NeurIPS 2012</p><p id="bf91" class="pw-post-body-paragraph lr ls iq kw b kx mg lt lu kz mh lv lw lb mi ly lz ld mj mb mc lf mk me mf lh ij bi translated">[3] A .纳帕尔，<a class="ae nj" rel="noopener" target="_blank" href="/l1-and-l2-regularization-methods-ce25e7fc831c"> L1和L2正则化方法</a> (2017)，走向数据科学</p></div></div>    
</body>
</html>