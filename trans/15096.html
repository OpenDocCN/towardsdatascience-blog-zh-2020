<html>
<head>
<title>3 High Availability Cloud Concepts You Should Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您应该知道的3个高可用性云概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-high-availability-cloud-concepts-you-should-know-93f3bab2cb4a?source=collection_archive---------17-----------------------#2020-10-17">https://towardsdatascience.com/3-high-availability-cloud-concepts-you-should-know-93f3bab2cb4a?source=collection_archive---------17-----------------------#2020-10-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8771" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从扩展到虚拟机放置策略</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/955d0a793d4af1459141f34f0d8ba7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ipP4mEbiAh8CX8Ih"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Josep Castells 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5a64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有一个公开可用的解决方案通常意味着你需要在某个地方<em class="lv"/>部署并保持它的工作。如今“<em class="lv">某处</em>”经常是云环境。这是一个灵活的解决方案，您可以从小规模开始，随着业务的增长而增加容量。然而，不管您拥有什么样的系统，您都需要使它高度可用，以便用户可以依赖它。</p><p id="43ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">云环境使得构建可靠的系统成为可能，但这并不意味着云本身不会出现故障。事情不是这样的。您需要意识到并让您的系统准备好处理故障，而不是相信您使用的所有云组件总是可用的。</p><p id="2120" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来了解一下对于提高系统可用性至关重要的主要云概念。</p><h1 id="a281" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">缩放比例</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/63e43d06a51564644e2cae934c813aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Gl7WRGVvGw8AGNBM2-2cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">垂直与水平缩放(图片由作者提供，使用<a class="ae ky" href="https://pixabay.com/pl/vectors/monitor-ekran-komputer-elektronika-1130493/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上<a class="ae ky" href="https://pixabay.com/pl/users/1117826-1117826/" rel="noopener ugc nofollow" target="_blank"> 1117826 </a>的监视器图片)。</p></figure><p id="e44c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让您的系统为不断变化的负载做好准备并保持所需的最小容量是确保高可用性的一种方式。当你开始小的时候，大的负载不是问题，但是，使用云机制比如scale sets仍然是一个好主意。他们可以保持系统需要启动的最少数量的虚拟机。如果出现意外事件，比如机器停机，那么scale set规则应该会为您创建一个新的实例。有两种主要的缩放方式，水平缩放和垂直缩放。</p><p id="dfa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">水平扩展</strong>意味着向堆栈中添加或移除相同类型的实例(如虚拟机实例或运行应用程序的容器)。就其使用的资源而言，新实例与其他实例相同，并且能够处理负载。也称为<strong class="lb iu">向外扩展</strong>(增加实例数量)和<strong class="lb iu">向内扩展</strong>(减少实例数量)。要水平扩展，您的系统需要为此做好准备，并且每个实例都必须能够独立工作。当需要某种同步时，这在有状态系统的情况下尤其重要。</p><p id="9be4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">垂直扩展</strong>是在您增加一个实例的资源时完成的。您可以添加更多的RAM、CPU、GPU、磁盘空间或任何其他资源。就像让你的机器变得更强大，这一点在本节开头的图片中有很好的描述。垂直扩展也称为<strong class="lb iu">向上扩展</strong>(添加资源)或<strong class="lb iu">向下扩展</strong>(移除资源)。这种扩展的主要缺点是，有时需要停止一个实例，添加资源，然后重新启动。它会引起混乱。使用水平缩放时，情况并非如此。</p><p id="c5b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">扩展您的系统不是一件容易的事情。如果负载波动很大，可能很难找到保持低成本并为高需求做好准备的方法。通常，您可以使用系统的不同指标来构建缩放规则。CPU利用率、内存量或磁盘空间是这些指标的一些示例。您还可以考虑使用诸如到达系统的请求数量、队列容量(如果使用的话)或任何与负载变化相关的特定信息等指标。对于更复杂的情况，甚至有机器学习算法帮助找到最佳的缩放规则。</p><h1 id="dc58" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">多区域部署</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/e151b71dbbab0dacedb99be8bd97d40a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAbhiCQKEb4dk0vb00R1pQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本云单位(图片由作者使用<a class="ae ky" href="https://pixabay.com/pl/users/camellia_sasanqua-2366387/" rel="noopener ugc nofollow" target="_blank"> camelia_sasquana </a>在<a class="ae ky" href="https://pixabay.com/pl/vectors/cloud-computing-czarny-bia%C5%82y-1924338/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上的云图制作)。</p></figure><p id="4c98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在云环境中，系统部署在称为<strong class="lb iu">区域</strong>的单元中。区域是一个或一组彼此靠近的数据中心。区域内部还有一个更细粒度的单元，称为<strong class="lb iu">可用性区域</strong>。每个可用性分区是一个区域内的单个数据中心。</p><p id="6e27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">区域和可用性区域都很好地服务于系统的可用性。此外，当您在西欧和美国东部等不同地区部署该系统时，用户可以受益于<strong class="lb iu">更低的延迟</strong>，因为他们将连接到最近的实例。</p><p id="561a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将您的系统部署在不同的区域和/或不同的可用性区域中，可以使其更好地抵御区域故障。它只是给你的架构增加了更多的冗余。当你使用的云服务在你所在的地区出现故障时，你仍然有另一个运行良好的地区。这是多区域部署背后的主要思想。</p><p id="622c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时整个地区或几个地区可能会下降，这种情况很少见，但也有可能发生。在这种情况下，如果你使用一个云提供商，你不能做太多。另一方面，使用多个提供商和多个地区是很昂贵的，所以你需要计算什么是最适合你的选择。</p><p id="5631" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在不同的云环境中有多少区域可用？再来看看Azure和AWS。</p><p id="2847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Azure [1]中有:</p><ul class=""><li id="6cd7" class="mp mq it lb b lc ld lf lg li mr lm ms lq mt lu mu mv mw mx bi translated">51个地区</li><li id="a121" class="mp mq it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">至少有3个可用区域的12个区域</li></ul><p id="3579" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在AWS [2]中，您可以使用:</p><ul class=""><li id="4809" class="mp mq it lb b lc ld lf lg li mr lm ms lq mt lu mu mv mw mx bi translated">25个地区</li><li id="ef7c" class="mp mq it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">72个可用区域</li><li id="856c" class="mp mq it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">除大阪外，每个地区至少有2个可用区</li></ul><p id="7a67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，这些供应商选择了不同的策略。微软将区域和可用性区域作为扩展，而亚马逊选择为每个区域配备可用性区域，但区域较少。无论您选择哪种解决方案，它都将符合您的高可用性要求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/45730a381d2c9408f76a8ad5e39387cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QtKn1BE6kB97zgGsLvg4uQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">比例集vs可用区域vs区域(图片由作者提供，使用图片由<a class="ae ky" href="https://pixabay.com/pl/users/camellia_sasanqua-2366387/" rel="noopener ugc nofollow" target="_blank"> camelia_sasquana </a>、<a class="ae ky" href="https://pixabay.com/pl/users/1117826-1117826/" rel="noopener ugc nofollow" target="_blank"> 1117826 </a>、<a class="ae ky" href="https://pixabay.com/pl/users/openclipart-vectors-30363/" rel="noopener ugc nofollow" target="_blank">openclipbart-Vectors</a>on<a class="ae ky" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank">pix abay</a>)。</p></figure><p id="b338" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你决定采用多区域策略，你需要考虑你的架构是否适合它。假设您有一个可以部署在多个地区的系统，每个部署都可以独立工作。在这种情况下，没有问题，您可以选择适合您的用户需求的任何地区或可用区域。</p><p id="b38a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您的系统具有需要相互通信并通过网络发送大量数据的组件，多区域部署可能会损害其性能。在图中，您可以看到可用性和延迟之间的权衡。</p><p id="a3f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您选择只有一个区域，一个可用性区域，您的实例将在一个数据中心。它会降低可用性，因为如果数据中心停机，系统也会停机。但是，系统组件将彼此靠近放置，因此它将具有最低的延迟。</p><p id="8e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您选择在一个区域内的许多可用性区域中部署系统，那么您将把实例分散到不同的数据中心。它将增加您系统的理论可用性。您会增加一些延迟，但是，可用性区域是通过快速光纤网络连接的，所以应该不会太差。</p><p id="7d00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，如果您进行多区域部署，您的组件将在很远的距离之间进行通信。它具有最高的可用性，因为各地区相距遥远，自然灾害不应影响多个地区。但是区域之间的延迟将比其他情况高得多。</p><h1 id="b5ac" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">虚拟机放置策略</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/1c64122eeff6dfd5563652856c79b1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_oUFLkjkR87k_J98_byLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS虚拟机放置组(图片由作者使用服务器图片由<a class="ae ky" href="https://pixabay.com/pl/users/clker-free-vector-images-3736/" rel="noopener ugc nofollow" target="_blank"> Clker-Free-Vector-Images </a>在<a class="ae ky" href="https://pixabay.com/pl/vectors/komputer-serwer-przyciski-pc-305534/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上制作)。</p></figure><p id="735d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论您选择哪种策略，最终都会在一个数据中心内至少有一个部署。这就是为什么了解故障域和更新域很重要。</p><p id="61f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实例可以位于相同或不同的<strong class="lb iu">故障域</strong>。一个故障域基本上是一个带电源的机架。如果故障域停止运行，机架中的所有实例也会停止运行。您可以检查在您选择的区域中有多少个可用的故障域。</p><p id="44b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更新域的工作方式与故障域相同，但当云提供商引入更改(如修补操作系统)或需要运行一些维护操作时，它们会有所帮助。如果实例分布在不同的更新域中，您可以确保在维护期间只有一部分实例(在一个更新域中)不可用。</p><p id="d796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在AWS中，您还可以定义虚拟机放置组。他们有三种类型。集群类型将实例放在一个机架上。Partition使您能够创建一个逻辑分区，并决定哪个实例去哪个分区。最后，spread(默认)试图尽可能多地调度实例，这样它们就不太容易受到中断的影响。</p><h1 id="0a32" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">我为什么要在乎？</h1><p id="07df" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">好吧，但是为什么我需要理解和照顾它？我只是一个云用户，我为服务付费，我想让它工作。正如我之前所写的，使用云并不意味着你可以忽略它是如何工作的。您负责系统的架构并使其高度可用。</p><p id="d576" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用一个例子来描述一下。在我们的理论系统中，我们有一个Apache Zookeeper集群[1]。这是一个支持分布式系统协调的工具。它有助于分布式配置和状态。</p><p id="5c67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">动物园管理员需要在法定人数内工作。非常特别的法定人数。基本上你需要有2N + 1个动物园管理员。n是自然数。最小的高可用性设置包含三个动物园管理员。一个宕机，群集可以正常工作，但是，如果两个宕机，整个群集都会宕机。假设您不太在意，并且在具有两个故障域(机架)的数据中心中部署了您的动物园管理员。动物园管理员会这样传播:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/f0deda705c710ef2917fa7d6e7d733dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlK3FWwTphgvPzgnMqc5Cg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动物园管理员分布在两个故障域(图片由作者提供，使用<a class="ae ky" href="https://svn.apache.org/repos/asf/comdev/project-logos/originals/zookeeper.svg" rel="noopener ugc nofollow" target="_blank"> Apache Zookeeper徽标</a>)。</p></figure><p id="ad1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当其中一个机架损坏时，您的群集有50%的几率会停机。因此，您的系统并不真正具有高可用性，一次故障就会导致系统停机:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/eb0b567aeb7cb87220e3aedd69f02c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RfEUlczt64AWNmYuqEFKqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">有两个动物园管理员的机架下降(图片由作者提供，使用<a class="ae ky" href="https://svn.apache.org/repos/asf/comdev/project-logos/originals/zookeeper.svg" rel="noopener ugc nofollow" target="_blank"> Apache Zookeeper徽标</a>)。</p></figure><p id="1d37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧，也许我们可以衡量动物园管理员？让我们假设N = 2，在这样的设置中，两个动物园管理员可以毫无问题地倒下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/c478e9050b4f1142529aaee77368e821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCn7AKaFJJ4EURgJS36Weg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">5个实例的Zookeepers集群(图片由作者提供，使用<a class="ae ky" href="https://svn.apache.org/repos/asf/comdev/project-logos/originals/zookeeper.svg" rel="noopener ugc nofollow" target="_blank"> Apache Zookeeper徽标</a>)。</p></figure><p id="8d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，请稍等，如果您只有两个机架，它们可以像这样展开(最佳情况):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/95b0cd9f717be49aa9ab98634200ae80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWCbb4EnAVgCPNHRE1YO0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三个动物园管理员的架子放下来了(图片由作者提供，使用<a class="ae ky" href="https://svn.apache.org/repos/asf/comdev/project-logos/originals/zookeeper.svg" rel="noopener ugc nofollow" target="_blank">阿帕奇动物园管理员标志</a>)。</p></figure><p id="bca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，这没有多大帮助。你的集群就像三个动物园管理员一样脆弱。这说明了为什么理解幕后发生的事情很重要。</p><h1 id="ff26" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">准备好！</h1><p id="a5bf" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们讨论了三个基本但有用的概念，它们有助于使您的系统高度可用。将它们与设计良好的体系结构一起实现将提高服务的可用性，并使它们为意外但可能发生的事件做好准备。相信我，如果你使用云，你迟早会体验到。</p><p id="95b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参考书目:</strong></p><ol class=""><li id="1f2b" class="mp mq it lb b lc ld lf lg li mr lm ms lq mt lu nn mv mw mx bi translated"><a class="ae ky" href="https://azure.microsoft.com/en-us/global-infrastructure/geographies/" rel="noopener ugc nofollow" target="_blank">https://azure . Microsoft . com/en-us/global-infra structure/geographies/</a></li><li id="4e5b" class="mp mq it lb b lc my lf mz li na lm nb lq nc lu nn mv mw mx bi translated"><a class="ae ky" href="https://aws.amazon.com/about-aws/global-infrastructure/regions_az/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/about-AWS/global-infra structure/regions _ az/</a></li><li id="e100" class="mp mq it lb b lc my lf mz li na lm nb lq nc lu nn mv mw mx bi translated"><a class="ae ky" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank">https://zookeeper.apache.org/</a></li></ol></div></div>    
</body>
</html>