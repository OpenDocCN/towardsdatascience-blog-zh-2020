<html>
<head>
<title>Setting up a C++ project in Visual Studio 2019 with LibTorch 1.6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LibTorch 1.6在Visual Studio 2019中设置C++项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-up-a-c-project-in-visual-studio-2019-with-libtorch-1-6-ad8a0e49e82c?source=collection_archive---------8-----------------------#2020-11-15">https://towardsdatascience.com/setting-up-a-c-project-in-visual-studio-2019-with-libtorch-1-6-ad8a0e49e82c?source=collection_archive---------8-----------------------#2020-11-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="88d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于如何使用python在PyTorch中训练模型，如何使用flask或者Amazon SageMaker部署模型等等的教程数不胜数。然而，关于如何在C++中工作的资源是有限的，对于Visual Studio项目设置来说更是如此。当你想在现实世界的应用程序中使用你的模型时，速度是你关心的问题，并且由于隐私/安全的考虑，你不想把模型存储在云上，那么你需要求助于我们的老朋友C++。</p><p id="3306" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Pytorch现在对C++有了很好的支持，从v1.3.0开始就有了。他们有很好的关于如何使用C++前端的教程，可以在这里找到:<a class="ae ko" href="https://pytorch.org/tutorials/advanced/cpp_frontend.html" rel="noopener ugc nofollow" target="_blank">https://pytorch.org/tutorials/advanced/cpp_frontend.html</a></p><p id="5383" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">他们利用cmake来构建他们的应用程序，并且没有针对广泛用于C++开发的Visual Studio的官方文档。在本教程中，我将解释如何在最新的Visual Studio 2019版本上以发布和调试模式设置torchlib项目。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="527e" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">第一步</h1><p id="aee9" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">从这个<a class="ae ko" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank">链接</a>下载安装Visual Studio 2019社区版。安装时选择“使用C++进行桌面开发”,这将安装所有必需的组件。</p><h1 id="d9d7" class="kw kx it bd ky kz lz lb lc ld ma lf lg lh mb lj lk ll mc ln lo lp md lr ls lt bi translated">第二步</h1><p id="d2e8" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">你必须从PyTorch下载<a class="ae ko" href="https://pytorch.org/get-started/locally/" rel="noopener ugc nofollow" target="_blank">页面下载LibTorch压缩文件。</a>我选择了不支持Cuda的Windows版本。如果您有GPU，可以选择安装在您机器上的Cuda版本。下载链接出现在“运行此命令”行中。我已经把CPU版本的贴在这里了。</p><ul class=""><li id="9e32" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated"><a class="ae ko" href="https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-1.6.0%2Bcpu.zip" rel="noopener ugc nofollow" target="_blank"> Windows CPU Only C++发布版本</a></li><li id="d0b7" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated"><a class="ae ko" href="https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-debug-1.6.0%2Bcpu.zip" rel="noopener ugc nofollow" target="_blank"> Windows CPU Only C++调试版本</a></li></ul><p id="1fa1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您必须解压缩这两个文件，然后有选择地移动到存储库文件夹。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ms"><img src="../Images/804adc256cc7fc696effd72bf68c678f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZW-bFj_Z3OZukor3"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:<a class="ae ko" href="https://pytorch.org/get-started/locally/" rel="noopener ugc nofollow" target="_blank">https://pytorch.org/get-started/locally/</a></p></figure><h1 id="0278" class="kw kx it bd ky kz lz lb lc ld ma lf lg lh mb lj lk ll mc ln lo lp md lr ls lt bi translated">第三步</h1><p id="8020" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">先说Visual Studio中的C++项目。创建新项目</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ni"><img src="../Images/758f996d0f39c17f4d486d7213b6fcb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jCSjxXz6hzJ583Fv"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><h1 id="6201" class="kw kx it bd ky kz lz lb lc ld ma lf lg lh mb lj lk ll mc ln lo lp md lr ls lt bi translated">第四步</h1><p id="bf2f" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">项目设置中需要为项目正常工作而设置的设置很少。文件夹结构如下。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/98fdfc0d3fc08f1dc08d87baeb56c919.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/0*_SRLYaLqh9_qLBEv"/></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><p id="4590" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从C/C++设置下的附加包含目录开始。请注意，您可以用提取LibTorch库的绝对路径来替换它们。您需要添加以下两个条目:</p><p id="32ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">发布配置:</strong></p><ul class=""><li id="7274" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">$(项目目录)..\..\..\ lib torch-win-shared-with-deps-1 . 6 . 0+CPU \ lib torch \ include</li><li id="3ce5" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">$(项目目录)..\..\..\ lib torch-win-shared-with-deps-1 . 6 . 0+CPU \ lib torch \ include \ torch \ CSRC \ API \ include</li></ul><p id="8a5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">调试配置:</strong></p><ul class=""><li id="0598" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">$(project dir)……\ lib torch-win-shared-with-deps-debug-1 . 6 . 0+CPU \ lib torch \ include</li><li id="da02" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">$(project dir)……\ lib torch-win-shared-with-deps-debug-1 . 6 . 0+CPU \ lib torch \ include \ torch \ CSRC \ API \ include</li></ul><p id="60a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">$(ProjectDir)是一个扩展到项目目录路径的visual studio宏。我们返回三个目录以获得LibTorch文件夹，然后指定相对路径。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nk"><img src="../Images/37763cea7c43b1767c18ca6c10b324a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BfC9qx4i9HFadB-e"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><p id="057e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们将C/C++ →语言→一致性模式下的一致性模式设置设置为No。或者选择所有配置并更改此设置。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nk"><img src="../Images/b6a5ccdcf57fa50fcd0ab438eac21ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nQFAc136dTRny5vm"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><p id="3cfc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，是链接器设置。我们从General选项卡下的附加库目录开始。</p><p id="4e9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">发布配置:</strong></p><ul class=""><li id="d5eb" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">$(project dir)……\ lib torch-win-shared-with-deps-1 . 6 . 0+CPU \ lib torch \ lib</li></ul><p id="9dc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">调试配置:</strong></p><ul class=""><li id="6c53" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">$(project dir)……\ lib torch-win-shared-with-deps-debug-1 . 6 . 0+CPU \ lib torch \ lib</li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nk"><img src="../Images/85bdd86535128999bf3a51589abd3697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JfevQMP6E_lpVsbx"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><p id="a52d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来是输入选项卡。我们需要在这里指定附加的依赖项。</p><ul class=""><li id="c44d" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated"><strong class="js iu"> CPU版本:</strong> torch_cpu.lib，c10.lib，torch.lib</li><li id="3592" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated"><strong class="js iu"> GPU版本:</strong> torch.lib，torch_cuda.lib，caffe2_nvrtc.lib，c10.lib，c10_cuda.lib，torch_cpu.lib，-包含:？warp _ size @ cuda @ at @ @ YAHXZ(<a class="ae ko" href="https://github.com/pytorch/pytorch/issues/31611#issuecomment-594383154" rel="noopener ugc nofollow" target="_blank">https://github . com/py torch/py torch/issues/31611 # issue comment-594383154</a></li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nk"><img src="../Images/42ffd211c50960dada17c39eff5c4292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*66Je5l3bFff9tZOP"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><p id="876f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们需要将DLL文件复制到项目中。您可以手动执行此操作，或者将这些xcopy命令添加到构建事件→后期构建事件→命令行中。我已经编写了复制所有dll的命令。但是，您可以只选择和复制您需要的那些。</p><p id="3c73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nl nm nn no b">xcopy $(ProjectDir)..\..\..\libtorch-win-shared-with-deps-1.6.0+cpu\libtorch\lib\*.dll $(SolutionDir)$(Platform)\$(Configuration)\ /c /y</code></p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nk"><img src="../Images/57dade4b74ad2476db63562852aee6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0XFrvrBZa_EmjoK_"/></div></div><p class="ne nf gj gh gi ng nh bd b be z dk translated">来源:作者</p></figure><p id="25a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就完成了在Visual Studio 2019中设置您的LibTorch 1.6项目。</p><p id="bf5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，为了测试您的项目是否有效，让我们添加一个来自PyTorch repo examples for c++的示例项目<a class="ae ko" href="https://github.com/pytorch/examples/tree/master/cpp/mnist" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e0f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你必须从<a class="ae ko" href="http://yann.lecun.com/exdb/mnist/" rel="noopener ugc nofollow" target="_blank">这个链接下载MNIST数据集。</a>请下载所有四个文件，并将它们解压缩到之前结构中显示的数据文件夹中。只要确保提取工具没有用点替换其中一个连字符，因为那会导致代码抛出异常。我已经在这个资源库中提供了解决方案文件和代码:<a class="ae ko" href="https://github.com/msminhas93/libtorch-mnist-visual-studio/tree/main/LearningLibTorch" rel="noopener ugc nofollow" target="_blank">https://github . com/msminhas 93/lib torch-Mn ist-visual-studio/tree/main/learning lib torch</a>。输出应该如下所示:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi np"><img src="../Images/ee4ae4c508e75f8ad5826ff84d11f519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PavmPvnszD20COXg"/></div></div></figure><p id="e225" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">希望这有用。欢迎您的建议、反馈和评论。</p><h2 id="c4d0" class="nq kx it bd ky nr ns dn lc nt nu dp lg kb nv nw lk kf nx ny lo kj nz oa ls ob bi translated">参考</h2><p id="9dca" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">[1]<a class="ae ko" href="https://medium.com/@boonboontongbuasirilai/building-pytorch-c-integration-libtorch-with-ms-visual-studio-2017-44281f9921ea" rel="noopener">https://medium . com/@ boontongbuasirilai/building-py torch-c-integration-lib torch-with-ms-visual-studio-2017-44281 f 9921 ea</a></p><p id="a870" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[2]<a class="ae ko" href="https://github.com/pytorch/examples/tree/master/cpp/mnist" rel="noopener ugc nofollow" target="_blank">https://github.com/pytorch/examples/tree/master/cpp/mnist</a></p><p id="7897" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="http://yann.lecun.com/exdb/mnist/" rel="noopener ugc nofollow" target="_blank">http://yann.lecun.com/exdb/mnist/</a></p><p id="efea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[4]<a class="ae ko" href="https://github.com/pytorch/pytorch/issues/31611#issuecomment-594383154" rel="noopener ugc nofollow" target="_blank">https://github . com/py torch/py torch/issues/31611 # issue comment-594383154</a></p></div></div>    
</body>
</html>