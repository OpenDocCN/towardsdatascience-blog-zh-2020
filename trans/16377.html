<html>
<head>
<title>Data science at scale with PySpark on Amazon EMR cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在亚马逊EMR集群上使用PySpark实现大规模数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-at-scale-with-pyspark-on-amazon-emr-cluster-622a0f4534ed?source=collection_archive---------39-----------------------#2020-11-11">https://towardsdatascience.com/data-science-at-scale-with-pyspark-on-amazon-emr-cluster-622a0f4534ed?source=collection_archive---------39-----------------------#2020-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="aed2" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/making-sense-of-big-data" rel="noopener" target="_blank">理解大数据</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/13021a80938ddfa9748ba64d5a48d0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1ZiGlDXZB_MC6Ksi"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/@wflwong?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">王华伦</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8f03" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你有没有遇到过这样的情况，你的计算机无法处理你试图处理的数据？我知道我有。嗯，所以你可能正在处理一个大数据，它很可能太大太复杂，无法由CPU上的一台机器来处理。那么，我们所说的大数据是指什么？多少数据才算大数据？嗯，我们可以无休止地争论这个问题——所以我们不要在这里争论了。相反，我们只能说，你有足够大的数据，而你的计算机正在努力处理它。希望你的机器不会冒出任何火焰或烟雾。玩笑归玩笑，这是一个非常常见的问题，解决它的最常见方法是在分布式计算平台上处理如此大的数据集。Apache Spark是一个开源的并行计算框架，旨在支持在计算机集群上处理这样的大型数据集。</p><p id="9161" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">有一些不同的分布式计算平台提供商可供选择，一些流行的选择包括Cloudera、Hortonworks、Databricks、Amazon AWS和Microsoft Azure。在本文中，我将向您展示如何在AWS cloud上为您的需求建立一个分布式计算平台，特别是Amazon EMR。我们将使用PySpark，它是Apache Spark的Python API。</p><p id="fb89" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在Amazon EMR上设置PySpark之前，请确保您具备以下条件:</p><ol class=""><li id="e851" class="lk ll iq ko b kp kq kt ku kx lm lb ln lf lo lj lp lq lr ls bi translated">在AWS上创建帐户</li><li id="be1b" class="lk ll iq ko b kp lt kt lu kx lv lb lw lf lx lj lp lq lr ls bi translated">创建EC2密钥对</li><li id="f0d2" class="lk ll iq ko b kp lt kt lu kx lv lb lw lf lx lj lp lq lr ls bi translated">创建EC2安全组</li></ol><h2 id="15f3" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤1:在AWS服务中找到Amazon EMR</h2><p id="9551" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">现在您有了一个帐户，浏览AWS服务并找到EMR。下面是一个例子。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mv"><img src="../Images/58c6e5d9c7e8f82013a41264302daa06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdGaDZu9OnLx1Fr7yMSd5Q.png"/></div></div></figure><h2 id="da0a" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤2:创建集群</h2><p id="7a88" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">一旦进入EMR，找到显示“创建集群”的按钮并点击它。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi na"><img src="../Images/5f80476b84cfb9dfcf2d9e4487f6fe3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tdBXSZ1C2rvXVWHoQ6qzkA.png"/></div></div></figure><h2 id="7976" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤3:转到高级选项</h2><p id="3eb2" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">点击“创建集群”后，您将看到一个类似的页面，然后点击“转到高级选项”</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nb"><img src="../Images/8e61ae03370c64754946408351acf85f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PokwO117WD6woTzw1VNDPg.png"/></div></div></figure><h2 id="7ea2" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤4:软件和步骤</h2><p id="4df6" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">对于EMR版本，我选择emr-5.31.0，因为这是在本文发布时的最新版本(不是测试版)。然后，我选择Hadoop和Spark，因为这是我需要预安装在集群上来完成标记工作的另外两个软件。一旦选择了这些选项，就没有必要再去搞乱其他选项了，所以请继续操作，然后单击下一步。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nc"><img src="../Images/0f4a07fd794d3102dc93a93f7d84fd92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6GGLYBrcWSiD2ZqmvC_rA.png"/></div></div></figure><h2 id="ef1e" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">第五步:硬件选择</h2><p id="8181" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">在本节中，您将为集群的主节点和工作节点选择硬件类型。首先，在页面的上部，为实例组配置选择“统一实例组”。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nd"><img src="../Images/be072f9114708892d05a97009c8ecfe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hUMHNXnLejhRyPByQJgOA.png"/></div></div></figure><p id="8323" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后向下滚动，找到如下所示的页面部分，并选择硬件类型。理想情况下，您的工作节点需要合理数量的CPU和内存。我选择m5.xlarge作为主节点和核心/工作节点，因为它们足以满足我对数据集大小的预处理需求。根据数据集和您想要实现的目标，您可以选择所需的正确的CPU和内存量。请注意，我请求了两个核心/工作节点实例。您可以根据手头任务的需要使用这个数量的实例。您还会看到任务节点显示在核心/工作节点下，您在本练习中不需要它们，因此可以忽略。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nb"><img src="../Images/f0866b42a648cad1294df0dc6baef60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ky0xdl0CgESOmQ0OIs6Oqg.png"/></div></div></figure><p id="44b6" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">完成上述选择后，将其余选项保留为默认值，然后按下一步。</p><h2 id="5a5d" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤6:常规集群设置</h2><p id="c1fe" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">在此部分中，选择集群的名称。你想取什么名字都可以。这取决于你是否选择日志记录，我通常会关闭它，因为它会存储S3的每一个EMR日志，这些日志往往会占用S3的空间。但是最佳实践建议让它开着。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ne"><img src="../Images/3cabb62d2f16c5be83d172f9c88263d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9bcTk_cgEhFC4Q2KMXfNw.png"/></div></div></figure><p id="829d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">将此页面上的其余选项保留为默认设置，然后单击Next。</p><h2 id="016a" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤7:配置安全性</h2><p id="b998" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">这一节很重要！在此部分中，您将配置两件事情:</p><ol class=""><li id="848e" class="lk ll iq ko b kp kq kt ku kx lm lb ln lf lo lj lp lq lr ls bi translated">EC2密钥对</li><li id="133e" class="lk ll iq ko b kp lt kt lu kx lv lb lw lf lx lj lp lq lr ls bi translated">安全组</li></ol><p id="d643" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">选择EC2密钥对和您之前创建的安全组，最后单击“Create cluster”</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nf"><img src="../Images/954a558e52ad689fc89495443703cc78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POWo2hkvM6-jrkU3L6W9Ag.png"/></div></div></figure><p id="443b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，在创建新的EMR集群时，您将看到如下页面</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ng"><img src="../Images/996480e18b95148e85411e67646b844d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFK-JXF-OddifjXHPKuk5Q.png"/></div></div></figure><p id="a015" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">创建后，您的群集的状态将从“正在启动”变为“正在等待”，这意味着您的群集现在可以使用了。</p><h2 id="0fea" class="ly lz iq bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp iw bi translated">步骤8:在EMR上创建一个笔记本实例</h2><p id="0740" class="pw-post-body-paragraph km kn iq ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">现在您需要一个Jupyter笔记本来使用PySpark与您新创建的集群的主节点一起工作。为此，请单击左侧横幅上的“笔记本”，然后单击“创建笔记本”。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nh"><img src="../Images/1cf703b23a2030e412fa9c4ea7872bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0n7M2npsut7f4Jvroicttw.png"/></div></div></figure><p id="94a9" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在下一页中，为您的笔记本命名，然后单击集群下的“选择”,然后在那里找到并选择您新创建的集群。最后，在S3上选择一个与笔记本相关联的位置来读写数据。请记住将“AWS服务角色”保留为默认值。然后点击“创建笔记本”，瞧。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ni"><img src="../Images/4f876757815c71f3b074becfa00e2192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQFeJSRylEheraGKdLX4iA.png"/></div></div></figure><p id="9f96" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，您有了一个Jupyter笔记本，它连接到新创建的EMR集群的主节点，该集群预装了Hadoop和Spark。您已经准备好在Amazon EMR集群上使用PySpark处理您的大数据。</p><p id="d76c" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">警告:</strong>当你完成后，记得停止你的笔记本并终止你的集群！！！否则，您将在您的下一个AWS法案中产生巨大的成本！！！</p><p id="33a0" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">享受使用Amazon EMR集群上强大的Apache Spark处理大数据的乐趣吧！</p><p id="0a02" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果你觉得这篇文章有用，我很乐意在下面以鼓掌或评论的形式得到你的反馈。让我们在LinkedIn 上联系</p><p id="17c8" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">谢谢大家！</p></div></div>    
</body>
</html>