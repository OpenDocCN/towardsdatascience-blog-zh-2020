<html>
<head>
<title>efsync my first open-source MLOps toolkit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">efsync我的第一个开源MLOps工具包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/efsync-my-first-open-source-mlops-toolkit-4af6181d16d6?source=collection_archive---------39-----------------------#2020-11-05">https://towardsdatascience.com/efsync-my-first-open-source-mlops-toolkit-4af6181d16d6?source=collection_archive---------39-----------------------#2020-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a9fb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">自动将Python依赖项和ML模型同步到AWS Lambda函数的AWS EFS</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c6099b90b56ca14e07d92e5e5c373dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApeMKT5ypk94oe5JfBNfAA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谢栋豪在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0d6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">原载于</em><a class="ae kv" href="https://www.philschmid.de/efsync-my-first-open-source-mlops-toolkit" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://www . philschmid . de</em></a><em class="ls">。</em></p><h1 id="492e" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">介绍</h1><p id="6c52" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在生产中成功使用机器学习的一部分是MLOps的使用。MLOps通过持续培训(CT)增强DevOps。因此，MLOps的主要组成部分包括持续集成(CI)、持续交付(CD)和持续培训(CT)。<a class="ae kv" href="https://blogs.nvidia.com/blog/2020/09/03/what-is-mlops/" rel="noopener ugc nofollow" target="_blank"> Nvidia写了一篇文章详细介绍了什么是MLOps。</a></p><p id="54f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我叫菲利普，住在德国的纽伦堡。目前，我在一家科技孵化创业公司担任机器学习工程师。在工作中，我为金融科技和保险公司设计并实现了云原生机器学习架构。我是无服务器和以无服务器方式提供机器学习模型的忠实粉丝。我已经写了两篇关于如何在AWS Lambda这样的无服务器环境中使用BERT这样的深度学习模型的文章。</p><p id="556a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在使用像<a class="ae kv" href="https://aws.amazon.com/de/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>、<a class="ae kv" href="https://cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank"> Google Cloud Functions </a>、<a class="ae kv" href="https://azure.microsoft.com/de-de/services/functions/" rel="noopener ugc nofollow" target="_blank"> Azure Functions </a>这样的工具进行无服务器机器学习时，要克服的一个大障碍是存储。Tensorflow 和<a class="ae kv" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> Pytorch </a>的尺寸很大，像BERT这样的新型“艺术级”模型的尺寸超过300MB。</p><p id="55a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今年7月，AWS增加了对<a class="ae kv" href="https://aws.amazon.com/efs/?nc1=h_ls" rel="noopener ugc nofollow" target="_blank">亚马逊弹性文件系统(EFS) </a>的支持，这是一个适用于AWS Lambda的可扩展的弹性NFS文件系统。这允许我们将AWS EFS文件系统挂载到AWS Lambda函数。</p><p id="0803" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">直到今天，将依赖项或模型文件同步到AWS EFS文件系统还是非常困难的。你可以用<a class="ae kv" href="https://docs.aws.amazon.com/efs/latest/ug/gs-step-four-sync-files.html" rel="noopener ugc nofollow" target="_blank"> AWS Datasync </a>来做这件事，或者你可以在同一个子网和VPC中启动一个EC2实例，并从那里上传你的文件。</p><p id="f8a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我构建了一个名为<a class="ae kv" href="https://github.com/philschmid/efsync" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> efsync </strong> </a>的MLOps工具包。Efsync是一个CLI/SDK工具，它自动将文件从S3或本地文件系统同步到AWS EFS，并使您能够将AWS Lambda运行时的依赖项直接安装到您的EFS文件系统中。CLI易于使用，您只需要访问一个AWS帐户和一个启动并运行的AWS EFS文件系统。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="04df" class="lt lu iq bd lv lw mx ly lz ma my mc md jw mz jx mf jz na ka mh kc nb kd mj mk bi translated">体系结构</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/400602e8b68f5be1be89d7b0b40daa16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nT7rIrAuCqwA7QBi.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者创建的efsync架构</p></figure></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="093c" class="lt lu iq bd lv lw mx ly lz ma my mc md jw mz jx mf jz na ka mh kc nb kd mj mk bi translated">快速启动</h1><ul class=""><li id="e060" class="nd ne iq ky b kz ml lc mm lf nf lj ng ln nh lr ni nj nk nl bi translated"><strong class="ky ir">通过pip3 </strong>安装</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><ul class=""><li id="c4ac" class="nd ne iq ky b kz la lc ld lf no lj np ln nq lr ni nj nk nl bi translated"><strong class="ky ir">将您的pip依赖项或文件同步到AWS EFS </strong></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="96bb" class="lt lu iq bd lv lw mx ly lz ma my mc md jw mz jx mf jz na ka mh kc nb kd mj mk bi translated">用例</h1><p id="1152" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Efsync涵盖5种使用情形。一方面，它允许您安装所需的依赖项，另一方面，efsync帮助您准备好您的模型，无论是通过从S3到EFS的同步还是使用SCP的本地上传。我为每个用例创建了一个示例<a class="ae kv" href="https://github.com/philschmid/efsync#--examples" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>。</p><p id="0c63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这5个使用案例包括:</p><ul class=""><li id="eaec" class="nd ne iq ky b kz la lc ld lf no lj np ln nq lr ni nj nk nl bi translated">将Python与AWS Lambda运行时的依赖项直接安装到EFS文件系统中，并在AWS Lambda函数中使用它们。<a class="ae kv" href="https://github.com/philschmid/efsync/blob/main/examples/efsync_pip_packages.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="ls">例题</em> </a></li><li id="ce07" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">将S3的文件同步到EFS的文件系统。<a class="ae kv" href="https://github.com/philschmid/efsync/blob/main/examples/efsync_s3_files.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="ls">例题</em> </a></li><li id="539b" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">使用SCP将文件上传到EFS文件系统。<a class="ae kv" href="https://github.com/philschmid/efsync/blob/main/examples/efsync_scp_files.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="ls">例题</em> </a></li><li id="152f" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">安装Python依赖项，并从S3同步到EFS文件系统。<a class="ae kv" href="https://github.com/philschmid/efsync/blob/main/examples/efsync_pip_packages_and_s3_files.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="ls">例题</em> </a></li><li id="dd0c" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">用SCP和EFS文件系统安装Python依赖项和上传文件。<a class="ae kv" href="https://github.com/philschmid/efsync/blob/main/examples/efsync_pip_packages_and_scp_files.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="ls">例题</em> </a></li></ul><p id="2144" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">注:</em> </strong> <em class="ls">每个例子都可以在Google Colab中运行。</em></p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="1052" class="lt lu iq bd lv lw mx ly lz ma my mc md jw mz jx mf jz na ka mh kc nb kd mj mk bi translated">实施配置可能性</h1><p id="cb6b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在项目中使用efsync有4种不同的方式:</p><ul class=""><li id="e62a" class="nd ne iq ky b kz la lc ld lf no lj np ln nq lr ni nj nk nl bi translated">您可以创建一个<code class="fe nw nx ny nz b">yaml</code>配置并使用SDK。</li><li id="0e88" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">你可以创建一个python <code class="fe nw nx ny nz b">dict</code>并使用SDK。</li><li id="5503" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">您可以创建一个<code class="fe nw nx ny nz b">yaml</code>配置并使用CLI。</li><li id="506a" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated">您可以使用带参数的CLI。</li></ul><p id="a8f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在<a class="ae kv" href="https://github.com/philschmid/efsync#%EF%B8%8F--configurations" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>中找到每个配置的示例。我还包括了不同用例的配置示例。</p><p id="3224" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">注意</em> </strong> <em class="ls">:如果你用scp从本地目录(如</em> <code class="fe nw nx ny nz b"><em class="ls">model/bert</em></code> <em class="ls">)同步一个文件到efs ( </em> <code class="fe nw nx ny nz b"><em class="ls">my_efs_model</em></code> <em class="ls"> ) efsync会把模型同步到</em> <code class="fe nw nx ny nz b"><em class="ls">my_efs_model/bert</em></code> <em class="ls">，这是因为SCP递归上传文件。</em></p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="a6cb" class="lt lu iq bd lv lw mx ly lz ma my mc md jw mz jx mf jz na ka mh kc nb kd mj mk bi translated">例子</h1><p id="ad71" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">下面的例子展示了如何将Python依赖项安装到EFS文件系统，然后将文件从S3同步到EFS文件系统。出于配置目的，我们必须创建一个<code class="fe nw nx ny nz b">efsync.yaml</code>和一个<code class="fe nw nx ny nz b">requirements.txt</code>文件来保存我们的依赖项和配置。</p><h2 id="7166" class="oa lu iq bd lv ob oc dn lz od oe dp md lf of og mf lj oh oi mh ln oj ok mj ol bi translated"><strong class="ak"> 1。安装efsync </strong></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="c14f" class="oa lu iq bd lv ob oc dn lz od oe dp md lf of og mf lj oh oi mh ln oj ok mj ol bi translated"><strong class="ak"> 2。创建一个</strong> <code class="fe nw nx ny nz b"><strong class="ak">requirements.txt</strong></code> <strong class="ak">和依赖关系</strong></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="4eb2" class="oa lu iq bd lv ob oc dn lz od oe dp md lf of og mf lj oh oi mh ln oj ok mj ol bi translated"><strong class="ak"> 3。用所有需要的配置</strong>创建一个 <code class="fe nw nx ny nz b"><strong class="ak">efsync.yaml</strong></code> <strong class="ak"/></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="7942" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nw nx ny nz b">efsync.yaml</code>包含所有配置，例如:</p><p id="5eb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">标准配置</strong></p><ul class=""><li id="896a" class="nd ne iq ky b kz la lc ld lf no lj np ln nq lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">efs_filesystem_id</code>:AWS EFS文件系统id(挂载点)。</li><li id="bead" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">subnet_Id</code>:EFS文件系统的子网Id，它运行在。</li><li id="42be" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">ec2_key_name</code>:启动EC2实例所需的键名。</li><li id="20bf" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">aws_profile</code>:在<code class="fe nw nx ny nz b">.aws/credentials</code>中配置的具有所需权限的IAM配置文件。</li><li id="b0b7" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">aws_region</code>:EFS文件系统正在运行的AWS区域。</li></ul><p id="3646" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Pip依赖关系配置</strong></p><ul class=""><li id="f646" class="nd ne iq ky b kz la lc ld lf no lj np ln nq lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">efs_pip_dir</code>:EC2上的pip目录，将在此安装依赖项。</li><li id="42c4" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">python_version</code> <strong class="ky ir"> : </strong>用于安装pip包的Python版本- &gt;应该作为lambda运行时使用。</li><li id="08ff" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">requirements</code>:requirements . txt的路径+文件，该文件包含可安装的pip依赖项。</li></ul><p id="98af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> S3配置</strong></p><ul class=""><li id="7a08" class="nd ne iq ky b kz la lc ld lf no lj np ln nq lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">s3_bucket</code> : S3斗名从文件中应下载。</li><li id="f370" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">s3_keyprefix</code> : S3 keyprefix为目录/文件</li><li id="af30" class="nd ne iq ky b kz nr lc ns lf nt lj nu ln nv lr ni nj nk nl bi translated"><code class="fe nw nx ny nz b">file_dir_on_ec2</code>:保存S3文件的目录名</li></ul><h2 id="8252" class="oa lu iq bd lv ob oc dn lz od oe dp md lf of og mf lj oh oi mh ln oj ok mj ol bi translated"><strong class="ak"> 4。运行efsync wit </strong> <code class="fe nw nx ny nz b"><strong class="ak">efsync.yaml</strong></code></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="7377" class="lt lu iq bd lv lw mx ly lz ma my mc md jw mz jx mf jz na ka mh kc nb kd mj mk bi translated">摘要</h1><p id="49a2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">使用<a class="ae kv" href="https://github.com/philschmid/efsync" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">ef sync</strong></a><strong class="ky ir"/>您可以轻松地将文件从S3或本地文件系统自动同步到AWS EFS，并允许您将AWS Lambda运行时的依赖项直接安装到您的EFS文件系统中。从S3安装和同步文件大约需要6分钟，安装依赖项大约需要4-5分钟，同步文件大约需要2分钟。</p><p id="e4f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在Github 上找到库<a class="ae kv" href="https://github.com/philschmid/efsync" rel="noopener ugc nofollow" target="_blank">。如果您有任何问题或改进，请随时创建拉动式请求或问题。</a></p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><p id="1379" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。如果你有任何问题，随时联系我或评论这篇文章。你也可以在<a class="ae kv" href="https://twitter.com/_philschmid" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或者<a class="ae kv" href="https://www.linkedin.com/in/philipp-schmid-a6a2bb196/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上和我联系。</p></div></div>    
</body>
</html>