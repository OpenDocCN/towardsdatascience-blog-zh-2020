<html>
<head>
<title>Highlighted line chart with Plotly.Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly突出显示折线图。表达</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/highlighted-line-chart-with-plotly-express-e69e2a27fea8?source=collection_archive---------25-----------------------#2020-10-12">https://towardsdatascience.com/highlighted-line-chart-with-plotly-express-e69e2a27fea8?source=collection_archive---------25-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d7b9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过在其他线条的灰色背景上突出线条来强调你的观点</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d2d0c5915cecb53aaef4ca30437d255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_rhvSHDIN4nWklDumxSHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">与本文中的所有图片一样，图片由作者提供</p></figure><p id="14ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用python的<a class="ae lu" href="https://plotly.com/python/plotly-express/" rel="noopener ugc nofollow" target="_blank"> Plotly创建交互式图形。从一个数据框表达</a>像一个魔咒。只需一行代码，您就可以探索数据集的基本特征。再添加几行代码，你就可以变出一个非常奇特但非常有故事性的图表。</p><p id="5b51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本练习中，我将向您展示在并发事件的阴影进度顶部绘制一条粗线的过程。它有两个巨大的好处:</p><ol class=""><li id="40ea" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">您想要突出显示的趋势清晰可见</li><li id="14cb" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">灰色背景表示其他事件的分布</li></ol><p id="eb9a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以用储存在<a class="ae lu" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Highlighted_Line_Chart_on_Grey_Lines_Background/Highlight_Lines_on_Grey_Background.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上的笔记本和我一起创建所有的图表。在本文中，您将了解到:</p><ul class=""><li id="c50f" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mj mb mc md bi translated">如何轻松安装</li><li id="c15c" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">如何使用<code class="fe mk ml mm mn b">px.line(df, parameteres)</code>创建<a class="ae lu" href="#abe3" rel="noopener ugc nofollow">线图</a></li><li id="37b8" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">如何使用<code class="fe mk ml mm mn b">fig.update_traces</code>或<code class="fe mk ml mm mn b">color_discrete_map</code>给的一些线条上色</li><li id="af13" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">行的<a class="ae lu" href="#4233" rel="noopener ugc nofollow">顺序很重要</a></li><li id="8276" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">如何<a class="ae lu" href="#7f78" rel="noopener ugc nofollow">在Plotly图表上定位注释</a></li><li id="efab" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">如何使用注释来<a class="ae lu" href="#c34f" rel="noopener ugc nofollow">标记、突出显示、创建图例或描述图表区域</a></li><li id="0e2d" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">如何添加<a class="ae lu" href="#1a69" rel="noopener ugc nofollow">交互按钮</a></li><li id="1886" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated">如何用这种图表来展示<a class="ae lu" href="#1ddc" rel="noopener ugc nofollow">排名的变化</a></li></ul><h1 id="c7c4" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">数据集</h1><p id="a465" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">我将使用两个数据集。第一个是关于世界各地旅游业的进展(<a class="ae lu" href="https://data.worldbank.org/indicator/ST.INT.ARVL" rel="noopener ugc nofollow" target="_blank">游客人数</a>，1995年至2018年215个国家)，第二个显示了过去6年冰球国家队的排名。</p><p id="7b9f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据集在github 上的<a class="ae lu" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Preprocess/Preprocessing.ipynb" rel="noopener ugc nofollow" target="_blank"> preprocess.ipynb notebook中进行预处理，在python的pickle </a>中存储<a class="ae lu" rel="noopener" target="_blank" href="/stop-persisting-pandas-data-frames-in-csvs-f369a6440af5">。</a></p><h1 id="d18a" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">装置</h1><p id="ce7e" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">普洛特利。Express是在版本4.0.0的<a class="ae lu" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> plotly </a>库中引入的，您可以使用以下命令轻松安装它:</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="3c18" class="np mp it mn b gy nq nr l ns nt"># pip <br/>pip install plotly</span><span id="81f9" class="np mp it mn b gy nu nr l ns nt"># anaconda<br/>conda install -c anaconda plotly</span></pre><p id="4a9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly Express还要求安装pandas，否则当你尝试导入时会得到这个错误。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="3c00" class="np mp it mn b gy nq nr l ns nt">[In]: import plotly.express as px<br/>[Out]: <strong class="mn iu">ImportError</strong>: Plotly express requires pandas to be installed.</span></pre><p id="ea2d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想在Jupyter笔记本中使用plotly，还有其他要求。对于Jupyter实验室你需要<code class="fe mk ml mm mn b"><a class="ae lu" href="https://plotly.com/python/getting-started/#jupyterlab-support-python-35" rel="noopener ugc nofollow" target="_blank">jupyterlab-plotly</a></code>。在普通笔记本上，我必须安装<code class="fe mk ml mm mn b">nbformat</code> ( <code class="fe mk ml mm mn b">conda install -c anaconda nbformat</code>)</p><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/visualization-with-plotly-express-comprehensive-guide-eb5ee4b50b57"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">用Plotly可视化。快递:综合指南</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">一个数据集和70多个图表。交互性和动画通常只需一行代码。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><h1 id="abe3" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">带有Plotly Express的基本折线图</h1><p id="5d8e" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">用plotly创建折线图再简单不过了。语法是<code class="fe mk ml mm mn b">px.line(df, parameters)</code>。看起来很简单，但是<a class="ae lu" href="https://plotly.com/python-api-reference/generated/plotly.express.line.html" rel="noopener ugc nofollow" target="_blank">的参数数量</a>是相当大的。值得注意的是。Express喜欢长数据结构(与宽结构相反)，其中每个类别和每个值都是一列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d48fe4aed3f8ef29a958b6d3b8d05578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*iOu1LvlhlZXChv33p2a44A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据的长结构。对于类别/参数的每个组合，在一行中都有值。</p></figure><p id="4303" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将为每个国家画一个折线图，显示所有215个国家每年的游客数量。Plotly可以处理，但图表不会告诉你太多信息。你可以使用右边的菜单图例来关闭/打开线路，但是它太长了，你必须滚动才能找到你的国家。当您将鼠标悬停在这些行上时，会弹出一个工具提示，提供有关数据的详细信息。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="e7c7" class="np mp it mn b gy nq nr l ns nt"># simple line chart with Plotly Express<br/>px.line(long_df, <br/>        x="years", <br/>        y="visitors", <br/>        color="Country Name", <br/>        title="Growth of tourism 1995-2018")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/eb0eb01cbb1b87cba0300e1eb66d5305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dwKuTiTlHuomH8no0xGkYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在这种人口过剩的土地上，你几乎看不到任何趋势</p></figure><h2 id="285d" class="np mp it bd mq op oq dn mu or os dp my lh ot ou na ll ov ow nc lp ox oy ne oz bi translated">仅对所需的线条着色</h2><p id="0b25" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">比方说，为了你的研究或营销目的，你应该介绍日本、🇯🇵和🇹🇷.的旅游业发展所以让我们模糊其他线，给他们一个类似背景的灰色阴影，并通过着色突出日本和土耳其线。你有几个选择来这样做。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="6b89" class="np mp it mn b gy nq nr l ns nt"># first option is to use, .update_traces()<br/>fig = px.line(long_df,<br/>              x="years",<br/>              y="visitors",  <br/>              color="Country Name")</span><span id="743b" class="np mp it mn b gy nu nr l ns nt"># set color of all traces to lightgrey<br/>fig.update_traces({"line":{"color":"lightgrey"}})</span><span id="735d" class="np mp it mn b gy nu nr l ns nt"># color Turkish line to blue<br/>fig.update_traces(patch={"line":{"color":"blue", "width":5}}, <br/>                  selector={"legendgroup":"Turkey"})</span><span id="7c79" class="np mp it mn b gy nu nr l ns nt"># color Japanese line to red<br/>fig.update_traces(patch={"line":{"color":"red", "width":5}}, <br/>                  selector={"legendgroup":"Japan"})</span><span id="6bb7" class="np mp it mn b gy nu nr l ns nt"># remove the legend, y-axis and add a title<br/>fig.update_layout(title="Tourism Growth in Turkey and Japan",<br/>                showlegend=False,<br/>                yaxis={"visible":False})</span><span id="0136" class="np mp it mn b gy nu nr l ns nt"># plot the chart<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/41517ef908c02eeec4c830c90ee33ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrYsNd9h4Rr8DaM1uReNjg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">惊喜吧。这些线条是有颜色的，但是它们上面覆盖着灰色的线条，所以几乎看不见。</p></figure><p id="3595" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe mk ml mm mn b">fig.update_traces({"line":{"color":"lightgrey"}})</code>将所有线条的颜色变为浅灰色。然后我们使用<code class="fe mk ml mm mn b"><a class="ae lu" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html#plotly.graph_objects.Figure.update_traces" rel="noopener ugc nofollow" target="_blank">.update_traces()</a></code>的<code class="fe mk ml mm mn b">patch</code>和<code class="fe mk ml mm mn b">selector</code>自变量。<code class="fe mk ml mm mn b">patch</code>设置生产线的参数，而<code class="fe mk ml mm mn b">selector</code>定义这些参数应用于哪条生产线。</p><p id="0890" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想知道我是如何知道向字典提供哪些值的，那么<code class="fe mk ml mm mn b">{"line":{"color":"blue", "width":5}</code>会改变行的属性，并且<code class="fe mk ml mm mn b">legendgroup</code>是通过<code class="fe mk ml mm mn b">Country name</code>识别行的正确参数。最简单的方法是读取<code class="fe mk ml mm mn b">fig["data"]</code>。每个Plotly图表都是一个字典，当您更新这个字典时，所有参数都可以更改。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="3cfe" class="np mp it mn b gy nq nr l ns nt"><strong class="mn iu">[In]:</strong> fig["data"]<br/><strong class="mn iu">[Out]: <br/></strong>(Scattergl({<br/>     'hovertemplate': 'Country Name=Aruba&lt;br&gt;years=%{x}&lt;br&gt;visitors=%{y}&lt;extra&gt;&lt;/extra&gt;',<br/>     'legendgroup': 'Aruba',<br/>     'line': {'color': 'lightgrey', 'dash': 'solid'},<br/>     'mode': 'lines',<br/>...</span></pre><blockquote class="pb pc pd"><p id="1390" class="ky kz pe la b lb lc ju ld le lf jx lg pf li lj lk pg lm ln lo ph lq lr ls lt im bi translated">每一张图都是一本字典。使用<code class="fe mk ml mm mn b">fig.to_dict()</code>或<code class="fe mk ml mm mn b">fig[“data”]</code>查看数值。</p></blockquote><h2 id="4233" class="np mp it bd mq op oq dn mu or os dp my lh ot ou na ll ov ow nc lp ox oy ne oz bi translated">对行进行排序</h2><p id="24fd" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">但结果并不是我们想要的。我们显示日本和土耳其旅游业发展的轨迹介于两者之间。一些灰线在它们上面，一些在下面。</p><p id="6b81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以尝试Plotly的参数<code class="fe mk ml mm mn b">category_orders</code>来影响行的顺序，但是添加<code class="fe mk ml mm mn b">category_orders={"Country Name":["Japan","Turkey"]})</code>会使情况变得更糟。首先显示这些轨迹，所有灰色线都在它们上面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/9dadc1817d81fb35fff4005093de3c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*daHtnDaCyF0Lvo4iZbKRRQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Category_order参数定义行的顺序。如果您只指定我们想要的，它们会成为第一个。其他的都在上面。</p></figure><p id="5aee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以在最后提供日本和土耳其的完整国家列表，但是对数据框架本身进行排序更容易。我们<code class="fe mk ml mm mn b">.map()</code>向日本订购1，向土耳其订购2，向所有其他线路订购<code class="fe mk ml mm mn b">fillna(3)</code>，然后按照该值对数据帧进行排序。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="5856" class="np mp it mn b gy nq nr l ns nt"># sort the dataframe<br/>sorted_df = long_df.copy()</span><span id="95bd" class="np mp it mn b gy nu nr l ns nt"># map the value order<br/>sorted_df["order"] = sorted_df["Country Name"].map({"Japan": 1, "Turkey": 2}).fillna(3)</span><span id="dfde" class="np mp it mn b gy nu nr l ns nt"># sort by this order<br/>sorted_df.sort_values(by=["order","years"], ascending=False, inplace=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/b776ebcfee1c03208fe822a0cbe2a432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w-78_kMsPwPa4j6T5wmaIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最晚出现的线被画在最上面。</p></figure><p id="4e51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如何给线条上色的另一个选项是为plotly的<code class="fe mk ml mm mn b">color_discrete_map</code>参数提供一个字典，而不是应用<code class="fe mk ml mm mn b">fig.update_traces()</code>。dict结构是<code class="fe mk ml mm mn b">{trace_name: color}</code>。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="cdf2" class="np mp it mn b gy nq nr l ns nt">{'Aruba': 'lightgrey',<br/> 'Zimbabwe': 'lightgrey',<br/>...<br/> 'Turkey': 'red',<br/> 'Japan': 'blue'}</span></pre><p id="eb22" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要改变宽度，可以直接操作Plotly的后端字典。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="4075" class="np mp it mn b gy nq nr l ns nt">for i,d in enumerate(fig["data"]):<br/>    if d["legendgroup"] in ["Japan","Turkey"]:<br/>        fig["data"][i]["line"]["width"] = 5<br/>        <br/>fig.show()</span></pre><p id="5255" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，所有代码，包括关于如何影响Plotly图表外观的各种选项，都可以在<a class="ae lu" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Highlighted_Line_Chart_on_Grey_Lines_Background/Highlight_Lines_on_Grey_Background.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><h1 id="7f78" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">释文</h1><p id="2e81" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">图表看起来仍然很难看。我们已经去掉了图例和轴心，我们甚至不知道有多少游客来过这些国家。为了向观众展示重要的价值，我们必须注释情节。注释是添加到<code class="fe mk ml mm mn b">.fig.update_layout(..., annotations=[])</code>中的另一个字典。这个注释参数包含一个字典列表，每个字典都是一个注释。</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="06aa" class="np mp it mn b gy nq nr l ns nt">turkey_annotation = \<br/>[{"xref":"paper", "yref":"paper", "x":0, "y":0.15,<br/>  "xanchor":'right', "yanchor":"top",<br/>  "text":'7M',<br/>  "font":dict(family='Arial', size=12, color="red"),<br/>  "showarrow":False}, ... other annotations ...]</span></pre><p id="1e70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以影响注释的许多参数。它的位置、字体以及是否有箭头从注释文本指向图表上的某个点。文本的坐标<code class="fe mk ml mm mn b">x</code>和<code class="fe mk ml mm mn b">y</code>既可以指<code class="fe mk ml mm mn b">plot </code>也可以指<code class="fe mk ml mm mn b"> paper-canvas</code>。在第一种情况下，使用轴上显示的值指定位置，在第二种情况下,<code class="fe mk ml mm mn b">(0,0)</code>是绘图区的左下角,<code class="fe mk ml mm mn b">(1,1)</code>是右上角。</p><p id="0bdf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">位置还取决于<code class="fe mk ml mm mn b">anchor</code>(上-中-下、左-中-右)、偏移和调整。可以通过设置字体来修改每个注释，或者可以在文本上应用HTML标签，如<code class="fe mk ml mm mn b">&lt;b&gt;</code>或<code class="fe mk ml mm mn b">&lt;i&gt;</code>。</p><p id="1144" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看这个要点和由此产生的图，以了解您在注释时的选项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/458372bf41d9a239979e835930823773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YTTyQjQClYpoDgC4UmSw5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">关于如何在Plotly中定位注释的各种选项。</p></figure><p id="09f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的注释不适合画布，您可以通过在<code class="fe mk ml mm mn b">.update_layout()</code>内放置<code class="fe mk ml mm mn b">margin={"l": pixels, "r": px, "t": px, "b": px}</code>来增加绘图周围的空间。</p><h2 id="c34f" class="np mp it bd mq op oq dn mu or os dp my lh ot ou na ll ov ow nc lp ox oy ne oz bi translated">标注作为标签和图例</h2><p id="1496" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">当我们对我们的旅游图表稍加研究时，我们可以取得相当好的结果。我们将<code class="fe mk ml mm mn b">xref</code>设置为<code class="fe mk ml mm mn b">paper</code>，并将<code class="fe mk ml mm mn b">0</code>设置为行的开始。添加<code class="fe mk ml mm mn b">xanchor="left”</code>将文本对齐到绘图区的左侧。您可以设置<code class="fe mk ml mm mn b">yref=”paper"</code>并尝试在0和1之间找到理想的位置，但是不将其设置为<code class="fe mk ml mm mn b">paper</code>并使用准确的位置更容易，例如<code class="fe mk ml mm mn b">3 300 000</code>(注意，从python 3.6开始，由于PEP515 ，您可以在数字文字中使用<a class="ae lu" href="https://www.python.org/dev/peps/pep-0515/" rel="noopener ugc nofollow" target="_blank">下划线，并将百万写成<code class="fe mk ml mm mn b">3_300_000</code>)</a></p><p id="e591" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，完整的图表如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/bdb26ff611b0533c712832849470d265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQiGHIEQAC9UqVNDkYIk6g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用注释Plotly表示突出显示的折线图</p></figure><blockquote class="pb pc pd"><p id="005b" class="ky kz pe la b lb lc ju ld le lf jx lg pf li lj lk pg lm ln lo ph lq lr ls lt im bi translated">我认为关于绘图区域之外的注释，最有趣的是你可以引用画布上的<code class="fe mk ml mm mn b">x</code>和图表上的坐标<code class="fe mk ml mm mn b">y</code>。可以设置，<code class="fe mk ml mm mn b">"x":0 (on the canvas), "xanchor":"right</code>和<code class="fe mk ml mm mn b">"y": 7_000_000 on the plot, "ynachor":"middle"</code>。</p></blockquote><h1 id="1a69" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">交互式按钮</h1><p id="bab1" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">上面的图表非常令人印象深刻，不是吗，但是如果你可以添加更多的东西呢？如果您可以让用户选择突出显示他们想要的任何数据，会怎么样？这可以通过交互式按钮来实现。</p><p id="f48a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过<code class="fe mk ml mm mn b">fig.update_layout(updatemenus=[])</code>添加按钮。您现在可能已经习惯了这样一个事实，即每个元素都由一个python字典来描述，按钮也不例外。</p><p id="e507" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个按钮都有几个参数:</p><ul class=""><li id="68f4" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mj mb mc md bi translated"><code class="fe mk ml mm mn b">args</code>:点击按钮会发生什么</li><li id="7b7f" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated"><code class="fe mk ml mm mn b">args2</code>:取消选中时会发生什么(创建切换按钮)</li><li id="629f" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated"><code class="fe mk ml mm mn b">label</code>:按钮上写的是什么</li><li id="d4b8" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mj mb mc md bi translated"><code class="fe mk ml mm mn b">method</code>:按钮是否改变绘图、布局或两者</li></ul><p id="67d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mk ml mm mn b">args</code>、<code class="fe mk ml mm mn b">args2</code>中的每一个也接受3个参数——轨迹变化、布局变化和受影响的轨迹列表。例如</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="9a4b" class="np mp it mn b gy nq nr l ns nt">args=[<br/>    # updates to the traces<br/>    {"line.color":["blue"],"line.width":5}, <br/>    <br/>    # changes to the layout<br/>    {"title":"Tourism growth in Japan",<br/>      "annotations": annotation_japan}, <br/>    <br/>    # which trace is affected  <br/>    [1,2]<br/>     ]</span></pre><p id="4634" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按钮集提供了影响其位置和样式的附加参数。与注释类似，您可以在绘图周围放置按钮。您还可以在单个按钮、一组按钮或下拉列表之间进行选择。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/48b729c62b0e2f1ce56e06cc2570c251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n8DVfgDWjCTi3NewgfBcTg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">各种位置的plotly互动按钮和风格。</p></figure><p id="12e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们添加按钮来打开/关闭关于日本和土耳其旅游的两个亮点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/8ab854960aeaae4c28d9fc07bf9decc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*cnSKHr1QQN3TOTl7MZX44Q.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按钮可以提高Plotly的交互性</p></figure><p id="d7e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly Express中的按钮不是万能的。如果您点击日本和土耳其按钮，而没有通过第二次切换-点击清除绘图，您将看到两条彩色线。我没有发现如何确保一个是染色的，而其他的都是灰色的。这样复杂的交互只有通过Plotly的仪表盘库才能实现——<a class="ae lu" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank">Dash</a>。它的回调动作允许几乎所有可以想象的输出。</p><blockquote class="pb pc pd"><p id="2353" class="ky kz pe la b lb lc ju ld le lf jx lg pf li lj lk pg lm ln lo ph lq lr ls lt im bi translated">您可能还会注意到，如此多的行，Plotly自动选择的<a class="ae lu" href="https://en.wikipedia.org/wiki/WebGL" rel="noopener ugc nofollow" target="_blank"> WebGL格式</a>被证明提高了具有许多数据点的JavaScript绘图的可用性。</p></blockquote><h1 id="1ddc" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">显示排名——IIHF排名</h1><p id="6bb4" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">当我第一次遇到这种图表时，它显示了最受欢迎的国家公园的排名以及它是如何随着时间的推移而演变的。我再也找不到这个例子了，所以我决定创建一个我自己的等级演变图。我会看看过去5年里冰球国家队的排名。</p><p id="42f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为最近换了Linux，所以手动把数据收集到<a class="ae lu" href="https://en.wikipedia.org/wiki/OpenDocument" rel="noopener ugc nofollow" target="_blank">里。ods </a>电子表格。您可以使用<code class="fe mk ml mm mn b">pd.read_excel(path, engine="odf)</code>来收集数据，但是我必须安装<code class="fe mk ml mm mn b">pip install odfpy</code>来实现。</p><p id="9943" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后你重复上面的代码来显示排名的概况，并突出显示你喜欢的国家。不过，在这里我不得不处理一个新问题。我想显示标签，显示每年的排名，只有这一行突出显示(而它应该是隐藏的所有其他人)。</p><p id="c830" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，这个问题有两个结果略有不同的解决方案。你可以使用<code class="fe mk ml mm mn b">fig.update_traces()</code>来设置颜色和标签。在这种情况下，您必须指定<code class="fe mk ml mm mn b">text</code>和<code class="fe mk ml mm mn b">mode</code>:</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="b95b" class="np mp it mn b gy nq nr l ns nt">fig.update_traces(<br/>    patch={<br/>        "line":{"color":"yellow", "width":5}, <br/>        "text":sweden["Ranking"].values,<br/>        "textposition":"top center",<br/>        "mode":"lines+text",<br/>        "textfont":{"size":15, "color":"blue"},<br/>        }, <br/>    selector={"legendgroup":"Sweden"})</span></pre><p id="5da6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用这种方法，文本是一种丑陋的坚持行，我没有强迫它解除。当你简单地用<code class="fe mk ml mm mn b">fig.update_layout(annotations=[])</code>注释时，这就可以做到。迭代数据框，并准备一个包含每个注释的字典列表:</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="ca88" class="np mp it mn b gy nq nr l ns nt">annotations = []<br/>for index, row in sweden.iterrows():<br/>    annotations.append(<br/>        {"x": row["Year"], <br/>         "y": row["Ranking"], <br/>         "yshift": 6,<br/>         "text": row["Ranking"],<br/>         "xanchor": "center", <br/>         "yanchor": "bottom", <br/>         "showarrow":False,<br/>         "font":{"color":"blue", "size": 15}<br/>        }<br/>    )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/41fa46dc89daff804fed8969a09059e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gJqDYZk0ke58cfX5HUvAkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何突出显示和标记plotly的一条线的两个选项。</p></figure><h1 id="b7b0" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">结论</h1><p id="88c7" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">我希望您喜欢这篇介绍python的Plotly Express的技巧的文章。您已经学习了如何创建包含大量信息的折线图，以及如何向受众突出显示这些数据的重要部分。您已经看到，实现相同目标的方法通常不止一种。最后，我们用同样的方法在灰色背景上用彩色线条来显示排名的变化。</p><p id="e8bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于这种类型的图表，您还有其他使用案例吗？</p><pre class="kj kk kl km gt nl mn nm nn aw no bi"><span id="0bb9" class="np mp it mn b gy nq nr l ns nt">If you want to create inspiring graphics like those in this post, use <a class="ae lu" href="https://partner.canva.com/vdek" rel="noopener ugc nofollow" target="_blank">canva.com</a> (affiliate link, when you click on it and purchase a product, you won't pay more, but I can receive a small reward; you can always write canva.com to your browser to avoid this). Canva offer some free templates and graphics too.</span><span id="a3aa" class="np mp it mn b gy nu nr l ns nt">Other articles:</span><span id="bc8b" class="np mp it mn b gy nu nr l ns nt">* <a class="ae lu" rel="noopener" target="_blank" href="/histograms-with-plotly-express-complete-guide-d483656c5ad7">Plotly Histogram - Complete Guide</a><br/>* <a class="ae lu" rel="noopener" target="_blank" href="/complete-guide-to-pythons-cross-validation-with-examples-a9676b5cac12">Everything you wanted to know about Kfold train-test split</a><br/>* <a class="ae lu" rel="noopener" target="_blank" href="/pythons-geocoding-convert-a-list-of-addresses-into-a-map-f522ef513fd6">How to turn a list of addreses into a map</a></span></pre><p id="51e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有练习都可以在Github上的笔记本中完成—<a class="ae lu" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Highlighted_Line_Chart_on_Grey_Lines_Background/Highlight_Lines_on_Grey_Background.ipynb" rel="noopener ugc nofollow" target="_blank">highlight _ Line _ Chart _ on _ Grey _ Lines _ Background</a></p></div></div>    
</body>
</html>