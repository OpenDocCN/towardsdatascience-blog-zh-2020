<html>
<head>
<title>Chat Images To Textual Conversation: Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">聊天图像到文本对话:第3部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chat-images-to-textual-conversation-part-3-49cdee0f2c72?source=collection_archive---------50-----------------------#2020-10-16">https://towardsdatascience.com/chat-images-to-textual-conversation-part-3-49cdee0f2c72?source=collection_archive---------50-----------------------#2020-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="69a4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">处理聊天图像中的噪声，并为黑暗模式图像添加功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fe9ae3b94da318a3803f04f6985abd02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s-tfPWp6U6oj369P"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@walling?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上砌墙</a></p></figure><p id="741d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感觉很好，回到这个项目的最后一部分:“聊天图像到文本对话”。但是在深入研究这篇文章之前，我建议先阅读前两部分:分别是<a class="ae kv" rel="noopener" target="_blank" href="/chat-images-to-textual-conversation-c44aadef59fe">聊天识别</a>(第一部分)和<a class="ae kv" rel="noopener" target="_blank" href="/chat-images-to-textual-conversation-part-2-8260c09a032e">表情检测</a>(第二部分)。</p><p id="c289" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我要感谢Akshat Sharma为这个项目做出的所有贡献。</p><p id="879e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们来看看我们的目标，然后我们来看看我用来实现这些目标的方法:</p><h2 id="4f39" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">1.处理黑暗模式图像</h2><p id="05ea" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">第一步是识别图像是暗模式还是亮模式。为此，我们使用一个非常简单的技术来寻找聊天图像的平均像素值，如果图像大于阈值，那么我们将其标记为“亮”，否则为“暗”。对于我们的用例，我们使用阈值127。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="a436" class="lu lv iq mt b gy mx my l mz na">numpyImg = cv2.imread(img)  <br/>if(np.mean(numpyImg) &gt; 127):      <br/>   mode = 'Light'    <br/>else:      <br/>   mode = 'Dark'</span></pre><p id="29b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，对于第二步，我们知道tesseract检测白色背景上的黑色文本具有100%的准确性，但是它在检测黑色背景上的白色文本时无情地失败了。我们在我们的管道中使用了一个简单的技巧，如果图像是“暗的”，在第二个博客中进行强度处理后(表情检测中的<a class="ae kv" rel="noopener" target="_blank" href="/chat-images-to-textual-conversation-part-2-8260c09a032e">步骤2)屏蔽当前图像。</a></p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="a033" class="lu lv iq mt b gy mx my l mz na">#Masking<br/>#newImage1 is obtained from step 2 in <a class="ae kv" rel="noopener" target="_blank" href="/chat-images-to-textual-conversation-part-2-8260c09a032e">Emoji Detection Blog</a><br/>mask = cv2.bitwise_not(newImage1)</span></pre><h2 id="95ec" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">2.从输出中消除噪声</h2><p id="7381" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">输出中出现的大部分噪声是因为tesseract将表情符号、蓝色记号、时间戳识别为一些特殊字符，如@、#、W、Y、(、$。时间戳已经在聊天识别(第1部分)中进行了处理，使用正则表达式去除行尾的匹配部分。</p><p id="6a2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当tesseract检测到聊天图像中的文本时，它也会检测到蓝色勾号，并在其周围绘制一个边界框，但是与其他边界框的面积相比，该边界框的面积非常小。因此，我们只计算每个边界框的面积，如果它小于阈值，就忽略它。我们用于聊天图像的阈值根据图像大小进行缩放，我们将其设置为</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="8477" class="lu lv iq mt b gy mx my l mz na">blueTickArea = 0.00128 * width * height</span></pre><p id="4128" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是消除表情符号引起的噪声，我们已经有了另一种方法来检测第二部分中的表情符号，所以这里我们不希望tesseract检测表情符号。基本上，我们可以让表情符号在图像中不可见，然后输入宇宙魔方。我们使用一个非常简单的技术来实现这个想法。</p><p id="e758" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第2部分中进行表情符号检测时，我们已经发现了表情符号周围的边界框。对于浅色模式的图像，我们只是用白色填充这些表情符号边框，而深色模式的图像则使用黑色。这项技术阻止了tesseract检测图像中表情符号的任何特殊字符。</p><p id="242c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是实现上述想法后的输出。黑暗模式不是很准确，因为它错过了2心，但仍然表现很好。</p><div class="kg kh ki kj gt ab cb"><figure class="nb kk nc nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9936fafcebd5715ae4e462fe7c2475c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*m_g8dyhlkKxTefPoVHr-ng.png"/></div></figure><figure class="nb kk nh nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9aa712c2bbb9884ef228e1de47f42faa.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*W5Wnjm-VYSk6XSJejJF57w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk ni di nj nk translated">表情符号的去噪——左:用白色填充的表情符号(浅色模式)，右:用黑色填充的表情符号(深色模式)</p></figure></div><p id="6813" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们最终消除了聊天图像中的噪声，最终输出非常流畅。下面是在结束时<a class="ae kv" rel="noopener" target="_blank" href="/chat-images-to-textual-conversation-part-2-8260c09a032e">第二部分中图像的输出。现在，您可以在下面的输出中看到改进，没有不必要的字符，这些字符以前大多出现在文本行的末尾。</a></p><div class="kg kh ki kj gt ab cb"><figure class="nb kk nl nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/7eb01595dc0b4d3c142d5401f3626084.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*L_nK0BTbP9Qnt-JbGY3YNw.png"/></div></figure><figure class="nb kk nl nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/fec9e3ea957b36fe12c5384eb4238434.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*FNLHC6_9-FKSp1DxRxLG4A.png"/></div></figure><figure class="nb kk nl nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/962d8656c393705fc6bab0c96f124cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*DGurwCLTQp2lKmLcqTxFaA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk nm di nn nk translated">故事由最终聊天+表情符号识别模型创建，Messagink应用程序使用来自<a class="ae kv" rel="noopener" target="_blank" href="/chat-images-to-textual-conversation-part-2-8260c09a032e">第二部</a>的两幅输入图像去除了噪声。</p></figure></div><p id="dbe0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是聊天图像到文本对话的全部内容。希望你喜欢看我的博客。</p><p id="70e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过点击以下链接，使用Messagink网站编辑器中的导入按钮，尝试将聊天图像导入文本故事的最新功能:</p><div class="no np gp gr nq nr"><a href="https://messagink.com/editor/new" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">Messagink -发现文本故事</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">阅读你最喜欢类型的对话和文本故事。免费写你自己的文字故事。</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">messagink.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kp nr"/></div></div></a></div><p id="8381" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也可以尝试一下<strong class="ky ir"> Messagink的app中可用的编辑器中的功能(</strong> <a class="ae kv" href="https://appstore.com/messagink" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> ios </strong> </a> <strong class="ky ir">，</strong><a class="ae kv" href="https://play.google.com/store/apps/details?id=com.messagink.messagink" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">Android</strong></a><strong class="ky ir">)</strong></p><p id="91ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再见</p></div></div>    
</body>
</html>