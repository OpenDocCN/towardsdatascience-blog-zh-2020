<html>
<head>
<title>3 Simple Tricks to Better Structure Your SQL Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更好地构建SQL查询的3个简单技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-simple-tricks-to-better-structure-your-sql-queries-f5e3b38d58e2?source=collection_archive---------5-----------------------#2020-11-14">https://towardsdatascience.com/3-simple-tricks-to-better-structure-your-sql-queries-f5e3b38d58e2?source=collection_archive---------5-----------------------#2020-11-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="181a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">以及立即应用它们的实际例子</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/1e633551f96d5f3b097a4c5ced6b57f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PcVV-Stq79lbp4y8tYcdqA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae kz" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="eede" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">SQL代表结构化查询语言。不幸的是，这并不意味着一旦你开始用这种计算机语言编程，你就会自然而然地写出一段结构完美的代码。</p><p id="313b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">作为一名数据分析师，我不断地应用三个简单的规则来更好地组织我的SQL查询。它们不仅让我避免了从数据库中查询的错误，还为我自己和与我分享查询的同事节省了时间。让我向您展示这些技巧，并用一个真实的例子来说明它们。</p><h1 id="a4a6" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">1.可视化您的查询输出</h1><p id="2592" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">高效地构建SQL代码始于牢记您想要实现的结果。问自己这个简单的问题:<strong class="lc iv">我希望我的输出表看起来像什么？</strong></p><p id="cf2a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">特别要注意以下几点:</p><ul class=""><li id="d952" class="mt mu iu lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated"><strong class="lc iv">粒度级别</strong>:您希望您的输出表处于哪种聚合级别？换句话说，每行应该对应什么？</li><li id="3e50" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated"><strong class="lc iv">输出字段</strong>:根据查询生成的表格，您将使用哪些字段？换句话说，每一列应该对应什么？</li><li id="521d" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated"><strong class="lc iv">输入变量</strong>:你的数据从哪里来？换句话说，您将在查询中处理的变量的性质是什么？</li></ul><p id="8e1a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们用一个例子来实践第一个技巧。想象一下，你的老板刚刚让你分析上个月销量的演变。为此，您将需要检索每天(粒度级别)的产品数量(输出字段)，知道您可以访问一个数据库表，该表汇总了客户在过去几个月中所做的购买(输入变量)。</p><p id="4525" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，您的查询输出应该如下表所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nh"><img src="../Images/e47d050499a4b3af5e2cb8a7781b88a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a53gGJx5yoAAUUXrPKKc3Q.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">玛丽·勒费夫尔</p></figure><h1 id="07d9" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">2.使用WITH子句</h1><p id="e76e" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">要生成所需的表，您需要采取许多步骤。当我开始用SQL编码时，我的第一反应是从关键字“SELECT”开始。但有了经验，我现在系统地从“用”这个关键词入手。乍一看，使用WITH子句可能会让您认为这会使您的查询看起来过于复杂。但是我可以向你保证<strong class="lc iv">即使对于相对简单的查询，它也可以让你组织你的思维，让你的查询更容易阅读和理解</strong>。</p><p id="f5b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">WITH子句的另一个主要优点是，您可以构造一系列子查询，每个子查询都可以引用(或不引用)前一个子查询。通过这样做，您将避免在主查询中编写无穷无尽的嵌入式子查询，从而减少失去思路的风险。使用WITH子句允许您在代码底部编写主查询之前，首先检索并计算主查询中请求的所有字段。</p><p id="f438" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我用前面的例子来说明这一点。编写获得所需输出所需的代码的第一种方法是:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ni nj l"/></div></figure><p id="1f43" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用WITH子句的另一种方法是:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ni nj l"/></div></figure><p id="4343" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，这两个查询具有相同的性能，并且具有相同的代码行数。然而，<strong class="lc iv">第二段代码向读者展示了通向主查询</strong>的逻辑步骤:首先从表“sales”中检索原始字段，在适当的级别对它们进行计算，然后在主查询中使用它们。虽然对于这个示例，第一个版本对大多数用户来说可能已经足够清楚了，但是您可以很容易地想象到，对于更复杂的查询，不使用WITH子句可能会导致大量的嵌入式子查询，从而导致代码的高度复杂性。</p><h1 id="181f" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">3.勤奋写作</h1><p id="7f24" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">在行动最激烈的时候，你可能没有花时间以最干净的方式编写代码。不关心代码中的每一个语法规则的诱惑确实很大。协调一段代码也可能是痛苦的，似乎是浪费时间，特别是如果原始代码正确运行并做了它应该做的事情。</p><p id="fb2d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，我建议你<strong class="lc iv">在把你的代码放在一边</strong>之前花点时间仔细检查一下——也许六个月后再回来问自己“这部分代码应该做什么？”。首先，即使你现在确信你将永远记住你的代码的逻辑，你以后可能会回想起它，并且不记得它是如何被构造的。如果做得好，你会节省很多时间。第二，其他人可能需要阅读和重用你的代码。除非你确定你或其他任何人以后都不会使用你的作品，否则请考虑以下部分。</p><p id="09d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">协调你的代码语法并确保其风格的一致性并不意味着你必须花费数小时来重写你的代码。一些免费工具允许你根据广泛使用的标准或者你自己定义的格式化规则来重新格式化你的代码。它们可以是您的查询工具中的功能(例如Google的BigQuery控制台中的“格式查询”)、在线工具(例如像Poor-SQL或sql-format这样的网站)或您的文本编辑器中的附加包(例如Sublime Text的“SqlBeautifier”)。</strong></p><p id="c032" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">校对您的代码时，请注意以下元素的一致性:</p><ul class=""><li id="45f8" class="mt mu iu lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated"><strong class="lc iv">缩进</strong>:对齐所有具有相同性质并且处于相同聚合级别的字段，可以更容易理解代码背后的逻辑。</li><li id="9473" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated"><strong class="lc iv">大小写</strong>:对所有SQL关键字使用相同的大小写规则(通常为大写)和另一种独特的字段大小写逻辑(例如camelCase、snake_case或PascalCase)可以更容易地理解每个单词在查询中扮演的角色。</li><li id="cf48" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated"><strong class="lc iv">注释</strong>:用来注释一段代码的字符可能会根据你使用的数据库管理系统(RDBMS)而有所不同(双连字符、斜杠、hashtag…)，因此，调整整个代码中用来注释它的语法是至关重要的。</li></ul><p id="7261" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果回到前面的例子，您会注意到我对SQL关键字使用了大写，对字段名使用了snake case。由于我习惯于BigQuery中的标准SQL，所以我使用双连字符来添加注释。</p></div><div class="ab cl nk nl hy nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="in io ip iq ir"><h1 id="d2eb" class="lw lx iu bd ly lz nr mb mc md ns mf mg ka nt kb mi kd nu ke mk kg nv kh mm mn bi translated">结论</h1><p id="d8c3" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">如果您处于SQL编程的初级阶段，这些技巧将有助于您更加自信地编写查询，因为它们鼓励您组织自己的思维，并通过这样做，使您编写的代码更加清晰。</p><p id="8aeb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您在SQL掌握方面处于更高级的水平，这些技巧将鼓励您更好地组织代码，并使其易于被其他人理解，而不管他们的背景和SQL熟练程度如何。</p></div><div class="ab cl nk nl hy nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="in io ip iq ir"><p id="fc18" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你喜欢阅读这篇文章吗？ <a class="ae kz" href="https://marie-lefevre.medium.com/membership" rel="noopener"> <em class="nw">成为</em> </a> <em class="nw">的一员，加入一个不断成长的充满好奇心的社区吧！</em></p><div class="nx ny gq gs nz oa"><a href="https://marie-lefevre.medium.com/membership" rel="noopener follow" target="_blank"><div class="ob ab fp"><div class="oc ab od cl cj oe"><h2 class="bd iv gz z fq of fs ft og fv fx it bi translated">加入Medium！</h2><div class="oh l"><h3 class="bd b gz z fq of fs ft og fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oi l"><p class="bd b dl z fq of fs ft og fv fx dk translated">marie-lefevre.medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kt oa"/></div></div></a></div></div></div>    
</body>
</html>