<html>
<head>
<title>Monte Carlo Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蒙特卡罗积分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monte-carlo-integration-db86b8d7beb3?source=collection_archive---------25-----------------------#2020-10-03">https://towardsdatascience.com/monte-carlo-integration-db86b8d7beb3?source=collection_archive---------25-----------------------#2020-10-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/0746b2d8cbc3ddfb89f8f0b5c67d5edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8iQp0FFq0gAWhxKd.jpg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">Pixabay上由<a class="ae jg" href="https://pixabay.com/users/pixapopz-2873171/" rel="noopener ugc nofollow" target="_blank"> Pixapopz </a>拍摄的照片</p></figure><div class=""/><p id="c91c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很多时候，我们不能解析地求解积分，必须求助于数值方法。其中包括蒙特卡罗积分。你可能还记得，函数的积分可以解释为函数曲线下的面积。蒙特卡罗积分的工作原理是在a和b之间的不同随机点<strong class="ki jk"> </strong>计算一个函数，将矩形的面积相加，取和的平均值。随着点数的增加，结果越来越接近积分的实际解。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi le"><img src="../Images/3bed64c3bb591b1921b499254f95c609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*tUl2QKGC6rJTx_UbO5dv8w.png"/></div></figure><p id="25e6" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用代数表示的蒙特卡罗积分:</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/c810b0418fd57c4b5bf391573c428e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*fYV7eL2gwd9jaZw2Fjfh5g.png"/></div></figure><p id="bbb2" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与其他数值方法相比，蒙特卡罗积分特别适合计算奇数形状的面积。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/ef4ff75b4651953401de11c31d716709.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*cpOo2PCk2IbI3nSVKTBNXA.png"/></div></figure><p id="f4b7" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下一节中，我们将看到当我们知道先验和似然性，但缺少归一化常数时，如何使用蒙特卡罗积分来确定后验概率。</p><h1 id="a695" class="ll lm jj bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">简而言之贝叶斯统计</h1><p id="e7c5" class="pw-post-body-paragraph kg kh jj ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">后验概率指的是贝叶公式中的一个特定项。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mo"><img src="../Images/a23b7a72ed0dbd1d87ca08a4449920af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jN0lms73694dwpZf5gV7Gg.png"/></div></div></figure><p id="f9ed" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Baye定理可以用来计算一个在特定疾病的筛选测试中测试呈阳性的人实际上患有该疾病的概率。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mp"><img src="../Images/70eceea17c7e110e47fdcdcdb67d5351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JYOwXoeAO8O0HtoT.png"/></div></div></figure><p id="6396" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们已经知道P(A)，P(B)和P(B|A ),但还想知道P(A|B ),我们可以使用这个公式。例如，假设我们正在测试一种罕见的疾病，这种疾病会感染1%的人口。医学专家已经开发了一种高度敏感和特异的测试，但还不十分完善。</p><ul class=""><li id="154a" class="mq mr jj ki b kj kk kn ko kr ms kv mt kz mu ld mv mw mx my bi translated">99%的病人测试呈阳性</li><li id="8548" class="mq mr jj ki b kj mz kn na kr nb kv nc kz nd ld mv mw mx my bi translated">99%的健康患者测试呈阴性</li></ul><p id="b006" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">贝叶斯定理告诉我们:</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ne"><img src="../Images/f4411e8505979ba2e194f1eb14fb9daf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UVTKdUdok3vqmlQB.png"/></div></div></figure><p id="1611" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们有10，000人，100人生病，9，900人健康。此外，在对所有人进行测试后，我们会让99名病人进行测试，但也让99名健康人进行测试。因此，我们会以下面的概率结束。</p><p id="fb8a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk"> p(生病)= 0.01 </strong></p><p id="d165" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk"> p(未患病)= 1–0.01 = 0.99</strong></p><p id="a200" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk">p(+|有病)= 0.99 </strong></p><p id="cf3a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk">p(+|未患病)= 0.01 </strong></p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nf"><img src="../Images/08c906993ffc9d881875d452e7059c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rjL7z6KROSIO1KfJ.png"/></div></div></figure><h2 id="90c3" class="ng lm jj bd ln nh ni dn lr nj nk dp lv kr nl nm lz kv nn no md kz np nq mh nr bi translated">贝叶斯定理在概率分布中的应用</h2><p id="d8fa" class="pw-post-body-paragraph kg kh jj ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在前面的例子中，我们假设一个人生病的先验概率是一个精确到. 001的已知量。然而，在现实世界中，认为. 001的概率实际上如此精确是不合理的。一个特定的人生病的概率会根据他们的年龄、性别、体重等有很大的不同。一般来说，我们对给定先验概率的了解远非完美，因为它是从以前的样本中获得的(这意味着不同的总体可能给出不同的先验概率估计)。在贝叶斯统计中，我们可以用先验概率的分布来代替这个值0.001，该分布捕获了我们对其真实值的先验不确定性。包含一个先验概率分布最终产生一个后验概率，它也不再是一个单一的量；相反，后验概率也变成了概率分布。这与传统观点相反，传统观点认为参数是固定的量。</p><h1 id="40ec" class="ll lm jj bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">归一化常数</h1><p id="65db" class="pw-post-body-paragraph kg kh jj ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">正如我们在关于<a class="ae jg" rel="noopener" target="_blank" href="/gibbs-sampling-8e4844560ae5">吉布斯采样</a>和<a class="ae jg" rel="noopener" target="_blank" href="/monte-carlo-markov-chain-89cb7e844c75"> Metropolis-Hasting </a>的文章中所看到的，当归一化常数未知时，蒙特卡罗方法可用于计算后验概率分布。</p><p id="cf0b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们首先探究一下为什么我们需要一个归一化常数。在概率论中，归一化常数是一个函数必须乘以的常数，因此其图形下的面积为1。还不清楚？让我们看一个例子。</p><p id="9c88" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回想一下，正态分布的函数可以写成:</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c726f567bce23c17be0d3a6bbe8b1906.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*a2MHym_w1FwSHcBTqz3DMg.png"/></div></figure><p id="bea8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">两个圆周率的平方根是归一化常数。</p><p id="5745" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们检查一下我们是如何决定它的。我们从以下函数开始(假设均值为0，方差为1):</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/adeadc807bb943cd6f1e4f4ac3e937a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*vFeFblzSWVny6MerxAd1qA.png"/></div></figure><p id="3383" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们把它画出来，它会形成一个钟形曲线。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/0c0163df8d328eed52874b4092dd3ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*Ji22rm0B1dNuUp9QKZO5rQ.png"/></div></figure><p id="6d72" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">问题在于，如果我们取曲线下的面积，它就不等于1，这是概率密度函数所要求的。因此，我们将函数除以积分结果(归一化常数)。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e83a7e45c0a26bae517739870395c30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*Ye78DjCARGfPJPsgPMGNeg.png"/></div></figure><p id="bcc4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回到手头的问题，即如何在没有归一化常数的情况下计算后验概率…事实证明，对于连续的样本空间，归一化常数可以改写为:</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/ecfc902921d6a5f3c2ab87adf8e20d9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*RHU4_lo4N_l6TDaSrwOEgQ.png"/></div></figure><p id="aff1" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这一点上，你应该考虑蒙特卡罗积分！</p><h1 id="d954" class="ll lm jj bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Python代码</h1><p id="bf61" class="pw-post-body-paragraph kg kh jj ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">让我们看看如何通过在Python中执行蒙特卡罗积分来确定后验概率。我们首先导入所需的库，并设置随机种子以确保结果是可重复的。</p><pre class="lf lg lh li gt nx ny nz oa aw ob bi"><span id="edad" class="ng lm jj ny b gy oc od l oe of">import os<br/>import sys<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import pandas as pd<br/>import scipy.stats as st</span><span id="ab33" class="ng lm jj ny b gy og od l oe of">np.random.seed(42)</span></pre><p id="fb1f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们设置贝塔分布和二项式分布的参数值。</p><pre class="lf lg lh li gt nx ny nz oa aw ob bi"><span id="b468" class="ng lm jj ny b gy oc od l oe of">a, b = 10, 10<br/>n = 100<br/>h = 59<br/>thetas = np.linspace(0, 1, 200)</span></pre><p id="ac30" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">概率密度函数的范围从0到1。因此，我们可以简化方程。</p><figure class="lf lg lh li gt iv gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/c28ac60d53010d983887cab71b7f2c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*VZuMiVDLcyp-heh5DynwFg.png"/></div></figure><p id="51fb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在代码中，前面的等式如下所示:</p><pre class="lf lg lh li gt nx ny nz oa aw ob bi"><span id="2893" class="ng lm jj ny b gy oc od l oe of">prior = st.beta(a, b).pdf(thetas)<br/>likelihood = st.binom(n, thetas).pmf(h)<br/>post = prior * likelihood<br/>post /= (post.sum() / len(thetas))</span></pre><p id="b26a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们可视化的概率密度函数的先验，后验，和可能性。</p><pre class="lf lg lh li gt nx ny nz oa aw ob bi"><span id="6614" class="ng lm jj ny b gy oc od l oe of">plt.figure(figsize=(12, 9))<br/>plt.plot(thetas, prior, label='Prior', c='blue')<br/>plt.plot(thetas, n*likelihood, label='Likelihood', c='green')<br/>plt.plot(thetas, post, label='Posterior', c='red')<br/>plt.xlim([0, 1])<br/>plt.xlabel(r'$\theta$', fontsize=14)<br/>plt.ylabel('PDF', fontsize=16)<br/>plt.legend();</span></pre><figure class="lf lg lh li gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/25d3d6d14ac8f1707ff1a61a69969f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-m6dwZKVN5_s0Bv2KApU3w.png"/></div></div></figure><h1 id="e794" class="ll lm jj bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="d5fe" class="pw-post-body-paragraph kg kh jj ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">蒙特卡罗积分是一种求解积分的数值方法。它的工作原理是在随机点评估一个函数，将这些值相加，然后计算它们的平均值。</p></div></div>    
</body>
</html>