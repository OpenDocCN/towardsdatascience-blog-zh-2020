<html>
<head>
<title>Using API Data with TigerGraph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过TigerGraph使用API数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-api-data-with-tigergraph-ef98cc9293d3?source=collection_archive---------40-----------------------#2020-10-23">https://towardsdatascience.com/using-api-data-with-tigergraph-ef98cc9293d3?source=collection_archive---------40-----------------------#2020-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/7a98d4e0016f0d077aa6b22dd364e6de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OgVv8Tm4ijtNE5y1HyXyWw.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">照片来自<a class="ae jd" href="https://pixabay.com/illustrations/pokeball-pokemon-game-mobile-game-5584675/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>作者<a class="ae jd" href="https://pixabay.com/users/thor_deichmann-2306827/" rel="noopener ugc nofollow" target="_blank">托尔·戴奇曼</a></p></figure><div class=""/><div class=""><h2 id="b044" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">从PokéAPI中提取数据并构建图表</h2></div><h1 id="524b" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">为什么这很重要？</h1><p id="3794" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">不幸的是，并不是互联网上的所有数据都是打包好的CSV文件。事实上，人们可能经常希望使用流行API中的数据，但是如何将这些数据加载到图形中呢？</p><h1 id="832c" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">议程</h1><ul class=""><li id="2ae9" class="mj mk jg lp b lq lr lt lu lw ml ma mm me mn mi mo mp mq mr bi translated">看看PokéAPI数据集</li><li id="f57b" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">创建图表</li><li id="4ac8" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">将数据从API加载到您的图表中</li></ul><h1 id="5593" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">步骤0:设置</h1><p id="e4f7" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这篇博客中，我们将使用Python 3(更确切地说是Python 3.6.9)、requests、json和pyTigerGraph。你既可以在<a class="ae jd" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> Colab </a>上创建一个笔记本，也可以在你的本地计算机上运行它，但是，为了这节课的目的，我建议你使用Colab。</p><p id="db9a" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">如果你还没有，你需要安装pyTigerGraph。如果您使用的是Colab，以下是安装方法:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="35fc" class="nl kw jg nh b gy nm nn l no np">!pip install pyTigerGraph</span></pre><p id="2b27" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">在这篇博客中，我们使用的是pyTigerGraph的0.0.9.6.2版本。</p><p id="238e" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">接下来，你要确保你已经准备好了一个盒子。如果您还没有准备好盒子，请执行以下操作:</p><ol class=""><li id="c748" class="mj mk jg lp b lq mx lt my lw nq ma nr me ns mi nt mp mq mr bi translated">转到<a class="ae jd" href="http://tgcloud.io/" rel="noopener ugc nofollow" target="_blank">http://tgcloud.io/</a>。</li><li id="6b82" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi nt mp mq mr bi translated">单击我的解决方案。</li><li id="184f" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi nt mp mq mr bi translated">单击创建新解决方案。</li><li id="d8be" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi nt mp mq mr bi translated">点击“空白图表”</li><li id="a5cf" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi nt mp mq mr bi translated">通过步骤1-4获得一个免费盒子；记下你的域名。</li><li id="8d37" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi nt mp mq mr bi translated">单击“开始解决方案”</li></ol><h1 id="7d92" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">步骤1:探索PokéAPI</h1><p id="249c" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">首先，我决定使用PokéAPI。对于那些不知道的人来说，神奇宝贝是一种流行的视频游戏和卡牌游戏，玩家收集类似动物的生物(被称为神奇宝贝)并与之战斗。</p><p id="ca04" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">出于此图的目的，我们将添加:</p><ul class=""><li id="b1d8" class="mj mk jg lp b lq mx lt my lw nq ma nr me ns mi mo mp mq mr bi translated">神奇宝贝名称</li><li id="01bc" class="mj mk jg lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">神奇宝贝类型(水、火等。)</li></ul><p id="f8b0" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">接下来，我们将探索数据。文档位于此处:<a class="ae jd" href="https://pokeapi.co/docs/v2" rel="noopener ugc nofollow" target="_blank">https://pokeapi.co/docs/v2</a>。更具体地说，我们将关注神奇宝贝端点。</p><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/58dfc45a41ed47619f4b85828e3fa6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUaZD1DWUtdfvoqNI2I8IQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">神奇宝贝API</p></figure><p id="5f1e" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">我们将使用Python来创建我们的图表。我们将使用的三个库是requests(发出请求)、json(很好地打印我们的数据)和pyTigerGraph(处理与图形相关的一切)。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="5f69" class="nl kw jg nh b gy nm nn l no np">import requests<br/>import json<br/>import pyTigerGraph as tg</span></pre><p id="7d26" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">接下来，看看API的神奇宝贝部分。在本例中，向链接https://pokeapi.co/api/v2/pokemon/12/.发出了一个GET请求，让我们在Python代码中模仿一下:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="2def" class="nl kw jg nh b gy nm nn l no np">URL = "https://pokeapi.co/api/v2/pokemon/12/" # URL</span><span id="f675" class="nl kw jg nh b gy nv nn l no np">res = requests.get(url = URL).json() # Makes the GET Request</span><span id="5493" class="nl kw jg nh b gy nv nn l no np">print(json.dumps(res, indent = 2)) # Printing the Results</span></pre><p id="5bf1" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">这应该会打印出一个大的JSON对象。我们可以通过以下方式查看物种和类型:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="903a" class="nl kw jg nh b gy nm nn l no np">print(res["species"])</span><span id="9736" class="nl kw jg nh b gy nv nn l no np">print(res["types"])</span></pre><h1 id="e0c6" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">步骤2:在TigerGraph中创建图形</h1><p id="b684" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">首先，在TigerGraph Cloud中启动一个空白解决方案。记下你的域名！然后，在您的代码中，创建连接:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="a594" class="nl kw jg nh b gy nm nn l no np">conn = tg.TigerGraphConnection(host="https://DOMAIN.i.tgcloud.io", password="tigergraph", gsqlVersion="3.0.5", useCert=True)</span></pre><p id="bb95" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">我们将使用GSQL来创建图表。在这个例子中，我们需要两个顶点:口袋妖怪和类型。这些应该用一条边连接(POKEMON类型)。让我们将它添加到代码中:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="ff1b" class="nl kw jg nh b gy nm nn l no np"># Sets up connection with GSQL</span><span id="46fe" class="nl kw jg nh b gy nv nn l no np">print(conn.gsql('ls', options=[]))</span><span id="85df" class="nl kw jg nh b gy nv nn l no np"># Create Edges (POKEMON_TYPE) and Vertices (Pokemon and Type)</span><span id="5df5" class="nl kw jg nh b gy nv nn l no np">print(conn.gsql('''</span><span id="8107" class="nl kw jg nh b gy nv nn l no np">CREATE VERTEX Pokemon (PRIMARY_ID name STRING) WITH primary_id_as_attribute="true"</span><span id="f69f" class="nl kw jg nh b gy nv nn l no np">CREATE VERTEX Type (PRIMARY_ID type STRING) WITH primary_id_as_attribute="true"</span><span id="b711" class="nl kw jg nh b gy nv nn l no np">CREATE UNDIRECTED EDGE POKEMON_TYPE (FROM Pokemon, TO Type)</span><span id="d9bc" class="nl kw jg nh b gy nv nn l no np">''', options=[]))<br/></span><span id="de85" class="nl kw jg nh b gy nv nn l no np">print(conn.gsql('''CREATE GRAPH pokemon(Pokemon, Type, POKEMON_TYPE)''', options=[])) # Create the Graph</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nw"><img src="../Images/3f02540001ade61b5cd8fda1c13689bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlopvqCwJc56z7ax4HB2LA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">TigerGraph云上的模式</p></figure><p id="c6a4" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">您现在已经创建了图表！该加载数据了！</p><h1 id="2bbe" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">步骤3:从API加载数据</h1><p id="ce29" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">首先，您需要通过更新graphname和添加令牌来更新您的连接凭据。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="3777" class="nl kw jg nh b gy nm nn l no np">conn.graphname = "pokemon"</span><span id="4aaa" class="nl kw jg nh b gy nv nn l no np">conn.apiToken = conn.getToken(conn.createSecret())</span></pre><p id="2fad" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">现在，我们将尝试向我们的图表中添加一个神奇宝贝butterfree。这将使用我们上面提出的请求。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="08c2" class="nl kw jg nh b gy nm nn l no np">URL = "https://pokeapi.co/api/v2/pokemon/12/" # URL</span><span id="d6a1" class="nl kw jg nh b gy nv nn l no np">res = requests.get(url = URL).json() # Makes the GET Request</span><span id="0f5d" class="nl kw jg nh b gy nv nn l no np">print(json.dumps(res, indent = 2)) # Printing the Results</span></pre><p id="44b1" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">为此，我们将把数据“上传”(我想你可以认为是“上传”)到TigerGraph中。首先，我们将增加物种到口袋妖怪顶点。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="dec3" class="nl kw jg nh b gy nm nn l no np">conn.upsertVertex("Pokemon", res["species"]["name"], attributes={"name": res["species"]["name"] })</span></pre><p id="075e" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">厉害！接下来，我们将遍历这些类型，并将神奇宝贝连接到它的所有类型。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="e478" class="nl kw jg nh b gy nm nn l no np">for ty in res["types"]:</span><span id="759a" class="nl kw jg nh b gy nv nn l no np">     conn.upsertVertex("Type", ty["type"]["name"], attributes={"type": ty["type"]["name"] })</span><span id="2d73" class="nl kw jg nh b gy nv nn l no np">     conn.upsertEdge("Pokemon", res["species"]["name"], "POKEMON_TYPE", "Type", ty["type"]["name"])</span></pre><p id="3bfd" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">如果一切正常，恭喜你！你完了！现在你可以添加更多的神奇宝贝到你的图表中:</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="a0cb" class="nl kw jg nh b gy nm nn l no np">for i in range(1,100): # You can change the number based on how many Pokémon you want to add</span><span id="23d1" class="nl kw jg nh b gy nv nn l no np">    URL = f"https://pokeapi.co/api/v2/pokemon/{i}/" # URL</span><span id="26b8" class="nl kw jg nh b gy nv nn l no np">    res = requests.get(url = URL).json() # We don't have any parameters.</span><span id="7deb" class="nl kw jg nh b gy nv nn l no np">    conn.upsertVertex("Pokemon", res["species"]["name"], attributes={"name": res["species"]["name"] })</span><span id="c199" class="nl kw jg nh b gy nv nn l no np">    for ty in res["types"]:</span><span id="77d1" class="nl kw jg nh b gy nv nn l no np">        conn.upsertVertex("Type", ty["type"]["name"], attributes={"type": ty["type"]["name"] })</span><span id="80a9" class="nl kw jg nh b gy nv nn l no np">        conn.upsertEdge("Pokemon", res["species"]["name"], "POKEMON_TYPE", "Type", ty["type"]["name"])</span><span id="456d" class="nl kw jg nh b gy nv nn l no np">     print("Added " + res["species"]["name"])</span></pre><p id="29f2" class="pw-post-body-paragraph ln lo jg lp b lq mx kh ls lt my kk lv lw mz ly lz ma na mc md me nb mg mh mi ij bi translated">前往GraphStudio，您可以在那里查看您的图形外观！如果所有东西都装好了，那么你做到了！恭喜你。</p><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nw"><img src="../Images/217d49ed7c3f3d0b663ca5d7c7c14589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rhqMnrOEwYed3Yp9-VT3Eg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">探索一番后会是什么样子！</p></figure><h1 id="57e0" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">第四步:轮到你了！</h1><p id="a8b4" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">既然我们已经完成了这个示例，那么就轮到您来探索了！挑选出任何API，然后使用pyTigerGraph创建一个图形。您甚至可以尝试调用额外的端点，继续增强图形！你已经得到了这个，我很高兴看到你会开发什么！</p><h1 id="2487" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">资源</h1><p id="346c" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">可以在Google Colab上查看该项目:<a class="ae jd" href="https://colab.research.google.com/drive/1eIBETCGq18tvp9_DflGjIWV3EdcUM5hs?usp=sharing" rel="noopener ugc nofollow" target="_blank">https://Colab . research . Google . com/drive/1 eibetcgq 18 tvp 9 _ dflgjiv3 edcum 5 hs？usp =共享</a></p></div></div>    
</body>
</html>