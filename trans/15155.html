<html>
<head>
<title>Keep your data clean with data testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过数据测试保持数据整洁</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/keep-your-data-clean-with-data-testing-b84b4f789fa1?source=collection_archive---------34-----------------------#2020-10-18">https://towardsdatascience.com/keep-your-data-clean-with-data-testing-b84b4f789fa1?source=collection_archive---------34-----------------------#2020-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f294" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对您的数据进行测试，并满怀期望地提高您的管道质量</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cae87ed94b7e2674a37a5052b6a444ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r7qBwhogCeRKOBp4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kv" href="https://unsplash.com/@scienceinhd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">科学高清</a>拍摄的照片</p></figure><p id="fef7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在软件工程中，用特定于语言的框架编写测试是减少错误和提高代码质量的最佳实践。然而，在数据科学和数据工程的世界中，您正在构建的管道和模型的质量不仅仅取决于编写的代码，它主要取决于您正在使用的数据。在本文中，我们将看到如何为我们的输入数据编写测试，以避免不愉快的意外。因此，我们可以保证我们的机器学习模型或建立在这些数据上的ETL管道的正确行为。</p><p id="273e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将关注Python代码，并使用<a class="ae kv" href="https://docs.greatexpectations.io/en/v0.4.5/index.html" rel="noopener ugc nofollow" target="_blank"> great-expectations </a>包进行测试。我们将专注于Pandas数据帧，但是PySpark和其他工具的测试也受到了great-expectations的支持。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="115c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">测试示例数据集</h1><p id="5d0b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于这个例子，我决定使用来自约翰·霍普金斯大学系统科学与工程中心(CSSE)的<a class="ae kv" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank">新冠肺炎数据</a>。</p><p id="47ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">为什么是这个数据集？我使用这个数据集是因为它由几个批次组成。有一个。自Covid 19开始以来每天的csv文件。数据的质量和信息量随着时间而变化。因此，我们可以在特定日期可用的数据子集上构建我们的测试。随后，我们可以将这些测试应用于新的、看不见的数据，并确保数据内容符合预期。</strong></p><p id="b282" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们创建一个所有文件的列表，这些文件是我们希望稍后在管道中加载和使用的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e00f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将首先只检查最旧的文件和最新的文件，而不是立即加载所有文件。因此，我们可以看到列的外观，并评估数据质量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="31f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个仅仅关于列名的概述已经表明随着时间的推移发生了巨大的变化。添加了几个额外的列，并更改了一些列的命名。这意味着我们不能加载所有。csv文件并连接它们，无需任何额外的预处理步骤。</p><p id="c5cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于获得的信息，我们可以编写第一个测试来检查我们以后使用的所有列是否都出现在每个文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="041b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们首先用great_expectations dataset对象包装了最新数据文件的DataFrame对象。这仍然像一个熊猫数据帧，但带来了一些额外的功能。然后，我们用<em class="my"> expect_column_to_exist() </em>方法创建了第一个测试，称为期望。我们将这种方法应用于DataFrame列的定义列表，以确保这些列确实存在。在本例中，我们创建了5个期望(5个不同列的一种期望)。最后，我们创建了一个expect-config对象来描述所创建的测试。这个对象可以作为JSON文件保存和加载。</p><p id="0453" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，我们只创建了这些测试，并将它们保存在一个配置文件中。现在，让我们对我们的两个数据文件应用这些测试，看看它们是否成功:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="b0ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="my"> ge.read_csv() </em>方法是对应的Pandas方法的包装器，并提供了定义期望套件的机会，该套件是我们的配置对象，应该用于数据验证。我们可以用<em class="my"> validate() </em>应用已定义的测试，并用<em class="my"> success() </em>检查它们是否成功。结果显示，对最后一个数据文件的测试成功，但对第一个文件的测试失败。这个输出和预期的一样，第一个文件的测试失败了，它有一个不同的列命名。我们可以使用以下命令查看更多详细信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="014c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们迭代每个单独的期望，并检查它是否成功。如果没有，我们将附加信息打印到控制台。输出告诉我们，数据集中没有必要的列“Country_Region”、“Last_Update”和“Active”。我们可以通过简单的列重命名来解决前两个问题。如果缺少“活动”列，则必须进行计算。</p><p id="ef82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">必要的数据清理和数据验证可以总结为一个功能:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="0b5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个函数做必要的数据准备，如果其中一个定义的测试失败了，就会引发一个错误。否则，它返回有效的DataFrame对象。</p><p id="030f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在成功地检查了基础知识之后，我们可以考虑对各个列进行一些更高级的测试。例如，我们可以检查“确认”、“死亡”和“恢复”列。我们知道这些列都应该是整数类型并且是正数。此外，如果没有有效的“Country_Region”或“Last_Update”条目，则整个数据行将毫无价值。所以我们也应该测试这个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e367" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们已经对最新的数据文件应用了这些测试，所以我们立即发现“Active”列有问题，它包含负值。我们应该在额外的预处理步骤中处理这些情况。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6c29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">额外的数据清理似乎足以在所有定义的测试中获得成功。现在，我们可以加载所有文件并开始使用它们，而不用担心输入数据中的任何意外行为。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2f6e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最终注释</h1><p id="1da7" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Great-expectations是一个强大的工具，可以帮助您检查数据源的一致性并保证数据质量。有许多<a class="ae kv" href="https://docs.greatexpectations.io/en/v0.4.5/dataset_module.html" rel="noopener ugc nofollow" target="_blank">预定义的期望</a>，您可以轻松定义自己的期望。<strong class="ky ir">本例中显示的内容只是演示基础知识</strong>。Great-expectations提供了很多更有趣、更强大的特性，比如Data Docs，它可以为您的验证结果创建漂亮的HTML结果。查看教程和文档以了解更多信息:</p><div class="mz na gp gr nb nc"><a href="https://github.com/great-expectations/great_expectations" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">远大的期望</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">永远要知道从你的数据中能得到什么。远大前程通过数据帮助数据团队消除管道债务…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq kp nc"/></div></div></a></div><p id="fbad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">似乎有几种方法可以生成和应用具有很高期望的测试。因为这些技术对我来说也很新，请告诉我，是否有比上面代码中应用的方法更高级的方法。</p><p id="7cb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>