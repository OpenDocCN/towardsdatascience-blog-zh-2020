<html>
<head>
<title>Setting Up a New PyTorch Deep Learning Environment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立新的PyTorch深度学习环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-up-a-new-pytorch-deep-learning-environment-313d8d1c2df0?source=collection_archive---------11-----------------------#2020-10-30">https://towardsdatascience.com/setting-up-a-new-pytorch-deep-learning-environment-313d8d1c2df0?source=collection_archive---------11-----------------------#2020-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e3385890739cd91f21b879254765576e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ENTxQoYF-SL_Nihi"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@acharki95?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿齐兹·阿查基</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class=""/><p id="4608" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论您是开始一个新项目，还是在远程机器上运行，您都不想浪费时间去寻找依赖项和安装软件库。</p><p id="56ed" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本教程将提供一种从空白开始设置的最快方法。</p><p id="4074" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我测试了这种方法，在Amazon Web Services上运行的一个简单的EC2实例上完成。</p><h2 id="ac03" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">管理您的包</h2><p id="cf30" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">PyTorch中的深度学习工作流是用Python编程语言编写的，您会发现自己需要安装许多额外的Python包才能获得作为数据科学家所需的所有功能。</p><p id="a69e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了保持整洁，您需要一个工具来帮助您管理Python环境。Conda是管理软件包、依赖项和环境的强大工具。我们将首先安装它。</p><p id="72b4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Miniconda是conda的免费极简安装程序。为您的操作系统找到<a class="ae jg" href="https://docs.conda.io/en/latest/miniconda.html" rel="noopener ugc nofollow" target="_blank">正确的Miniconda。</a></p><figure class="md me mf mg gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mc"><img src="../Images/c857a12df4bd247a2e6c13a47268b423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RRQQTtewlOILgHSKRU1HQg.gif"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">请注意，虽然我是在Mac上工作，但我是在AWS上运行的Linux实例上安装Miniconda的。</p></figure><p id="d84d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在64位Linux上使用Python 3.8:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8e07" class="le lf jj mi b gy mm mn l mo mp">$ wget <a class="ae jg" href="https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank">https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</a></span></pre><p id="5236" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的命令下载了一个bash脚本，我们现在运行它:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="6081" class="le lf jj mi b gy mm mn l mo mp">$ bash Miniconda3-latest-Linux-x86_64.sh</span></pre><p id="3bdb" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您需要查看许可协议。按下<space>翻到底部，在那里你将键入<code class="fe mq mr ms mi b">yes</code>同意它的条款。</space></p><p id="b1a7" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接受并安装。在安装过程中，您可能需要接受或修改一些设置，但这应该很简单。您可能会收到此警告:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="304c" class="le lf jj mi b gy mm mn l mo mp">WARNING:</span><span id="dc4a" class="le lf jj mi b gy mt mn l mo mp">You currently have a PYTHONPATH environment variable set. This may cause unexpected behavior when running the Python interpreter in Miniconda3.</span><span id="407c" class="le lf jj mi b gy mt mn l mo mp">For best results, please verify that your PYTHONPATH only points to directories of packages that are compatible with the Python interpreter in Miniconda3: /home/klassm/miniconda3</span></pre><p id="c0de" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mq mr ms mi b">PYTHONPATH</code>环境变量告诉您的系统在哪里寻找Python和适用的包。你可以检查这个被设置到什么目录。在Linux上:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="cbe2" class="le lf jj mi b gy mm mn l mo mp">$ echo $PYTHONPATH</span></pre><p id="f2f4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">列出该目录的内容后，我发现它只用于少量系统范围的站点包。我认为不重新分配我的<code class="fe mq mr ms mi b">PYTHONPATH</code>变量是安全的。</p><p id="a973" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">退出并返回以重置外壳。康达已经把你安置在它的“基础”环境中。</p><figure class="md me mf mg gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mu"><img src="../Images/49d56a9d9cb321d7a406b52249fcf1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8RejtkX3g2cCeV2yPbfk5w.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">请注意命令行前面的“(base)”。</p></figure><p id="3316" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在<code class="fe mq mr ms mi b">conda</code>应用程序已经安装好了，可以从命令行使用了。我可以通过键入以下内容来验证这一点</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="6204" class="le lf jj mi b gy mm mn l mo mp">$ conda</span></pre><p id="495a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在命令行中。您应该会看到如下所示的输出:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="6573" class="le lf jj mi b gy mm mn l mo mp">usage: conda [-h] [-V] command ...</span><span id="f0d0" class="le lf jj mi b gy mt mn l mo mp">conda is a tool for managing and deploying applications, environments and packages.</span><span id="0400" class="le lf jj mi b gy mt mn l mo mp">Options:</span><span id="5454" class="le lf jj mi b gy mt mn l mo mp">positional arguments:</span><span id="5aa4" class="le lf jj mi b gy mt mn l mo mp">...</span></pre><h2 id="bdd6" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">创建虚拟环境</h2><p id="4f64" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">现在我们来创建一个深度学习的虚拟环境。最佳实践是为每个项目创建一个虚拟环境。这样，您可以分离每个项目的所有依赖项。即使您认为您将重用相同的Python包，有时您将需要相同库的不同版本。事情会很快失去控制。帮你自己一个忙，创造一个虚拟的环境。</p><figure class="md me mf mg gt iv"><div class="bz fp l di"><div class="mv mw l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">当你不在虚拟环境中运行Python代码时，我的反应是。</p></figure><p id="9a65" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下内容指导Conda创建一个名为“pytorch”的虚拟环境:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e10d" class="le lf jj mi b gy mm mn l mo mp">$ conda create -n pytorch</span></pre><p id="50e2" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Conda会让你知道它计划做什么，并询问你是否同意。同意继续。您应该会看到类似这样的内容:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c061" class="le lf jj mi b gy mm mn l mo mp">## Package Plan ##</span><span id="45f3" class="le lf jj mi b gy mt mn l mo mp">environment location: /home/ec2-user/miniconda3/envs/pytorch</span><span id="1017" class="le lf jj mi b gy mt mn l mo mp">Proceed ([y]/n)? y</span><span id="9fc5" class="le lf jj mi b gy mt mn l mo mp">Preparing transaction: done<br/>Verifying transaction: done<br/>Executing transaction: done<br/>#<br/># To activate this environment, use<br/>#<br/>#     $ conda activate pytorch<br/>#<br/># To deactivate an active environment, use<br/>#<br/>#     $ conda deactivate</span></pre><p id="b7d6" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用以下命令激活pytorch环境</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b365" class="le lf jj mi b gy mm mn l mo mp">conda activate pytorch</span></pre><p id="89ea" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将注意到命令行中的“(base)”如何变成了“(pytorch)”，通知您现在处于新的虚拟环境中。</p><h2 id="5deb" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">安装CUDA(可选)</h2><p id="2dac" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">下一步是可选的。如果不打算在GPU上运行，可以直接跳到前面。</p><p id="bfae" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你计划在大型数据集上训练大型神经网络，GPU几乎是必不可少的。由于其架构与CPU的不同，GPU是运行大型并行矩阵计算的理想选择。顺便说一下，训练一个神经网络主要是矩阵计算。</p><p id="5e6f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">CUDA是Nvidia的一个库，允许开发人员与GPU进行交互。由于安装说明会因操作系统而异，请遵循Nvidia的<a class="ae jg" href="https://docs.nvidia.com/cuda/cuda-quick-start-guide/index.html" rel="noopener ugc nofollow" target="_blank">安装指南</a>中的说明。</p><h2 id="3723" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">安装软件包</h2><p id="7680" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">现在安装您需要的Python包。Matplotlib对于创建数据图很有用，但不是绝对必要的。</p><p id="e983" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下命令将安装这些包及其依赖项。这在我的机器上占用了大约1 GB的空间。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8b00" class="le lf jj mi b gy mm mn l mo mp">conda install -c conda-forge matplotlib pytorch torchvision</span></pre><p id="40f3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据您的项目，您可能需要一些其他的Python库，如scikit-learn或pandas。这些你可以用同样的方法轻松安装。</p><h2 id="91fd" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">确认</h2><p id="3f94" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">让我们确保一切安装正确。打开Python shell并键入:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="0430" class="le lf jj mi b gy mm mn l mo mp">&gt;&gt;&gt; import torch<br/>&gt;&gt;&gt; x = torch.rand(5,3)<br/>&gt;&gt;&gt; print(x)</span></pre><p id="cd10" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这创建了一个填充了随机值的5x3维张量。输出应该如下所示:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4c2b" class="le lf jj mi b gy mm mn l mo mp">tensor([[0.1279, 0.4032, 0.7045],<br/>        [0.2979, 0.1128, 0.7660],<br/>        [0.9651, 0.1172, 0.2716],<br/>        [0.9355, 0.1351, 0.3755],<br/>        [0.3469, 0.9118, 0.0110]])</span></pre><h2 id="a6d6" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">全部完成</h2><p id="9443" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">恭喜你！您已经为在PyTorch中运行深度学习工作负载做好了准备。</p><figure class="md me mf mg gt iv"><div class="bz fp l di"><div class="mx mw l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">当然，现在由你来设计一个神经网络并训练它。注意你的计算成本。</p></figure><h2 id="9266" class="le lf jj bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">警告</h2><p id="0d55" class="pw-post-body-paragraph kg kh jj ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">所以这个教程给人的印象是建立一个深度学习环境很容易，而且<em class="my">可以</em>做到。然而，困难/冗长的部分是正确设置CUDA。</p><p id="7321" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">避免任何头痛的最简单方法是从预配置的深度学习环境开始。有一些很好的资源可以帮你完成繁重的工作。</p><p id="926a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在AWS上，您可以从预先构建了所有必要的深度学习库和CUDA的Amazon机器映像启动EC2实例。选择AMI时只需搜索“深度学习”，你会发现几个选项。</p><figure class="md me mf mg gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mz"><img src="../Images/2aa397c76aa6c5e7307d5cc96358287d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EY7WoGWbWJ7U7SRvjZQgzQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">为您的EC2实例选择AMI时，只需搜索“深度学习”。</p></figure><p id="6f7e" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为深度学习而预先配置的虚拟机也可以在谷歌的云和微软Azure上使用。使用你最喜欢的云。</p><p id="85e2" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当选择在哪种类型的机器上运行时，如果您打算利用GPU，请记住<a class="ae jg" href="https://docs.aws.amazon.com/dlami/latest/devguide/gpu.html" rel="noopener ugc nofollow" target="_blank">选择一个连接了GPU的实例</a>。使用完实例后，不要忘记关闭它们！这些机器运行起来往往很昂贵。</p><p id="7a5b" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您只想在自己的机器上运行，另一个选择是使用一体化的预构建Docker映像。查看<a class="ae jg" href="https://github.com/ufoym/deepo" rel="noopener ugc nofollow" target="_blank"> Deepo </a>的一些例子。如果你家里有一个强大的钻机，这可能是更划算的选择。</p></div></div>    
</body>
</html>