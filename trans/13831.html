<html>
<head>
<title>Creating React + GraphQL Serverless Web application using AWS Amplify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Amplify创建React + GraphQL无服务器Web应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-react-graphql-serverless-web-application-using-aws-amplify-40e56f25796b?source=collection_archive---------4-----------------------#2020-09-23">https://towardsdatascience.com/creating-react-graphql-serverless-web-application-using-aws-amplify-40e56f25796b?source=collection_archive---------4-----------------------#2020-09-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/84f95ba9d80b7d14c114261db3b5376e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5psZ6f4SPs-bvcawjFrskQ.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">诺德伍德主题公司在<a class="ae kf" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="518d" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">AWS放大器</h1><p id="6c98" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">AWS Amplify是由Amazon Web Services提供的一项服务，它提供了使用AWS服务以更安全和可扩展的方式为移动和Web平台创建端到端解决方案的能力。AWS Amplify最初于2018年11月推出，从那时起，许多开发人员都创建并部署了他们的新应用程序，因为Amplify提供了简单性和可靠性。</p><p id="40dc" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Amplify提供了易于配置的功能，称为模块，名为认证，存储，后端API，托管和部署等。你可以从<a class="ae kf" href="https://aws.amazon.com/amplify/features/?nc=sn&amp;loc=2" rel="noopener ugc nofollow" target="_blank">这里</a>获得更多关于Amplify提供的模块的信息。在本文中，我们将使用3个模块，身份验证、后端api以及托管和部署。</p><p id="8530" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在本文中，让我们尝试使用GraphQL api构建和部署react应用程序。下面是为了实现我们的目标，我们将在本文中执行的任务。</p><ul class=""><li id="3ee3" class="mh mi it lg b lh mc ll md lp mj lt mk lx ml mb mm mn mo mp bi translated">安装和配置Amplify CLI</li><li id="bd00" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">创建react应用程序</li><li id="c408" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">添加身份验证</li><li id="c973" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">添加GraphQL api</li><li id="1870" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">在Amplify上部署和托管</li></ul><p id="2d27" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我在本文中使用的完整react应用程序代码可以在这里找到。</p><h2 id="a3df" class="mv kh it bd ki mw mx dn km my mz dp kq lp na nb ku lt nc nd ky lx ne nf lc ng bi translated">安装和配置Amplify CLI</h2><p id="1bfc" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在创建react应用程序之前，我们需要做的第一步是在系统中全局安装Amplify CLI工具。为此，我们需要在终端中运行以下命令。(我们需要在系统中安装node.js才能使用npm)</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="60ca" class="mv kh it nm b gy nq nr l ns nt">npm install -g @aws-amplify/cli</span></pre><p id="a7fd" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，为了用我们的AWS帐户配置已安装的Amplify，发出下面的命令。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="1f90" class="mv kh it nm b gy nq nr l ns nt">amplify configure</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/2b23f093f9d902a0d32ab7e411cf6362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lspwa3YvQYhbzGw509m2GA.png"/></div></div></figure><p id="8266" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这将提示我们需要回答的一系列问题。首先，它会要求我们使用web控制台登录我们的AWS帐户。下一个重要问题是它将为我们的Amplify CLI工具创建的IAM用户。在为用户指定一个名称之后，它将再次把我们重定向到IAM控制台，在这里我们需要为我们的用户提供必要的权限策略。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/386305b52af559a8229cb2d90eb8c4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZQy-zbAByknLawEmBPFTQ.png"/></div></div></figure><p id="e24c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在这里确保为用户添加<strong class="lg iu">管理员访问</strong>策略。然后转到<strong class="lg iu">安全凭证</strong>选项卡，为该用户创建一个访问密钥，并记住下载和存储凭证细节。回到控制台，作为下一步，它将要求这个<strong class="lg iu"> accessKeyId </strong>和<strong class="lg iu"> secretAccessKey。现在，我们已经完成了对Amplify CLI的配置。</strong></p><h2 id="d6e9" class="mv kh it bd ki mw mx dn km my mz dp kq lp na nb ku lt nc nd ky lx ne nf lc ng bi translated">创建react应用程序</h2><p id="a418" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在让我们开始创建react应用程序。为了创建新的react应用程序，发出以下命令。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="6bc1" class="mv kh it nm b gy nq nr l ns nt">npx create-react-app amplify-react-sample<br/>cd amplify-react-sample<br/>npm start</span></pre><p id="6665" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果在localhost:3000中一切顺利，它应该显示新创建的react应用程序。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/484ebcc262fdc4c77aa65fcf560de448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNeVRe04WyISzl0zvdkNOA.png"/></div></div></figure><p id="907c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下一步是将<strong class="lg iu"> aws-amplify </strong>作为依赖项添加到react应用程序中。这个包将具有从我们的react代码中对Amplify进行所有配置的功能。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="ca89" class="mv kh it nm b gy nq nr l ns nt">npm install aws-amplify @aws-amplify/ui-react</span></pre><p id="ca82" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，让我们为react应用程序初始化一个Amplify项目。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="8037" class="mv kh it nm b gy nq nr l ns nt">amplify init</span></pre><p id="2cc7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们将再次被提示回答一系列问题。对于项目名称，您可以随意命名。对于应用类型，选择<strong class="lg iu"> javascript </strong>，对于框架，选择<strong class="lg iu"> react </strong>。对于其他问题，我们可以保留默认值，因为我们不会更改应用程序内部的react构建和运行脚本。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/981939485d6f85dc477d64811e7e2b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZPPBxaArUAXFlFX5FHGQg.png"/></div></div></figure><p id="1b3b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们项目中的以下修改将在此步骤中完成。</p><ul class=""><li id="c74a" class="mh mi it lg b lh mc ll md lp mj lt mk lx ml mb mm mn mo mp bi translated">一个名为<strong class="lg iu"> amplify </strong>的新文件夹将在项目的根级别创建。它存储了与我们后端相关的所有配置(AWS资源)。(在本文中，我们将添加身份验证和GraphQL API)。随着我们添加更多的amplify功能，与这些功能相关的配置将作为基础架构代码存储在该文件夹中。</li><li id="bc39" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">将在<code class="fe nx ny nz nm b">src</code>目录中创建一个名为<code class="fe nx ny nz nm b">aws-exports.js</code>的文件，该文件包含我们将使用Amplify创建的服务的所有配置。目前，它只包含地区信息，因为我们还没有使用任何Amplify服务。</li></ul><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/034af6ab03af1f25a8c6a3053fa9c59d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgTWCpQ-0rmfAr9CQylOHQ.png"/></div></div></figure><p id="82e2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">同时，在AWS上将创建一个云项目，我们可以通过Amplify控制台访问该项目。控制台还为我们的应用程序提供了一些其他的配置选项。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/0032d2fd1e38c2dd408bb01973773f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfLielQaKvWOoQ44spZhNQ.png"/></div></div></figure><p id="9d1d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在我们的react应用程序已经用Amplify初始化了，让我们进入下一个任务，添加身份验证。</p><h2 id="d04a" class="mv kh it bd ki mw mx dn km my mz dp kq lp na nb ku lt nc nd ky lx ne nf lc ng bi translated">添加身份验证</h2><p id="a3cc" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于认证，Amplify使用<strong class="lg iu"> AWS Cognito </strong>作为主要的认证提供者。AWS Cognito提供了许多功能，如身份验证、用户注册、帐户恢复等等。你可以从<a class="ae kf" href="https://aws.amazon.com/cognito/details/" rel="noopener ugc nofollow" target="_blank">点击</a>查看更多可用功能或认知。要在我们的应用程序上添加Cognito身份验证，请在终端中发出以下命令。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="2c1c" class="mv kh it nm b gy nq nr l ns nt">amplify add auth</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/40e69cc934d086f7869f51a91252da71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vv1s9zbVPsLmd3IBXS-czQ.png"/></div></div></figure><p id="b938" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们将再次被提示有关身份验证配置的问题。对于本文，我们将选择<strong class="lg iu">默认配置</strong>进行安全配置。(如果需要，我们可以稍后通过运行amplify update auth来更新它)。对于登录选项，您可以选择<strong class="lg iu">用户名</strong>或<strong class="lg iu">电子邮件</strong>。</p><p id="540b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">就这样，现在我们已经为自己创建了身份验证模块。但在我们的应用中测试之前，我们需要将这种配置放大。为此，只需在终端中发出以下命令。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="a4e3" class="mv kh it nm b gy nq nr l ns nt">amplify push</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/b0fb17b53ef6dde948bcf92a95f37083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCuSxldpUAt-8zcKJNZFHw.png"/></div></div></figure><p id="953d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">该命令将在AWS上的Amplify和Cognito上创建所需的配置，还将使用Cognito auth配置编辑我们的<code class="fe nx ny nz nm b">aws-exports.js</code>文件。</p><p id="f381" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下一步是在我们的react应用程序中使用这种认知身份验证。首先，我们需要为我们应用程序导入放大器模块。编辑<code class="fe nx ny nz nm b">index.js</code>文件以导入放大器，并使用<code class="fe nx ny nz nm b">aws-exports.js</code>文件中的配置配置放大器模块。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="65b9" class="mv kh it nm b gy nq nr l ns nt">import Amplify from 'aws-amplify';<br/>import awsconfig from './aws-exports'; <br/>Amplify.configure(awsconfig);</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="783c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在我们可以在应用程序中使用auth模块了。转到<code class="fe nx ny nz nm b">app.js</code>，首先导入以下模块。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="aa31" class="mv kh it nm b gy nq nr l ns nt">import { withAuthenticator, AmplifySignOut } from "@aws-amplify/ui-react";</span></pre><p id="5b70" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，用带身份验证器的<strong class="lg iu">包装我们的<strong class="lg iu">应用</strong>组件。这里<strong class="lg iu"> AmplifySignOut </strong>是amplify-react提供的一个组件，它充当一个SignOut按钮。关于Amplify提供的更多预建UI组件，你可以在这里查看<a class="ae kf" href="https://docs.amplify.aws/ui/q/framework/react" rel="noopener ugc nofollow" target="_blank"/>。</strong></p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="3ed0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在我们已经在react应用程序中添加了Amplify身份验证，让我们启动服务器并测试它是否工作。运行<code class="fe nx ny nz nm b">npm start</code>，进入浏览器。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/a609a0be89d2f5f924ae40c07f9e4e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*CFpiEXIKc-SNHxHlC8soiQ.png"/></div></figure><p id="d775" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，当我们尝试访问localhost:3000时，它应该会显示一个登录页面。如果你能看到上面的页面，这意味着我们的身份验证设置正确。下一步是在我们的Cognito用户池中创建一个用户。您可以通过IAM控制台或点击<strong class="lg iu">创建账户</strong>来创建用户。用户也可以通过Cognito控制台进行管理。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/2e54b3632dbf8c8a20f5d34bc831c99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJ7tS_bpzv0jlOy6VX1MuA.png"/></div></div></figure><p id="bbc7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在尝试使用我们创建的用户登录，现在应该可以转到我们的主页了。如果一切正常，让我们进入下一个任务。</p><h2 id="a34b" class="mv kh it bd ki mw mx dn km my mz dp kq lp na nb ku lt nc nd ky lx ne nf lc ng bi translated">添加GraphQL API</h2><p id="1e2e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Amplify支持使用<strong class="lg iu"> AWS AppSync </strong>创建无服务器后端API。AppSync支持REST和GraphQL API框架。对于本文，我们将使用AppSync GraphQL api。要了解什么是GraphQL以及如何使用AWS AppSync创建无服务器的GraphQL，您可以查看我写的这篇文章。</p><p id="e116" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在添加后端GraphQL api之前，让我们对react应用程序做一些修改，以便在表格中显示数据。在本文中，让我们假设我们的应用程序将显示与演员相关的数据。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="3958" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在上面的代码中，我使用material-ui来创建表格，您可以使用<code class="fe nx ny nz nm b">npm install @material-ui/core</code>来安装它。代码只显示了一个表，在这个表中，我们已经在<strong class="lg iu"> getActors() </strong>方法中定义了一组数据。(确保也在App.js中导入Home组件)</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/6cab7a44887c148bfc91671df742fce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJkCutW7OSrYnb6-BlOSyA.png"/></div></div></figure><p id="7560" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，让我们尝试创建自己的GraphQL API来从API中检索参与者信息，而不是在代码中获取硬编码的值。要将GraphQL api添加到我们的应用程序中，只需在终端中发出以下命令。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="0a1a" class="mv kh it nm b gy nq nr l ns nt">amplify add api</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/4804506b6ad908367600b173ebd8d92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McEYny6VR6IxFatd2PwUBQ.png"/></div></div></figure><p id="6223" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">对于问题，您将被要求提供选择服务作为GraphQL和授权选择<strong class="lg iu">亚马逊认知用户池</strong>。接下来，为模式模板选择带有字段的<strong class="lg iu">单个对象。这将为我们自动创建一个简单的GraphQL模式。接下来，当您要求编辑模式时，按下<strong class="lg iu"> Y </strong>。</strong></p><p id="4e21" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这将打开我们自动创建的schema.graphql。在这里，我们可以看到已经创建了带有模型Todo的模式。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="4cb2" class="mv kh it nm b gy nq nr l ns nt">type Todo <a class="ae kf" href="http://twitter.com/model" rel="noopener ugc nofollow" target="_blank">@model</a> {<br/>  id: ID!<br/>  name: String!<br/>  description: String<br/>}</span></pre><p id="f3ae" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">让我们为我们的用例编辑这个模式，我们的模型将是<strong class="lg iu"> Actors。</strong></p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="2f34" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在这里，如果需要，我们还可以指定模式中允许的<strong class="lg iu">查询</strong>和<strong class="lg iu">变异</strong>。在GraphQL中，Query类似于GET调用，我们不对数据做任何修改，而Mutation类似于PUT、POST、DELETE调用，我们对数据做修改。但是如果我们想要的话，这也可以在AppSync中自动生成。</p><p id="87a6" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下一步是推动这个GraphQL api来扩展它在AppSync上的创建位置。发出下面的命令来推送API。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="104e" class="mv kh it nm b gy nq nr l ns nt">amplify push</span></pre><p id="e4c7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里再次向我们询问一组配置。选择语言目标为<strong class="lg iu"> javascript，并</strong>将文件模式设为默认<strong class="lg iu"/>。稍后，它将要求为我们的模式生成所有GraphQL操作。确保为此输入<strong class="lg iu"> Yes </strong>，因为这将为我们的演员模型自动生成查询和变异。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/9d6e9728fae3e1bffaca9729b15b0539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0GovxE03m6gO9ue-VxB4g.png"/></div></div></figure><p id="7926" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这将在AppSync上创建我们的GraphQL API。我们的数据库也将在<strong class="lg iu"> AWS DynamoDB </strong>上自动创建。此外，它在amplify文件夹中创建一个名为<code class="fe nx ny nz nm b">backend</code>的新文件夹。我们的Actor模式和其他AppSync相关配置可以在这个后端文件夹中找到。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/24df9a7dde787508301baacf178c9e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BVxBxOfgAVG5Z1A34JD_MQ.png"/></div></div></figure><p id="343d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在配置的最后，我们将获得使用actors模式配置的GraphQL端点。现在，如果我们转到AppSync控制台，我们可以看到新创建的Actors api。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/4a6002111f9e3227648f6bce189c83f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaGUAjcETorLjnQz0GYu8A.png"/></div></div></figure><p id="38ac" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在您可以看到我们的模式已经用查询和变异更新了，因为AppSync为我们生成了这些。这里，让我们试着创建一些数据，这样我们就可以从API进行查询。转到查询选项卡。在那里，从下拉菜单中选择突变并点击<strong class="lg iu"> + </strong>按钮。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8e70b4438f1b35655cd4add1cb693362.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*MYLVmHPtAwpeLNYCgLXZdA.png"/></div></figure><p id="5ac8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">突变是我们更新数据库的方式。因为我们需要创建演员，所以单击<strong class="lg iu"> createActor </strong>并填写演员的详细信息。现在，让我们添加两个演员。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/335bd54c2375a5da5216d07336682c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8FUvCY6d8f3Mh5pbukmig.png"/></div></div></figure><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/3326e93fd36f8c47a88e4d7d1ba5f723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GmiTGOU97HrpUaMJaJiqQw.png"/></div></div></figure><p id="5cf7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在让我们测试我们的GraphQL。为此，我们需要使用一个查询。点击<strong class="lg iu"> + </strong>按钮，删除突变并添加查询</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/519721e19e593742e44ee8309878b89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*7lK3Fsb5xdpkLeTMf6ijHg.png"/></div></figure><p id="47d6" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">让我们使用<strong class="lg iu"> listActors </strong>进行查询，只返回id、firstName、lastName、age和movies字段。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/1cfb1c07d29f0ffbbce18d0916f54daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51a08_kPXVjapBacAAGgcg.png"/></div></div></figure><p id="92d1" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果我们的查询返回了正确的结果，这意味着我们的GraphQL api现在已经正确配置了。现在让我们开始将GraphQL API添加到react应用程序中。</p><p id="a7ab" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">首先，我们需要在我们的Home组件中导入<strong class="lg iu"> Amplify </strong>、<strong class="lg iu"> API </strong>、<strong class="lg iu"> graphqlOperation </strong>模块。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="6a24" class="mv kh it nm b gy nq nr l ns nt">import Amplify, { API, graphqlOperation } from 'aws-amplify'</span></pre><p id="bf4a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，我们需要导入将要在应用程序中执行的查询和变异。在我们的例子中，查询是<strong class="lg iu"> listActors </strong>，变异是<strong class="lg iu"> createActor </strong>。我们可以从AppSync控制台或后端/api文件夹中的<code class="fe nx ny nz nm b">aws-schema.graphql</code>文件中获得这些查询或变异</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="6c67" class="mv kh it nm b gy nq nr l ns nt">import { createActor} from './graphql/mutations' <br/>import { listActors} from './graphql/queries'</span></pre><p id="a1e4" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">此外，确保使用正确的配置来配置导入的放大器。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="7dcf" class="mv kh it nm b gy nq nr l ns nt">import awsExports from "./aws-exports"; Amplify.configure(awsExports);</span></pre><p id="0815" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下面是我们将用于获取演员的函数。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="2ec2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，我们需要做的最后一件事是从UseEffect调用这个<strong class="lg iu"> fetchActors() </strong>函数。移除之前调用的<strong class="lg iu"> getActors() </strong>方法，替换为<strong class="lg iu"> fetchActors() </strong>。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="3c11" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，如果一切正常，它应该只显示2个演员，现在来自我们的GraphQL api。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi on"><img src="../Images/6db363b52a5455a1ae9a7c7120e71b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Wz-ZBlnz2hONhDg7dpJKA.png"/></div></div></figure><p id="59a3" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，让我们尝试使用react应用程序添加参与者。为此，我们将使用已经导入的<strong class="lg iu"> addActor </strong>突变。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="29c1" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">除了创建addActor()函数，我们还需要输入字段。下面是Home组件的完整代码。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="99b8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在让我们试着添加一个actor，在它出现在桌面上之后。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/21aaf020471e4e8a31828f6adbe0b1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HUP_OBMwa6jrOz1dZe2HQ.png"/></div></div></figure><p id="ffb1" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在已经完成了，让我们进入最后一项任务，部署和托管</p><h2 id="973c" class="mv kh it bd ki mw mx dn km my mz dp kq lp na nb ku lt nc nd ky lx ne nf lc ng bi translated">部署和托管</h2><p id="46c4" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，对于最后一部分，让我们通过发出以下命令为我们的应用程序添加托管模块。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="27c0" class="mv kh it nm b gy nq nr l ns nt">amplify add hosting</span></pre><p id="bc04" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们将再次被提示几个问题。对于插件选择带放大控制的<strong class="lg iu">主机，对于类型选择<strong class="lg iu">手动部署</strong>。</strong></p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/3082b809fff71e9b9ab2d899835bbc37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LuruPcmp6iWIZTo7_6gTMg.png"/></div></div></figure><p id="6abc" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在唯一剩下的事情就是发布这个模块来放大。对于以下问题命令。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="c791" class="mv kh it nm b gy nq nr l ns nt">amplify publish</span></pre><p id="297b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这将生成一个<strong class="lg iu"> cloudFormation </strong>堆栈，并将在AWS上创建必要的基础设施。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/c4c129dc8ab447a0fab2adebd1a47ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQyzL_Mztgj2YkdPxegYHQ.png"/></div></div></figure><p id="c239" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">过一会儿，所有的基础设施将被创建，我们将有部署的URL。你可以继续下去，检查网址，以确保每件事的工作，因为它应该是。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/f8b0f3d401c3e179382bf72e57a3febc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FF8XL1hNviB4AuN2BIb7xQ.png"/></div></div></figure><p id="c964" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">此外，除了手动部署，我们还可以从Amplify选择连续部署。</p><p id="6b38" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">好了，这是如何使用无服务器GraphQL api和使用Cognito认证部署react应用程序的简单指南。如果你想了解更多关于AWS Amplify和它的更多特性，请遵循官方文档。谢谢:)</p><div class="oq or gp gr os ot"><a href="https://docs.amplify.aws/start" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">放大框架文档</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">编辑描述</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">docs.amplify.aws</p></div></div></div></a></div></div></div>    
</body>
</html>