<html>
<head>
<title>Creating Interactive Maps for Instagram with Python and Folium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和Folium为Instagram创建交互式地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-interactive-maps-for-instagram-with-python-and-folium-68bc4691d075?source=collection_archive---------25-----------------------#2020-10-23">https://towardsdatascience.com/creating-interactive-maps-for-instagram-with-python-and-folium-68bc4691d075?source=collection_archive---------25-----------------------#2020-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7a73" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习使用Python的叶库制作漂亮的、定制的和交互式的地图，甚至合并您的Instagram帖子。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4b6197c6d7553a808224b63d34964639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fe0AKQji3IlAvYPTRwGJA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">根据您的喜好创建交互式地图|作者图片</p></figure><p id="97cf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi lr translated">我周末的一个追求就是逛遍我所在的英国牛津郡地区的所有酒吧。随着时间的推移，这些大量的酒吧访问已经变成了一个受欢迎的“牛津郡酒吧”Instagram页面。因此，当Instagram在2016年决定移除其“照片地图”功能时，这真是一个耻辱。原因是大多数用户实际上并没有使用它。但是，如果您的帐户可以很好地利用这样一个功能，那会怎么样呢？任何旅游、观光或本地博客页面肯定会从中受益。我花了很多时间摸索谷歌定制的、相当笨拙的“我的地图”功能，但结果从来都不太好，也不可能以任何方式整合Instagram帖子。嗯…，对于许多其他数据和web相关的任务，Python有一个答案。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="cafc" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">你需要什么</h2><p id="ccf4" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">Python有大量用于不同任务的库，当涉及到快速制作漂亮的交互式地图时，<a class="ae nf" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">leav</a>库做得非常好。好消息是，您不需要了解太多Python就能完成这项工作，因为我将一步一步地带您完成它。</p><p id="fc4d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们继续导入Let和我们将需要的其他依赖项(这些将在我们遇到它们时解释)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="fcd0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，让我们创建一个地图-一个简单明了的底图:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9cad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ni nj nk nl b">location=[]</code>参数设置地图中心的坐标(在这里是英国牛津附近)。<code class="fe ni nj nk nl b">tiles=</code>参数告诉叶使用来自<a class="ae nf" href="https://www.openstreetmap.org/#map=9/51.7831/-1.3046" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a> (OSM)的免费可用的开源地图切片。有几个缩放设置，最后，<code class="fe ni nj nk nl b">control_scale=</code>增加了一个比例尺。leav以HTML格式保存所有与地图相关的内容。这意味着您可以通过在浏览器中打开<code class="fe ni nj nk nl b">.html</code>文件来快速查看您的地图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/5512ef2a7cb6f777f3126e567bab775e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIWELYytN8jKWohatkdxiw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">树叶地图的默认OSM底图-由一行Python生成！|作者图片</p></figure><p id="f4cb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是这样！一行Python代码，我们就已经有了一个明亮、多彩的底图。但地图从何而来？Folium附带了一些内置的地图tilesets，您可以使用<code class="fe ni nj nk nl b">tiles=</code>参数轻松地指定它们。默认情况下是OSM tileset，但是leav也支持使用来自供应商的公开可用的地图切片，例如<a class="ae nf" href="http://maps.stamen.com/#terrain/12/37.7706/-122.3782" rel="noopener ugc nofollow" target="_blank"> <em class="nn">【雄蕊】</em></a><a class="ae nf" href="https://www.thunderforest.com/maps/" rel="noopener ugc nofollow" target="_blank"><em class="nn">雷森林</em></a><a class="ae nf" href="https://stadiamaps.com/" rel="noopener ugc nofollow" target="_blank"><em class="nn">Stadia</em></a><em class="nn"/><a class="ae nf" href="https://carto.com/basemaps/" rel="noopener ugc nofollow" target="_blank"><em class="nn">Carto</em></a>等。这个链接提供了一些地图块之间的快速比较。如果您只是为了个人、非商业用途进行制图，地图切片应该可以免费使用。</p><p id="a22d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我自己的“牛津郡的酒吧”地图，我希望对底图有更多的控制。我希望它看起来更环保，并包括所有可用的小径和人行道数据(这样人们就可以在他们选择的酒吧附近找到一个不错的散步场所)。<a class="ae nf" href="https://www.mapbox.com/maps/" rel="noopener ugc nofollow" target="_blank"> Mapbox </a>允许您定制自己的地图，然后通过您的个人API和访问令牌访问它，您可以将这些信息传递到lets:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1950" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您使用的是第三方图块提供商，请始终记得添加一个<code class="fe ni nj nk nl b">attr=</code>参数，这样他们的工作就能得到适当的认可(这显示在地图的右下角)。</p><h2 id="7bc5" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">添加地图元素</h2><p id="c64a" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">现在让我们开始添加一些元素到地图上。我想添加的第一件事是显示牛津郡边界的覆盖图。我在GeoJSON文件中有这方面的数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="8b4f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">保存地图，并在浏览器中打开。这是目前为止的情况:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/6c4de1f1cb0b2df9daf4469d8c8baa6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fox5mZ9esjiaz7QnFJIFGA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Mapbox为Strava和脸书等公司提供地图切片，现在您也可以使用它们了！|作者图片</p></figure><p id="0ddb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们开始更多的定制。首先，我们将加载一个图像，用作地图上标记的自定义图标。然后我们将加载另一个地理边界——这次是牛津城边界。你可以想象，与牛津郡的其他地方相比，牛津市中心的酒吧密度更高。为了避免大量的标记被一个接一个的绘制出来，以及一个看起来混乱的地图，我们将使用leav的<code class="fe ni nj nk nl b">MarkerCluster</code>插件(这是在第一步中导入的)。在低缩放级别下，标记聚类将位于牛津市边界内的所有标记组合在一起。只有放大时，各个标记才会分开。为此，我们将利用Python的<a class="ae nf" href="https://docs.python.org/3/library/json.html" rel="noopener ugc nofollow" target="_blank"> json </a>和<a class="ae nf" href="https://shapely.readthedocs.io/en/stable/manual.html" rel="noopener ugc nofollow" target="_blank"> Shapely </a>库(也是上面导入的)，它们对于任何类型的空间操作都非常有用。在下面的代码中，我们使用<code class="fe ni nj nk nl b">json</code>库读取文件，然后使用<code class="fe ni nj nk nl b">json</code>文件的<code class="fe ni nj nk nl b">geometry</code>属性定义一个形状:<code class="fe ni nj nk nl b">oxford_boundary</code>。最后，我们创建了<code class="fe ni nj nk nl b">MarkerCluster</code>，它也有许多自定义其行为的选项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="8c57" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">让我们添加一些标记</h2><p id="9218" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">在一个单独的Python字典中，我已经存储了与我想要添加到地图中的每个酒馆相关联的所有数据。对于每个酒吧，都有一对坐标，一个Instagram帖子的链接，酒吧的网站和谷歌地图方向。我们将使用这些细节将Instagram帖子和网站链接合并到每个标记的弹出窗口中。字典是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="45f5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是主要的跑腿工作。这里我们使用一个简单的<code class="fe ni nj nk nl b">for</code>循环来遍历我们想要创建标记的所有酒馆。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="937d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">需要注意的一点是，每个标记都需要自己的<code class="fe ni nj nk nl b">CustomIcon</code>实例，因此我们在循环的每次迭代中都创建一个。标记弹出窗口使用HTML来设置样式。HTML通常用于设计网站，但在这种情况下，它允许我们使用<code class="fe ni nj nk nl b">&lt;iframe src={insta_post}</code>将Instagram帖子嵌入到弹出窗口中。同样，我们可以向弹出窗口添加文本，并按照我们想要的方式设置样式。每个标记都是用自己的<code class="fe ni nj nk nl b">CustomIcon</code>、<code class="fe ni nj nk nl b">Popup</code>、<code class="fe ni nj nk nl b">coordinates</code>和<code class="fe ni nj nk nl b">tooltip</code>(悬停)文本实例逐个创建的。<code class="fe ni nj nk nl b">for</code>循环的最后一部分使用<code class="fe ni nj nk nl b">oxford_boundary</code>形状来测试标记是否位于牛津城边界内。如果是，则添加到<code class="fe ni nj nk nl b">oxford_cluster</code>中，如果不是，则单独添加到地图中。最后，使用导入的<code class="fe ni nj nk nl b">LocateControl</code>插件添加一个地理位置按钮，并在HTML中设置浏览器标签标题。</p><h2 id="1445" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">最终的交互式地图</h2><p id="ea1d" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">下面是它的预览图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/b1a7893e345e49a854884b31817e9ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHnQiSpPjTH9jgpg-WKzdg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">点击此处查看全互动地图<a class="ae nf" href="https://pubs-of-oxfordshire-map.github.io/" rel="noopener ugc nofollow" target="_blank"/>|作者图片</p></figure><p id="c72d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">牛津上空可以看到<code class="fe ni nj nk nl b">MarkerCluster</code>。如果单击，地图会放大以显示牛津聚类中包含的所有11个标记。每个标记都可以点击，以显示一个弹出窗口，并带有嵌入式Instagram帖子和网站链接。让我们来看看:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/94783a815eb80fb09aa37581990af9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKdIxx3m3NsV0SyweRHKiA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">你几乎可以添加任何你想标记的弹出窗口！|作者图片</p></figure><p id="c072" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">全功能互动地图可在此查看:<a class="ae nf" href="https://pubs-of-oxfordshire-map.github.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="nn">https://pubs-of-oxfordshire-map.github.io/</em></strong></a>。</p><p id="0554" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然在浏览器中打开本地的<code class="fe ni nj nk nl b">.html</code>文件可以很容易地查看地图，但是如果您想要在线获取它，您需要将它托管在某个地方。<a class="ae nf" href="https://pages.github.com/" rel="noopener ugc nofollow" target="_blank"> Github Pages </a>提供了一个非常快速简单的托管服务，可以从你的<code class="fe ni nj nk nl b">.html</code>文件中创建一个网页，这就是我在酒吧地图中使用的。而且是免费的！</p><p id="b8b1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">希望这能给你提供一些提示和灵感，让你尝试Python和follow的定制地图。鉴于well与各种第三方地图图块提供商集成得如此之好，其支持HTML的大量选项<em class="nn">和</em>使其足够强大，几乎可以实现<em class="nn">任何您想要的外观。</em></strong></p><p id="6d55" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你对所有代码感兴趣，这里有一个链接，链接到牛津郡Github Repo的<a class="ae nf" href="https://github.com/Pubs-of-Oxfordshire-Map/Pubs-of-Oxfordshire-Map.github.io" rel="noopener ugc nofollow" target="_blank">酒馆，地图就在那里。</a></p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><blockquote class="np"><p id="3618" class="nq nr iq bd ns nt nu nv nw nx ny lq dk translated">如果你对牛津郡周围的酒吧感兴趣，一定要看看牛津郡Instagram页面  <strong class="ak">的<a class="ae nf" href="https://www.instagram.com/pubsofoxfordshire/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">酒吧！🍺</strong></a></strong></p></blockquote></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="6c06" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">附录-(图标)</h2><p id="24f8" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">我们可以在这里停下来，但是如果你想更进一步，可以通过编辑保存地图的<code class="fe ni nj nk nl b">.html</code>文件来添加Favicons——也称为tab——或网站图标。像<a class="ae nf" href="https://realfavicongenerator.net/" rel="noopener ugc nofollow" target="_blank"> RealFaviconGenerator </a>这样的网站让你上传一张图片或标志，网站会生成一系列大小完全合适的图片，供各种操作系统和浏览器渲染。这些图像需要放在网站所在的根文件夹中。生成器还为您提供了一些HTML文本，您需要将这些文本插入到<code class="fe ni nj nk nl b">.html</code>文件的<code class="fe ni nj nk nl b">&lt;head&gt;</code>部分。这个文本将不同的浏览器指向正确的图像，这样你就可以在你的标签上看到一个漂亮的网站图标。</p><p id="b1b4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将利用Python的<a class="ae nf" href="https://www.crummy.com/software/BeautifulSoup/" rel="noopener ugc nofollow" target="_blank">美汤</a>库(开头导入)来读取<code class="fe ni nj nk nl b">.html</code>文件并找到<code class="fe ni nj nk nl b">&lt;head&gt;</code>部分。这使得为收藏夹图标添加<code class="fe ni nj nk nl b">tab_icon</code> HTML文本变得很容易。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="1a77" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">真的是这样！</h2><p id="0152" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">我就说到这里，但是如果你有任何想法或问题，请留下你的评论🙂</p><p id="e235" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读！🍻</p></div></div>    
</body>
</html>