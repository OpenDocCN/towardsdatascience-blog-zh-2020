<html>
<head>
<title>Automating Running Routes in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中运行路线的自动化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automating-running-routes-in-r-1e97eb4ed716?source=collection_archive---------37-----------------------#2020-10-06">https://towardsdatascience.com/automating-running-routes-in-r-1e97eb4ed716?source=collection_archive---------37-----------------------#2020-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a245" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="03fe" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用Graphhopper API(在rvest和PostcodesIO的帮助下)运行伦敦的每个Mews</h2></div><p id="8077" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">冬天已经来到了英国，当其他人都在匆忙修理锅炉时，我最关心的是保持每周的运行里程，而温度却在相反的方向。</p><p id="12e8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">探索伦敦的新地方似乎是个好主意，而且不必考虑走哪条路似乎更好。所以计划是跑遍伦敦的每一条消息，让R决定怎么做。</p><p id="cce8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">本文中有一些代码片段，其余的在<a class="ae lk" href="https://github.com/fredwise/run_the_mews" rel="noopener ugc nofollow" target="_blank"> fredwise/run_the_mews </a>上。</p><h1 id="bb84" class="ll lm iq bd ln lo lp lq lr ls lt lu lv kf lw kg lx ki ly kj lz kl ma km mb mc bi translated">新闻</h1><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/83ecf7d69b1fe862d2b7407a25509174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IHNP9yYU4BEWVQ3q"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/@brunus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布鲁诺·马丁斯</a>在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="057a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">隐藏在伦敦一些大排屋后面的是386个原始的和幸存的消息。这些小街是真正的马动力的残余，虽然马厩和马车房现在大多是车库和底层厨房，但它们仍然是很好的观光景点。</p><h2 id="f857" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kx my mz lx lb na nb lz lf nc nd mb iw bi translated">找到他们</h2><p id="7526" class="pw-post-body-paragraph ko kp iq kq b kr ne ka kt ku nf kd kw kx ng kz la lb nh ld le lf ni lh li lj ij bi translated"><a class="ae lk" href="https://everchangingmews.com/" rel="noopener ugc nofollow" target="_blank"> Everchanging Mews </a>在这里做了腿的工作，在过去的10年里，他们访问了1200多个Mews，在他们的百科网站上对它们进行了分类。</p><p id="5713" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">原始/幸存的mews列表分为8页，每个列表都有一个包含更多详细信息的网页。Chrome Dev Tools 找到保存这个网址的元素，并对R包做了一些工作<a class="ae lk" href="https://github.com/tidyverse/rvest" rel="noopener ugc nofollow" target="_blank"> rvest </a>列出了它们。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="cc73" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kx my mz lx lb na nb lz lf nc nd mb iw bi translated">对它们进行地理编码</h2><p id="3275" class="pw-post-body-paragraph ko kp iq kq b kr ne ka kt ku nf kd kw kx ng kz la lb nh ld le lf ni lh li lj ij bi translated">这些网页中的每一个都有一个邮政编码，<a class="ae lk" href="https://docs.ropensci.org/PostcodesioR/" rel="noopener ugc nofollow" target="_blank">邮政编码员</a>将查询<a class="ae lk" href="http://postcodes.io" rel="noopener ugc nofollow" target="_blank">的邮政编码，io </a>以获得位置数据。当邮政编码不可靠或者在<a class="ae lk" href="http://postcodes.io" rel="noopener ugc nofollow" target="_blank">邮政编码. io </a>数据库(386中的第7个)中不存在时，这里需要进行一些手工清理。之后，只需通过<a class="ae lk" href="https://www.rdocumentation.org/packages/PostcodesioR/versions/0.1.1/topics/postcode_lookup" rel="noopener ugc nofollow" target="_blank">邮政编码_查找</a>运行它们。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="aa8f" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kx my mz lx lb na nb lz lf nc nd mb iw bi translated">映射它们</h2><p id="dfd4" class="pw-post-body-paragraph ko kp iq kq b kr ne ka kt ku nf kd kw kx ng kz la lb nh ld le lf ni lh li lj ij bi translated">在这里，我们只需要将经度和纬度作为一个形状文件传递给活页。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/034df2e5c5778f925af2ce2774847f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*FTv_m-Nwf4FtJQ7FngLJ4Q.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">一页上的386条原始/幸存的消息</p></figure><h2 id="0faa" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kx my mz lx lb na nb lz lf nc nd mb iw bi translated">路由它们</h2><p id="8622" class="pw-post-body-paragraph ko kp iq kq b kr ne ka kt ku nf kd kw kx ng kz la lb nh ld le lf ni lh li lj ij bi translated">希望所有这些的真正价值来自于路线生成的自动化。最初的问题陈述是:</p><blockquote class="nm nn no"><p id="39c5" class="ko kp np kq b kr ks ka kt ku kv kd kw nq ky kz la nr lc ld le ns lg lh li lj ij bi translated">在20公里或更短的路线中，查找覆盖所有386家酒店的最短总路线。每条路线都从同一个地方开始。</p></blockquote><p id="8858" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">GraphHopper 是这类路线优化的优秀免费资源。它允许所有种类的车辆(在这个例子中是脚)的路线，但是它的免费API只允许每个请求最多5个位置。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/a6a776404d0e571742e1c83a09460dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*Bkl1zUHlO33piAmhSilG-A.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">GraphHopper甚至可以让你为一辆小型摩托车导航。</p></figure><p id="a50e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一个简单的解决方案是一次随机选择5个位置。这样做的代价是没有优化总距离，但是在这种情况下，这意味着完成了更多的运行，并且没有消息被访问两次(只要随机采样没有替换)，所以应该这样做！</p><h2 id="4244" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kx my mz lx lb na nb lz lf nc nd mb iw bi translated">使用GraphHopper API</h2><p id="1a97" class="pw-post-body-paragraph ko kp iq kq b kr ne ka kt ku nf kd kw kx ng kz la lb nh ld le lf ni lh li lj ij bi translated">GraphHopper的<a class="ae lk" href="https://docs.graphhopper.com/" rel="noopener ugc nofollow" target="_blank">文档</a>非常棒，所需要的就是以正确的格式传递5个位置的纬度和经度。下面的代码片段显示了一个函数，它将这个请求构建为R列表，并使用<a class="ae lk" href="https://rdrr.io/cran/jsonlite/" rel="noopener ugc nofollow" target="_blank"> jsonlite </a>将其转换为JSON。提醒一下，完整的脚本可以在<a class="ae lk" href="https://github.com/fredwise/run_the_mews" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4475" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对我们的5个位置运行路线的78个查询使用httr::POST发送到GraphHopper API</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7cc3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">使用<a class="ae lk" href="https://r-spatial.github.io/sf/" rel="noopener ugc nofollow" target="_blank"> sf包</a>将响应路径坐标转换成简单特征，并在<a class="ae lk" href="https://rstudio.github.io/leaflet/" rel="noopener ugc nofollow" target="_blank">活页</a>中绘制成折线。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nu"><img src="../Images/efed03903802097b902d3ea9d42d1f93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stYRGI9e9bFcEZVxIO70kg.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">Graphopper做了大量的工作来优化我们五个mews集合之间的路线</p></figure><h2 id="6b1a" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kx my mz lx lb na nb lz lf nc nd mb iw bi translated">线串到GPX</h2><p id="4d07" class="pw-post-body-paragraph ko kp iq kq b kr ne ka kt ku nf kd kw kx ng kz la lb nh ld le lf ni lh li lj ij bi translated">最后但并非最不重要的是，在设备上具有这些路线将是有用的，以便跟随该路线。只需将从每个GraphHopper响应路径创建的简单特性传递给sf::st_write</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c8da" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">哇，78个GPX文件和78天的奔跑，不用考虑去哪里！</p></div></div>    
</body>
</html>