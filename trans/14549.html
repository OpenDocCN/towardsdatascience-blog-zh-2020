<html>
<head>
<title>How to peek inside a black box model — Understand Partial Dependence Plot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何窥视黑盒模型内部——理解部分依赖图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-peek-inside-a-black-box-model-understand-partial-dependence-plots-17d1b673aafc?source=collection_archive---------34-----------------------#2020-10-07">https://towardsdatascience.com/how-to-peek-inside-a-black-box-model-understand-partial-dependence-plots-17d1b673aafc?source=collection_archive---------34-----------------------#2020-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cb98" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用部分相关图揭示目标特性对黑盒模型的影响。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/491c043aeb5ce3106bc1b17b40db4083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEWwEowlhqwW7EwJ5kE4lw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者拍摄的照片</p></figure><p id="7a22" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我们将学习一个工具来揭示黑盒模型的工作机制。但是在我们开始之前，让我们谈点别的。</p><p id="8205" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi lr translated">浣熊是一种非常有趣的动物，喜欢在进食前清洗食物，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/601c13caf7b010a27a79aad551e4167e.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/1*m0BcTZ-WFbO2nA3ZOlUYBQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">让我们洗一些棉花糖(GIF来自<a class="ae mb" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="5e0a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这种行为在我们看来可能是正常的，因为卫生问题。但是这对可爱的小浣熊有关系吗？</p><p id="acaa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实并非如此。为了解开这个神秘的行为，研究人员研究了浣熊的神经纤维和大脑皮层，最终得出了一个可能的解释。浣熊的前爪上有非常敏感的神经群。通过弄湿它们的爪子，它们能够获得更多关于将要吃什么的感官信息。</p><h1 id="7e26" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">黑箱模型</h1><p id="1cbe" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">现在，让我们回到我们的主题。什么是黑盒模型。在计算机科学中，黑盒模型是一个系统，可以根据其输入和输出来查看，而无需了解其内部工作原理。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b1c4a17d350a75928167cf923c5379a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*09lOWuwkT5pRydAwOpkf3Q.png"/></div></figure><p id="972e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的小科学故事中的浣熊是一个黑箱模型，输入包括食物和水，输出是它们良好的进食习惯。仅从我们的观察来看，我们无法理解他们为什么那样做。因此，我们的好奇心可能会驱使我们进一步探索。除了情感上的自我实现，揭开黑匣子确实有实用价值。</p><p id="391a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，在像航空航天这样的任务关键型行业中，即使黑盒模型可以为我们提供更高的准确性，采用这种解决方案也是值得怀疑的，因为我们不了解它是如何工作的以及会受到什么影响。因此，如果我们能有一些工具来揭示这个神秘的工厂就更好了。其中一个有用的工具叫做部分依赖图(PDP)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/9238e713c25e08073a886fb6ec9e4d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/1*VLWORWnMpLaBLAf7nDcOHA.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GIF来自<a class="ae mb" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><h1 id="d8d7" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">并行分布处理</h1><p id="94cd" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">部分相关图(PDP)显示了模型预测如何部分依赖于感兴趣的输入变量值。</p><p id="fc77" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">通俗地说，就是剧情。从该图中，它将帮助我们了解一个或两个输入特征如何影响模型预测结果。</strong></p><p id="42b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可能会问为什么有一两个特征？因为我们生活在一个三维世界中。我们很难想象更高的维度。</p><p id="3a5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">原则上，我们将检查给定训练模型的特征集对预测结果的边际效应。下面的公式明确说明了我们将如何实现这一目标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/32b4b105ed54e5f883f2d7c0d27e1468.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*yIOZQu1-Dp2zhq0BA3dEWw.jpeg"/></div></figure><p id="e9a3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">左手边的功能<strong class="kx ir"> <em class="nc"> f </em> </strong>称为部分功能。在右侧，它将对感兴趣的特征<em class="nc"> Xs </em>保持不变，并对数据集中其他特征<em class="nc"> Xc </em>的所有其他组合进行平均预测。</p><p id="7f55" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，给定以下数据集:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/a24bb22246b9ae8910d783cc259a3def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*vi3UzLs-ft1HLScip4kJ1Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">虚拟房屋特征表(图片由作者提供)</p></figure><p id="e53c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们要检查街道值的边际效应，我们将在日期集中取唯一的街道值A、B和C，并分别替换每个样本的街道值。然后，我们可以使用新生成的数据样本来计算模型的平均预测值:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/34209b2475359a70ea09c9321441d64d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlIb1_3LlKkqvbC76dN1iA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">替换每个样本的街道值(图片由作者提供)</p></figure><p id="4e8a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">获取每个街道价值的平均预测价格后，我们将能够绘制一个街道价值与平均预测价格的关系图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/768e5f67597663e66cf14350035974cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*l1xI23ciRaPWIeRcCiltcw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">街道虚拟PDP(图片由作者提供)</p></figure><p id="12ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从该图中，我们知道该模型通常预测街道A上的房屋价值较高，而街道B上的房屋价值较低。</p><h1 id="8d75" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">实施</strong></h1><p id="bcc6" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">在理解了PDP的整体概念之后，我们将通过一个真实的例子来更深入地探讨这个问题。</p><p id="96ba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是2017年世界幸福得分的<a class="ae mb" href="https://www.kaggle.com/unsdsn/world-happiness?select=2017.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>快照。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/8e36067648e016ffae16c272cca6a701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jaQWP--1yTzJ_yEuQCIX3w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自数据集的样本(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/48a712fd1dbdf19486c38270bcddaf23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFNFJAACQKWUz-1n9CdP8w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">特写(图片由作者提供)</p></figure><p id="4339" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">据此，我建立了一个简单的关于快乐的回归模型。选择7个特征对进行评分。模型训练过程的细节可以在下面的笔记本中找到。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">2017年幸福值XGBoost回归模型</p></figure><p id="f7de" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于我们使用的是XGBoost，这是一种集成方法，会产生一个黑盒模型，因此我们可以使用PDP来探索和了解每个功能在这个复杂的工厂中是如何发挥作用的。代码可以在下面的笔记本中找到:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="6212" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了更好地说明，我使用Plotly重新创建了这个图表。代码可以在<a class="ae mb" href="https://gist.github.com/fyr91/d29d1bb4ebac97e338dd2286002669d9" rel="noopener ugc nofollow" target="_blank">这里</a>找到供你参考。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/f9c79f00d785cd024b81fb324352cd54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9Ak4o3Ux9PVlNWZ2nvjvw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有Plotly的PDP(图片由作者提供)</p></figure><p id="b0d1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在分析PDP之前，我们需要考虑三个预防措施。</p><p id="931a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第一个</strong>是<strong class="kx ir">特征关联</strong>。通过使用PDP，我们假设了目标特性和其余特性之间的独立性。如果存在相关性，替换目标特征值可能会导致其不具有任何实用价值的情况。例如，<strong class="kx ir">健康。预期寿命与经济高度相关。GDP.per.Captita </strong>，通过改变经济的数值。健康。预期寿命应该相应地改变。然而，当我们检查这两个值的部分相关性时，我们通过修正另一个值来创建在现实生活中不太可能存在的数据点。因此，重要的是要记住这样一个假设，即目标特性应该独立于其他特性。</p><p id="e1b1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第二个</strong>是<strong class="kx ir">数据分配</strong>。您可能会注意到，在x轴上，我显示了来自样本数据集的目标特征值的分布。由于我们是从这些值计算部分相关性，不考虑数据分布的分析可能是危险的。在无数据区，我们可能高估了目标特征的影响。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/cc8ff0d038ae5a709c1f95f3f2a0fc4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMproCt3lJ8uRIeZIxur0g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">反乌托邦的分布。x轴上的残差可以帮助识别无数据区域(图片由作者提供)</p></figure><p id="8351" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第三个</strong>，还有一个诡雷我们需要关心，隐藏的<strong class="kx ir">异质效果</strong>。由于部分相关性是一个平均估计值，因此得到的值可能无法代表给定目标特征的实际边际效应。例如，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/b4c6f890d95bceccd737e51fe37b2912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QWk69Wa-OqqetiAsSvhVQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="97f1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一半的分数高于平均水平，一半低于平均水平。然而，由此产生的部分依赖性却讲述了另一个故事。为了解决这个问题，我们可以使用其他工具，如个人条件期望(ICE)图来提供模型的粗略视图。</p><p id="528b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">考虑到这些，我们可以从模型中提取一些有用的信息。一般来说，<strong class="kx ir">家庭</strong>，<strong class="kx ir">自由</strong>和<strong class="kx ir">反面乌托邦。残差</strong>对从模型中得出的幸福分数有正面影响。尽管经济不景气。人均GDP和<strong class="kx ir">健康。预期寿命也可能有潜在的积极影响，它们高度相关，在进一步的研究之前，我们不能相信这一点。</strong></p><h1 id="b044" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">总结</strong></h1><p id="4798" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">总之，PDP是一种模型不可知的方法，有助于理解目标特性如何影响任何派生的模型。它直观且易于实施，但确实有一些限制:</p><ul class=""><li id="e0b7" class="nm nn iq kx b ky kz lb lc le no li np lm nq lq nr ns nt nu bi translated">一个图(线图或热图图)中只能检查一到两个要素。</li><li id="be10" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated">目标特征应该独立于其他特征。</li><li id="e80e" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated">在分析影响时，需要考虑数据分布。</li><li id="6ce9" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated">情节中可能隐藏着不同的影响，并可能导致错误的结论。</li></ul><p id="6274" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">希望这篇帖子有所帮助，帮助你打开神秘世界的大门。敬请期待，再见~</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GIF来自<a class="ae mb" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure></div></div>    
</body>
</html>