<html>
<head>
<title>Checking data consistency during platform migrations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在平台迁移期间检查数据一致性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/checking-data-consistency-during-platform-migrations-83eed17479c5?source=collection_archive---------33-----------------------#2020-10-16">https://towardsdatascience.com/checking-data-consistency-during-platform-migrations-83eed17479c5?source=collection_archive---------33-----------------------#2020-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/7dcf069c159dd474ab757f4ca01a2c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StB5g-7bTakYGFAhl4fmBA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">检查数据的一致性是一项具有挑战性的任务(图片尤利娅·卢卡申娜)</p></figure><h2 id="36d5" class="jg jh ji bd b dl jj jk jl jm jn jo dk jp translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="2cb9" class="pw-subtitle-paragraph ko jr ji bd b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dk translated">确保平稳的数据迁移:我自己在Salesforce、SAP和许多其他公司的经验，包括实际例子、图表和代码块</h2></div><h1 id="8ee4" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">什么是“平台”，它与数据科学有什么关系？</h1><p id="2a43" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">对于平台，我指的是以某种方式永久存储数据的所有软件。不一定是数据分析平台，而是CRM、ERP(企业资源规划)、活动管理平台等。</p><p id="b547" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">十年前，平台迁移曾经是一件独特而罕见的事情。如今，许多公司每隔几年就迁移一次工作流程。有时，他们这样做是因为更好的技术已经到来。更常见的是，一个老的甚至工作良好的人被安排退休。</p><p id="5068" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该平台收集的数据通常用于业务分析报告。通常，业务平台有一个分析扩展。一个很好的例子是Salesforce平台及其爱因斯坦分析扩展。在某些情况下，必须定期在第三方工具中提取、处理和可视化数据。</p><h1 id="80b2" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">什么是数据一致性，平台迁移有什么问题？</h1><p id="c4f4" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">每个平台及其分析扩展都有用于计算和可视化关键性能指标的例程。这些例程因平台而异。有些提供ETL工具；有些没有，所以您可以直接在可视化界面中进行一些数据清理。</p><p id="21ee" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">但是作为企业所有者或经理，您需要一个共同标准，即您日常决策中使用的所有关键KPI的标准表示。您还希望确保基础计算可能导致相同或几乎相同的结果，尽管结果可能不同。</p><p id="a9c0" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">迁移结束后，您打开一个新构建但不熟悉的KPI仪表板。这些数字对你来说一定还是有意义的。</p><p id="ce6f" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">另一个潜在的陷阱是实现新的计算程序意味着新的数据管道。新的数据存储。从原始位置弹出数据的新方法。一份闪亮的商业报告需要很多步骤才能完成。出现错误的可能性很大。</p><h1 id="a16f" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">几个实际例子</h1><p id="d252" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">到目前为止，这听起来可能太理论化了——这是我过去的几个例子。</p><h2 id="0519" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">亚马逊S3的传统平台</h2><p id="cf6a" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">几年前，我参与了一次平台迁移，这是因为需要更大的数据存储和更快的基于云的数据管道。该公司决定用亚马逊S3云取代传统平台。</p><p id="b8d2" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">客户以。他们保存在SFTP服务器上的CSV文件。亚马逊S3数据管道将对它们进行消化、处理，并创建一个SQL数据库。数据库连接到多个Tableau仪表板。新数据每天都有。</p><p id="dd21" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在向客户展示新系统之前，我们同时运行了一段时间。我们很快注意到，新的管道往往无法提供与旧管道相同的结果。原因之一是。CSV文件与亚马逊S3中创建的模式不匹配。粗略地说，这些文件通常有不同的列名或者数据格式错误。</p><h2 id="da79" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">Google DoubleClick的传统活动管理工具</h2><p id="7b57" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">还有一次，我的公司想从利基营销管理工具迁移到Google DoubleClick。因为我们的主要客户希望他的旧报告是一对一的，所以应该从DoubleClick中提取数据，写入SQL数据库，然后消化到Microsoft PowerBI中。</p><p id="0e07" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">陷阱很快就暴露出来了。与前一种情况一样。CSV文件包含错误的列名。在谷歌分析中，它们有时会在没有警告的情况下被更改。自从下载了。CSV文件自动运行，不一致的数据被插入到数据库中，随后破坏了KPI仪表板。此外，没有遵循分类维度的命名约定。</p><p id="eab0" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">新数据也是每天都有。这些差距被自动传输到PowerBI可视化中，它们的错误让很多人感到非常沮丧。</p><h2 id="c67d" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">SAP至Salesforce</h2><p id="d7c6" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我的下一次迁移有一个巨大的范围:该公司希望从SAP迁移一个ERP、一个CRM和一个分析工具，SAP宣布其一些模块退休，转到其竞争对手Salesforce。Salesforce并不专注于ERP市场。它提供单个软件包，可以帮助您组装预订和发票的工作流程。不过，这需要大量的定制。</p><p id="321f" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，来自新ERP的数据与来自SAP环境的数据非常不同。此外，Salesforce分析扩展有相当多的细节。在迁移过程中，SAP数据被直接插入到Salesforce Einstein Analytics中。作为两个系统之间的桥梁，SQL数据库存储两者之间的数据。</p><p id="5982" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">的。从SAP弹出的CSV文件未能添加到数据库中。最重要的是，Einstein Analytics数据管道交付的结果与我们在SAP分析工具中看到的结果有所不同。KPI就像高度聚合的总收入一样，完全不一样！</p><h1 id="6cd6" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">即席检查数据一致性</h1><p id="5135" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">每一个差异都让我去钻研数据。我开发了一些可靠的方法。</p><h2 id="8edd" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">向下的方法</h2><p id="80e4" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">您从KPI开始，这些KPI通常是较小单位值的高度聚合。例如，您会发现不同平台的总收入是不同的。您可以进一步比较每个客户或给定时间段的收入。</p><p id="90e5" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">可能只有特定客户的金额会有偏差。你继续深入，选择下一层，例如，一个合同。然后是账单。迟早，你会发现差异，现在可以寻找原因。您应该找到一个错误的数据条目。然后你去找出数据条目是什么时候被添加到你的系统中的。查看一堆数据，比如. CSV文件。可能，它已损坏，与数据结构不匹配，或者有数据格式问题。</p><h2 id="cc33" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">向上的方法</h2><p id="5c17" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">根据报告的类型，有时您可以直接分配错误数据条目到达的时间段。或涵盖显示不正确总收入的合同期限的时间段。然后，您可以跳到最低的汇总级别，或者跳到根本没有汇总的级别。例如，您获取每个合同或账单，从每个系统中导出它们，并通过匹配它们的id来比较它们。</p><h2 id="14ab" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">元数据级别</h2><p id="8cda" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我不喜欢比较KPI。这意味着理解他们的业务逻辑。这种逻辑经常会在我不知道的情况下改变。比较元数据似乎是一种更安全的方式，但并不总是足够的。</p><p id="2c67" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">众所周知，元数据是关于数据的数据。我之前所说的模式。您检查传入的数据是否具有相同的结构。这包括但不限于:</p><ul class=""><li id="2aeb" class="nk nl ji ma b mb mu me mv mh nm ml nn mp no mt np nq nr ns bi translated">列名</li><li id="ef94" class="nk nl ji ma b mb nt me nu mh nv ml nw mp nx mt np nq nr ns bi translated">对于某些工具:列顺序！</li><li id="70c5" class="nk nl ji ma b mb nt me nu mh nv ml nw mp nx mt np nq nr ns bi translated">数据格式，尤其是日期</li><li id="1f02" class="nk nl ji ma b mb nt me nu mh nv ml nw mp nx mt np nq nr ns bi translated">分类维度的名称</li></ul><p id="57f9" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您有关于三个营销活动的数据，突然，一个. CSV有了第四个活动，而您没有处理规则，那么您的数据管道可能会混乱。</p><h1 id="d2e3" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">数据不一致的其他原因</h1><p id="e66e" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果最小的数据单元——合同、账单、预订——在不同的平台上具有不同的值，这意味着您将错误的数据加载到一个或两个数据管道中。</p><p id="7539" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从这个水平开始，偏差只会越来越大，总的结果会越来越大。</p><p id="a52e" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在许多情况下，这些最小的单元与管道内的一些附加数据相匹配，如客户、行业等。这允许在流程的后期对数据进行分组和聚合。这些匹配经常失败:客户更改了公司名称，CRM的名称不正确，名称和ID不匹配，等等。</p><p id="0546" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">匹配规则中的异常也令人头疼。如果你忘记把旧系统的所有异常都复制到新系统中，你就会有偏差。只有当您开始比较聚合数据时，它们才变得可见。</p><h1 id="c604" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">持续检查数据的一致性</h1><p id="0735" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">基本上，所有方法都适用于持续监控。你只需要将它们自动化。</p><p id="e3d5" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您可以监控一个平台，可能是新平台，或者两个都监控。这取决于您对遗留平台的信任或您使用的方法。</p><p id="bcc5" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从技术角度来看，这是通过以下方式实现的。我提取了两个平台的数据，并把它们进行了对比。我花了有限的一段时间，主要是最近的一段时间。一些计算也需要以前时期的数据。在一些特殊情况下，用户可以调整过去期间的数据条目，比如为当前达到折扣启用值的合同添加折扣。这就是为什么我定期对去年的数据进行一致性检查。</p><h2 id="fdc3" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">那么，这实际上意味着什么呢？</h2><p id="8eb2" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">您可以在其中一个分析扩展中运行检查。或者，您可以从两个系统中导出数据，并在第三个工具中比较元数据。两种方法我都尝试过，但最终都是基于Python的管道。</p><p id="ed0f" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这两个报告的提取也可以自动化。不过，这取决于工具。</p><h2 id="2129" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">比较数据</h2><p id="30a1" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我下载了两个CSV。旧平台和新平台上的文件。它们有不同的结构，但是应该有一个键，比如事务ID。我有一个R或Python脚本，它处理来自两个系统的数据，获取键，并将其他数据作为键的属性进行比较。</p><p id="e558" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是两个(当然是虚构的)导出的截图:</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/b6c79bfa8e085ddd74f4eb490f19ff34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVtG6l5fCB370IOA5nGLeQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">遗留平台样本原始数据:电子商务交易</p></figure><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/6dc1438866ed42df0813dfeff9ed7d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dov2diR7oJXd8iOCFSKNQw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">目标平台样本原始数据:电子商务交易</p></figure><p id="072f" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该脚本将来自两个系统的数据标准化，重命名列或维度，或者使用附加数据将不同的命名放在一起。</p><p id="8338" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">例如，交易313200在旧系统中的价值为40，00美元，在新系统中的价值为40美元。它是匹配的。Python脚本找到了两种格式的共同点，并对实际值进行了比较。</p><p id="eb93" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我比较了交易的每一个属性，不仅包括总和，还包括字符串列:</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/e7d7f0495c7bf69155960b5a0dd19193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gOdA1JQ0_2ZGElwpcUUB6w.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">检查单个事务的属性</p></figure><p id="7287" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">作为最后一个例子，我附上了总收入比较。</p><p id="ddd0" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您可能已经注意到，相同的交易在不同的平台上有不同的客户ID。我转换包含它们的名称的列，并将它们用作键。然后，我对交易值求和，得到每个客户的收入，并计算增量。</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/935f1c5f9ba40987f9c336af0cfda320.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*HOWFKorgdC144gAWAGNdOA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">比较每个客户的总收入(不同平台之间的差异)</p></figure><h2 id="ce87" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">比较元数据</h2><p id="e6c0" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">您可以用日期-时间来标记数据的时间戳，以指示它被弹出或被消化的时间。然后，检查最近一段时间(如昨天)添加到数据库的新数据量，以排除此阶段的异常和错误。</p><p id="d7c1" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您计算在某一天(比如昨天)打上时间戳的行数。</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/d144ddd94b9047b75a01bf2df09e3d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzfA1eRPjhgPD5RAkwUNpQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">检查元数据:过去24小时内添加到两个系统的行数</p></figure><p id="6df6" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">检查分类变量也是如此。您可以创建一个数据可视化来显示您的维度值，甚至检查是否添加了任何新值。</p><h2 id="4dcb" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">得到通知</h2><p id="83b2" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">另一个好的做法是创建一个警报，在出现问题时向您发出警告。例如，如果新行的数量小于零。</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/15a59fddc93ae49cc06390cbe381adcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fMwSFwmC1nQbKv8iM9Z-Nw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">在小部件上设置通知</p></figure><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/240e9dbc8e8c4858ba6138622b306bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7m7sJSVSPoVZQqJdCJnRJg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">定义通知触发器:如果最近没有添加新行</p></figure><h1 id="296e" class="lg lh ji bd li lj lk ll lm ln lo lp lq kx lr ky ls la lt lb lu ld lv le lw lx bi translated">一会儿之后</h1><p id="f6a2" class="pw-post-body-paragraph ly lz ji ma b mb mc ks md me mf kv mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">对于这篇文章，我以稍微简化的形式重新创建了我以前的工作程序。我不能发布完全相同的数据和方法，因为我既没有访问它们的权利，也没有为自己的利益使用它们的权利。我创建了我的真实方法的抽象，使它们匿名和通用。所有特定于公司的信息都被小心翼翼地删除了。除了日常工作之外，我还主动要求定期进行数据一致性检查，并制定方法。</p><p id="30ba" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我使用了sales force Einstein Analytics trail head操场来构建上面的数据可视化。不涉及数据管道。数据处理直接发生在数据可视化界面中。</p><p id="94a3" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是我用来构建表的SAQL查询:</p><h2 id="7291" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">属性比较:</h2><pre class="nz oa ob oc gt oj ok ol om aw on bi"><span id="9e21" class="mz lh ji ok b gy oo op l oq or">legacy = load "System_1_Legacy";<br/>legacy = filter legacy by date(Processed_Year, Processed_Month, Processed_Day) in ["1 day ago" .. "1 day ago"]; <br/>legacy = foreach legacy generate Processed, count() as Count_Rows;<br/>legacy = group legacy by Processed;<br/>legacy = foreach legacy generate Processed as Last_Insert_Date, sum(Count_Rows) as Count_Rows_Legacy;</span><span id="2303" class="mz lh ji ok b gy os op l oq or">target = load "System_2_Target";<br/>target = filter target by date(System_Timestamp_Year, System_Timestamp_Month, System_Timestamp_Day) in ["1 day ago" .. "1 day ago"]; <br/>target = foreach target generate System_Timestamp, count() as Count_Rows;<br/>target = group target by System_Timestamp;<br/>target = foreach target generate System_Timestamp as Last_Insert_Date, sum(Count_Rows) as Count_Rows_Target;</span><span id="a453" class="mz lh ji ok b gy os op l oq or">result = cogroup legacy by Last_Insert_Date full, target by Last_Insert_Date;<br/>result = foreach result generate legacy.Last_Insert_Date as Legacy_Last_Insert_Date, target.Last_Insert_Date as Target_Last_Insert_Date, <br/>    coalesce(sum(legacy.Count_Rows_Legacy), 0) as Count_Rows_Legacy,<br/>    coalesce(sum(target.Count_Rows_Target), 0) as Count_Rows_Target,<br/>    coalesce(sum(legacy.Count_Rows_Legacy), 0) - coalesce(sum(target.Count_Rows_Target), 0) as Delta_Count_Rows;</span></pre><h2 id="fc5a" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">总收入比较:</h2><pre class="nz oa ob oc gt oj ok ol om aw on bi"><span id="3597" class="mz lh ji ok b gy oo op l oq or">legacy = load "System_1_Legacy";<br/>target = load "System_2_Target";<br/>legacy = filter legacy by date(Processed_Year, Processed_Month, Processed_Day) in ["1 day ago" .. "1 day ago"]; <br/>target = filter target by date(System_Timestamp_Year, System_Timestamp_Month, System_Timestamp_Day) in ["1 day ago" .. "1 day ago"];</span><span id="6709" class="mz lh ji ok b gy os op l oq or">legacy = foreach legacy generate Surname + ", " + Name as Customer_Name, Transaction_Value;<br/>result = cogroup legacy by Customer_Name full, target by Name;<br/>result = foreach result generate legacy.Customer_Name as Customer_Name, <br/>coalesce(sum(legacy.Transaction_Value), 0) - coalesce(sum(target.Total_sum), 0) as Delta;</span></pre><h2 id="5a12" class="mz lh ji bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw jo bi translated">行数/元数据比较:</h2><pre class="nz oa ob oc gt oj ok ol om aw on bi"><span id="7af9" class="mz lh ji ok b gy oo op l oq or">legacy = load "System_1_Legacy";<br/>target = load "System_2_Target";<br/>legacy = filter legacy by date(Processed_Year, Processed_Month, Processed_Day) in ["1 day ago" .. "1 day ago"]; <br/>target = filter target by date(System_Timestamp_Year, System_Timestamp_Month, System_Timestamp_Day) in ["1 day ago" .. "1 day ago"]; <br/>legacy = foreach legacy generate Transaction_ID, <br/>                                Surname + ", " + Name as Customer_Name, <br/>                                Transaction_Currency,<br/>                                Transaction_Timestamp,<br/>                                Processed,<br/>                                Transaction_Value;<br/>result = cogroup legacy by (Transaction_ID, <br/>                            Customer_Name, <br/>                            Transaction_Currency,<br/>                            Transaction_Timestamp,<br/>                            Processed) full, <br/>                target by (Order_ID, <br/>                            Name, Currency,<br/>                            Ordered_at,<br/>                            System_Timestamp);<br/>result = foreach result generate legacy.Transaction_ID as legacy_ID, target.Order_ID as target_ID,<br/>(case when coalesce(sum(legacy.Transaction_Value), 0) == coalesce(sum(target.Total_sum), 0) then 0 else 1 end) as Transaction_Value_Check,<br/>(case when legacy.Customer_Name == target.Name then 0 else 1 end) as Customer_Name_Check,<br/>(case when legacy.Transaction_Currency == target.Currency then 0 else 1 end) as Transaction_Currency_Check,<br/>(case when legacy.Transaction_Timestamp == target.Ordered_at then 0 else 1 end) as Transaction_Timestamp_Check,<br/>(case when legacy.Processed == target.System_Timestamp then 0 else 1 end) as Processed_Check;</span></pre><p id="09a8" class="pw-post-body-paragraph ly lz ji ma b mb mu ks md me mv kv mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">测试愉快！</p></div></div>    
</body>
</html>