<html>
<head>
<title>Step-By-Step Guide to ECDFs — A Robust Histogram Replacement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ECDFs分步指南——强大的直方图替换</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/step-by-step-guide-to-ecdfs-a-robust-histogram-replacement-8b2309ac9c1c?source=collection_archive---------43-----------------------#2020-10-23">https://towardsdatascience.com/step-by-step-guide-to-ecdfs-a-robust-histogram-replacement-8b2309ac9c1c?source=collection_archive---------43-----------------------#2020-10-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a1c1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用ECDFs一劳永逸地抛弃宁滨偏见</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/be9d68940f94934a2a07b4368e60b394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CnhR1F7jJeYrcOP6H3q-wA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jannerboy62?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尼克·费因斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/analytics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8a12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个人都喜欢好的数据可视化。尽管如此，他们不应该把解释留给观众，就像直方图一样。今天我们将回答<em class="lv">宁滨偏差</em>如何在分析中误导你，以及如何用ECDF图的力量来防止这个问题。</p><p id="c4ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章回答了以下问题:</p><ul class=""><li id="1e20" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">直方图有什么问题——什么时候应该避免使用它们</li><li id="4eac" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">如何用ECDFs替换直方图——一种更健壮的检查数据分布的方法</li><li id="35d0" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">如何在单个图表中使用和解释多个ECDFs比较不同数据段之间的分布</li></ul><p id="42ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，我们开始吧！</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="e980" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">直方图有什么问题？</h1><p id="78b0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">正如来自<a class="ae ky" href="https://learn.datacamp.com/courses/statistical-thinking-in-python-part-1" rel="noopener ugc nofollow" target="_blank">数据营</a>的贾斯汀·博伊斯所说——宁滨偏见——我完全同意。这意味着在直方图上使用不同的区间大小会使数据分布看起来不同。不要相信我的话，下面的例子不言自明。</p><p id="e599" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将导入几个用于数据分析和可视化的库，并直接从web加载<a class="ae ky" href="https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv" rel="noopener ugc nofollow" target="_blank"> Titanic </a>数据集:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="4aae" class="nt ms it np b gy nu nv l nw nx">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>sns.set()<br/><br/>df = pd.read_csv('https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv')</span></pre><p id="573b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您不熟悉数据集，下面是前几行的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b95a792b6036619fb058f81fd008a20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XhrrB87p0rLxFEXM.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="7614" class="nt ms it np b gy nu nv l nw nx">df.dropna(subset=['Age'], inplace=True)</span></pre><p id="7f2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们声明一个可视化直方图的函数。它需要很多参数，但在我们的例子中最重要的参数是:</p><ul class=""><li id="d88d" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><code class="fe nz oa ob np b">x</code>–表示我们要为其绘制直方图的单个属性</li><li id="b9b7" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe nz oa ob np b">nbins</code>–直方图应该有多少个箱</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="ca03" class="nt ms it np b gy nu nv l nw nx">def plot_histogram(x, size=(14, 8), nbins=10, title='Histogram', xlab='Age', ylab='Count'):<br/>    plt.figure(figsize=size)<br/>    plt.hist(x, bins=nbins, color='#087E8B')<br/>    plt.title(title, size=20)<br/>    plt.xlabel(xlab, size=14)<br/>    plt.ylabel(ylab, size=14)<br/>    <br/>plot_histogram(df['Age'], title='Histogram of passenger ages')<br/>plot_histogram(df['Age'], nbins=30, title='Histogram of passenger ages')</span></pre><p id="9b48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用提到的函数两次，第一次用10个面元制作直方图，第二次用30个面元制作直方图。结果如下:</p><p id="5c1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有10个条块的直方图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/45546ecd0b5aee9d0d7da88538cbfd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8_WFtCTxOGf_DcQs.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="849f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有30个条柱的直方图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/2f63a0737c92f26e7deaf5b67683a36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-IvSvuR24RoOrLK7.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="09aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据是相同的，但不同的箱大小会导致<em class="lv">宁滨偏差</em>——由于视觉表现的细微变化，对相同数据的感知不同。</p><p id="51ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们能做些什么来解决这个问题？ECDF的阴谋终于来了。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3616" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">ECD fs——更强大的直方图替换</h1><p id="140e" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">ECDF代表<em class="lv">经验累积分布函数</em>。别担心，它没有听起来那么花哨，也相对容易理解。</p><p id="dc0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像直方图一样，ECDFs显示单个变量的分布，但方式更有效。我们之前已经看到了直方图是如何由于不同的bin大小选项而产生误导的。ECDFs就不是这样了。ECDFs显示每一个数据点，并且该图只能以一种方式解释。</p><p id="2dcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将ECDFs视为散点图，因为它们也有沿X轴和Y轴的点。更准确地说，这是ECDFs在两个轴上显示的内容:</p><ul class=""><li id="bc09" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">x轴——我们正在测量的量(上面例子中的<em class="lv">年龄</em>)</li><li id="d2aa" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">Y轴-值小于相应X值的数据点的百分比(在每个点X，Y%的值小于或等于X)</li></ul><p id="9e3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这种可视化，我们需要先做一些计算。需要两个阵列:</p><ul class=""><li id="e451" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">X —排序数据(从最低到最高排序<em class="lv">年龄</em>列)</li><li id="a19a" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">y-最大值为1的均匀间隔数据点列表(如100%)</li></ul><p id="e269" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下Python片段可用于计算Pandas数据帧中单个列的<em class="lv"> X </em>和<em class="lv"> Y </em>值:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="5030" class="nt ms it np b gy nu nv l nw nx">def ecdf(df, column):<br/>    x = np.sort(df[column])<br/>    y = np.arange(1, len(x) + 1) / len(x)<br/>    return x, y</span></pre><p id="2261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个非常简单的问题。不过，我们还需要一个函数。这个是用来做一个实际的图表的:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="050e" class="nt ms it np b gy nu nv l nw nx">def plot_ecdf(x, y, size=(14, 8), title='ECDF', xlab='Age', ylab='Percentage', color='#087E8B'):<br/>    plt.figure(figsize=size)<br/>    plt.scatter(x, y, color=color)<br/>    plt.title(title, size=20)<br/>    plt.xlabel(xlab, size=14)<br/>    plt.ylabel(ylab, size=14)</span></pre><p id="c3a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用这个函数来制作一个<em class="lv">年龄</em>属性的ECDF图:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="a022" class="nt ms it np b gy nu nv l nw nx">x, y = ecdf(df, 'Age')<br/><br/>plot_ecdf(x, y, title='ECDF of passenger ages', xlab='Age')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6724cac94d0176436fbf35541f003247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OUHbRiwCCJarlhxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4cd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">但是等等，我该怎么解读这个？这很容易。这里有几个例子:</em></p><ul class=""><li id="314b" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">大约25%的乘客年龄在20岁或以下</li><li id="1615" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">大约80%的乘客年龄在40岁以下</li><li id="27c3" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">大约5%的乘客年龄在60岁或以上(1——百分比)</li></ul><p id="b4b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那不是很容易吗？但是等等，派对不会就此结束。接下来我们来探讨如何绘制和解释多个ECDFs。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="25bf" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">多个ECDFs</h1><p id="2c7e" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在Titanic数据集中，我们有<em class="lv"> Pclass </em>属性，它表示乘客类别。即使在今天，这种等级组织也是旅行中的典型，因为头等舱是为较富裕的人保留的，其他的舱是其他人所在的地方。</p><p id="2554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">借助ECDFs的强大功能，我们可以探索乘客年龄是如何在各个阶层中分布的。我们需要调用<code class="fe nz oa ob np b">ecdf()</code>函数三次，因为船上有三个类。代码的其余部分归结为数据可视化，这是不言自明的:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="d20c" class="nt ms it np b gy nu nv l nw nx">x1, y1 = ecdf(df[df['Pclass'] == 1], 'Age')<br/>x2, y2 = ecdf(df[df['Pclass'] == 2], 'Age')<br/>x3, y3 = ecdf(df[df['Pclass'] == 3], 'Age')<br/><br/>plt.figure(figsize=(14, 8))<br/>plt.scatter(x1, y1, color='#087E8B')<br/>plt.scatter(x2, y2, color='#f1c40f')<br/>plt.scatter(x3, y3, color='#e74c3c')<br/>plt.title('ECDF of ages across passenger classes', size=20)<br/>plt.xlabel('Age', size=14)<br/>plt.ylabel('Percentage', size=14)<br/>plt.legend(labels=['Pclass = 1', 'Pclass = 2', 'Pclass = 3'])<br/>plt.show()</span></pre><p id="1c8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果可视化如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/1b78acab499d2ad75d9ab5951d2b5ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TqZ7D_vnHaHs9SMg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c731" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，第三个班级(红色)有很多孩子，而第一个班级(绿色)没有这么多孩子。第一个班级的学生年龄也很大:</p><ul class=""><li id="09b2" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">只有20%的头等舱乘客年龄超过50岁</li><li id="f6c3" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">只有20%的二等舱乘客年龄超过40岁</li><li id="a6c9" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">只有20%的三等舱乘客年龄超过34岁</li></ul><p id="3978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些只是粗略的数字，所以如果我犯了一两年的错误，不要引用我的话。现在您知道了如何使用和解释ECDFs。让我们在下一部分总结一下。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="228a" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">离别赠言</h1><p id="cf15" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">不要把任何东西留给数据科学中的个人解读。仅仅因为你喜欢在柱状图中看到15个柱，并不意味着你的同事也喜欢。如果直观地解释，这些差异可能会导致不同的数据解释。</p><p id="e33d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ECDFs就不是这样了。现在，您已经对它们有了足够的了解，可以将它们包含在下一个数据分析项目中。乍一看，它们似乎令人望而生畏，但我希望这篇文章做出了必要的澄清。</p><p id="43ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p><p id="ff76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入我的私人邮件列表，获取更多有用的见解。</strong>T3】</a></p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="57b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="og oh gp gr oi oj"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ks oj"/></div></div></a></div></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="cc55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于2020年10月23日https://betterdatascience.com</em><a class="ae ky" href="https://betterdatascience.com/ecdf-as-a-histogram-replacement/" rel="noopener ugc nofollow" target="_blank"><em class="lv"/></a><em class="lv">。</em></p></div></div>    
</body>
</html>