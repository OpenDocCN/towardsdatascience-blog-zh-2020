<html>
<head>
<title>Supercharging Game Development with GPU Accelerated Machine Learning using the Godot Engine, Kompute Framework and Vulkan SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GPU加速游戏开发使用Godot引擎、Kompute框架和Vulkan SDK加速机器学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/supercharging-game-development-with-gpu-accelerated-ml-using-vulkan-kompute-the-godot-game-engine-4e75a84ea9f0?source=collection_archive---------19-----------------------#2020-09-27">https://towardsdatascience.com/supercharging-game-development-with-gpu-accelerated-ml-using-vulkan-kompute-the-godot-game-engine-4e75a84ea9f0?source=collection_archive---------19-----------------------#2020-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d1ed" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="5fa5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">一个实践教程，教你如何使用Godot游戏引擎和Kompute框架将GPU优化的ML代码集成到你的游戏开发工作流程中</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/893cac32c19d1003df29fbe6fee4fab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0b22fD_oJ6vhlWaJkIj4IQ.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="5732" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最近，世界已经看到了游戏行业和人工智能领域的各种定义性里程碑。仅在几周内，我们已经看到了游戏行业的重大财务公告，包括<a class="ae md" href="https://venturebeat.com/2020/09/18/unity-technologies-raises-more-than-1-1-billion-in-ipo-at-12-1-billion-valuation/" rel="noopener ugc nofollow" target="_blank">Unity 13亿美元的IPO </a>和<a class="ae md" href="https://venturebeat.com/2020/08/06/epic-games-unveils-1-78-billion-funding-round-at-17-3-billion-valuation/" rel="noopener ugc nofollow" target="_blank">Epic Games 17.8亿美元的投资</a>。人工智能领域也一直在赶上它的宣传，在2020年达到600多亿美元的市场，并在人工智能和游戏的交叉领域带来了令人兴奋的应用，包括<a class="ae md" href="https://deepmind.com/research/case-studies/alphago-the-story-so-far" rel="noopener ugc nofollow" target="_blank"> AlphaGo击败冠军Lee Sedol </a>，以及深度学习驱动的游戏，如<a class="ae md" href="https://play.aidungeon.io/main/landing" rel="noopener ugc nofollow" target="_blank">人工智能地牢</a>(以及<a class="ae md" href="https://en.wikipedia.org/wiki/Artificial_intelligence_in_video_games" rel="noopener ugc nofollow" target="_blank">更多应用</a>)。</p><p id="c169" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">本文从技术上深入探讨了应用人工智能和游戏开发这两个领域之间的交集。我们专门研究如何利用跨供应商/移动GPU框架的能力来加速机器学习和高级数据处理用例的处理。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/0fe7577618842476c09eda470bcb09cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B14elpCp2BwwjDIg7Fgu2g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">本教程的简单游戏界面(图片由作者提供)</p></figure><p id="4363" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在本教程中，你将学习如何使用<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> Kompute框架</strong> </a>在流行的开源<a class="ae md" href="https://github.com/godotengine/godot" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> Godot游戏引擎</strong> </a>内部构建GPU优化代码。</p><p id="8c49" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">您将了解如何通过Godot游戏引擎在游戏开发中利用机器学习和高级GPU计算。</p><p id="0a10" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">除了编程经验之外，不需要任何背景知识<strong class="lj jd">，但是如果你对参考的底层AI / GPU计算概念感兴趣，我们建议查看我们以前的文章，“移动中的<a class="ae md" rel="noopener" target="_blank" href="/machine-learning-and-data-processing-in-the-gpu-with-vulkan-kompute-c9350e5e5d3a">机器学习&amp;跨供应商GPU使用Kompute &amp; Vulkan </a>变得简单”。</strong></p><p id="0b3f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你可以在 资源库的<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/master/examples/godot_logistic_regression" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd">示例文件夹中找到完整的代码，以及<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/master/examples/godot_logistic_regression/gdnative_shared" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> GDNative库</strong> </a>实现和<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/master/examples/godot_logistic_regression/custom_module" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> Godot自定义模块</strong> </a>实现。</strong></a></p><h1 id="d5e6" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">Godot游戏引擎</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/885ca0d7c6b056880a1e09c60a4ecc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*afuXUNGpqOa4-Wh7.jpg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片来自Godot <a class="ae md" href="https://github.com/godotengine/godot" rel="noopener ugc nofollow" target="_blank">开源GitHub库</a></p></figure><p id="1d64" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">拥有超过30k github明星和超过1k贡献者的Godot是最受欢迎的OSS游戏引擎。Godot <a class="ae md" href="https://www.youtube.com/watch?v=KjX5llYZ5eQ" rel="noopener ugc nofollow" target="_blank">迎合了2D和3D开发</a>的需求，已经被广泛用于手机、桌面、主机和网络兼容游戏/应用。Godot是用C++构建的，这使得它又快又轻——它只有40MB的下载空间。</p><p id="5a67" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Godot通过<a class="ae md" href="https://docs.godotengine.org/en/stable/getting_started/step_by_step/godot_design_philosophy.html" rel="noopener ugc nofollow" target="_blank">健壮的设计原则</a>和对<a class="ae md" href="https://docs.godotengine.org/en/stable/getting_started/step_by_step/godot_design_philosophy.html#all-inclusive-package" rel="noopener ugc nofollow" target="_blank">高级语言</a>的支持，包括其领域特定语言<a class="ae md" href="https://docs.godotengine.org/en/stable/getting_started/scripting/gdscript/gdscript_basics.html" rel="noopener ugc nofollow" target="_blank"> GdScript </a>，对于新手来说非常直观，具有类似Python的语法，使其非常容易采用。也可以使用C#、Python、可视化脚本、C++等进行开发。</p><p id="10af" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在本教程中，我们将使用编辑器构建一个游戏，使用GdScript触发ML训练/推理，使用C++开发底层的核心处理组件。</p><h1 id="8ab8" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">进入Kompute &amp; Vulkan SDK</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi my"><img src="../Images/69fe34f4969de848be6f3e7c63c68b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*mzEbYNdCJ129eSz3"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">与Khronos成员一起玩“瓦尔多在哪里”(图片由Vincent Hindriksen通过<a class="ae md" href="https://streamhpc.com/blog/2017-05-04/what-is-khronos-as-of-today/" rel="noopener ugc nofollow" target="_blank"> StreamHPC </a>提供)</p></figure><p id="0440" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Vulkan是一个由<a class="ae md" href="https://www.khronos.org/" rel="noopener ugc nofollow" target="_blank"> Khronos Group </a>领导的开源项目，Khronos Group是一个由大量技术公司组成的财团，他们聚集在一起，致力于定义和推进移动和桌面媒体(和计算)技术的开放标准。</p><p id="fec7" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">大量引人注目的(和新的)框架已经采用Vulkan作为他们的核心GPU处理SDK。Godot引擎本身正在进行一个重大的4.0更新，将<a class="ae md" href="https://godotengine.org/article/vulkan-progress-report-5" rel="noopener ugc nofollow" target="_blank">把Vulkan作为它的核心渲染引擎</a>。</p><p id="f790" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">正如您所想象的，Vulkan SDK提供了对GPU的非常低级的访问，这允许非常专业的优化。这对于数据处理和GPU开发人员来说是一笔巨大的财富——主要缺点是冗长，需要500–2000多行代码才能获得编写应用程序逻辑所需的基本样板文件。这可能导致昂贵的开发周期和错误，从而导致更大的问题。这是我们启动<strong class="lj jd"> Kompute </strong>项目的主要动机之一。</p><p id="9e8d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><a class="ae md" href="https://github.com/axsaucedo/vulkan-kompute#vulkan-kompute" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> Kompute </strong> </a>是一个构建在Vulkan SDK之上的框架，专门用于扩展其计算能力，作为一个简单易用、高度优化、移动友好的通用GPU计算框架。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mz"><img src="../Images/d2dcfcf18bf93b58d2dd857ee46bc8cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hkFiBPfbdHQqhHKA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Kompute <a class="ae md" href="https://ethicalml.github.io/vulkan-kompute/" rel="noopener ugc nofollow" target="_blank">文档</a>(图片由作者提供)</p></figure><p id="6fcf" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Kompute不是为了隐藏任何核心Vulkan概念而构建的——核心Vulkan API设计得非常好。相反，它通过BYOV(自带Vulkan)设计增强了Vulkan的计算能力，通过减少所需的样板代码和自动化编写Vulkan应用程序中涉及的一些更常见的工作流，使开发人员能够进行开发。</p><p id="643d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">对于想了解更多信息的新开发人员来说，它为开始使用GPU计算提供了坚实的基础。对于更高级的Vulkan开发人员，Kompute允许他们将其集成到现有的Vulkan应用程序中，并通过在需要时访问所有Vulkan内部来执行非常精细的优化。该项目是完全开源的，我们欢迎错误报告、文档扩展、新的例子或建议——请随时<a class="ae md" href="https://github.com/axsaucedo/vulkan-kompute/issues" rel="noopener ugc nofollow" target="_blank">在回购中提出问题</a>。</p><h1 id="efb1" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">游戏开发中的人工智能</h1><p id="916d" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">在本帖中，我们将基于我们在“<a class="ae md" rel="noopener" target="_blank" href="/machine-learning-and-data-processing-in-the-gpu-with-vulkan-kompute-c9350e5e5d3a">移动设备中的机器学习&amp;跨厂商GPU使用Kompute &amp; Vulkan </a>简化”文章中创建的机器学习用例。我们不会像在那篇文章中那样详细地讨论基础概念，但是我们仍然会在这一节中介绍所需的高级直觉。</p><p id="fd32" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">首先，我们需要一个允许我们公开机器学习逻辑的接口，这主要需要两个功能:</p><ol class=""><li id="9120" class="nf ng it lj b lk ll ln lo lq nh lu ni ly nj mc nk nl nm nn bi translated"><code class="fe no np nq nr b">train(…) </code> —允许机器学习模型学习从提供的输入预测输出的功能</li><li id="78e3" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc nk nl nm nn bi translated"><code class="fe no np nq nr b">predict(...)</code> —预测未知实例输出的函数。这可以在下图中概述的两个工作流程中看到。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/ed02a8a4aea14ecfa3798cd6fda8a005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZE0_pQd6kjy0y5I0"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">数据科学流程(图片由作者提供)</p></figure><p id="3059" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">特别是在游戏开发中，这也将是机器学习工作流的一种常见模式，对于预测性和解释性建模用例都是如此。这通常包括利用用户与游戏本身直接(或间接)互动时产生的数据。这些数据可以作为机器学习模型的训练特征。新模型的训练可以通过数据科学家执行的手动“离线”工作流来执行，或者通过自动触发再训练模型来执行。</p><h1 id="cd83" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">Godot中的机器学习项目</h1><p id="ed55" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">我们将首先提供一个关于我们的Kompute绑定将如何在我们的Godot游戏中使用的高级概述。我们将创建一个简单的项目，并训练我们创建的ML模型，它将在GPU中运行。在本节中，我们已经可以访问定制的KomputeModelML Godot类——关于如何构建它并将其导入Godot项目的详细信息将在后面的章节中介绍。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/60c8648ae5d9efe9815a92ea39da9c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fnWpycTHYs6pimF86wUWQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">新项目屏幕(图片由作者提供)</p></figure><p id="1cde" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为此我们使用的是<a class="ae md" href="https://godotengine.org/download" rel="noopener ugc nofollow" target="_blank"> Godot版本<strong class="lj jd"> 3.2.3稳定版</strong> </a>。创建一个新项目和一个新的2D场景。您应该会看到一个空白项目，带有一个顶级2D节点，如左图所示。</p><p id="2ca7" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在我们可以开始给游戏添加资源了。我们将从创建一个简单的UI界面/菜单开始，该界面/菜单由机器学习模型的输入组成，它反映了前面的架构图中涵盖的工作流。</p><p id="eb00" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将有两个用于数据<code class="fe no np nq nr b">X_i</code>和<code class="fe no np nq nr b">X_j</code>的输入行编辑文本框，以及一个用于<code class="fe no np nq nr b">Y</code>预期预测的输入行编辑文本框。下图显示了用于构建UI的节点结构。您还可以通过导入<code class="fe no np nq nr b">project.godot</code>文件来访问repo 中的<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/godot_example/examples/godot_logistic_regression" rel="noopener ugc nofollow" target="_blank"> full godot项目。节点将被引用以读取输入数据并显示输出预测(和学习的参数)。</a></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/c4d0a00719c8794221126f8c2439895b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLv-Vx2L2-oUwAppk2qJyw.png"/></div></div></figure><p id="3d3f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们现在将能够在Godot中添加GdScript代码，这将允许我们读取输入，训练模型并执行预测——该脚本是在<code class="fe no np nq nr b">Parent</code>节点下创建的。</p><p id="2deb" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下面是我们用来执行处理的完整脚本，它使用了我们在下一节中构建的<code class="fe no np nq nr b">KomputeModelML </code>自定义Godot类。我们将在下面分解代码的各个不同部分。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="5c76" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">首先，我们定义变量来简化Godot编辑器节点的引用。这可以通过美元符号语法<code class="fe no np nq nr b">$NODE/PATH</code>来实现，如下文所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="fea9" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下面的<code class="fe no np nq nr b">compute_ml()</code>函数包含机器学习训练和预测的逻辑。我们首先使用Godot编辑器节点引用从文本框中读取输入。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="ecfb" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们现在可以从C++类绑定中创建一个实例，我们将在下一节中构建这个实例。这个类公开了我们将用于机器学习推理的训练和预测函数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b001" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们现在可以通过传递输入和预期的预测来训练我们的模型。下面的ML模型是<a class="ae md" rel="noopener" target="_blank" href="/machine-learning-and-data-processing-in-the-gpu-with-vulkan-kompute-c9350e5e5d3a#6c88">逻辑回归模型</a>，它将调整其内部参数以最佳拟合输入和输出，从而产生一个能够预测未知数据点的模型。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="0dab" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">既然我们已经训练了我们的模型，我们可以对看不见的数据点进行预测。为了简单起见，我们将传递用于测试的相同输入，但是您可以传递全新的数组，并查看它会产生什么样的预测。然后，我们可以在我们定义的<code class="fe no np nq nr b">preds_node</code>引用节点变量中显示结果，这将显示在显示屏上。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2777" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，我们还想显示学习到的参数，在这种情况下，它包括<code class="fe no np nq nr b">w1</code>、<code class="fe no np nq nr b">w2</code>和<code class="fe no np nq nr b">bias</code>。我们能够在各自的标签中显示权重和偏差。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="53be" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后要设置的是将“Kompute Train &amp; Predict”按钮连接到<code class="fe no np nq nr b">compute_ml</code>功能，这可以通过编辑器设置一个指向功能本身的信号来完成。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/703665001e3dfbf71d1a91ef623f151b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXhGqmr_upim8DBiW0-mUA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在我们的脚本中设置compute_ml方法的信号(图片由作者提供)</p></figure><p id="a2ba" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一旦这些都设置好了，我们就可以运行游戏，并使用提供的输入来触发训练和预测。然后，我们可以看到学习参数以及预测输出。当我们修改输入<code class="fe no np nq nr b">y</code>、<code class="fe no np nq nr b">xi</code>和<code class="fe no np nq nr b">xj</code>时，也可以看到学习参数是如何变化的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/4910c818f122f6ac12d42a1f6a01dcd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7uz9M7sh3H3hzn80VTCudA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Kompute ML Godot界面及结果参数(图片由作者提供)</p></figure><h1 id="6140" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">Kompute ML实现</h1><p id="75fa" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">既然对游戏中发生的事情有了一个直觉，我们就能够使用<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> Kompute框架</strong> </a>编写我们的底层C++类来创建Godot绑定。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b49a56f8caabb79fa685b32777de0b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/0*c-LUmEwPLAKgZ3t4.jpg"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Kompute <a class="ae md" href="https://ethicalml.github.io/vulkan-kompute/overview/reference.html" rel="noopener ugc nofollow" target="_blank">建筑设计</a>(图片由作者提供)</p></figure><p id="0414" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将遵循Kompute的设计原则，这些原则在显示不同组件的附图中有所概述。我们将按照此工作流程在GPU中加载数据并执行培训。</p><p id="2878" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下面列出了Godot类绑定实现的头文件，我们将对其进行详细分析。正如你所看到的，创建一个带有绑定的C++类是非常直观的，你可以看到我们在上面的Godot GdScript中调用的相同的函数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">KomputeLogisticRegression.hpp实现</p></figure><p id="026d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">类头文件的初始部分包括:</p><ul class=""><li id="e92e" class="nf ng it lj b lk ll ln lo lq nh lu ni ly nj mc of nl nm nn bi translated">导入包含我们将在这个项目中使用的所有Kompute依赖项的<code class="fe no np nq nr b">Kompute.hpp</code>头文件</li><li id="2db0" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated">顶级<code class="fe no np nq nr b">Godot.hpp</code>导入是确保所有Godot组件可用所必需的。</li><li id="966f" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated">Node2D是我们将要继承的资源，但是你可以从<a class="ae md" href="https://docs.godotengine.org/en/stable/development/cpp/inheritance_class_tree.html" rel="noopener ugc nofollow" target="_blank">继承树</a>中的其他类继承，这取决于你计划如何使用你的定制Godot类</li><li id="dd7f" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated">对于跨应用传递的数据，我们将使用Godot <code class="fe no np nq nr b">Array</code>来处理GdScript和Naive C++之间的传输，以及Kompute <code class="fe no np nq nr b">Tensor</code>来处理GPU数据管理。</li><li id="ac64" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated">GODOT_CLASS宏定义通过添加额外的GODOT相关功能来扩展该类。正如我们将在下面看到的，当构建为Godot定制模块时，您将需要使用GDCLASS。</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2bd2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">遵循基本功能，我们必须定义核心逻辑:</p><ul class=""><li id="9436" class="nf ng it lj b lk ll ln lo lq nh lu ni ly nj mc of nl nm nn bi translated"><code class="fe no np nq nr b">void train(Array y, Array xI, Array xJ)</code>—使用逻辑回归模型的GPU本机代码来训练机器学习模型。它接受输入数组<code class="fe no np nq nr b">X</code>，以及包含预期输出的数组<code class="fe no np nq nr b">y</code>。</li><li id="d13c" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><code class="fe no np nq nr b">Array predict(Array xI, Array xJ)</code>—执行推理请求。在这种实现中，它不使用GPU代码，因为通常在推理端通过并行化获得的性能收益较少。然而，如果并行处理多个输入，仍有预期的性能增益(此功能允许)。</li><li id="da65" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><code class="fe no np nq nr b">Array get_params()</code>—以<code class="fe no np nq nr b">[ &lt;weight_1&gt;, &lt;weight_2&gt;, &lt;bias&gt; ]</code>的格式返回包含学习参数的数组。</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="f17a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后，我们可以声明将在C++和高级GdScript Godot引擎之间绑定的方法，这些方法通常可供编辑器和更广泛的游戏访问。下面我们将简要地看一下注册一个函数所需的代码。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="4d12" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">对于数据管理，我们将使用Kompute张量和数组——在这种情况下，我们只需要“学习”和“坚持”我们的逻辑回归模型的权重和偏差。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="83bd" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，我们还定义了着色器代码，它基本上就是<a class="ae md" href="https://en.wikipedia.org/wiki/OpenGL_Shading_Language" rel="noopener ugc nofollow" target="_blank">将在GPU </a>内部作为机器码执行的代码。Kompute允许我们传递包含代码的字符串，但是对于生产部署，可以将着色器转换为二进制文件，也可以使用可用的实用程序转换为头文件。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="869c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你对完整的实现感兴趣，你可以在<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/godot_example/examples/godot_logistic_regression/gdnative_shared" rel="noopener ugc nofollow" target="_blank"> gdnative实现</a>和<a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/godot_example/examples/godot_logistic_regression/custom_module" rel="noopener ugc nofollow" target="_blank">定制模块</a>实现文件夹中找到所有的文件。此外，如果你对这些技术的理论和潜在的基本概念感兴趣，这将在<a class="ae md" rel="noopener" target="_blank" href="/machine-learning-and-data-processing-in-the-gpu-with-vulkan-kompute-c9350e5e5d3a#6c88">我们之前的帖子</a>中全面介绍。</p><h1 id="459d" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">编译并集成到Godot中</h1><p id="0f49" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">现在我们有了GPU优化的机器学习模型的基础代码，我们现在可以在Godot游戏引擎中运行它了。Godot允许我们通过两种主要方式将C++代码添加到我们的项目中:</p><ol class=""><li id="862b" class="nf ng it lj b lk ll ln lo lq nh lu ni ly nj mc nk nl nm nn bi translated"><a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/godot_example/examples/godot_logistic_regression/gdnative_shared" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd"> GdNative库构建指令</strong> </a> —在Godot中，您可以添加自己的“GdNative脚本”，这些脚本基本上是绑定到GdScript的C++类，这意味着这些脚本可以在项目中动态使用和引用。这种方法适用于标准的Godot安装，不需要像第二种方法那样重新编译完整的编辑器。</li><li id="eccc" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc nk nl nm nn bi translated"><a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/godot_example/examples/godot_logistic_regression/custom_module" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd">自定义模块</strong> </a> <a class="ae md" href="https://github.com/EthicalML/vulkan-kompute/tree/godot_example/examples/godot_logistic_regression/gdnative_shared" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd">构建指令</strong> </a> —在Godot中只有底层核心类是“核心”组件的一部分；其他的一切——UI、编辑器、GdScript语言、网络功能——都是定制模型。编写一个定制模块很容易，这就是我们能够公开一些核心Kompute功能的方式。该选项要求用定制模块重新编译<strong class="lj jd">完整的Godot C++项目。</strong></li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi og"><img src="../Images/7f78a5e95ee95cf42474380c0cf660f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oy4Goki8duQjekmU3tHoQA.png"/></div></div></figure><p id="6479" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一旦您通过指令设置了这些方法中的一个，您将能够从Godot内部访问自定义对象。每种方法之间存在一些细微的实现差异。</p><p id="8d6e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们不会在博文中涉及具体的构建细节，但是你可以在上面的GdNative库/自定义模块链接中找到确切的代码和构建说明。</p><h1 id="4431" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">下一步是什么？</h1><p id="1817" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">恭喜你，你一路走到了最后！虽然这篇文章涵盖了广泛的主题，但是也有大量的概念被浏览过。其中包括底层Vulkan概念、GPU计算基础、机器学习最佳实践和更高级的Kompute概念。幸运的是，网上有资源可以扩展你在这些方面的知识。以下是我推荐的一些进一步阅读的链接:</p><ul class=""><li id="ed2d" class="nf ng it lj b lk ll ln lo lq nh lu ni ly nj mc of nl nm nn bi translated">"<a class="ae md" rel="noopener" target="_blank" href="/machine-learning-and-data-processing-in-the-gpu-with-vulkan-kompute-c9350e5e5d3a">利用Kompute简化移动设备中的机器学习&amp;跨供应商GPU&amp;Vulkan</a>文章，深入探讨理论和概念</li><li id="3ed1" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><a class="ae md" href="https://axsaucedo.github.io/vulkan-kompute/" rel="noopener ugc nofollow" target="_blank"> Kompute文档</a>了解更多细节和更多示例</li><li id="16d4" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><a class="ae md" href="https://ethical.institute/mle.html" rel="noopener ugc nofollow" target="_blank">机器学习工程师时事通讯</a>如果你想了解关于机器学习的最新文章</li><li id="3823" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><a class="ae md" href="https://github.com/EthicalML/awesome-production-machine-learning/" rel="noopener ugc nofollow" target="_blank">令人敬畏的生产机器学习</a>开源工具列表，用于部署、监控、版本化和扩展您的机器学习</li><li id="5757" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><a class="ae md" href="https://www.fast.ai/2018/09/26/ml-launch/" rel="noopener ugc nofollow" target="_blank">FastAI的ML for Coders课程简介</a>进一步学习机器学习概念</li><li id="0691" class="nf ng it lj b lk ns ln nt lq nu lu nv ly nw mc of nl nm nn bi translated"><a class="ae md" href="https://vulkan-tutorial.com/" rel="noopener ugc nofollow" target="_blank"> Vulkan SDK教程</a>深入了解底层Vulkan组件</li></ul></div></div>    
</body>
</html>