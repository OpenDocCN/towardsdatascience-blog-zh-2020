<html>
<head>
<title>Machine Learning with SQL — A Complete Guide to Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL机器学习——回归完全指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-with-sql-a-complete-guide-to-regression-b0e5e2db22da?source=collection_archive---------37-----------------------#2020-11-10">https://towardsdatascience.com/machine-learning-with-sql-a-complete-guide-to-regression-b0e5e2db22da?source=collection_archive---------37-----------------------#2020-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9412" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据库内机器学习？这比你想象的要容易</h2></div><p id="e112" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">似乎每个人都知道如何用像<em class="le"> Python </em>、<em class="le"> R </em>和<em class="le"> Julia </em>这样的语言来训练预测模型。但是<em class="le"> SQL </em>呢？如何利用一种众所周知的数据库语言来进行机器学习？</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/318fe7de0157702d119ca69dcdeb02c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pkRmzxYgus9XjKboZo7NQ.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">托拜厄斯·凯勒在<a class="ae lv" href="https://unsplash.com/s/photos/abstract?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2279" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不想看书？看看我关于这个主题的视频:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="d679" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SQL已经存在了几十年，但仍然没有被认为是机器学习的语言。当然，我会在一周的任何一天选择Python，但有时数据库中的机器学习是唯一的选择。</p><p id="6300" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将使用<a class="ae lv" href="https://www.oracle.com/index.html" rel="noopener ugc nofollow" target="_blank"> Oracle云</a>。这是免费的，所以请注册并创建一个OLTP数据库实例(版本19c，有0.2TB的存储)。一旦完成，通过<em class="le">SQL Developer Web</em>或任何其他工具建立连接。</p><p id="3419" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用一个著名的房价数据集的稍加修改的版本——你可以在这里下载。我选择了这个数据集，因为它不需要任何广泛的准备，所以重点可以立即转移到预测建模。</p><p id="7274" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章的结构如下:</p><ul class=""><li id="5093" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">数据集加载和准备</li><li id="b0a0" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">模型设置</li><li id="9ee7" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">模型训练和评估</li><li id="3812" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">结论</li></ul></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="bf0f" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">数据集加载和准备</h1><p id="a961" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">如果你正在跟随，我希望你已经下载了数据集。你需要用自己选择的工具将它加载到数据库中——我使用的是Oracle Cloud提供的免费工具<em class="le"> SQL Developer Web </em>。</p><p id="769f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">加载过程很简单——点击上传按钮，选择CSV文件，然后点击几次<em class="le">下一个</em>:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nq"><img src="../Images/3f424618077caa26c97e81feed805636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3Ge27TsKhOxjB392eo7d0Q.gif"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图1 —使用Oracle SQL Developer Web加载数据集(图片由作者提供)</p></figure><p id="3a9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的现在存储在<code class="fe nr ns nt nu b">housingprices</code>表中。下面是前几行的样子:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nv"><img src="../Images/af289079067a85c4b1bf1a7c2e07d1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cy0KR8xvx6CY3Qwr-7DgPA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图片2-加载的数据集的前10行(作者提供的图片)</p></figure><p id="3439" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">甲骨文机器学习</em> (OML)在创建模型方面有点奇怪。您的数据表必须包含具有ID的列，ID是从序列中生成的数字。默认情况下，我们的数据集没有这个，所以让我们手动添加它:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nx"><img src="../Images/5c48d17c0112a9de19b708cd837cd102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFGoT6qOsY7t0g28GNQxyA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图3 —添加了一列行ID(按作者分类的图像)</p></figure><p id="7f21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一部分只剩下一件事要做:训练/测试分割。在SQL中，这是通过创建两个视图来完成的。第一个视图随机抽取了75%的数据，第二个视图抽取了剩余的25%。百分比是任意选择的:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="8615" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在已经创建了两个视图——<code class="fe nr ns nt nu b">housing_train_data</code>用于训练,<code class="fe nr ns nt nu b">housing_test_data</code>用于测试。在模型训练之前还有一件事要做:为模型指定设置。让我们在下一节做这件事。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="fa3d" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">模型设置</h1><p id="cabb" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">Oracle使用这种设置表样式来训练预测模型。设置表由两列组成，一列用于名称，另一列用于值。</p><p id="e50b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是创建表格的方法:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="f3e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下信息将存储在该表中:</p><ul class=""><li id="a573" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">模型类型—让我们使用一个<em class="le">广义线性模型</em> (GLM)</li><li id="1735" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">诊断表名称-用于模型统计</li><li id="6eed" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">数据准备技术——让我们用自动的</li><li id="b0b5" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">功能选择—禁用或启用，让我们选择启用</li><li id="6b63" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">特征生成-与特征选择相同</li></ul><p id="676f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，你没看错——所有这些都是自动完成的，不需要你的帮助。接下来让我们填写设置表:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="fb9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是表格的样子:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/59e70c0d7ab65353aba655fb9aaa5e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*08Cp25CqslmfKG33lXW5Cg.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图4-模型设置表(作者图片)</p></figure><p id="95e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样！我们继续模特训练吧。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="7b55" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">模型训练和验证</h1><p id="280b" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">模型训练归结为单个过程调用。代码如下:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="4160" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，您需要首先命名您的模型。<code class="fe nr ns nt nu b">GLMR_Regression_Housing</code>这个名字完全是随意取的。大约一秒钟后，模型被训练。不要害怕Oracle创建的表的数量。这些是模型正常工作所必需的。</p><p id="95da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们来看一下火车布景上的模特表演。它可以通过以下查询获得:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/cadc42854e60ead52cf075ef0dddd0e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*vwhSgZTgdWRmuuLU9rh0Yg.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图5-列车组的模型性能(图片由作者提供)</p></figure><p id="9d4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">平均来说，这个模型有7.2个单位的价格是错误的，它捕捉了超过70%的方差。</p><p id="0947" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来让我们看看最重要的特性。如果该特征的P值接近0(小于0.05即可)，则可将其归类为对预测有意义。以下是查询:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oa"><img src="../Images/cc8c8806d54975a2f448874a91caf437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stMKHFAgEMQQCAECgFS4eQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图片6 —特征重要性(作者图片)</p></figure><p id="373b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，这些要素最初并不存在于数据集中，而是由Oracle的要素生成器自动创建的。</p><p id="2247" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，让我们将这个模型应用于测试集:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="52d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果存储在<code class="fe nr ns nt nu b">housing_test_predictions</code>表中:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/2c6b33990f0530658fd5ec6c9788315e.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*0KZnQTVwU6MrRCKP0gz7Dw.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图7 —测试集上的预测(图片由作者提供)</p></figure><p id="0b92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不知道科学记数法是怎么回事，但它足够好，可以进一步评估。我将把它留给你，因为你只需要在<code class="fe nr ns nt nu b">housing_test_data</code>视图和<code class="fe nr ns nt nu b">housing_test_predictions</code>表之间创建一个<code class="fe nr ns nt nu b">UNION</code>来看看结果有多好。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="03f7" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">离别赠言</h1><p id="1a9e" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">机器学习不再是Python或R特有的<em class="le">东西</em>。对于数据科学家来说，采用SQL不是最直观的，文档也很糟糕，但数据库内ML为业务用户提供了一种接触预测建模的极好方式。</p><p id="7ba9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要错过ML with SQL系列的其他内容:</p><ul class=""><li id="ff02" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated"><a class="ae lv" rel="noopener" target="_blank" href="/machine-learning-with-sql-its-easier-than-you-think-c6aae9064d5a">使用SQL的机器学习(分类)</a></li><li id="a694" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated"><a class="ae lv" rel="noopener" target="_blank" href="/time-series-forecasting-with-sql-its-easier-than-you-think-1f5b362d0c81">用SQL进行时间序列预测</a></li></ul><p id="c71d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎在下面的评论区留下你的想法。</p><h2 id="ddf2" class="oc mu it bd mv od oe dn mz of og dp nd kr oh oi nf kv oj ok nh kz ol om nj on bi translated">加入我的私人邮件列表，获取更多有用的见解。</h2></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="2a9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">喜欢这篇文章吗？成为</em> <a class="ae lv" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="le">中等会员</em> </a> <em class="le">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oo op gp gr oq or"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf lp or"/></div></div></a></div></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="2ade" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">原载于2020年11月10日https://betterdatascience.com</em><em class="le"><a class="ae lv" href="https://betterdatascience.com/machine-learning-with-sql-regression/" rel="noopener ugc nofollow" target="_blank"><em class="le">。</em></a></em></p></div></div>    
</body>
</html>