<html>
<head>
<title>Creating and Using R Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建和使用R函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/functions-in-r-3648eec4bcf9?source=collection_archive---------39-----------------------#2020-09-23">https://towardsdatascience.com/functions-in-r-3648eec4bcf9?source=collection_archive---------39-----------------------#2020-09-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2d07" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何使用它们的基础知识</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0aebe95a53504a50192c664157460553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KIuhKjEueFTaKdM-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@mina_fc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米娜FC </a>拍摄</p></figure><p id="bc4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你经历过下面这种情况吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/cf07d83a932acd9b0fab5f363dcca8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rKIUH-DH0pnyw8zqJrzdrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2e16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我似乎总是碰到它。也许只是我的运气…</p><p id="a070" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我喜欢函数。我喜欢建造它们，和它们一起工作，创造它们。没有什么比有人说一项任务需要一周时间更好的了，但是实际上，你知道它可能在10分钟内就能完成。</p><p id="eeb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">功能很棒。就像小机器人一样，它们可以把你从错误和重复的工作中拯救出来。如果你还没有看过我写的关于在Power BI中使用函数的文章，<a class="ae ky" rel="noopener" target="_blank" href="/functions-in-power-bi-56e9e11e4669?source=friends_link&amp;sk=32f65f6e5196dbd96ed43a53584ad2fc">在这里。</a>它将为你提供使用函数的基本知识，如果你使用平面文件，它很可能会节省你大量的时间。</p><p id="85a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用的很多东西已经是函数了。我们只是不去想它。</p><p id="9394" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以R中的均值函数为例，它先取函数名，然后取输入。所以mean()是一个函数。与Power BI非常相似，AVERAGE([列名])是一个函数。</p><p id="1454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我希望我能向你展示如何用r中的函数做一些工作。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="6a4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/4521f48cce1fa932ba0a61aa260fc2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*bIaLhZqnwhSWtABSrWd5gQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="209c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我主要处理大量平面文件(如果有一天我可以连接到数据仓库，那就太好了，但那是另一回事了)。</p><p id="56b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想在r中对一组平面文件执行一组转换，我们该怎么做呢？</p><p id="85e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不难。这非常类似于我们如何创建Power BI函数。关键是我们需要对一个文件执行一组转换，并将其设置为构建我们功能的原型。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="c7ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们使用<em class="me"> setwd </em>设置我们的工作目录并加载我们的包。我们将使用<strong class="lb iu"> tidyverse </strong>和<strong class="lb iu"> rlist </strong>。</p><p id="5bee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要设置工作目录，因为R需要知道它正在工作的文件夹。r需要知道将文件导出到哪里，以及从哪里读取文件。我们将把我们的工作目录分配给一个变量调用<strong class="lb iu"> File_Directory </strong></p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="6652" class="mk ml it mg b gy mm mn l mo mp">library(tidyverse) #loading packages<br/>library(rlist)</span><span id="7d06" class="mk ml it mg b gy mq mn l mo mp">File_Directory = setwd("Your folder containing your files") <br/>#setting up the work directory</span></pre><p id="ef1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们使用rlist的package <em class="me"> list.filter </em>函数和<em class="me"> str_detect </em>来过滤。csv”平面文件。我们将把它赋给变量<strong class="lb iu"> All_Files </strong>。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="c3c7" class="mk ml it mg b gy mm mn l mo mp">library(tidyverse) #loading packages<br/>library(rlist)</span><span id="1ddb" class="mk ml it mg b gy mq mn l mo mp">File_Directory = setwd("Your folder containing your files") <br/>#setting up the work directory</span><span id="0e41" class="mk ml it mg b gy mq mn l mo mp"><br/>All_Files = File_Directory %&gt;% <br/>  list.files() %&gt;% <br/>  list.filter(str_detect(., ".csv")) //just want the csv files and the "." here is a place holder for the output in the list.files.</span></pre><p id="c591" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="me"> list.files </em>返回File_Directory变量中所有文件的名称。然后<em class="me"> list.filter </em>用<em class="me"> str_detect </em>对csv文件进行过滤。此外，如果您不熟悉% &gt; %,它被称为“管道”，它将结果从一行传输到另一行。</p><p id="c946" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">All_Files的结果是我们想要清除的文件名的列表。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="ca6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是关键——我们需要手动加载其中一个文件，并应用我们的转换步骤。</p><p id="8510" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想按年份和性别分组，按平均工资汇总。这些是我想应用于所有文件的转换步骤。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="b0e0" class="mk ml it mg b gy mm mn l mo mp">Dataset_2007 %&gt;% # I manually loaded this file from Import Dataset on R Studio<br/>  group_by(Year,Sex) %&gt;% <br/>  summarize(Avg_Sal = mean(Salary, na.rm = T))</span></pre><p id="d122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查它是否工作。您必须选择脚本并按下cntrl+R来运行脚本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/06869789a7bd9a7f0df2ac69eb34388b.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*IbrhFdaEf984hk2x3sUaXA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7520" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它工作了。</p><p id="827e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然原型起作用了，那就把它变成函数吧。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="eb32" class="mk ml it mg b gy mm mn l mo mp">My_Function = function(X) {<br/>  read_csv(X) %&gt;% <br/>    group_by(Year, Sex) %&gt;% <br/>    summarize(Avg_Sal = mean(Salary))<br/>} </span></pre><p id="712b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们添加了read_csv ,因为我们希望我们的函数读取目录中的文件并应用转换。</p><p id="b433" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做比把每个文件都加载到R Studio中更有效率。我们可以把这个函数叫做<strong class="lb iu"> My_Function </strong>。我对函数名没什么想象力。</p><p id="dad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，该函数采用“X”作为我们的输入，使用<em class="me"> read_csv </em>读取文件，然后将表传递到下一行，即<em class="me"> group_by、</em>，然后<em class="me">根据平均工资汇总</em>。</p><p id="9ba9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里它读取X，这是我们所有文件中的第一个文件，并执行集合转换，等等。</p><p id="287a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们使用这个函数并应用到All_Files变量中的所有文件。记住变量All_Files在一个列表中保存我们的文件名。</p><p id="4fee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在R中，有一个简洁的小东西叫做<em class="me"> map </em>，基本上，<em class="me"> map </em>接受你的函数并把它映射到你所有的输入，你也可以选择返回一个数据框、一个列表或其他东西中的所有结果。使用map超出了本文的范围，但是让我们在这里使用<em class="me"> map_df </em>。<em class="me"> map_df </em>代表地图数据帧。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="f703" class="mk ml it mg b gy mm mn l mo mp">map_df(All_Files, My_Function)</span></pre><p id="fdfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据框中的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/83eef0344e5664da9b309bf93fd4a813.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*yjqlAktkvk3ppuQ1R6fOmA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3ccf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以选择使用r中的<em class="me"> write.csv </em>调用将结果导出到csv格式的同事。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="2973" class="mk ml it mg b gy mm mn l mo mp">map_df(All_Files, My_Function) %&gt;%<br/>write.csv("My_Results.csv", row.names = F)</span></pre><p id="1217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是所有的一切。</p><pre class="kj kk kl km gt mf mg mh mi aw mj bi"><span id="98b8" class="mk ml it mg b gy mm mn l mo mp">library(tidyverse) #loading packages<br/>library(rlist)</span><span id="8bb2" class="mk ml it mg b gy mq mn l mo mp">File_Directory = setwd("Your folder containing your files") <br/>#setting up the work directory</span><span id="6fce" class="mk ml it mg b gy mq mn l mo mp">All_Files = File_Directory %&gt;% <br/>  list.files() %&gt;% <br/>  list.filter(str_detect(., ".csv")) #filtering for csv</span><span id="1516" class="mk ml it mg b gy mq mn l mo mp">Dataset_2007 %&gt;% # function prototype<br/>  group_by(Year,Sex) %&gt;% <br/>  summarize(Avg_Sal = mean(Salary, na.rm = T))</span><span id="7126" class="mk ml it mg b gy mq mn l mo mp">My_Function = function(X) {<br/>  read_csv(X) %&gt;% <br/>    group_by(Year, Sex) %&gt;% <br/>    summarize(Avg_Sal = mean(Salary))<br/>} #creating the function</span><span id="2620" class="mk ml it mg b gy mq mn l mo mp">map_df(All_Files, My_Function) %&gt;%<br/>write.csv("My_Results.csv", row.names = F) #mapping it exporting to a csv file call My_Results</span></pre><p id="91b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是在r中使用函数的一个非常简单的例子。</p><p id="4196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老实说，生活中的事情从来不会这样发展。总会在某个地方打嗝。您今天可能会尝试这样做，并意识到您的数据集都在不同的列中，您必须首先清理它。也许一个包不会为你加载。可能是电脑的问题。</p><p id="e073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总会有问题需要解决。</p><p id="cee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你保持鼓励，保持安全，并在你的旅程中继续前进！</p></div></div>    
</body>
</html>