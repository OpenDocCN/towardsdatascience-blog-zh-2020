<html>
<head>
<title>Churn prediction with PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PySpark进行流失预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/churn-prediction-with-pyspark-cdb7293c0850?source=collection_archive---------38-----------------------#2020-11-04">https://towardsdatascience.com/churn-prediction-with-pyspark-cdb7293c0850?source=collection_archive---------38-----------------------#2020-11-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6ce4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">搅动婴儿搅动器！</h2></div><blockquote class="kf"><p id="4273" class="kg kh iq bd ki kj kk kl km kn ko kp dk translated">你不讨厌你的顾客离开吗？</p></blockquote><figure class="kr ks kt ku kv kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kq"><img src="../Images/fb5e964fadc79daf3ff2f04d36e91191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YEwAnBOdVawtTlaR"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">马科斯·保罗·普拉多在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ab03" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">很难过，他们可能再也不会回来了！</p><p id="b35c" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">正如Flo在<a class="ae lh" href="https://blog.markgrowth.com/eliminating-churn-is-growth-hacking-2-0-47a380194a06" rel="noopener ugc nofollow" target="_blank">的文章</a>:<em class="md">中提到的，根据</em> <a class="ae lh" href="https://hbr.org/2014/10/the-value-of-keeping-the-right-customers" rel="noopener ugc nofollow" target="_blank"> <em class="md">《哈佛商业评论》</em> </a> <em class="md">的说法，获得新客户比留住现有客户要贵五到二十五倍。”</em></p><blockquote class="kf"><p id="1439" class="kg kh iq bd ki kj me mf mg mh mi kp dk translated">你可以做点什么！</p></blockquote><p id="9822" class="pw-post-body-paragraph li lj iq lk b ll mj jr ln lo mk ju lq lr ml lt lu lv mm lx ly lz mn mb mc kp ij bi translated">如果我告诉你，你可以预测客户流失。</p><p id="0dc4" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">在本文中，我将为您提供实用的机器学习实现，使用一个虚构的数字音乐流媒体服务来预测客户流失。</p><p id="efb9" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">我们将讨论以下几点:</p><ol class=""><li id="57fd" class="mo mp iq lk b ll lm lo lp lr mq lv mr lz ms kp mt mu mv mw bi translated">客户参与度指标的特征工程</li><li id="8626" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp mt mu mv mw bi translated">秘方是过采样</li><li id="ffe0" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp mt mu mv mw bi translated">最佳性能模型</li></ol></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="08db" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">介绍</h1><p id="e8f6" class="pw-post-body-paragraph li lj iq lk b ll ob jr ln lo oc ju lq lr od lt lu lv oe lx ly lz of mb mc kp ij bi translated">在讨论细节之前，让我们先解释一下数据源。</p><p id="8bc3" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">该数据集来自一个名为Sparkify的虚拟数字音乐流媒体服务。它包含几个从网站交互日志中派生出来的潜在有趣的字段。</p><p id="d145" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">我们使用<a class="ae lh" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> Spark </a>，因为数据集是12GB，我们需要分布式机器学习技术的力量来帮助我们完成繁重的工作。</p><p id="0b29" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">在我们的例子中，客户流失被定义为<strong class="lk ir"> page == "取消确认"</strong>。</p><p id="13d5" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">数据的模式如下所示:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi og"><img src="../Images/b0894813cfb05d05dd25fe99758c5b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6dumJkHhOSsGSccEWmegpA.png"/></div></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="2f75" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">客户参与度指标的特征工程</h1><p id="96a4" class="pw-post-body-paragraph li lj iq lk b ll ob jr ln lo oc ju lq lr od lt lu lv oe lx ly lz of mb mc kp ij bi translated">我们的数据集允许多种特征工程方法。我把重点放在结合使用“页面”字段和我们的时间“ts”组件来理解用户对我们网站的参与度。</p><p id="2f3b" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">页面字段是分类字段，有几个不同的值，如下所示:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/de144030eb01b79153eee3ccfd3b1c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NYlgXFuLOGHqWnl5angag.png"/></div></div></figure><p id="a2ac" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">在PySpark中，从分类列创建虚拟变量一点也不简单。值得展示这些步骤:</p><p id="5e46" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">使用StringIndexer将分类列转换为索引列</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="849f" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">使用OneHotEncoder将索引转换为稀疏向量</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="e583" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">这可能就足够了，因为机器学习函数的输入接受特征作为稀疏向量。然而，让我们想想我们现在所拥有的。对于每个“页面”分类值，我们在稀疏向量矩阵中有1和0。</p><p id="caac" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">功能选择</strong></p><p id="9958" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">我们希望获得一种客户参与度指标。当从用户的角度考虑这个问题时，我希望我的所有页面交互都有每日使用量以及每周和每月的平均值。此时，我不确定哪个分类值在预测客户流失方面最重要，所以我将保留所有分类值。</p><p id="6d05" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">为了检查特定参与度指标的增长或下降是否会影响流失率，我们将在每日、7天和30天平均值之间进行比较。</p><p id="848a" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">以下是我想要的功能列表:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/333e4e71b483e654ab3c42ee39f18941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJLk1KmZMVYs-QlIFLiapQ.png"/></div></div></figure><p id="4d42" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">最后，我们将在平台上添加终身职位作为附加功能。这是一个常用的用户参与度指标。</p><p id="dd6c" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">为了获得每日、每周和每月的指标，我需要将“ts”转换为日期，并对每个功能使用某种窗口功能。</p><p id="a862" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">使用行提取器获取每个稀疏事件项的各个列:</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="9b8b" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">日期操作:从“ts”到天数</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="1335" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">创建每日数据框</strong></p><p id="2ed8" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">这将为我们提供日常指标:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="927d" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">创建衍生指标</strong></p><p id="4f57" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">现在来点好玩的。我发现了一种很好的方法来遍历这个每日数据集，以获得7d和30d的平均值，并导出几个度量对的方差度量。听起来很复杂。但我预计，如果你每天听的歌曲明显低于你的7d平均水平，你就会变得无所事事，因此更有可能取消。</p><p id="ff17" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">达到平均值:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="5518" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">获取差异指标:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="78e9" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">在平台上添加任期</strong></p><p id="8b01" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">最后，我创建了一个任期指标，如下所示:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="3ac9" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">检查您的空值</strong></p><p id="6b5f" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">我们现在已经做了许多计算。存在一种风险，即它们并不都产生值(例如除以0)。使用这个<a class="ae lh" href="https://stackoverflow.com/questions/44627386/how-to-find-count-of-null-and-nan-values-for-each-column-in-a-pyspark-dataframe" rel="noopener ugc nofollow" target="_blank">堆栈溢出答案</a>检查每列的空值。</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="45e3" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">这告诉我，我肯定需要填充我的数据框架:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="a388" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">矢量装配器</strong></p><p id="96e2" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">在继续之前，对于PySpark ML中的建模，我们需要将所有单独的度量组合回一个SparseVector中。我们可以使用向量组装器:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="13d9" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">秘方是过采样</h1><p id="7c71" class="pw-post-body-paragraph li lj iq lk b ll ob jr ln lo oc ju lq lr od lt lu lv oe lx ly lz of mb mc kp ij bi translated">你曾经因为你的逻辑回归只预测你标签的大多数类别而沮丧过吗？</p><p id="dacd" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">不是模特的错。它正确地预测了最可能的分类。</p><p id="baf6" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">这是由数据集中的不平衡造成的。有许多方法可以处理不平衡的数据。特别是，如果您感兴趣的类非常小，过采样可以工作。</p><blockquote class="kf"><p id="fbdc" class="kg kh iq bd ki kj me mf mg mh mi kp dk translated">这是你的模型表现更好的秘方，通过训练更多的少数民族的例子。</p></blockquote><p id="0a06" class="pw-post-body-paragraph li lj iq lk b ll mj jr ln lo mk ju lq lr ml lt lu lv mm lx ly lz mn mb mc kp ij bi translated">我为万军的Pyspark 找到了这个简洁的<a class="ae lh" href="https://medium.com/@junwan01/oversampling-and-undersampling-with-pyspark-5dbc25cdf253" rel="noopener">过采样方法:</a></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="6402" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">最佳性能模型</h1><p id="e85a" class="pw-post-body-paragraph li lj iq lk b ll ob jr ln lo oc ju lq lr od lt lu lv oe lx ly lz of mb mc kp ij bi translated">我们测试了3种不同的模型:</p><ul class=""><li id="130e" class="mo mp iq lk b ll lm lo lp lr mq lv mr lz ms kp op mu mv mw bi translated">物流回收</li><li id="3ae2" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp op mu mv mw bi translated">随机森林分类器</li><li id="0621" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp op mu mv mw bi translated">梯度推进树分类器</li></ul><p id="e2bb" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">首先，在PySpark中进行训练测试分割:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="8c43" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">继续建模:</p><p id="9ca5" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">物流回归</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="ed5e" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">结果:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/6c74b4a24a9c1e73ea7f006a3755faa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luNgJzURLvaEhdkbrET3LQ.png"/></div></div></figure><p id="82b2" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">随机森林分类器</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="6d92" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">结果越来越好:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div class="gh gi or"><img src="../Images/af62f0ba972e023a5b3e925ca20c923c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*IUSqDYj6pGaq2qxoIad_ag.png"/></div></figure><p id="baa7" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">梯度增强树分类器</strong></p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="1910" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">结果:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi os"><img src="../Images/225e7588dd08e59aa12a15bf0d070364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IXMiX4Dvjyy8YDE0phD-RA.png"/></div></div></figure><p id="c845" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir"> GradientBoostingTree分类器(CrossValidator) </strong></p><p id="9437" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">这最后一个模型表现非常好。通过快速交叉验证，maxDepth=20的结果甚至更好。由于性能问题，我无法运行完整的数据集。</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="a833" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">以下是一小部分的结果:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/ae38158f7669c7f9dd019c4811c1337d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*Ci3CofXd21R9iPdyYy3uWg.png"/></div></figure><p id="6378" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">基准模型分析</strong></p><p id="0fea" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">您可以在下面找到按型号划分的所有指标的摘要。maxDepth=20的GBT明显胜出。</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/0068d04bfc47cf26fcbdf5d98c6fdaf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jCZRUOls_K2_0mcbaYb7oA.png"/></div></div></figure><p id="3a34" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">了解特征重要性</strong></p><p id="ddcf" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">为了找出哪些特性是最重要的，我用下面的代码查看了我的GBT模型:</p><figure class="oh oi oj ok gt kw"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="1b7f" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">发现以下是预测客户流失的一些最重要的指标:</p><figure class="oh oi oj ok gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/c779e2b86edc06ff85acb570ff8dc84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*qaHq6aoBDzWr63vcYqcwyg.png"/></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="ee3a" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">结论</h1><p id="613c" class="pw-post-body-paragraph li lj iq lk b ll ob jr ln lo oc ju lq lr od lt lu lv oe lx ly lz of mb mc kp ij bi translated">在这篇文章中，我给了你一些预测客户流失的实用工具:</p><ol class=""><li id="a2d1" class="mo mp iq lk b ll lm lo lp lr mq lv mr lz ms kp mt mu mv mw bi translated">在我们的功能工程部门，我们创建了一个大的计算参与度指标集</li><li id="a7a8" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp mt mu mv mw bi translated">我们给了你处理不平衡数据的秘密:过采样</li><li id="cbc4" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp mt mu mv mw bi translated">GradientBoostingTree分类器在该数据集上表现出色</li></ol><p id="b439" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">可能的改进</strong></p><ol class=""><li id="ce34" class="mo mp iq lk b ll lm lo lp lr mq lv mr lz ms kp mt mu mv mw bi translated">我处理向量的方式可能更优雅。我在努力从这些结构中获取信息。</li><li id="ad40" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp mt mu mv mw bi translated">此外，我可以使用主成分分析来降低特征维数，这将提高模型的整体执行速度。</li></ol><p id="e85b" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated"><strong class="lk ir">编码时面临的困难</strong></p><p id="a238" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">我在几个不同的领域遇到了困难:</p><ul class=""><li id="cff8" class="mo mp iq lk b ll lm lo lp lr mq lv mr lz ms kp op mu mv mw bi translated">AWS集群的计算容量(自由层)。我想在GBT上运行的交叉验证无法在我的完整数据集上完成。我必须为我的特征工程的大部分定义函数，以便在较小的数据集上快速完成所有步骤</li><li id="53a6" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp op mu mv mw bi translated">超参数:由于性能问题，我一次只能测试有限数量的参数。即使在较小的数据集上</li><li id="169d" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp op mu mv mw bi translated">Datetime计算:我花了很长时间才弄清楚如何处理Pyspark中的日期格式，以及随后如何添加datatime以得出任期指标。</li><li id="ca24" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp op mu mv mw bi translated">BestModel:我花了很长时间才找到如何从pipelin(或者CV)选择stages来直接在模型上调用BestModel函数。</li><li id="524d" class="mo mp iq lk b ll mx lo my lr mz lv na lz nb kp op mu mv mw bi translated">载体:处理载体可能会令人困惑</li></ul><p id="ca08" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">我希望你喜欢这篇文章！</p><p id="dc7a" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc kp ij bi translated">完整的Github库在这里:<a class="ae lh" href="https://github.com/thijsessens/sparkify_churn_prediction" rel="noopener ugc nofollow" target="_blank">https://github.com/thijsessens/sparkify_churn_prediction</a></p></div></div>    
</body>
</html>