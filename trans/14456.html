<html>
<head>
<title>Prophet and R: Forecasting Air Passenger Numbers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预言家和R:预测航空乘客数量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/prophet-and-r-forecasting-air-passenger-numbers-193097184422?source=collection_archive---------35-----------------------#2020-10-05">https://towardsdatascience.com/prophet-and-r-forecasting-air-passenger-numbers-193097184422?source=collection_archive---------35-----------------------#2020-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a66" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">预言者和时间序列预测</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/841308a9190a90aaaa80bfe69bb85d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNSdnsPsYZKnOufihIXmHw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:来自<a class="ae ky" href="https://pixabay.com/photos/aircraft-plane-airport-airplane-5611528/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/kim_r_hunter-18496478/" rel="noopener ugc nofollow" target="_blank"> Kim_R_Hunter </a>的照片</p></figure><p id="d845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是上一篇<a class="ae ky" rel="noopener" target="_blank" href="/time-series-analysis-with-prophet-air-passenger-data-6f29c7989681">文章</a>的后续文章，该文章展示了使用Python进行时间序列预测，其中构建了一个Prophet模型，以便使用Python预测航空乘客数量。有问题的数据来自旧金山开放数据。</p><p id="de7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，将进行相同的分析，但使用r。</p><h1 id="0b72" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">背景</h1><p id="35ad" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">数据集来源于<strong class="lb iu">旧金山国际机场关于航空公司</strong>月度客运量统计的报告，该报告可从<em class="ms"> data.world(原始来源:旧金山开放数据)</em>获得，如下文参考资料部分所示。</p><p id="85ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，对航空公司<strong class="lb iu">荷航</strong> (enplaned)调整后的乘客人数进行过滤，作为从2005年5月<strong class="lb iu">到2016年3月</strong>期间的时间序列进行分析。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/5ad9600f75cb3fc4e06bc2bdf3c61a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*xsnTiwP1y0r9OBJ6AEYlKQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:RStudio</p></figure><p id="5014" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Prophet的目的是:</p><ul class=""><li id="ec20" class="mu mv it lb b lc ld lf lg li mw lm mx lq my lu mz na nb nc bi translated">识别数据中的季节性模式</li><li id="96db" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">模型“变化点”——或数据中重大结构变化的时期</li><li id="b1ee" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">使用季节和变点参数预测未来航空乘客数量</li></ul><p id="0554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这方面，Prophet通过识别时间序列中的结构突变，并通过考虑变化点和季节性模式进行预测，可能会产生优于ARIMA等更传统的时间序列模型的结果。</p><h1 id="2eae" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">模型结构</h1><p id="8eec" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了让Prophet分析相关数据，必须确保其格式正确，即标题为<strong class="lb iu"> ds </strong>的列表示日期，标题为<strong class="lb iu"> y </strong>的列表示时间序列值。</p><p id="2631" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将加载prophet库，并导入相关数据。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="f508" class="nn lw it nj b gy no np l nq nr">library(prophet)<br/>mydata&lt;-read.csv("klm.csv")</span><span id="93fe" class="nn lw it nj b gy ns np l nq nr">ds&lt;-mydata$Date[1:115]<br/>y&lt;-mydata$Adjusted.Passenger.Count[1:115]</span><span id="bf39" class="nn lw it nj b gy ns np l nq nr">train&lt;-data.frame(ds,y)<br/>train</span></pre><p id="748f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下定义的Prophet模型将自动检测季节模式。但是，我们也想指出模型中的相关变化点。</p><p id="9c5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">四个变化点规定如下:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="c3a3" class="nn lw it nj b gy no np l nq nr">m &lt;- prophet(train, n.changepoints = 4)<br/>m</span></pre><p id="92b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后举例说明已确定的变化点:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="c5d7" class="nn lw it nj b gy no np l nq nr">$changepoints<br/>[1] "2007-06-01 GMT" "2009-04-01 GMT" "2011-03-01 GMT"<br/>[4] "2013-02-01 GMT"</span></pre><p id="3b32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，使用该模型预测未来14个月，并将预测值与测试集(实际值)进行比较。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="5c0b" class="nn lw it nj b gy no np l nq nr">future &lt;- make_future_dataframe(m, periods = 14, freq = 'month')<br/>tail(future)</span><span id="14af" class="nn lw it nj b gy ns np l nq nr">forecast &lt;- predict(m, future)<br/>tail(forecast[c('ds', 'yhat', 'yhat_lower', 'yhat_upper')])</span><span id="44f3" class="nn lw it nj b gy ns np l nq nr">plot(m, forecast) + add_changepoints_to_plot(m)</span></pre><p id="bf19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个变化点间隔图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/a115718c608172e71b9a31bcd8d9d4e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*pnv7OiajQGoZLyQsCQZQeQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:RStudio</p></figure><p id="a6ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是趋势图和年度构成图:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="4907" class="nn lw it nj b gy no np l nq nr">prophet_plot_components(m, forecast)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/8ad28d9d1b5615f7e37bc4f51da1689e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*iEivmo4BgpWrDR3Z2K3Dqw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:RStudio</p></figure><p id="67a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，总体而言，春季和夏季的乘客数量较高，冬季的乘客数量较低。</p><p id="eefd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们发现，虽然航空旅客人数在2010年前呈强劲增长趋势，但此后人数开始缓慢但稳步下降。</p><p id="9bc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<strong class="lb iu">指标</strong>库，可以计算均方根误差，然后与月平均值进行比较:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="d065" class="nn lw it nj b gy no np l nq nr">&gt; ds&lt;-mydata$Date[116:129]<br/>&gt; y&lt;-mydata$Adjusted.Passenger.Count[116:129]<br/>&gt; <br/>&gt; test&lt;-data.frame(ds,y)<br/>&gt; test<br/>           ds     y<br/>1  2015-02-01  5012<br/>2  2015-03-01  6327<br/>3  2015-04-01 10831<br/>4  2015-05-01 11745<br/>5  2015-06-01 11633<br/>6  2015-07-01 10562<br/>7  2015-08-01 11510<br/>8  2015-09-01 11669<br/>9  2015-10-01 10221<br/>10 2015-11-01  7366<br/>11 2015-12-01  7321<br/>12 2016-01-01  5930<br/>13 2016-02-01  5338<br/>14 2016-03-01  7726<br/>&gt; <br/>&gt; library(Metrics)<br/>&gt; rmse(forecast$yhat[116:129],test$y)<br/>[1] 587.1803<br/>&gt; <br/>&gt; mean(test$y)<br/>[1] 8799.357</span></pre><p id="e79a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">RMSE为587，与月平均值8799相比相对较低。这表明我们的Prophet模型在预测航空乘客数量方面做得相当好。</p><p id="8ece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，值得注意的是，在R中选择的变化点与Python略有不同。具体来说，R将其中一个变更点标识为<strong class="lb iu">2009年4月</strong>，但是Python将变更点标识为<strong class="lb iu">2009年5月</strong>。</p><p id="be05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们用2009年5月来手动定义R中的变更点会怎么样？这会提高预测模型的准确性吗？</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="eeee" class="nn lw it nj b gy no np l nq nr">m &lt;- prophet(train, changepoints=c("2007-06-01", "2009-05-01", "2011-03-01", "2013-02-01"))</span></pre><p id="5b05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是预测结果:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="1906" class="nn lw it nj b gy no np l nq nr">&gt; ds&lt;-mydata$Date[116:129]<br/>&gt; y&lt;-mydata$Adjusted.Passenger.Count[116:129]<br/>&gt; <br/>&gt; test&lt;-data.frame(ds,y)<br/>&gt; test<br/>           ds     y<br/>1  2015-02-01  5012<br/>2  2015-03-01  6327<br/>3  2015-04-01 10831<br/>4  2015-05-01 11745<br/>5  2015-06-01 11633<br/>6  2015-07-01 10562<br/>7  2015-08-01 11510<br/>8  2015-09-01 11669<br/>9  2015-10-01 10221<br/>10 2015-11-01  7366<br/>11 2015-12-01  7321<br/>12 2016-01-01  5930<br/>13 2016-02-01  5338<br/>14 2016-03-01  7726<br/>&gt; <br/>&gt; library(Metrics)<br/>&gt; rmse(forecast$yhat[116:129],test$y)<br/>[1] 496.1832<br/>&gt; <br/>&gt; mean(test$y)<br/>[1] 8799.357</span></pre><p id="0f79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在看到，RMSE进一步减少到496，与月平均值8，799相比仍然很低。这表明变化点的手动配置导致了更高的预测准确度。</p><h1 id="0ca0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="d094" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这个例子中，您已经看到了如何在r中运行Prophet模型。</p><p id="ba6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，本文研究了:</p><ul class=""><li id="015f" class="mu mv it lb b lc ld lf lg li mw lm mx lq my lu mz na nb nc bi translated">如何正确设置时间序列的格式以便使用Prophet进行分析</li><li id="fe22" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">变更点的自动和手动配置</li><li id="84cd" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">如何使用<strong class="lb iu">指标库</strong>测量预测准确性</li></ul><p id="7955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读，非常感谢您的任何问题或反馈。</p><p id="9e6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ms">免责声明:本文是在“原样”的基础上编写的，没有任何担保。本文旨在提供数据科学概念的概述，不应以任何方式解释为专业建议。</em></p><h1 id="3074" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="6225" class="mu mv it lb b lc mn lf mo li nt lm nu lq nv lu mz na nb nc bi translated"><a class="ae ky" href="https://cran.r-project.org/web/packages/prophet/prophet.pdf" rel="noopener ugc nofollow" target="_blank">cran-r-project . org:prophet</a></li><li id="31c9" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated"><a class="ae ky" href="https://data.world/data-society/air-traffic-passenger-data" rel="noopener ugc nofollow" target="_blank"> data.world:空中交通乘客数据</a>(原始来源:<a class="ae ky" href="https://data.sfgov.org/Transportation/Air-Traffic-Passenger-Statistics/rkru-6vcg" rel="noopener ugc nofollow" target="_blank">旧金山公开数据</a>)</li><li id="9c49" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated"><a class="ae ky" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank"> facebook.github.io </a></li><li id="60be" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated"><a class="ae ky" href="https://github.com/facebook/prophet" rel="noopener ugc nofollow" target="_blank">GitHub:Facebook/prophet</a></li></ul></div></div>    
</body>
</html>