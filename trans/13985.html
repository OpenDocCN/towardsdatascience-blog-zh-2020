<html>
<head>
<title>How to Query PostgreSQL using Python (with SSH) in 3 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python(带SSH)通过3个步骤查询PostgreSQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-query-postgresql-using-python-with-ssh-in-3-steps-cde626444817?source=collection_archive---------13-----------------------#2020-09-26">https://towardsdatascience.com/how-to-query-postgresql-using-python-with-ssh-in-3-steps-cde626444817?source=collection_archive---------13-----------------------#2020-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c1c300d5a95b10e3037623bdc47a08d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RNffm1pHbbsXuSGuuSmr4Q.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">图片由Pixabay提供</p></figure><p id="a3a9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">*-这个故事描述了如何使用<a class="ae la" href="https://github.com/eyan02/simple_sqlalch_pgres" rel="noopener ugc nofollow" target="_blank">这个脚本</a>在有或没有SSH的情况下快速建立与远程PostgreSQL数据库的连接。pem认证。-*</p><p id="e7e9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">数据通常存储在远程服务器上的PostgreSQL等数据库中，这使得数据分析师很难快速访问数据。有时，有中间团队协助分析师从数据库中检索数据。在这个故事中，我们将讨论如何使用Python直接查询数据，而不需要中间媒介。</p><p id="9ff3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你知道如何使用Python(主要用于分析和可视化)，但没有数据库经验或如何与它们交互，那么这篇文章就是为你准备的！</p><p id="19f3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有各种各样的工具供我们使用，使您能够自己从数据库中交互/检索数据，并花更多的时间来提取见解。</p><ul class=""><li id="33e5" class="lb lc iq ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated"><strong class="ke ir">第一步:</strong>安装所有需要的包。</li><li id="2337" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><strong class="ke ir">第二步:</strong>将<em class="lp"> query.py </em>的内容导入或粘贴到笔记本中。</li><li id="66d5" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><strong class="ke ir">第三步:</strong>开始查询！</li></ul><p id="760a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">这个故事假设如下:</strong></p><ul class=""><li id="77bb" class="lb lc iq ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated">您已经在本地环境中安装了Python</li><li id="df42" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated">您正在使用像Jupyter笔记本这样的实时代码环境</li><li id="7cfa" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated">已经获得了SSH到远程服务器的必要凭证。pem证书)并查询PostgreSQL数据库(用户名和密码)。</li></ul></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="a55f" class="lx ly iq bd lz ma mb dn mc md me dp mf kn mg mh mi kr mj mk ml kv mm mn mo mp bi translated">步骤1:安装所有必需的软件包:</h2><p id="7648" class="pw-post-body-paragraph kc kd iq ke b kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz ij bi translated">首先，我们需要从终端安装几个软件包。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="2d21" class="lx ly iq na b gy ne nf l ng nh">pip3 install paramiko<br/>pip3 install sshtunnel<br/>pip3 install SQLAlchemy<br/>pip3 install pandas</span></pre></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="c953" class="lx ly iq bd lz ma mb dn mc md me dp mf kn mg mh mi kr mj mk ml kv mm mn mo mp bi translated">步骤2:将query.py内容导入或粘贴到笔记本中</h2><p id="ad3e" class="pw-post-body-paragraph kc kd iq ke b kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz ij bi translated">接下来，您需要将repo中的query.py文件保存到您的工作目录(Jupyter笔记本文件所在的目录)中，或者直接将该文件的内容复制到您的笔记本中。</p><p id="26b3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果将query.py文件放在工作目录中，则在笔记本中包含以下导入行:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="6193" class="lx ly iq na b gy ne nf l ng nh">from query.py import *</span></pre><p id="7e1f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">或者，只需将下面的代码复制并粘贴到笔记本的代码单元格中:</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="6c45" class="lx ly iq bd lz ma mb dn mc md me dp mf kn mg mh mi kr mj mk ml kv mm mn mo mp bi translated">第三步:查询！</h2><p id="bb7d" class="pw-post-body-paragraph kc kd iq ke b kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz ij bi translated">现在我们可以开始查询了！定义的类只提供了少量的基本函数。让我们看一下如何使用这个类，以及我们可以用它做什么。</p><p id="2183" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我们需要指定PostgreSQL连接参数和SSH参数(如果访问远程服务器需要SSH隧道)。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="71ff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将<em class="lp"> pgres </em>定义为我们的连接，以简化每次我们想要查询数据库或探索数据库的组织结构。还会提示您输入PostgreSQL用户名和密码，它们存储为临时变量(最佳实践是将这些变量保存为环境变量)。</p><p id="a699" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，我们可以探索名为'<em class="lp"> database_name </em>'的给定数据库的模式，使用<em class="lp">找到我们感兴趣的模式。schemas() </em>函数。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="39bf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果我们想探索名为'<em class="lp"> schema_name </em>'的模式，我们可以使用<em class="lp">返回模式中的表名。</em>tables()【函数。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1ef6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后可以用<em class="lp">。query() </em>运行标准的SQL查询(针对PostgreSQL)。在本例中，我们从名为'<em class="lp"> ey_test_table </em>'的表中查询列名和数据类型</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="738e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">尝试用您自己的查询替换<em class="lp"> sql_statement </em>的内容，并从中获得乐趣！</p></div></div>    
</body>
</html>