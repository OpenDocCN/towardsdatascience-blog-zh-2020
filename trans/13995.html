<html>
<head>
<title>5-Minute Guide to Calling Functions from R Scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从R脚本调用函数的5分钟指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-minute-guide-to-calling-functions-from-r-scripts-41c4a09db1eb?source=collection_archive---------23-----------------------#2020-09-26">https://towardsdatascience.com/5-minute-guide-to-calling-functions-from-r-scripts-41c4a09db1eb?source=collection_archive---------23-----------------------#2020-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="33dd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用谷歌趋势数据的r代码教程。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f2466122ba3943cfbd12f9164b383b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IatRIAgdnVwbhsHl3dvIQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由来自<a class="ae ky" href="https://www.pexels.com/photo/photography-of-person-typing-1181675/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的<a class="ae ky" href="https://www.pexels.com/@divinetechygirl?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜·莫里洛</a>拍摄</p></figure><p id="3659" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能听说过流行的指导方针，如果你发现自己复制和粘贴代码超过3次，你应该把它写成一个函数。虽然您可以在R Markdown文件的顶部编写和存储这些函数，但是如果您最终将这些函数复制并粘贴到多个文件中，这种方法可能会变得混乱，而且会适得其反。通常，保持条理的最好方法是在脚本中编写函数，并在需要时从任何附加文件中调用它们。</p><p id="a9f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了演示这个过程，我将使用3个函数对过去一个月中包含“supreme court”的Google搜索进行一个非常简单的变化点分析。</p><h1 id="75db" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">首先，创建你的函数</strong></h1><p id="3536" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在R脚本中，我们编写了三个简单的函数。第一个绘制Google趋势数据，第二个使用“bcp”包中的bcp()函数执行简单的变化点分析，第三个绘制分析结果。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d7c5" class="mx lw it mt b gy my mz l na nb">google_graph = function(data, date, observation, graph_title) {<br/>  <br/>  data %&gt;% <br/>    ggplot() +<br/>    geom_line(aes(x = date, y = observation), <br/>              color = "#09557f",<br/>              alpha = 0.6,<br/>              size = 0.6) +<br/>    labs(x = "Date (Start of Week)", <br/>         y = "Relative Proportion",<br/>         title = graph_title) +<br/>    theme_minimal() +<br/>    scale_x_date(date_breaks = "1 week") +<br/>    theme(axis.text.x = element_text(angle = 45))<br/>  <br/>}</span><span id="b65c" class="mx lw it mt b gy nc mz l na nb">bcp_analysis = function(observation, data) {<br/>  <br/>  set.seed(100)<br/>  <br/>  bcp = bcp(observation)<br/>  <br/>  prob = bcp$posterior.prob<br/>  prob = as.data.frame(prob) <br/>  <br/>  bcp_dataframe = cbind(data, prob) %&gt;% <br/>    select(date, prob)<br/>  <br/>}</span><span id="cbfa" class="mx lw it mt b gy nc mz l na nb">bcp_plot = function(dataframe){<br/>  <br/>  dataframe %&gt;% <br/>    ggplot() +<br/>    geom_line(aes(x = date, y = prob),<br/>              color = "#09557f",<br/>              alpha = 0.6,<br/>              size = 0.6) +<br/>    labs(x = "",<br/>         y = "Posterior Probability",<br/>         title = "Changepoint Probabilities") +<br/>    theme_minimal() +<br/>    ylim(0, 1) +<br/>    scale_x_date(date_breaks = "1 week") +<br/>    theme(axis.text.x = element_text(angle = 45))<br/>  <br/>}</span></pre><p id="43b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还选中了“保存源”框。如果您选中此框，那么当您在脚本中保存对函数的更改时，该文件将自动来源于全局环境。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/b3b9e3fa7ef3b57f7ecaad18c69723be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AXSUBucvyBAaHRXIAPeLmg.png"/></div></div></figure><h1 id="d5c7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">连接到您的功能</h1><p id="d7a7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">从R Markdown文件连接到脚本中存储的函数与连接到包中存储的函数非常相似。我们不使用library()语句，而是使用source()语句并指明脚本的路径名。在这种情况下，我们使用以下代码:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="240a" class="mx lw it mt b gy my mz l na nb">source("./functions.R")</span></pre><p id="4f36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们运行这行代码时，脚本中包含的函数会自动出现在全局环境中。连接成功！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/bf6826c4771235501fced0a6e8803f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vtYp2b-uJtRQC7_pDso8LA.png"/></div></div></figure><h1 id="ba43" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用你的功能</h1><p id="4f7e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们将使用“gtrendsR”包中的gtrends()函数来获取过去一个月中包含美国“supreme court”字样的Google搜索量。mutate步骤还用于将“date”变量转换为日期格式:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6c08" class="mx lw it mt b gy my mz l na nb">data = gtrends(keyword = "supreme court", geo = "US", <br/>               time = "today 1-m")$interest_over_time %&gt;% <br/>  mutate(date = as.Date(date))</span></pre><p id="c6c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有数据可以在函数中使用了！我们使用google_graph()函数的方式与使用任何其他函数的方式相同，这使我们可以轻松地绘制数据:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="a2cc" class="mx lw it mt b gy my mz l na nb">google_graph(data, data$date, data$hits, ‘Google Searches for “Supreme Court”’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/891a3e902a2efadd10e83bd8b9aa19b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uOO5LQW3UllY6k2CU44BqA.png"/></div></div></figure><p id="01d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剧情看起来不错！不出所料，在最高法院大法官鲁斯·巴德·金斯伯格去世后，包含“最高法院”的搜索量激增。让我们使用bcp_analysis()和bcp_plot()函数来查看这个峰值是否代表这个时间序列对象中的一个重大变化点。同样，我们使用函数的方式与使用已加载包中的函数的方式相同:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="df69" class="mx lw it mt b gy my mz l na nb">bcp_dataframe = bcp_analysis(data$hits, data)</span><span id="ea76" class="mx lw it mt b gy nc mz l na nb">bcp_plot(bcp_dataframe)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/6cb2af3b13dbf349be5510dc9b80efa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fElyerkZydtfeNahFYR7Hw.png"/></div></div></figure><p id="3d38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">鲁斯·巴德·金斯伯格死后几天的后验概率为1.00，这表明包含“最高法院”的搜索可能在这段时间以一种有统计学意义的方式发生了变化。</p><p id="0a95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这么简单！如果我们想要在单独的Rmd文件中绘制和分析几个不同的数据源，那么用source()语句将这些文件连接到我们的“functions”脚本并使用我们的函数就很容易了。</p></div></div>    
</body>
</html>