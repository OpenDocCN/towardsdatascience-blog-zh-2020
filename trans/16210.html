<html>
<head>
<title>LightGBM Algorithm: An end to end review on the trees to DataFrame method</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LightGBM算法:树到数据帧方法的端到端评述</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/lightgbm-algorithm-an-end-to-end-review-on-the-trees-to-dataframe-method-13e8c4b74027?source=collection_archive---------11-----------------------#2020-11-08">https://towardsdatascience.com/lightgbm-algorithm-an-end-to-end-review-on-the-trees-to-dataframe-method-13e8c4b74027?source=collection_archive---------11-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6889ce19590b8d786737d3ce6d90f4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_5SoYT-aTVyt6UOd117ZVg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="http://www.freepik.com" rel="noopener ugc nofollow" target="_blank">由upklyak / Freepik设计</a></p></figure><p id="7d62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">LightGBM最近获得了一种称为“trees_to_dataframe”的新方法，它允许您将构成lightGBM模型的多个树估计器转换为可读的pandas数据框架。该方法增加了模型的可解释性，并允许您在粒度级别上理解影响任何数据点预测的划分。在本文中，我将构建一个简单的模型，并向您展示“trees_to_dataframe”的输出，以帮助您理解如何解释日常使用的数据帧。</p><h1 id="c2cb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">什么是LightGBM: </strong></h1><p id="3499" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">对于本文，我将使用以下学术论文作为参考:<a class="ae kc" href="https://papers.nips.cc/paper/6907-lightgbm-a-highly-efficient-gradient-boosting-decision-tree" rel="noopener ugc nofollow" target="_blank">https://papers . nips . cc/paper/6907-light GBM-a-highly-efficient-gradient-boosting-decision-tree</a>。</p><p id="62da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Light GBM是一种梯度增强集成方法，其特征在于:</p><ol class=""><li id="989e" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><strong class="kf ir">单侧采样(GOSS) </strong>:仅使用具有较大梯度的数据点来估计信息增益(使用较少的观测值获得信息增益的精确估计。这使得它更轻——因此它的名字是:LightGBM。<strong class="kf ir">术语预警！我们将梯度定义为我们试图最小化的损失函数的负导数。</strong></li><li id="bec6" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><strong class="kf ir">排他性特征捆绑(EFB): </strong>将很少出现非零值的特征捆绑在一起，用于相同的观察(例如:独热编码)。</li><li id="6d04" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><strong class="kf ir">基于直方图的分割:</strong>使用更有效的基于直方图的宁滨策略来寻找数据中的分割点。这也使得它比常规的梯度推进算法更快。</li></ol><h1 id="2968" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">练习:</h1><p id="669c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了深入研究LightGBM使用树来数据化框架的可解释性，我将使用移动价格分类Kaggle数据集。我们的模型将被训练来预测手机的价格范围。</p><p id="34c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">原始数据集的目标变量用数字编码成从零(0)到三(3)的4个类别。因为这个练习的目的不是预测，而是理解如何解释LightGBM的“trees_to_dataframe”方法，所以我将简化我们的练习，把目标变量分成二进制类别，而不是多类。从价格范围零(0)到价格范围一(1)，我将编码为0，从价格范围二(2)到三(3)，我将编码为1。我也不会把数据分成训练和测试。</p><p id="e985" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该数据集包含以下功能:“电池电量”、“蓝色”、“时钟速度”、“双sim”、“fc”、“四g”、“int_memory”、“m_dep”、“mobile_wt”、“n_cores”、“pc”、“px_height”、“px_width”、“ram”、“sc_h”、“sc_w”、“talk_time”、“three_g”、“touch_screen”和“wifi”。</p><p id="3be6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了充分理解树到数据帧的方法，我将放弃使用测试数据。我将训练一个特意简单的模型，只包含三个估计器，最大深度为3。在Kaggle笔记本内核中，我开始安装最新的LightGBM版本，因为“trees_to_dataframe”方法最近被集成到算法的源代码中。</p><p id="41c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用下面的代码，我创建了一个训练数据集，我将使用它来生成我将要分析的lightGBM模型。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">这里有木星的代码</p></figure><p id="f86b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从basic_model.trees_to_dataframe()中，我们获得了一个包含以下各列的pandas数据帧:' tree_index '，' node_depth '，' node_index '，' left_child '，' right_child '，' parent_index '，' split_feature '，' split_gain '，' threshold '，<br/>' decision _ type '，' missing_direction '，' missing_type '，' value '，' weight '，<br/>' count '。我们将探究这些分别代表什么。</p><h1 id="05c9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">图1:获得的数据帧的第一行。</strong></h1><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="30b2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">图2:算法的第一棵树(估计器)。</strong></h1><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="86b2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">树索引:</h1><p id="d429" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">树索引是指我们正在查看的树。在这种情况下，我们看到的是索引为0的树。第一个估计量。</p><h1 id="1f43" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">节点深度:</h1><p id="816a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">指示分区发生的级别。例如，第一行引用节点深度1，这是第一个分区(节点索引0-S0)。</p><h1 id="97eb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">节点索引，左子节点和右子节点，父节点:</h1><p id="657a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">指示节点的索引及其“子节点”的索引。换句话说，当前节点分区到的要创建的节点。父节点是指当前节点所在的节点。因为0-S0是第一个分区，所以它没有父节点。</p><h1 id="21f8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">分割特征:</h1><p id="b67d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">该功能对节点进行分区以创建子节点或叶。</p><h1 id="bad0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">分割增益:</h1><p id="3c2f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">通过以下方式测量分割质量。</p><h1 id="26e6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">阈值:</h1><p id="965a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">用于决定观察是前进到节点的左侧子节点还是右侧子节点的特征值。</p><h1 id="e3f2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">缺少方向:</h1><p id="4383" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">指示缺少的值转到哪个子节点(基于决策类型)。</p><h1 id="3187" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">价值:</h1><p id="bb9b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这些是粗略的预测。详情请参见附录示例A.1。</p><h1 id="7b92" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">重量</h1><p id="e712" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">用于分割增益计算。</p><h1 id="0113" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">计数:</h1><p id="3bac" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">计数是落在节点内的观察值的数量。</p><h1 id="25d7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">附录A.1:</h1><p id="a2b0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们遵循下面的观察:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="7136" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的LightGBM算法有三个估计器:</p><p id="3931" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在估计值0中，我们的观察结果落在叶子1: ram为2549，battery_power为842。第一个叶的叶值是0.496250。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a020" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在估计器1中，观察值落在叶子7中:ram为2549，battery_power为842。估计量1中叶7的值是0.044437。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6cd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在估计器2中，观察值落在叶1中:ram为2549，battery_poer为842。叶1的值是-0.001562。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="4e8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将数据点所在的不同叶的值相加:</p><p id="3d61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">0.49625 + 0.044437 — 0.001562 = .539125</p><p id="c203" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总之，新推出的lightGBM“trees _ to _ data frame”方法通过将light GBM模型转换为pandas数据框架，成为一个可解释的工具。通过允许您在较低的级别读取多个分区标准，以及每个数据点所属的叶值，该方法增加了透明度，并有助于更好地理解影响任何数据点预测的决策。</p><div class="my mz gp gr na nb"><a href="https://jovian.ai/anaprec07/notebooke133a3e568-1" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">ana prec 07/notebook 133 a3 e 568-1-Jovian</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">在anaprec07/notebook 133 a3 e 568-1笔记本上与ana prec 07协作。</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">jovian.ai</p></div></div><div class="nk l"><div class="nl l nm nn no nk np jw nb"/></div></div></a></div><h1 id="10bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">关于我:</h1><div class="my mz gp gr na nb"><a href="https://www.linkedin.com/in/anapreciado/" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">Ana Preciado -数据科学家-COVIDPTY.com | LinkedIn</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">联系人:anamargaritapreciado@gmail.com |+(507)61305543。自从我做了电子商务的本科研究后，我…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">www.linkedin.com</p></div></div><div class="nk l"><div class="nq l nm nn no nk np jw nb"/></div></div></a></div></div></div>    
</body>
</html>