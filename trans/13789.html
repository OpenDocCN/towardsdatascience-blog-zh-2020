<html>
<head>
<title>Time Series Forecasting With SQL — It’s Easier Than You Think</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SQL进行时间序列预测——比您想象的要简单</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-with-sql-its-easier-than-you-think-1f5b362d0c81?source=collection_archive---------9-----------------------#2020-09-22">https://towardsdatascience.com/time-series-forecasting-with-sql-its-easier-than-you-think-1f5b362d0c81?source=collection_archive---------9-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c97d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">是的，SQL现在可以做到这一点。</h2></div><p id="f0f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间序列预测是我通常用<em class="le"> Python </em>做的一项任务。你可能已经习惯了其他语言，比如<em class="le"> R </em>或者<em class="le"> Julia </em>，但是我敢打赌你从来没有想到过这种类型的任务。如果是这样的话——继续读下去——你会惊讶地发现只用<em class="le"> SQL </em>就能完成这么多事情。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/e26d4db73d03fed982862f057d195dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u7XqWNQ90RjeYpHI"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae lv" href="https://unsplash.com/@morningbrew?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">晨酿</a>在<a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4f45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我以前写过关于使用<em class="le"> SQL </em>执行分类任务的文章，所以如果你对此感兴趣的话，一定要看看:</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/machine-learning-with-sql-its-easier-than-you-think-c6aae9064d5a"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">使用SQL进行机器学习——比你想象的要简单</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">当Python不是一个选项时该做什么。包括代码。</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn lp lz"/></div></div></a></div><p id="d322" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间序列不同于一般的机器学习任务。你不可能训练一次模型，在生产中用几个月。时间序列模型必须使用完整的历史数据进行训练，并且新的数据点可能每小时、每天、每周或每月都会出现—因项目而异。</p><p id="0b53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是为什么在硬件资源有限的情况下，在数据库中进行训练是有益的。<em class="le"> Python </em>几乎总是会比数据库消耗更多的资源。</p><p id="06f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将再次使用<a class="ae lv" href="https://www.oracle.com/index.html" rel="noopener ugc nofollow" target="_blank">甲骨文云</a>。这是免费的，所以请注册并创建一个OLTP数据库实例(版本19c，有0.2TB的存储)。完成后，下载<em class="le">云钱包</em>并通过<em class="le">SQL Developer</em>——或任何其他工具建立连接。</p><p id="435e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将花费你至少10分钟，但这是一件相当简单的事情，所以我不会在这上面浪费时间。</p><p id="d376" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！让我们继续数据加载。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="6d1a" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">数据加载</h1><p id="35cc" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">在进行任何类型的预测之前，我们需要一些数据。任何时间序列教程的事实上的标准数据集是<a class="ae lv" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv" rel="noopener ugc nofollow" target="_blank">航空乘客</a>数据集。下载它，并在安全的地方保存一分钟。</p><p id="315f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要创建一个保存数据集的表，接下来我们就这么做。下面是SQL语句:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="be88" class="nx mw it nt b gy ny nz l oa ob">CREATE TABLE airline_passengers(<br/>    air_period DATE,<br/>    air_passengers INTEGER<br/>);</span></pre><p id="0e80" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以通过<em class="le">导入数据</em>功能加载数据集:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="ab gu cl oc"><img src="../Images/a2dfe9acae9e92774c6f7e18a037bcc7.png" data-original-src="https://miro.medium.com/v2/format:webp/1*lEXA3TYMVsGfX5iq-nAIog.png"/></div></figure><p id="d686" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当弹出一个模态窗口时，只需提供下载的CSV文件的路径，然后点击几次<em class="le"> Next </em>。使用您的最佳判断选择列，并选择日期格式为<code class="fe od oe of nt b">YYYY-MM</code>。</p><p id="e74a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们的数据集就可以使用了:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="ab gu cl oc"><img src="../Images/25c646c87024d29dcfef58bc760fca5e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*RgqPucLXbYhTjyWlpcOxsg.png"/></div></figure><p id="14e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！我们现在可以继续进行模型训练和预测。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="ad43" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">模特培训</h1><p id="1cbf" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">我们的数据集有144行。我们不会对其整体进行模型训练。我们将保留最后12行用于评估。</p><p id="1910" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从训练开始，我们需要创建一个指向训练数据的<code class="fe od oe of nt b">VIEW</code>。方法如下:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="ab03" class="nx mw it nt b gy ny nz l oa ob">CREATE OR REPLACE VIEW src_passengers AS<br/>    SELECT * FROM airline_passengers <br/>    WHERE air_period &lt; TO_DATE('1960-01-01', 'YYYY-MM-DD');</span></pre><p id="c869" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe od oe of nt b">src_passengers</code>视图现在保存了前132行——这正是我们想要的。</p><p id="3d18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们将声明一个处理模型训练的简短的<code class="fe od oe of nt b">PL/SQL</code>片段:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="d380" class="nx mw it nt b gy ny nz l oa ob">DECLARE<br/>    v_setlst DBMS_DATA_MINING.SETTING_LIST;<br/>BEGIN<br/>    v_setlst(DBMS_DATA_MINING.ALGO_NAME) := DBMS_DATA_MINING.ALGO_EXPONENTIAL_SMOOTHING;<br/>    v_setlst(DBMS_DATA_MINING.EXSM_INTERVAL) := DBMS_DATA_MINING.EXSM_INTERVAL_MONTH;<br/>    v_setlst(DBMS_DATA_MINING.EXSM_PREDICTION_STEP) := '12';<br/>    v_setlst(DBMS_DATA_MINING.EXSM_MODEL) := DBMS_DATA_MINING.EXSM_HW;<br/>    v_setlst(DBMS_DATA_MINING.EXSM_SEASONALITY) := '12';<br/> <br/>    DBMS_DATA_MINING.CREATE_MODEL2(<br/>        model_name =&gt; 'AIRLINE_PSG_FORECAST',<br/>        mining_function =&gt; 'TIME_SERIES',<br/>        data_query =&gt; 'SELECT * FROM src_passengers',<br/>        set_list =&gt; v_setlst,<br/>        case_id_column_name =&gt; 'air_period',<br/>        target_column_name =&gt; 'air_passengers'<br/>    );<br/>END;<br/>/</span></pre><p id="5fcd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把这个片段分解一下，让它更容易理解:</p><ul class=""><li id="24fa" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld ol om on oo bi translated"><code class="fe od oe of nt b">DBMS_DATA_MINING.ALGO_NAME</code> -时间序列预测算法类型，指数平滑是目前唯一可用的算法</li><li id="3c83" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">DBMS_DATA_MINING.EXSM_INTERVAL</code> -表示数据集的间隔。我们的数据按月间隔存储，因此有了<code class="fe od oe of nt b">EXSM_INTERVAL_MONTH</code>值</li><li id="f732" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">DBMS_DATA_MINING.PREDICTION_STEP</code> -做出多少预测。12(一年)不错</li><li id="8d12" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">DBMS_DATA_MINING.EXSM_MODEL</code> -本质上是指数平滑模型的超参数组合。我选择使用三重指数平滑法或霍尔特-温特斯法。这里是可用算法的完整列表。</li><li id="ce58" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">DBMS_DATA_MINING.EXSM_SEASONALITY</code> -表示一个季节持续多长时间</li></ul><p id="bb76" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">声明之后，我们可以在<code class="fe od oe of nt b">DBMS_DATA_MINING.CREATE_MODEL2</code>过程的帮助下创建一个时间序列模型(顺便说一下，这是一个很好的命名约定)。以下是解释:</p><ul class=""><li id="d6e4" class="og oh it kk b kl km ko kp kr oi kv oj kz ok ld ol om on oo bi translated"><code class="fe od oe of nt b">model_name</code> -任意，随心所欲命名型号</li><li id="66a2" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">mining_function</code> -设置为<code class="fe od oe of nt b">TIME_SERIES</code>，原因很清楚</li><li id="43d9" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">data_query</code> -模型如何获得训练数据</li><li id="5800" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">set_list</code> -之前声明的设置列表，告诉Oracle如何实际训练模型</li><li id="2f67" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">case_id_column_name</code> -包含日期值的列的名称</li><li id="8008" class="og oh it kk b kl op ko oq kr or kv os kz ot ld ol om on oo bi translated"><code class="fe od oe of nt b">target_column_name</code> -包含数值的列的名称(我们试图预测的内容)</li></ul><p id="864b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样！如果你能理解这一点，你就知道如何用SQL训练时间序列模型。</p><p id="72e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您现在可以运行<code class="fe od oe of nt b">PL/SQL</code>代码片段了。需要几秒钟才能完成。完成后，您可以继续下一部分。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="8b1f" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">模型评估</h1><p id="d3b0" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">让我们看看我们的模型表现有多好。为此，我准备了以下声明:</p><pre class="lg lh li lj gt ns nt nu nv aw nw bi"><span id="c1b9" class="nx mw it nt b gy ny nz l oa ob">SELECT<br/>    a.case_id AS time_period,<br/>    b.air_passengers AS actual,<br/>    ROUND(a.prediction, 2) AS predicted,<br/>    ROUND((b.air_passengers - a.prediction), 2) AS difference,<br/>    ROUND((ABS(b.air_passengers - a.prediction) / b.air_passengers) * 100, 2) AS pct_error<br/>FROM <br/>    dm$p0airline_psg_forecast a, <br/>    airline_passengers b<br/>WHERE <br/>    a.case_id = b.air_period<br/>AND a.case_id &gt;= TO_DATE('1960-01-01', 'YYYY-MM-DD');</span></pre><p id="8942" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它将实际数据与Holt-Winters算法所做的预测进行比较，并比较绝对误差和百分比误差。以下是上述SQL语句的输出:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="ab gu cl oc"><img src="../Images/79ab6ee172aef941bbf1e01e92c5079b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*g7lMYrbrm0GGDPZsEPShgg.png"/></div></figure><p id="4ab6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！就我们投入的工作而言，我们的模型并没有那么糟糕。让我们在下一部分总结一下。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="9533" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">在你走之前</h1><p id="044b" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">这工作量很大——不要争论了。尽管如此，我们仍有改进的方法。一个想法立即浮现在脑海中——创建一个将返回最佳算法的函数。</p><p id="32e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以将所有可能的算法存储在一个数组中，然后在遍历数组的同时训练一个模型，跟踪每个模型的性能。但这是另一个话题了。</p><p id="d1a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读。</p><p id="67aa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lv" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">加入我的私人邮件列表，获取更多有用的见解。</strong>T3】</a></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="8a34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">喜欢这篇文章吗？成为</em> <a class="ae lv" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="le">中等会员</em> </a> <em class="le">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="lw lx gp gr ly lz"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">medium.com</p></div></div><div class="mi l"><div class="ou l mk ml mm mi mn lp lz"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="c672" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">原载于2020年9月22日https://betterdatascience.com</em><a class="ae lv" href="https://betterdatascience.com/time-series-forecasting-with-sql/" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a><em class="le">。</em></p></div></div>    
</body>
</html>