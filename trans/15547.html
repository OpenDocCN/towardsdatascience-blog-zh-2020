<html>
<head>
<title>Efficient Data Summarizing and Analysis Using Pandas’ Groupby Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pandas的Groupby功能进行有效的数据汇总和分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/efficient-data-summarizing-and-analysis-using-pandas-groupby-function-7b2cc9eff186?source=collection_archive---------37-----------------------#2020-10-26">https://towardsdatascience.com/efficient-data-summarizing-and-analysis-using-pandas-groupby-function-7b2cc9eff186?source=collection_archive---------37-----------------------#2020-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/853c49242f071d456c80abe648f7f135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B2WikLj7A3LSRF2W"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">迈克尔·佩恩在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="a220" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">学习使用聚合函数，数据转换，过滤，映射，在数据框架中应用</h2></div><p id="3adf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Groupby是熊猫很受欢迎的功能。它非常擅长汇总、转换、过滤和其他一些非常重要的数据分析任务。在本文中，我将结合实例详细讲解groupby函数的应用。</p><h1 id="2e78" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">资料组</h1><p id="4d5d" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在本文中，我将使用Kaggle的“学生表现”数据集。请从这里随意下载数据集:</p><div class="is it gp gr iu mr"><a href="https://github.com/rashida048/Datasets/blob/master/StudentsPerformance.csv" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">rashida 048/数据集</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">github.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf ja mr"/></div></div></a></div><p id="26a5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我将导入必要的包和数据集:</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="d416" class="np lv jj nl b gy nq nr l ns nt">import pandas as pd<br/>import numpy as np<br/>df = pd.read_csv('StudentsPerformance.csv')<br/>df.head()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nu"><img src="../Images/17f29c27bda2661cd71eb5f7a06fd34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TREib355YvTOb3j5.png"/></div></div></figure><h1 id="bf61" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">Groupby是如何工作的？</h1><p id="b1cd" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">Groupby函数根据您定义的条件拆分数据集。这里我展示了groupby函数背后的过程。它会给你一个概念，如果没有groupby函数，我们要做多少工作。在本节中，我将创建一个包含两列的更小的新数据集来进行演示。这两栏是“性别”和“阅读分数”。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="a118" class="np lv jj nl b gy nq nr l ns nt">test = df[['gender', 'reading score']]<br/>test.head()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/9e563c683bafdcf5fc070d98087805e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/0*6klZaCqVgRds9gn4.png"/></div></figure><p id="56ab" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">让我们找出不同性别的平均阅读分数</strong></p><p id="bc26" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要根据性别分割数据集。仅生成女性数据。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="2002" class="np lv jj nl b gy nq nr l ns nt">female = test['gender'] == 'female'<br/>test[female].head()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/1bfee6b19805886d28c2a3f12f667385.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/0*sPXWDPtIjXTnq_5T.png"/></div></figure><p id="9543" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以同样的方式，为男性生成数据，</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="ae2e" class="np lv jj nl b gy nq nr l ns nt">male = test['gender'] == 'male'<br/>test[male].head()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/c48154f0dee4dfb10b3809aff44c8ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/0*bmJI1_wqEzYdvJlp.png"/></div></figure><p id="57f1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用上面的女性和男性数据集分别计算女性和男性的平均阅读分数。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="52d9" class="np lv jj nl b gy nq nr l ns nt">fe_avg = test[female]['reading score'].mean()<br/>male_avg = test[male]['reading score'].mean()<br/>print(fe_avg, male_avg)</span></pre><p id="dbae" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">女性的平均阅读分数为72.608，男性的平均阅读分数为65.473。现在，做一个女性和男性平均阅读分数的数据图表。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="53c3" class="np lv jj nl b gy nq nr l ns nt">df_reading = pd.DataFrame({'Gender': ['female', 'male'], 'reading score': [fe_avg, male_avg]})</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/aafb23e98ee8be51ac0fe3bfb0ad7bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/0*zeHFCbWoCNUi1MBn.png"/></div></figure><p id="4080" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，<strong class="la jk">让我们用groupby函数解决同样的问题。</strong>根据性别分割数据，并对其应用“平均值”,只需一行简单的代码:</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="f32c" class="np lv jj nl b gy nq nr l ns nt">test.groupby('gender').mean()</span></pre><p id="8bc8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这一小段代码给出了相同的结果。</p><h1 id="6ea7" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">分组依据中的组</h1><p id="5642" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我现在将使用原始数据集“df”。按“种族/民族”分组。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="205d" class="np lv jj nl b gy nq nr l ns nt">race = df.groupby('race/ethnicity')<br/>print(race)</span></pre><p id="6237" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:<pandas.core.groupby.generic.dataframegroupby object="" at=""/></p><p id="9a32" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它返回一个对象。现在检查“race”的数据类型。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="34d3" class="np lv jj nl b gy nq nr l ns nt">type(race)</span></pre><p id="b178" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:pandas . core . group by . generic . data frame group by</p><p id="4ff7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们生成了一个DataFrameGroupBy对象。对此DataFrameGroupBy对象调用组将返回每个组的索引。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="bd27" class="np lv jj nl b gy nq nr l ns nt">race.groups#Here is the Output:<br/>{'group A': Int64Index([  3,  13,  14,  25,  46,  61,  62,  72,  77,  82,  88, 112, 129,              143, 150, 151, 170, 228, 250, 296, 300, 305, 327, 356, 365, 368,              378, 379, 384, 395, 401, 402, 423, 428, 433, 442, 444, 464, 467,              468, 483, 489, 490, 506, 511, 539, 546, 571, 575, 576, 586, 589,              591, 597, 614, 623, 635, 651, 653, 688, 697, 702, 705, 731, 741,              769, 778, 805, 810, 811, 816, 820, 830, 832, 837, 851, 892, 902,              911, 936, 943, 960, 966, 972, 974, 983, 985, 988, 994],             dtype='int64'),  'group B': Int64Index([  0,   2,   5,   6,   7,   9,  12,  17,  21,  26,              ...              919, 923, 944, 946, 948, 969, 976, 980, 982, 991],             dtype='int64', length=190),  'group C': Int64Index([  1,   4,  10,  15,  16,  18,  19,  23,  27,  28,              ...              963, 967, 971, 975, 977, 979, 984, 986, 996, 997],             dtype='int64', length=319),  'group D': Int64Index([  8,  11,  20,  22,  24,  29,  30,  33,  36,  37,              ...              965, 970, 973, 978, 981, 989, 992, 993, 998, 999],             dtype='int64', length=262),  'group E': Int64Index([ 32,  34,  35,  44,  50,  51,  56,  60,  76,  79,              ...              937, 949, 950, 952, 955, 962, 968, 987, 990, 995],             dtype='int64', length=140)}</span></pre><p id="f71e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看上面的输出。Groupby函数将数据分成子组，现在可以看到每个子组的指数。太好了！但是仅有指数是不够的。我们需要看到每组的真实数据。函数“get_group”对此有所帮助。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="9dec" class="np lv jj nl b gy nq nr l ns nt">race.get_group('group B')</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/f3c6f95aaf9f2890b8aa675143b78fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ofmnEri8ImRkYZM8.png"/></div></div></figure><p id="1638" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这里展示部分结果。原来产量大很多。</p><p id="5cfd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">找出每组的大小</strong></p><p id="55c7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对“race”对象调用size将给出每个组的大小</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="9827" class="np lv jj nl b gy nq nr l ns nt">race.size()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/8da6674cabdc66e9c1e22438e722bf8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:230/format:webp/0*NfSuKtuPUHNmp9GW.png"/></div></figure><p id="8f69" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">循环每组</strong></p><p id="eb2c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在各组之间循环。这里有一个例子:</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="7d9e" class="np lv jj nl b gy nq nr l ns nt">for name, group in race:<br/>    print(name, 'has', group.shape[0], 'data')</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d2754d2628fc80922984a0f38cf9bf20.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/format:webp/0*l62-K6o-PYj4sVYZ.png"/></div></figure><p id="b43c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">多变量分组</strong></p><p id="b495" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面所有的例子中，我们只按一个变量分组。但是通过多个变量分组也是可能的。在这里，我按“种族/民族”和“性别”分组。这将返回按性别分类的每个种族的数据数量。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="6ca9" class="np lv jj nl b gy nq nr l ns nt">df.groupby(['gender', 'race/ethnicity']).size()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/ea42f5ddd019ecb4b72bfd0f0124b1d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/0*D8DPQceGn24WzNco.png"/></div></figure><p id="2b60" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此示例使用“size”聚合数据。还有其他聚合函数。以下是所有聚合函数的列表:</p><p id="f4dd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">总和()</p><p id="25b5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">平均值()</p><p id="3f50" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">大小()</p><p id="6c98" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">计数()</p><p id="fb51" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">标准()</p><p id="f004" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">风险值()</p><p id="a31d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">扫描电镜()</p><p id="0d14" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最小值()</p><p id="e375" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">中位数()</p><p id="9866" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请试用它们。只需替换这些集合函数中的任何一个，而不是上面示例中的“size”。</p><p id="247c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">使用多个聚合函数</strong></p><p id="e4ed" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以在多个变量上使用groupby，使用多个聚合函数也是可行的。下一个示例将按“种族/民族”分组，并将使用“最大”和“最小”函数进行聚合。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="5c5f" class="np lv jj nl b gy nq nr l ns nt">df.groupby('race/ethnicity').agg([np.max, np.min])</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/f84dffd20c1b9114f06640ddb96e0f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YY3Ms0AQwbyNefiJ.png"/></div></div></figure><p id="1385" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的聚合函数作用于每一列。因为我们没有指定任何列。</p><p id="48bf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">制作每场比赛的数学、阅读和写作的最低和最高分数的数据图表。</p><p id="b9b9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要做到这一点，使用前面的代码并像这样添加分数:</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="879b" class="np lv jj nl b gy nq nr l ns nt">df.groupby('race/ethnicity')['math score', 'reading score', 'writing score'].agg([np.max, np.min])</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c569f970f82707c2f854f5ffc1971df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/0*llIEC0y_4MWLF6ce.png"/></div></figure><p id="f22d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">对多个变量进行分组并使用多个聚合函数</strong></p><p id="6712" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了证明这一点，我们将按“种族/民族”和“性别”进行分组。此外，使用两个聚合函数“min”和“max”。让我们制作一个数据框架，包含按性别划分的每个小组在数学、阅读和写作方面的最高和最低分数。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="0b84" class="np lv jj nl b gy nq nr l ns nt">df.groupby(['race/ethnicity', 'gender'])['math score', 'reading score', 'writing score'].agg([np.max, np.min])</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/e5d12181a6f5e36b05599c6baf930d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/0*q9sSj7FQC5vA5kfP.png"/></div></figure><p id="7d9c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">不同列上的不同聚合函数</strong></p><p id="eb1c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按“种族/民族”分组，对数学成绩使用最大值和平均值，对阅读成绩使用中值和最小值。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="b70c" class="np lv jj nl b gy nq nr l ns nt">df.groupby('race/ethnicity').agg({'math score': ['max', 'mean'], <br/>                                 'reading score': ['median','min']})</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/13ca293572694ebbcc4b6c11961d7eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/0*X2bZWsdnffRZ7rS6.png"/></div></figure><p id="68a7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很酷，对吧？但是列名没有那么好和清晰。它们应该更清晰、更好。我们可以像这样更改列名:</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="be49" class="np lv jj nl b gy nq nr l ns nt">math_read = df.groupby('race/ethnicity').agg({'math score': ['max', 'mean'], 'reading score': ['max', 'mean']})<br/>math_read.columns=['Max Math Score', 'Average Math Score', 'Max Reading Score', 'Average Reading Score' ]</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi og"><img src="../Images/ff2feed6d8b75eab6e6056ab4758ca2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/0*NgObzCPaqAvi-VqN.png"/></div></figure><p id="d41c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完全相同的数据框架，但更有条理。</p><p id="7419" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">对名义列使用聚合函数</strong></p><p id="68f2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的所有例子中，我们在数字列上使用了聚合函数。对一些名义列(如“午餐”和“父母教育水平”)应用聚合函数。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="6bf5" class="np lv jj nl b gy nq nr l ns nt">df.groupby(['race/ethnicity', 'gender']).agg({'lunch': pd.Series.mode, 'parental level of education': pd.Series.mode, 'math score':np.mean})</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/50e976bc2373ff9b31a02c6fa5fe189a.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/0*mAQ2Qq2qNltRtPHX.png"/></div></figure><p id="a08c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您在上面的代码中看到的，对于名义数据，语法是不同的。就像提醒模式是出现最多的数据。</p><p id="ed86" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">在Groupby中应用函数</strong></p><p id="cd22" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">计算一下有多少孩子的“父母教育水平”是高中水平。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="e34f" class="np lv jj nl b gy nq nr l ns nt">df.groupby(df['parental level of education'].apply(lambda x: 'high' in x)).size()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/bb50a5ce0fb6c422245a7309b4d97977.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/0*_maxYfsHURz2nXTV.png"/></div></figure><p id="8db9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您不习惯使用lambda，请查看这篇文章:</p><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/efficient-python-programming-with-lambda-map-filter-and-sorted-cfdf536afc36"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">使用Lambda、Map、Filter和Sorted进行高效的Python编程</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">使用数字、字符串和字典列表的快乐编程</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="oj l nc nd ne na nf ja mr"/></div></div></a></div><p id="ab94" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">将“数学分数”栏分成三个偶数桶，并将其定义为低、中、高分</strong></p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="b613" class="np lv jj nl b gy nq nr l ns nt">df.groupby(pd.qcut(x=df['math score'], q=3, labels=['low', 'average', 'high'])).size()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/e4c4858ce3407a497a2be28a56822a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:232/format:webp/0*55ZQfEVN4D0OF01s.png"/></div></figure><p id="fb23" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想设置分界点，并定义你的低，平均，高，这也是一个简单的方法。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="879e" class="np lv jj nl b gy nq nr l ns nt">df.groupby(pd.cut(df['math score'], [0, 40, 70, 100])).size()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/913570635bcacd887400075752a3717d.png" data-original-src="https://miro.medium.com/v2/resize:fit:268/format:webp/0*5oW12IHkVyZxme3K.png"/></div></figure><h1 id="ac5c" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">使用Groupby转换</h1><p id="dff7" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在数据帧“df”中生成一个新列，并添加一个包含每个数学分数与平均数学分数之差的列。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="ae0c" class="np lv jj nl b gy nq nr l ns nt">df['Distance From the Mean'] = df.groupby(['race/ethnicity', 'gender'])['math score'].transform(lambda x: x - x.mean())</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi om"><img src="../Images/34415b66e813b2b0f18ec4e357f44b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sUJGlggnzKV5pI8j.png"/></div></div></figure><p id="ece4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看上面的数据框。末尾有一个名为“与平均值的距离”的新列。</p><h1 id="b231" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">使用Groupby筛选</h1><p id="626c" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">您可以根据特定条件筛选出数据，使数据更有意义。筛选数据少于100行的组或种族。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="0e43" class="np lv jj nl b gy nq nr l ns nt">df_n = df.groupby('race/ethnicity').filter(lambda x: len(x) &gt; 100)</span></pre><p id="46fe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的代码说保留长度超过100的组。检查原始数据帧“df”和过滤数据帧“df_n”的长度。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="295e" class="np lv jj nl b gy nq nr l ns nt">print(len(df))<br/>print(len(df_n))</span></pre><p id="76e2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">原始数据帧的长度为1000，应用过滤器后，数据帧的长度变为911。</p><h1 id="572b" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">地图</h1><p id="24c6" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">绘制每组的平均阅读分数，并生成一个新列。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="ef05" class="np lv jj nl b gy nq nr l ns nt">df['New'] = df['race/ethnicity'].map(df.groupby(['race/ethnicity'])['reading score'].mean())</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi on"><img src="../Images/1121f612fd45ec3a683a90a4bf18940b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lIKkE9pnjgpV9f30.png"/></div></div></figure><p id="151b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看这个数据框。最后有一个名为“新”的新列，包含相应组的平均阅读分数。</p><h1 id="a141" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">使用Groupby进行可视化</h1><p id="189e" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">众所周知，一图胜千言。下面是groupby中可视化技术的一些演示。做一个父母教育水平的柱状图。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="f2e6" class="np lv jj nl b gy nq nr l ns nt">import matplotlib.pyplot as plt<br/>plt.clf()<br/>df.groupby('parental level of education').size().plot(kind='bar')</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/a5d1e0257abdf6f5158c0d04cb8b967b.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/0*PKMrs9iLk2bjTfDK.png"/></div></figure><p id="63cf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请尝试制作一个饼图。你只需要在上面的代码中使用' pie '而不是' bar'。如果你没有传递任何'种类'，情节将是一个简单的线情节。让我们画出每组的平均数学分数。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="8d6b" class="np lv jj nl b gy nq nr l ns nt">df.groupby('race/ethnicity')['math score'].mean().plot()</span></pre><figure class="ng nh ni nj gt iv gh gi paragraph-image"><div class="gh gi op"><img src="../Images/3b8792ec9c91777970cf7a5533033084.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/0*jiQmXNBYWa5qlEK2.png"/></div></figure><h1 id="cf67" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">结论</h1><p id="9579" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在本文中，您学习了以多种不同的方式对数据进行分组和汇总。您学习了使用groupby使用聚合函数、数据转换、过滤、映射和可视化。</p><p id="a2fa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这个视频中也解释了同样的内容:</p><figure class="ng nh ni nj gt iv"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="ce50" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">欢迎在推特上关注我，喜欢我的T2脸书页面。</p><h2 id="f034" class="np lv jj bd lw os ot dn ma ou ov dp me lh ow ox mg ll oy oz mi lp pa pb mk pc bi translated">更多阅读:</h2><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/your-everyday-cheatsheet-for-pythons-matplotlib-c03345ca390d"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">Python Matplotlib的日常备忘单</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">完整的可视化课程</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="pd l nc nd ne na nf ja mr"/></div></div></a></div><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/a-complete-recommendation-system-algorithm-using-pythons-scikit-learn-library-step-by-step-guide-9d563c4db6b2"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">使用Python的Scikit-Learn库的完整推荐系统算法:分步指南</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">一个简单、容易、有用的算法，只有几行代码</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="pe l nc nd ne na nf ja mr"/></div></div></a></div><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/a-complete-guide-to-hypothesis-testing-for-data-scientists-using-python-69f670e6779e"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">数据科学家使用Python进行假设检验的完整指南</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">用样本研究问题、解决步骤和完整代码清楚地解释</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="pf l nc nd ne na nf ja mr"/></div></div></a></div><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/best-free-courses-for-computer-science-software-engineering-and-data-science-50cd88cafd74"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">编程、软件工程和数据科学的最佳免费课程</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">麻省理工、哈佛和斯坦福等顶尖大学的免费课程</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="pg l nc nd ne na nf ja mr"/></div></div></a></div><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/a-complete-anomaly-detection-algorithm-from-scratch-in-python-step-by-step-guide-e1daf870336e"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">Python中从头开始的完整异常检测算法:分步指南</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">基于概率的异常检测算法</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="ph l nc nd ne na nf ja mr"/></div></div></a></div><div class="is it gp gr iu mr"><a rel="noopener follow" target="_blank" href="/how-to-present-the-relationships-amongst-multiple-variables-in-python-70f1b5693f5"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jk gy z fp mw fr fs mx fu fw ji bi translated">如何在Python中呈现多个变量之间的关系</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">了解如何使用Python中的多元图表和绘图来呈现要素之间的关系</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="pi l nc nd ne na nf ja mr"/></div></div></a></div></div></div>    
</body>
</html>