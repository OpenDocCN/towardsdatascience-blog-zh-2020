<html>
<head>
<title>Making a Bar Chart Race Plot using Plotly — made easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Plotly制作条形图比赛图——变得简单</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-a-bar-chart-race-plot-using-plotly-made-easy-8dad3b1da955?source=collection_archive---------23-----------------------#2020-10-06">https://towardsdatascience.com/making-a-bar-chart-race-plot-using-plotly-made-easy-8dad3b1da955?source=collection_archive---------23-----------------------#2020-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/95e3027caeff33a3e211d7af1ff2bc2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mWB8GToRwhWEtvLJTnQPg.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com/s/photos/swimming-birdseye?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kc" href="https://unsplash.com/@serenarepice?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Serena Repice Lentini </a>的照片</p></figure><p id="6e3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你见过这些随着时间的推移对事物或人进行排名的赛车条形图吗？他们越来越受欢迎，他们看起来很有趣，他们可以看到谁或什么随着时间的推移在某个排名中名列前茅。你可能已经看过2020年根据COVID19案例进行的国家排名，或者从洛克斐勒到杰夫·贝索斯的最富有的人的排名。无论你的排名如何，今天你将学习如何使用Python和Plotly制作你自己的赛车图！—也提供包装:)</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">1995年至2019年间全球10大富豪</p></figure><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">一段时间内COVID病例最多的国家19</p></figure><p id="12ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">致谢</strong></p><ul class=""><li id="d217" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><a class="lq lr ep" href="https://medium.com/u/1bace2932c65?source=post_page-----8dad3b1da955--------------------------------" rel="noopener" target="_blank">阿曼达·伊格莱西亚斯·莫雷诺</a>在2017年写了一篇<a class="ae kc" rel="noopener" target="_blank" href="/bar-chart-race-with-plotly-f36f3a5df4f1">中期文章</a>，讲述了巴塞罗那顶级婴儿名字的条形图比赛情节。我从那篇文章中学到了很多，我在这篇文章中的意图是使用我从她的文章和其他资源中学到的东西来编写可用于任何特定用例的代码。</li><li id="01c0" class="lh li iq kf b kg ls kk lt ko lu ks lv kw lw la lm ln lo lp bi translated">本教程提供了制作动画Gapminder散点图的所有代码。虽然这个例子非常丰富，但是几乎没有解释任何代码。我写这篇文章是为了帮助其他人理解所有这些诡秘的论点意味着什么。当我使用“奇怪的”情节性参数时，我会在代码注释中用简单的术语解释它们的作用。</li></ul></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="3ef9" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated"><strong class="ak">TL；博士</strong></h1><p id="e278" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">如果你对如何制作这种图表不感兴趣，我已经为你写了一个包，让你轻松地绘制你自己的数据。使用<code class="fe nh ni nj nk b">pip</code>简单安装以下软件包</p><pre class="lb lc ld le gt nl nk nm nn aw no bi"><span id="729e" class="np mf iq nk b gy nq nr l ns nt">pip install raceplotly</span></pre><p id="ad16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在一个<code class="fe nh ni nj nk b">python</code>脚本中运行以下内容:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div></figure><p id="23c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将获得1961年至2018年间产量最高的10种作物的时间表(见下文)。我从<a class="ae kc" href="http://www.fao.org/faostat/en/#data/QC" rel="noopener ugc nofollow" target="_blank">粮农组织</a>获得数据。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nv lg l"/></div></figure><p id="4452" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您发现任何问题，请向<code class="fe nh ni nj nk b"><a class="ae kc" href="https://github.com/lc5415/raceplotly" rel="noopener ugc nofollow" target="_blank">raceplotly</a></code> <a class="ae kc" href="https://github.com/lc5415/raceplotly" rel="noopener ugc nofollow" target="_blank">库</a>提交问题，如果您想提供改进，请向PRs提交问题！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="bdce" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated"><strong class="ak">龙(呃)解释</strong></h1><p id="f276" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">对于那些留在这里的人，谢谢。我会尽可能简洁地让你明白如何建立一个这样的情节并超越它。</p><h2 id="1766" class="np mf iq bd mg nw nx dn mk ny nz dp mo ko oa ob ms ks oc od mw kw oe of na og bi translated"><strong class="ak">情节性基础</strong></h2><p id="fe7c" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">许多Plotly新用户第一次接触到<code class="fe nh ni nj nk b">plotly.express</code>库。在这个库中，Plotly开发人员去除了Plotly图形的复杂性，使其更加用户友好。尽管每当一个人想要超越<code class="fe nh ni nj nk b">plotly.express</code>的能力时，就有必要看看在引擎盖下发生了什么。</p><p id="7e67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先要知道的是，所有Plotly图形都包含3个主要元素:<em class="oh">数据</em>、<em class="oh">布局、</em>和<em class="oh">帧</em>。</p><ul class=""><li id="3d3e" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><em class="oh">数据</em>元素是一个<em class="oh"> python列表</em>,包含关于您想要绘制的绘图类型的信息:散点图、条形图、漏斗图、热图、choropleth…以及此类绘图的相关参数:x、y、z、颜色、大小…</li><li id="a0dc" class="lh li iq kf b kg ls kk lt ko lu ks lv kw lw la lm ln lo lp bi translated"><em class="oh">布局</em>元素是一个<em class="oh"> python字典</em>，包含关于绘图外观的信息，即图形的属性(标题、大小、图例、背景色……)、轴的属性(标题、颜色、刻度……)，以及关于图形的交互属性(按钮、滑块、当用户点击或悬停在图形上时显示的内容和位置)。此外，还有许多参数用来调整每一种图形(特别是条形图，特别是漏斗图……)。</li><li id="28d4" class="lh li iq kf b kg ls kk lt ko lu ks lv kw lw la lm ln lo lp bi translated"><em class="oh">帧</em>元素允许用户制作动画情节。<em class="oh">帧</em>是一个<em class="oh"> python列表</em>包含了每一个要按顺序渲染的帧。</li></ul><p id="682c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想了解更多细节，请参考官方的<a class="ae kc" href="https://plotly.com/python/figure-structure/" rel="noopener ugc nofollow" target="_blank"> Plotly基础指南，了解其图形数据结构</a>和/或核心Plotly图形的<a class="ae kc" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html" rel="noopener ugc nofollow" target="_blank">文档。</a></p><p id="0bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与许多其他绘图库一样，Plotly提供了大量的参数来修改绘图。虽然这在你希望完善一个情节时很有用，但它也可能是压倒性的，尤其是在开始或原型制作时。<strong class="kf ir"> <em class="oh">现在让我们探索一下如何用python写一个Plotly figure来生成如上图的种族栏图。</em> </strong></p><h2 id="7af1" class="np mf iq bd mg nw nx dn mk ny nz dp mo ko oa ob ms ks oc od mw kw oe of na og bi translated"><strong class="ak">从头开始编写种族栏剧情图</strong></h2><p id="b754" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">正如在<a class="ae kc" href="https://plotly.com/python/figure-structure/" rel="noopener ugc nofollow" target="_blank"> Plotly基础</a>中提到的，在python中，一个Plotly图形可以是一个字典或者一个<code class="fe nh ni nj nk b">plotly.graph_objects.Figure</code>实例。我个人不喜欢其中一个，我喜欢先创建一个实例，然后再访问。我们将逐个元素地创建Plotly图形，首先是数据，然后是布局，然后是框架，当然，您可以在一个块中完成所有这些。</p><p id="b1d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将首先加载我们的数据(我从粮农组织下载的数据):</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">下载粮农组织数据</p></figure><p id="2b51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="oh">注意:</em> </strong> <em class="oh">如果您使用的是自定义数据集，请确保它有3列:一列对应于您正在排序的项目(本教程中的</em> <strong class="kf ir">项目)</strong> <em class="oh">，一列对应于您正在排序的值(本教程中的</em> <strong class="kf ir">值</strong> <em class="oh">)，另一列对应于每个对应的项目-值对的年份或日期(本教程中的</em> <strong class="kf ir">年份</strong> <em class="oh">)</em></p><p id="d0f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们实例化我们的图形:</p><pre class="lb lc ld le gt nl nk nm nn aw no bi"><span id="9263" class="np mf iq nk b gy nq nr l ns nt">import plotly.graph_objects as go<br/>fig = {<br/>    "data": [],<br/>    "layout": {},<br/>    "frames": []<br/>}</span></pre><p id="2231" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，让我们定义<em class="oh">数据</em>元素。正如我们之前所说，这必须是一个python列表，其中包含我们希望绘制的绘图类型(在本例中为条形图)以及与每个轴对应的数据框的相应列。在我们的例子中，我们正在构建一个动画，我们为默认图形选择的数据将对应于动画开始前显示的数据切片。在这里，我选择了最早的数据(从1961年开始)作为默认框架。</p><p id="a682" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要一个颜色的每一个项目，我们正在排名。<a class="lq lr ep" href="https://medium.com/u/1bace2932c65?source=post_page-----8dad3b1da955--------------------------------" rel="noopener" target="_blank">阿曼达·伊格莱西亚斯·莫雷诺</a>在她的<a class="ae kc" rel="noopener" target="_blank" href="/bar-chart-race-with-plotly-f36f3a5df4f1"> 2017帖子</a>中，写了一个函数来为每个类别分配一个RGB三元组。使用列表理解，我们可以在一行中做到这一点(参见下面的代码)。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">填充绘图图形数据条目</p></figure><p id="5b69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="oh">注:</em> </strong>要了解<code class="fe nh ni nj nk b">texttemplate</code>的功能，请参考<a class="ae kc" href="https://plotly.com/javascript/texttemplate/" rel="noopener ugc nofollow" target="_blank"> Plotly文档</a></p><p id="e62c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们继续填充<em class="oh">布局。</em>我在这里的默认选择是使用白色背景，y轴上没有轴信息(对应于项目名称)，因为我们已经显示了带有文本注释的信息。此外，我决定显示x轴刻度及其相应的值，并将x轴设置为一个固定值(等于表中的最大值)。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">初始化默认框架的布局</p></figure><p id="3e03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们正在创建一个动画情节，所以我们必须在布局中包含两个额外的条目:更新按钮(播放和暂停)和滑块。我们暂时将滑块留空，因为我们将在创建框架时填充一个滑块字典。Plotly提供了一个名为<code class="fe nh ni nj nk b"><a class="ae kc" href="https://plotly.com/python/reference/layout/updatemenus/#layout-updatemenus-buttons-method" rel="noopener ugc nofollow" target="_blank">updatemenus</a></code>的<em class="oh">布局</em>属性，允许我们<a class="ae kc" href="https://plotly.com/python/dropdowns/" rel="noopener ugc nofollow" target="_blank">创建按钮、下拉菜单、更新布局和控制动画</a>。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">添加播放和暂停按钮</p></figure><p id="263d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="oh">注:</em></strong><a class="ae kc" href="https://plotly.com/python/reference/#layout-transition" rel="noopener ugc nofollow" target="_blank">过渡</a>持续时间对应于帧过渡所需的时间。低值将使过渡非常快，就像切换图片，而长值将使它更像一个视频。帧持续时间控制每帧显示多长时间。</p><p id="c5ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">最后</strong>，我们将创建对应于每年前10名的帧。在这一步，我们还填充布局的<em class="oh">滑块</em>属性。这样做是为了使每一帧都链接到滑块中的一个位置。首先，我们用滑块元信息和一个空的<code class="fe nh ni nj nk b">steps</code>列表初始化一个字典:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div></figure><p id="08a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们制作框架并生成步骤:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nu lg l"/></div></figure><p id="d14d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，在所有这些艰苦的工作之后，你可以简单地运行<code class="fe nh ni nj nk b">go.Figure(fig)</code>来展示你来之不易的数字。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="58ad" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated"><strong class="ak">结论</strong></h1><ul class=""><li id="9f21" class="lh li iq kf b kg nc kk nd ko oi ks oj kw ok la lm ln lo lp bi translated">我们需要大量的代码来生成条形图比赛图。移动代码是痛苦的，<strong class="kf ir">如果你打算经常使用的话，我鼓励你使用</strong><a class="ae kc" href="https://github.com/lc5415/raceplotly" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="oh"/></strong></a><strong class="kf ir">！</strong></li><li id="ee8a" class="lh li iq kf b kg ls kk lt ko lu ks lv kw lw la lm ln lo lp bi translated">我应该指出的一点是，我们的杆在相互超越时不会滑过对方。我无法用Plotly实现这一点，<a class="lq lr ep" href="https://medium.com/u/cf7f60f2eeb3?source=post_page-----8dad3b1da955--------------------------------" rel="noopener" target="_blank"> Ted Petrou </a> <a class="ae kc" href="https://medium.com/dunder-data/create-a-bar-chart-race-animation-in-python-with-matplotlib-477ed1590096" rel="noopener">使用</a> <code class="fe nh ni nj nk b"><a class="ae kc" href="https://medium.com/dunder-data/create-a-bar-chart-race-animation-in-python-with-matplotlib-477ed1590096" rel="noopener">matplotlib</a></code>设法做到了这一点，所以看看他吧！</li></ul><p id="9282" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你已经做到了这一步，我希望你已经发现这是有用的。如果你对自己的情节有任何具体问题，请随时联系。</p><p id="91f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> PS: </strong>我一定要把你指向<a class="ae kc" href="https://app.flourish.studio/@flourish/bar-chart-race" rel="noopener ugc nofollow" target="_blank">兴旺app </a>获得无代码的快乐</p></div></div>    
</body>
</html>