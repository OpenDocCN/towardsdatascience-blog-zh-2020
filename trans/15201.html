<html>
<head>
<title>Tapping NASA’s Earth Data via OpeNDAP APIs and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过OpeNDAP APIs和Python挖掘NASA的地球数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tapping-nasas-earth-data-via-opendap-apis-and-python-towards-earth-data-engineering-e6531095e8a0?source=collection_archive---------31-----------------------#2020-10-19">https://towardsdatascience.com/tapping-nasas-earth-data-via-opendap-apis-and-python-towards-earth-data-engineering-e6531095e8a0?source=collection_archive---------31-----------------------#2020-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2c66" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">走向地球数据工程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/34a1825775e27d4dbd767d6389960bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T6VXvL5vQ-t5IKMC"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">美国宇航局在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="ce66" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">背景</h1><p id="346e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">NASA地球数据对于地球科学家、水文学家以及对使用地球数据(例如，降水、温度等)感兴趣的任何人来说都是非常宝贵的资源。)用于教育、分析、可视化和建模等。这些数据可通过多个平台获得，包括美国宇航局戈达德地球科学(GES)数据和信息服务中心(DISC)，以及美国宇航局地球科学数据系统(ESDS)计划等。然而，这些平台需要用户手动访问网站来下载所需的数据。很多时候，Python程序员和不习惯地理格式的用户似乎无法访问数据格式(例如netCFD、hdf等)。</p><p id="ff8a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">本文试图通过提供一个通过<a class="ae kv" href="https://earthdata.nasa.gov/collaborate/open-data-services-and-software/api/opendap" rel="noopener ugc nofollow" target="_blank"> OpeNDAP </a>访问这些数据的示例，来减少python用户访问NASA地球数据的障碍。我们将完全使用python来实现数据检索过程的自动化。因此，本指南也有利于地球数据工程和利用NASA的数据金矿开发数据管道。</p><h1 id="e75f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">问题陈述:2020年卡拉奇洪水</h1><p id="0181" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我开发本指南的主要动机源于理解导致2020年8月下旬卡拉奇毁灭性洪水的<a class="ae kv" href="https://earthobservatory.nasa.gov/images/147330/extreme-monsoon-rains-in-pakistan" rel="noopener ugc nofollow" target="_blank">降水事件</a>的需要。美国宇航局地球数据包括大量数据集，其中包括基于卫星和历史降水事件的建模观测。本指南将说明如何在python中访问其中一个数据集，即<a class="ae kv" href="https://gpm.nasa.gov/data/imerg" rel="noopener ugc nofollow" target="_blank"> GPM IMERG数据集</a>，以提取卡拉奇及其所在地(2020年8月下旬)的卫星降水数据。</p><h1 id="0674" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">先决条件</h1><p id="077a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通过python访问NASA地球数据集的关键先决条件是:</p><p id="95f0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">1)创建一个<a class="ae kv" href="https://urs.earthdata.nasa.gov/users/new" rel="noopener ugc nofollow" target="_blank"> NASA地球数据账户</a>。它是免费和即时的。</p><p id="9436" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">2) 2)选择要访问的适当数据集。这里提供了一些探索NASA数据集的指南<a class="ae kv" rel="noopener" target="_blank" href="/getting-nasa-data-for-your-next-geo-project-9d621243b8f3">。如前所述，在本文中，我们将从</a><a class="ae kv" href="https://gpm.nasa.gov/data/imerg" rel="noopener ugc nofollow" target="_blank"> GPM IMERG hourly product </a>中访问和检索数据。</p><p id="c305" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">3)安装<a class="ae kv" href="https://github.com/pydap/pydap" rel="noopener ugc nofollow" target="_blank"> pydap </a> python库。虽然有其他基于python的方法允许通过OpeNDAP api连接到NASA数据集，但pydap使用起来简单方便，应该可以与任何python 3.6+版本一起工作。然而，我们<a class="ae kv" href="https://github.com/pydap/pydap/issues/121" rel="noopener ugc nofollow" target="_blank">建议通过以下命令从github提交安装</a>:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="8d96" class="mu kx iq mq b gy mv mw l mx my">pip install git+https://github.com/pydap/pydap.git@fc0dd0e6f180e455dbb68a06a85f84b1eca6754f</span></pre><h1 id="9a6c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">连接到NASA数据集</h1><p id="1716" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一旦创建了地球数据登录并安装了pydap库，我们就可以通过OpenDAP建立与NASA数据集的连接，给定opendap url。此处提供了一些可用的OpenDAP数据集的档案<a class="ae kv" href="https://disc.gsfc.nasa.gov/information/tools?title=OPeNDAP%20and%20GDS" rel="noopener ugc nofollow" target="_blank">。我们有兴趣观察2020年8月下旬卡拉奇的次日降水模式。因此，</a><a class="ae kv" href="https://disc.gsfc.nasa.gov/datasets/GPM_3IMERGHHL_06/summary?keywords=GPM" rel="noopener ugc nofollow" target="_blank"> GPM半小时延迟降水</a>是一个合适的数据集。以下代码块使python用户能够通过pydap连接到数据集(请提供NASA地球数据用户名和密码):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="f37d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">请求数据</h1><p id="128a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一旦与GPM数据集建立了连接(该连接在上面的代码中表示为“dataset”)，我们就可以提取与我们感兴趣的空间区域相关的数据(在本例中为<a class="ae kv" href="https://latitudelongitude.org/pk/karachi/" rel="noopener ugc nofollow" target="_blank">卡拉奇及其所在地</a>)，以及我们感兴趣的时间(在本例中为2020年8月25日至28日)。这里需要注意的是，GPM数据集变量存储在三维数组中，时间作为第一个索引，纬度作为第二个索引，经度作为第三个索引(有关数据格式的详细信息，请参见<a class="ae kv" href="https://gpm1.gesdisc.eosdis.nasa.gov/dods/GPM_3IMERGHHL_06.info" rel="noopener ugc nofollow" target="_blank">这里的</a>)。因此，为了从上述代码中的“数据集”请求一个(变量的)块，我们需要输入以下代码行:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="7e51" class="mu kx iq mq b gy mv mw l mx my">requested_data = dataset[var_name][start_time_index: end_time_index, start_lat_index: end_lat_index, start_lon_index: end_lon_index]</span></pre><p id="0ba3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如上所述，精确的数据请求需要I)请求的变量的名称，ii)时间索引的范围，以及iii)空间索引的范围(纬度和经度界限)。虽然理论上可以请求整个数据集，但是<a class="ae kv" href="https://gpm1.gesdisc.eosdis.nasa.gov/dods/GPM_3IMERGHHL_06.info" rel="noopener ugc nofollow" target="_blank"> GPM数据集</a>是全局的和海量的(至少万亿字节)。因此，请求整个数据集是不可取的。无论如何，这样的请求会在NASA的服务器上超时，不会通过。</p><h1 id="dabd" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">确定空间范围</h1><p id="da3e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这幅图中我们感兴趣的空间区域是卡拉奇及其所在地。因此，我们需要在跨越巴基斯坦卡拉奇的数据请求中提供纬度和经度索引。下面的代码块说明了如何确定这些索引的范围。变量“lat_range”和“long_range”应由用户定义，用于指定所请求数据的空间范围。剩下的代码查找对应于这个范围的GPM数据数组索引。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="8a6f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">确定时间指数</h1><p id="db47" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">确定对应于2020年8月下旬(8月25-28日)的GPM数据集时间指数，需要了解数据集本身的开始时间。根据<a class="ae kv" href="https://gpm1.gesdisc.eosdis.nasa.gov/dods/GPM_3IMERGHHL_06.info" rel="noopener ugc nofollow" target="_blank"> GPM数据集</a>的元数据，该数据的开始时间为2000年6月1日00:00:00。此外，我们使用的GPM数据集是半小时一次的。因此，对应于2020年8月25日00:00:00的时间索引可以通过找到20 00年6月1日和2020年8月25日之间的30分钟间隔的数量来确定。下面的代码块在GPM数据集中找到开始时间索引，对应于2020年8月25日，按照上述逻辑。我们还通过核对与索引值相关联的时间变量来检查逻辑的有效性，以确保它确实是2020年8月25日。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="b314" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">获取请求的数据</h1><p id="901d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在我们已经确定了GPM数据的起始时间索引和感兴趣的空间索引，我们可以使用pydap请求GPM降水。请求GPM降水数据的代码如下。请注意，降水变量名为“precipcal ”,我们要求从2020年8月25日开始的4天(巴基斯坦卡拉奇)的数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="02e3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">将检索到的数据转换为数据帧</h1><p id="5f7e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通过pydap从NASA接收的数据被保存为一个<a class="ae kv" href="https://www.pydap.org/en/latest/developer.html" rel="noopener ugc nofollow" target="_blank">“py DAP模型”</a>对象。这个对象的四个属性是特别感兴趣的，即‘time’，‘lat’，‘lon’和‘precipcal’(请求的变量名)；“time”、“lat”和“lon”是表示请求的数据的时间、纬度和经度维度的numpy数组，“precipal”(请求的变量)是一个3D numpy数组，具有与时间、纬度和经度维度相对应的半小时GPM降水量值。下面的代码片段演示了如何将这些数据转换成pandas数据帧。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="693d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">快速查看2020年8月卡拉奇的降雨</h1><p id="1b95" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一旦检索到的数据被转换成数据帧，我们就可以通过一个简单的时间序列来快速查看2020年8月卡拉奇的毁灭性事件。让我们通过<a class="ae kv" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank">的时间序列图(代码也在下面给出)来想象这些雨是如何在卡拉奇Cantt地区展开的。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/bcdf6b79e2caa34bd41c153550e24905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MhebQQGw54RvmDP4lylR1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卡拉奇坎特地区2020年8月的降雨结果如何(图片由作者提供)</p></figure><h1 id="31e3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">最后的想法</h1><p id="827c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">本文展示了如何使用<a class="ae kv" href="https://github.com/pydap/pydap" rel="noopener ugc nofollow" target="_blank"> pydap </a>库和<a class="ae kv" href="https://earthdata.nasa.gov/collaborate/open-data-services-and-software/api/opendap" rel="noopener ugc nofollow" target="_blank"> OpeNDAP </a> api在python中访问NASA地球数据集。这里提供的代码片段也可以用作从NASA的地球数据开发数据管道的基线，还可以从NASA的数据仓库中挖掘出宝贵的见解。</p><p id="04aa" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我希望本文的内容对地球数据科学家、工程师和任何对探索地球数据感兴趣的人有用。你可以通过<a class="ae kv" href="http://www.linkedin.com/in/taimoor-akhtar-12683213" rel="noopener ugc nofollow" target="_blank"> linkedin </a>或<a class="ae kv" href="https://twitter.com/drkupster" rel="noopener ugc nofollow" target="_blank"> twitter </a>与我联系，进行任何询问、讨论等。</p></div></div>    
</body>
</html>