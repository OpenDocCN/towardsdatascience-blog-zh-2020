<html>
<head>
<title>Pillar Based 3-D Point Cloud Object Detection Implementation on Waymo Open Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Pillar的三维点云物体检测在Waymo开放数据集上的实现</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pillar-based-3-d-point-cloud-object-detection-implementation-on-waymo-open-dataset-423e9a449ecb?source=collection_archive---------54-----------------------#2020-09-21">https://towardsdatascience.com/pillar-based-3-d-point-cloud-object-detection-implementation-on-waymo-open-dataset-423e9a449ecb?source=collection_archive---------54-----------------------#2020-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f2a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Amazon Sage Maker上实现基于支柱的对象检测深度神经网络的教程。这可以推广到任何云实例，甚至是本地环境。</h2></div><h1 id="83ab" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">介绍</h1><p id="fc23" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这篇文章是关于在AWS上实现和运行3D点云物体检测深度神经网络的。激光雷达(3D点云)物体检测已经成为自动驾驶领域中的重要研究领域。由于自动驾驶汽车使用激光雷达来检测道路上的物体，因此在道路上检测这些物体并预测它们的运动以做出明智的驾驶决策非常重要。</p><p id="56b8" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">有许多用于道路上物体检测和跟踪的开放数据集可供您学习。我在下面列出了几个受欢迎的:</p><ul class=""><li id="746d" class="mb mc it lc b ld lw lg lx lj md ln me lr mf lv mg mh mi mj bi translated">Waymo开放数据集(<a class="ae mk" href="https://waymo.com/open/" rel="noopener ugc nofollow" target="_blank">https://waymo.com/open/</a>)</li><li id="4604" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">基蒂数据集(【http://www.cvlibs.net/datasets/kitti/】T2</li><li id="aa2e" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">Lyft级数据集(【https://self-driving.lyft.com/level5/】T4)</li></ul><p id="7324" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">一旦你知道要处理什么样的数据集，接下来就是对这些数据表现良好的神经网络。考虑到这种数据可以用于例如对象检测、分割、对象跟踪等的不同应用。有不同的网络。请参考<a class="ae mk" href="https://medium.com/@a_tyagi/3d-point-clouds-bounding-box-detection-and-tracking-pointnet-pointnet-lasernet-point-pillars-9439af14dfba" rel="noopener">这篇</a>文章，阅读更多关于3D点云数据及其应用的信息，以及哪些网络最适合每种应用。为了这篇文章的目的，我们把重点放在物体检测和最近发表的基于柱子的方法[1]来解决这个问题。</p><h1 id="e2f6" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">先决条件:</h1><ul class=""><li id="6d35" class="mb mc it lc b ld le lg lh lj mq ln mr lr ms lv mg mh mi mj bi translated">克隆GitHub repo:<a class="ae mk" href="https://github.com/tyagi-iiitv/pillar-od" rel="noopener ugc nofollow" target="_blank">https://github.com/tyagi-iiitv/pillar-od</a>。</li><li id="d4ea" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">访问Waymo数据集(<a class="ae mk" href="https://waymo.com/open/download/" rel="noopener ugc nofollow" target="_blank">https://waymo.com/open/download/</a>)。访问他们的谷歌云存储大约需要2天时间，看起来像下面的图片。我们将使用它，这样我们就可以用终端直接在云上下载数据。</li></ul><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/32b2a55b0f95870cc78c6e8d2d85d917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfe09SsvIeOkKvh3LAehpw.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">谷歌云上的Waymo数据集回购</p></figure><h1 id="2d81" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">实施步骤</h1><h2 id="eff4" class="nj kj it bd kk nk nl dn ko nm nn dp ks lj no np ku ln nq nr kw lr ns nt ky nu bi translated">启动云实例</h2><p id="b02e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因为我使用的是Amazon SageMaker，所以我们用大约2TB的空间和一个GPU启动了一个笔记本实例。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nv"><img src="../Images/01fce909a7213c3911d5151a5a183270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0j7E4JJKK8zmRIuLsIsfWw.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">在Amazon SageMaker上创建一个笔记本实例。</p></figure><p id="b09f" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">然后我们启动我们的云实例并打开JupyterLab，接着在我们的实例上打开一个新的终端。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/41d26ca8d52da3408b1f1c5119f0b0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*9QcOwby9kcds8N94Ydz9vA.png"/></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">为您的云实例打开一个终端。</p></figure><h2 id="1e9c" class="nj kj it bd kk nk nl dn ko nm nn dp ks lj no np ku ln nq nr kw lr ns nt ky nu bi translated">获取数据</h2><p id="6834" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用以下命令从google cloud bucket获取数据(记住要将gcloud添加到路径中):</p><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="2782" class="nj kj it ny b gy oc od l oe of">curl <a class="ae mk" href="https://sdk.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://sdk.cloud.google.com</a> | bash<br/>exec -l $SHELL<br/>gcloud init</span></pre><p id="d1ed" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">如果<code class="fe og oh oi ny b">gcloud</code>仍然无法识别，使用<code class="fe og oh oi ny b">cat /home/ec2-user/.bashrc</code>查看<code class="fe og oh oi ny b">.bashrc</code>文件的内容，并验证gcloud的链接，可能在该文件的最后两行。使用下面的命令将它们手动添加到您的路径中。这应该可以让gcloud命令在您的终端上工作。</p><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="d05a" class="nj kj it ny b gy oc od l oe of">source /home/ec2-user/google-cloud-sdk/path.bash.inc<br/>source /home/ec2-user/google-cloud-sdk/completion.bash.inc<br/>gcloud init</span></pre><p id="f496" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">现在，最后，获取训练和验证数据，并将其分别存储在<code class="fe og oh oi ny b">train_data</code>和<code class="fe og oh oi ny b">validation_data</code>目录中。将数据从google cloud bucket复制到您的实例的命令是<code class="fe og oh oi ny b">gsutil -m cp -r gs://waymo_open_dataset_v_xxx /path/to/my/data</code>找到waymo存储库的确切名称，打开waymo开放数据集的google云存储目录，并复制存储库的名称。如果你下载了一个<code class="fe og oh oi ny b">.tar</code>文件，用命令<code class="fe og oh oi ny b">tar -xvf training_xxxx.tar</code>提取它。这将为场景中的各个片段提供数据文件。</p><h2 id="34c0" class="nj kj it bd kk nk nl dn ko nm nn dp ks lj no np ku ln nq nr kw lr ns nt ky nu bi translated">设置代码</h2><ul class=""><li id="71b3" class="mb mc it lc b ld le lg lh lj mq ln mr lr ms lv mg mh mi mj bi translated">克隆GitHub repo <code class="fe og oh oi ny b">git clone https://github.com/tyagi-iiitv/pillar-od.git</code></li><li id="303d" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">创建一个虚拟工作环境<code class="fe og oh oi ny b">conda create -p ./env anaconda python=3.7</code>这将安装一个初始的、完整的Anaconda环境和必要的包。</li><li id="3b11" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">激活conda环境<code class="fe og oh oi ny b">source activate ./env</code></li><li id="b869" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">安装附加库<code class="fe og oh oi ny b">conda install absl-py tensorflow-gpu tensorflow-datasets</code></li><li id="89f2" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">安装Waymo开放数据集包装库</li></ul><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="81d3" class="nj kj it ny b gy oc od l oe of">rm -rf waymo-od &gt; /dev/null<br/>git clone https://github.com/waymo-research/waymo-open-dataset.git waymo-od<br/>cd waymo-od &amp;&amp; git branch -a<br/>git checkout remotes/origin/master<br/>pip install --upgrade pip<br/>pip install waymo-open-dataset-tf-2-1-0==1.2.0</span></pre><ul class=""><li id="e51f" class="mb mc it lc b ld lw lg lx lj md ln me lr mf lv mg mh mi mj bi translated">为模型准备数据集。更改文件<code class="fe og oh oi ny b">pillar-od/data/generate_waymo_dataset.sh</code>中的源和目标目录。现在运行文件从下载的数据中读取帧。这将需要一段时间，取决于您下载的数据大小。</li></ul><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="7486" class="nj kj it ny b gy oc od l oe of">cd pillar-od/data<br/>chmod +x generate_waymo_dataset.sh<br/>./generate_waymo_dataset.sh</span></pre><h2 id="cbc1" class="nj kj it bd kk nk nl dn ko nm nn dp ks lj no np ku ln nq nr kw lr ns nt ky nu bi translated">模特培训</h2><p id="2417" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在我们运行<code class="fe og oh oi ny b">pillar-od</code>目录中的train.py文件之前，请确保在<code class="fe og oh oi ny b">config.py</code>文件中更改数据集和其他配置参数的路径。完成后，让我们安装几个库来开始培训。</p><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="6f3d" class="nj kj it ny b gy oc od l oe of">pip install lingvo tensorflow-addons</span></pre><p id="644b" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">最后，模型准备好为汽车(类= 1)/行人(类=2)进行训练:</p><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="ce3d" class="nj kj it ny b gy oc od l oe of">python train.py --class_id=1 --nms_iou_threshold=0.7 --pillar_map_size=256</span><span id="ab61" class="nj kj it ny b gy oj od l oe of">python train.py --class_id=2 --nms_iou_threshold=0.7 --pillar_map_size=512</span></pre><h2 id="833d" class="nj kj it bd kk nk nl dn ko nm nn dp ks lj no np ku ln nq nr kw lr ns nt ky nu bi translated">模型评估</h2><p id="47c1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">模型评估的过程相同，使用以下命令:</p><pre class="mu mv mw mx gt nx ny nz oa aw ob bi"><span id="c4e8" class="nj kj it ny b gy oc od l oe of">python eval.py --class_id=1 --nms_iou_threshold=0.7 --pillar_map_size=256 --ckpt_path=/path/to/checkpoints --data_path=/path/to/data --model_dir=/path/to/results</span><span id="12a4" class="nj kj it ny b gy oj od l oe of">python eval.py --class_id=2 --nms_iou_threshold=0.2 --pillar_map_size=512 --ckpt_path=/path/to/checkpoints --data_path=/path/to/data --model_dir=/path/to/results</span></pre><h1 id="1b55" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">参考</h1><p id="0ffe" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">[1]基于立柱的自动驾驶目标检测，王等。艾尔。ECCV 2020</p></div></div>    
</body>
</html>