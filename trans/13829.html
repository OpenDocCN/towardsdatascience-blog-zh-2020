<html>
<head>
<title>Adjust for Overdispersion in Poisson Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">针对泊松回归中的过度离散进行调整</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/adjust-for-overdispersion-in-poisson-regression-4b1f52baa2f1?source=collection_archive---------2-----------------------#2020-09-23">https://towardsdatascience.com/adjust-for-overdispersion-in-poisson-regression-4b1f52baa2f1?source=collection_archive---------2-----------------------#2020-09-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="95df" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">广义线性模型</h2><div class=""/><div class=""><h2 id="90ce" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">消除泊松模型中显著系数的假阳性检测及其在r。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/4a2394da287db9173379f5bf74e1b313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vqB1bQqvqVtz2RkB"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">蒂莫·沃尔茨在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1445" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> T </span>当我们想要对每单位时间或空间的平均发生次数进行建模时，泊松回归模型自然而然地出现了。比如罕见癌症的发病率，十字路口汽车穿越的次数，或者地震的次数。</p><p id="2fd1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://en.wikipedia.org/wiki/Poisson_distribution" rel="noopener ugc nofollow" target="_blank">泊松分布</a>的一个特征是<strong class="lk jd">均值</strong>等于<strong class="lk jd">方差</strong>。然而，<em class="mn">过度分散</em>或<em class="mn">欠分散</em>分别发生在方差大于或小于均值的泊松模型中。实际上，在数据量有限的情况下，过度分散会更频繁地发生。</p><p id="9b1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">过度分散问题会影响模型的解释。为了避免对系数的错误估计，有必要解决这个问题。</p><p id="66d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我将讨论一些基本的方法来调整泊松回归模型中的过度分散现象。实现将用R代码展示。希望这篇文章有帮助。</p><p id="32e8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设我们想要使用预测器<em class="mn"> xi的向量来模拟计数响应<em class="mn">易</em>。</em>我们知道，响应变量Yi遵循参数为μi的泊松分布</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/98208fe791c04fec938f6e191a517b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*UJuWCghxO0ytKK1grKxyLQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">易服从泊松分布</p></figure><p id="9a8c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其中概率函数是</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9fe2bf7efe9ab271f60f23dc616e18d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*e_b_rGCytDUTaL8vU_qW2g.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">泊松PMF</p></figure><p id="8770" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对数连接函数用于连接预测值Xi和泊松参数μi的线性组合</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/59655ad0af0996e4c3af5e9e5d01b346.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*zQ40kRtLb6QBbM28kunX6g.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">泊松回归模型。</p></figure><p id="0d04" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们用《T21》一书中介绍的例子建立一个简单的模型。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="d2f8" class="mw mx it ms b gy my mz l na nb">## R code<br/>library(faraway)<br/>data(gala)<br/>gala = gala[,-2]<br/>pois_mod = glm(Species ~ .,family=poisson,gala)<br/>summary(pois_mod)</span></pre><p id="d9db" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是泊松模型的总结。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="1e05" class="mw mx it ms b gy my mz l na nb">Call:<br/>glm(formula = Species ~ ., family = poisson, data = gala)<br/><br/>Deviance Residuals: <br/>    Min       1Q   Median       3Q      Max  <br/>-8.2752  -4.4966  -0.9443   1.9168  10.1849  <br/><br/>Coefficients:<br/>              Estimate Std. Error z value Pr(&gt;|z|)    <br/>(Intercept)  3.155e+00  5.175e-02  60.963  &lt; 2e-16 ***<br/>Area        -5.799e-04  2.627e-05 -22.074  &lt; 2e-16 ***<br/>Elevation    3.541e-03  8.741e-05  40.507  &lt; 2e-16 ***<br/>Nearest      8.826e-03  1.821e-03   4.846 1.26e-06 ***<br/>Scruz       -5.709e-03  6.256e-04  -9.126  &lt; 2e-16 ***<br/>Adjacent    -6.630e-04  2.933e-05 -22.608  &lt; 2e-16 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>(Dispersion parameter for poisson family taken to be 1)<br/><br/>    Null deviance: 3510.73  on 29  degrees of freedom<br/>Residual deviance:  716.85  on 24  degrees of freedom<br/>AIC: 889.68<br/><br/>Number of Fisher Scoring iterations: 5</span></pre><p id="0e96" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不要被超级显著的系数所迷惑。那些漂亮的p值正是过度分散问题的后果。我们可以从视觉上或数量上检查过度分散。</p><p id="23b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们先画出相对于平均值的估计方差。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="4f14" class="mw mx it ms b gy my mz l na nb">## R code<br/>plot(log(fitted(pois_mod)),log((gala$Species-fitted(pois_mod))^2),xlab=expression(hat(mu)),ylab=expression((y-hat(mu))^2),pch=20,col="blue")</span><span id="3ce6" class="mw mx it ms b gy nc mz l na nb">abline(0,1) ## 'varianc = mean' line</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nd"><img src="../Images/dad9de3cb0d97185c279ee5efc651b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wWbtHWkv1S830EzfIJcaNA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">过度分散诊断</p></figure><p id="d7c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以看到，大多数方差大于平均值，这是过度分散的警告。</p><p id="f6c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">定量地，可以使用皮尔逊卡方统计和自由度来估计色散参数<strong class="lk jd"> φ </strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/687d1a5ef0b416510bfa9e047bd76e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*dGkHVbEogcHtLpENGEtCiQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">离差参数的估计</p></figure><p id="0e44" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当φ大于1时，为过度离散。为了手动计算参数，我们使用下面的代码。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="04d0" class="mw mx it ms b gy my mz l na nb">## R code<br/>dp = sum(residuals(pois_mod,type ="pearson")^2)/pois_mod$df.residual<br/>dp</span></pre><p id="be7c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这给了我们31.74914，并证实了这个简单的泊松模型有过度分散的问题。</p><p id="9675" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者，我们可以直接在拟合的模型上应用显著性检验来检查过度分散。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="8d07" class="mw mx it ms b gy my mz l na nb">## R code<br/>library(AER)<br/>dispersiontest(pois_mod)</span></pre><p id="45cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这产生了，</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="a850" class="mw mx it ms b gy my mz l na nb">Overdispersion test<br/><br/>data:  pois_mod<br/>z = 3.3759, p-value = 0.0003678<br/>alternative hypothesis: true dispersion is greater than 1<br/>sample estimates:<br/>dispersion <br/>  25.39503</span></pre><p id="edc7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该过度分散测试报告了模型中过度分散问题的重要性。</p><p id="473d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以检查过度分散对系数估计的影响程度。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="0f27" class="mw mx it ms b gy my mz l na nb">## R code<br/>summary(pois_mod,dispersion = dp)</span></pre><p id="40af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这产生了，</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="7236" class="mw mx it ms b gy my mz l na nb">Call:<br/>glm(formula = Species ~ ., family = poisson, data = gala)<br/><br/>Deviance Residuals: <br/>    Min       1Q   Median       3Q      Max  <br/>-8.2752  -4.4966  -0.9443   1.9168  10.1849  <br/><br/>Coefficients:<br/>              Estimate Std. Error z value Pr(&gt;|z|)    <br/>(Intercept)  3.1548079  0.2915897  10.819  &lt; 2e-16 ***<br/>Area        -0.0005799  0.0001480  -3.918 8.95e-05 ***<br/>Elevation    0.0035406  0.0004925   7.189 6.53e-13 ***<br/>Nearest      0.0088256  0.0102621   0.860    0.390    <br/>Scruz       -0.0057094  0.0035251  -1.620    0.105    <br/>Adjacent    -0.0006630  0.0001653  -4.012 6.01e-05 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>(Dispersion parameter for poisson family taken to be 31.74914)<br/><br/>    Null deviance: 3510.73  on 29  degrees of freedom<br/>Residual deviance:  716.85  on 24  degrees of freedom<br/>AIC: 889.68<br/><br/>Number of Fisher Scoring iterations: 5</span></pre><p id="521f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，大约一半的预测变得无关紧要，这改变了整个模型的解释。</p><p id="6d1a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好吧，让我们用下面两种方法来解决这个问题。</p><h2 id="4544" class="mw mx it bd nf ng nh dn ni nj nk dp nl lr nm nn no lv np nq nr lz ns nt nu iz bi translated">允许离差估计</h2><p id="75c4" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">调整过度分散的简单方法与估计模型中的分散参数一样简单。这可以通过r中的<em class="mn">准族</em>来完成。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="52db" class="mw mx it ms b gy my mz l na nb">qpoi_mod = glm(Species ~ .,family=quasipoisson, gala)<br/>summary(qpoi_mod)</span></pre><p id="6328" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这产生了，</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="de53" class="mw mx it ms b gy my mz l na nb">Call:<br/>glm(formula = Species ~ ., family = quasipoisson, data = gala)<br/><br/>Deviance Residuals: <br/>    Min       1Q   Median       3Q      Max  <br/>-8.2752  -4.4966  -0.9443   1.9168  10.1849  <br/><br/>Coefficients:<br/>              Estimate Std. Error t value Pr(&gt;|t|)    <br/>(Intercept)  3.1548079  0.2915901  10.819 1.03e-10 ***<br/>Area        -0.0005799  0.0001480  -3.918 0.000649 ***<br/>Elevation    0.0035406  0.0004925   7.189 1.98e-07 ***<br/>Nearest      0.0088256  0.0102622   0.860 0.398292    <br/>Scruz       -0.0057094  0.0035251  -1.620 0.118380    <br/>Adjacent    -0.0006630  0.0001653  -4.012 0.000511 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>(Dispersion parameter for quasipoisson family taken to be 31.74921)<br/><br/>    Null deviance: 3510.73  on 29  degrees of freedom<br/>Residual deviance:  716.85  on 24  degrees of freedom<br/>AIC: NA<br/><br/>Number of Fisher Scoring iterations: 5</span></pre><p id="5427" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以看到，色散参数估计为31.74921，这与我们前面提到的手动计算非常接近。这个过程告诉我们，只有三个预测系数是有意义的。</p><h2 id="1e96" class="mw mx it bd nf ng nh dn ni nj nk dp nl lr nm nn no lv np nq nr lz ns nt nu iz bi translated">用负二项式代替泊松</h2><p id="5027" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">解决模型中过度分散的另一种方法是将我们的分布假设改为<a class="ae lh" href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" rel="noopener ugc nofollow" target="_blank">负二项式</a>，其中<strong class="lk jd">的方差大于均值</strong>。</p><p id="0b04" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们在r中实现负二项模型。</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="2d6e" class="mw mx it ms b gy my mz l na nb">## R code<br/>library(MASS)<br/>nb_mod = glm.nb(Species ~ .,data = gala)<br/>summary(nb_mod)</span></pre><p id="ba25" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这产生了，</p><pre class="ks kt ku kv gt mr ms mt mu aw mv bi"><span id="5ead" class="mw mx it ms b gy my mz l na nb">Call:<br/>glm.nb(formula = Species ~ ., data = gala, init.theta = 1.674602286, <br/>    link = log)<br/><br/>Deviance Residuals: <br/>    Min       1Q   Median       3Q      Max  <br/>-2.1344  -0.8597  -0.1476   0.4576   1.8416  <br/><br/>Coefficients:<br/>              Estimate Std. Error z value Pr(&gt;|z|)    <br/>(Intercept)  2.9065247  0.2510344  11.578  &lt; 2e-16 ***<br/>Area        -0.0006336  0.0002865  -2.211 0.027009 *  <br/>Elevation    0.0038551  0.0006916   5.574 2.49e-08 ***<br/>Nearest      0.0028264  0.0136618   0.207 0.836100    <br/>Scruz       -0.0018976  0.0028096  -0.675 0.499426    <br/>Adjacent    -0.0007605  0.0002278  -3.338 0.000842 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>(Dispersion parameter for Negative Binomial(1.6746) family taken to be 1)<br/><br/>    Null deviance: 88.431  on 29  degrees of freedom<br/>Residual deviance: 33.196  on 24  degrees of freedom<br/>AIC: 304.22<br/><br/>Number of Fisher Scoring iterations: 1<br/><br/><br/>              Theta:  1.675 <br/>          Std. Err.:  0.442 <br/><br/> 2 x log-likelihood:  -290.223</span></pre><p id="8778" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它更符合数据，因为偏离度与自由度之比仅略大于1。</p><h2 id="e9de" class="mw mx it bd nf ng nh dn ni nj nk dp nl lr nm nn no lv np nq nr lz ns nt nu iz bi translated">结论</h2><p id="2fb3" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated"><strong class="lk jd">答:</strong>过度分散会影响泊松模型的解释。</p><p id="7b56" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> B. </strong>为了避免我们模型中的过度分散问题，我们可以使用一个拟族来估计分散参数。</p><p id="3efc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> C. </strong>我们也可以用负二项式代替泊松模型。</p><h2 id="3ac5" class="mw mx it bd nf ng nh dn ni nj nk dp nl lr nm nn no lv np nq nr lz ns nt nu iz bi translated">参考资料:</h2><p id="0ece" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated"><a class="ae lh" href="https://biometry.github.io/APES/LectureNotes/2016-JAGS/Overdispersion/OverdispersionJAGS.pdf" rel="noopener ugc nofollow" target="_blank">https://biometry . github . io/APES/lecture notes/2016-JAGS/over dispersion/over dispersion jags . pdf</a></p><p id="bb94" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">远方，Julian J. <em class="mn">用R扩展线性模型:广义线性、混合效应和非参数回归模型</em>。CRC出版社，2016。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oa"><img src="../Images/2c21d0635bf45ebffbb6507de27de1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bXRhd7RwrxYcxjtA"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@sm83?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Peter Scherbatykh </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>