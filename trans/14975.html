<html>
<head>
<title>Visualization with Plotly.Express: Comprehensive guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly可视化。快递:综合指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualization-with-plotly-express-comprehensive-guide-eb5ee4b50b57?source=collection_archive---------3-----------------------#2020-10-15">https://towardsdatascience.com/visualization-with-plotly-express-comprehensive-guide-eb5ee4b50b57?source=collection_archive---------3-----------------------#2020-10-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="157a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个数据集和70多个图表。交互性和动画通常出现在一行代码中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7ce99d60629b0bcf236ff3f42b2b0f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kg2I596jLv0JonyrHy9Jiw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本文中的所有图片均由作者创作，图片属于本<a class="ae ky" href="https://about.canva.com/license-agreements/onedesign/" rel="noopener ugc nofollow" target="_blank">许可</a>。</p></figure><p id="f2b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我经常想出一个理想的形象，然后努力编码。这将是中肯的，富有表现力的，易于解释，但它是不可能创造的。当我发现Plotly时，它使绘图变得简单多了。</p><p id="8f88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://plotly.com/python/plotly-express/" rel="noopener ugc nofollow" target="_blank">阴谋地。Express </a>，在<a class="ae ky" href="https://medium.com/plotly/introducing-plotly-express-808df010143d" rel="noopener">版本4.0.0 </a>中首次引入，是Plotly API的一个高级抽象，经过优化可以完美地处理数据帧。这很好，虽然不是完美无缺。我认为最大的差距在于API文档的例子或链接的数量。这就是为什么我决定用我在图书馆的经历来写一本指南。</p><p id="b343" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行图表和练习，请使用Github上的<a class="ae ky" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Comperhansive%20Guide/Plotly%20Express%20-%20Comprehensive%20Guide.ipynb" rel="noopener ugc nofollow" target="_blank">plot ly Express-Comprehensive guide . ipynb</a>笔记本。本文中的所有代码都是用python编写的。</p><p id="289c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目录:</p><ul class=""><li id="e623" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="#79e0" rel="noopener ugc nofollow">安装</a> —和依赖关系</li><li id="5596" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#c162" rel="noopener ugc nofollow">阴谋地。快速语法—一行代码</a></li><li id="7b9a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#ec6e" rel="noopener ugc nofollow">数据至关重要</a> —我们应该将数据预处理成宽格式还是长格式？</li><li id="f223" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#41cc" rel="noopener ugc nofollow">折线图</a> —用于简单介绍，了解我们可以选择的输入数据和参数，以定制图表</li><li id="54b9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#6899" rel="noopener ugc nofollow">布局</a> —模板和样式</li><li id="6036" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#909a" rel="noopener ugc nofollow">注释</a> —帮助你描述数据</li><li id="23f8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">图表类型— <a class="ae ky" href="#2074" rel="noopener ugc nofollow">散点图</a>、<a class="ae ky" href="#dd02" rel="noopener ugc nofollow">柱状图</a>、<a class="ae ky" href="#8723" rel="noopener ugc nofollow">柱状图</a>、<a class="ae ky" href="#761c" rel="noopener ugc nofollow">饼图</a>、<a class="ae ky" href="#2de5" rel="noopener ugc nofollow">甜甜圈</a>、<a class="ae ky" href="#d83e" rel="noopener ugc nofollow">旭日图</a>、<a class="ae ky" href="#b12c" rel="noopener ugc nofollow">树状图</a>，带<a class="ae ky" href="#fb3e" rel="noopener ugc nofollow"> choropleth的地图</a>，</li><li id="acf4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#f38e" rel="noopener ugc nofollow">交互</a> —改变图表的按钮</li><li id="4133" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#2714" rel="noopener ugc nofollow">陷阱</a>——以及其他需要改进的地方</li><li id="eb16" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#0b2a" rel="noopener ugc nofollow">文件摘要</a></li></ul><h1 id="79e0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">安装Plotly Express</h1><p id="5194" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">普洛特利。Express是Plotly python包的常规部分，所以最简单的就是全部安装。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5ca9" class="nl mk it nh b gy nm nn l no np"># pip <br/>pip install plotly</span><span id="81f9" class="nl mk it nh b gy nq nn l no np"># anaconda<br/>conda install -c anaconda plotly</span></pre><p id="1834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly Express还要求安装pandas，否则当你尝试导入时会得到这个错误。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="3c00" class="nl mk it nh b gy nm nn l no np">[In]: import plotly.express as px<br/>[Out]: <strong class="nh iu">ImportError</strong>: Plotly express requires pandas to be installed.</span></pre><p id="ea2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在Jupyter笔记本中使用plotly，还有其他要求。对于Jupyter实验室你需要<code class="fe nr ns nt nh b"><a class="ae ky" href="https://plotly.com/python/getting-started/#jupyterlab-support-python-35" rel="noopener ugc nofollow" target="_blank">jupyterlab-plotly</a></code>。在普通笔记本上，我必须安装<code class="fe nr ns nt nh b">nbformat</code> ( <code class="fe nr ns nt nh b">conda install -c anaconda nbformat</code>)</p><h1 id="c162" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Plotly Express语法—一行代码</h1><p id="dca9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">普洛特利。Express提供了创建多种图表类型的速记语法。每个都有不同的参数，理解参数是Plotly的关键。表达魅力。你可以用一个命令创建大多数图表(许多广告商说一行，但由于<a class="ae ky" href="https://www.python.org/dev/peps/pep-0008/#maximum-line-length" rel="noopener ugc nofollow" target="_blank"> PEP8 </a>建议每行最多79个字符，所以通常会更长)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/302235adea301ec2c44375bfe3add9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TgkADG5_0x1gEwGt4Cx1w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="9c12" class="nl mk it nh b gy nm nn l no np">import plotly.express as px</span><span id="0772" class="nl mk it nh b gy nq nn l no np"># syntax of all the plotly charts<br/>px.chart_type(df, parameters)</span></pre><p id="22b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用Plotly创建图表。只表达你的类型<code class="fe nr ns nt nh b">px.chart_type</code>(后面会介绍很多类型<a class="ae ky" href="#dd02" rel="noopener ugc nofollow"/>)。这个函数用你的数据<code class="fe nr ns nt nh b">df</code>和图表的参数消耗一个数据帧。一些参数是图表特定的，但大多数情况下您输入<code class="fe nr ns nt nh b">x</code>和<code class="fe nr ns nt nh b">y</code>值(或<code class="fe nr ns nt nh b">names</code>和<code class="fe nr ns nt nh b">values</code>，例如在<a class="ae ky" href="#761c" rel="noopener ugc nofollow">饼状图</a>的情况下)。您用<code class="fe nr ns nt nh b">text</code>标记数据点，并通过<code class="fe nr ns nt nh b">color</code>、<code class="fe nr ns nt nh b">dash</code>或<code class="fe nr ns nt nh b">group</code>将其分成不同的类别(单独的线条、条形、饼图的扇形)。其他参数让你影响颜色，分裂为支线剧情(刻面)，自定义工具提示，轴的规模和范围，并添加动画。</p><p id="6ce6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数情况下，您将绘图分配到一个变量中，以便可以影响图形元素和布局的设置。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="327f" class="nl mk it nh b gy nm nn l no np">fig = px.chart_type(df, parameters)<br/>fig.update_layout(layout_parameters or add annotations)<br/>fig.update_traces(further graph parameters)<br/>fig.update_xaxis() # or update_yaxis<br/>fig.show()</span></pre><h1 id="b360" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">数据集</h1><p id="dde8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">尽管plotly附带了一些集成的数据集，但它们在许多现有的例子中使用过，所以我选择了我最喜欢的数据集，关于去每个国家旅游的<a class="ae ky" href="https://data.worldbank.org/indicator/ST.INT.ARVL" rel="noopener ugc nofollow" target="_blank">游客的数量</a>和他们在度假中花费的<a class="ae ky" href="https://data.worldbank.org/indicator/ST.INT.RCPT.CD" rel="noopener ugc nofollow" target="_blank">钱</a>。世界银行通过<a class="ae ky" href="https://datacatalog.worldbank.org/public-licenses#cc-by" rel="noopener ugc nofollow" target="_blank"> CC-BY 4.0许可</a>提供该数据集。</p><p id="0f2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与每个数据集一样，即使是这个数据集也需要一些预处理。关于旅游数据集，令人非常恼火的是，它将每个国家的值与地区总量混合在一起。预处理很简单(<a class="ae ky" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Preprocess/Preprocessing.ipynb" rel="noopener ugc nofollow" target="_blank">见代码</a>)，重要的是数据集以一种广泛的形式出现。</p><h1 id="ec6e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">数据很重要(宽而长的数据帧)</h1><p id="1e96" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">所有数据帧都可以转换成多种形式。数据表可以是<strong class="lb iu">宽</strong>多列存储信息，也可以是<strong class="lb iu">长</strong>多行存储数据。幸运的是python和pandas库允许在它们之间轻松转换，使用<code class="fe nr ns nt nh b"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.T.html" rel="noopener ugc nofollow" target="_blank">DataFrame.T</a></code>将行转换成列，<code class="fe nr ns nt nh b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank">melt()</a></code>将列融合成长数据帧，<code class="fe nr ns nt nh b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.pivot.html" rel="noopener ugc nofollow" target="_blank">pivot()</a></code>和<code class="fe nr ns nt nh b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.pivot_table.html" rel="noopener ugc nofollow" target="_blank">pivot_table()</a></code>做相反的事情。Nicolas Kruchten在他的<a class="ae ky" href="https://medium.com/plotly/beyond-tidy-plotly-express-now-accepts-wide-form-and-mixed-form-data-bdc3e054f891" rel="noopener">Beyond“tidy”</a>文章中解释得很好，所以我不会在这里花更多的时间讨论它。还可以在<a class="ae ky" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Comperhansive%20Guide/Plotly%20Express%20-%20Comprehensive%20Guide.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上看到评论笔记本里的所有数据操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d65c6e8821d59439f181d78c48b5afdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJDJHlgeujrn4MGbTT5gZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">宽长数据格式的相同数据帧(图片由作者提供)</p></figure><p id="4a33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">普洛特利。Express最适合长数据。它被设计成接受一列作为参数。分类列影响元素(线条、条形等)，可以通过样式来区分，而值列影响元素的大小，可以显示为标签和工具提示。</p><h2 id="cbe0" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">广泛数据的有限可能性</h2><p id="fffd" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您也可以使用Plotly express处理大量数据，但是使用案例有限。让我们来探索一下您可以对宽数据集及其限制做些什么。</p><p id="d057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有图表的第一个参数几乎相同— <code class="fe nr ns nt nh b">the dataset</code>、<code class="fe nr ns nt nh b">x</code>和<code class="fe nr ns nt nh b">y</code>。x和y可以是dataframe、<code class="fe nr ns nt nh b"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html" rel="noopener ugc nofollow" target="_blank">padnas.Series</a></code>或数组中的列名。我们的旅游数据集有很多列。因为我们将<code class="fe nr ns nt nh b">years</code>作为列，将<code class="fe nr ns nt nh b">Country Names</code>作为行，所以我们使用<code class="fe nr ns nt nh b"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.T.html" rel="noopener ugc nofollow" target="_blank">pandas.DataFrame.T</a></code>在它们之间切换。Express API使用列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d6b327d32c81c0270e4862ad3730a8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVxunXLvKKSYzS7OM98r0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用熊猫切换行和列。DataFrame.T(图片由作者提供)</p></figure><p id="025c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面，三种绘制图表的方法是等价的。自己查，但我觉得第一条最有道理。如果使用列或系列，其名称将显示为轴标签，而对于数组，您必须手动添加标签。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="27f2" class="nl mk it nh b gy nm nn l no np">"""our dataset comes as a wide dataset with years as column. To turn the country names into the columns, we must set them as index and transpose the frame."""<br/>country_columns = year_columns.set_index("Country Name").T</span><span id="0bbf" class="nl mk it nh b gy nq nn l no np"># 1. I had to reshape the data by transposing<br/>px.line(country_columns<br/>        ,y="Spain"<br/>        ,title="Visitors to Spain")</span><span id="27fc" class="nl mk it nh b gy nq nn l no np"># 2. you can specify the value as pandas.Series as well<br/>px.line(country_columns, <br/>        y=country_columns["Spain"],<br/>       title="Visitors to Spain")</span><span id="d7a6" class="nl mk it nh b gy nq nn l no np"># 3. or any array. In this case you must specify y-label. <br/>px.line(country_columns, <br/>        y=country_columns["Spain"].to_list(), <br/>        labels={"y":"Spain"},<br/>       title="Visitors to Spain")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/315c8b6ff675210ed2fe910353f7f2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCop3spZqc1j2VVl1xBUIg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">px.line(df，y="column_name "，title="…")创建的最简单的折线图。作者图片</p></figure><blockquote class="og oh oi"><p id="1ac5" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">拥有一个包含几个描述性列<code class="fe nr ns nt nh b"><em class="it">Country Name</em></code>、<code class="fe nr ns nt nh b"><em class="it">Country Code</em></code>、<code class="fe nr ns nt nh b">Region</code>的数据集，并与数据列(如<code class="fe nr ns nt nh b"><em class="it">1995</em></code>、<code class="fe nr ns nt nh b"><em class="it">1996</em></code> — <code class="fe nr ns nt nh b"><em class="it">2018</em></code>中的访问次数)混合，显示了Plotly的一个好处。聪明的做法是只考虑有值的列，忽略其余的。</p></blockquote><p id="2cda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以轻松地在图表中选取多个列。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="ff91" class="nl mk it nh b gy nm nn l no np">px.line(country_columns, y=["Spain","Italy","France"])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/9731eba54612eb42fcbf402022ec9de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S80OkhDUF2fGTR_9fukWpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您可以轻松地向图表中添加多列。作者图片</p></figure><h2 id="dce3" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">宽数据框的限制</h2><p id="1513" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在Plotly中，您可以对包含许多列的数据集进行一些操作，但该库的真正强大之处在于长数据。<strong class="lb iu">原因</strong>，大部分参数恰好接受一列。它可以有几个不同的(通常是分类的)值，并对它们施展魔法，但不能有一个以上的列。以下代码导致了一个错误:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="17bf" class="nl mk it nh b gy nm nn l no np">[In]:<br/>try: <br/>  px.line(country_columns, y=["Spain","Italy","France"], <br/>          # trying to label the line with text parameter<br/>          <strong class="nh iu">text=["Spain","Italy","France"]</strong>)</span><span id="6601" class="nl mk it nh b gy nq nn l no np">except Exception as e:<br/>  print(e)</span><span id="c37d" class="nl mk it nh b gy nq nn l no np">[Out]: <strong class="nh iu">All arguments should have the same length. The length of argument `wide_cross` is 25, whereas the length of  previously-processed arguments ['text'] is 3</strong></span></pre><p id="5062" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以尝试选择其中一列，但结果是彻底失败。意大利和法国的折线图，标注了西班牙的游客数量。一场灾难。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="4175" class="nl mk it nh b gy nm nn l no np">px.line(country_columns, y=["Spain","Italy","France"], <br/>                text="Spain")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eaf61a19bf4f36960bac56a768da9c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5APYFv6EnJfX2lbLrXZFA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">因为所有列都有相同的行数，所以可以用来自西班牙列的文本来注释法国和意大利的值。(图片作者，<a class="ae ky" href="https://about.canva.com/license-agreements/onedesign/" rel="noopener ugc nofollow" target="_blank">图片授权</a>)</p></figure><h2 id="214b" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">长数据Metled数据框架</h2><p id="6040" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">普洛特利没有错。要利用这些参数，您必须使用长数据框。从广泛的数据集中，使用<code class="fe nr ns nt nh b">.melt()</code>函数得到它。我还将只过滤3个国家，以免图表过于拥挤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/59f5f3782f839f3999b8e6c4660cb34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*vGIimPQM0X1npqucpX7DOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">融化数据帧，使其在一列(或多列)中包含类别，在一列中包含值，这样您就可以利用plotly的参数。作者图片</p></figure><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="2dc1" class="nl mk it nh b gy nm nn l no np">spfrit = melted_df[melted_df["Country Name"].isin(["Spain","Italy","France"])]</span><span id="8cb8" class="nl mk it nh b gy nq nn l no np">px.line(spfrit, <br/>        <strong class="nh iu">x</strong>="years", <br/>        <strong class="nh iu">y</strong>="visitors", <br/>        <strong class="nh iu">color</strong>="Country Name", <br/>        <strong class="nh iu">text</strong>="visitors",<br/>       title="International Visitors")</span></pre><p id="2f0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为每个参数指定一列，让plotly确定其余的参数:</p><ul class=""><li id="6c05" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">x</code> — x轴包含来自<code class="fe nr ns nt nh b">year</code>列的所有不同值(1995年至2018年)</li><li id="3553" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">y </code> — y轴覆盖从<code class="fe nr ns nt nh b">visitors</code>栏开始的整个范围</li><li id="4191" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">color</code> —将三种不同的颜色设置为<code class="fe nr ns nt nh b">Country Name</code>列中的不同值(法国、意大利和西班牙)</li><li id="4af7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">text</code> —给每一行标上每年的访客数量</li></ul><h1 id="354e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">折线图</h1><p id="280e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我们探索一下基本的折线图，看看使用Plotly可以多么容易地创建可视化效果。每个Plotly的图表都记录在几个地方:</p><ul class=""><li id="0882" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">图表类型页面-例如Python中的<a class="ae ky" href="https://plotly.com/python/line-charts/" rel="noopener ugc nofollow" target="_blank">折线图</a>-显示最常见的示例</li><li id="034a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Python API参考——例如<a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.line.html" rel="noopener ugc nofollow" target="_blank">express . line</a>——描述您可以使用的所有参数</li></ul><p id="d015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一节中，您已经看到折线图需要有三种形式的<code class="fe nr ns nt nh b">x</code>和<code class="fe nr ns nt nh b">y</code>值，但是对于Express来说最常见的是使用列名来指定哪个数据框的列控制图形的功能。</p><h2 id="4fee" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated"><strong class="ak">折线图参数颜色、虚线、分组</strong></h2><p id="ca50" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><code class="fe nr ns nt nh b">color</code> —是许多图表类型的关键参数。它将数据分成不同的组，并给它们分配不同的颜色。每个组构成一个元素，在折线图中，它是一条单独的线。除非使用以下参数设置确切的颜色，否则颜色将被分配给每一行。</p><p id="4f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b"><strong class="lb iu">color_discrete_sequence </strong></code> —选择线条的预定义颜色，如<code class="fe nr ns nt nh b">color_discrete_sequence = ["red","yellow"]</code>。如果您提供的颜色少于您的系列数量，Plotly将自动分配剩余的颜色。</p><p id="bc43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b"><strong class="lb iu">color_discrete_map </strong></code> —允许同上，但以字典的形式为特定系列分配颜色。<code class="fe nr ns nt nh b">color_discrete_map = {"Spain":"Black"}</code>。</p><p id="17d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b"><strong class="lb iu">line_dash</strong></code> <strong class="lb iu"> </strong> —与<code class="fe nr ns nt nh b">color</code>类似，只是改变了破折号的图案而不是颜色</p><p id="48bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b"><strong class="lb iu">line_group</strong></code> —类似于颜色，用于区分分隔线条的值(类别)，但在这种情况下，所有线条都将具有相同的颜色，并且不会为它们创建图例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cc107241d49c9bc3a4a222d111324fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tansMeW4fPMGaPENoLTOYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="da8d" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">工具提示</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/f285134dc8694bad957c5973540d4ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1vI95RyYZ_PxALb02FdBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可以在交互式菜单上切换最近工具提示和比较工具提示。作者图片</p></figure><p id="4378" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly固有地带来了交互式工具提示。上面你可以看到你可以在最近的和所有的数据工具提示之间切换。还有一些参数可以进一步定制这些文本框— <code class="fe nr ns nt nh b">hover_name</code>在工具提示的顶部突出显示该列的值。<code class="fe nr ns nt nh b">hover_data</code>允许<code class="fe nr ns nt nh b">True/False</code>出现在工具提示上的类别或值。<code class="fe nr ns nt nh b">labels</code> param让你重命名这些类别。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/fbada8a9b2d80661072a7191f1f3b33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Kj5T3ZuQuhkRz6M2nvzaXA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">操作工具提示的选项。作者图片</p></figure><h2 id="6162" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">其他有用的参数</h2><p id="84ca" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们为每个国家创建了3条不同颜色的线。将<code class="fe nr ns nt nh b">color</code>参数更改为<code class="fe nr ns nt nh b">facet_col</code>或<code class="fe nr ns nt nh b">facet_row</code>以创建3个独立的图表。保持<code class="fe nr ns nt nh b">facet</code>和<code class="fe nr ns nt nh b">color</code>确保每条线有不同的颜色。不然也一样。你可以放大其中一幅图，其他的也会放大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1c4e4e9d5514e9dc91f5c4cae7e2e8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9GdAls6b5XIO4BZcrGjOA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将多面图表分成行或列。作者图片</p></figure><blockquote class="og oh oi"><p id="0bdb" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">分面<strong class="lb iu">支线剧情</strong>也是用Plotly.Express创建支线剧情的唯一方法。不幸的是，你不能用Express在条形图顶部创建一个线形图。你需要Plotly的底层API。</p></blockquote><p id="ec0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b">range_x</code>和<code class="fe nr ns nt nh b">range_y</code>参数允许放大图表。您可以随时使用交互式控制器查看全部数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/36c323c9b22b3127564fe381e72fd1b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*jLm-Lvem6YJijRW93mxYRQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您可以设定默认放大，因为交互式控制器允许您更改它。作者图片</p></figure><p id="3fcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置为<code class="fe nr ns nt nh b">True</code>的<code class="fe nr ns nt nh b">log_x</code>和<code class="fe nr ns nt nh b">log_y</code>将改变这些轴在笛卡尔坐标中的对数比例。</p><h2 id="0d13" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">动画片</h2><p id="ae84" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">最后，我们得到了制造plotly的参数。表达流行。<strong class="lb iu">动画</strong>。参数<code class="fe nr ns nt nh b"><strong class="lb iu">animation_frame</strong></code> <strong class="lb iu"> </strong>指向用于区分动画帧的列。我不得不稍微更新数据集来创建这个动画。列<code class="fe nr ns nt nh b">years_upto</code>包含了所有的历史数据。有关更多信息，请参见github上的笔记本。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c05e" class="nl mk it nh b gy nm nn l no np">year_upto   year country visitors<br/>1995        1995 ESP     30M<br/>1996        1995 ESP     30M<br/>1996        1996 ESP     33M<br/>1997        1995 ESP     30M<br/>1997        1996 ESP     33M<br/>1997        1997 ESP     37M</span><span id="b248" class="nl mk it nh b gy nq nn l no np"># then I use `year_upto` as the animation_frame parameter<br/>px.line(spfrit, <br/>        x="years", <br/>        y="visitors", <br/>        color="Country Name",<br/>        title="International Visitors",<br/>        range_x=[1995, 2018],<br/>        range_y=[25000000,90000000],<br/>        <strong class="nh iu">animation_frame="year_upto"</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/a1eeb7a7787502be4a0b9a9317ee6717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*dPgKgB5-qQ_o4eYaClU4Wg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用animation_frame参数的动画。作者图片</p></figure><h1 id="6899" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">布局和风格</h1><p id="439c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在我们开始介绍各种Plotly图表类型之前，让我们先探讨一下如何更新轴、图例、标题和标签的基本技巧。Plotly准备了一个<a class="ae ky" href="https://plotly.com/python/styling-plotly-express/" rel="noopener ugc nofollow" target="_blank">样式指南</a>，但是许多图表类型只允许一些样式选项，这些选项很难从文档中找到。</p><blockquote class="og oh oi"><p id="011b" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">每一张图都是一本字典</p></blockquote><p id="145f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在背景上，每个图形都是一本字典。您可以将图表存储到一个变量中，通常是<code class="fe nr ns nt nh b">fig</code>，并使用<code class="fe nr ns nt nh b">fig.to_dict()</code>显示这个字典。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c1d7" class="nl mk it nh b gy nm nn l no np">[In]: fig.to_dict()<br/>[Out]:<br/>{'data': [{'hovertemplate': 'index=%{x}&lt;br&gt;Spain=%{y}&lt;extra&gt;&lt;/extra&gt;',<br/>   'legendgroup': '',<br/>   'line': {'color': '#636efa', 'dash': 'solid'},<br/>   'mode': 'lines',<br/>...</span></pre><p id="717c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这一点，你可以使用3种方式更新图表。</p><ul class=""><li id="e2d6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">使用<code class="fe nr ns nt nh b">fig.udpate_layout()</code></li><li id="7272" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用特定参数，例如<code class="fe nr ns nt nh b">fig.update_xaxis()</code></li><li id="7146" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">通过改变背景字典</li></ul><p id="8bcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们中的每一个有时都很棘手，因为您必须真正钻研文档才能理解一些参数。每个参数可以用4种不同的方式更新。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="bf6b" class="nl mk it nh b gy nm nn l no np"># Four options how to update the x-axis title<br/># 1.and 2. using update_layout<br/>fig.update_layout(xaxis_title="X-axis title",<br/>                  xaxis = {"title": "X-axis title"})</span><span id="7780" class="nl mk it nh b gy nq nn l no np"># 3. using update_xaxes<br/>fig.update_xaxes(title_text="X-axis title")</span><span id="68c2" class="nl mk it nh b gy nq nn l no np"># 4. by modifying the dictionary <br/>fig["layout"]["xaxis"]["title"]["text"] = "X-axis title"</span><span id="f33c" class="nl mk it nh b gy nq nn l no np"># in the end you show the plot <br/>fig.show()</span></pre><h2 id="dea9" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">模板</h2><p id="556e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">设置图表样式最简单的方法是使用预定义的模板。Plotly带有几个内置模板，包括plotly_white、plotly_dark、ggplot2、seaborn，或者您可以创建自己的模板。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/4156e2db2c5cfc8c0fb279b48371c6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VemsjNWhmymKgAZNUVxWPQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly _黑暗主题。作者图片</p></figure><h2 id="4506" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">亚西斯和克西斯</h2><p id="a820" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们可以逐个更新其他参数。仅从二维笛卡尔轴的2D图表的轴上看，你有许多选择来改变什么(见plotly <a class="ae ky" href="https://plotly.com/python/reference/layout/yaxis/" rel="noopener ugc nofollow" target="_blank"> python </a>)。我们来看看最重要的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/410ff10bbcc38f2175b4b47a829efa2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGRKOhzkQnV4E4EDFh_D2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">x轴上显示的plotly轴的元素。作者图片</p></figure><ul class=""><li id="7f40" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">visibility</code> —轴是否可见</li><li id="0bcd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">color</code> —线条、字体、刻度和网格的所有元素</li><li id="dcaf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">title</code> —轴标题(参数:文本、字体、颜色、大小、间距)</li><li id="4640" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">type</code> —轴类型:线性、对数、日期、类别或多类别</li><li id="779a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">range</code> —轴的取值范围(<a class="ae ky" href="https://plotly.com/python/reference/layout/xaxis/#layout-xaxis-autorange" rel="noopener ugc nofollow" target="_blank">自动量程</a>，量程模式，量程)</li><li id="a6bf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">ticks</code> —记号和相应的网格线(记号模式、记号值、记号、记号角等)。)</li><li id="af4f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">spike</code>——在点和轴之间画的线</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3d2626025cda56a769c7156905550756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0rpTVAmWaCFHOr6rRAr6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何格式化轴刻度的各种选项。作者图片</p></figure><p id="dac4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">x轴的一个很酷的选项是范围滑块。您使用<code class="fe nr ns nt nh b">fig.update_xaxes(rangeslider_visible=True)</code>进行设置，它会突出显示您放大的那部分绘图。它对时间序列非常有用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/86ce00ff8957444956667cdd3795698c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*7z3sumFE61svch1_GYp5SA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">范围滑块让您了解缩放的位置。作者图片</p></figure><p id="dc99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">稍后，我将讨论刻度的一些陷阱以及类别和线性模式之间的区别，但是现在，让我们继续，看看另一个用于突出图表关键区域的重要特征。</p><h2 id="909a" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">释文</h2><p id="f078" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">将特定文本添加到图表中称为注释。注释有几个基本的用例:</p><ul class=""><li id="5b24" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">突出重点</li><li id="f01e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">描述/突出一个地区</li><li id="ffe9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">要标记所需的点</li><li id="39ec" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">而不是一个传说</li></ul><p id="ea1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在下图中展示所有4种做法。我们在图表外标注起点值，注释断点，放置一条关于旅游业增长的信息，并在其右端绘制图例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/a79b91554a8528a42814ca07aee48c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-W8Kyofup43AtCLeLbqMkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注释的4种不同用例。作者图片</p></figure><p id="f88e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的图表很棘手。Plotly按照出现的顺序排列线条，所以数据必须进行排序。还要表达一下从长数据帧中分配颜色有点困难(我知道我说的是长数据帧是理想的解决方案，它们不是100%)，所以我不得不施点小魔法，你可以研究这个要点或阅读<a class="ae ky" rel="noopener" target="_blank" href="/highlighted-line-chart-with-plotly-express-e69e2a27fea8">高亮线图</a>文章中的详细指南。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><blockquote class="og oh oi"><p id="a48a" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">您可能还会注意到，随着行数的增加，Plotly会自动切换到<a class="ae ky" href="https://en.wikipedia.org/wiki/WebGL" rel="noopener ugc nofollow" target="_blank"> WebGL格式</a>，这证明可以提高包含许多数据点的JavaScript绘图的可用性。</p></blockquote><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="f2d8" class="nl mk it nh b gy nm nn l no np">[In]: type(fig.data[0])<br/>[Out]: plotly.graph_objs._scattergl.Scattergl</span></pre><p id="05ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于注释，您有几个选项可以影响它们的位置。您在<code class="fe nr ns nt nh b">.fig.update_layout(..., annotations=[])</code>中将所有注释设置为一个列表，它包含一个指定标签参数的字典列表:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="853c" class="nl mk it nh b gy nm nn l no np">annotations = \<br/>[{"xref":"paper", "yref":"paper", "x":0, "y":0.15,<br/>  "xanchor":'right', "yanchor":"top",<br/>  "text":'7M',<br/>  "font":dict(family='Arial', size=12, color="red"),<br/>  "showarrow":False}, ... other annotations ...]</span></pre><p id="df6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以指定标签和数据点之间的位置、字体和箭头。文本的坐标<code class="fe nr ns nt nh b">x</code>和<code class="fe nr ns nt nh b">y</code>既可以指向绘图，也可以指向画布。<code class="fe nr ns nt nh b">"xref"="paper"</code> <code class="fe nr ns nt nh b">(0,0)</code>是绘图区的左下角，<code class="fe nr ns nt nh b">(1,1)</code>是右上角。在图表中，您使用轴上的<code class="fe nr ns nt nh b">x</code>和<code class="fe nr ns nt nh b">y</code>值进行引用(例如2008年和10_000_000访问者)。</p><p id="534d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">位置还取决于<code class="fe nr ns nt nh b">anchor</code>(上-中-下、左-中-右)、偏移和调整。可以通过设置字体来修改每个注释，或者可以在文本上应用HTML标签，如<code class="fe nr ns nt nh b">&lt;b&gt;</code>或<code class="fe nr ns nt nh b">&lt;i&gt;</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/458372bf41d9a239979e835930823773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YTTyQjQClYpoDgC4UmSw5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly表示注释位置和其他参数。作者图片</p></figure><h1 id="dd02" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">条形图</h1><p id="03f9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在，当我们知道如何创建一个图表，更新其布局，并包括注释，让我们探索另一个典型的图表类型。我们将从条形图开始，这是另一种流行的显示趋势和比较类别数据的方法。语法保持不变，只有一行代码:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="047f" class="nl mk it nh b gy nm nn l no np">px.bar(df, parameters)</span></pre><p id="668a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.bar.html" rel="noopener ugc nofollow" target="_blank">条形图API文档</a>描述了所有参数。大多数参数与折线图的参数相同。</p><h2 id="bd13" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">酒吧模式</h2><p id="a17d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">条形图有三种模式。<code class="fe nr ns nt nh b">Relative</code>将条形堆叠在一起。<code class="fe nr ns nt nh b">overlay</code>以较低的不透明度在彼此的顶部绘制线条，而<code class="fe nr ns nt nh b">group</code>用于聚集的列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fbfbcb44d245b7e90686bd1a58f227e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HydJAFhHv-ZOMwvfHxHdUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不同的条形码具有相同的数据。作者图片</p></figure><h2 id="d345" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">颜色；色彩；色调</h2><p id="cc12" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">像线条一样，线条也可以着色，以产生视觉冲击力。您可以使用<code class="fe nr ns nt nh b">color</code>参数设置为一个类别(如国家名称)用调色板中的不同颜色给每个条着色，或将颜色设置为一个值(如游客)以区分游客参观的规模。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d5779c77a5d8ba7af77e833e39141f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_5apJ0QmStADwvuuVlfgQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">颜色参数的不同应用。您可以在标尺上区分类别或值。作者图片</p></figure><p id="8998" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe nr ns nt nh b">color_discrete_sequence</code>所有的条可以有相同的颜色，你可以根据规模应用不同的颜色——在我们的例子中使用<code class="fe nr ns nt nh b">color_continuous_scale</code>的访问者数量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/de6d2876393af97a8a3b07789c3737e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gELqU9Zoh10xRuc4lHhrDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单色条形图或色标。上面的图显示了2018年前20个最受欢迎的国家，下面的图显示了前25名，其余的则堆积在其他列中。代码见笔记本。作者图片</p></figure><h2 id="421d" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">组合线条条形图</h2><p id="d483" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有一件事很神秘。在组合类型的图表中，快速真的很糟糕。您可以在折线图中添加条形，但不能反过来做。而结果呢，是啊，自己拿主意。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/063d4d5c429d3131953a741bae2942b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Dw723Z3awgSkeDbMhiFDw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">plotly中的组合图表。表达是一种痛苦。作者图片</p></figure><blockquote class="og oh oi"><p id="8e9f" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">如果你想用一些混合类型的图形，使用Plotly的低级API。这比Express能做的更多，但是代码更长。</p></blockquote><h2 id="1284" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">动画条形图</h2><p id="6566" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">参数<code class="fe nr ns nt nh b">animation_frame</code>让你做动画魔术。但闪光的不全是金子。你必须为所有帧设置相同的范围[0-100米]，但图表仍在跳动，因为尽管y轴<code class="fe nr ns nt nh b">standoff</code>有足够的空间，较长的国家名称仍会移动图表。此外，在第二个动画帧上，原本在条形外部的标签进入了条形内部。这将需要更多的定制是完美的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/22ebb43c92532b5137fe17954cc38c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*fmOdSz06JVXHksRcDOhfhQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动画条形图显示每年前往十个最热门旅游国家的游客数量不断增长。作者图片</p></figure><h2 id="8723" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">柱状图</h2><p id="06aa" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">从技术上讲，直方图是一种没有间隔的条形图。直方图的强大之处在于，它自动将数据分成多个条块，并聚合每个条块中的值。但是它做得还不是很好。</p><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/histograms-with-plotly-express-complete-guide-d483656c5ad7"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">带Plotly Express的直方图:完整指南</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">一个数据集，60多个图表，以及所有解释的参数</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po ks pa"/></div></div></a></div><p id="ffeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直方图使用类似于条形图的参数。您可以使用<code class="fe nr ns nt nh b">color</code>按类别分割媒体夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/aff55951d8b1ac1f1a00f697ebf587cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxVle1lPyNS6bIHvMcbBBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每个柱状图都可以用颜色参数分成不同的类别。作者图片</p></figure><p id="77a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直方图也有自己的参数。<code class="fe nr ns nt nh b">nbins</code>影响箱柜数量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9a275c53efcdbc6b8af4c1a967154aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4FlHoYTeiSYDOMEp7puVlQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">nbins参数影响直方图的箱数。作者图片</p></figure><p id="8406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b">Histfunc</code>允许改变聚合函数。当然，当你在10和20之间的区间上做平均值、最小值或最大值时，这些值将位于这个范围内，所以这样的直方图将创建一个阶梯模式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0cb8c284c02ede42f9044c1f625f3267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sbkf6bNoSvbktTqW6vsgzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">除了计数和求和之外，其他历史函数创建了阶梯式模式。它们在分类直方图中有用例，分类直方图在技术上是一个规则的条形图。作者图片</p></figure><p id="5ced" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以通过设置<code class="fe nr ns nt nh b">cumulative=True</code>来创建累积直方图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/94804b9d1077323e18e83a0cc8af931b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtNO22d3cSUo4LL0MeuU4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">常规和累积直方图。作者图片</p></figure><p id="c741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b">Barnorm</code>让您将每个箱中的值标准化到0–100%之间。Barnorm参数在每个bin中归一化，因此值<code class="fe nr ns nt nh b">10, 40, 50</code>形成<code class="fe nr ns nt nh b">10%, 40% and 50%</code>，而<code class="fe nr ns nt nh b">100, 400 and 500</code>创建同样高度的图表也是<code class="fe nr ns nt nh b">10%, 40% and 50%</code>。您可以选择用<code class="fe nr ns nt nh b">barnorm="percentage"</code>显示百分比或用<code class="fe nr ns nt nh b">barnorm="fraction"</code>显示小数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fe07604d7a92569ad0163b9849ed1cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dE8EoGznKfIr78XCwhK3Fw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用于堆积直方图的Barnorm。作者图片</p></figure><p id="a34a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nh b">Histnorm</code>参数非常相似，但是归一化不是在一个仓内，而是针对所有仓中的每个类别。如果您的类别A在第一个bin中出现两次，在第二个bin中出现5次，在最后一个bin中出现3次，则histnorm将为<code class="fe nr ns nt nh b">20%, 50% and 30%</code>。</p><p id="c53e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直方图(和散点图)的特定参数是边际图。它可以让你创建一个小的侧图，显示底层变量的分布细节。有四种类型的边际图表— <code class="fe nr ns nt nh b">rug</code>、<code class="fe nr ns nt nh b">histogram</code>、<code class="fe nr ns nt nh b">box</code>和<code class="fe nr ns nt nh b">violin</code>创建具有相同名称的侧图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9d1cdc6ba9fde7f8cdb0ecf68fef29ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDi1XJaDmFjvEw2-j3Kkfw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">直方图的4个马丁戈尔支线图选项。作者图片</p></figure><p id="0c15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常情况下，您需要对宁滨进行更多的控制，您宁愿自己计算面元并使用<code class="fe nr ns nt nh b">px.bar</code>和<code class="fe nr ns nt nh b">fig.update_layout(bargap=0)</code>绘制它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4404a4fdb4e6d32268d4aae7fded889f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VAryN4NtbTvrfk6sseQzOQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用px.bar()创建的直方图。作者图片</p></figure><h2 id="761c" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">圆形分格统计图表</h2><p id="8d94" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">另一个实现可视化的方法是使用饼图。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="1949" class="nl mk it nh b gy nm nn l no np"># syntax is simple<br/>px.pie(df, parameters)</span></pre><p id="c71f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你阅读<a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.pie.html" rel="noopener ugc nofollow" target="_blank">文档</a>时，你会了解到饼状图没有<code class="fe nr ns nt nh b">x</code>和<code class="fe nr ns nt nh b">y</code>轴，只有<code class="fe nr ns nt nh b">names</code>和<code class="fe nr ns nt nh b">values</code>。</p><h2 id="3f17" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">拉派的痕迹</h2><p id="2859" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">其中一个很酷的事情是，你可以拉一些情节的片段来突出它们。它不是<code class="fe nr ns nt nh b">.pie()</code>的参数，但您可以使用<code class="fe nr ns nt nh b">fig.update_traces()</code>添加它。<code class="fe nr ns nt nh b">Text</code>轨迹的配置也允许将标签设置为百分比、值或标签(或三者的任意组合，例如<code class="fe nr ns nt nh b">fig.update_traces(textinfo="percent+label")</code>)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/12bf6e3548d6c2365a561a109db2f9ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pHpJSv5xq1OpJrclxJ-a7g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您可以快速更改看到的标签。作者图片</p></figure><h2 id="2de5" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">圆环图-孔参数</h2><p id="510e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">饼状图有点好玩，使用<code class="fe nr ns nt nh b">hole</code> param你可以把它变成一个圆环图。像所有以前的图表一样，当您与标签交互时，它会重新计算值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/c06eb7d7ffa5bf4095bc9bf1908fc127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*yZru0gQAvsXTH46qI86Kkg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">圆环图是一个带孔的饼图。作者图片</p></figure><h2 id="d83e" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">旭日图</h2><p id="9d3c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">与饼图非常相似的是旭日图。它可以显示几层数据。例如，在我们的情况下，一个区域和该区域的国家。当你点击任何一个“家长”时，你就会得到那个地区的详细信息。您可以通过输入<code class="fe nr ns nt nh b">names</code>、<code class="fe nr ns nt nh b">values</code>、<code class="fe nr ns nt nh b">parents</code>等创建情节，如下图所示:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5912" class="nl mk it nh b gy nm nn l no np">fig = px.sunburst(<br/>    chart_df,<br/>    path=['Region', 'Country'],<br/>    values='Visitors',<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/3852b925dd227dbd2d8cde6d15d64632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*H74llvUePu1bJWdDadcUuw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者在Plotly.Express. Image中的旭日剧情互动</p></figure><h2 id="b12c" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">树形图</h2><p id="c01c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果在显示大量数据时，饼图和旭日图难以阅读，那么树形图则正好相反。您可以使用颜色，并根据分类列分配离散刻度或连续刻度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ca3b6638684f8754fc4af6987566b6ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0pmQvRSUhVhktgc2Jlwdg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">树形图是显示大量数据之间关系的理想选择。作者图片</p></figure><h2 id="fb3e" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">Choropleth使用plotly绘制地图</h2><p id="fee9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们正在研究关于世界的数据，在如何显示这些数据方面，使用地图是一个显而易见的选择。Plotly支持显示地理空间数据，内置国家形状、区域范围以及调整颜色和其他参数的选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f23f694c347ff8a45c8c61802b91c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAkzyv4FcUt3leH6rA-XBw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">地理空间数据利用了Plotly的地图支持。作者图片</p></figure><blockquote class="og oh oi"><p id="1fd2" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">根据<a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.choropleth.html" rel="noopener ugc nofollow" target="_blank">文档，</a>国家由ISO-3代码、国家名称或美国州名识别。如果你想挖得更深，你必须得到你自己的地理坐标<code class="fe nr ns nt nh b">geojson</code>。</p></blockquote><h2 id="2074" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">散点图</h2><p id="9df5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">散点图是最常见的图类型之一。它们可以很容易地显示二维数据之间的关系，使用颜色和大小，您可以用更多的信息来包装您的可视化。然而，我们将从我们离开的地方开始。在<a class="ae ky" rel="noopener" target="_blank" href="/pythons-geocoding-convert-a-list-of-addresses-into-a-map-f522ef513fd6">地理</a>中使用<code class="fe nr ns nt nh b">scatter_geo</code>图形。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a157" class="nl mk it nh b gy nm nn l no np">fig = px.scatter_geo(<br/>    melted_df.fillna(0), <br/>    locations ="Country Code", <br/>    color="visitors",<br/>    size="visitors",<br/>    # what is the size of the biggest scatter point<br/>    size_max = 30,<br/>    projection="natural earth",<br/>    # range, important to keep the same range on all charts<br/>    range_color=(0, 100000000),<br/>    # columns which is in bold in the pop up<br/>    hover_name = "Country Name",<br/>    # format of the popup not to display these columns' data<br/>    hover_data = {"Country Name":False, "Country Code": False},<br/>    title="International Tourism",<br/>    animation_frame="years"<br/>                     )<br/>fig.update_geos(showcountries = True)<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/aa57f94b51b680647005c390380eabe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*fCl9zdv_1aKFsiuEAazeoQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">散点_地理图动画。作者图片</p></figure><p id="592e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的<code class="fe nr ns nt nh b">scatter_geo</code>参数是<code class="fe nr ns nt nh b">max_size</code>允许设置气泡的最大半径，以及<code class="fe nr ns nt nh b">opacity</code>确定多少绘图是可见的。</p><h2 id="6e4f" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">散点图</h2><p id="a85d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">常规散点图通常用于显示两个变量之间的关系。在我们的例子中，游客的数量和他们在这个国家的花费。我只关注2018年。<code class="fe nr ns nt nh b">size</code>参数影响气泡的大小，而<code class="fe nr ns nt nh b">color</code>参数允许您根据分类或连续变量设置颜色。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/8ba4a40362f81ce8100c2c560ecc6a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7nFrXvcX4k8mKSF4mdgcrg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本散点图，显示游客数量和他们的支出之间的关系。颜色区分每个区域。作者图片</p></figure><p id="3f3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">散点图允许很容易地添加边际图，以突出由<code class="fe nr ns nt nh b">color</code>参数指定的一个变量或几个变量的分布。您可以从4种边际地块中选择— <code class="fe nr ns nt nh b">box</code>、<code class="fe nr ns nt nh b">violin</code>、<code class="fe nr ns nt nh b">histogram</code>或<code class="fe nr ns nt nh b">rug</code>。您只需通过应用<code class="fe nr ns nt nh b">marginal_x</code>或<code class="fe nr ns nt nh b">marginal_y</code>参数，例如<code class="fe nr ns nt nh b">marginal_x=”rug”</code>，即可对其进行设置。您还可以在图表上为每种颜色绘制一条趋势线。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="8d32" class="nl mk it nh b gy nm nn l no np">px.scatter(df,<br/>          x="visitors",<br/>          y="receipts",<br/>          color="type",<br/>          hover_name="Country Name",<br/>          size="receipts",<br/>          <strong class="nh iu">marginal_x="histogram",<br/>          marginal_y="box",</strong><br/>          trendline="lowess",<br/>          title="Scatter plot with histogram and box marginal plot and two trendlines")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e44d9cead35a87ee5406a2b9ec97fbef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ar9bi46ezWMk8TU13dmZWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">散点图允许通过添加单个参数来添加4种边际图和趋势线。作者图片</p></figure><blockquote class="og oh oi"><p id="c512" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">要绘制趋势线，你需要安装<a class="ae ky" href="https://www.statsmodels.org/stable/install.html" rel="noopener ugc nofollow" target="_blank"> statsmodel </a>库</p></blockquote><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c61d" class="nl mk it nh b gy nm nn l no np">conda install -c anaconda statsmodels<br/># or<br/>pip install statsmodels</span></pre><p id="8a0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">借助<code class="fe nr ns nt nh b">statsmodels</code>库，您还可以显示用于计算趋势线的回归模型的参数。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="6ed1" class="nl mk it nh b gy nm nn l no np"># get the parameters via `get_trendline_results`<br/>res = px.get_trendline_results(fig)</span><span id="d4d1" class="nl mk it nh b gy nq nn l no np"># get the statsmodels data<br/>[In]:<br/>trendline = res["px_fit_results"].iloc[0]<br/>print(type(european_trendline))</span><span id="2468" class="nl mk it nh b gy nq nn l no np">[Out]: &lt;class 'statsmodels.regression.linear_model.RegressionResultsWrapper'&gt;</span><span id="4b8b" class="nl mk it nh b gy nq nn l no np"># print the summary<br/>trendline.summary()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/b1a495f73896282cad8af40e465c4214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*BYEQiv-W5CPhnLFFYgsGHQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly使用statsmodels来计算趋势线。您可以导出其参数。作者图片</p></figure><h1 id="f38e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">交互式按钮</h1><p id="2ea7" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Plotly的成功可以归功于交互功能。每个图表的右上角都包含一个菜单，可以进行放大和缩小等基本操作，当您将鼠标悬停在图表元素上时会出现什么工具提示，或者您可以通过单击将图保存为图像。</p><p id="537c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以添加交互式按钮(或下拉菜单),让用户改变图形的外观。您可以使用参数<code class="fe nr ns nt nh b">method</code>添加四种类型的动作:</p><ul class=""><li id="797c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">restyle</code> —影响数据或图表类型的外观和感觉</li><li id="ee9f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">relayout</code> —改变布局的属性</li><li id="9d47" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">update</code> —结合了上述两种方法</li><li id="5289" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nr ns nt nh b">animate</code> —允许控制动画特性</li></ul><p id="7dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在图表上放置几组按钮。它们可以并排排列(或上下排列)，也可以下拉排列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/dd445ef3b36026fa627af13e6de617e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*j3Utol-Unh16RnzsbpnxXw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Plotly按钮更改颜色和标签。作者图片</p></figure><h2 id="a3ae" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">相互作用</h2><p id="5ce1" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><a class="ae ky" href="https://plotly.com/python/custom-buttons/#methods" rel="noopener ugc nofollow" target="_blank">文档</a>展示了一些基本的交互，但是如果你计划做一些其他的事情，实现它是相当棘手的。最好的技巧是创建你想要达到的最终外观，使用<code class="fe nr ns nt nh b">fig.to_dict()</code>转储字典，并将字典的相关部分复制到按钮的<code class="fe nr ns nt nh b">arg[{...}]</code>中，例如:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="3776" class="nl mk it nh b gy nm nn l no np"># create the chart and export to dict<br/>px.bar(df, x="visitors", range_x=[0,10]).to_dict()</span><span id="e62e" class="nl mk it nh b gy nq nn l no np"># read the dict to find the relevant arguments for the update <br/># arg. xaxis.range of the relayout changes the x_range</span><span id="6892" class="nl mk it nh b gy nq nn l no np"> fig.update_layout(<br/>  updatemenus=[<br/>  dict(<br/>    buttons=list([<br/>      dict(<br/>        args=[{"xaxis.range":[-2,10],<br/>               "yaxis.range":[0,5.6]}],<br/>                label="x:right 1, y:bottom 0",<br/>                method="relayout", <br/>        )]),           <br/>        type="buttons",<br/>        showactive=True,<br/>        x=1,<br/>        xanchor="right",<br/>        y=0,<br/>        yanchor="bottom"<br/>    )])</span><span id="382f" class="nl mk it nh b gy nq nn l no np"># see the full example on github for more ideas</span></pre><blockquote class="og oh oi"><p id="80a0" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">查看<a class="ae ky" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Comperhansive%20Guide/Plotly%20Express%20-%20Comprehensive%20Guide.ipynb" rel="noopener ugc nofollow" target="_blank"> github </a>笔记本，了解更多关于如何使用按钮的想法，或者探索<a class="ae ky" href="https://plotly.com/python/custom-buttons/#methods" rel="noopener ugc nofollow" target="_blank"> Plotly文档</a>中的示例。</p></blockquote><p id="da4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我成功地更改了标签、颜色和范围，但未能更改输入值(如更改源数据)。</p><h2 id="bc0a" class="nl mk it bd ml nu nv dn mp nw nx dp mt li ny nz mv lm oa ob mx lq oc od mz oe bi translated">按钮的位置</h2><p id="c5a4" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您可以使用坐标系将按钮放置在绘图区的四周，其中x: 0，y: 0是图表的左下角(一些像饼图这样的绘图不会填充整个区域)。您也可以将<code class="fe nr ns nt nh b">xanchor</code>和<code class="fe nr ns nt nh b">yanchor</code>设置为左-中-右或上-中-下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f16373030ecdb73ccb34f5f5bcdb1fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpXaxb7brrh9x9fy0yioOw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图形按钮的位置、背景颜色和按钮组。作者图片</p></figure><blockquote class="og oh oi"><p id="beee" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">单击按钮有时会改变它们的位置</p></blockquote><p id="32d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<code class="fe nr ns nt nh b">pad={"r": 10, "t": 10}</code>微调位置。这些值以像素为单位，您可以填充<code class="fe nr ns nt nh b">r</code>-右、<code class="fe nr ns nt nh b">l</code>-左、<code class="fe nr ns nt nh b">t</code>-上、<code class="fe nr ns nt nh b">b</code>-下。您还可以更改按钮的字体和颜色。</p><h1 id="475a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">导出Plotly</h1><p id="ce94" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您可以将生成的图表导出为一个交互式HTML页面，让您完成所有的绘图魔术，如缩放、打开/关闭数据或查看工具提示。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="edf5" class="nl mk it nh b gy nm nn l no np">fig.write_html(f"{file_name}.html")</span></pre><p id="66d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以指定几个参数，指定是否包含3MB·普洛特利. js，动画是否在打开时启动，或者html文档的结构如何— <a class="ae ky" href="https://plotly.github.io/plotly.py-docs/generated/plotly.io.write_html.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="3b82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用<code class="fe nr ns nt nh b">.write_image()</code>将图像导出为<strong class="lb iu">静态图片</strong>。它可以让你导出几种格式，如<code class="fe nr ns nt nh b">.png</code>、<code class="fe nr ns nt nh b">.jpg</code>、<code class="fe nr ns nt nh b">.webp</code>、<code class="fe nr ns nt nh b">.svg</code>、<code class="fe nr ns nt nh b">.pdf</code>或<code class="fe nr ns nt nh b">.eps</code>。您可以更改尺寸和比例。Plotly使用<code class="fe nr ns nt nh b">kaleido</code>作为默认引擎，但是你也可以选择一个传统的<code class="fe nr ns nt nh b">orca</code>引擎。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="b3ee" class="nl mk it nh b gy nm nn l no np"># install caleido<br/>pip install -U kaleido<br/>#or conda install -c plotly python-kaleido</span><span id="456b" class="nl mk it nh b gy nq nn l no np"># export the static image<br/>fig.write_image(f"{file_name}.png")</span></pre><h1 id="df76" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">熊猫默认后台</h1><p id="990a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">你可以设置Plotly作为熊猫默认绘图后端。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="de20" class="nl mk it nh b gy nm nn l no np">pd.options.plotting.backend = "plotly"</span></pre><p id="561c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后将plotly参数应用于数据框本身。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="13d5" class="nl mk it nh b gy nm nn l no np">fig = df.plot(kind="bar", x="x", y="y", text="y")<br/>fig.show()</span></pre><p id="505c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，它很容易将dataframe作为第一个参数输入，以至于您可能更喜欢pandas默认设置，将matplotlib作为后端。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="4a60" class="nl mk it nh b gy nm nn l no np"># return to defaul matplotlib backend<br/>pd.options.plotting.backend = "matplotlib"</span></pre><h1 id="2714" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">几个陷阱</h1><p id="3826" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">一旦你熟悉了Plotly。表示你很少遇到你无法解决的问题。我们已经说过，用支线剧情表达斗争。还有一些其他情况会让你心跳加速。但即使是这些也有一个简单的解决方案。</p><p id="9e6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要显示整数类别的数值计数，例如1，2，3号玩家赢得奖牌的次数，使用Matplotlib的标准padnas绘图很简单。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="3578" class="nl mk it nh b gy nm nn l no np">"""if you want to display which values are the most frequent and these values are integers"""</span><span id="59e9" class="nl mk it nh b gy nq nn l no np">df = pd.DataFrame({"x": [3]*10+[6]*5+[2]*1})<br/>df["x"].value_counts().plot(kind="bar")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/7c83f2b8db19689e5192b4c49fcc478e.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*1pydyBFs4lsxam8b9uesOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫的价值计算图。作者图片</p></figure><p id="32a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是如果你用Plotly做同样的尝试，它会自动假设你想在x轴上显示一个连续的整数范围。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c489" class="nl mk it nh b gy nm nn l no np">"""it's rather impossible with plotly which always set up the range containing all the numerical values"""</span><span id="89d4" class="nl mk it nh b gy nq nn l no np">fig = px.bar(df["x"].value_counts())<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/e74c177ad47f0ae3962807b0a5ca1e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GorkfPwFLgIgklHyo7SyNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果您没有指定任何内容，plotly会自动将看起来像整数/浮点数的数据点转换成整数/浮点数。作者图片</p></figure><p id="3e4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获得预期的图表，您必须将值转换成类别，尽管在pandas中不是这样。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="4ec7" class="nl mk it nh b gy nm nn l no np">df["y"] = df["y"].astype("category")  # or .astype("string")</span></pre><p id="b98a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须更改Plotly布局参数中的轴:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="72ec" class="nl mk it nh b gy nm nn l no np">fig.update_xaxes(type="category")<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/02cfab4f86026189f48f05d6bdf250c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTto5McY2RbqquRzQyFsyA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">瞧，分类轴显示的数值和你输入的完全一样。作者图片</p></figure><p id="e49a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly还自动处理日期值，这在季末(年/季度)的情况下特别烦人。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="939a" class="nl mk it nh b gy nm nn l no np">"""Also the daterange labels on the x-axis can annoy you when you try to display end of the year/quarter dates. <br/>Plotly will always turn them into the Jan next year or the beginning of the following quarter"""</span><span id="69f5" class="nl mk it nh b gy nq nn l no np">df = pd.DataFrame({"x":[<strong class="nh iu">"2019-12-31","2019-03-31","2018-12-31","2017-12-31"</strong>],<br/>                   "y":[10,12, 15, 8]})<br/>fig = px.bar(df, x="x", y="y")<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/0b078bbb8e81f29e52364d78bc06a7c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eI4Gl3Y_K4HSOxp1IsjehA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly自动缩放日期轴，当您想要显示年/季度的结束并Plotly将标签转到下一季的开始时，这很烦人。作者图片</p></figure><p id="9769" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly自动缩放轴标签以显示时间分布，但是如果您想要显示年末(季度)日期，您将会非常失望地看到下一年的开始。例如，如果你想在每年年底显示公司的财务数据，而你看到的是“2020”，而不是“2019年底”，你可能会对公司的健康状况产生完全错误的印象。修复是相同的<code class="fe nr ns nt nh b">fig.update_xaxes(type="category")</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/9cc399ab610fb8d831711bd5ef03b0be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGuoIHOBYLz7VL3yRDZRxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">x轴上的Plotly日期作为一个类别。作者图片</p></figure><p id="7859" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly很聪明，一旦你用一个日期填充轴，它就认为它是一个日期轴。有时，您可能希望在同一轴上显示日期和字符串值。解，又是<code class="fe nr ns nt nh b">.update_xaxes(type="category")</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eadd52494a7995f3d684030161d0756d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vE8CAq42XvLri5FcxvYtAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日期轴忽略所有非日期值，而分类轴按原样显示所有内容。作者图片</p></figure><h1 id="0b2a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">文件摘要</h1><ul class=""><li id="06bf" class="lv lw it lb b lc nb lf nc li px lm py lq pz lu ma mb mc md bi translated">散点图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.scatter.html" rel="noopener ugc nofollow" target="_blank"> API </a>，示例</li><li id="4b8d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">折线图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.line.html" rel="noopener ugc nofollow" target="_blank"> API </a>、<a class="ae ky" href="https://plotly.com/python/line-charts/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="709f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">条形图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.bar.html" rel="noopener ugc nofollow" target="_blank"> API </a>，<a class="ae ky" href="https://plotly.com/python/bar-charts/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="f3ea" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">饼图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.pie.html" rel="noopener ugc nofollow" target="_blank"> API </a>、<a class="ae ky" href="https://plotly.com/python/pie-charts/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="0e8e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">旭日图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.sunburst.html" rel="noopener ugc nofollow" target="_blank"> API </a>，<a class="ae ky" href="https://plotly.com/python/sunburst-charts/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="f6ea" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">树形图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.treemap.html" rel="noopener ugc nofollow" target="_blank"> API </a>，<a class="ae ky" href="https://plotly.com/python/treemaps/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="c63a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Choropleth — <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.choropleth.html" rel="noopener ugc nofollow" target="_blank"> API </a>、<a class="ae ky" href="https://plotly.com/python/choropleth-maps/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="d69b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">散点图_地理图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.scatter_geo.html" rel="noopener ugc nofollow" target="_blank"> API </a>，<a class="ae ky" href="https://plotly.com/python/scatter-plots-on-maps/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="c3c9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">散点图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.scatter.html" rel="noopener ugc nofollow" target="_blank"> API </a>、<a class="ae ky" href="https://plotly.com/python/line-and-scatter/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="9ae8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">直方图— <a class="ae ky" href="https://plotly.com/python-api-reference/generated/plotly.express.histogram.html" rel="noopener ugc nofollow" target="_blank"> API </a>，<a class="ae ky" href="https://plotly.com/python/histograms/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="31b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://plotly.com/python/linear-fits/" rel="noopener ugc nofollow" target="_blank">趋势线</a></li><li id="e37f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">轴— <a class="ae ky" href="https://plotly.com/python/reference/layout/yaxis/" rel="noopener ugc nofollow" target="_blank"> API </a></li><li id="fd4a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">文本和注释— <a class="ae ky" href="https://plotly.com/python/text-and-annotations/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="149a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">边际地块— <a class="ae ky" href="https://plotly.com/python/marginal-plots/" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="7680" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">导出— <a class="ae ky" href="https://plotly.github.io/plotly.py-docs/generated/plotly.io.write_html.html" rel="noopener ugc nofollow" target="_blank"> write_html </a>或<a class="ae ky" href="https://plotly.github.io/plotly.py-docs/generated/plotly.io.write_image.html" rel="noopener ugc nofollow" target="_blank"> write_image </a></li><li id="c0a3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">按钮(更新菜单)— <a class="ae ky" href="https://plotly.com/python/reference/layout/updatemenus/" rel="noopener ugc nofollow" target="_blank"> API </a>，<a class="ae ky" href="https://plotly.com/python/custom-buttons/" rel="noopener ugc nofollow" target="_blank">示例</a></li></ul><h1 id="ad46" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">结论</strong></h1><p id="9dce" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Plotly express是一种使用单一图表类型快速显示数据的好方法。它有互动和动画等重要功能，但缺乏支线剧情的支持。Express很聪明，它在大多数情况下用数据的逻辑子集分割数据框。但是如果它猜错了，几乎不可能说服Plotly按照你想要的方式显示数据。</p><p id="0d6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时这需要一点尝试和错误。这通常有助于将图表导出到dict中，并尝试找到您想要更新的参数的正确名称。如果无法使用Plotly创建所需的可视化效果。Express你总是可以替换为<a class="ae ky" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank">更低级的API </a>，它更加仁慈，但是也需要更多的编码。</p><p id="78fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，如果你需要更复杂的交互式报告，你会选择Plotly的仪表板工具<a class="ae ky" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"> Dash </a>，这需要更多的编码，但你可以用Dash实现真正专业外观的仪表板。</p><p id="b2c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">资源:</p><p id="9e9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/plotly/plotly.py/releases/tag/v4.0.0" rel="noopener ugc nofollow" target="_blank"> Plotly 4.0.0发行说明</a></p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="0a07" class="nl mk it nh b gy nm nn l no np">If you liked this article, check other guidelines:</span><span id="636e" class="nl mk it nh b gy nq nn l no np">* <a class="ae ky" rel="noopener" target="_blank" href="/highlighted-line-chart-with-plotly-express-e69e2a27fea8">Highlighted line chart with plotly</a><br/>* <a class="ae ky" rel="noopener" target="_blank" href="/visualize-error-log-with-pandas-and-plotly-d7796a629eaa">Visualize error log with Plotly</a><br/>* <a class="ae ky" rel="noopener" target="_blank" href="/histograms-with-plotly-express-complete-guide-d483656c5ad7">All about Plotly Express Histograms</a><br/>* <a class="ae ky" rel="noopener" target="_blank" href="/complete-guide-to-pythons-cross-validation-with-examples-a9676b5cac12">How to split data into test and train set</a></span><span id="f64f" class="nl mk it nh b gy nq nn l no np">All the pictures were created by the author. </span><span id="13a1" class="nl mk it nh b gy nq nn l no np">Many graphics on this page were created using <a class="ae ky" href="https://partner.canva.com/vdek" rel="noopener ugc nofollow" target="_blank">canva.com</a> (affiliate link, when you click on it and purchase a product, you won't pay more, but I can receive a small reward; you can always write canva.com to your browser to avoid this). Canva offer some free templates and graphics too.</span></pre><p id="8092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Github repo中提供了图表和练习。随时尝试、更新和更改— <a class="ae ky" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Comperhansive%20Guide/Plotly%20Express%20-%20Comprehensive%20Guide.ipynb" rel="noopener ugc nofollow" target="_blank"> Plotly Express —综合指南. ipynb </a></p></div></div>    
</body>
</html>