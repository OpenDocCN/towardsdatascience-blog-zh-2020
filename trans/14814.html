<html>
<head>
<title>Convolutional Neural Networks Model building and Freezing from scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卷积神经网络从零开始建模和冻结</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/convolutional-neural-networks-model-from-scratch-for-object-detection-820893610919?source=collection_archive---------46-----------------------#2020-10-12">https://towardsdatascience.com/convolutional-neural-networks-model-from-scratch-for-object-detection-820893610919?source=collection_archive---------46-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="0430" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">如果你不能简单地解释它，你就理解得不够好- <em class="iq">爱因斯坦，这个人和他的成就</em>g . j .惠特罗著，多佛出版社1973年。</p></blockquote><p id="d5c7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">CNN模型从零开始，使用最流行的Kaggle数据集<a class="ae ks" href="https://www.kaggle.com/moltean/fruits" rel="noopener ugc nofollow" target="_blank"> Fruits-360 </a>，获得98%的准确率。</p><p id="3533" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">第一步——将数据集从Kaggle导入Google Colab </strong></p><p id="aeef" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">登录你的Kaggle账户，进入我的账户，点击创建新API下载Kaggle.json文件。然后在Google colab上按照下面的代码要点上传相同的API</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><ul class=""><li id="0f24" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">直接将整个数据集导入到google colab并解压缩</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><p id="0ae9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">步骤2-准备训练和测试数据</p><ul class=""><li id="d5b0" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">数据已经包含了训练和测试文件夹，里面有水果和蔬菜的图片。我们只需要定义文件夹的路径，</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><ul class=""><li id="eda9" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">现在我们必须将图像的尺寸定义到NumPy-array中，这样我们可以在接下来的步骤中进一步将图像缩小到32x32</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><ul class=""><li id="3a8b" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">让我们找出，在训练数据中有多少种水果和蔬菜</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><p id="0454" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在这里，我创建了一个流程来缩小图片的尺寸，并放大一点以获得更好的效果</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><ul class=""><li id="f6ed" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">这段代码将显示缩小、缩放图像的最终结果</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><p id="945e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">步骤3 CNN构建和模型调整</strong></p><p id="9218" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">请对像素矩阵、RGB通道、颜色矩阵和人工神经网络有一个基本的了解，以便进一步阅读</p><p id="cd6c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在初学者的术语中，使用CNN我们所做的是，在我们的密集层之间添加额外的层，或者换句话说，将我们在CNN中定义的矩阵与密集层创建的矩阵相乘，移动到每个像素并填充输出矩阵，因此输出矩阵将具有Ai记录图像中一些变化的所有值，如形状或轮廓的变化。这种在每个像素上的乘法和加法被称为卷积，以记录图像中的边缘或形状。</p><p id="1e7e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">这里实际发生的是，我们使用滤镜矩阵定义了某些颜色像素，它与图像像素中的所有其他颜色进行“卷积”,从而找到图案，想象滤镜是黑色的，我们在一幅画上加阴影，我们在输出中得到的是全黑，但一些深色在黑色上突出显示，给我们提供了形状，这些形状在输出矩阵中注册。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/150a600ffbbb7b6f3f76d0b8b7755966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*O06nY1U7zoP4vE5AZEnxKA.gif"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">source—<a class="ae ks" href="https://stackoverflow.com/questions/52067833/how-to-plot-an-animated-matrix-in-matplotlib" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/52067833/how-to-plot-a-animated-matplotlib中的matrix</a></p></figure><p id="96f6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">直观地说，当我们继续将我们的CNN滤波器矩阵与图像像素上的密集层矩阵进行卷积时，我们将在曲线、点或一些不同于图像其余部分的形状处获得许多不同的结果/数字，这反过来将帮助AI或ANN找到形状、边缘、轮廓。<br/>随着我们深入到网络中，添加更多CNN层矩阵，做矩阵产品越做越深，</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lu"><img src="../Images/11e38e856339d0f83109c4903e20821b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZcGcAXMxgzRjoFPR2DKPw.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">查尔斯·德鲁维奥在<a class="ae ks" href="https://unsplash.com/s/photos/tracing-paper?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4a50" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">结果/数字将发生更大的变化，或者你可以说形状，曲线对人工智能来说将变得更加清晰，人工智能将能够学习苹果和菠萝之间的区别。通俗地说，我们可以说人工智能是通过描摹一幅真实的画来绘制图像，而CNN是描摹者或荧光笔。在下面的代码中，32和64是过滤器，CNN的矩阵大小是3x3</p><p id="5b92" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">为CNN选择网络架构</strong></p><p id="9c9b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">你可以在已经建立的各种网络架构之间进行交叉验证，并通过数学证明进行研究，如AlexNet、LeNet-5、VGG，或者尝试创建自己的网络架构，既不会扩大梯度，也不会过度拟合数据。<strong class="jt ir">这里我使用了一个基本的CNN架构</strong>，对于更高级的模型，我建议学习网络架构和过滤器/内核构建，具有像角度旋转、水平/垂直过滤器等功能。</p><p id="ead2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">填充</strong></p><p id="e31a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">填充是向像素矩阵添加额外边界的过程，因此在卷积过程中，角上的信息不会丢失，例如在矩阵周围添加0的边界。正如您在图像中看到的，如果没有填充，我们将只使用一次带信息的角，但现在有了填充，原始角将在卷积过程中多次使用。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lv"><img src="../Images/933da44a10d2f1e6c05eecab82093634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGy_rC68Qxn0-R8RT0VFZQ.png"/></div></div></figure><p id="0ab1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">联营</strong></p><p id="5bf1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在从卷积中获得输出后，我们使用了一层max pool，max pool的作用是简单地降低矩阵的维数，或者换句话说，降低卷积输出的输出图像的大小，以实现更快、更精确的过程。</p><p id="5713" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">为了对池中发生的事情有一个基本的直觉，我们定义了一个矩阵，例如2x2矩阵，它会将输出矩阵划分为2x2多个矩阵，并通过计算出特定2x2矩阵中的最大值，仅保留看起来有一些形状或对象的点，然后这将进一步帮助减少输出图像的维度，以便更快地处理深入网络</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/83b3e6f7a5a58a5508e9cda883734f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*mV0MHNWQYI8Xqzj7OXV5iQ.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">来源-<a class="ae ks" href="https://www.youtube.com/watch?v=ZjM_XQa5s6s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=ZjM_XQa5s6s</a>，深渊蜥蜴</p></figure><p id="6808" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">请参考AndrewNg的视频，了解CNN在添加图层后图像尺寸的变化</strong></p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="lx kz l"/></div></figure><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><ul class=""><li id="4451" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">现在是时候添加输入和输出层，并调整人工神经网络模型</li></ul><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><ul class=""><li id="7eb9" class="la lb iq jt b ju jv jy jz kp lc kq ld kr le ko lf lg lh li bi translated">保存模型，在互联网上的随机图像上进行测试，看看您训练的模型是否可以识别水果和蔬菜</li></ul><pre class="kt ku kv kw gt ly lz ma mb aw mc bi"><span id="a13e" class="md me iq lz b gy mf mg l mh mi">model.save_weights(“cnn_fruit.h5”)</span></pre><p id="d792" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir">结果</strong></p><p id="e5e8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">通过将CNN添加到我们的模型中，我能够达到98%的准确性，在使这成为您的第一个项目后，我认为您将对CNN有一个基本的直观了解，并可以更深入地研究数学部分、基本原理以及网络选择和构建。</p><div class="kt ku kv kw gt ab cb"><figure class="mj kx mk ml mm mn mo paragraph-image"><img src="../Images/60c8c15014160630ecd954119f0f4917.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*_1q0Cv7FJTD5ClJ4Pvd4kA.png"/></figure><figure class="mj kx mp ml mm mn mo paragraph-image"><img src="../Images/c5f2fb7aaf1ac142e6e2dc1a06fea228.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*O9sfi5aBFjD2rYq-RXGjsg.png"/><p class="lq lr gj gh gi ls lt bd b be z dk mq di mr ms translated">cnn_fruit.h5结果</p></figure></div><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mt"><img src="../Images/2bfbd22be4b4fad4af46d1a8d07121ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6nbsiPmXhV5DiDjISUEDNA.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">CNN定制架构结果</p></figure><h2 id="34ab" class="md me iq bd mu mv mw dn mx my mz dp na kp nb nc nd kq ne nf ng kr nh ni nj nk bi translated">冻结用于集成到web应用程序中的定制CNN模型，</h2><p id="635d" class="pw-post-body-paragraph jq jr iq jt b ju nl jw jx jy nm ka kb kp nn ke kf kq no ki kj kr np km kn ko ij bi translated">这段代码将把你定制的模型冻结成Keras检查点格式，然后你可以为应用程序集成制作推断图</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div></figure><p id="901e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">对于完整的jupyter笔记本和代码，你可以通过<a class="ae ks" href="https://github.com/Alexamannn/CNN_from_scratch" rel="noopener ugc nofollow" target="_blank">github.com</a>——<a class="ae ks" href="https://github.com/Alexamannn/CNN_from_scratch" rel="noopener ugc nofollow" target="_blank">https://github.com/Alexamannn/CNN_from_scratch</a>查看我的知识库</p></div></div>    
</body>
</html>