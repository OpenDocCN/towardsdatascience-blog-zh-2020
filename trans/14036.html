<html>
<head>
<title>Predict Time-Stamped Sales in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python预测带时间戳的销售额</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predict-time-stamped-sales-in-python-1914292461ad?source=collection_archive---------26-----------------------#2020-09-27">https://towardsdatascience.com/predict-time-stamped-sales-in-python-1914292461ad?source=collection_archive---------26-----------------------#2020-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f908" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/b95d4612fde296514413d84cf356d61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*laeHRDxTJv9bS_gN"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">由<a class="ae ko" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae ko" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9987" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">目标:</strong>使用Python中的自回归模型(ARIMA)预测即将到来的月销售额。</p><p id="d047" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">详情:</strong>各行各业的大多数业务部门都非常依赖时间序列数据来分析和预测，比如线索/销售/股票/网络流量/收入等。不时地产生一些战略性的商业影响。有趣的是，当我们有连续相关的数据点时，时间序列模型是洞察力的金矿。让我们来看看来自<a class="ae ko" href="https://www.kaggle.com/datasets" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的这样一个带时间戳的销售数据集，以理解在Python中使用自回归(ARIMA)模型进行时间序列预测所涉及的关键步骤。</p><p id="3026" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在这里，我们将ARIMA模型应用于一个交易销售数据集，以预测一个具有入站和出站差异的组织的月销售额。在现实世界中，我们需要一个时间戳预测建模的五阶段计划，即数据预处理、数据评估、模型选择、模型评估，以及最后但并非最不重要的对未来的预测。让我们在下面详细了解这些步骤中的每一步:</p><p id="1a97" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第一阶段:数据预处理</strong></p><p id="82f2" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第一步。导入库:</strong>导入时间序列预测的所有相关库:</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="7a30" class="lw lx it ls b gy ly lz l ma mb">#Data Preprocessing:</span><span id="5fbc" class="lw lx it ls b gy mc lz l ma mb">import pandas as pd<br/>import numpy as np<br/>import os as os<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline    <br/>from matplotlib import dates<br/>import warnings<br/>warnings.simplefilter("ignore")<br/>import easygui as es</span><span id="3149" class="lw lx it ls b gy mc lz l ma mb">#Data Evaluation:</span><span id="a566" class="lw lx it ls b gy mc lz l ma mb">from statsmodels.tsa.filters.hp_filter import hpfilter<br/>from statsmodels.tsa.seasonal import seasonal_decompose<br/>import statsmodels.api as sm<br/>from statsmodels.tsa.stattools import acovf,acf,pacf,pacf_yw,pacf_ols<br/>from pandas.plotting import lag_plot<br/>from statsmodels.graphics.tsaplots import plot_acf,plot_pacf<br/>from statsmodels.tsa.statespace.tools import diff<br/>from statsmodels.tsa.stattools import ccovf,ccf,periodogram<br/>from statsmodels.tsa.stattools import adfuller,kpss,coint,bds,q_stat,grangercausalitytests,levinson_durbin<br/>from statsmodels.graphics.tsaplots import month_plot,quarter_plot<br/>import matplotlib.ticker as ticker</span><span id="466f" class="lw lx it ls b gy mc lz l ma mb">#Model Selection:<br/>    <br/>from statsmodels.tsa.holtwinters import SimpleExpSmoothing<br/>from statsmodels.tsa.holtwinters import ExponentialSmoothing<br/>from statsmodels.tsa.ar_model import AR,ARResults<br/>from pmdarima import auto_arima<br/>from statsmodels.tsa.stattools import arma_order_select_ic<br/>from statsmodels.tsa.arima_model import ARMA,ARMAResults,ARIMA,ARIMAResults<br/>from statsmodels.tsa.statespace.sarimax import SARIMAX<br/>from statsmodels.tsa.api import VAR<br/>from statsmodels.tsa.statespace.varmax import VARMAX, VARMAXResults</span><span id="d329" class="lw lx it ls b gy mc lz l ma mb">#Model Evaluation &amp; Forecasting:</span><span id="7432" class="lw lx it ls b gy mc lz l ma mb">from statsmodels.tools.eval_measures import mse, rmse, meanabs<br/>from sklearn.metrics import mean_squared_error</span></pre><p id="44ee" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第二步。加载输入数据集:</strong></p><p id="eace" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这是相对较短的一步。因为我们在这里所做的只是使用pandas加载数据集。因为它是平面文件，所以我们使用read_excel方法加载数据集。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="5915" class="lw lx it ls b gy ly lz l ma mb">#Configure the current working directory:</span><span id="aa8d" class="lw lx it ls b gy mc lz l ma mb">os.chdir(r"C:\Users\srees\Desktop\Blog Projects\1. Timeseries Forecasting\2. ARIMA\Input")</span><span id="6f8d" class="lw lx it ls b gy mc lz l ma mb">input_dataframe = pd.read_excel("online_retail.xlsx",parse_dates = True)</span></pre><p id="3a3a" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第三步。检查输入数据集:</strong></p><p id="8726" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">让我们使用info、description和head方法对数据集的结构进行一些初步评估。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="f720" class="lw lx it ls b gy ly lz l ma mb">input_dataframe.info()</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi md"><img src="../Images/32c33ae834fac86e3f655eb3f0203806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*st0votrp53ZCKWlNvT6eOw.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">数据集1的结构(图片由作者提供)</p></figure><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="a6c7" class="lw lx it ls b gy ly lz l ma mb">input_dataframe.describe()</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi me"><img src="../Images/03ae4fd80a2abcc54b7406bef8614cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*qjxnR9VgyEw9Xp5AFcTkGg.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">数据集2的结构(图片由作者提供)</p></figure><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="1f7d" class="lw lx it ls b gy ly lz l ma mb">input_dataframe.head(10)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/74b880e0b087dec697d42d8085d67810.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*X5FQ1WqIYIv5HoHoBU8thg.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">数据集的前10条记录(图片由作者提供)</p></figure><p id="894c" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤四。数据角力:</strong></p><p id="5e12" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在pandas中使用dropna()方法，确保数据集中没有任何带有空白或空值的记录中断。此外，将date对象(本例中的“月”字段)转换为datetime。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="c65e" class="lw lx it ls b gy ly lz l ma mb">#Converting date object to datetime :<br/>    <br/>input_dataframe["Month"]  =  pd.to_datetime(input_dataframe["Month"], format='%Y-%m-%d')</span><span id="a9d3" class="lw lx it ls b gy mc lz l ma mb">#Dropping NA's:</span><span id="c763" class="lw lx it ls b gy mc lz l ma mb">input_dataframe = input_dataframe.dropna()</span></pre><p id="1daa" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">将日期时间字段设置为索引字段:</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="d8d8" class="lw lx it ls b gy ly lz l ma mb">input_dataframe = input_dataframe.set_index("Month")</span></pre><p id="45a2" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第五步。重采样:</strong></p><p id="1dce" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">重采样基本上涉及修改时间序列数据点的频率。我们将根据数据集的性质对时间序列观测值进行上采样或下采样。我们不必对这个时间序列数据集进行重新采样，因为它已经汇总到月初。请查看Pandas以了解有关偏移别名和重采样的更多信息:<a class="ae ko" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases" rel="noopener ugc nofollow" target="_blank">https://Pandas . pydata . org/Pandas-docs/stable/user _ guide/time series . html # offset-aliases</a></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="a02c" class="lw lx it ls b gy ly lz l ma mb">#Set the datetime index frequency:<br/> <br/>input_dataframe.index.freq = 'MS'</span></pre><p id="bd4b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第六步。绘制源数据:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="dee0" class="lw lx it ls b gy ly lz l ma mb">#Plot the Graph:</span><span id="9111" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe['Sales'].plot.line(<br/>title = 'Monthly Sales Timeseries Analysis'<br/>, legend =True, table = False, grid = False<br/>, subplots = False,  figsize =(15,8), colormap = 'Accent'<br/>, fontsize = 15,linestyle='-', stacked=False)</span><span id="c819" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="2512" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="93b6" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="b93c" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="138c" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales Timeseries Analysis \n',horizontalalignment="center", <br/>fontstyle = "normal", fontsize = "22"<br/>, fontfamily = "sans-serif")</span><span id="48c9" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="f6e9" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mg"><img src="../Images/a126bb5cd471367f464e6610a1622e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r2HOZZrYG5uDsi1bMD-87Q.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月度销售时间序列分析(图片由作者提供)</p></figure><p id="1559" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第7步:滚动和扩展时间序列数据集:</strong></p><p id="834b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">滚动均线帮助我们识别支撑和阻力区域；数据集中历史时间序列观测值的“高于平均倾斜度”和“低于平均倾斜度”的区域。</p><p id="7f40" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">计算移动平均线的主要优点是，它可以过滤掉随机销售活动中的噪音，消除波动，以查看一段时间内的平均趋势。</p><p id="38e7" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第7.1步。简单移动平均线趋势分析:</strong></p><p id="a3f6" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">简单移动平均是对时间序列数据集进行趋势分析的最基本模型之一。滚动移动平均趋势分析背后的整个思想是将数据分成时间的“窗口”，然后为每个窗口计算一个聚合函数。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="22c1" class="lw lx it ls b gy ly lz l ma mb">input_dataframe["3-Months-Moving-Avg"] = input_dataframe ["Sales"].rolling(window=3).mean()</span><span id="69c2" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="bf7a" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe[['Sales', '3-Months-Moving-Avg']].plot.line(<br/>title = '3 Months Moving Average Trend Analysis'<br/>, legend =True, table = False, grid = False,  <br/>subplots = False,  figsize =(15,8), colormap = 'Accent', <br/>fontsize = 15,linestyle='-', stacked=False)</span><span id="c6a6" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="a3f3" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="4468" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="ad10" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="e6fb" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: 3 Months Moving Average Trend Analysis \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="e1e0" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="8ce0" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="8420" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">从滚动的3个月移动平均趋势线中，我们可以清楚地看到，零售商店的销售额在每个季度的中期都呈上升趋势，而在同一季度的末期则出现了一系列阻力。因此，我们可以清楚地推断，零售商店的波段支持发生在日历年的每个季度的阻力波之前。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mh"><img src="../Images/445c1a4add503e92e845706cbc9a5f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLgOjINVfNcMYtBV-NcESQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:3个月移动平均趋势分析(图片由作者提供)</p></figure><p id="dba0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤7.2。时间序列分析的标准差:</strong></p><p id="189b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">标准差图本质上帮助我们了解销售活动在一段时间内是增加还是减少；给出时间序列数据集中平稳性的早期指示。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="90b7" class="lw lx it ls b gy ly lz l ma mb">input_dataframe ['3-Months-Moving-Avg'] = input_dataframe['Sales'].rolling(window=3).mean()<br/>input_dataframe['3-Months-Standard-Deviation'] = input_dataframe['Sales'].rolling(window=3).std()</span><span id="9332" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="1a6d" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe [['Sales', '3-Months-Moving-Avg', '3-Months-Standard-Deviation']].plot.line(title = 'Standard Deviation of Timeseries Datapoints', legend =True, table = False, grid = False,  subplots = False,  figsize =(15,8), colormap = 'Accent', fontsize = 15,linestyle='-', stacked=False)</span><span id="fb90" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="1468" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="f603" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="17da" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="8b77" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Standard Deviation of Timeseries Datapoints \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="b936" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="b5c0" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="0a86" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">所选时间序列数据集的标准偏差似乎随着时间的推移略有增加；暗示非平稳性。我们将在随后的步骤中达到平稳性。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mi"><img src="../Images/5bf77ca6603729716f247cec9571bb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBlcvjL2TgBcX_QV1yqBxQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:时间序列数据点的标准偏差(图片由作者提供)</p></figure><p id="0afd" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤7.3。扩展时间序列数据集:</strong></p><p id="335b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">时间序列分析中的扩展过程有助于我们识别销售活动的“稳定性”或“波动性”。因此，当我们在时间序列数据集上应用扩展技术时，我们将能够基本上看到数据集中每个历史时间序列观察值的累积平均值。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="7b44" class="lw lx it ls b gy ly lz l ma mb">#Plot the Graph:</span><span id="2a08" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe['Sales'].expanding().mean().plot.line(<br/>title = 'Expandind Timeseries Datapoints', legend =True, <br/>table = False, grid = False,  subplots = False,  figsize =(15,8), colormap = 'Accent', fontsize = 15,linestyle='-', stacked=False)</span><span id="3c55" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="a839" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Cumulative Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="1cb6" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="4430" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="ca25" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Expanded Timeseries Datapoints \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="ab6a" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="de23" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="c62f" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">知道历史时间戳上平均值的位置是非常好的；尤其是在时序建模的后续模型评估阶段。因为扩展技术最终有助于我们将均方根误差与销售额的累积平均值进行比较，以了解差异的大小。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mj"><img src="../Images/890fb8c324d6801e0e04f47eb566b905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75vgak_Qi-JnboetneSzkw.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:扩展的时间序列数据点(图片由作者提供)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="40f8" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第二阶段:数据评估</strong></p><p id="bb26" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第八步。评估误差、趋势和季节性:</strong></p><p id="30c6" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">选择预测模型的一个有用的抽象是将时间序列分解成系统的和非系统的部分。系统的:时间序列的组成部分，具有一致性或重现性，可以描述和建模。非系统性:时间序列中无法直接建模的部分。</p><p id="2009" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第8.1步。霍德里克-普雷斯科特滤波器:</strong></p><p id="f0b7" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Hodrick-Prescott滤波器将时间序列数据集分解为趋势和周期分量。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="4753" class="lw lx it ls b gy ly lz l ma mb">#cyclicity:</span><span id="395f" class="lw lx it ls b gy mc lz l ma mb">sales_cycle, sales_trend = hpfilter(<br/>input_dataframe["Sales"], lamb = 1600)</span><span id="2ed7" class="lw lx it ls b gy mc lz l ma mb">input_dataframe["cycle"] = sales_cycle</span><span id="c357" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="0a34" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe[["cycle", "Sales"]].plot.line(<br/>title = 'Hodrick-Prescott Filter - Cyclicity'<br/>, legend =True, table = False, grid = False<br/>,  subplots = False,  figsize =(15,8), colormap = 'Accent'<br/>, fontsize = 15,linestyle='-', stacked=False)</span><span id="bea9" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="d403" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="1e90" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="613f" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="a2de" class="lw lx it ls b gy mc lz l ma mb">plt.title(' Monthly Sales: Hodrick-Prescott Filter - Cyclicity Analysis \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="9a6b" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="5275" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="2b9f" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">当数据表现出非固定周期的上升和下降时，存在循环模式。此外，如果循环性值接近零，则表明数据是“随机的”。结果与零相差越多，就越有可能存在某种周期性。正如我们在这里看到的，在选择的数据集中存在循环性。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mr"><img src="../Images/667d2eccde293a8725297a2170f69372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHp5E5roOKi_2VOq-NO5nA.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:Hodrick Prescott过滤器——周期性分析(图片由作者提供)</p></figure><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="fff7" class="lw lx it ls b gy ly lz l ma mb">#Trendline</span><span id="3210" class="lw lx it ls b gy mc lz l ma mb">input_dataframe ["trend"] = sales_trend</span><span id="3343" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="8b88" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe[["trend", "Sales"]].plot.line(<br/>title = 'Hodrick-Prescott Filter - Trendline', <br/>legend =True, table = False, grid = False,  subplots = False,  figsize =(15,8), colormap = 'Accent', fontsize = 15,<br/>linestyle='-', stacked=False)</span><span id="ec82" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="c696" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="705f" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="713d" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="5ee8" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Hodrick-Prescott Filter - Trendline Analysis \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="a50b" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="e3ba" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="983e" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">数据点的观察值的趋势线显示了在一段时间内以非线性速率的总体增长模式。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mh"><img src="../Images/640bd2bea3a55495f8744abf3689956a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dsCuMWy0BzL5AY_r6pxP3Q.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:霍德里克-普雷斯科特过滤器-趋势线分析(图片由作者提供)</p></figure><p id="b88f" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第8.2步。误差、趋势和季节性(ETS)分解:</strong></p><p id="f699" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">一个给定的时间序列由三个系统成分组成，包括水平、趋势、季节性和一个称为噪声/误差/残差的非系统成分。本节对时间序列的分解试图分离出时间序列中的这些单独的系统和非系统组成部分；抛出一个包含四个前述情节的图表。</p><p id="06b1" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">乘法模型在这里更为合适，因为销售额似乎正以非线性的速度增长。另一方面，当季节性和趋势成分在一段时间内保持不变时，我们对时间序列应用“加法”模型。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="a7d1" class="lw lx it ls b gy ly lz l ma mb">result = seasonal_decompose(input_dataframe["Sales"]<br/>, model = "multiplicative")</span><span id="b562" class="lw lx it ls b gy mc lz l ma mb">fig, axes = plt.subplots(4, 1, sharex=True)</span><span id="8547" class="lw lx it ls b gy mc lz l ma mb">result.observed.plot(ax=axes[0], legend=False, colormap = 'Accent')<br/>axes[0].set_ylabel('Observed')</span><span id="248f" class="lw lx it ls b gy mc lz l ma mb">result.trend.plot(ax=axes[1], legend=False, colormap = 'Accent')<br/>axes[1].set_ylabel('Trend')</span><span id="4413" class="lw lx it ls b gy mc lz l ma mb">result.seasonal.plot(ax=axes[2], legend=False, colormap = 'Accent')<br/>axes[2].set_ylabel('Seasonal')</span><span id="4e75" class="lw lx it ls b gy mc lz l ma mb">result.resid.plot(ax=axes[3], legend=False, colormap = 'Accent')<br/>axes[3].set_ylabel('Residual')</span><span id="6ea3" class="lw lx it ls b gy mc lz l ma mb">plt.title(""" Monthly Sales: ETS Decomposition Plots \n""",horizontalalignment="center", fontstyle = "normal", fontsize = "15", fontfamily = "sans-serif")</span><span id="bf31" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="cab9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">此处观察值的趋势线表明，随着时间的推移，总体增长模式呈非线性(类似于我们在Hodrick-Prescott过滤过程中注意到的情况)。此外，在固定的时间间隔内，数据集的时间戳似乎存在显著的季节性变化(范围远远超过零)；暗示季节性。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ms"><img src="../Images/2404c23e79c7fecc7b53cd13889d048d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6BvJYTkBmefFLzjXQaI5w.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:ETS分解图(图片由作者提供)</p></figure><p id="e0e0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤8.3。用于季节性检查的自相关(ACF)图:</strong></p><p id="cc08" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">自相关是一种序列相关性，其中时间序列与其自身的滞后版本线性相关。滞后意味着“倒退”，就这么简单。因此,“自身的滞后版本”基本上意味着数据点被后移一定数量的周期/滞后。<br/> <br/>因此，如果我们在时间序列数据集上运行自相关函数，我们基本上是在将其后移至一定数量的周期/滞后后绘制同一组数据点。</p><p id="81b3" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">平均来说，在最初的几个(20-40)滞后期内绘制自相关的大小可以说明一个时间序列的很多情况。通过这样做，我们将能够很容易地发现和验证时间序列数据中的季节性成分。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="89da" class="lw lx it ls b gy ly lz l ma mb">fig = plt.figure(figsize=(15,8))<br/>ax = fig.add_subplot(111)</span><span id="dcd7" class="lw lx it ls b gy mc lz l ma mb">acf(input_dataframe["Sales"])<br/>lags = 40</span><span id="3982" class="lw lx it ls b gy mc lz l ma mb">plot_acf(input_dataframe["Sales"], <br/>lags = lags, color = 'g', ax = ax);<br/>plt.figure(figsize=(15,8)) <br/>plt.title(' Monthly Sales: Autocorrelation Plots \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="97ce" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('y(t+1)',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="72c7" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('y(t)',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="09a1" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="3281" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">通过绘制滞后ACF，我们首先可以确认季节性确实存在于这个时间序列数据集中。因为滞后ACF图展示了数据中可预测的季节性模式。我们能够清楚地看到，在第二大正峰值爆发之前，由固定数量的时间戳组成的季节性起伏模式。每个数据点似乎都与未来的另一个数据点密切相关；表明数据集中有很强的季节性。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mt"><img src="../Images/56c35c69f4c4ccc68dcd175df97ce8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qChgqS_OmDXoInVepljDyQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:自相关图(图片由作者提供)</p></figure><p id="a163" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第九步。平稳性检查</strong></p><p id="0bd7" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果时间序列数据不显示趋势或季节性，则称其为平稳的。也就是；它的均值、方差和协方差在序列的任何部分都保持不变，并且不是时间的函数。</p><p id="f8ac" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">显示季节性的时间序列肯定不是平稳的。因此，所选择的时间序列数据集是非平稳的。让我们使用自动迪基-富勒&amp; KPSS测试，并进一步通过绘制数据集的滞后自相关和偏相关函数，再次确认时间序列数据集的非平稳性，如下所示:</p><p id="1097" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤9.1。平稳性的增强Dickey-Fuller检验:</strong></p><p id="3fa9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">平稳性的增强Dickey-Fuller检验通常涉及单位根假设检验，其中零假设H0表明序列是非平稳的。替代假设H1支持具有小p值(p &lt;0.05 ) indicating strong evidence against the null hypothesis.</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="3071" class="lw lx it ls b gy ly lz l ma mb">print('Augmented Dickey-Fuller Test on Sales Data')</span><span id="4d10" class="lw lx it ls b gy mc lz l ma mb">input_dataframe_test = adfuller(input_dataframe["Sales"], autolag = 'AIC')</span><span id="ba0c" class="lw lx it ls b gy mc lz l ma mb">input_dataframe_test</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/65c6d0498dacb498d97c6cc4147e6694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*FDJcB1HqkfVZaIh4b2V68w.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">Augmented Dickey-Fuller Test for Stationarity 1 (Image by Author)</p></figure><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="b00c" class="lw lx it ls b gy ly lz l ma mb">#For loop to assign dimensions to the metrices:<br/>    <br/>print('Augmented Dickey-Fuller Test on Sales Data')</span><span id="0aa0" class="lw lx it ls b gy mc lz l ma mb">input_dataframe_out = pd.Series(input_dataframe_test[0:4], <br/>                                index = ['ADF test statistic', 'p-value', '#lags used', '#observations'])</span><span id="47a1" class="lw lx it ls b gy mc lz l ma mb">for key, val in input_dataframe_test[4].items():</span><span id="7d59" class="lw lx it ls b gy mc lz l ma mb">input_dataframe_out[f'critical value ({key})'] = val<br/>    <br/>print(input_dataframe_out)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/bc1a18ea590c2b901ff4dca63a9278e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*1TogXEE0kV0iWKBYfTQ5TA.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">Augmented Dickey-Fuller Test for Stationarity 2 (Image by Author)</p></figure><p id="f96b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Here we have a very high p-value at 0.99 ( p&gt; 0.05)的平稳性，这提供了反对零假设的弱证据，因此我们无法拒绝零假设。因此，我们决定我们的数据集是非平稳的。</p><p id="85db" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">以下是使用ADF测试自动检查平稳性的自定义函数:</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="85cc" class="lw lx it ls b gy ly lz l ma mb">#Custom function to check stationarity using ADF test:<br/>    <br/>def adf_test(series,title=''):</span><span id="c741" class="lw lx it ls b gy mc lz l ma mb">print(f'Augmented Dickey-Fuller Test: {title}')<br/>    result = adfuller(series.dropna(),autolag='AIC') # .dropna() handles differenced data<br/>    <br/>    labels = ['ADF test statistic','p-value','# lags used','# observations']</span><span id="52ef" class="lw lx it ls b gy mc lz l ma mb">    out = pd.Series(result[0:4],index=labels)</span><span id="cf96" class="lw lx it ls b gy mc lz l ma mb">for key,val in result[4].items():<br/>        out[f'critical value ({key})']=val<br/>         print(out.to_string())          <br/>    # .to_string() removes the line "dtype: float64"<br/>    <br/>    if result[1] &lt;= 0.05:<br/>        print("Strong evidence against the null hypothesis")<br/>        print("Reject the null hypothesis")<br/>        print("Data has no unit root and is stationary")<br/>    else:<br/>        print("Weak evidence against the null hypothesis")<br/>        print("Fail to reject the null hypothesis")<br/>        print("Data has a unit root and is non-stationary")</span></pre><p id="9358" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">调用定制的增强Dickey-Fuller函数来检查平稳性:</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="6845" class="lw lx it ls b gy ly lz l ma mb">adf_test(input_dataframe["Sales"], title = "Automated ADF Test for Stationarity")</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mw"><img src="../Images/08f87bf0051c73a00df7be5439cedf6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1aCPV2ojijRrdqvqyrwRxw.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">平稳性3的增强Dickey-Fuller测试(图片由作者提供)</p></figure><p id="5e58" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第9.2步。平稳性的KPSS(科维亚特科夫斯基-菲利普斯-施密特-申)检验:</strong></p><p id="3ac3" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在解释零假设和交替假设时，KPSS(科维亚特科夫斯基-菲利普斯-施密特-申)检验结果与ADF检验结果正好相反。也就是；平稳性的KPSS检验通常涉及单位根假设检验，其中零假设H0表示序列是平稳的，具有较大的p值(p&gt;0.05)，而替代假设H1支持非平稳性，表明零假设的证据较弱。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="d443" class="lw lx it ls b gy ly lz l ma mb">def kpss_test(timeseries):<br/>    <br/>    print ('Results of KPSS Test:')<br/>    kpsstest = kpss(timeseries, regression='c')<br/>    kpss_output = pd.Series(kpsstest[0:3], index=<br/>    ['Test Statistic','p-value','Lags Used'])</span><span id="44c4" class="lw lx it ls b gy mc lz l ma mb">    for key,value in kpsstest[3].items():<br/>        kpss_output['Critical Value (%s)'%key] = value<br/>        print (kpss_output)</span></pre><p id="ff2b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">调用自定义KPSS函数来检查平稳性:</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="8559" class="lw lx it ls b gy ly lz l ma mb">kpss_test(input_dataframe["Sales"])</span></pre><p id="38c3" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这里我们有一个非常低的p值，为0.01 ( p &lt;0.05 ), which provides weak evidence against the null hypothesis, indicating that our time-series is non-stationary.</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/0642da41d1d709939aed9229d3310bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*CwBg9_8OyQDMSgLck_thjQ.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">KPSS Test for Stationarity (Image by Author)</p></figure><p id="5739" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd"> Step 9.3)。使用滞后&amp;自相关图重新验证非平稳性:</strong></p><p id="cbe2" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤9.3.1。滞后图:</strong></p><p id="62c9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">当我们在非平稳数据集上绘制y(t)对y(t+1)时，我们将能够发现强自相关；也就是说，随着y(t)值的增加，附近的滞后值也会增加。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="5a44" class="lw lx it ls b gy ly lz l ma mb">fig = plt.figure(figsize=(15,8))<br/>ax = fig.add_subplot(111)</span><span id="3a32" class="lw lx it ls b gy mc lz l ma mb">lag_plot(input_dataframe["Sales"], c= 'g', ax = ax);</span><span id="0d91" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Lag Plots \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="cd90" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="973d" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们可以在这里的滞后图中找到y(t)和y(t+1)之间的强自相关，重申时间序列数据集的非平稳性。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi my"><img src="../Images/46cd299539e0082483e27325dde8765f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31501GLFYyNo0N6sTwfJ8Q.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:滞后图(作者图片)</p></figure><p id="a688" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤9.3.2。自相关(ACF)图:</strong></p><p id="ec1d" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如前所述，我们可以清楚地看到一个没有明显截止或指数衰减迹象的季节性因素。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="b244" class="lw lx it ls b gy ly lz l ma mb">fig = plt.figure(figsize=(15,8))<br/>ax = fig.add_subplot(111)</span><span id="ba50" class="lw lx it ls b gy mc lz l ma mb">acf(input_dataframe["Sales"])<br/>lags = 40<br/>plot_acf(input_dataframe["Sales"], lags = lags, c = 'g', ax = ax);</span><span id="758d" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Autocorrelation Plots \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="13ce" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('y(t+1)',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="97b6" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('y(t)',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="a3eb" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="79eb" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在第二大正峰值爆发之前，时间序列数据集显然具有由固定数量的时间戳组成的起伏的季节性模式。此外，ACF图不会很快衰减，仍然远远超出显著性范围；证实时间序列数据集的非平稳性。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mz"><img src="../Images/813c07b807a40c95ef2587294d7db394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KxTLlShA96yjSTotl_l_sQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:自相关图(图片由作者提供)</p></figure><p id="6aab" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤9.3.3。部分自相关(PACF)图:</strong></p><p id="6696" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">部分自相关(PACF)图只能在静态数据集上生成。由于所选的时间序列数据集显示非平稳性，我们在生成部分自相关(PACF)图之前应用了一阶差分。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="0b85" class="lw lx it ls b gy ly lz l ma mb">input_dataframe["first_order_differentiation"] = diff(input_dataframe["Sales"], k_diff = 1)</span><span id="fac7" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="8950" class="lw lx it ls b gy mc lz l ma mb">ax =  input_dataframe["first_order_differentiation"].plot.line(title = 'Monthly Sales Timeseries Data : 1st order Differentiation'<br/>, legend =True, table = False, grid = False , subplots = False,  figsize =(15,8), colormap = 'Accent', fontsize = 15,linestyle='-', stacked=False)</span><span id="20a4" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="6af7" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="f4cb" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Quarter',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="2bb6" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="6d91" class="lw lx it ls b gy mc lz l ma mb">plt.title(' Monthly Sales: 1st order Differentiation Analysis \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="1129" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="a7ff" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi na"><img src="../Images/e1ec93dba11d3d756a6e23548a769e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AmN2dkbga5vEzX840pb85A.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:一阶差异分析(图片由作者提供)</p></figure><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="4ac2" class="lw lx it ls b gy ly lz l ma mb">input_dataframe["first_order_differentiation"] = diff(input_dataframe["Sales"], k_diff = 1)</span><span id="00ca" class="lw lx it ls b gy mc lz l ma mb">fig = plt.figure(figsize=(15,8))<br/>ax = fig.add_subplot(111)<br/>lags = 40<br/>plot_pacf(input_dataframe["first_order_differentiation"].dropna(), lags = np.arange(lags), c='g', ax = ax);</span><span id="9218" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Partial Autocorrelation Plots \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="e581" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('y(t+1)',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="a058" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('y(t)',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="509d" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><p id="45dd" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">具有一阶差分的数据点的PACF图显示了锐截止点或指数衰减，表明一阶积分的稳定性。此外，PACF图衰减相当快，并基本保持在显著性范围内(蓝色阴影区域)，加强了所选时间序列数据集默认为非平稳的假设。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nb"><img src="../Images/41e9fc250a607b0534a17196421313fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4GyYpyniE5MPbA-bQNfkQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:部分自相关图</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="54d9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第三阶段:型号选择</strong></p><p id="c994" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第十步。将数据集分为训练集和测试集</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="121a" class="lw lx it ls b gy ly lz l ma mb">len(input_dataframe)</span><span id="66e8" class="lw lx it ls b gy mc lz l ma mb">training_dataframe = input_dataframe.iloc[:len(input_dataframe)-23, :1]</span><span id="6364" class="lw lx it ls b gy mc lz l ma mb">testing_dataframe = input_dataframe.iloc[len(input_dataframe)-23:, :1]</span></pre><p id="ff15" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤11.1。确定ARIMA订单:</strong></p><p id="042b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">由于数据集是季节性的和不稳定的，我们需要拟合一个SARIMA模型。SARIMA是首字母缩略词，代表季节性自回归综合移动平均线；一类统计模型，用于分析和预测具有季节性和非平稳性的时间序列数据。它只不过是对ARIMA的扩展，支持对该系列的季节性成分进行直接建模。</p><p id="eda9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ARIMA的标准符号是(p，d，q ),其中参数用整数值代替，以快速指示所使用的特定ARIMA模型。ARIMA模型的参数是:</p><p id="5523" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">p:模型中包含的滞后观测值的数量，也称为滞后阶数。d:原始观测值的差异次数，也称为差异程度。<br/>问:移动平均线窗口的大小，也叫移动平均线的顺序。</p><p id="03db" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这些组件中的每一个都在模型中被明确指定为参数。在SARIMA中，它进一步添加了三个新的超参数，以指定序列的季节性成分的自回归(AR)、差分(I)和移动平均(MA)，以及季节性周期的附加参数。</p><p id="a499" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此在这一节中，我们本质上是试图确定P、D、Q和P、D、Q和m的顺序(即；自动回归、积分和移动平均分量以及季节回归、差分和移动平均系数的顺序)应用于时间序列数据集以拟合SARIMA模型。</p><p id="6090" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤11.1.1。使用pmdarima.auto_arima的ARIMA订单:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="efb1" class="lw lx it ls b gy ly lz l ma mb">auto_arima(input_dataframe["Sales"], seasonal = True, m=12, error_action = "ignore").summary()</span></pre><p id="bb5a" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">auto_arima建议我们应该拟合以下SARIMA模型(3，1，5)(2，1，1，12)，以最佳预测所选时间序列数据集的未来值。让我们在下一步尝试通过逐步AIC准则法重新验证订单。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nc"><img src="../Images/015c71d6ee93c9e9f2e9c25aa422f0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kxKrZU3eyGkYMBhQQkTAA.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated"><strong class="bd nd"> ARIMA订单使用pmdarima.auto_arima(图片由作者提供)</strong></p></figure><p id="6f0c" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">逐步11.1.2。使用逐步auto_arima重新验证ARIMA订单:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="ffd3" class="lw lx it ls b gy ly lz l ma mb">stepwise_fit = auto_arima(input_dataframe["Sales"], start_p = 0<br/>                          , start_q = 0,max_p =3, max_q = 5<br/>                          , m=12, seasonal = True, d=None, <br/>                          trace = True, <br/>                          error_action ='ignore'<br/>                          , suppress_warnings = True,<br/>                          stepwise = True)</span></pre><p id="d6b0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">逐步auto_arima为我们提供了列表中所有可能的“Akaike信息标准”或AIC分数的细分。逐步拟合得到了相同的结果；突出显示在所选时间序列数据集上拟合SARIMA模型时要使用的自回归、积分和移动平均系数的正确顺序。</p><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ne"><img src="../Images/6a526e271856fe56a3d3e26024e7f054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3MJVpCCoOOUIObxI2K6Fw.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated"><strong class="bd nd">使用逐步auto_arima重新验证ARIMA订单(图片由作者提供)</strong></p></figure><p id="4b9b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤11.2。拟合萨里玛模型:</strong></p><p id="ac08" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在训练数据集上拟合SARIMA模型，如下所示:</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="4130" class="lw lx it ls b gy ly lz l ma mb">fitted_SARIMA_model = SARIMAX(training_dataframe["Sales"], order =(3,1,5), seasonal_order = (2,1,1,12))</span><span id="047b" class="lw lx it ls b gy mc lz l ma mb">results = fitted_SARIMA_model.fit()</span><span id="3bcf" class="lw lx it ls b gy mc lz l ma mb">results.summary()</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nf"><img src="../Images/c963b5000ad7c22841bf83aca0f423e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6o9GReI60QSfFOxJ5gpjg.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">拟合萨里玛模型(图片由作者提供)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="2ce7" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第四阶段:模型评估</strong></p><p id="a96f" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤12.1。评估萨里玛模型:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="fa04" class="lw lx it ls b gy ly lz l ma mb">start = len(training_dataframe)</span><span id="30a3" class="lw lx it ls b gy mc lz l ma mb">end = len(training_dataframe) + len(testing_dataframe) -1<br/>test_SARIMA_predictions = results.predict(start = start, end = end).rename('SARIMA Predictions')</span><span id="d908" class="lw lx it ls b gy mc lz l ma mb">#Root Mean Squared Error</span><span id="7331" class="lw lx it ls b gy mc lz l ma mb">np.sqrt(mean_squared_error(testing_dataframe, test_SARIMA_predictions))</span></pre><p id="9aa2" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤12.2。构建差异—预测的入站和出站值:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="fa10" class="lw lx it ls b gy ly lz l ma mb">test_SARIMA_predictions = pd.DataFrame(test_SARIMA_predictions)</span><span id="a77b" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions["inbound_variance"] = (test_SARIMA_predictions["SARIMA Predictions"]-562.176565188264).round(decimals =0)</span><span id="c16f" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions["outbound_variance"]= (test_SARIMA_predictions["SARIMA Predictions"]+562.176565188264).round(decimals = 0)</span><span id="20e9" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions = test_SARIMA_predictions.join(testing_dataframe)</span><span id="69e9" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions</span></pre><p id="10a8" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤12.3。将预测值与测试集的预期值进行比较:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="f9cc" class="lw lx it ls b gy ly lz l ma mb">test_SARIMA_predictions = test_SARIMA_predictions.reset_index()</span><span id="5d03" class="lw lx it ls b gy mc lz l ma mb">print(test_SARIMA_predictions.columns)</span><span id="9252" class="lw lx it ls b gy mc lz l ma mb">type(test_SARIMA_predictions["index"])</span><span id="9ef0" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions["Month"] = test_SARIMA_predictions["index"].rename("Month")</span><span id="f33d" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions["Month"] = test_SARIMA_predictions["Month"] .dt.strftime('%Y-%m-%d')</span><span id="8067" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions.set_index("Month", inplace=True)</span><span id="d3ce" class="lw lx it ls b gy mc lz l ma mb">test_SARIMA_predictions[["Sales", "SARIMA-Predicted Sales",'Predicted Inbound Variance',<br/>       'Predicted Outbound Variance']] = test_SARIMA_predictions[["Sales", "SARIMA-Predicted Sales",'Predicted Inbound Variance',<br/>       'Predicted Outbound Variance']] .astype(int)</span><span id="444e" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="0f00" class="lw lx it ls b gy mc lz l ma mb">ax = test_SARIMA_predictions[["Sales", "SARIMA-Predicted Sales","Predicted Inbound Variance","Predicted Outbound Variance"]].plot.line(<br/>                             title = 'Monthly Sales: Evaluating SARIMA Model', legend =True, table = False, grid = False<br/>                            ,  subplots = False,  figsize =(15,8)<br/>                            , colormap = 'Accent', fontsize = 15<br/>                            ,linestyle='-', stacked=False)</span><span id="c00c" class="lw lx it ls b gy mc lz l ma mb">x=  pd.Series (range (0, len(test_SARIMA_predictions)  , 1))</span><span id="7403" class="lw lx it ls b gy mc lz l ma mb">for i in x:<br/>  ax.annotate(test_SARIMA_predictions["SARIMA-Predicted Sales"][i],<br/>      xy=(i,test_SARIMA_predictions["SARIMA-Predicted Sales"][i]), <br/>      xycoords='data',<br/>      xytext=(i,test_SARIMA_predictions["SARIMA-Predicted Sales"][i]+5 ), textcoords='data',arrowprops=dict(arrowstyle="-&gt;", connectionstyle="angle3",facecolor='black'),horizontalalignment='left',verticalalignment='top')</span><span id="6f63" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="3b8c" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="c99c" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Month',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="c6dc" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="e338" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Evaluating SARIMA Model \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="76c5" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="7fd8" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nb"><img src="../Images/0d0a38c322fbbb69d62119fcd439f12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZbuqV1tgv6KbDpnALtxaQA.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:评估SARIMA模型(图片由作者提供)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="26ab" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第五阶段:对未来的预测</strong></p><p id="9686" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤13.1。在完整数据集上拟合所选预测模型:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="2073" class="lw lx it ls b gy ly lz l ma mb">final_model = SARIMAX(input_dataframe["Sales"], order = (3,1,5), seasonal_order = (2,1,1,12))</span><span id="5a28" class="lw lx it ls b gy mc lz l ma mb">SARIMAfit = final_model.fit()</span></pre><p id="7dba" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤13.2。获取整个数据集的预测值:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="0779" class="lw lx it ls b gy ly lz l ma mb">forecast_SARIMA_predictions = SARIMAfit.predict(start = len(input_dataframe), end = len(input_dataframe)+23, dynamic = False, typ = 'levels').rename ('Forecast')</span></pre><p id="1335" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">第13.3步。构建差异:入站和出站差异:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="c197" class="lw lx it ls b gy ly lz l ma mb">forecast_SARIMA_predictions = pd.DataFrame(forecast_SARIMA_predictions)</span><span id="8b45" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions = forecast_SARIMA_predictions.rename(columns = {'Forecast': "SARIMA Forecast"})</span><span id="2e2c" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions["minimum_sales"] = (forecast_SARIMA_predictions ["SARIMA Forecast"] -546.9704996461452).round(decimals = 0)</span><span id="d259" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions["maximum_sales"] = (forecast_SARIMA_predictions ["SARIMA Forecast"] +546.9704996461452).round(decimals = 0)</span><span id="9103" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions["SARIMA Forecast"] = forecast_SARIMA_predictions["SARIMA Forecast"].round(decimals = 0)</span><span id="c802" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions.to_csv('output.csv')</span><span id="90e1" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/f39771febb4852ca238fe55e4be04f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*cN8O1gE7WELEDOZcnBdawg.jpeg"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">预测的SARIMA数据集(图片由作者提供)</p></figure><p id="86db" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">步骤13.4。根据已知值绘制预测值:</strong></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="e8e8" class="lw lx it ls b gy ly lz l ma mb">forecast_SARIMA_predictions1 = forecast_SARIMA_predictions</span><span id="6d5b" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions1 = forecast_SARIMA_predictions1.reset_index()</span><span id="bd04" class="lw lx it ls b gy mc lz l ma mb">print(forecast_SARIMA_predictions1.columns)</span><span id="7d24" class="lw lx it ls b gy mc lz l ma mb">type(forecast_SARIMA_predictions1["index"])</span><span id="7929" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions1["Month"] = forecast_SARIMA_predictions1["index"].rename("Month")</span><span id="0ecd" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions1["Month"] = forecast_SARIMA_predictions1["Month"] .dt.strftime('%Y-%m-%d')</span><span id="e6cc" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions1 = forecast_SARIMA_predictions1.drop(['index'], axis=1)</span><span id="819e" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions1.set_index("Month", inplace=True)</span><span id="3109" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions1[["SARIMA - Forecasted Sales"<br/>,'Minimum Sales','Maximum Sales']] = forecast_SARIMA_predictions[["SARIMA - Forecasted Sales"<br/>,'Minimum Sales','Maximum Sales']] .astype(int)</span><span id="8bf7" class="lw lx it ls b gy mc lz l ma mb">#Plot the Graph:</span><span id="a83f" class="lw lx it ls b gy mc lz l ma mb">ax = forecast_SARIMA_predictions1[["SARIMA - Forecasted Sales",'Minimum Sales','Maximum Sales']].plot.line(<br/>title = 'Predicting Monthly Sales: SARIMA Model', legend =True, table = False, grid = False,  subplots = False,  figsize =(15,8)<br/> , colormap = 'Accent', fontsize = 15,linestyle='-', stacked=False)</span><span id="0b2c" class="lw lx it ls b gy mc lz l ma mb">x=  pd.Series (range (0, len(forecast_SARIMA_predictions1)  , 1))</span><span id="cb17" class="lw lx it ls b gy mc lz l ma mb">for i in x:<br/>              ax.annotate(forecast_SARIMA_predictions1["SARIMA - Forecasted Sales"][i],xy=(i,forecast_SARIMA_predictions1["SARIMA - Forecasted Sales"][i]), xycoords='data',<br/>xytext=(i,forecast_SARIMA_predictions1["SARIMA - Forecasted Sales"][i]+5 ), textcoords='data',#arrowprops=dict(arrowstyle="-",<br/>#facecolor='black'),#horizontalalignment='left',<br/>verticalalignment='top')</span><span id="9c77" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="555d" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="d90c" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Month',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="af54" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="27ba" class="lw lx it ls b gy mc lz l ma mb">plt.title('Predicting Monthly Sales: SARIMA Model \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="635d" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="84a1" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nh"><img src="../Images/1bab187f43ccea581cf623ae47fdfecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eApJNcXcFgFaCbyCTxZVPQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">预测月销售额:萨里玛模型</p></figure><p id="178d" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">不可预测性和风险是任何预测模型的亲密伴侣。在现实世界中，我们可能无法始终将实际销售额精确到绝对预测值。</p><p id="a192" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">事实上，不仅仅是一个绝对值，根据预测的不可预测性程度来获得洞察力在业内被普遍认为是一种良好的做法。因此，让我们结合输入数据集中过去和现在的数据以及预测的入站/出站差异来预测未来几个月的销售情况。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="bdb5" class="lw lx it ls b gy ly lz l ma mb">input_dataframe["Sales"].plot.line(title = 'Monthly Sales: Evaluating SARIMA Model', legend =True, table = False, grid = False<br/>,  subplots = False,  figsize =(15,8), colormap = 'Accent', fontsize = 15,linestyle='-', stacked=False)</span><span id="9106" class="lw lx it ls b gy mc lz l ma mb">#forecast_SARIMA_predictions["SARIMA Forecast"].plot(legend = True, label = "SARIMA Forecast")</span><span id="9a25" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions["Minimum Sales"].plot(legend = True, label = "Minimum Predicted Sales")</span><span id="664a" class="lw lx it ls b gy mc lz l ma mb">forecast_SARIMA_predictions["Maximum Sales"].plot(legend = True, label = "Maximum Predicted Sales")</span><span id="f29b" class="lw lx it ls b gy mc lz l ma mb">#Configure x and y labels:</span><span id="fe35" class="lw lx it ls b gy mc lz l ma mb">plt.ylabel('Volume of sales',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="72a7" class="lw lx it ls b gy mc lz l ma mb">plt.xlabel('Year &amp; Month',horizontalalignment="center",fontstyle = "normal", fontsize = "large", fontfamily = "sans-serif")</span><span id="14bd" class="lw lx it ls b gy mc lz l ma mb">#Set up title, legends and theme:</span><span id="ceb9" class="lw lx it ls b gy mc lz l ma mb">plt.title('Monthly Sales: Evaluating SARIMA Model \n',horizontalalignment="center", fontstyle = "normal", fontsize = "22", fontfamily = "sans-serif")</span><span id="4f06" class="lw lx it ls b gy mc lz l ma mb">plt.legend(loc='upper left', fontsize = "medium")<br/>plt.xticks(rotation=0, horizontalalignment="center")<br/>plt.yticks(rotation=0, horizontalalignment="right")</span><span id="c87f" class="lw lx it ls b gy mc lz l ma mb">plt.style.use(['classic'])<br/>ax.autoscale(enable=True, axis='x', tight=False)</span></pre><figure class="ln lo lp lq gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mj"><img src="../Images/ba09c22f447985d8d10efa4eb467b45c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kLdu3_S2rWCuhIvfLdtBDQ.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">月销售额:评估SARIMA模型(图片由作者提供)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="e657" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">结论</strong></p><p id="afe9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，简而言之，我们利用来自Kaggle的带时间戳的销售数据集，并使用Python中的Statsmodels库预测其未来数据点的实际进出差异。此外，在每一个接合点，我们使用pandas.plot()和Matplotlib可视化输出，以获得洞察力。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="d980" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">接下来是什么？</strong></p><p id="acc6" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">预测未来的数据点只是故事的一半。在现实世界中，当洞察以可理解的方式与内部/外部的利益相关者共享时，项目就展开了，这样他们就能够不时地做出战略性的商业决策。</p><p id="fd9d" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">1)因此，让我们确保将最终输出数据集插入组织的BI平台(如Tableau/ Power BI/ Qlik等)。)并构建一个数据故事，突出项目的关键发现。在构建数据故事的同时，翻译调查结果的整个过程很大程度上取决于我们对行业和相关业务部门的了解。</p><p id="de1d" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2)与组织的内部/外部利益相关者以及仪表板分享见解，以便他们能够相应地制定营销/销售/财务计划。<br/> <br/> 3)在python中应用完全相同的Statsmodels库来预测带时间戳的未来线索/价格/网络流量/收入等。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="c055" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd"> GitHub库</strong></p><p id="36f0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我已经从Github的许多人那里学到了(并且还在继续学到)。因此，在一个公共的<a class="ae ko" href="https://github.com/srees1988/sarima-in-py" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中分享我的整个python脚本和支持文件，以防它对任何在线搜索者有益。此外，如果您在理解使用Python中的ARIMA模型预测带时间戳的数据点的基础知识方面需要任何帮助，请随时联系我。乐于分享我所知道的:)希望这有所帮助！</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="aded" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">关于作者</strong></p><div class="ni nj gp gr nk nl"><a href="https://srees.org/about" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jd gy z fp nq fr fs nr fu fw jc bi translated">Sreejith Sreedharan - Sree</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">数据爱好者。不多不少！你好！我是Sreejith Sreedharan，又名Sree一个永远好奇的数据驱动的…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">srees.org</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ki nl"/></div></div></a></div></div></div>    
</body>
</html>