<html>
<head>
<title>Mastering Random Forests: A comprehensive guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握随机森林:综合指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mastering-random-forests-a-comprehensive-guide-51307c129cb1?source=collection_archive---------9-----------------------#2020-10-18">https://towardsdatascience.com/mastering-random-forests-a-comprehensive-guide-51307c129cb1?source=collection_archive---------9-----------------------#2020-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a02a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">随机森林是每个数据科学家或机器学习工程师的工具包中应该拥有的最强大的算法之一。在本文中，我们将采用代码优先的方法来理解sklearn的随机森林所提供的一切！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/70181b9345d75b13a9c37bca832e2374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yZOF8Ft8kxhoBSZE"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">库纳尔·辛德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="b449" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">决策树</h2><p id="0f01" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">为了理解随机森林，有必要了解它们是由什么构成的。决策树是所有基于树的算法的基础构件。其他所有基于树的算法都是复杂的决策树集合。因此，理解决策树的各个方面将是一个很好的起点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/8f5a8c7635b4442f39f333660bf9e713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NH_t8fZ_BDvF4js3QfOOuA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">根据“医疗预约数据集”训练的决策树[图片由作者提供]</p></figure><p id="b273" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">由于决策树可以是任何深度(如果深度没有被明确指定)，决策树倾向于过度适应每个数据点。这将导致100%的准确性，但是该模型不会推广到它在训练期间没有看到的数据，因此在训练和验证准确性之间会有很大的差异。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/ce9f75b52fa4151280a9ce1a5fb16ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHMVL43JavtT1c2jeAL3cg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">训练数据集上的完美准确性[图片由作者提供]</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/7e42a4957adf7d39762252027929c24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*Doc07XuXbp7iV12cr3j5Gg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测试数据集的准确性差[图片由作者提供]</p></figure><p id="2904" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">决策树的基本思想是可靠的，但是由于缺乏模型复杂性，它们往往表现不佳。每个基于树的算法都试图通过增加额外的复杂性来解决这个问题。</p><h2 id="99b6" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">随机森林</h2><p id="7b0c" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">就像森林是树的集合一样，随机森林只是决策树的集合。在我们深入研究随机森林在机器学习中的相关性之前，让我们简单地讨论一下随机森林是如何工作的。</p><p id="5b3c" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">假设我们正在用15棵树构建一个随机的森林分类器。随机森林通过所有15棵树运行数据点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3fc2" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">每棵树的预测可以认为是一个‘投票’，投票数最多的类就是随机森林的预测。听起来很简单，对吗？？这是最强大的机器学习算法之一，它的潜力是无穷的。</p><p id="d235" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated"><strong class="lu ir">如何提高随机森林的性能:</strong></p><p id="55dd" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">sklearn库提供的随机森林模型有大约19个模型参数。超参数调整时，我们需要调整的最重要的参数是:</p><ul class=""><li id="2978" class="mv mw iq lu b lv mm ly mn lf mx lj my ln mz mk na nb nc nd bi translated"><strong class="lu ir"> n_estimators </strong>:随机森林中决策树的数量。</li><li id="699e" class="mv mw iq lu b lv ne ly nf lf ng lj nh ln ni mk na nb nc nd bi translated"><strong class="lu ir"> max_depth </strong>:每个决策树允许进行的分裂次数。如果分割数太低，模型会对数据进行欠拟合，如果分割数太高，模型会过拟合。一般来说，我们的最大深度是3、5或7。</li><li id="c16f" class="mv mw iq lu b lv ne ly nf lf ng lj nh ln ni mk na nb nc nd bi translated"><strong class="lu ir"> max_features </strong>:显示给每个决策树的列数。传递给每个决策树的特定特征在每个决策树之间会有所不同。</li><li id="d30f" class="mv mw iq lu b lv ne ly nf lf ng lj nh ln ni mk na nb nc nd bi translated"><strong class="lu ir">Bootstrap</strong>:Bootstrap模型只需要选择列和行的子集来训练每个决策树。因此，模型变得不容易过度拟合数据。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="e096" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">注:通过应用bootstrap，数据集被分为袋内和袋外(OOB)数据集。这消除了创建验证数据集的需要。</p><ul class=""><li id="d5c4" class="mv mw iq lu b lv mm ly mn lf mx lj my ln mz mk na nb nc nd bi translated"><strong class="lu ir"> max_samples </strong>:如果bootstrap设置为true，可以传递给每个决策树的最大行数由max_samples参数控制。</li></ul><p id="2b2f" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">可用于超参数调整的建议参数网格:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="f0f9" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">好了，现在我们知道了如何建造一个随机森林，让我们来看看如何充分发挥它们的潜力！</p><h2 id="02f0" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">随机森林的用途:</strong></h2><p id="35bc" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">与许多其他机器学习算法不同，随机森林不仅可以用于预测能力。</p><ul class=""><li id="adbf" class="mv mw iq lu b lv mm ly mn lf mx lj my ln mz mk na nb nc nd bi translated"><strong class="lu ir">易于构建:</strong></li></ul><p id="a8c1" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">随机森林没有基于回归的算法或支持向量机那么多的模型假设。这使我们能够快速建立随机森林，以建立一个基础分数。</p><p id="5067" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">此外，即使没有超参数调整，随机森林也能提供一流的精度。与XGBoost等大型模型相比，超参数调整的过程要简单得多。</p><ul class=""><li id="1aa5" class="mv mw iq lu b lv mm ly mn lf mx lj my ln mz mk na nb nc nd bi translated"><strong class="lu ir">特征重要性</strong></li></ul><p id="abec" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">sklearn库提供的Random Forest类允许您获得数据集中每个列的特性重要性。这在与商业客户打交道时尤其有用。让我们通过考虑一个例子来进一步研究这个问题:</p><p id="c02f" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">让我们假设我们的客户是一个虚构的房地产公司(XYZ公司)。这家公司向我们提供了一个相对较小的数据集，记录了过去5年他们所在城市的所有销售情况，请求帮助他们将营销活动集中在正确的区域，并非常确定地预测房地产价格。他们提供的数据集中的要素是-买家的年龄、房产的位置、房产的土地面积、房屋/结构的年龄和房产的成本(因变量)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="fff6" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">一个很好的方法是通过随机森林。我们必须从建立一个随机森林开始，然后调整上面提到的超参数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="36bf" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">接着，我们可以通过随机森林计算特征重要性，我们可以很容易地找出哪个特征对模型预测贡献最大。假设随机森林告诉我们最重要的特征是买家的年龄。有了这些信息，房地产公司现在就可以根据人们的年龄有针对性地开展营销活动。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://scikit-learn.org/stable/auto_examples/ensemble/plot_forest_importances.html" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="b3fc" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">对于随机森林来说，整个过程需要几个小时才能完成，而对于其他特征选择算法(如Boruta)或通过比较回归模型的单个斜率来说，同样的过程会非常乏味。</p><ul class=""><li id="b48b" class="mv mw iq lu b lv mm ly mn lf mx lj my ln mz mk na nb nc nd bi translated"><strong class="lu ir">功能选择</strong></li></ul><p id="e75b" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">这可以认为是上一点的延伸。通过计算特征重要性，我们可以丢弃不太重要的特征，从而降低模型的维度，提高准确性并减少训练时间。</p><p id="2e34" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">执行特征选择的另一种方式是递归地混洗数据集中的各个特征，使得它们丢失由该列提供的信息。在这个修改的数据集上评估该模型，以查看分数是如何被影响的。特征越重要，它对分数的影响就越深远。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="5841" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h2><p id="55da" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">在本文中，我们广泛地研究了随机森林参数、超参数调优，以及在一个示例的帮助下，随机森林在业务用例中仍然非常重要的原因。</p><p id="ee55" class="pw-post-body-paragraph ls lt iq lu b lv mm jr lx ly mn ju ma lf mo mc md lj mp mf mg ln mq mi mj mk ij bi translated">了解随机森林的其他来源:</p><ul class=""><li id="0f9b" class="mv mw iq lu b lv mm ly mn lf mx lj my ln mz mk na nb nc nd bi translated"><a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html" rel="noopener ugc nofollow" target="_blank"> Sklearn文档</a></li><li id="cbbb" class="mv mw iq lu b lv ne ly nf lf ng lj nh ln ni mk na nb nc nd bi translated">YouTube:<a class="ae kv" href="https://www.youtube.com/watch?v=J4Wdy0Wc_xQ&amp;ab_channel=StatQuestwithJoshStarmer" rel="noopener ugc nofollow" target="_blank">Josh Stammer的StatsQuest】(个人最爱)</a></li><li id="a888" class="mv mw iq lu b lv ne ly nf lf ng lj nh ln ni mk na nb nc nd bi translated"><a class="ae kv" href="https://course18.fast.ai/lessonsml1/lesson1.html" rel="noopener ugc nofollow" target="_blank"> FastAI课程</a></li></ul></div></div>    
</body>
</html>