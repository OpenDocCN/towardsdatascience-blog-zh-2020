<html>
<head>
<title>Practical Pandas: Synthetic Store Sales Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实用熊猫:合成商店销售分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/practical-pandas-synthetic-store-sales-analysis-110e904a84fc?source=collection_archive---------26-----------------------#2020-09-24">https://towardsdatascience.com/practical-pandas-synthetic-store-sales-analysis-110e904a84fc?source=collection_archive---------26-----------------------#2020-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d7a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">练习完成数据分析任务的技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8156c2ca25e0429295929495ea2c0f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFG3raySu7JGRH07nYg5Qw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伯纳德·赫曼特在<a class="ae ky" href="https://unsplash.com/s/photos/store?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6065" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我跳过了我提到熊猫在数据科学领域的伟大特征和优势的部分。</p><p id="51cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章更像是一个实践指南，展示了如何在数据分析中使用熊猫。我还将尝试为数据分析任务提供一种半结构化的方法。</p><p id="6034" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我称之为“合成的”，因为这些数据是随机产生的。让我们从创建商店销售数据集开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2a67" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="ecb1" class="ma mb it lw b gy mg md l me mf">stores = pd.Series(['A','B','C','D']*125).sample(500)</span><span id="b636" class="ma mb it lw b gy mg md l me mf">cities = pd.Series(['Rome','Madrid','Houston']*200).sample(500). reset_index(drop = True)</span></pre><p id="ad79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用熊猫的<strong class="lb iu">样本</strong>功能创建了两个随机系列的商店和城市。样本大小必须等于或小于原始系列的大小。这就是我们通过乘以常数来扩展列表的原因。</p><p id="63d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是时候将它们与日期和销售额一起放在一个数据框架中了。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ecc6" class="ma mb it lw b gy mc md l me mf">df = pd.DataFrame({<br/>'day':np.random.randint(1,30, size=500),    'month':np.random.randint(1,12, size=500),<br/>'year':2020,<br/>'store':stores,<br/>'city':cities,<br/>'product1':np.random.randint(50, size=500),<br/>'product2':np.random.randint(40, size=500),<br/>'product3':np.random.randint(30, size=500)}<br/>)</span><span id="18b2" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/85707648494300ba5187b4309007f78c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*V4zEF0YN6f518jbwxChd5w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="93c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于商店-城市-日期组合列出了3种产品的销售量。最好也有一个“日期”列，将单独的日、月和年组合在一起。我们将在“年份”列之后放置新的“日期”列，这可以通过<strong class="lb iu">插入</strong>函数来完成。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3e8d" class="ma mb it lw b gy mc md l me mf">df.insert(3, 'date', pd.to_datetime(df[['day','month','year']]))</span><span id="9835" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/9ac082d1ab77f1b93a729f328cc06860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*GLjItWV3qhFY3lYaof19kg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="d3bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">index函数的第一个参数指示新列的位置。</p><p id="09ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:由于我们随机生成数据，因此可能会产生一个不存在的日期2月30日。在这种情况下，to_datetime函数将引发一个错误，指出“日期超出了该月的范围”。你可以把你的天数限制在29天，或者重新运行随机函数。</p><p id="44d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有了合成数据。开始分析的一个方法是检查销售量是否有季节性。我们可以使用<strong class="lb iu"> groupby </strong>函数按月对销售额进行分组，然后绘制结果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="69a1" class="ma mb it lw b gy mc md l me mf">df[['month','product1','product2','product3']].groupby('month')\<br/>.mean().plot(figsize=(10,6), fontsize=12, title='Monthly Sales of Products')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/ca83d2fdc554525556c98d2a25b04533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*A4xujzZeWjrS6ON9mJisxg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="f012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">产品1和2似乎具有季节性，而产品3更稳定。我们已经检查了月平均销售额。</p><p id="06fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同商店-城市组合的销售量可以提供有价值的信息，这也可以通过groupby函数来实现。我们将使用pandas的Style属性使结果比普通数字更有吸引力，而不是绘制结果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="db6a" class="ma mb it lw b gy mc md l me mf">df[['store','city','product1','product2','product3']]\<br/>.groupby(['store','city'])\<br/>.mean().style.highlight_max(color='lightgreen', axis=0)\<br/>.highlight_min(color='orange', axis=0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/561cc6809f4b618292a1557e0aeff20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*qBODv9QkRdKMUizdQbD1Tw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0d83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了商店-城市平均销售额之外，还突出显示了每列中的最小值和最大值。在报告中使用它肯定比简单的数字更有吸引力。</p><p id="2c6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有其他可用的样式选项。我们再做一个。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="80f2" class="ma mb it lw b gy mc md l me mf">df[['store','city','product1','product2','product3']]\<br/>.groupby(['store','city'])\<br/>.mean().style.bar(color='lightgreen')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/782bac6cda6148e4e94f627b99b73463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*HWfX-mDhzpRowlRO5xnf0A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="75af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">条形的大小与列中的值成比例。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="8963" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据集将“日”、“月”和“年”作为单独的列。我们将它们组合成一个具有适当数据类型的“日期”列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/a0c917f46e9672e348dbdaeae7e4d565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*-7ERLYivqqQ_CpaRQSiRWA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="5303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在典型的分析中，我们可能有很多列，所以消除冗余或重复的列是一个好的做法。因此，我们可以删除“日”、“月”和“年”列，因为它们提供的数据存储在“日期”列中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8c04" class="ma mb it lw b gy mc md l me mf">df.drop(['day','month','year'], axis=1, inplace=True)</span><span id="79cc" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/6a0360e4065a6f09284a6b375909bbdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*qxcl2bAJs6jDEMEOxMeS_A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="5bbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在分析中使用了“月”列。我们仍然可以通过使用<strong class="lb iu"> dt </strong>访问器来使用日期的各个部分。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4432" class="ma mb it lw b gy mc md l me mf">df['date'].dt.month[:5]<br/>0     8 <br/>1    11 <br/>2     8 <br/>3     4 <br/>4    11</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="d201" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一开始，我们检查月平均销售量。在某些情况下，月平均值可能不够详细。熊猫在选择频率方面非常灵活。</p><p id="9334" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码将绘制product1的10天平均销售额。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9b27" class="ma mb it lw b gy mc md l me mf">df[['date','product1']].groupby('date').mean()\<br/>.resample('10D').mean().plot(figsize=(10,6), fontsize=12,<br/>title="10-Day Average Sales")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/d3a35714404ddb596c09bd159837894b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*yo1GL5gkhhWqjAPs-MdJEg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="73f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先按日期对销售额进行分组，这给出了每日的平均值。然后使用重采样功能将日期下采样到10天周期。用于取10天期间平均值的平均值。最后，绘制结果。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="fa46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以用熊猫来创建密度图。例如，我们可以使用kde函数来绘制销售量的密度分布。KDE(核密度估计)是一种估计随机变量概率密度函数的非参数方法。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="911c" class="ma mb it lw b gy mc md l me mf">subset = df[['store','city','product1','product2','product3']]</span><span id="454a" class="ma mb it lw b gy mg md l me mf">subset.plot.kde(figsize=(12,6), alpha=1, fontsize=12)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/eb4f6e19e50437f9c2ff60e69d473695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3n1eUKg98SrOe6F_k1pcQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="4157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，KDE是一个估计，而不是实际的概率分布。这就是我们在图中看到负值的原因。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="df4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更具体地分析一下。例如，您可能希望看到连续两天的平均销售额之间的最大增加或减少。例如，我们将在商店a中进行检查。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9987" class="ma mb it lw b gy mc md l me mf">df[df.store == 'A'].groupby('date').mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/cc475dd8b7e5c3cbd36238e674350fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*IJDWTXQpVyZOYR7fWcj0ww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="86a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是商店a中销售量的日平均值。<strong class="lb iu"> diff </strong>函数返回连续两行之间的差异。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bec1" class="ma mb it lw b gy mc md l me mf">df[df.store == 'A']\<br/>.groupby('date').mean().diff().sort_values(by='product1')[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/41e9c94ff788ebf2be8eae90f1ef41cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*599QSVxJ7u8U2I7dxSIG7Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="bb74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经按产品1对值进行了升序排序，以查看产品1销售量的最大降幅。2020年10月28日，产品1的销售量比前一天减少了37。</p><p id="d08d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，我们可以发现product2中的增幅最大。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d882" class="ma mb it lw b gy mc md l me mf">df[df.store == 'A'].groupby('date').mean().diff().\<br/>sort_values(by='product2', ascending=False)[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/b3791ebf8af49d1a0028ad756e40f459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*HIGI-KPWIbAGROktTHPKfg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="446b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经介绍了一些可以在典型的数据分析任务中使用的技术。熊猫的能力远远超出了这里讨论的技术。当你需要完成任务时，你会发现更多。</p><p id="4d34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>