<html>
<head>
<title>SHAP: How to Interpret Machine Learning Models With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SHAP:如何用Python解释机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/shap-how-to-interpret-machine-learning-models-with-python-2323f5af4be9?source=collection_archive---------8-----------------------#2020-11-09">https://towardsdatascience.com/shap-how-to-interpret-machine-learning-models-with-python-2323f5af4be9?source=collection_archive---------8-----------------------#2020-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f92b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用一个函数调用就能解释的机器学习</h2></div><p id="819d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有人喜欢黑箱模型。有了复杂的算法和大量的数据准备，建立好的模型是很容易的，但是内部发生了什么？这就是<em class="le">可解释的AI和</em>出现的地方。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/ce5f1a752a863dbe887c9b1b61665282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P2ucyD6hQpHnS2E5.jpg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">在<a class="ae lv" href="https://unsplash.com/s/photos/abstract?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae lv" href="https://unsplash.com/@pawel_czerwinski?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">paweczerwiński</a>拍摄的照片</p></figure><p id="e353" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不想看书？看看我关于这个主题的视频:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="108b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天你将学习如何向大众解释机器学习模型。我们将使用三个不同的图进行解释——一个用于单个预测，一个用于单个变量，一个用于整个数据集。</p><p id="5fdd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">读完这篇文章后，你应该对解释机器学习模型的预测和每个预测器的重要性没有任何问题。</p><p id="39d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章的结构如下:</p><ul class=""><li id="43a0" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">什么是SHAP？</li><li id="4ff3" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">模特培训</li><li id="572e" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">模型解释</li><li id="a1c6" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">结论</li></ul></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="d753" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">什么是SHAP？</h1><p id="752d" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">我们来看看创作者的一份官方声明:</p><blockquote class="nq nr ns"><p id="98a5" class="ki kj le kk b kl km ju kn ko kp jx kq nt ks kt ku nu kw kx ky nv la lb lc ld im bi translated"><em class="it">SHAP(SHapley Additive explaints)是一种解释任何机器学习模型输出的博弈论方法。它将最优信用分配与使用博弈论及其相关扩展的经典Shapley值的本地解释联系起来。(</em>来源:<a class="ae lv" href="https://github.com/slundberg/shap)" rel="noopener ugc nofollow" target="_blank">https://github.com/slundberg/sha<em class="it">p)</em></a></p></blockquote><p id="3c35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是许多花哨的词汇，但这里有一件你应该知道的事情——SHAP帮助我们用匀称的值来解释机器学习模型。</p><p id="00d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">但是什么是匀称的价值观呢？</em>简而言之，它们是每个预测器(特征)在机器学习模型中的贡献的度量。这肯定是网络上最不花哨的定义，但我认为它很容易理解。</p><p id="ea5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们接下来开始训练我们的模型，以便我们可以尽快开始解释。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="a669" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">模特培训</h1><p id="5b2f" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">为了解释机器学习模型，我们首先需要一个模型——所以让我们基于<a class="ae lv" href="https://www.kaggle.com/piyushagni5/white-wine-quality" rel="noopener ugc nofollow" target="_blank">葡萄酒质量数据集</a>创建一个模型。下面是将它加载到Python中的方法:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nx"><img src="../Images/5827731c42b93dc3c80f0c38ea1fe48f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*INczh9Vg9j6-H5f3Fzqtog.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">葡萄酒数据集标题(图片由作者提供)</p></figure><p id="7981" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有必要清理数据—所有数据类型都是数字，并且没有丢失数据。训练/测试分割是下一步。列<code class="fe ny nz oa ob b">quality</code>是目标变量，它可以是<em class="le">好的</em>或<em class="le">坏的</em>。为了获得相同的分割，请将<code class="fe ny nz oa ob b">random_state</code>的值设置为42:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="85b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们准备训练模型。<code class="fe ny nz oa ob b">XGBoost</code>分类器会完成这项工作，所以确保首先安装它(<code class="fe ny nz oa ob b">pip install xgboost</code>)。为了再现性，再次将<code class="fe ny nz oa ob b">random_state</code>的值设置为42:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="7c26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">开箱即用，我们有80%的准确率(<code class="fe ny nz oa ob b">score</code>)。现在我们有了开始解释这个模型所需要的一切。我们将在下一节中介绍这一点。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="5cc8" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">模型解释</h1><p id="1732" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">为了通过SHAP解释这个模型，我们首先需要安装这个库。您可以通过从终端执行<code class="fe ny nz oa ob b">pip install shap</code>来完成。然后我们可以导入它，基于XGBoost模型制作一个解释器，最后计算SHAP值:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><p id="cfc8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们准备好出发了！</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="6d67" class="oc mu it bd mv od oe dn mz of og dp nd kr oh oi nf kv oj ok nh kz ol om nj on bi translated">解释单一预测</h2><p id="e143" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">让我们从小而简单开始。有了SHAP，我们可以对一个单一的预测做出解释。SHAP图显示了有助于将输出从基础值(平均模型输出)推至实际预测值的特征。</p><p id="8883" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">红色表示将预测值推高的特征，蓝色表示相反的特征。</p><p id="2a47" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看一款被归类为<code class="fe ny nz oa ob b">bad</code>的葡萄酒的解读图:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oo"><img src="../Images/a8bd58d9d7c1e0ac95fc08cd8851833f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xm11oMEzB8XwOsnORAPegQ.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">对劣质葡萄酒的解读(图片由作者提供)</p></figure><p id="e54a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个分类数据集，不用太担心<code class="fe ny nz oa ob b">f(x)</code>值。只有<code class="fe ny nz oa ob b">residual sugar</code>属性将这个实例推向了好的葡萄酒质量，但正如我们所看到的，这还不够。</p><p id="d341" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们来看看一款<code class="fe ny nz oa ob b">good</code>葡萄酒的解读图:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi op"><img src="../Images/e9b7e5dd32c544df7c570cd429ef7aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tw1WALlvOGFHlO5_VQpBqA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">一款优质葡萄酒的诠释(图片由作者提供)</p></figure><p id="eab0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里完全是另一个故事。您现在知道了如何解释单个预测，所以让我们稍微增加一点趣味，看看如何解释单个特征对模型输出的影响。</p><h2 id="ff33" class="oc mu it bd mv od oe dn mz of og dp nd kr oh oi nf kv oj ok nh kz ol om nj on bi translated">解释单一特征</h2><p id="b211" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">为了了解单个要素对模型输出的影响，我们可以绘制该要素的SHAP值与数据集中所有实例的要素值的关系图。</p><p id="bb45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下图显示了随着<code class="fe ny nz oa ob b">alcohol</code>值的变化，葡萄酒质量的变化。单一值的垂直离差显示了与其他特征的交互作用。SHAP自动选择另一个特征来着色，以使这些交互更容易看到:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oq"><img src="../Images/8d93785d878d14c2dc4e16a38d043885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hxd3EGUzKG0uYqX4Q8wZcw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">单个特征的解释(图片由作者提供)</p></figure><p id="a2a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们检查整个数据集，以确定哪些要素对模型最重要，以及它们如何影响预测。</p><h2 id="3688" class="oc mu it bd mv od oe dn mz of og dp nd kr oh oi nf kv oj ok nh kz ol om nj on bi translated">解释整个数据集</h2><p id="26ae" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">通过绘制摘要图表，我们可以直观地了解特性的重要性及其对预测的影响。下面的方法根据所有样本的SHAP量值总和对要素进行排序。它还使用SHAP值来显示每个要素的影响分布。</p><p id="0792" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">颜色代表特征值，红色表示高，蓝色表示低。接下来我们来看看剧情:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nw lx l"/></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi or"><img src="../Images/59d454371463caca83d64991e7628478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lpWdk6x_vE_jIy9wAJrDw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">整个模型的解释(图片由作者提供)</p></figure><p id="818d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解释为:</p><ul class=""><li id="1889" class="ly lz it kk b kl km ko kp kr ma kv mb kz mc ld md me mf mg bi translated">高酒精值增加了预测的葡萄酒质量</li><li id="bc83" class="ly lz it kk b kl mh ko mi kr mj kv mk kz ml ld md me mf mg bi translated">低挥发性酸度提高了预测的葡萄酒质量</li></ul><p id="ac16" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您现在已经知道了足够开始解释您自己的模型。让我们在下一部分总结一下。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="5512" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">离别赠言</h1><p id="6a04" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">起初，解释机器学习模型似乎很复杂，但像SHAP这样的库让一切变得像函数调用一样简单。我们甚至不必担心数据可视化，因为有内置的函数可以实现这一点。</p><p id="48dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章应该为您提供更高级的解释可视化的基础，并为您的进一步学习提供足够的信息。</p><p id="df87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你对SHAP有什么看法？请在下面的评论区告诉我。</p><h2 id="2cb1" class="oc mu it bd mv od oe dn mz of og dp nd kr oh oi nf kv oj ok nh kz ol om nj on bi translated"><a class="ae lv" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">加入我的私人邮件列表，获取更多有用的见解。</a></h2></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="ca24" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">喜欢这篇文章吗？成为</em> <a class="ae lv" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="le">中等会员</em> </a> <em class="le">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="os ot gp gr ou ov"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">medium.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj lp ov"/></div></div></a></div></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="1ae8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">原载于2020年11月9日https://betterdatascience.com</em><a class="ae lv" href="https://betterdatascience.com/shap/" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a><em class="le">。</em></p></div></div>    
</body>
</html>