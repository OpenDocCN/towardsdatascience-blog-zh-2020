<html>
<head>
<title>Automate Tableau Data Sources refresh using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动刷新Tableau数据源</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/refresh-tableau-server-data-source-and-workbooks-using-python-4baa99cc3b93?source=collection_archive---------13-----------------------#2020-10-07">https://towardsdatascience.com/refresh-tableau-server-data-source-and-workbooks-using-python-4baa99cc3b93?source=collection_archive---------13-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="681f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Tableau服务器客户端(TSC)更新数据源和工作簿</h2></div><p id="03fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您希望您的仪表板在数据可用的正确时刻准备好。在这种情况下，您会发现使用一个<strong class="kk iu">计划</strong>任务是不够的，因为您不知道填充过程何时结束！</p><p id="69f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">唯一缺失的部分是一个在触发事件发生后刷新仪表板的自动化过程，比如在执行了<strong class="kk iu"> ETL </strong>的最后一步之后，或者当你把<strong class="kk iu">新文件加载</strong>到亚马逊S3桶中时。</p><p id="a666" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将解释如何使用Python刷新或更新现有的<strong class="kk iu"> Tableau数据源</strong>和<strong class="kk iu">工作簿</strong>来解决这些问题。我建议查看这个<a class="ae le" rel="noopener" target="_blank" href="/automate-getting-tableau-server-users-with-rest-api-and-python-228fe6e7677f">以前的帖子</a>来看看其他用例。</p><p id="e4dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的代码显示了如何获取ID并执行数据源或工作簿刷新。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="540f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果没有安装Python，我推荐使用Miniconda。你可以在<a class="ae le" rel="noopener" target="_blank" href="/configuring-jupyter-notebook-in-windows-subsystem-linux-wsl2-c757893e9d69">这篇文章中看到更多细节。</a></p><h1 id="1fc0" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">为Python安装REST API库</h1><p id="f3a1" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">首先，您需要使用pip安装Tableau服务器客户端(TSC ),这是位于<a class="ae le" href="https://tableau.github.io/server-client-python/docs/#install-tsc" rel="noopener ugc nofollow" target="_blank">https://Tableau . github . io/Server-Client-python/docs/# install-TSC</a>的文档中推荐的</p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="753c" class="mo ln it mk b gy mp mq l mr ms">pip install tableauserverclient<br/>pip install tableauserverclient --upgrade</span></pre><h1 id="29e5" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">配置个人访问令牌</h1><p id="0a78" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">我们将使用<a class="ae le" href="https://help.tableau.com/current/server/en-us/security_personal_access_tokens.htm" rel="noopener ugc nofollow" target="_blank">个人访问令牌或PAT </a>进行连接。下一步是到右上角的Tableau服务器，选择我的帐户设置。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/1efa6c11437031e3b0959e4bf2c9d14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:312/format:webp/1*kSNZOCe0DrZalzNYV4m-hw.png"/></div></figure><p id="edc4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">向下滚动并复制个人访问令牌的令牌密码</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/054567c67323a6e273c4df25651ecbc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgrk_twIW2j-oGALfa9VWA.png"/></div></div></figure><p id="747f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您没有看到个人访问令牌选项，您可以尝试使用链接激活，用您的站点替换<site>:</site></p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="d222" class="mo ln it mk b gy mp mq l mr ms"><a class="ae le" href="https://10ax.online.tableau.com/?personalAccessTokensEnabled=true#/site/cristiansaavedradev226290/home" rel="noopener ugc nofollow" target="_blank">https://10ax.online.tableau.com/?personalAccessTokensEnabled=true#/site/&lt;site&gt;/home</a></span></pre><h1 id="64c7" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">关系</h1><p id="ff94" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">为了简化，我用变量创建了类<strong class="kk iu">TableauServerConnection</strong>:</p><ul class=""><li id="6162" class="nb nc it kk b kl km ko kp kr nd kv ne kz nf ld ng nh ni nj bi translated">【服务器_网址】https://10ax.online.tableau.com/，完整的HTTP地址如<a class="ae le" href="https://10ax.online.tableau.com/" rel="noopener ugc nofollow" target="_blank">一样</a></li><li id="a75c" class="nb nc it kk b kl nk ko nl kr nm kv nn kz no ld ng nh ni nj bi translated"><strong class="kk iu"> token_name </strong>是之前制作的令牌的标识名</li><li id="47cc" class="nb nc it kk b kl nk ko nl kr nm kv nn kz no ld ng nh ni nj bi translated"><strong class="kk iu">令牌_秘密。这是尚未创建的令牌的秘密文本</strong></li><li id="98a6" class="nb nc it kk b kl nk ko nl kr nm kv nn kz no ld ng nh ni nj bi translated"><strong class="kk iu">地点。</strong>它的<strong class="kk iu"> </strong>是站点名称。如果需要连接到缺省值，则让它为空。</li></ul><p id="9e9e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您的连接将如下所示:</p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="85ae" class="mo ln it mk b gy mp mq l mr ms">tsConn = TableauServerConnection('https://10ax.online.tableau.com/','APIToken','copyHereTheTokenSecret')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi np"><img src="../Images/49090860f54352b60d1de8f1c37c74a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wv4wJxVaCSRd1SctPyCOCg.png"/></div></div></figure><h1 id="c593" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">数据源</h1><p id="0f8c" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">下一步是连接到Tableau服务器并刷新现有的数据源。要做到这一点，你需要身份证。因为不容易找到它，所以我创建了函数<strong class="kk iu">getdatasourcestableuserver</strong>，它列出了使用先前连接的所有数据源。</p><p id="05b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将使用Python Pandas来搜索ID，用<strong class="kk iu">返回的列表创建一个数据框</strong>函数:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nq"><img src="../Images/919b443cd8f500a1c1426b67abd63256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFtuOZcU_4UJ_4FZBwm6FQ.png"/></div></div></figure><p id="10c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么你可以得到过滤数据帧的ID如下:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/ac6d67dd29bd660db69dbec5c9480aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*DANoJrRCX5rwgFxFqlmoaA.png"/></div></figure><p id="9448" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后您可以使用<strong class="kk iu">refreshdatasourcetableuserver</strong>按ID刷新数据源，如下所示:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/ffcc0c564c079c71963f868098a4e8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*YHXYQczl1gSh7643YloJNQ.png"/></div></figure><p id="312f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来的几行是有魔力的。如果你想知道更多关于正在做的事情，你可以在<a class="ae le" href="https://tableau.github.io/server-client-python/docs/api-ref#data-sources" rel="noopener ugc nofollow" target="_blank">文档页面</a> <strong class="kk iu">找到信息。</strong></p><pre class="lf lg lh li gt mj mk ml mm aw mn bi"><span id="a11c" class="mo ln it mk b gy mp mq l mr ms">refresh datasource = server.datasources.get_by_id(datasource_id)<br/>refreshed_datasource = server.datasources.refresh(datasource)</span></pre><h1 id="930f" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">工作簿</h1><p id="5f90" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">在某些情况下，您有一个工作簿连接到数据源，同时，他的数据源也需要刷新。</p><p id="1d87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与上一步一样，工作簿需要ID来执行刷新。为了便于ID的搜索，以与上一步相同的方式使用函数<strong class="kk iu">getWorkBooksTableauServer</strong>。</p><p id="3f3a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要刷新工作簿，请按ID使用<strong class="kk iu">refreshdatasourcetableuserver</strong>函数，如下所示:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f2196b3a48ba47ade1b63ae596bdcb19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*nwUUd8SoGY8q82_v3czETw.png"/></div></figure></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="62f7" class="lm ln it bd lo lp ob lr ls lt oc lv lw jz od ka ly kc oe kd ma kf of kg mc md bi translated">谢谢</h1><p id="d053" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">最后，我要感谢Carlos Lobera，他把我介绍给了<strong class="kk iu"> Evan Slotnick </strong>、<strong class="kk iu"> Anir Agarwal </strong>和<strong class="kk iu"> Elliott Stam </strong>，他们打开了Tableau Server日常任务自动化的大门。</p><p id="0fcb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">特别感谢<strong class="kk iu"> Timothy Vermeiren </strong>和<strong class="kk iu"> Francisco Pagliaricci </strong>使用URL激活个人访问令牌。</p><p id="5a4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://medium.com/@cristiansaavedra" rel="noopener">快乐万岁！</a></p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="ad93" class="lm ln it bd lo lp ob lr ls lt oc lv lw jz od ka ly kc oe kd ma kf of kg mc md bi translated">有用的资源</h1><div class="og oh gp gr oi oj"><a href="https://tableau.github.io/server-client-python/docs/" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">开始</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">使用Tableau服务器客户端(TSC)库来提高您在与Tableau服务器REST交互时的工作效率…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">tableau.github.io</p></div></div><div class="os l"><div class="ot l ou ov ow os ox mu oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://help.tableau.com/current/api/rest_api/en-us/REST/rest_api.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">Tableau服务器REST API</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">通过Tableau Server REST API，您可以使用HTTP以编程方式管理和更改Tableau服务器资源。的…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">help.tableau.com</p></div></div><div class="os l"><div class="oy l ou ov ow os ox mu oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://help.tableau.com/current/server/en-us/security_personal_access_tokens.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">个人访问令牌</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">个人访问令牌为Tableau服务器用户提供了创建长期身份验证令牌的能力。代币…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">help.tableau.com</p></div></div><div class="os l"><div class="oz l ou ov ow os ox mu oj"/></div></div></a></div></div></div>    
</body>
</html>