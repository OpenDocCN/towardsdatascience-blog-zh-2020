<html>
<head>
<title>On Distribution of Z’s in VAE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Z在VAE的分布</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/on-distribution-of-zs-in-vae-bb9a05b530c6?source=collection_archive---------25-----------------------#2020-10-02">https://towardsdatascience.com/on-distribution-of-zs-in-vae-bb9a05b530c6?source=collection_archive---------25-----------------------#2020-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1f65" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们是否正确地使用了创成部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4ad95b5af6987599e4082f3094d44e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJmfLDopQTpbYUjkko62eA.jpeg"/></div></div></figure><p id="f7d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://unsplash.com/photos/Hba7In7vnoM" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/Hba7In7vnoM</a></p><h1 id="fd0f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated"><strong class="ak">动机</strong></h1><p id="1c81" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这个帖子的动机是在学习VAE的理论和遵循它的一般实现时提出的。正如我们所知，VAE由两个网络构成:一个(<strong class="kt ir">编码器</strong>)被训练成将真实数据映射成高斯分布，旨在优化其与给定分布(通常为标准正态分布)的KL距离。)和另一个(<strong class="kt ir">解码器</strong>)来将该高斯分布的样本(<strong class="kt ir">Z</strong>s)映射成实数据。也就是说，最终目标是解码器将能够从通用分布中生成数据，但是它具有双重目标</p><ul class=""><li id="5b65" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">越来越接近标准的正常距离。</li><li id="bc26" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">由解码器生成良好的数据样本</li></ul><p id="6165" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">VAE通常使用<a class="ae ln" href="https://www.cs.princeton.edu/courses/archive/fall11/cos597C/lectures/variational-inference-i.pdf" rel="noopener ugc nofollow" target="_blank"> ELBO </a>作为损失函数。该函数用于解决<strong class="kt ir">变分推理</strong> ( <strong class="kt ir"> VI </strong>)问题和早期热力学。它旨在研究给定观测数据的潜在变量的分布。</p><p id="cb88" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">虽然ELBO看起来是用于生成给定现有真实数据的数据的正确函数(这实际上是VI的经典定义)，但是不清楚为什么会期望ELBO收敛到normal dist。</p><p id="a331" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了开始分析性的讨论，让我们先介绍一下埃尔伯公式。</p><p id="0d6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的目标是找到潜在变量<strong class="kt ir"/>(<strong class="kt ir">Z</strong>s)的最优分布<strong class="kt ir"> Q </strong>，使其与P(Z|X)的KL距离最小，其中X是真实数据</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b84e0fe671a2229cb6af35efddc88969.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*rBMDFsXMyuQdX_B-rNYHsg.png"/></div></figure><p id="012b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以这样写KL:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/9757c5214bce6a0a4ec5ea26e6df5236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*7TF0UKz1ukd9C4HrUmdTJg.png"/></div></figure><p id="7c25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这导致了以下情况:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/22be9715ba03bf93825e88540412e400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*uFPl7jwpkDZCng-umQZcPQ.png"/></div></figure><p id="c87a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">P(Z)是Z的先验分布，并假设为标准正态分布</p><p id="7c58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">爱尔博是第二任。最大化ELBO等价于最小化KL散度。</p><p id="0050" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">考虑到VAE的双重目标和爱尔波公式的代数结构，有两个问题:</p><ul class=""><li id="6c39" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">ELBO的KL项(在<strong class="kt ir"> Q </strong>和之前的<strong class="kt ir"> P </strong>之间)是否收敛到标准正常距离？</li><li id="edeb" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">假设第一个问题的答案是肯定的，那么整个ELBO呢？</li></ul><p id="b90b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在接下来的部分中，我将研究这两个问题并给出一些数值实验</p><h1 id="3944" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">KL收敛</h1><p id="a3c6" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">为了证明一个函数收敛到某一点，我们必须证明这个点是一个极值，并且存在一个时间动力学，在这个时间动力学中这个点是稳定的。我们将证明对于ELBO (0，1)的KL项满足这些条件。由于计算损失函数的常用方法是蒙特卡罗估算法，我们将在下一节中说明(0，1)是解析解和蒙特卡罗的最小值。在下一节中，我们将展示这一点的稳定性。</p><h2 id="cfe4" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated"><strong class="ak">高斯解析公式</strong></h2><p id="583e" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">假设我们对寻找两个高斯分布之间的KL距离感兴趣，一个由<strong class="kt ir"> P </strong>表示，另一个是标准正态分布(<strong class="kt ir"> S </strong>)。</p><p id="275b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于一个<strong class="kt ir"> K </strong>维高斯，KL散度遵循以下公式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9a63ef6bf99c373f1ac450c0fc6e4a64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*T4E_DpATApiDy8HEqBnXRw.png"/></div></figure><p id="cdd9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">(<strong class="kt ir">备注</strong>:在VAE我们总是假设协方差矩阵是对角的。因为协方差矩阵类似于对角矩阵，并且类似的矩阵共享它们的迹和行列式，所以我们可以知道对角假设是充分的</p><p id="2b8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了简单起见，我们可以用不同的方式来写这个公式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/9163500a3eb47bbf114a0625313413bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*Rl9DF8LIpQl5iFvSwNLq6w.png"/></div></figure><p id="7321" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">F和G是在0 (F)和1 (G)处具有唯一零点的非负函数。为了说明，我们提出平面空间<strong class="kt ir">，σ </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/934f97d894e4889488731f5efeaffb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ocaD5c-l6ZvBv6QdXYm9fA.png"/></div></figure><p id="a55e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">KL图具有这种形式</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/efbd4dfd0a7488fd9469d988614ff627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*deybhW5FN0Mn5mZECbSRWQ.png"/></div></figure><p id="65fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以看到，当我们遵循分析方法时，标准正态分布是一个唯一的最小值。</p><p id="2792" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，这是KL术语的最小值，而不是ELBO术语的最小值</p><p id="d443" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通常我们不用解析形式而是用蒙特卡罗估计来求解VAE。我们将在下一节讨论这一点。</p><h2 id="9f07" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">蒙特卡洛</h2><p id="622f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">让我们来表示</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/fe9daab050f81a05ef24b03e4c33a52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:268/format:webp/1*DYkVfhd1iW49MHRH6gTZGA.png"/></div></figure><p id="9835" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们如前所述</p><p id="6e52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">P(Z)</strong>-先验分布(标准正态分布)</p><p id="dad0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> X </strong> -数据</p><p id="6c63" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们有爱尔波公式</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/fc4c46562fe521cb75904d4b75bc907d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*SMA0VCuNJ-blnJVdgAu0Hw.png"/></div></figure><p id="b74e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我们对KL的收敛性感兴趣，所以我们关注<strong class="kt ir">、σ </strong>。很明显，解码器对Z的依赖性是难以控制的。因为它是通过解码器的隐藏层获得的。我们将遵守KL项。</p><p id="4bc4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">计算KL散度的常用方法是假设高斯分布并使用<strong class="kt ir">蒙特卡罗</strong>估计量</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4414f18ebad06b3b9e368e6044017294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*EPpD369oX9w3U8jxc8py0g.png"/></div></figure><p id="61fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们为每个数据项显式地编写这些术语，我们将得到</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/547f6fb3000212405f2235d6107ce7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*xH_WYohu3Juk9G-8TDx-hQ.png"/></div></figure><p id="47c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们对批量和Z的样本进行平均时，我们得到</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/ba30b34ff234aaa27fae589d43fc1a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*vbXF-0iQHNn4pSnHUqUk2Q.png"/></div></figure><p id="c65e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">回忆</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/11825c91db766066edc8a885e516f353.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*M5zZ8QkOEqx6dgpx5PEhrg.png"/></div></figure><p id="8b8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们得到了与解析解相同的结果。很明显，如果KL散度收敛到一个点(高斯分布)，它将是标准的正态分布。仍然不清楚为什么会发生这种趋同。</p><h2 id="6aeb" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">动力系统方法</h2><p id="785c" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">以便在学习过程中产生对过程进行重新分级的直觉。我们来考虑一下平原<strong class="kt ir"> - σ。</strong><strong class="kt ir"/>潜在的学习过程可能遵循红色或蓝色曲线(抱歉，螺旋形更酷)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/75a4293728c74810051e9982029e13a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*GOaBPGDBZtZZ3WFh1Ez4Og.png"/></div></figure><p id="e958" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了了解为什么唯一的最小值是稳定的不动点，我们必须观察Kl散度。给定一个分布函数KL是一个非负函数，只有相同的函数才会得到0。这使得它成为<a class="ae ln" href="https://www.math24.net/method-lyapunov-functions" rel="noopener ugc nofollow" target="_blank"> <em class="nx">李雅普诺夫函数</em> </a>的良好候选</p><p id="9e15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们有以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/7bb000a0d971ccc26fd32f4387396102.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*ukg62ps9g8FL7KFdq5D8NA.png"/></div></figure><p id="af31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们考虑一个有争议的时间</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/4d3878a3dec787cc94dfe3b4d75ef0e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*C9nue7lsCjh0owfCUKTNcw.png"/></div></figure><p id="9243" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们可以计算KL散度的时间导数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/97d89cb758d184fb07856cfd081e6750.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*8fXNi8DJiRSCZwjADisynw.png"/></div></figure><p id="6aea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此KL是非负且向内的，即(0，1)是稳定的不动点。</p><h2 id="5789" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">中间总结</h2><p id="e78b" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们已经看到使用两种方法论，0，1是ELBO的KL项的稳定不动点。如果我们假设整个ELBO都需要用于训练，那么就有两种可能的选择:</p><ul class=""><li id="8ff7" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">我们需要整个ELBO，因为它的条件概率项(P(X|Z)达到最小值(0，1)并改善了整个系统</li><li id="f2c5" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">ELBO在(0，1)上没有得到它的最小值，但是仍然提高了VAE</li></ul><p id="72b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一方面，如果我们可以在没有解码器的情况下解释到(0，1)的收敛，并保持整体结果，也许我们不需要条件分布项</p><h1 id="7124" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">实验</h1><h2 id="71fe" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">平均场定理</h2><p id="fdf2" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在这一节中，我展示了我所做的一些试验，以回答我在上一节中提出的问题。我用这个平均场算法</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/df2189a1bbfbab9ffdd0c3aa5714f522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wg1p5FKHM4t2i5r7GiWmrw.png"/></div></div></figure><p id="63bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该图显示了四个框架工程的衰减:</p><p id="197a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">蓝色</strong>当前使用的方法</p><p id="10d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">绿色</strong>-蒙特卡罗估算器，仅在编码器上进行训练</p><p id="4705" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">红色</strong>-仅在编码器上训练的两个高斯分布的解析公式</p><p id="7f91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">黑色</strong>-从troch.randn采样的随机样本的KL散度(可以认为是GAN的一种输入。)</p><p id="4804" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">可以看出<strong class="kt ir"> Z </strong>的分布比我们使用整个ELBO时的分布更接近标准正态分布。该图与我们在后面章节中的分析计算一致。此外，我们的KL-only培训比简单的torch.randn样品获得了更好的分布</p><p id="99c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，这些结果没有提供关于解码器的信息。我们可以看到，我们的编码器被训练成具有在KL方向上接近标准高斯分布的分布<strong class="kt ir"> Q </strong>，但是解码器的工作情况如何呢？我们可以使用以下方法之一:</p><ul class=""><li id="6c17" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated"><strong class="kt ir">训练编码器和比解码器(分开)</strong></li><li id="bb95" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated"><strong class="kt ir">训练他们俩(同时)</strong></li><li id="7506" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated"><strong class="kt ir">遵循当前方法(一起训练整个系统)</strong></li></ul><p id="2f52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一种和第二种方法将提供相同的KL。然而，解码器的性能相似并不明显，第三种选择将提供较低的KL (Z的距离与(0，1)高斯的距离较大)</p><p id="f29e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用两个“KPI”来评估解码器的性能</p><ul class=""><li id="4f43" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated"><strong class="kt ir">可能性分数</strong></li><li id="3896" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated"><strong class="kt ir">生成的图像</strong></li></ul><p id="a9fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下两幅图像是由当前算法创建的</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/1257018f29a59ae2375041b2c6e278b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*54D9iFm-VCtXemmqZmP-_g.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/431ee29eae637d771ee0feca4f5e399a.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*XeEbiczpv3dR6-4PnFCYxg.png"/></div></figure><p id="b8a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用第一种方法(即训练编码器，然后才训练解码器)。以下图像是使用此方法创建的，但有分析损失</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/11df30efd792d3d31fd6dec6991fbd72.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*Lrtn5u9jSQLMZGjykyCuDQ.png"/></div></figure><p id="0407" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这张图片是由随机取样的z创建的</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/a7dd766c1620860b8befdebb35b60b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*D5rM-3zPNtm1WHSM5bpO7g.png"/></div></figure><p id="b327" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以在分离的方法中观察解码器分数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/ad31f87c80999a5b6af2b07ca788ad84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*So3eFn2_q_SDeI0mVPSxgA.png"/></div></div></figure><p id="5f40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过分数和图像可以看出，对于当前方法，解码器工作得稍微好一些。</p><p id="c144" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下图比较了同时学习和分别学习的区别</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/a8e2ce4345ba4741aa9301032df94ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RcSeGTso1Rp2SVwbztGGg.png"/></div></div></figure><p id="39d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">给出了使用同时分析法和蒙特卡罗损失法创建的图像</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/6da39d9e7da00fbbc32c992ccadea77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*7-6y2gVaQlt0YGajFtWoIg.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/f93ac9fd385ebaa084b55b00fceffb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*KvLaMb_BuuIjEol14MkutA.png"/></div></figure><p id="4782" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">总结</strong></p><ul class=""><li id="f0f7" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">我们看到，正如数学直觉所暗示的，在VAE独立地训练编码器提供了更好的KL结果(即所获得的Z更接近于标准的正态分布。</li><li id="fcda" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">以“串联方式”训练VAE:首先，编码器和解码器类似地同时训练它们(即，用编码器进行KL步骤，然后用解码器和z进行BCE步骤)</li><li id="8a90" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">另一方面，当我们将解码器从编码器训练中移除时，会扭曲其性能。这使得整个训练在数学上不太一致，因为它揭示了好的<strong class="kt ir">z(</strong>好的<strong class="kt ir">-c</strong>loser to standard normal dist)对于好的解码器是不够的。</li></ul><h2 id="1469" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">推论</h2><p id="e96f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">回想一下，VAE使用ELBO来实现两个目标:</p><ul class=""><li id="127a" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">训练将数据映射成接近正态分布KL-wise的高斯分布(<strong class="kt ir">编码器的目标</strong>)</li><li id="5c12" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">使用该分布的采样来训练解码器生成数据(<strong class="kt ir">解码器的目标</strong>)</li></ul><p id="8fd3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们看到ELBO确实为解码器的目标提供了最佳结果，而当我们仅使用KL散度时，编码器的目标获得了更好的结果</p><p id="6c01" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一，可以声称，本质部分是生成数据的质量。既然ELBO在这方面做得很好，我们也没问题。然而，由于我们希望解码器扮演图像生成器的角色，这一主张遇到了一些障碍，因为我们看到最佳图像是由从非标准分布中抽取的Z获得的。</p><h2 id="239b" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">理论</h2><p id="ea11" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">VAE是一个<strong class="kt ir">变分推理</strong>问题:我们有一个使用潜在变量创建的观测数据，我们希望找到生成这些潜在变量的最佳分布。在推理阶段，我们使用这个函数来生成新数据。<strong class="kt ir">我们看到的是，这个函数不能假设为标准的正态分布。</strong></p><p id="2ea3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们<strong class="kt ir"> </strong>可以假设对于每一个数据<strong class="kt ir"> X </strong>和一类潜在变量的分布<strong class="kt ir"> <em class="nx"> P </em> </strong>存在一个分布<strong class="kt ir"> <em class="nx"> q </em> </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/cc31c768f8570ffba31c3b6ad9af6435.png" data-original-src="https://miro.medium.com/v2/resize:fit:180/format:webp/1*2jSNQgPqfRbcNVtvdzdA3Q.png"/></div></figure><p id="2889" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这优化了解码器。<strong class="kt ir">然而，如果希望使用这种分布生成图像，他必须使用编码器进行处理，或者测量<em class="nx"> q </em>的<em class="nx"> </em>参数，并根据这些参数对解码器的输入进行采样。我们不能假设解码器使用的是通用分布</strong></p><p id="482f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这项研究的代码可以在<a class="ae ln" href="https://github.com/natank1/VAE_Loss" rel="noopener ugc nofollow" target="_blank">这里</a>找到，基于Altosaar教授的代码，你可以在这里找到<a class="ae ln" href="https://github.com/altosaar/variational-autoencoder" rel="noopener ugc nofollow" target="_blank"/></p><h2 id="b87c" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">承认</h2><p id="dee3" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我要感谢Uri Itai和Shlomo Kashani在工作期间的审阅和协助</p><h1 id="ee01" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">文献学</h1><p id="cde2" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><a class="ae ln" href="https://mr-easy.github.io/2020-04-16-kl-divergence-between-2-gaussian-distributions/" rel="noopener ugc nofollow" target="_blank">https://Mr-easy . github . io/2020-04-16-KL-divergence-between-2-Gaussian-distributions/</a></p><p id="2fd3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://jaan.io/what-is-variational-autoencoder-vae-tutorial/" rel="noopener ugc nofollow" target="_blank">https://jaan . io/what-is-variable-auto encoder-vae-tutorial/</a></p><p id="38c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://www.cs.princeton.edu/courses/archive/fall11/cos597C/lectures/variational-inference-i.pdf" rel="noopener ugc nofollow" target="_blank">https://www . cs . Princeton . edu/courses/archive/fall 11/cos 597 c/lessons/variation-inference-I . pdf</a></p><p id="1795" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://arxiv.org/pdf/1312.6114.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1312.6114.pdf</a></p><p id="9d45" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">https://www.math24.net/method-lyapunov-functions/</p><p id="4b3a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="http://www.wisdom.weizmann.ac.il/~vered/CourseDS2019/tut8-Lyapunov%20functions.pdf" rel="noopener ugc nofollow" target="_blank">http://www . wisdom . Weizmann . AC . il/~ vered/courseds 2019/tu t8-李亚普诺夫%20functions.pdf </a>【利亚波诺夫】</p><p id="6e53" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://stanford.edu/class/ee363/lectures/lyap.pdf" rel="noopener ugc nofollow" target="_blank">https://stanford.edu/class/ee363/lectures/lyap.pdf</a></p><p id="453b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://chrisorm.github.io/VI-ELBO.html" rel="noopener ugc nofollow" target="_blank">https://chrisorm.github.io/VI-ELBO.html </a></p><h2 id="b45a" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">图片链接</h2><p id="bc09" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><a class="ae ln" href="https://unsplash.com/photos/Hba7In7vnoM" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/Hba7In7VnM </a></p><h2 id="49a4" class="nc lp iq bd lq nd ne dn lu nf ng dp ly la nh ni ma le nj nk mc li nl nm me nn bi translated">Python 代码</h2><p id="501c" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/lyeoni/pytorch-mnist-VAE" rel="noopener ugc nofollow" target="_blank">https://github.com/lyeoni/pytorch-mnist-VAE </a></p><p id="3fbf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/altosaar/variational-autoencoder" rel="noopener ugc nofollow" target="_blank">https://github.com/altosaar/variational-autoencoder </a></p><p id="fc94" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/lyeoni/pytorch-mnist-VAE" rel="noopener ugc nofollow" target="_blank">https://github.com/lyeoni/pytorch-mnist-VAE </a></p></div></div>    
</body>
</html>