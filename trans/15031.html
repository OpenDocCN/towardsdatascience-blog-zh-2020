<html>
<head>
<title>Creating conditional columns on Pandas with Numpy select() and where() methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Numpy select()和where()方法在Pandas上创建条件列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-conditional-columns-on-pandas-with-numpy-select-and-where-methods-8ee6e2dbd5d5?source=collection_archive---------3-----------------------#2020-10-16">https://towardsdatascience.com/creating-conditional-columns-on-pandas-with-numpy-select-and-where-methods-8ee6e2dbd5d5?source=collection_archive---------3-----------------------#2020-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aca4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一些最有用的熊猫把戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e07567eb9eff1467503c34dca6976e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGAqwHLGMDy_hqskPL7yJQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">帕斯卡尔·贝纳登在<a class="ae ky" href="https://unsplash.com/s/photos/pandas-data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="548a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个令人惊叹的库，它包含大量用于操作数据的内置函数。虽然内置函数能够执行有效的数据分析，但是合并其他库中的方法为Pandas增加了价值。</p><p id="27cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看如何用Numpy <code class="fe lv lw lx ly b">select()</code>和<code class="fe lv lw lx ly b">where()</code>方法在Pandas上创建条件列</p><p id="1f25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请查看我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/015-pandas-numpy-select-where/pandas-and-numpy-select-where.ipynb" rel="noopener ugc nofollow" target="_blank"> Github repo </a>获取源代码</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="634e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">从两个选项中创建条件列</h1><p id="002d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">假设我们有一个关于水果店的数据集。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="2d38" class="nh mh it ly b gy ni nj l nk nl">df = pd.DataFrame({<br/>    'fruit': ['Apple', 'Banana', 'Apple', 'Banana'],<br/>    'supplier': ['T &amp; C Bro', 'T &amp; C Bro', 'JM Wholesales', 'JM Wholesales'],<br/>    'weight (kg)': [1000,2000,3000,4000],<br/>    'customer_rating': [4.8,3.2, 4.2, 4.3]<br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/28b8ef5481d4b98f8bfc7fa87dca5dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYNf_H1G3CAZ8O4UC25AjQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">水果店数据集(作者制作)</p></figure><p id="3a4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，商店从两个供应商处购买了水果“<strong class="lb iu"> T &amp; C Bro </strong>”和“<strong class="lb iu"> JM批发</strong>”。它们的价目表分别保存如下:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="2b41" class="nh mh it ly b gy ni nj l nk nl"># T &amp; C Bro<br/><strong class="ly iu">tc_price</strong> = pd.DataFrame({<br/>    'fruit': ['Apple', 'Banana', 'Orange', 'Pineapple'],<br/>    'price (kg)': [1.1, 2, 2.9, 3.1]<br/>})</span><span id="74cb" class="nh mh it ly b gy nn nj l nk nl"># JM Wholesales<br/><strong class="ly iu">jm_price</strong> = pd.DataFrame({<br/>    'fruit': ['Apple', 'Banana', 'Orange', 'Pineapple'],<br/>    'price (kg)': [1.2, 1.8, 4, 6]<br/>})</span></pre><p id="0a87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望从供应商的价目表中检索价格，将它们组合起来，并将结果添加到新列中。预期的输出是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/607fa55ef5e8e549d85f6b7a9e218f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*08hU7Xql-mXUj38qrRLQVQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者制作的图像</p></figure><p id="58dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个计算中棘手的部分是，我们需要有条件地检索<strong class="lb iu"> <em class="np">价格(公斤)</em> </strong>(基于<strong class="lb iu">供应商</strong>和<strong class="lb iu">水果</strong>)，然后将其组合回水果店数据集。</p><p id="45a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个例子，一个改变游戏规则的解决方案是结合Numpy <code class="fe lv lw lx ly b">where()</code>函数。一行代码就可以解决检索和合并。</p><h2 id="c67e" class="nh mh it bd mi nq nr dn mm ns nt dp mq li nu nv ms lm nw nx mu lq ny nz mw oa bi translated">第一步:将<code class="fe lv lw lx ly b">fruit</code>列设置为索引</h2><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="9b64" class="nh mh it ly b gy ni nj l nk nl">df = df.<strong class="ly iu">set_index('fruit')</strong></span><span id="f65d" class="nh mh it ly b gy nn nj l nk nl">tc_price = tc_price.<strong class="ly iu">set_index('fruit')</strong></span><span id="cea8" class="nh mh it ly b gy nn nj l nk nl">jm_price = jm_price.<strong class="ly iu">set_index('fruit')</strong></span></pre><p id="df9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过调用<code class="fe lv lw lx ly b">set_index('fruit')</code>将<strong class="lb iu"> <em class="np">果</em> </strong>列设置为所有数据集的索引。这很重要，所以我们可以稍后使用<code class="fe lv lw lx ly b">loc[df.index]</code>来选择用于值映射的列。</p><h2 id="52b5" class="nh mh it bd mi nq nr dn mm ns nt dp mq li nu nv ms lm nw nx mu lq ny nz mw oa bi translated">步骤2:将Numpy <code class="fe lv lw lx ly b">where()</code>与Pandas数据框架合并</h2><p id="ef40" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Numpy <code class="fe lv lw lx ly b">where(<strong class="lb iu">condition</strong>, <strong class="lb iu">x</strong>, <strong class="lb iu">y</strong>)</code>方法[1]根据<code class="fe lv lw lx ly b">condition</code>返回从<code class="fe lv lw lx ly b">x</code>或<code class="fe lv lw lx ly b">y</code>中选择的元素。最重要的是，这个方法可以接受类似数组的输入，并返回类似数组的输出。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="6bae" class="nh mh it ly b gy ni nj l nk nl">df['price (kg)'] = <strong class="ly iu">np.where</strong>(<br/>    <strong class="ly iu">df['supplier'] == 'T &amp; C Bro'</strong>, <br/>    tc_price<strong class="ly iu">.loc[df.index]['price (kg)']</strong>, <br/>    jm_price<strong class="ly iu">.loc[df.index]['price (kg)']</strong><br/>)</span></pre><p id="cddb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过执行上述语句，您应该得到如下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/7952eff40d6621a62e305813dbcb706f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eu4xTGX4dskHyLF1KuD41A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者制作的图像</p></figure><p id="d395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有点困惑？以下是一些细节:</p><ul class=""><li id="e886" class="oc od it lb b lc ld lf lg li oe lm of lq og lu oh oi oj ok bi translated"><code class="fe lv lw lx ly b">df['supplier'] == 'T &amp; C Bro'</code>返回一个布尔数组</li><li id="edc4" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><code class="fe lv lw lx ly b">df.index</code>返回<code class="fe lv lw lx ly b">['Apple', 'Banana', 'Apple', 'Banana']</code>(由<strong class="lb iu"> <em class="np">步骤1 </em> </strong>设定的指标)。并且<code class="fe lv lw lx ly b">tc_price.loc[df.index]</code>和<code class="fe lv lw lx ly b">jm_price.loc[df.index]</code>都基于标签<code class="fe lv lw lx ly b">df.index</code>返回相同长度的数据帧。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/9136a3b78eb5457d8be9881ade41ef62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i97A-CBtOV54OQqPnrsDdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe lv lw lx ly b">np.where()</code>如何工作</p></figure><h1 id="e50b" class="mg mh it bd mi mj or ml mm mn os mp mq jz ot ka ms kc ou kd mu kf ov kg mw mx bi translated">从两个以上的选项中创建条件列</h1><p id="477e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我们已经学习了如何从两个数据集创建一个条件列。如果超过2个数据集呢，例如，水果店数据集中有3个不同的供应商。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/848895c85665a5f06efe8e4ba5513e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uar2p_rqPC7YwGXVk9ai2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">有3个供应商的水果店数据集(作者制作)</p></figure><p id="9334" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于2个以上的数据集/选择，我们可以使用Numpy <code class="fe lv lw lx ly b">select()</code>方法。让我们借助一个例子来看看它是如何工作的。</p><h2 id="ca19" class="nh mh it bd mi nq nr dn mm ns nt dp mq li nu nv ms lm nw nx mu lq ny nz mw oa bi translated">步骤1:将价格列表组合在一起，并将<code class="fe lv lw lx ly b">fruit</code>列设置为索引</h2><p id="2df3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">第一步是将所有价格列表合并到一个数据集中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/813b78ee343fe9871df0eff4c21577e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*c86WEWVwGXc7bdzYunod1g.png"/></div></figure><p id="c215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，设置<strong class="lb iu"> <em class="np">果</em> </strong>列为索引。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="6037" class="nh mh it ly b gy ni nj l nk nl">df_3 = df_3.<strong class="ly iu">set_index('fruit')</strong></span><span id="41f6" class="nh mh it ly b gy nn nj l nk nl">df_price = df_price.<strong class="ly iu">set_index('fruit')</strong></span></pre><h2 id="d86d" class="nh mh it bd mi nq nr dn mm ns nt dp mq li nu nv ms lm nw nx mu lq ny nz mw oa bi translated">步骤2:将Numpy <code class="fe lv lw lx ly b">select()</code>与Pandas数据框架合并</h2><p id="276a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Numpy <code class="fe lv lw lx ly b">select(<strong class="lb iu">condlist</strong>, <strong class="lb iu">choicelist</strong>)</code>方法根据<code class="fe lv lw lx ly b">condlist</code>中的条件返回一个从<code class="fe lv lw lx ly b">choicelist</code>中的元素提取的数组。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="cea6" class="nh mh it ly b gy ni nj l nk nl">args = df_price.loc[df_3.index]</span><span id="df6f" class="nh mh it ly b gy nn nj l nk nl"><strong class="ly iu">conds = [<br/>    df_3['supplier'] == 'T &amp; C Bro', <br/>    df_3['supplier'] == 'JM Wholesales', <br/>    df_3['supplier'] == 'Star Ltd.',<br/>]</strong></span><span id="acdb" class="nh mh it ly b gy nn nj l nk nl"><strong class="ly iu">choices = [<br/>    args['T &amp; C Bro'], <br/>    args['JM Wholesales'], <br/>    args['Star Ltd.'],<br/>]</strong></span><span id="40f9" class="nh mh it ly b gy nn nj l nk nl">df_3['price (kg)'] = np.select(<strong class="ly iu">conds</strong>, <strong class="ly iu">choices</strong>)</span></pre><p id="dc9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，</p><ul class=""><li id="f619" class="oc od it lb b lc ld lf lg li oe lm of lq og lu oh oi oj ok bi translated">如果条件<code class="fe lv lw lx ly b">df_3['supplier'] == 'T &amp; C Bro'</code>满足，则从<code class="fe lv lw lx ly b">args['T &amp; C Bro']</code>获取输出元素。</li><li id="1a10" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">如果条件<code class="fe lv lw lx ly b">df_3['supplier'] == 'JM Wholesale'</code>被满足，它从<code class="fe lv lw lx ly b">args['JM Wholesale']</code>获取输出元素。</li><li id="6ba7" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">如果条件<code class="fe lv lw lx ly b">df_3['supplier'] == 'Star Ltd.'</code>满足，它从<code class="fe lv lw lx ly b">args['Star Ltd.']</code>获取输出元素。</li></ul><p id="b99c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过执行上述语句，您应该得到如下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/3cea6fe0e9357150138f45b1ec56410f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jrHNuf3R6szTdjN7uGTsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe lv lw lx ly b">np.select()</code>的输出</p></figure><h1 id="9bc8" class="mg mh it bd mi mj or ml mm mn os mp mq jz ot ka ms kc ou kd mu kf ov kg mw mx bi translated">好了</h1><p id="1e0b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">感谢阅读。</p><p id="d900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请在我的Github 上的<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/015-pandas-numpy-select-where/pandas-and-numpy-select-where.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本中查看源代码。</a></p><p id="5cdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对机器学习的实用方面感兴趣，请继续关注。</p><h2 id="569a" class="nh mh it bd mi nq nr dn mm ns nt dp mq li nu nv ms lm nw nx mu lq ny nz mw oa bi translated">你可能会对我的其他一些熊猫文章感兴趣:</h2><ul class=""><li id="ac50" class="oc od it lb b lc my lf mz li oz lm pa lq pb lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/when-to-use-pandas-transform-function-df8861aa0dcf">何时使用熊猫变换()函数</a></li><li id="b454" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">熊猫数据透视表实用介绍_table()函数</a></li><li id="7ae0" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/using-pandas-method-chaining-to-improve-code-readability-d8517c5626ac" rel="noopener">使用熊猫方法链接提高代码可读性</a></li><li id="f07c" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/working-with-datetime-in-pandas-dataframe-663f7af6c587">在Pandas数据框架中处理日期时间</a></li><li id="a3ab" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/all-the-pandas-read-csv-you-should-know-to-speed-up-your-data-analysis-1e16fe1039f3" rel="noopener">熊猫阅读_csv()你应该知道的招数</a></li><li id="4406" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e">用Pandas read_csv()解析日期列应该知道的4个技巧</a></li></ul><p id="d725" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多可以从我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到</p><h1 id="c3fb" class="mg mh it bd mi mj or ml mm mn os mp mq jz ot ka ms kc ou kd mu kf ov kg mw mx bi translated">参考</h1><ul class=""><li id="bd9e" class="oc od it lb b lc my lf mz li oz lm pa lq pb lu oh oi oj ok bi translated">[1] <a class="ae ky" href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" rel="noopener ugc nofollow" target="_blank"> Numpy文档— where() </a></li><li id="d1a3" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">[2] <a class="ae ky" href="https://numpy.org/doc/stable/reference/generated/numpy.select.html" rel="noopener ugc nofollow" target="_blank"> Numpy文档— select() </a></li></ul></div></div>    
</body>
</html>