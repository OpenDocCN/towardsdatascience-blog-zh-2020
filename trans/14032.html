<html>
<head>
<title>MLflow Part 1: Getting Started with MLflow!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MLflow第1部分:MLflow入门！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mlflow-part-1-getting-started-with-mlflow-8b45bfbbb334?source=collection_archive---------22-----------------------#2020-09-27">https://towardsdatascience.com/mlflow-part-1-getting-started-with-mlflow-8b45bfbbb334?source=collection_archive---------22-----------------------#2020-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e7e88928e35c053b4280a597b34843bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCwdqwXqE1q4IvREMPHU4Q.png"/></div></div></figure><h2 id="a43a" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">MLflow 101</h2><div class=""/><div class=""><h2 id="76c3" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">使用这个方便的工具，帮助您迈出机器学习生命周期流程的第一步</h2></div><p id="47dd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">朋友们，你们好！我们带着另一个快速提示回到这里，因为我试图保持这些帖子快速，这实际上是与MLFlow相关的一系列提示的第一部分。本着完全透明的精神，MLFlow对我来说是相当新的，因此在接下来的几周内，我将与大家一起学习一些东西。如果您想了解我的代码，<a class="ae ly" href="https://github.com/dkhundley/ds-quick-tips/tree/master/008_mlflow_getting_started" rel="noopener ugc nofollow" target="_blank">请查看我的相关GitHub库</a>的链接。</p><p id="6253" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我敢肯定你脑子里的第一个问题是，什么是MLflow？简而言之，<a class="ae ly" href="https://mlflow.org" rel="noopener ugc nofollow" target="_blank"> MLflow </a>是一个开源平台，旨在帮助简化机器学习生命周期过程。同样，我仍在学习它的所有功能，但它似乎提供了许多有前途的功能，我很高兴在未来的帖子中探索这些功能。这些事情包括创建模型注册中心、将模型作为API轻松部署等等。老实说，我不知道这个子系列会持续多久，但我想我们会从这个简洁的工具中获得很多！</p><p id="112a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">但是当然，我们都得从某个地方开始。我们将一步步走进这个世界，为将来的职位做好准备。也就是说，我们将采用一种非常简单的方法来创建和记录一个非常简单的模型。在开始之前，我们需要安装MLflow，它就像运行以下pip命令一样简单:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="4798" class="mi mj je me b gy mk ml l mm mn">pip install mlflow</span></pre><p id="9d5d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在过去的几篇文章中，我们一直在使用泰坦尼克号数据集，但这一次，我们将偏离使用经典的红酒质量数据集🍷。现在，我个人不是一个葡萄酒爱好者(一般来说也不是一个酒精爱好者)，但对于你们这些葡萄酒鉴赏家来说，我想你们会像《泰坦尼克号》一样喜欢这个数据集，如果不是更多的话，因为它不是基于一个巨大的悲剧！</p><figure class="lz ma mb mc gt iv"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="fd30" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们之所以要更改此数据集，是因为此数据集中的所有要素本质上都是数值型的，因此我们实际上不需要进行任何要素工程来使其适合模型。当然，我不能保证我们会得到高质量的结果，但是至少我们可以得到一个简单的模型，并且运行起来，而不需要数据清理的麻烦。我们唯一要做的就是导入数据，并在训练集和验证集之间适当地拆分数据，如下所示:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="680a" class="mi mj je me b gy mk ml l mm mn"># Loading data and prepping for training<br/>df_wine = pd.read_csv('../data/wine/train.csv')</span><span id="296e" class="mi mj je me b gy mq ml l mm mn">X = df_wine.drop(columns = 'quality')<br/>y = df_wine[['quality']]</span><span id="436e" class="mi mj je me b gy mq ml l mm mn">X_train, X_val, y_train, y_val = train_test_split(X, y, random_state = 42)</span></pre><p id="3259" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">(哦，顺便说一下，我觉得有必要说今天的帖子或多或少是<a class="ae ly" href="https://mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank"> MLflow的第一个教程</a>的副本，但我故意简化了很多，并在这里更彻底地解释我的简化。)</p><p id="111c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在是我们开始步入MLflow世界的时候了。我将继续粘贴下面的脚本的剩余部分，并解释每一部分是做什么的。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f093" class="mi mj je me b gy mk ml l mm mn"># Defining model parameters<br/>alpha = 1<br/>l1_ratio = 1</span><span id="4cbe" class="mi mj je me b gy mq ml l mm mn"># Running MLFlow script<br/>with mlflow.start_run():</span><span id="a57c" class="mi mj je me b gy mq ml l mm mn"># Instantiating model with model parameters<br/>    model = ElasticNet(alpha = alpha,<br/>                       l1_ratio = l1_ratio)</span><span id="781e" class="mi mj je me b gy mq ml l mm mn"># Fitting training data to the model<br/>    model.fit(X_train, y_train)</span><span id="c7ed" class="mi mj je me b gy mq ml l mm mn"># Running prediction on validation dataset<br/>    preds = model.predict(X_val)</span><span id="11ed" class="mi mj je me b gy mq ml l mm mn"># Getting metrics on the validation dataset<br/>    rmse = mean_squared_error(preds, y_val)<br/>    abs_error = mean_absolute_error(preds, y_val)<br/>    r2 = r2_score(preds, y_val)</span><span id="60dd" class="mi mj je me b gy mq ml l mm mn"># Logging params and metrics to MLFlow<br/>    mlflow.log_param('alpha', alpha)<br/>    mlflow.log_param('l1_ratio', l1_ratio)<br/>    mlflow.log_metric('rmse', rmse)<br/>    mlflow.log_metric('abs_error', abs_error)<br/>    mlflow.log_metric('r2', r2)</span><span id="3bd7" class="mi mj je me b gy mq ml l mm mn"># Logging model to MLFlow<br/>    mlflow.sklearn.log_model(model, 'model')</span></pre><p id="3fdf" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在“mlflow.start_run()”下，前几行代码您应该已经非常熟悉了。这里，我们只是用提供的参数实例化一个模型，根据参数拟合训练数据，然后用我们新训练的模型和验证数据集获得预测结果。通过验证数据集中记录的预测结果和实际结果，我们可以获得均方根误差、平均绝对误差和R2分数的适当指标。到目前为止，这里没有什么新东西。</p><p id="16c4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在是我们开始涉足新领域的时候了。幸运的是，我认为简单地阅读代码本身就足够了。伐木时间到了，朋友们！在我们的代码中，我们将记录三件不同的事情:模型的参数、来自验证集的度量以及模型本身。随着我们下面对UI的探究，这样做的原因将很快变得显而易见。</p><p id="a4e1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">运行这段代码后，您会注意到一个名为“mlruns”的新目录应该出现在您运行代码的位置附近。当你第一眼看到它的时候，它可能看起来很奇怪，但是如果你深入挖掘，你会找到你真正关心的东西。值得注意的是，您应该能够挖掘出您刚刚记录的所有内容，包括序列化的模型工件本身。</p><figure class="lz ma mb mc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mr"><img src="../Images/fa04465e1939959832a4233e3ded4f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-1e8DRjmPIEO0V5LbFdrA.png"/></div></div></figure><p id="c071" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在，在我们进入下一节之前，我想记下我在Jupyter笔记本和基本Python脚本中运行了这段代码。你不需要这样做，但这将有助于理解为什么我现在注意到这一点。</p><p id="2379" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，现在有趣的部分来了！在命令行中，导航到“mlruns”上面的目录。(如果您刚刚运行了Python脚本，您应该已经在那里了。)运行以下命令，您应该会看到以下屏幕:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="4f1d" class="mi mj je me b gy mk ml l mm mn">mlflow ui</span></pre><figure class="lz ma mb mc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ms"><img src="../Images/d5dec7eaf23bf106ffacbae971be0494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VlnkUe8xdta3XxzIy2Ej_Q.png"/></div></div></figure><p id="8303" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果你像我一样，这个界面可能看起来很熟悉，因为它似乎在幕后使用Gunicorn来提供这个UI。您会注意到，在我的例子中，UI似乎是在localhost:5000上提供的。打开你最喜欢的浏览器，导航到那个地址。这是您应该看到的屏幕。</p><figure class="lz ma mb mc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mt"><img src="../Images/ea28edb0c6a656b26f29f7ea7c4b795c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8j0uw1P_yuiiE2kNsp3aQ.png"/></div></div></figure><p id="96ef" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">很整洁，是吧？请注意，该表中显示了两次运行。如果您查看这些运行的源代码，您会注意到其中一个是从我的mlflow-wine.py Python脚本运行的，而另一个是从iPykernel运行的，这当然是我的Jupyter笔记本！此外，您将在接下来的几列中看到我们的模型参数，最后您可以在最后一组列中看到模型指标。</p><p id="6e45" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">接下来，点击“开始时间”下的超链接，打开其中一个模型。这是你应该看到的。</p><figure class="lz ma mb mc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mu"><img src="../Images/8eabf3d4e0d24df9b77f6d879483e2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jwukUrBq5hCwbwO_7tS0sA.png"/></div></div></figure><p id="1ff2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">同样，我们看到了像模型参数和验证指标这样的东西，但是我们在这里也看到了其他附加的东西，比如持续时间和相关的git提交。我不能在一个屏幕截图中捕获所有的内容，但是如果你从这里向下滚动，你也可以直接从UI中导航到模型工件本身，我认为这实在是太酷了！</p><p id="350f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这就是第一次介绍的全部内容！我们在这里仅仅触及皮毛，所以我期待在接下来的几篇帖子中与大家一起学习，继续共同探索MLflow。希望你喜欢这个快速介绍！很快再次见到你们。😃</p></div></div>    
</body>
</html>