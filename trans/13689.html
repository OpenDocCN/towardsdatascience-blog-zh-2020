<html>
<head>
<title>This Function Can Make Your Pandas Code Significantly Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这个功能可以让你的熊猫编码明显更快</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/this-function-can-make-your-pandas-code-significantly-faster-d018fb5045a9?source=collection_archive---------16-----------------------#2020-09-20">https://towardsdatascience.com/this-function-can-make-your-pandas-code-significantly-faster-d018fb5045a9?source=collection_archive---------16-----------------------#2020-09-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1a39" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更准确地说是快了35倍</h2></div><p id="54f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">熊猫是一个很棒的图书馆，但它不是最快的。不过，有一些方法可以让它变得更快，那就是为正确的任务使用正确的工具。今天我们将探索这些工具中的一个，它将使日常任务显著加快。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/6e2ea1256d83c6aa624cda68c65626c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hT9EKzg0Uac4zdHe"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@lurm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿德里安·匡威</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="11be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有必要再写引言部分了，所以让我们快速浏览一下文章的结构，然后继续有趣的内容。这篇文章分成几个部分:</p><ul class=""><li id="31ed" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">数据集和问题概述</li><li id="14dc" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">不可行的解决方案</li><li id="eeb7" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">首选解决方案</li><li id="7093" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">结论</li></ul><p id="7845" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以事不宜迟，让我们开始吧！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="42d1" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">数据集和问题概述</h1><p id="a4bb" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr nk kt ku kv nl kx ky kz nm lb lc ld im bi translated">为了演示，我们需要两个图书馆，那就是<em class="nn"> Numpy </em>和<em class="nn"> Pandas </em>。该数据集是完全虚构的，显示了特定日期3种产品的销售情况。日期被分成3列，只是为了让计算机更难处理。</p><p id="ea8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不管怎样，这是数据集:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi no"><img src="../Images/8a69c91d6b242e2f40f3f4ce4522eb45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ma2NqRCXx57Gz-M0rmFYAA.png"/></div></div></figure><p id="7bb0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里没有什么特别的，但是我们有相当多的数据— 100K行。下面是前几行的样子:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi np"><img src="../Images/c824de8b08ae002d13200c51550793e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKu52ER7qOYg33ytMEY0FQ.png"/></div></div></figure><p id="51a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们知道某一天卖出了多少件商品，但不知道单价，所以让我们快速声明一下:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d95665f4b910a8d204365769928ffd10.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*zrNCNzG8hLPH6Je_qEwsvw.png"/></div></figure><p id="6151" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！以下是我们的最终目标(针对每一行):</p><ul class=""><li id="f1be" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">将<code class="fe nr ns nt nu b">Year</code>、<code class="fe nr ns nt nu b">Month</code>和<code class="fe nr ns nt nu b">Day</code>组合成一个变量</li><li id="f55e" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">用单价乘以销售量来计算每天的利润</li><li id="c314" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">将这两个变量作为键值对添加到一个列表中</li></ul><p id="0ff5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也想尽快完成这项工作。有多种方法可以解决这个问题，但其中只有一种是最佳的。</p><p id="fdd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们宣布这种类型任务的可行方法之前，让我们先探讨一下不要做什么。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e99d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">不可行的解决方案</h1><p id="80e4" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr nk kt ku kv nl kx ky kz nm lb lc ld im bi translated">正如上一节所讨论的，我们有相当多的工作要做。这并不意味着计算机需要很长时间才能完成。你会惊讶于这一切完成得有多快。</p><p id="2ee9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是首先，让我们探索两个选项中最糟糕的一个，那就是使用<code class="fe nr ns nt nu b">iterrows</code>函数遍历数据帧行并执行计算。</p><p id="81e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">代码如下:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nv"><img src="../Images/2fdc974677f324dc1d07d9f2341b3bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-g3rTUlyx779lNCzZYmG8g.png"/></div></div></figure><p id="5362" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们已经完成了前面几节中描述的所有任务，完成这些任务几乎用了8秒钟。</p><p id="0757" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可能会认为事情没那么糟，但是等着看我们下一步做什么吧。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="85bf" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">首选解决方案</h1><p id="34ff" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr nk kt ku kv nl kx ky kz nm lb lc ld im bi translated">如果你觉得<code class="fe nr ns nt nu b">iterrows</code>不错，那就等着见<code class="fe nr ns nt nu b">itertuples</code>吧。这是一个类似的函数，用于遍历数据帧的行，但是它的速度要快得多。</p><p id="1a62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将执行相同的任务并比较执行时间。<code class="fe nr ns nt nu b">itertuples</code>处理元组，所以我们不能使用括号符号访问DataFrame值。这是唯一的区别。</p><p id="505d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总之，代码如下:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nv"><img src="../Images/9b81f7f3c1a8d275faf2f0f7f8d59289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yAn-4Jxlt0RocJ9OuYgg6g.png"/></div></div></figure><p id="e786" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这只花了0.218秒就完成了！这是35倍的降幅，非常显著。在这个玩具示例中，可能没有那么多，因为8秒钟并不是很长的等待时间，但这很容易扩展到数百万或数千万行。</p><p id="77d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">记住——在执行类似的任务时，请始终使用<code class="fe nr ns nt nu b">itertuples</code>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ed9c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">在你走之前</h1><p id="b212" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr nk kt ku kv nl kx ky kz nm lb lc ld im bi translated">这是我第二次讨论这个主题，但这一次数据集和问题任务对于计算机和开发人员来说要繁重得多，所以我觉得值得分享。</p><p id="b17b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要认为这35倍的速度提升是有保证的，因为结果可能会有所不同，这取决于任务的类型和您的硬件。尽管如此，<code class="fe nr ns nt nu b">iteruples</code>每次都应该比<code class="fe nr ns nt nu b">iterrows</code>表现得更好。这才是最重要的。</p><h2 id="71c8" class="nw mr it bd ms nx ny dn mw nz oa dp na kr ob oc nc kv od oe ne kz of og ng oh bi translated"><a class="ae lu" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">加入我的私人邮件列表，获取更多有用的见解。</strong> </a></h2></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="eb9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nn">喜欢这篇文章吗？成为</em> <a class="ae lu" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="nn">中等会员</em> </a> <em class="nn">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz lo ol"/></div></div></a></div></div></div>    
</body>
</html>