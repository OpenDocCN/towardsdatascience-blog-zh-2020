<html>
<head>
<title>Downloading historical stock prices in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python下载历史股票价格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/downloading-historical-stock-prices-in-python-93f85f059c1f?source=collection_archive---------0-----------------------#2020-10-13">https://towardsdatascience.com/downloading-historical-stock-prices-in-python-93f85f059c1f?source=collection_archive---------0-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d13b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们将寻找一种快速和自动化的方法来下载Python中的历史股票价格。本文将介绍如何创建分析数据集来帮助分析股票市场。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d9baeabb685948b34cb82b75f62da49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pFG0jpbgWe-q5RpkqZCiw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@m_b_m" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@m_b_m</a>在<a class="ae kv" href="https://unsplash.com/photos/ZzOa5G8hSPI" rel="noopener ugc nofollow" target="_blank"> unsplash </a>拍摄的照片</p></figure><p id="aaa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开笔记本，跟着做:</p><h1 id="bec3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">第一步:</strong>下载需要的包。</h1><p id="3292" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们需要的是<strong class="ky ir"><em class="mp">pandas</em></strong>(python中数据科学的面包和黄油)<strong class="ky ir"> <em class="mp"> yfinance </em> </strong>用于从雅虎财经下载历史股票价格，<strong class="ky ir"> <em class="mp"> datetime </em> </strong>和<strong class="ky ir"> <em class="mp"> time </em> </strong>提供操作日期和时间的函数，<strong class="ky ir"> <em class="mp"> requests </em> </strong>用于发送HTTP请求，<strong class="ky ir"> <em class="mp"> io </em></strong></p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="bf2a" class="mv lt iq mr b gy mw mx l my mz">import pandas as pd<br/>import yfinance as yf<br/>import datetime<br/>import time<br/>import requests<br/>import io</span></pre><h1 id="ef7b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">第二步:设置日期范围</strong></h1><p id="0196" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接下来，我们希望提供开始和结束日期，在此期间，我们希望每天的股票价格。下面，我提供的开始日期为2020年2月1日(大约是今年痛苦的开始)，结束日期为2020年10月11日，即我执行此代码的当前日期。你可以设置任何你喜欢的开始和结束日期——但是我试图分析的是从疫情时代之前到现在的价格波动。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="1c63" class="mv lt iq mr b gy mw mx l my mz">start = datetime.datetime(2020,2,1)<br/>end = datetime.datetime(2020,10,11)</span></pre><h1 id="98cc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">第三步:获取股票代码</strong></h1><p id="55e3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们想获得纳斯达克上市的股票代码。如果你确切地知道你想要的公司的历史股价，你可以跳过这一步(例如:特斯拉-&gt; <strong class="ky ir"> <em class="mp">、TSLA </em> </strong>、脸书- &gt; <strong class="ky ir"> <em class="mp">、FB </em> </strong>等)。但这里的想法是超越流行的公司，发掘一些不太知名的公司有趣的价格变动。</p><p id="9de0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的代码将访问包含带有公司名称和股票代码的CSV文件的URL，并将其转换为pandas数据帧。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="e627" class="mv lt iq mr b gy mw mx l my mz">url="<a class="ae kv" href="https://pkgstore.datahub.io/core/nasdaq-listings/nasdaq-listed_csv/data/7665719fb51081ba0bd834fde71ce822/nasdaq-listed_csv.csv" rel="noopener ugc nofollow" target="_blank">https://pkgstore.datahub.io/core/nasdaq-listings/nasdaq-listed_csv/data/7665719fb51081ba0bd834fde71ce822/nasdaq-listed_csv.csv</a>"</span><span id="d59c" class="mv lt iq mr b gy na mx l my mz">s = requests.get(url).content</span><span id="ff59" class="mv lt iq mr b gy na mx l my mz">companies = pd.read_csv(io.StringIO(s.decode('utf-8')))</span></pre><p id="907a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该数据集中提供的一些公司可能已被除名或无法下载。</p><p id="3dfc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来看看这个数据集是什么样子的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/a86f4979511222032e398d1223a97d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CgRgVJ8tjXuJvu4MuYWO7g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">包含公司符号和信息的数据帧</p></figure><p id="960e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这个数据集中，让我们只提取符号，并将它们转换成一个列表。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="1c38" class="mv lt iq mr b gy mw mx l my mz">Symbols = companies['Symbol'].tolist()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/a889ac92f0b0950ba1b84ab2f700563a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*tBZxbaFUR00kM8NBRMHuMw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示前10个股票代号的列表</p></figure><h1 id="1318" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤4:下载历史股票价格</h1><p id="75b3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">迭代每个股票代码，使用yahoo finance API，下载开始和结束日期之间的每日股票价格。</p><p id="3761" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">追加所有个股信息并创建分析数据集。另外，请注意，有些符号可能无法下载，为此我们添加了“try”和“except”子句来处理它们。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="a3a2" class="mv lt iq mr b gy mw mx l my mz"># create empty dataframe<br/>stock_final = pd.DataFrame()</span><span id="820a" class="mv lt iq mr b gy na mx l my mz"># iterate over each symbol<br/>for i in Symbols:  <br/>    <br/>    # print the symbol which is being downloaded<br/>    print( str(Symbols.index(i)) + str(' : ') + i, sep=',', end=',', flush=True)  <br/>    <br/>    try:<br/>        # download the stock price <br/>        stock = []<br/>        stock = yf.download(i,start=start, end=end, progress=False)<br/>        <br/>        # append the individual stock prices <br/>        if len(stock) == 0:<br/>            None<br/>        else:<br/>            stock['Name']=i<br/>            stock_final = stock_final.append(stock,sort=False)<br/>    except Exception:<br/>        None</span></pre><p id="8c05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是最终数据集的样子。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="a9e2" class="mv lt iq mr b gy mw mx l my mz">stock_final.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/f8403bee64fd675c4ce106deb8c9fe51.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*DVR9VCbzEm1PPTKkPK2fIA.png"/></div></figure><p id="d2b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。对于每个股票代码和日期，我们有开盘价、最高价、最低价、收盘价和调整后的收盘价，以及交易量。</p><p id="d13f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文涵盖了股票市场分析的第一步，即创建分析数据集。下一步将是通过探索性数据分析和机器学习模型，进一步深入这个数据集。</p><p id="738c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://www.linkedin.com/in/rohan-joseph-b39a86aa/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> LinkedIn </strong> </a> <strong class="ky ir"> </strong>上连接，在<strong class="ky ir"/><a class="ae kv" href="https://github.com/rohanjoseph93/Stock-Analysis-in-Python/blob/master/stock_download_yahoo.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">Github</strong></a><strong class="ky ir">上找到笔记本。</strong></p></div></div>    
</body>
</html>