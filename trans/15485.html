<html>
<head>
<title>Data Science Interviews: SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学访谈:SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-interviews-sql-94dc33d58e73?source=collection_archive---------10-----------------------#2020-10-25">https://towardsdatascience.com/data-science-interviews-sql-94dc33d58e73?source=collection_archive---------10-----------------------#2020-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e4ab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SQL技术指南和10个需要检查的问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/115564ee3ff5f27df1eafd5cd1ff515c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxixiwnkFlcNnECvNyhyTQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Alexandra Acea在<a class="ae ky" href="https://unsplash.com/photos/XEB8y0nRRP4" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="c46b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概观</h1><p id="8fa8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当你听到“数据科学家”时，你会想到建模、有见地的分析、机器学习和其他酷词。所以，让我们不要拐弯抹角:数据库和SQL不是数据科学家最“有趣”的部分。这可能不是你面试时最担心的。但是也就是说，因为您将大量使用数据，这意味着您将编写许多查询来检索数据并将其转换为有意义的数据。</p><p id="d686" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章将在数据科学访谈中提供SQL的技术指南。讨论的问题来自这个数据科学采访<a class="ae ky" href="https://datascienceprep.com/" rel="noopener ugc nofollow" target="_blank">时事通讯</a>，其中有来自顶级科技公司的问题，并将涉及到即将出版的<a class="ae ky" href="http://acethedatascienceinterview.com/" rel="noopener ugc nofollow" target="_blank">书</a>。</p><h1 id="6151" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">一般工作流程</h1><p id="a41f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">大多数工作流分析的第一步都涉及到快速分割SQL中的数据，因此能够高效地编写基本查询是一项非常重要的技能。尽管许多人可能认为SQL只涉及选择和连接，但强大的SQL工作流还涉及许多其他操作符和细节。例如，利用子查询很重要，它允许您操作数据的子集，通过这些子集可以执行后面的操作，而窗口函数允许您在不使用GROUP BY显式组合行的情况下剪切数据。SQL中提出的问题通常对手头的公司非常实用——像脸书这样的公司可能会问各种用户或应用分析，而像亚马逊这样的公司会问产品和交易。</p><h1 id="8e51" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">基本命令</h1><p id="26ef" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这里有一些你绝对应该知道的基本但重要的SQL命令。让我们首先讨论它们是做什么的——稍后您将通过示例看到实际的语法和代码。</p><ul class=""><li id="f602" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">CREATE TABLE:该命令在关系数据库中创建一个表。您可以使用这个命令定义一个表的模式(这是可选的，取决于您使用的数据库，例如MySQL)。</li><li id="ca03" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">INSERT:这将一次向给定的表或一组行中插入一行。</li><li id="a3b4" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">更新:当您需要修改已经存在的数据时，使用该命令。</li><li id="70a9" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">删除:从数据中删除一行(或多行)。</li><li id="0ae8" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">SELECT:从表中选取和获取某些列。这在大多数查询中使用。</li><li id="b6f6" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">内部连接:将多个表组合在一起，它将保留两个表中列值匹配的行。单词INNER是可选的，很少使用(通常省略)。</li><li id="417f" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">左外连接:通过匹配提供的列将多个表组合在一起，但保留连接的第一个表中的所有行</li><li id="0d32" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">完全外部连接:通过匹配列将多个表组合在一起，但保留所有行(外部连接是可选的)。</li><li id="86c6" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">GROUP BY:对指定列或一组列中具有相同值的行进行分组/聚合。</li><li id="6864" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">其中:在应用任何分组之前，提供筛选条件。</li><li id="9a80" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">HAVING:在应用任何分组后，提供筛选条件。</li><li id="5e50" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">ORDER BY:按特定的一列或多列对结果进行升序或降序排序。</li><li id="6818" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">DISTINCT:仅返回不同的值。</li></ul><p id="d59a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在实践中，面试官会评估你能否回答一个简单的问题(通常是一个业务用例)，并提出正确的问题。</p><h1 id="7da2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">有用的花絮</h1><p id="919a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一般来说，SQL查询会涉及到以下几个部分:</p><ol class=""><li id="982e" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm ng my mz na bi translated">聚合:对结果行集使用COUNT()、SUM()或任何聚合函数</li></ol><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="9dd4" class="nm la it ni b gy nn no l np nq">SELECT COUNT(*) FROM users..</span></pre><p id="b7c3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.连接:常用于多个表之间的查询。例如，下面是用户名花费的总时间:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="81d7" class="nm la it ni b gy nn no l np nq">SELECT users.name, SUM(sessions.time_spent) AS total_time_spent  FROM users u JOIN sessions s ON u.user_id = s.user_id GROUP BY 1</span></pre><p id="772c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">3.过滤:有各种方法来测试相等性，其中最常见的是使用=和&lt;&gt;(不等于)、or &gt;和</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="57b8" class="nm la it ni b gy nn no l np nq">SELECT * FROM users  WHERE username &lt;&gt; 'unknown' OR username LIKE '%123%'</span></pre><p id="9d7f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">4.公用表表达式(cte)和子查询:</p><p id="ae89" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">CTEs允许您定义一个查询，然后在以后使用别名引用它——对于分解大型查询或者对于编写的各种查询有自然顺序的情况非常有用。例如，我们可以对用户子集进行快速CTE，然后使用这些特定用户进行简单分析:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="64c7" class="nm la it ni b gy nn no l np nq">WITH (SELECT * FROM users WHERE join_date &gt; '2020-01-01') AS u   SELECT u.name, SUM(sessions.time_spent) AS total_time_spent  FROM u JOIN sessions s ON u.user_id = s.user_id GROUP BY 1</span></pre><p id="f5e7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">子查询内嵌在查询本身中，只能使用一次:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="b9aa" class="nm la it ni b gy nn no l np nq">SELECT * FROM users AS u JOIN  (SELECT user_id, time_spent FROM sessions   WHERE session_date &gt; '2020-01-01') AS s  ON u.user_id = s.user_id</span></pre><p id="f127" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">查询问题通常围绕着一组与公司相关的表——在脸书是用户和使用情况表，在优步是乘客和司机表，等等。因此，除了熟悉查询之外，理解数据库的基本概念也很重要(将在下面介绍):主键、外键、索引等等。这样做的一个好方法是考虑公司应该使用的潜在表，以及哪些操作是有用的。</p><p id="cfd9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，想象你在脸书工作，有用户和帖子以及对帖子的反应。这些表看起来会是什么样子，你用来连接表的外键是什么？表中的哪些列将被索引，为什么？</p><h1 id="0c19" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">窗口功能</h1><p id="cb97" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">窗口函数是跨一组行进行计算的函数(像聚合函数一样)，但不将这些行分组(像聚合函数一样)。它们涉及一个聚合函数和一个OVER子句，您可以通过使用PARTITION BY来缩小窗口:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="a10f" class="nm la it ni b gy nn no l np nq">SELECT *, SUM(time_spent) OVER <br/>(PARTITION BY user_id ORDER BY join_time ASC) <br/>FROM sessions</span></pre><p id="df2d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个特定的示例中，我们获得了会话数据中行级别花费的总时间(不需要按每个user_id分组)。</p><p id="ca61" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，您不能在同一个查询中使用窗口函数和聚合函数，但是它们在各种情况下都很方便。当您看到需要聚合时，您会希望让它们参与进来，但是要维护行。</p><h1 id="17f1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">10个SQL面试问题</h1><ol class=""><li id="13de" class="ms mt it lt b lu lv lx ly ma nr me ns mi nt mm ng my mz na bi translated">假设你有一个关于应用分析的表格(应用标识，事件标识，时间戳)。写一个查询，得到2020年每个app的点击率。</li><li id="da8e" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设给你一个按设备分类的观众情况表(用户标识、设备类型、观看时间)。将“移动”定义为平板电脑和手机的总和。编写一个查询来比较笔记本电脑和移动设备上的收视率。</li><li id="870c" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您有一个来自用户的收入表(user_id，spend，transaction_date)。编写一个查询来获取每个用户的第三次购买。</li><li id="25a0" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您有一个按产品类型(order_id、user_id、product_id、spend、date)划分的支出活动表。编写一个查询，按时间顺序计算每种产品在一段时间内的累计花费。</li><li id="77f2" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设给你一个用户发推文的表格(tweet_id，user_id，msg，tweet_date)。编写一个查询来获取2020年内发布的tweet计数的直方图。</li><li id="6785" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您有两个表:1)用户(user_id，date)和2)用户帖子(post_id，user_id，body，date)。编写一个查询来获取用户发布的帖子数量的分布。</li><li id="8c4b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您有一个按产品类型(order_id、user_id、product_id、spend、date)划分的支出活动表。编写一个查询，按时间顺序计算每种产品在一段时间内的累计花费。</li><li id="c228" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您有一个关于用户操作的表(user_id、event_id、timestamp)。编写一个查询，按月获取活动用户保持率。</li><li id="2145" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您从用户那里得到一个会话表(session_id，start_time，end_time)。如果一个会话与另一个会话在开始和结束时间上重叠，则它们是并发的。编写一个查询来输出与最大数量的其他会话并发的会话。</li><li id="b8cf" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ng my mz na bi translated">假设您有两个表，分别是1)用户注册(user_id，signup_date)和2)用户购买(user_id，product_id，purchase_amount，purchase_date)。编写一个查询来获取上周加入的用户的转换率，这些用户从那以后至少购买了一件商品。</li></ol><h1 id="89ab" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">感谢阅读！</h1><p id="ab89" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您有兴趣在数据科学访谈中进一步探索SQL，请查看这份<a class="ae ky" href="https://datascienceprep.com/" rel="noopener ugc nofollow" target="_blank">简讯</a>，它每周三次向您发送练习题。另外，请留意即将出版的<a class="ae ky" href="http://acethedatascienceinterview.com/" rel="noopener ugc nofollow" target="_blank">书</a>！</p></div></div>    
</body>
</html>