<html>
<head>
<title>GeoSpatial analysis in Python and Jupyter Notebooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python和Jupyter笔记本中的地理空间分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777?source=collection_archive---------9-----------------------#2020-10-20">https://towardsdatascience.com/geospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777?source=collection_archive---------9-----------------------#2020-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c1db" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用geopandas和kepler.gl对巴塞罗那自行车租赁服务(bicing)进行地理空间分析。</h2></div><p id="d7d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">世界上大多数国家的首都都在使用公共城市自行车服务，这减少了燃料消耗、排放和市中心的<a class="ae lb" href="https://blog.mobility.here.com/congestion-charge-impact" rel="noopener ugc nofollow" target="_blank">拥堵。自行车共享还鼓励体育活动，有助于城市居民的健康。</a></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/54a1f621dd97418e32bb0ba9d3dae630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TNMnYjgnn2WJ2CJi"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@jass89?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jasser Gómez </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="62d5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据摄取</h1><p id="fa55" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">幸运的是，它有一个开放的<a class="ae lb" href="http://api.citybik.es/v2/" rel="noopener ugc nofollow" target="_blank"> CityBikes API </a>，可以用来实时检查自行车站点的状态(例如，我们可以检查任何站点的空闲位置的数量)。此外，还有一个用于查询CityBikes API的python包<code class="fe mp mq mr ms b"><a class="ae lb" href="https://github.com/eskerda/python-citybikes" rel="noopener ugc nofollow" target="_blank">python-citybikes</a></code>。</p><p id="d057" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">巴塞罗那是使用CytyBikes API公开数据的城市之一。使用上面提到的包，巴塞罗那的自行车服务(又名<a class="ae lb" href="https://www.bicing.barcelona/" rel="noopener ugc nofollow" target="_blank"> bicing </a>)可以使用以下代码进行查询:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="cb19" class="mx lt iq ms b gy my mz l na nb">client = citybikes.Client()<br/>bicing = citybikes.Network(client, uid='bicing')<br/>bicing.stations</span></pre><p id="957e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">前一个调用以JSON格式返回工作站的数据:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="1539" class="mx lt iq ms b gy my mz l na nb">{<br/>    "company": ["Barcelona de Serveis Municipals, S.A. (BSM)", "CESPA", "PBSC"],<br/>    "href": "/v2/networks/bicing",<br/>    "id": "bicing",<br/>    "location": {<br/>        "city": "Barcelona",<br/>        "country": "ES",<br/>        "latitude": 41.3850639,<br/>        "longitude": 2.1734035<br/>    },<br/>    "name": "Bicing",<br/>    "stations": [<br/>        {<br/>            "empty_slots": 17,<br/>            "extra": {<br/>                "ebikes": 0,<br/>                "has_ebikes": true,<br/>                "normal_bikes": 16,<br/>                "online": true,<br/>                "uid": 361<br/>            },<br/>            "free_bikes": 16,<br/>            "id": "ed25291d0f5edd91615d154f243f82f9",<br/>            "latitude": 41.376433,<br/>            "longitude": 2.17871,<br/>            "name": "PG. DE COLOM (LES RAMBLES)",<br/>            "timestamp": "2020-10-16T18:19:06.097000Z"<br/>        },<br/>        ...<br/>    ]<br/>}</span></pre><p id="7a61" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">处理完数据后，我们将数据从JSON模式转换成表格模式:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nc"><img src="../Images/dde1f06e34a59213f3d5ddc197ebb9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WESC9VUqxo1yh6yJINRr9w.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">自行车站数据框</p></figure><p id="2d1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该API不提供历史服务，但是您可以开发自己的脚本来每5分钟下载一次数据(Bicing refresh rate)。配套的<a class="ae lb" href="https://github.com/franperezlopez/spatial/blob/master/bicing%20medium.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>显示如何下载和处理数据；在<code class="fe mp mq mr ms b">data/bicing_saturday_morning.parquet</code>中，处理后的数据样本也作为拼花文件提供。</p><h1 id="f170" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">巴塞罗那——自行车站</h1><p id="4d02" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">第一个空间操作将是使用从CityBikes API下载数据时可用的经度和纬度信息在地图上绘制车站:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="7755" class="mx lt iq ms b gy my mz l na nb">df_stations = df[["name","latitude","longitude"]].drop_duplicates()</span></pre><p id="0c22" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一张地图会将所有这些站放在地图上:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="7f2a" class="mx lt iq ms b gy my mz l na nb">stations_map = KeplerGl(height=600, data={"stations": df_stations})<br/>stations_map</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nd"><img src="../Images/7fd71a4b320de54e0e13a6423f52a0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rm8cNWdXkmAV_-7tBuUkFg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">巴塞罗那自行车站</p></figure><p id="2bd1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mp mq mr ms b">kepler.gl</code>很聪明地推断出列<code class="fe mp mq mr ms b">latitude</code>和<code class="fe mp mq mr ms b">longitude</code>代表了车站的地理坐标。该地图可以显示在Jupyter笔记本中，并且可以使用UI配置该地图，以在不同的地图样式(平面或卫星)和图层(道路、建筑物等)之间切换。这些UI <em class="ne">调整</em>可以<em class="ne">导出</em>为python字典，然后在下次加载地图时使用。查看<a class="ae lb" href="https://docs.kepler.gl/docs/keplergl-jupyter" rel="noopener ugc nofollow" target="_blank"> kepler.gl文档</a>了解更多关于定制地图的信息。</p><h1 id="dc1e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">细川玉子区—自行车站</h1><p id="9032" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">CityBikes API不提供按地区划分的车站信息(只有车站的名称，也就是车站的地址)。但是不用担心，我们仍然可以使用社区提供的公开数据。在这种情况下，我们将使用<a class="ae lb" href="https://github.com/martgnz/bcn-geodata" rel="noopener ugc nofollow" target="_blank">巴塞罗那开放地理数据</a>存储库，以及那里提供的地区地理位置。</p><p id="3f36" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Geopandas可以阅读。geojson文件使用:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="6eb8" class="mx lt iq ms b gy my mz l na nb">df_districts = geopandas.read_file("data/districtes.geojson")</span></pre><p id="f56c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对象<code class="fe mp mq mr ms b">df_districts</code>类似于一个常规的Pandas dataframe，但是包含一个名为<code class="fe mp mq mr ms b">geometry</code>的列。Geopandas数据帧可以根据需要包含任意多的<em class="ne">地理</em>列，但是我强烈建议每个数据帧只使用一个，并将其命名为<code class="fe mp mq mr ms b">geometry</code>。在这种情况下，文件包含10个地区(行)和47列(带有地区名称、网站、区域等信息)。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nf"><img src="../Images/ea92476c2587fc6c84c95ab355738246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUjb1gYKFnCOONnS4VzLOg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">巴塞罗那地区数据框架</p></figure><p id="864c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">geopandas数据帧可以按原样绘制:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ng"><img src="../Images/1840b5001d984e54540dd0232c108aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*HQFJLR8vgX59TgtOaFspWA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">巴塞罗那区</p></figure><p id="9b00" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，我们可以在另一个地图实例中沿着自行车站投影该地区的边界:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="7e1b" class="mx lt iq ms b gy my mz l na nb">district_map = KeplerGl(height=600, data={"stations": df_stations,                                          "districts": df_districts})</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/b43a966b7340b2d87338ba7876ce7a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*YeD5xv5pTtC78KdzWObU_g.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">巴塞罗那自行车站和区</p></figure><p id="5c5f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上图中，我们可以直观地查看哪些车站位于细川玉子区，但是有没有办法以表格的方式提取这些信息呢？是的，您可以:欢迎使用空间连接。</p><p id="fded" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们需要将包含站点位置的数据帧转换为Geopandas数据帧:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="85ba" class="mx lt iq ms b gy my mz l na nb">df_stations = geopandas.GeoDataFrame(df_stations.name, geometry=geopandas.points_from_xy(df_stations.longitude, df_stations.latitude, crs='epsg:4326'))</span></pre><p id="abb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码片段中，您可以观察到一个名为<code class="fe mp mq mr ms b">crs</code>的参数。总结一下:经纬度数字是有规律的数字，但是当你对它们应用一个<a class="ae lb" href="https://en.wikipedia.org/wiki/Spatial_reference_system" rel="noopener ugc nofollow" target="_blank">坐标参考系</a> ( <strong class="kh ir"> CRS </strong>)的时候，这些数字就可以投影到一张地图上。参考系比较多，课题比较复杂，我就把我的研究缩减到只有两个<em class="ne"> CRS </em>的(请<em class="ne"> GIS专家</em>原谅我的无礼):</p><ul class=""><li id="48af" class="ni nj iq kh b ki kj kl km ko nk ks nl kw nm la nn no np nq bi translated">通用<em class="ne"> WGS 86 (EPSG: 4326) </em>以经度/纬度表示世界上的位置</li><li id="9138" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">墨卡托<em class="ne"> (EPSG: 3395) </em>当与距离一起工作时</li></ul><p id="2ec1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们使用两个<em class="ne">坐标系</em>来投影世界地图时，可以理解两个坐标系之间的差异:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nw"><img src="../Images/f4b81bdfb832cdc632bf1d87d448617c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zrg1LMm5cr5LjaUZDD5Dg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">使用WGS86和墨卡托投影的世界地图</p></figure><p id="57d3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您需要有关投影和使用不同参考系统的更多信息，我建议查看<a class="ae lb" href="https://geopandas.org/projections.html" rel="noopener ugc nofollow" target="_blank">管理投影GeoPandas文档</a>。</p><p id="f8a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://geopandas.org/mergingdata.html#spatial-joins" rel="noopener ugc nofollow" target="_blank">空间连接</a>将返回包含在每个区内的点(=自行车站):</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="d7d3" class="mx lt iq ms b gy my mz l na nb">df_stations_districte = geopandas.sjoin(df_stations,  df_districts[["NOM","geometry"]], how="inner", op='intersects')</span></pre><p id="a984" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从那里，过滤掉细川玉子区的电台就这么简单:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="561a" class="mx lt iq ms b gy my mz l na nb">df_stations_district_gracia = df_stations_district[df_stations_district.NOM=='Gràcia']</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/13f810b4bb1cc5aaac035ab6ac7e69fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*YX0HZTd1qG3Oq9vfM13Ffw.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">格拉西亚区的自行车站</p></figure><h1 id="36fe" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">细川玉子区——自行车站“影响区”</h1><p id="1ffa" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">影响区域可以显示为以每个站为中心的圆。圆的半径可以是用户定义的参数(例如，300米)。正如我们之前提到的，为了处理距离，我们需要<em class="ne">暂时</em>将参考系统切换到墨卡托:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="3efa" class="mx lt iq ms b gy my mz l na nb">def buffer_in_mercator(geometry, distance_x_meters):<br/>    crs = geometry.crs<br/>    return geometry.to_crs(epsg=3395).buffer(distance_x_meters).to_crs(crs)</span></pre><p id="6a72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将函数应用于站点的位置后，我们可以绘制每个自行车站点周围的影响区域:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/542b1015f080952f227cd69145014b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*amQqMxIU5-SUiYq92q5Ybw.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">自行车站影响区域</p></figure><h1 id="3286" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">细川玉子区——骑自行车的最佳区域</h1><p id="78c9" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在这种情况下，所采用的方法是，地图中的每个区域都可能受到许多站点的影响，因此该区域中可用的自行车数量将是与该区域<em class="ne">接触的</em>影响区域中可用自行车数量的总和。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/1a8a531a2047a083785d431c6ba5d934.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*J1nm60Yb88irUFTU6ga1yA.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">自行车站点区域和统计数据</p></figure><p id="61ef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要计算所有影响区域之间所有交集的并集。这个操作可以使用库<code class="fe mp mq mr ms b">shapely</code>来解决(感谢<a class="ae lb" href="https://gis.stackexchange.com/a/246184" rel="noopener ugc nofollow" target="_blank"> stackoverflow </a>):</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="91fa" class="mx lt iq ms b gy my mz l na nb">shapes = areas.to_list()<br/>areas_overlay = list(polygonize(unary_union(list(x.exterior for x in shapes))))</span></pre><p id="23b1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该操作为每个叠加交点创建一个形状(区域)，因此总共生成68个形状。如前所述，我们可以绘制图形来更好地理解操作本身:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/59b9981512c114ba3f4e16f3703742c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*OO1JM842QXRu1eB85RhZXA.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">自行车站区</p></figure><p id="65ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">免费自行车的数量可通过在区域和车站影响区域之间执行空间连接，并将同一区域中的所有行相加来获得:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="18e2" class="mx lt iq ms b gy my mz l na nb">df_gracia_area_stats = gpd.sjoin(df_areas_overlay, <br/>                                 df_gracia_stats.reset_index(), <br/>                                 how="left", op='intersects')\<br/>                                .reset_index()\<br/>                                .rename(columns={'index':'index_left'})<br/>df_gracia_area_stats['free_bikes_area'] = df_gracia_area_stats.groupby("index_left")['free_bikes'].transform(sum)</span></pre><p id="0e32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，实例<code class="fe mp mq mr ms b">df_gracia_area_stats</code>是一个geopandas数据帧，可以投影到地图上，直观地检查Gràcia区的自行车可用性:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="547e" class="mx lt iq ms b gy my mz l na nb">free_bikes_map = KeplerGl(height=600, data={"areas": df_gracia_free_bikes})</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/9d3e88180dbb3620e9384dc57dd4b30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Ek1lgr_W9m28qhKp41YtPw.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">格拉西亚区</p></figure><p id="97e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与之前相同，可以用表格的方式提取最佳区域:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="f919" class="mx lt iq ms b gy my mz l na nb">df_gracia_free_bikes.loc[df_gracia_free_bikes.free_bikes_median.idxmax()]</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/fa3d3644fa99e8ac04894fb290afb196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*hEuNCKSNgfpY7GNYYc6JDA.png"/></div></figure></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="5e4d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总之，<code class="fe mp mq mr ms b">geopandas</code>和<code class="fe mp mq mr ms b">kepler.gl</code>是您数据分析工具箱的强大补充。<code class="fe mp mq mr ms b">geopandas</code>基于Pandas dataframe API，而<code class="fe mp mq mr ms b">kepler.gl</code>在其核心支持Pandas dataframe，因此这两个库的学习曲线都很快，同时好处也很大。</p><p id="ddc4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章的完整代码可以在这里找到——<a class="ae lb" href="https://github.com/franperezlopez/blog_spatial" rel="noopener ugc nofollow" target="_blank">https://github.com/franperezlopez/blog_spatial</a></p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><h2 id="d5df" class="mx lt iq bd lu oi oj dn ly ok ol dp mc ko om on me ks oo op mg kw oq or mi os bi translated">安装<code class="fe mp mq mr ms b">kepler.gl</code></h2><p id="ef6f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">安装这个库有点棘手，这方面缺少文档，所以我会尽量简化这一步。首先，这个库似乎不能在Windows中工作，所以你需要使用MacOS、Linux或WSL(2)。</p><p id="acf4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其次，这个库需要安装一个Jupyter扩展。按照我自己关于如何<a class="ae lb" rel="noopener" target="_blank" href="/4-techniques-to-enhance-your-research-in-machine-learning-projects-c691892ab9dd">安装Jupyter Notebook </a>的建议，您应该在您的<em class="ne"> base </em>环境中安装这个扩展，执行以下命令:</p><pre class="ld le lf lg gt mt ms mu mv aw mw bi"><span id="ae10" class="mx lt iq ms b gy my mz l na nb">conda activate base<br/>pip install --user --use-feature=2020-resolver keplergl</span><span id="037f" class="mx lt iq ms b gy ot mz l na nb">jupyter nbextension install --system --py keplergl<br/>jupyter nbextension enable --system --py keplergl</span></pre><h2 id="8087" class="mx lt iq bd lu oi oj dn ly ok ol dp mc ko om on me ks oo op mg kw oq or mi os bi translated">参考</h2><p id="a5fc" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">[1] <a class="ae lb" href="https://mobility.here.com/learn/smart-city-mobility/smart-city-bike-services-economic-environmental-and-societal-impacts" rel="noopener ugc nofollow" target="_blank">智能城市自行车服务:经济、环境&amp;社会影响</a></p></div></div>    
</body>
</html>