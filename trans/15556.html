<html>
<head>
<title>Ruining Sudoku — A Data Science project (Part 3: Digits recognition and Sudoku solver)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">破坏数独——一个数据科学项目(第三部分:数字识别和数独求解器)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ruining-sudoku-a-data-science-project-part-3-digits-recognition-and-sudoku-solver-5271e6acd81f?source=collection_archive---------46-----------------------#2020-10-26">https://towardsdatascience.com/ruining-sudoku-a-data-science-project-part-3-digits-recognition-and-sudoku-solver-5271e6acd81f?source=collection_archive---------46-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fa12c4ab723ca8412065de5fa075e491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pc72ggGHfj2B6IpC"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">数字五。或者，根据每一个训练有素的MNIST分类器，一个6。或者八，或者蝙蝠侠的标志，为什么不呢。瑞安·约翰斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ebd7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，这是你真正关心的一篇文章，其中GPU升温和损耗曲线是平坦的:今天我们将讨论该项目的两个核心部分，即如何识别九个数字中的哪一个出现在每个数独单元中，我们事先识别并分离了这些数字(查看本系列的第二篇文章中的细节)，并从那里着手解决这个难题。哦，我们还会用2020年的<em class="lb">魔法</em> : <em class="lb"> </em> AI <em class="lb">。</em></p><p id="9fd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但首先，快速回顾一下我们是如何走到这一步的。</p><h1 id="ca6e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">之前(和下周)，在这个系列中</h1><ul class=""><li id="cc14" class="ma mb iq kf b kg mc kk md ko me ks mf kw mg la mh mi mj mk bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/ruining-sudoku-a-data-science-project-part-1-introduction-and-project-design-160a3c5caee5">第一部分:简介和项目设计</a></li><li id="85f9" class="ma mb iq kf b kg ml kk mm ko mn ks mo kw mp la mh mi mj mk bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/ruining-sudoku-a-data-science-project-part-2-data-preprocessing-27a290803c48">第二部分:数据预处理</a></li><li id="16bf" class="ma mb iq kf b kg ml kk mm ko mn ks mo kw mp la mh mi mj mk bi translated">第3部分:数字识别和数独求解器——你正在阅读！</li><li id="a59f" class="ma mb iq kf b kg ml kk mm ko mn ks mo kw mp la mh mi mj mk bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/ruining-sudoku-a-data-science-project-part-4-deployment-and-retro-27620bbeca75">第4部分:部署和追溯</a></li></ul><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/90529ee7ee209fe5823f266d599c03e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SdFL87RlbaLyQHGX"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">弗兰克·维西亚在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8ac8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从一个相对简单的想法开始:设计并实现一个系统，该系统将一张数独网格清晰可见(但不一定对齐/居中)的图片作为输入，并返回该谜题的<em class="lb">解</em>。</p><p id="6b4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们花了相当多的时间来组织我们的工作，以便我们至少对各种任务的难度有一个粗略的想法(因此我们必须分配给每一项任务多少时间)，并且我们处理了第一个主要的工作包，数据预处理。</p><p id="eb3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们相信我们的系统正确地处理了输入图像，并把网格中的81个单元干净整洁地分开了:是时候做有趣的事情了。</p><h1 id="1497" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第二步:解决数独</h1><p id="3925" class="pw-post-body-paragraph kd ke iq kf b kg mc ki kj kk md km kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">如果你正在读这篇文章，你可能很擅长数学，因此会注意到我把第二步放在第一步之前，尽管2被一致认为大于1。我发誓这是有原因的。</p><p id="a2ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你还记得的话，在计划的时候，我给每一个子任务分配了一个估计的难度等级，红色代表我所知甚少或者一无所知的子任务。<strong class="kf ir">解算器</strong>就是其中之一。虽然我几乎可以肯定在Github repo中有一种算法形式的解决方案，但我还没有正确地搜索它，所以我不愿意想当然地在专注于数字识别任务之前研究这一部分，另一方面，我认为我知道如何解决这个问题。哦，讽刺的是。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/7338d19c95215d0aef3f7c8be1f1d9b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUgspknfsPcY0jDpR-lxkw.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">最终项目组织结构图。颜色表示估计的难度。<br/>作者图片</p></figure><p id="7054" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无论如何，一个简短的搜索就足以找到一个<a class="ae kc" href="https://gist.github.com/matteobarbieri/cf1b46345fe8b69e35744ce54b52469f" rel="noopener ugc nofollow" target="_blank">片段</a>，它确实做到了这一点，所以这一整节的目的只是为了强调关注你对<em class="lb">首先</em>不太有信心的地方的重要性，以便通过找到一个解决方案(比如在这种情况下)或找到一些变通办法来尽早摆脱这种不确定性。</p><h1 id="4282" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第一步:识别数字</h1><p id="8dff" class="pw-post-body-paragraph kd ke iq kf b kg mc ki kj kk md km kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">在这一点上唯一缺少的是数字分类器，一旦插入我们的系统，这个项目基本上就结束了。</p><p id="e2fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我预计这是一个相对容易的部分:每个接触深度学习的人，特别是CNN的人，都必须经历在臭名昭著的手写数字识别数据集<em class="lb"> MNIST </em>上训练模型的初始仪式，并且可以在睡梦中产生这样的分类器，所以我确实这样做了。</p><p id="1038" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，虽然在MNIST的测试集上表现得相当好，但在流水线的前一步中产生的实际图像(包含一位数字的孤立单元网格)上的结果至少可以说是相当令人失望的。当然，大多数时候它仍然是正确的，但是请记住，为了让这个系统工作，即使一个错误也会导致不正确的结果。在这个项目中，我遇到了第一个真正的障碍，不得不去处理它。</p><h2 id="a603" class="mz ld iq bd le na nb dn li nc nd dp lm ko ne nf lq ks ng nh lu kw ni nj ly nk bi translated">两步故障排除</h2><p id="7c76" class="pw-post-body-paragraph kd ke iq kf b kg mc ki kj kk md km kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">糟透了，但这种事时有发生。为了解决这样的问题，我尝试回答以下两个问题:</p><ol class=""><li id="09ea" class="ma mb iq kf b kg kh kk kl ko nl ks nm kw nn la no mi mj mk bi translated">为什么它不起作用？</li><li id="b637" class="ma mb iq kf b kg ml kk mm ko mn ks mo kw mp la no mi mj mk bi translated">我能做些什么呢？</li></ol><p id="f8aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了回答第一个问题，并找出为什么我的表现如此糟糕(相对而言)，我分析了被错误分类的图像，注意到大多数错误发生在数字<strong class="kf ir"> 1 </strong>上，它经常(错误地)被标记为<strong class="kf ir"> 7 </strong>。在其他情况下，图像有某种噪声(小块非黑色像素)，预处理步骤没有去除这些噪声，这显然足以混淆模型并产生错误的预测，尽管数字本身在图像中显示得很清楚！</p><div class="mr ms mt mu gt ab cb"><figure class="np jr nq nr ns nt nu paragraph-image"><img src="../Images/dd4e5f08b907df398ba48d8a74fcde53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*rXPburilMcKnRX_3KdSBzw.png"/></figure><figure class="np jr nv nr ns nt nu paragraph-image"><img src="../Images/c477401b1aefbf1dee5b28850b2465e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*3zmsaSaaU1jtT8oKLkQHiQ.png"/><p class="jy jz gj gh gi ka kb bd b be z dk nw di nx ny translated">左侧是来自MNIST数据集的数字1的样本。在右边，从实际的数独网格中提取的1。尽管非常相似，但在MNIST上训练的分类器可能无法正确分类右边的那个，而是预测为7。作者图片</p></figure></div><p id="a5d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">老实说，这并没有真的让我吃惊:我对MNIST数据集有严重的问题，<a class="ae kc" href="https://medium.com/@matteo.a.barbieri/why-mnist-is-the-worst-thing-that-has-ever-happened-to-humanity-49fd053f0f66" rel="noopener">我写了一篇&gt; 1000字的长篇大论，为什么它是着火的垃圾</a>。简而言之，虽然它是对图像分类问题的一个很好的介绍，但当应用于一种与大多数在线教程中呈现的问题略有不同的问题时(数字打印的数字而不是手写的数字)，它并不真正起作用。</p><p id="1b44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我设计的解决方案基于一个神圣的原则，即你应该尽最大努力训练一个数据模型，这个数据与你希望模型工作的数据尽可能相似。如果你在为你的下一个额头纹身寻找报价，请考虑前面的句子。</p><p id="5a38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我所做的是使用Python PIL包生成一个<em class="lb">合成</em>数据集，在一个正方形画布上以略微不同的大小和位置绘制各个数字。对于每张图片，都从与杂志中使用的字体最相似的列表中选择一种字体，以提高模型的泛化能力。此外，这些图像是在模型训练时动态创建的<em class="lb">因此不需要磁盘空间，因为它们没有被保存。</em></p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="7c0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种生成数据的方式，加上一些标准的数据扩充(实际上只是旋转，加上一些定制的椒盐噪声，以使其对图像中的缺陷具有抵抗力)，产生了一个模型，尽管并不完美，但产生了明显更好的结果。</p><p id="789d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有一个小细节需要讨论:数字分类器可以识别从0到9的数字，但是数独单元格要么包含从1到9的数字<strong class="kf ir">要么</strong>为空<strong class="kf ir"> </strong>。我发现处理这种情况的最简单的方法是首先使用一些试探法来查看单元格中是否有任何东西(通过简单地计数有多少像素与背景颜色不同，并确定一些合理的阈值)，并且只有在实际分类中有一些东西在进行时。这有一个额外的好处，即避免在无用的计算上浪费大量的时间和资源(计算白色像素比在CNN上运行推理要便宜得多)。</p><figure class="mr ms mt mu gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="2865" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">无聊(但是有用！)工具/物流blabla</h1><p id="a9d8" class="pw-post-body-paragraph kd ke iq kf b kg mc ki kj kk md km kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">在我回到我的Factorio megabase之前，我想多说几句我在这个项目中使用的工具。</p><p id="8a94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我真的不想卷入整个文本编辑器/IDE帮派战争，已经流了太多的血。我个人使用Vim(有大量插件，检查我的<a class="ae kc" href="https://github.com/matteobarbieri/qol/blob/master/dotfiles/vim/.vimrc" rel="noopener ugc nofollow" target="_blank">)。vimrc </a>如果你感兴趣的话)因为我超级老了但是我对这个话题没有强烈的看法，用什么让你开心。</p><p id="fa25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，最近我一直在使用一个实验跟踪/簿记工具来跟踪正在运行/已经完成的实验。即使对于像这样的超小型项目，我也建议使用它，因为它会以增加几行代码为代价，使您的生活变得更加简单。有几个工具，我个人很喜欢，也想建议使用<a class="ae kc" href="https://github.com/IDSIA/sacred" rel="noopener ugc nofollow" target="_blank">神圣的</a>(加上<a class="ae kc" href="https://github.com/vivekratnavel/omniboard" rel="noopener ugc nofollow" target="_blank">综合</a>可视化)。</p><p id="aa7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，这是一个简单的问题，Jupyter笔记本非常适合数据探索和快速原型制作。使用它们！</p><h1 id="1022" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">搞定了。</h1><p id="74c1" class="pw-post-body-paragraph kd ke iq kf b kg mc ki kj kk md km kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">就是这样！这次是真的！流水线现在完成了，我们有了从原始输入图像到谜题解决方案的清晰路径。下周，我们将通过使用Docker将其打包成web应用程序的形式来完成该项目。</p><p id="580b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在<a class="ae kc" href="https://github.com/matteobarbieri/sudoku" rel="noopener ugc nofollow" target="_blank"> this Github repo </a>中找到这一系列文章的笔记本和代码。</p><p id="a8e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">七天后见！</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><div class="mr ms mt mu gt oi"><a href="https://github.com/matteobarbieri/sudoku" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">matteobarbieri/数独</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">github.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow jw oi"/></div></div></a></div></div></div>    
</body>
</html>