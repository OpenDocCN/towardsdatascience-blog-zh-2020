<html>
<head>
<title>Data Lakes, Oracle ADWH, and Object Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据湖、Oracle ADWH和对象存储</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-lakes-oracle-adwh-and-object-storage-b5ec0477e79?source=collection_archive---------53-----------------------#2020-10-27">https://towardsdatascience.com/data-lakes-oracle-adwh-and-object-storage-b5ec0477e79?source=collection_archive---------53-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="5a1f" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">引言。</h1><p id="7f53" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在是2020年，再也没有时间使用大型昂贵的集群了。</p><p id="bea3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如今，构建在云环境中的<strong class="kn ir">现代数据湖</strong>，应该尽可能多地使用<strong class="kn ir">云原生的、无服务器的服务</strong>，以获得公共云范例提供的全部<strong class="kn ir">敏捷性、弹性和效率</strong>。</p><p id="5af3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在本笔记中，我想简要介绍如何使用<strong class="kn ir"> Oracle云基础设施(OCI) </strong>构建这样一个数据湖，以及如何使用<strong class="kn ir"> Oracle自治数据仓库(ADWH) </strong>为存储在数据湖中的数据提供<strong class="kn ir"> SQL访问</strong>。</p><p id="0ad8" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我将简要描述存储数据的最佳选择，以及提取、转换和加载数据的可用服务。然后，我将介绍启用SQL访问所需的步骤。</p><p id="7ac1" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我还将提供并描述一些实用程序，它们有助于简化任务。</p><h1 id="0e5e" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">文件作为对象。</h1><p id="f6d6" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在数据湖环境中，您应该能够高效地为您的数据科学家、BI专家和业务用户想要探索和利用的所有数据集提供弹性存储。您不应该忘记“<strong class="kn ir">读取模式</strong>”的要求:当您存储数据时，您不希望被迫指定一个模式。</p><p id="987e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">对象存储</strong>是存储所有数据集的最佳位置。您可以将它们组织在不同的<strong class="kn ir">存储桶</strong>中，例如创建一个“原始数据区”和一个“分析就绪”区，前者存储源系统提供的数据集，后者存储所有经过验证、过滤和聚合的数据集，以备分析和数据科学家的笔记本使用。</p><p id="805b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">对象存储可以根据您的需要扩展，无需任何规划，并且足够便宜(大约25.5美元/TB/月)来存储数Pb的数据。此外，您可以使用许多OCI功能，例如，管理文件的生命周期(您可以定义规则来归档超过一定时间的文件)，甚至添加元数据，以便更容易地找到您工作所需的数据。</p><h1 id="508c" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">快速浏览加工过程。</h1><p id="334a" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我看来，数据湖中的处理必须使用<strong class="kn ir">无服务器云服务</strong>来完成，首选引擎应该基于<strong class="kn ir"> Apache Spark </strong>。</p><p id="138d" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Apache Spark是<strong class="kn ir">并行</strong>、<strong class="kn ir">分布式、大规模处理</strong>的绝佳环境。这是一个完善且持久的开源项目，由<a class="ae lo" href="https://spark.apache.org/committers.html" rel="noopener ugc nofollow" target="_blank">许多公司</a>支持。您可以在几种语言(Scala、Python、Java、SQL)之间进行选择，并且您可以找到支持数据帧、流和分布式机器学习(MLlib)的库。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/f7dae0fd1529b0aa738db50faf1c2b15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*lnLv5V3Ty_RJwfQw.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图1:阿帕奇火花模块(来源:<a class="ae lo" href="https://spark.apache.org)." rel="noopener ugc nofollow" target="_blank">https://spark.apache.org)</a>。</p></figure><p id="9f06" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">而且，<strong class="kn ir"> Spark比Hadoop和MapReduce快得多</strong>。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/17deaaec2e00fa70587bed0414c2e96a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/0*mgtYmfh3c5z-466H.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图2: Spark表演(来源:<a class="ae lo" href="https://spark.apache.org)." rel="noopener ugc nofollow" target="_blank"> https://spark.apache.org)。</a></p></figure><p id="92c2" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">在OCI </strong>我们有两项服务提供基于Spark无服务器引擎的完整集成处理环境:<a class="ae lo" href="https://www.oracle.com/integration/oracle-cloud-infrastructure-data-integration/" rel="noopener ugc nofollow" target="_blank"> OCI数据集成</a>和<a class="ae lo" href="https://www.oracle.com/big-data/data-flow/" rel="noopener ugc nofollow" target="_blank"> OCI数据流</a>。</p><p id="f180" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">有了这些服务，您可以开发快速且可伸缩的ETL。而且，由于无服务器的特性，您只能在启动作业时指定使用的资源(CPU)。此外，您只需为执行时间付费。</p><p id="db75" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">第一种允许使用“无代码”方法开发数据流，使用图形用户界面。使用第二种语言，您可以基于Apache Spark库，以自己喜欢的语言编写代码，并拥有充分的能力和灵活性。这两者结合起来提供了你所需要的一切。</p><p id="0d56" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这幅图展示了一个集成了所有这些服务的架构:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/f385fbb413e3ad893789307be5a91da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JFzWq5Fvf4cj63c5.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图3:数据湖架构(<em class="mh">图片作者</em>)。</p></figure><p id="c23a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Oracle Data Flow和OCI数据集成等无服务器服务与对象存储相结合，可以为您提供处理和准备数据集所需的全部计算能力和存储能力。即使它们比您在大数据之旅开始时计划的要大。</p><h1 id="3aed" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">好吧，Spark很酷，但是我们想用SQL。</h1><p id="8427" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">但是，当数据准备就绪并且结构良好时，您的BI专家、业务用户和数据科学家可能希望<strong class="kn ir">能够使用众所周知的SQL语言</strong>查询这些数据。例如，使用Oracle分析云(OAC)构建丰富而强大的数据可视化。</p><p id="5a05" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Oracle Autonomous Data Warehouse(ADWH)与对象存储完美集成，为您提供了两种选择:在ADWH存储中加载数据，或者使用"<strong class="kn ir">外部表</strong>"并使用ADWH SQL查询引擎查询数据，而数据集则保留在对象存储中的存储桶中。</p><p id="de97" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如果您将数据集放在对象存储上，您可以将对象存储的易用性和高效性与ADWH提供的Oracle SQL引擎的功能、健壮性和安全性结合起来。或许以后，您可以决定在ADWH存储中只加载那些您需要更好性能的数据。</p><p id="c58d" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">说到这里，我想在本文的剩余部分为您提供一些建议，使访问存储在对象存储器上的文件变得容易。我还会提供一些我为自己的工作和客户开发的实用程序的链接。</p><h1 id="23d0" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">首先是安全。</h1><p id="f560" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要从ADWH访问对象存储，您需要一组凭证:一个<strong class="kn ir">身份验证令牌</strong>。这个令牌必须存储在DB中，以使SQL代码能够访问对象存储桶。</p><p id="9f21" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">首先，要创建令牌，请转到OCI UI控制台，在您的配置文件中创建(右上方的图标和用户设置)和AuthToken:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mi"><img src="../Images/20ea08a69b2d6909adf8dc2c079bf3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iY2n5J_rFeDoJ-Bv.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图4:安全访问对象存储的授权令牌(作者的<em class="mh">图片)。</em></p></figure><p id="c043" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">然后，从UI复制身份验证令牌。请记住在创建后立即这样做，否则，您将无法重新阅读它。</p><p id="93c9" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">第二，将云凭证存储在DB中，在SQLDeveloper中执行这段代码；该步骤只需执行一次:</p><pre class="lq lr ls lt gt mj mk ml mm aw mn bi"><span id="2f42" class="mo jo iq mk b gy mp mq l mr ms">BEGIN DBMS_CLOUD.CREATE_CREDENTIAL( <br/>credential_name =&gt; 'ADWH2', <br/>username =&gt; 'oracleidentitycloudservice/myname', <br/>password =&gt; '&lt;AUTH Token&gt;' ); <br/>END;</span></pre><p id="4ab7" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">注意:如果您的用户是联邦用户，那么这个名称就是完全限定的名称。它有一个前缀，如:</p><p id="3155" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">oracleidentitycloudservice/</p><h1 id="747a" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">创建外部表的DDL。</h1><p id="dceb" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下一步是创建“外部表”。它是存储在DB数据字典中的一个“定义”，允许SQL访问存储在对象存储桶中的文件。</p><p id="13db" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在下文中，我将假设数据文件是一个CSV文件，并且它在第一行中包含一个带有字段名称的标题。</p><p id="4b7a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在我的测试中，我使用了来自<a class="ae lo" href="https://grouplens.org/datasets/movielens/25m/" rel="noopener ugc nofollow" target="_blank"> MovieLens数据集</a>的文件。因此，其中一个文件(movies.csv)包含这种类型的记录:</p><pre class="lq lr ls lt gt mj mk ml mm aw mn bi"><span id="0d5d" class="mo jo iq mk b gy mp mq l mr ms">movieId,title,genres 1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy 2,Jumanji (1995),Adventure|Children|Fantasy 3,Grumpier Old Men (1995),Comedy|Romance 4,Waiting to Exhale (1995),Comedy|Drama|Romance 5,Father of the Bride Part II (1995),Comedy 6,Heat (1995),Action|Crime|Thriller 7,Sabrina (1995),Comedy|Romance</span></pre><p id="1f5b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">使用提供的Python实用程序(参见上一节中的链接)，我已经能够生成下面的SQL DDL指令(再次在SQLDeveloper中执行):</p><pre class="lq lr ls lt gt mj mk ml mm aw mn bi"><span id="7742" class="mo jo iq mk b gy mp mq l mr ms">BEGIN DBMS_CLOUD.CREATE_EXTERNAL_TABLE( <br/>table_name =&gt;'MOVIES', <br/>credential_name =&gt;'ADWH2', <br/>file_uri_list =&gt;'https://objectstorage.eu-frankfurt-1.oraclecloud.com/n/emeaseitalyp/b/datalake_in/o/movies.csv', <br/>format =&gt; json_object('type' value 'csv', 'skipheaders' value '1'), column_list =&gt; 'MOVIEID NUMBER, TITLE VARCHAR2(4000), GENRES VARCHAR2(4000)' <br/>); <br/>END; <br/>/</span></pre><p id="0400" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">一些解释:</p><ul class=""><li id="e691" class="mt mu iq kn b ko lj ks lk kw mv la mw le mx li my mz na nb bi translated"><strong class="kn ir"> credential_name </strong>是身份验证令牌的名称(ADWH2，见上文):</li><li id="cfed" class="mt mu iq kn b ko nc ks nd kw ne la nf le ng li my mz na nb bi translated"><strong class="kn ir"> column_list </strong>包含一组所有列的名称/类型。数据类型是Oracle类型</li><li id="c677" class="mt mu iq kn b ko nc ks nd kw ne la nf le ng li my mz na nb bi translated"><strong class="kn ir">格式</strong>这里指定第一行包含列名(表头)</li><li id="92d1" class="mt mu iq kn b ko nc ks nd kw ne la nf le ng li my mz na nb bi translated"><strong class="kn ir">文件uri列表</strong>包含访问对象存储器中文件的URL。</li></ul><p id="9a93" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这是URL的格式:</p><blockquote class="nh ni nj"><p id="1177" class="kl km nk kn b ko lj kq kr ks lk ku kv nl ll ky kz nm lm lc ld nn ln lg lh li ij bi translated">https://<object storage="" region="" endpoint="">/n/<namespace>/b/<bucket name="">/o/<object name=""/></bucket></namespace></object></p></blockquote><h1 id="677b" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">查询数据。</h1><p id="255e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建外部表后，我可以使用SQL语言的全部功能来提取我需要的所有信息。</p><p id="dad1" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">例如，再次从MovieLens数据集，假设我想知道什么是最高评级的<strong class="kn ir">战争片</strong>。</p><p id="935e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">使用SqlDeveloper，大约20秒钟，我就能得到结果:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi no"><img src="../Images/c48b2a760b90074dd2f3e98b7f3ac9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LJ9Gf2KQ9fKPJxpD.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图SQL查询的结果(作者的<em class="mh">图片)。</em></p></figure><h1 id="07a5" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">链接到Python实用程序代码。</h1><p id="35bf" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">编写DDL代码来创建外部表有点无聊，而且容易出错。</p><p id="81fc" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">为了帮助完成这项任务，我准备了一个<strong class="kn ir"> Python实用程序</strong>，它可以读取CSV文件(只有前N行)，理解数据类型，并在标准输出中打印DDL，准备好进行复制和执行。</p><p id="49a5" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">你可以在我的GitHub仓库中找到这个工具的最新版本:<a class="ae lo" href="https://github.com/luigisaetta/adw_external_tables" rel="noopener ugc nofollow" target="_blank">https://github.com/luigisaetta/adw_external_tables</a>。</p><p id="1d50" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">希望您会发现它很有用，<strong class="kn ir">祝数据科学</strong>愉快。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="e4ea" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="nk">原载于2020年10月27日</em><a class="ae lo" href="https://luigisaetta.it/index.php/others/50-oracle-autonomous-dwh-and-object-storage-2" rel="noopener ugc nofollow" target="_blank"><em class="nk">https://luigisaetta . it</em></a><em class="nk">。</em></p></div></div>    
</body>
</html>