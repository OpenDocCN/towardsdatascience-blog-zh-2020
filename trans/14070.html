<html>
<head>
<title>Setting up Amazon SageMaker Environment On Your Local Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在本地机器上设置Amazon SageMaker环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-up-amazon-sagemaker-environment-on-your-local-machine-7329e0178adc?source=collection_archive---------10-----------------------#2020-09-28">https://towardsdatascience.com/setting-up-amazon-sagemaker-environment-on-your-local-machine-7329e0178adc?source=collection_archive---------10-----------------------#2020-09-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/41c31ce14ea95d3e02c490a0cf29eafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dp1GAdy3gyCXEFgP"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">埃里克·马塞利诺在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b67c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">亚马逊SageMaker不仅仅是托管的Jupyter笔记本电脑，它是一种完全托管的服务，使您能够构建、训练、优化和部署机器学习模型。一个常见的误解是，为了使用这些服务，您需要一个SageMaker Notebook实例或SageMaker (Studio)笔记本，特别是当您开始使用SageMaker时。事实上，您可以直接从您的本地机器或者甚至从您喜欢的IDE中启动所有这些服务。</p><p id="c72e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们继续之前，让我们考虑一下如何与Amazon SageMaker服务交互。您有两个API</p><p id="0254" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> SageMaker Python SDK </strong> —这是Python中的一个高级API，它抽象了构建、训练和部署机器学习模型的代码。具体来说，它提供了第一类或内置算法的估计器以及支持的框架，如TensorFlow、MXNET等。在大多数情况下，您将使用它来与您的交互式机器学习任务进行交互。</p><p id="0917" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> AWS SDK </strong> —这是一个低级API，用于与所有受支持的AWS服务进行交互，并不特定于SageMaker。AWS SDK可用于大多数流行的编程语言，如Java、Javascript、Python (boto)等。在大多数情况下，您将使用这个服务级API来为自动化创建资源，或者与SageMaker Python SDK不支持的其他AWS服务进行交互。</p><h1 id="b285" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">为什么是本地环境</h1><p id="f426" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">成本可能是第一个出现的问题，但它也是使用自己的IDE的灵活性，以及离线工作的能力，并在您准备好的时候启动AWS云上的工作。</p><h1 id="9516" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">本地环境如何工作</h1><p id="6b5e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您像平常一样编写代码来构建您的模型，但不是SageMake Notebook实例(或SageMaker Studio Notebook ),而是在运行Jupyter的本地机器上或从您的IDE中完成。当您准备好了，就可以开始在AWS上进行SageMaker实例的培训了。一旦训练完成，模型就存储在AWS中。然后，您可以从本地机器开始部署或运行批处理转换作业。</p><h1 id="4e92" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用conda的环境设置</h1><p id="4464" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">建议您将其设置为Python虚拟环境。在我们的例子中，我们使用<code class="fe mh mi mj mk b">conda</code>来管理我们的虚拟环境，但是您也可以使用<code class="fe mh mi mj mk b">virtualenv</code>。亚马逊SageMaker也使用<code class="fe mh mi mj mk b">conda</code>来管理环境和包。假设你已经有了<code class="fe mh mi mj mk b">conda</code>的设置，如果没有，这里头<a class="ae kf" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html" rel="noopener ugc nofollow" target="_blank">处</a></p><h2 id="a024" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">创建新的conda环境</strong></h2><pre class="mx my mz na gt nb mk nc nd aw ne bi"><span id="280a" class="ml lf it mk b gy nf ng l nh ni">conda create -n sagemaker python=3</span></pre><h2 id="3555" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">激活并验证环境</strong></h2><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/411ebe8c1f9d917dca043df525e329fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/0*D29HmFcj1I_XyZhd"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><h2 id="8247" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated">安装标准数据科学包。</h2><p id="4117" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您可以使用<code class="fe mh mi mj mk b">conda</code>或<code class="fe mh mi mj mk b">pip</code>来安装软件包。我们会坚持<code class="fe mh mi mj mk b">conda</code></p><pre class="mx my mz na gt nb mk nc nd aw ne bi"><span id="8d39" class="ml lf it mk b gy nf ng l nh ni">conda install -y pandas numpy matplotlib</span></pre><h2 id="874c" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">安装AWS软件包</strong></h2><p id="e00d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">安装AWS SDK for Python (boto)，awscli和SageMaker Python SDK。SageMaker Python SDK不作为<code class="fe mh mi mj mk b">conda</code>包提供，所以我们在这里将使用<code class="fe mh mi mj mk b">pip</code></p><pre class="mx my mz na gt nb mk nc nd aw ne bi"><span id="307f" class="ml lf it mk b gy nf ng l nh ni">pip install boto3 awscli sagemaker</span></pre><p id="8548" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您是第一次使用<code class="fe mh mi mj mk b">awscli</code>，您必须对其进行配置。关于如何配置<code class="fe mh mi mj mk b">awscli</code>请参见<a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" rel="noopener ugc nofollow" target="_blank">这里的</a></p><p id="58af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，将安装SageMaker Python SDK的版本2。请务必检查SDK版本2中的更改，特别是这里的重大更改。</p><h2 id="ffa3" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">安装Jupyter并创建一个内核</strong></h2><pre class="mx my mz na gt nb mk nc nd aw ne bi"><span id="ca1d" class="ml lf it mk b gy nf ng l nh ni">conda install -c conda-forge jupyterlab<br/>python -m ipykernel install --user --name sagemaker</span></pre><h2 id="4fdf" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">验证环境并检查版本</strong></h2><p id="629e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">通过发出一个<code class="fe mh mi mj mk b">jupyter lab</code>来启动Jupyter，并选择上面创建的sagemaker内核</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/ce6db94bacc56dc4d6e505d185177f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GDp487u7vk9rTSpT"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="d463" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来验证笔记本中的版本，以确保一切如预期。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/9c5825ac9b44cad0e14863a169b14125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YwgItfIp171MveFX"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="6d4b" class="le lf it bd lg lh ns lj lk ll nt ln lo lp nu lr ls lt nv lv lw lx nw lz ma mb bi translated">建造和训练</h1><p id="d21f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在，您可以开始在本地构建您的模型，并在准备就绪后开始AWS培训</p><h2 id="2c3a" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">进口包装</strong></h2><p id="1c60" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">导入必要的包并指定角色。这里的关键区别是直接指定角色的<code class="fe mh mi mj mk b">arn</code>而不是<code class="fe mh mi mj mk b">get_execution_role()</code>。因为您是使用您的AWS凭证从您的本地机器运行它，而不是使用一个附加了角色的笔记本实例，所以get_execution_role()将不起作用。</p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="db2d" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated">创建评估者</h2><p id="6003" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">像平常一样创建估计器并设置<em class="nz">超参数</em>。在下面的例子中，我们使用内置的图像分类算法训练一个图像分类器。您还可以指定SageMaker实例的类型以及希望用于训练的实例数量</p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="7181" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated"><strong class="ak">培训渠道</strong></h2><p id="137e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">指定培训渠道，同样，与您在笔记本实例上的操作相比，这里没有任何变化</p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="51dc" class="ml lf it bd lg mm mn dn lk mo mp dp lo kr mq mr ls kv ms mt lw kz mu mv ma mw bi translated">开始培训工作</h2><p id="0eaa" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在SageMaker上启动培训作业，调用fit方法，该方法启动AWS上SageMaker实例上的培训作业</p><pre class="mx my mz na gt nb mk nc nd aw ne bi"><span id="f398" class="ml lf it mk b gy nf ng l nh ni">classifier.fit(inputs=data_channels, logs=True)</span></pre><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/a95eacadc24f5c505ae18c3bdf4daea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UZKGdyXXboRyz8ac"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="76ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以使用<code class="fe mh mi mj mk b"><a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/reference/sagemaker/list-training-jobs.html" rel="noopener ugc nofollow" target="_blank">list-training-jobs</a></code>来检查培训工作的状态</p><p id="6f64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样。在这里，我们看到了如何在本地设置SageMaker环境，并使用Jupyter在本地机器上构建机器学习模型。除了使用Jupyter，您还可以从您的IDE中做同样的事情。</p><p id="072e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">快乐训练！</p></div></div>    
</body>
</html>