<html>
<head>
<title>Improve your SQL with these templates for formatting and documentation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用这些格式和文档模板改进您的SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improve-your-sql-with-these-templates-for-formatting-and-documentation-f090a3259c89?source=collection_archive---------9-----------------------#2020-10-25">https://towardsdatascience.com/improve-your-sql-with-these-templates-for-formatting-and-documentation-f090a3259c89?source=collection_archive---------9-----------------------#2020-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3fc6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用更好的SQL格式和文档，减少代码审查和知识转移的痛苦。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6cf40e1bf7659afc21fa6401d4559a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pv2AJGKWmqbFC9NjAWXuCg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">艾萨克·史密斯在<a class="ae ky" href="https://unsplash.com/s/photos/analysis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="b859" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="7b7e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您是否遇到过用于分析的复杂SQL查询？</p><p id="3339" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你是否很难理解代码本身和其下的业务逻辑？</p><p id="02a2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我做到了。而且有时候，是跟我过去的疑问！</p><p id="68fd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了节省阅读我的代码的每个人(包括我自己)的时间，我尝试将两个模板应用到我的查询中，并发现它们非常有帮助:</p><ul class=""><li id="2a99" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">提高代码本身的质量</li><li id="a938" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">减少代码审查时间</li><li id="6f3b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">并改善知识转移</li></ul><h1 id="8daf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">你能期待什么</h1><p id="d025" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我将与您分享我使用的这两个模板。</p><p id="956f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">模板#1: </strong>记录SQL查询中的上下文和假设</p><p id="6150" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">模板#2 </strong>:格式化SQL查询</p><p id="7b87" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了演示它们的用法，我将通过一个使用MySQL的例子来总结新冠肺炎前后的销售情况。</p><p id="47fc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">希望这些模板能派上用场！尤其是在新冠肺炎启动后，远程工作成为我们的新常态，这增加了过度沟通的重要性，以确保每个人都在同一页面上。</p><h1 id="e3be" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">模板# 1:SQL查询中的文档上下文和假设</h1><h2 id="337e" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">1.模板</h2><p id="8702" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在编写查询之前，请列出这些信息:</p><ol class=""><li id="8ec9" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm ns my mz na bi translated">此查询的重要业务上下文</li><li id="a5bf" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">对查询结果的期望</li><li id="6a10" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">对业务逻辑和数据的任何假设</li></ol><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="f916" class="ng la it nu b gy ny nz l oa ob">/* <br/>CONTEXT: <br/>- add a brief description of why we need this query</span><span id="acdd" class="ng la it nu b gy oc nz l oa ob">RESULT EXPECTATION<br/>- add a brief description of your expectations for the query result</span><span id="53a3" class="ng la it nu b gy oc nz l oa ob">ASSUMPTION:<br/>- add assumption about business logic<br/>- add assumption about data<br/>*/</span></pre><h2 id="6560" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">2.行动中的模板</h2><p id="a33c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">将此模板应用于我们的销售总结示例:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="3b82" class="ng la it nu b gy ny nz l oa ob">/*  <br/>CONTEXT:  <br/>- Our company wants to understand if COVID has any impact on sales in stores around Chicago.</span><span id="d507" class="ng la it nu b gy oc nz l oa ob">RESULT EXPECTATION: <br/>- This query returns total sales (in USD) for each of our stores in Chicago every month before and after COVID, starting from 2019-03-01.</span><span id="4561" class="ng la it nu b gy oc nz l oa ob">ASSUMPTION:<br/>- Dates before 2020-03-01 are considered "Before COVID"<br/>- Each transaction has a unique id, so we do not expect duplications in our transaction table<br/>- There are some spam transactions we have identified after COVID, so we will filter these out<br/>*/</span></pre><h2 id="7fbd" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">3.利益</h2><p id="ca0b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们进行查询之前，对业务环境、结果预期和假设进行简要描述有很多好处:</p><ol class=""><li id="02c5" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm ns my mz na bi translated">它让我们在编写查询时专注于查询的主要目标</li><li id="940b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">它帮助读者快速建立对我们的查询的价值和期望的高层次理解</li><li id="69c3" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">它帮助代码评审员根据期望为查询创建初始测试</li></ol><p id="b550" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">记住，这一步是一个迭代过程。在编写查询时，我们可能不得不反复修改文档。</p><h1 id="8af0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">模板#2:格式化SQL查询</h1><h2 id="080c" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">1.模板规则</h2><p id="2419" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">格式化SQL查询有许多规则。简单来说，这些是我遵循的主要规则:</p><ol class=""><li id="f603" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm ns my mz na bi translated">使用大写字母突出显示保留的关键字(例如SELECT，WHERE)</li><li id="7686" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">使用缩进清楚地显示查询或子查询的开始和结束位置</li><li id="7d51" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">对于长而复杂的查询，在任何主要的子查询或上下文连接之前包含一个注释</li><li id="a0f6" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm ns my mz na bi translated">请给出列的来源及其源表或描述性表别名</li></ol><h2 id="e84f" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">2.行动中的模板</h2><p id="41e8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="od">此查询仅用于演示</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/0bfbafe58c1daf7ca3aa62d1483b2dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nm38zzBZPCG1I_M5PyG7NA.png"/></div></div></figure><h2 id="f634" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">3.利益</h2><p id="ee3a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这种查询格式对可读性有很多好处。以下是一些例子:</p><ul class=""><li id="41a2" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">理解查询的整体结构(即选择了哪些列，有多少个连接，应用了哪些过滤器)</li><li id="810b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">节省时间来确定测试子查询的开始和结束，因为我们可以在同一条垂直线中看到子查询的开始和结束括号</li><li id="fa8c" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">避免迷失在复杂的查询中，在整个查询中都有注释</li></ul><h1 id="3a64" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">组合模板#1和模板#2</h1><p id="e0d0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们的例子中，结合这两个模板，我们将得到:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="87b4" class="ng la it nu b gy ny nz l oa ob">/* <br/>CONTEXT: <br/>- Our company wants to understand if COVID has any impact on sales in stores<br/>around Chicago.</span><span id="8450" class="ng la it nu b gy oc nz l oa ob">RESULT EXPECTATION<br/>- This query returns total sales (in USD) for each of our stores in Chicago<br/>every month before and after COVID, starting from 2019-03-01.</span><span id="040e" class="ng la it nu b gy oc nz l oa ob">ASSUMPTION:<br/>- Dates before 2020-03-01 are considered "Before COVID"<br/>- Each transaction has a unique id, so we do not expect duplications<br/>in our transaction table<br/>- There are some spam transactions we have identified after COVID,<br/>so we will filter these out<br/>*/</span><span id="004c" class="ng la it nu b gy oc nz l oa ob">SELECT <br/>  store_info.id,<br/>  store_info.name AS store_name,<br/>  DATE_FORMAT(transactions.date, "%Y-%m") AS transaction_month,<br/>  SUM(transactions.total_amount) AS total_amount<br/>FROM <br/>  transactions<br/>LEFT JOIN <br/>  -- get all stores in Chicago<br/>  (<br/>    SELECT <br/>      id,<br/>      name<br/>    FROM <br/>      stores<br/>    WHERE<br/>      city = 'Chicago'<br/>  ) AS store_info<br/>ON <br/>  transactions.branch_id = store_info.id<br/>WHERE<br/>  transactions.date &gt;= '2019-03-01'<br/>  -- filter spam transactions<br/>  AND transactions.id NOT IN <br/>    (<br/>      SELECT <br/>        id <br/>      FROM <br/>        spam_transactions<br/>    )<br/>GROUP BY <br/>  store_info.id,<br/>  store_info.name,<br/>  DATE_FORMAT(transactions.date, "%Y-%m")</span></pre><h1 id="c5ec" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">额外小费</h1><p id="32d2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这些模板并不是唯一的模板。找出最适合你和你的团队的方法是一个反复试验的过程。</p><p id="f60a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最终确定格式样式后，手动设置每个查询的样式可能会很累。许多SQL IDE都有一个选项可以自动完成这个过程。然而，如果它仍然不能满足您的需要，还有其他的工具。尝试使用这些关键字进行搜索:“SQL格式化程序”</p><p id="23bd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于Python用户，我一直在摆弄<em class="od"> sqlparse </em>。你可以在这里获得更多<a class="ae ky" href="https://sqlparse.readthedocs.io/en/latest/intro/" rel="noopener ugc nofollow" target="_blank">的信息。</a></p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="f715" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢您通读整篇文章！希望这些模板对你有帮助。我很想知道您的想法和任何其他技巧，以使SQL查询更具可读性。欢迎在下面留言，或者在<a class="ae ky" href="https://www.linkedin.com/in/hanhatdinh/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我。</p></div></div>    
</body>
</html>