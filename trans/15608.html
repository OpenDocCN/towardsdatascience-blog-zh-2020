<html>
<head>
<title>Twitter Text Analysis in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的Twitter文本分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/twitter-text-analysis-in-r-ed7b81ecdb9a?source=collection_archive---------28-----------------------#2020-10-27">https://towardsdatascience.com/twitter-text-analysis-in-r-ed7b81ecdb9a?source=collection_archive---------28-----------------------#2020-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="243f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="88d5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">帮助通信从业者通过Twitter等开放数据源获得可操作的见解</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/e383959009d08c7b76c22c2871e8f4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1GbitjYrETVeThV7"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lh" href="https://unsplash.com/@antenna?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">天线</a>拍摄</p></figure><p id="ea4a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">开放数据源是数据科学家或分析师的最佳礼物之一，因为它们允许他们免费获得有价值的见解，而不必担心数据许可证。Twitter是世界上最受欢迎的社交媒体应用之一，因为它是免费的，并且允许用户就他们想到的任何话题发表推文。本文将关注我们如何通过R编程使用Twitter来提取有价值的见解，并使用Tableau将这些发现传达给相关的利益相关者。</p><h1 id="870a" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">问题陈述</h1><blockquote class="mw"><p id="fcf4" class="mx my it bd mz na nb nc nd ne nf md dk translated">“我们如何帮助传播从业者从Twitter获得可行的见解，以便他们能够创造更有效的沟通，满足公众的需求和关注”</p></blockquote><p id="5c0f" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">本问题陈述选择的目标用户是<strong class="lk jd">军事通信从业者</strong>，他们渴望了解公众对新加坡军队(即国民兵役)的担忧。</p><h1 id="4a1d" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">Twitter数据源的特征</h1><p id="8e6f" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">对于每个数据源，我们可以用大数据<a class="ae lh" href="https://www.ibmbigdatahub.com/infographic/four-vs-big-data" rel="noopener ugc nofollow" target="_blank">的四个V</a>做一个简单的表示，主要是量、速度、多样性和准确性，以便对该数据源有一个总体的了解。</p><ol class=""><li id="68f8" class="nq nr it lk b ll lm lo lp lr ns lv nt lz nu md nv nw nx ny bi translated"><strong class="lk jd">体积</strong> —数据的规模</li><li id="61ba" class="nq nr it lk b ll nz lo oa lr ob lv oc lz od md nv nw nx ny bi translated"><strong class="lk jd">速度</strong> —流数据分析</li><li id="8674" class="nq nr it lk b ll nz lo oa lr ob lv oc lz od md nv nw nx ny bi translated"><strong class="lk jd">多样性</strong> —不同形式的数据</li><li id="ef3e" class="nq nr it lk b ll nz lo oa lr ob lv oc lz od md nv nw nx ny bi translated"><strong class="lk jd">准确性</strong> —数据的不确定性</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/734013e2372b33953263b4e9614aa6b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QH-cfbXKxYhdsk915knJcg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图片Twitter数据中的4个V</p></figure><h1 id="1a9e" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">连接到Twitter API</h1><p id="1f67" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">我们可以在R编程中使用<code class="fe of og oh oi b">twitteR</code>库包来访问Twitter API。请注意，我们需要注册一个<a class="ae lh" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank"> Twitter开发者账户</a>来访问API，因为每个用户都将获得一组唯一的消费者密钥、消费者密钥、访问令牌和访问密钥。一旦我们建立了与Twitter API的连接，我们将通过说明搜索词(即"<em class="oj">国服</em>")、最大推文数量(即<em class="oj"> n = 1000 </em>)、搜索半径为英里的新加坡经纬度(即<em class="oj">地理编码= '1.3521，103.8198，279米</em>')和语言(即【T11</p><pre class="ks kt ku kv gt ok oi ol om aw on bi"><span id="40dc" class="oo mf it oi b gy op oq l or os"># import necessary library for Twitter API, data manipulation and text cleaning<br/>library("twitteR")<br/>library("ROAuth")<br/>library("dplyr")<br/>library("tidytext")</span><span id="7070" class="oo mf it oi b gy ot oq l or os"># Set up Twitter Connection<br/>consumer_key &lt;- '' # removed due to confidentiality<br/>consumer_secret&lt;- '' # removed due to confidentiality<br/>access_token &lt;- '' # removed due to confidentiality<br/>access_secret &lt;- '' # removed due to confidentiality<br/>setup_twitter_oauth(consumer_key ,consumer_secret,access_token ,access_secret)</span><span id="0669" class="oo mf it oi b gy ot oq l or os"># extract english tweets using 'National Service' tweeted in Singapore, with retweets removed<br/>tweets &lt;- strip_retweets(searchTwitter('National Service',n=1000, geocode='1.3521,103.8198,279mi',lang='en'))</span><span id="7e82" class="oo mf it oi b gy ot oq l or os"># print length of tweets<br/>length(tweets)</span></pre><p id="64f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，对于Twitter公共API的免费版本，我们只能请求过去7天的推文。结果，我们的请求中只有17条推文。</p><h1 id="6302" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">数据清理</h1><p id="0d15" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">当我们通过Twitter API提取推文时，结果不会很清晰，因为推文可能使用多种语言，还包含像表情符号这样不可读的单词。看下面的截图，要采取的明显的数据清理步骤是删除Twitter用户名，删除表情符号(由<u>表示)，并删除推文的URL链接(以蓝色突出显示)。</u></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/265f3a05ce4c9ee198c50a0f25e8909c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3N_-gYPeraG6IBpl-P4dYw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片——通过Twitter API在R</p></figure><p id="7199" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如在上面的数据特征部分提到的，返回的tweets是JSON格式的，我们必须先将其转换成R格式的数据帧，然后才能使用像<code class="fe of og oh oi b">dplyr</code>这样的通用数据处理库。在我们的分析中，我们不希望任何标点符号、数字或长度小于2的单词。因此，在我们的文本清理代码中，我们将删除它们。</p><pre class="ks kt ku kv gt ok oi ol om aw on bi"><span id="fdf7" class="oo mf it oi b gy op oq l or os"># convert tweets to df<br/>df &lt;- twListToDF(tweets)</span><span id="c31e" class="oo mf it oi b gy ot oq l or os"># text cleaning<br/>df$text &lt;- as.character(df$text)<br/>df$text &lt;- gsub("\\$", "", df$text) <br/>df$text &lt;- gsub("@\\w+", "", df$text)<br/>df$text &lt;- gsub("[[:punct:]]","", df$text)<br/>df$text &lt;- gsub("http\\w+", "", df$text)<br/>df$text &lt;- gsub("[ |\t]{2,}", "", df$text)<br/>df$text &lt;- gsub("^ ", "", df$text)<br/>df$text &lt;- gsub(" $", "", df$text)<br/>df$text &lt;- gsub("RT","",df$text)<br/>df$text &lt;- gsub("href", "", df$text)<br/>df$text &lt;- gsub("([0-9])","", df$text)</span></pre><h1 id="69a6" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">字频率</h1><p id="176b" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">在每个文本分析问题中，将大块文本分解成单个单词(或标记)本质上是要采取的第一步，我们称之为标记化，可以使用<code class="fe of og oh oi b">tidytext</code>库来完成。对于我们的分析，一旦我们将文本分解成单独的令牌，我们将合计每个唯一单词的计数，以便我们可以知道用户在推特上发布的一些常见单词。</p><pre class="ks kt ku kv gt ok oi ol om aw on bi"><span id="cd1c" class="oo mf it oi b gy op oq l or os"># split the text into individual tokens, remove stopwords,'National Service', sort by descending count<br/>tokens &lt;- data_frame(text = df$text) %&gt;%<br/>    unnest_tokens(word, text) %&gt;%<br/>    anti_join(stop_words) %&gt;%<br/>    count(word, sort = TRUE)</span><span id="d1f6" class="oo mf it oi b gy ot oq l or os"># output to csv for further usage<br/>write.csv(tokens, './bukitmerah.csv',row.names = FALSE)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/96efa72c1af7306c2b97ad7aa1ad696c.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*sLmSMotZWPza-_lq7mWWgg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图像—标记及其频率的csv输出</p></figure><p id="4dee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如上所述，我们已经在一个CSV文件中输出了包含单个单词/单词及其频率的结果，稍后我们将把这些结果加载到Tableau中以实现可视化。</p><h1 id="1753" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">情感分析</h1><p id="4ffd" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">我们可以对推文进行的另一种可能的分析是情绪分析，即对数据中的情绪进行解释和分类。这种情绪分析可以在R中使用<code class="fe of og oh oi b">nrc</code>词典来容易地进行，该词典将每个单词/标记分类为10种情绪类别中的一种，主要是<strong class="lk jd">愤怒、期待、厌恶、恐惧、快乐、消极、积极、悲伤、惊讶、信任</strong>。然后会进行汇总，对积极情绪和所有消极情绪进行分类。每一个正面单词将被加上分数<strong class="lk jd"> +1 </strong>，每一个负面单词将被加上分数<strong class="lk jd"> -1 </strong>。一旦完成，每条推文的情感得分将被合并，如果得分高于0 的<strong class="lk jd">，该推文将被归类为<strong class="lk jd">正面</strong>。如果是低于0 </strong>的<strong class="lk jd">，则为<strong class="lk jd">负</strong>。如果分数<strong class="lk jd">正好为0 </strong>，则<strong class="lk jd">中立</strong>。</strong></p><pre class="ks kt ku kv gt ok oi ol om aw on bi"><span id="489c" class="oo mf it oi b gy op oq l or os"># get sentiment score for each tweets by using the sentiment lexicon "nrc"<br/>text_df &lt;- data_frame(id=df$id, text = df$text) %&gt;% <br/>    unnest_tokens(word, text) %&gt;%<br/>    anti_join(stop_words) %&gt;%<br/>    inner_join(get_sentiments("nrc")) %&gt;%<br/>    mutate(score = ifelse(sentiment=='positive',1,ifelse(sentiment=='joy',1,ifelse(sentiment=='anticipation',1,ifelse(sentiment=='trust',1,ifelse(sentiment=='surprise',1,-1)))))) %&gt;%<br/>    group_by(id) %&gt;%<br/>    summarise(total_score = sum(score)) %&gt;%<br/>    mutate(sentiment = ifelse(total_score&gt;0,'positive',ifelse(total_score&lt;0,'negative','neutral')))</span><span id="68f6" class="oo mf it oi b gy ot oq l or os"># get the dataframe which contains tweet message, id and it's sentiment<br/>sentiments &lt;- df %&gt;% inner_join(text_df, by='id') %&gt;% select('text','id','created','sentiment')<br/># output to csv for further usage<br/>write.csv(sentiments, './sentiments.csv',row.names = FALSE)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/5200d53ee0e98caace26903b02ccc919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWC0E3JAhN4BV3n6GBLpZQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图片—推文及其观点的csv输出</p></figure><p id="b89e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如上所述，我们已经在一个CSV文件中输出了包含整个tweet及其情感评分(即正面/负面/中性)的结果，我们稍后会将该结果加载到Tableau中以供可视化之用。</p><h1 id="8e45" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">调查的结果</h1><p id="0144" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">在前面的章节中，我们已经将两个文件输出为CSV格式，我们将把它们加载到Tableau中，通过数据可视化来发现可能的见解。</p><p id="2e97" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用包含单个单词/令牌的第一个文件以及所有用户在其推文中的推文频率，我们可以在Tableau中绘制一个单词云，单词越大表示频率越高。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/4dc1596bf187f199ad2677d4b3149001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHHBinHgPADItEKZYVUdVg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图片—词频的Tableau词云</p></figure><p id="1e5b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从单词cloud中，我们可以识别出一些常用词，如<em class="oj">、【线程】、【强制】、【志愿者】、【二月】、<em class="oj">、【美国军团】、</em>，这些词在军事背景下没有太多含义。</em></p><p id="81d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看看是否可以通过包含推文及其情感评分的第二个CSV文件发现更多有用的见解。由于正在发推文的时间也被捕获，我们可以绘制一个随时间变化的条形图，以查看一周内人们对国家服务的情绪(请记住，Twitter公共API只允许长达7天的数据请求)。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/18cb1eb1fc433e6e33276cd1f360dcca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*_D156O9Wtb_T0n0W0a2IGg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图片-情绪分析的Tableau条形图</p></figure><p id="b2c2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在17条相关推文中，10条是正面的，5条是负面的，2条是中性的。我们还观察到，情绪在一周内朝着消极的一面发展。</p><h1 id="3a55" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">缺点和限制</h1><p id="04f5" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">在使用Twitter公共API从普通公众收集关于国家服务的见解的分析中，可以发现三个主要缺点。</p><ol class=""><li id="1398" class="nq nr it lk b ll lm lo lp lr ns lv nt lz nu md nv nw nx ny bi translated"><strong class="lk jd"> Twitter API </strong></li></ol><p id="436f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">&gt;免费帐户仅允许从API中提取过去7天的推文</p><p id="3ba5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">超过7天的数据不能提供公众对国民兵役观点的全面分析</p><p id="b466" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">&gt;无法提供对用户人口统计数据的深入分析</p><p id="8ed0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> 2。情感分析的准确性</strong></p><p id="039e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">&gt;应该进行更深入的情感分析，因为当前的软件不考虑整个推文的情感，导致推文根据几个词被归类为错误的情感</p><p id="fc95" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">&gt;不恰当的词语或言论无法过滤</p><p id="2391" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> 3。无关的推文</strong></p><p id="57c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">&gt;在其他国家的“国家服务”上无关的推文可能会被捕获，因为Twitter对每个人开放，无论他们在哪里，都可以发布任何推文</p><h1 id="35fb" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">摘要</h1><p id="fefb" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">在本文中，我们讨论了如何使用Twitter这样的开放数据源，从公众那里收集特定利益相关者感兴趣的任何问题的宝贵见解，在我们的案例中，这些利益相关者是军队/国家服务的通信从业者。我们还讨论了使用R中内置的情感分析包来解释文本中包含的情感。在数据科学领域的大部分时间里，数据科学家经常构建他们的情感分析模型，因为每个问题都需要不同的模型来获得更合适和准确的情感。希望你们现在有一个想法，我们可以考虑如何使用Twitter API和内置的情感分析库来启动你的文本挖掘问题！</p></div></div>    
</body>
</html>