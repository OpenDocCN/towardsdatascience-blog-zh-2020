<html>
<head>
<title>Integrating Machine Learning Models with Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将机器学习模型与Tableau集成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/integrating-machine-learning-models-with-tableau-b484c0e099c5?source=collection_archive---------12-----------------------#2020-10-10">https://towardsdatascience.com/integrating-machine-learning-models-with-tableau-b484c0e099c5?source=collection_archive---------12-----------------------#2020-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2595" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用TabPy库将Python中训练好的机器学习模型直接部署到tableau中</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6bb80dc1372d0407e24d0eae1c62c2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nga7WeVsw2-Btxlw"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><blockquote class="kw kx ky"><p id="94cc" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"> Tableau </strong>是快速创建交互式数据可视化的非常有效的工具，也是数据科学社区中的顶级工具。所有使用过tableau的数据科学家都知道Tableau对于数据可视化来说是多么强大和简单。</p></blockquote><p id="63da" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">大多数数据科学家/分析师使用tableau来创建令人惊叹的可视化效果，并将可用数据用于演示。然而，对于任何数据科学家来说，以吸引人的方式向最终用户展示经过训练的机器模型与展示探索性数据分析一样重要。假设有一种方法可以直接在Tableau中可视化训练过的机器模型，使这个过程更加舒适。从Jupyter笔记本到Tableau部署训练有素的机器学习比你想象的要容易。这就是TabPy有用的地方。本文讨论了使用<strong class="lc ir"> Jupyter notebook </strong>和<strong class="lc ir"> TabPy </strong>部署机器学习模型的过程</p><h2 id="0d89" class="lz ma iq bd mb mc md dn me mf mg dp mh lw mi mj mk lx ml mm mn ly mo mp mq mr bi translated">数据</h2><p id="686a" class="pw-post-body-paragraph kz la iq lc b ld ms jr lf lg mt ju li lw mu ll lm lx mv lp lq ly mw lt lu lv ij bi translated">这个项目的数据集由Fernando Silva通过Mendeley数据仓库使用Creative Commons 4.0许可证透明地维护。该数据集由DataCo Global公司三年来使用的供应链的大约18万笔交易组成。数据集可以在这里<a class="ae kv" href="https://data.mendeley.com/datasets/8gx2fvg2k6/5" rel="noopener ugc nofollow" target="_blank">下载</a>，因为这是一家供应链公司。确保订单按时交付并防止欺诈至关重要。</p><p id="d682" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">我们在这里的目标是建立一个交互式仪表板，用最佳变量来预测欺诈和延迟交付发生的概率，以防止它们发生。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/7801231d7b0a24335cfe1c50ae0bcf5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nR7YLMy7yQ2_x7VOauQF5g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最终仪表板集成了ML模型。</p></figure><h2 id="cfc4" class="lz ma iq bd mb mc md dn me mf mg dp mh lw mi mj mk lx ml mm mn ly mo mp mq mr bi translated">数据清理和建模</h2><p id="09ec" class="pw-post-body-paragraph kz la iq lc b ld ms jr lf lg mt ju li lw mu ll lm lx mv lp lq ly mw lt lu lv ij bi translated">数据集由52个变量组成。所有不需要的变量都将被删除，大纲视图也将被移除。在剩余的40个变量中，使用前向选择来选择预测欺诈和延迟交付的最佳变量。预测延迟交货的最佳变量是订单国家和为订单安排的装运日期。对于预测欺诈，最佳变量是运送订单所用的实际天数以及订单国家安排的运送天数。为了便于构建仪表板，选择了常见的优化变量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d214" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">我用了一个简单的随机森林模型来预测。除了随机森林，可以使用任何机器学习模型，包括复杂的神经网络模型。</p><h2 id="f2f5" class="lz ma iq bd mb mc md dn me mf mg dp mh lw mi mj mk lx ml mm mn ly mo mp mq mr bi translated">将模型部署到场景中</h2><p id="ba05" class="pw-post-body-paragraph kz la iq lc b ld ms jr lf lg mt ju li lw mu ll lm lx mv lp lq ly mw lt lu lv ij bi translated">Python 3和Anaconda应该安装在设备上。如果你没有安装，你可以直接从他们的网站<a class="ae kv" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> Anaconda </a>和<a class="ae kv" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python </a>免费安装。要将python环境与Tableau连接起来，有一个非常优秀的库叫做Tabpy，我们需要先安装它。TabPy运行在anaconda环境中，非常容易安装。要安装TabPy，打开命令提示符并运行下面的命令<code class="fe na nb nc nd b">pip install tabpy</code></p><p id="55ba" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">一旦安装了tabpy。我们还需要一个名为tabpy _ client的额外库，将Jupyter笔记本环境连接到tableau，并直接部署机器学习模型。甚至这个库也可以使用下面的命令<code class="fe na nb nc nd b">pip install tabpy_client</code>安装</p><p id="e6a0" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">一旦成功安装了tabby，您就可以通过运行<code class="fe na nb nc nd b">tabpy</code>来启动tabby环境</p><p id="21ee" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">运行此程序后，您应该会看到一条消息，说明tabpy服务器成功启动，并且端口被设置为“9004 ”,类似于下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/819fcc6269d9472404ce31698f0dfcfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wRsrTBcG7tFMoJR0OXRJTw.png"/></div></div></figure><p id="1d52" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">如果您在安装tabby时遇到任何问题，可以在<a class="ae kv" href="https://github.com/tableau/TabPy" rel="noopener ugc nofollow" target="_blank">tabby GitHub</a>页面上找到更多信息。</p><h2 id="0a30" class="lz ma iq bd mb mc md dn me mf mg dp mh lw mi mj mk lx ml mm mn ly mo mp mq mr bi translated">将TabPy服务器连接到Tableau</h2><p id="b97b" class="pw-post-body-paragraph kz la iq lc b ld ms jr lf lg mt ju li lw mu ll lm lx mv lp lq ly mw lt lu lv ij bi translated">成功安装tabpy库后，您可以在Tableau桌面中的Tableau应用程序设置帮助&gt;设置和性能&gt;管理分析扩展连接中轻松地将TabPy服务器连接到Tableau。在服务器中选择本地主机，并输入端口号。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/30fd7633858180a0c883b02de30cb2bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*aa0te2kWlttpXKxW8KhYOw.png"/></div></figure><p id="41fb" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">单击“测试连接”查看您的服务器连接是否成功。如果连接成功。然后你就可以开始把你的机器学习模型直接部署到Tableau上了。</p><ol class=""><li id="40c0" class="ng nh iq lc b ld le lg lh lw ni lx nj ly nk lv nl nm nn no bi translated">要将模型部署到tableau中，首先要使用tabpy_client将笔记本连接到Tableau服务器。</li><li id="47b1" class="ng nh iq lc b ld np lg nq lw nr lx ns ly nt lv nl nm nn no bi translated">单个函数应该以适合Tableau的格式定义。新变量as _arg1，_arg2是相对于已训练的机器学习模型中的变量计数来声明的。</li><li id="46a9" class="ng nh iq lc b ld np lg nq lw nr lx ns ly nt lv nl nm nn no bi translated">假设我们在仪表板中使用的任何变量都在字符串中。它们应该被转换成数字格式。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="09e4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">如果您在部署模型时遇到任何错误，请检查是否所有的库都是最新的。在deploy语句中使用“override = True”将会用一个新模型覆盖已经训练好的模型。如果您希望使用新数据再次训练现有模型，这可能会很有帮助。</p><p id="810e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">一旦模型部署成功，就可以在Tableau中访问经过训练的模型。</p><ol class=""><li id="32ae" class="ng nh iq lc b ld le lg lh lw ni lx nj ly nk lv nl nm nn no bi translated">通过导入CSV文件将数据加载到Tableau中。</li><li id="26d5" class="ng nh iq lc b ld np lg nq lw nr lx ns ly nt lv nl nm nn no bi translated">接下来，应该使用模型部署代码中使用的相同名称来创建新参数。参数可以是字符串或数字格式，具体取决于您的模型。如果使用字符串，请确保编写了将字符串转换为数字格式的代码。</li><li id="b1b0" class="ng nh iq lc b ld np lg nq lw nr lx ns ly nt lv nl nm nn no bi translated">最后，使用以下脚本创建一个新的计算字段，并传递参数以连接到TabPy服务器。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/4cd455bbce6c81499b51c3c81662c5ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*TFoL6jlOtEf-YnRL0jhfyA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欺诈预测的Tableau脚本</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/6f26b6db3d93043c55a02e45e00678d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*yIg7M6VkruOJ74gj3kOEXw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">延迟交货预测的Tableau脚本</p></figure><p id="9b34" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">根据输出选择SCRIPT_REAL或SCRIPT_STR。一旦你输入脚本，如果你看到“计算是有效的”点击应用，它就完成了。机器学习模型已经准备就绪，现在您可以使用我们创建的参数和计算字段轻松创建交互式可视化。</p><p id="7d8b" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">数据和代码可以在我的<a class="ae kv" href="https://github.com/JaswanthBadvelu/tableau_integration" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到。</p><p id="c1b7" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">希望那有用！非常感谢你读到这里。你真棒！如果你对这篇文章有任何问题，或者想要联系和交谈，请随时在LinkedIn上给我发信息<a class="ae kv" href="https://www.linkedin.com/in/jaswanth-badvelu/" rel="noopener ugc nofollow" target="_blank">。我将非常乐意与您联系，并尽我所能提供帮助。</a></p><p id="7e87" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated"><strong class="lc ir">错误修复</strong></p><p id="dd6a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">有些人在Linkedin上联系我，说他们有时会得到“runtime error:Load failed:' Load failed:unsupported pickle protocol:5 '。我猜如果你尝试两次部署同一个ML模型，就会发生这种情况，解决这个错误的快速方法是从你的pc上删除已经保存的pickle模型，或者在Jupyter notebook和Tableau中用新的名称重新部署这个模型。</p></div></div>    
</body>
</html>