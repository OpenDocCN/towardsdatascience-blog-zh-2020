<html>
<head>
<title>Plotting Geospatial Data with Cartopy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cartopy打印地理空间数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/plotting-geospatial-data-with-cartopy-4b5ad0da0761?source=collection_archive---------16-----------------------#2020-09-28">https://towardsdatascience.com/plotting-geospatial-data-with-cartopy-4b5ad0da0761?source=collection_archive---------16-----------------------#2020-09-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="35c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用于制作高质量静态地图的Python库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/525d7e7a1f84b1a256207f575e135747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GI6er5M2oosifcY6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dead____artist?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">捕捉人心。</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="595e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着大数据时代的到来，也迎来了大地理空间数据时代。研究人员越来越多地获得地理信息，这些信息可以做任何事情，从跟踪濒危物种的迁移模式到绘制该国每一家甜甜圈店的地图。</p><p id="08df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了帮助可视化这些信息，python库<a class="ae ky" href="https://pypi.org/project/Cartopy/" rel="noopener ugc nofollow" target="_blank"> Cartopy </a>只用几行代码就可以创建专业的可发布地图。构建时考虑了Matplotlib，它的语法熟悉且易于理解。</p><h1 id="f4c4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">简单地图</h1><p id="36aa" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们将创建尽可能简单的世界地图。在编写任何繁重的代码之前，应该安装python中的Cartopy和Matplotlib库。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5260" class="mx lw it mt b gy my mz l na nb">import cartopy.crs as crs<br/>import cartopy.feature as cfeature<br/>import matplotlib.pyplot as plt</span></pre><p id="dd53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上，先决条件库被导入并准备好使用。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c675" class="mx lw it mt b gy my mz l na nb"># Initialize the figure<br/>figure = plt.figure(figsize=(8,6))</span><span id="9d79" class="mx lw it mt b gy nc mz l na nb"># use the Mercator projection<br/>ax = figure.add_subplot(1,1,1, projection=crs.Mercator(())</span><span id="a83b" class="mx lw it mt b gy nc mz l na nb"># Add feature to the map<br/>ax.stock_img()</span><span id="5bbd" class="mx lw it mt b gy nc mz l na nb">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/a3e293d5d97f1cdaee51e4adfe7ca155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*VVHu2WRBnLeS69DdSTt37Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">有纹理的世界地图。图由作者制作。</p></figure><p id="18d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来的几行代码介绍了创建地图的基本过程:</p><ol class=""><li id="3c2d" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">初始化地图，并使用figsize参数指定图形的大小</li><li id="5fae" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">添加指定所用投影的子图</li><li id="96ad" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">向支线剧情添加特征</li></ol><p id="4c72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只用几行代码，就创建了一个最小的地图。不幸的是，这张地图相当平淡，所以我们将添加一些额外的功能。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8fdb" class="mx lw it mt b gy my mz l na nb">figure = plt.figure(figsize=(8,6))</span><span id="129b" class="mx lw it mt b gy nc mz l na nb">ax = figure.add_subplot(1,1,1, projection=crs.Mercator())</span><span id="ae4d" class="mx lw it mt b gy nc mz l na nb"># adds a stock image as a background<br/>ax.stock_img()</span><span id="17a1" class="mx lw it mt b gy nc mz l na nb"># adds national borders<br/>ax.add_feature(cfeature.BORDERS)</span><span id="16c8" class="mx lw it mt b gy nc mz l na nb"># add coastlines<br/>ax.add_feature(cfeature.COASTLINE)</span><span id="ac66" class="mx lw it mt b gy nc mz l na nb">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/07b455b3c46b35d54c2d3327161fc219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*_tuENJgr8SG9k7X66F3elw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">有边界的世界地图。图由作者制作。</p></figure><p id="835f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过修改变量ax，更多的信息被添加到地图中。在这种情况下，国界和海岸线被画出来。其他功能，如主要河流和湖泊地图也可以用同样的方法包括在内。完整的功能列表可以在<a class="ae ky" href="https://scitools.org.uk/cartopy/docs/v0.15/matplotlib/feature_interface.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="378c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">不同的预测</h1><p id="4110" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">上面的地图使用了著名的墨卡托投影。虽然在大多数情况下完全足够，但墨卡托地图扭曲了土地大小，因为它将一个球体拉伸到一个正方形上。幸运的是，Cartopy支持其他投影。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3c16" class="mx lw it mt b gy my mz l na nb">figure = plt.figure(figsize=(8,6))</span><span id="25b6" class="mx lw it mt b gy nc mz l na nb"># set the projection to Mollweide<br/>ax = figure.add_subplot(1,1,1, projection=crs.Mollweide())<br/>ax.stock_img()</span><span id="5962" class="mx lw it mt b gy nc mz l na nb">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/1eaf922ee758aa7fec5a94db5c9d6049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*AZVlVmaLnleHHJ4Xpd9Aug.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">莫尔韦德投影。图由作者制作。</p></figure><p id="42d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过改变crs的投影参数。墨卡托()至crs。Molleweide()，创建一个不同的、更椭圆(更精确)的投影。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="30a6" class="mx lw it mt b gy my mz l na nb">figure = plt.figure(figsize=(8,6))</span><span id="a88c" class="mx lw it mt b gy nc mz l na nb"># Set the projection to Interrupted Goode Homolosine<br/>ax = figure.add_subplot(1,1,1, projection=crs.InterruptedGoodeHomolosine())<br/>ax.stock_img()</span><span id="4071" class="mx lw it mt b gy nc mz l na nb">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/b91b679522390e9a1e8422bf8b2a4d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Qm0OzdPvBBUym-GtQVLPEA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">间断古德同亏线投影。图由作者制作。</p></figure><p id="0a3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在projection参数中使用InterruptedGoodeHomolosine()，可以产生更精确的投影。</p><p id="9e4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些绝不是Cartopy可以绘制的唯一投影。完整列表可在<a class="ae ky" href="https://scitools.org.uk/cartopy/docs/latest/crs/projections.html#cartopy-projections" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="e5e1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">放大和缩小片段</h1><p id="684e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然世界地图在许多情况下都很有用，但通常数据需要在一个局部区域中表示，例如一个大陆或一个国家。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c638" class="mx lw it mt b gy my mz l na nb">figure = plt.figure(figsize=(8,6))</span><span id="8e0e" class="mx lw it mt b gy nc mz l na nb">ax = figure.add_subplot(1,1,1, projection=crs.Mercator())<br/>ax.add_feature(cfeature.COASTLINE)<br/>ax.add_feature(cfeature.STATES)</span><span id="c3e6" class="mx lw it mt b gy nc mz l na nb"># Zoom in on the US by setting longitude/latitude parameters<br/>ax.set_extent(<br/>    [<br/>        -135, # minimum latitude<br/>        -60, # min longitude<br/>        20, # max latitude<br/>        55 # max longitude<br/>    ],<br/>    crs=crs.PlateCarree()<br/>)</span><span id="df17" class="mx lw it mt b gy nc mz l na nb">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/9582049d93dd8e223e8fe06de80c204a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Jq_1BV2R3EjBVtBGZx5eog.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张简单的美国地图。图由作者制作。</p></figure><p id="018c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在初始化地图并添加了常用的要素之后，还使用set_extent()方法修改了ax变量，该方法指定了经度和纬度的范围，以便在地图上设置焦点。</p><p id="a931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意参数crs，它指定了要使用的坐标系。一般惯例是使用板块Carrée投影的坐标，即使它与地图的投影不一致，因为它产生更可预测的结果。</p><h1 id="4a8a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">散点图</h1><p id="8396" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">到目前为止，我们只讨论了生成通用地图，但现在我们将讨论在这些地图上绘制数据。唯一的要求是每个观测值都有一个有效的纬度和经度。为了演示，从<a class="ae ky" href="https://www.kaggle.com/aravindram11/list-of-us-airports" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>中提取了美国341个机场的源文件，并将其绘制在散点图上。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="112b" class="mx lw it mt b gy my mz l na nb">import pandas as pd</span><span id="6f34" class="mx lw it mt b gy nc mz l na nb"># Read the data<br/>df = pd.read_csv("airports.csv")</span></pre><p id="cc74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在进行任何映射之前，Pandas库被导入到结构化数据中，CSV文件被读入到数据帧中。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0f89" class="mx lw it mt b gy my mz l na nb">figure = plt.figure(figsize=(8,6))</span><span id="d0f8" class="mx lw it mt b gy nc mz l na nb">ax = figure.add_subplot(1,1,1, projection=crs.PlateCarree())<br/>ax.add_feature(cfeature.COASTLINE)<br/>ax.add_feature(cfeature.STATES)</span><span id="f69b" class="mx lw it mt b gy nc mz l na nb">ax.set_extent(<br/>    [-135, -60, 20, 55],<br/>    crs=crs.PlateCarree()<br/>)</span><span id="04d5" class="mx lw it mt b gy nc mz l na nb"># modify the plot by adding a scatterplot over the map<br/>plt.scatter(<br/>    x=df["LONGITUDE"],<br/>    y=df["LATITUDE"],<br/>    color="red",<br/>    s=4,<br/>    alpha=1,<br/>    transform=crs.PlateCarree()<br/>)</span><span id="7a39" class="mx lw it mt b gy nc mz l na nb">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/fd30411f1a9ca86ad60ffbbdef524fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*kpM7oTS2guNcSsusR-wGag.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国大陆的机场。图由作者制作。</p></figure><p id="97c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，创建地图后，Matplotlib会在图像上添加一个散点图。对于熟悉流行图形库的人来说，语法应该非常熟悉。对那些不是的人来说，争论的分类是:</p><ul class=""><li id="732b" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu ns nk nl nm bi translated">x:x轴上的数据。在这种情况下，经度</li><li id="46ed" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu ns nk nl nm bi translated">y:y轴上的数据。在这种情况下，纬度</li><li id="6b8e" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu ns nk nl nm bi translated">颜色:标记的颜色</li><li id="89a0" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu ns nk nl nm bi translated">学生:马克笔的大小</li><li id="db75" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu ns nk nl nm bi translated">alpha:标记的透明度，从0到1</li></ul><p id="849c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在散点图上传递额外的参数来进一步定制它。完整的名单可以在<a class="ae ky" href="https://matplotlib.org/3.1.0/api/_as_gen/matplotlib.pyplot.scatter.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="1455" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要注意transform参数，按照惯例，它使用Plate Carrée投影的原因与set_extent()类似。</p><h1 id="eb68" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="f5dc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Cartopy是一个多样化的地图库。考虑到各种投影和坐标系统，它支持从生态跟踪到商业智能的广泛的可能用例。</p><p id="847d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，它与Matplotlib的集成是一个令人难以置信的数据分析工具。虽然只演示了一个简单的散点图，但它对Matplotlib的广泛而灵活的使用意味着可以将不同数量的绘图和图形投影到一个地图上。</p></div></div>    
</body>
</html>