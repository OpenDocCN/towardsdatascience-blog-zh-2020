<html>
<head>
<title>JSON and APIs with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的JSON和API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/json-and-apis-with-python-fba329ef6ef0?source=collection_archive---------0-----------------------#2020-09-19">https://towardsdatascience.com/json-and-apis-with-python-fba329ef6ef0?source=collection_archive---------0-----------------------#2020-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ab68" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python的JSON和API介绍</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8784a952b0b1a8c8a3760f7f96a91920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3AygZMe37whfwu91"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">肖恩·林在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="8715" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h2><p id="66ad" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在另一个教程中，我们讨论了如何用python 进行<a class="ae ky" href="https://medium.com/towards-artificial-intelligence/web-scraping-with-python-6d01f5e9378f" rel="noopener">网页抓取。网络抓取的目标是从网站或网页获取数据。嗯，有时候一个网站可以让用户通过API(应用编程接口)更容易地直接访问他们的数据。这基本上意味着该公司制作了一组专用的URL，以纯形式提供这些数据(意味着没有任何表示格式)。这种纯数据通常是JSON (JavaScript对象表示法)格式，我们可以使用python解析并提取我们需要的内容。</a></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="0425" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">对于本教程，我们将使用在covid19api.com发现的免费API，提供冠状病毒的数据。我们将找到每个国家确诊病例的总数，然后我们将创建一个包含这些信息的熊猫数据框架。所以让我们开始吧！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><div class="kj kk kl km gt na"><a href="https://pub.towardsai.net/web-scraping-with-python-6d01f5e9378f" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">使用Python进行Web抓取</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">如何在python中使用漂亮的soup和请求库进行网页抓取</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">pub.towardsai.net</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ks na"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="14d0" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">检查API</h2><p id="1ed0" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如果你进入<a class="ae ky" href="https://documenter.getpostman.com/view/10808728/SzS8rjbc?version=latest" rel="noopener ugc nofollow" target="_blank"> API </a>的文档页面，你会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/3f8cbf8b71578eb10c0f764e2c357451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TpnFB8Q7tf2z2Gf6A3Xvtg.png"/></div></div></figure><p id="d202" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated"><em class="nq">这向我们展示了API中的不同URL、它们提供的信息以及右边这些URL的请求/响应示例。</em></p><p id="f014" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">我们可以看到，我们正在寻找的信息在摘要页面。我们可以单击右侧的“查看更多”,这样我们就可以看到来自该URL的响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/c689d528b65b86e47d121fca630541b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZcbTYZR7OL3EFQ33P80hVg.png"/></div></div></figure><p id="a29b" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">这是一个JSON对象！如您所见，它非常类似于python字典，由键值对组成。事实上，为了让我们解析它并从中提取我们想要的东西，我们最终会将它转换成python dictionary对象。经过检查，我们可以看到它看起来像一个嵌套的字典。外部字典具有关键字“Global”(具有字典的值)和“Countries”(具有由字典组成的列表的值，每个字典对应一个特定的国家)。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><div class="kj kk kl km gt na"><a rel="noopener follow" target="_blank" href="/two-ways-to-create-tables-in-python-2e184c9f9876"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">在Python中创建表的两种方法</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">Python中制表和熊猫数据帧函数的性能比较</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">towardsdatascience.com</p></div></div><div class="nj l"><div class="ns l nl nm nn nj no ks na"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="7aba" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">从API发出HTTP请求</h2><p id="c703" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">因此，让我们打开一个jupyter笔记本，从那个<a class="ae ky" href="https://api.covid19api.com/summary" rel="noopener ugc nofollow" target="_blank"> URL </a>请求信息。我们将使用请求库从那个<a class="ae ky" href="https://api.covid19api.com/summary" rel="noopener ugc nofollow" target="_blank"> U </a> RL发出一个HTTP请求，并将响应对象的文本保存在变量response下:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="7a05" class="kz la it nu b gy ny nz l oa ob">response = requests.get(‘https://api.covid19api.com/summary’).text</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/3563df77d9422087b0fd6920733084fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bGHwnJ0dPD1UV6k3acntXw.png"/></div></div></figure><p id="5af3" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated"><em class="nq">这显示了API对我们的HTTP请求的响应。如您所见，这是一个JSON格式的长python字符串。</em></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><div class="kj kk kl km gt na"><a rel="noopener follow" target="_blank" href="/using-string-methods-in-pandas-5e4509ff1f5f"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">在Pandas中使用字符串方法</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">如何将字符串方法应用于pandas数据框架中的列</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">towardsdatascience.com</p></div></div><div class="nj l"><div class="od l nl nm nn nj no ks na"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="d1c5" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建Python字典</h2><p id="b773" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">由于响应是JSON格式的，我们可以将这个字符串加载到python中，并将其转换成python字典。我们首先需要导入json库，然后我们可以使用json库中的loads方法，并向它传递我们的字符串:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="cb83" class="kz la it nu b gy ny nz l oa ob">response_info = json.loads(response)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6902a893eeaae225d7c81b6bdc8be800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uhN1MDFeQkkMt7bhR7fpCQ.png"/></div></div></figure><p id="1c8c" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">注意我们的response_info变量的类型现在是一个python字典！</p><p id="0818" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">既然我们的响应是python字典的形式，我们可以使用我们所知道的python字典来解析它并提取我们需要的信息！</p><p id="a429" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated"><strong class="lx iu">还要注意:</strong>requests库有一个内置的<a class="ae ky" href="https://requests.readthedocs.io/en/master/user/quickstart/#json-response-content" rel="noopener ugc nofollow" target="_blank"> json解码器</a>，我们可以用它来代替JSON模块，后者会将我们的JSON对象转换成python字典。但是，我在本教程中使用了上述方法来介绍json模块。如果我们在请求模块中使用JSON解码器，代码看起来会是这样的:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="1abe" class="kz la it nu b gy ny nz l oa ob">requests.get(‘https://api.covid19api.com/summary’).json()</span></pre></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="880e" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">解析字典</h2><p id="3a11" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如前所述，我们希望创建一个包含两列的熊猫数据框架:国家和该国确诊病例总数。我们可以通过循环外部字典的“Countries”键的值来实现这一点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/04875cd1f69bbc4993006c6ed28f76a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxI_oA8o-83vkXkGJ5J_qg.png"/></div></div></figure><p id="35be" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">如您所见，我们的“Countries”键的值只是一个字典列表，每个字典都包含对应于特定国家的键-值对。因此，我们需要遍历这个字典列表，从每个字典中提取“Country”和“TotalConfirmed”关键字的值，然后将它们追加到一个新列表中，如下所示:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="9093" class="kz la it nu b gy ny nz l oa ob">country_list = []</span><span id="782f" class="kz la it nu b gy og nz l oa ob">for country_info in response_info[‘Countries’]:<br/> country_list.append([country_info[‘Country’], country_info[‘TotalConfirmed’]])</span></pre><p id="fb19" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">这将遍历字典列表，从每个字典中提取“Country”和“TotalConfirmed”键的值到一个列表中，然后将这个结果列表添加到我们的country_list中。我们将以一个列表列表结束，外部列表中的每个列表或元素都包含国家名称和该特定国家的确诊病例总数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9230d388427d522549bd50ccbc06e7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4i9aBYfA01wcuxLCL0733Q.png"/></div></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><div class="kj kk kl km gt na"><a rel="noopener follow" target="_blank" href="/how-to-use-loc-in-pandas-49ed348a4117"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">如何在熊猫身上使用loc</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">了解如何使用pandas Python库中的loc方法</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">towardsdatascience.com</p></div></div><div class="nj l"><div class="oi l nl nm nn nj no ks na"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="2e69" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建熊猫数据框架</h2><p id="d16a" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们现在将使用这个country_list和pandas数据帧构造函数创建一个pandas数据帧:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="a0c5" class="kz la it nu b gy ny nz l oa ob">country_df = pd.DataFrame(data=country_list, columns=[‘Country’, ‘Total_Confirmed’])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/53ee804cb3a6bc0eb4eba475b4b98258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnmIlMoT7EQp_uUkTWA15g.png"/></div></div></figure><p id="bd47" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">成功！我们现在有一个包含两列的数据框架:Country和Total_Confirmed！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="e05d" class="pw-post-body-paragraph lv lw it lx b ly mv ju ma mb mw jx md li mx mf mg lm my mi mj lq mz ml mm mn im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，考虑注册成为一名媒体会员。每月5美元，你可以无限制地阅读媒体上的故事。如果你用我的 <a class="ae ky" href="https://lmatalka90.medium.com/membership" rel="noopener"> <em class="nq">链接</em> </a> <em class="nq">注册，我会赚一小笔佣金。</em></p><div class="ok ol gp gr om na"><a href="https://lmatalka90.medium.com/membership" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">通过我的推荐链接加入媒体——卢艾·马塔尔卡</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">阅读卢艾·马塔尔卡的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接支持…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">lmatalka90.medium.com</p></div></div><div class="nj l"><div class="on l nl nm nn nj no ks na"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="cee7" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h2><p id="42b1" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在本教程中，我们简要介绍了什么是API和JSON。然后，我们向一个<a class="ae ky" href="http://covid19api.com" rel="noopener ugc nofollow" target="_blank">冠状病毒COVID19 API </a>发出HTTP请求，以获取每个国家确诊的冠状病毒病例总数的信息。然后，我们将这个对我们请求的JSON响应转换成一个python字典。然后我们解析这个字典，提取我们要寻找的信息，然后创建一个包含这些信息的熊猫数据帧。</p></div></div>    
</body>
</html>