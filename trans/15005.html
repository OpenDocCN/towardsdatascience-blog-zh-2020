<html>
<head>
<title>A Quick Introduction to Market Basket Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">购物篮分析快速入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-quick-introduction-to-market-basket-analysis-d3292fc89517?source=collection_archive---------33-----------------------#2020-10-15">https://towardsdatascience.com/a-quick-introduction-to-market-basket-analysis-d3292fc89517?source=collection_archive---------33-----------------------#2020-10-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e40a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带有真实世界演示的初级读本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f95e189b3eaab85d38518a107c92a72c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Az1zHbWbUKbLAmdk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@pineapple?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">菠萝供应公司</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4e20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">零售商可以获得前所未有的购物者交易量。随着购物习惯变得越来越电子化，每次购物的记录都整齐地存储在数据库中，随时可供读取和分析。有了这样一个数据仓库，他们可以发现消费者的行为模式。</p><h1 id="c245" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是购物篮分析？</h1><p id="13a1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">购物篮分析是一组关联性计算，旨在确定哪些商品一起销售。例如，杂货店可以使用购物篮分析来确定消费者通常同时购买热狗和热狗面包。</p><p id="6069" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你曾经去过一个在线零售商的网站，你可能会在一个产品的页面上看到这样的推荐:“购买了这个产品的顾客也购买了”或者“顾客一起购买这些”。更有可能的是，这家在线零售商进行了某种市场购物篮分析，将这些产品联系在一起。</p><p id="b966" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">精明的零售商可以利用这一知识来为定价、促销和商店布局决策提供信息。前面提到的杂货店可能会出售热狗，但会增加热狗面包的利润。顾客会买更多的热狗，感觉好像找到了便宜货，而商店会卖出更多的产品，增加他们的收入。</p><h1 id="8c50" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">购物篮分析背后的数学</h1><p id="2512" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">对于所购买商品的每一个组合，都会计算三个关键的统计数据:支持度、信心和提升度。</p><p id="771e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">支持度</strong>是一个项目相对于其他所有购买项目的普遍受欢迎程度。在杂货店，牛奶会有很高的支持度，因为许多购物者每次旅行都会买。支持以0到1之间的数字给出。数学上:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/8ecaf8d17807cafc1241542898c2fa38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ps8Sj5_qi-7MxwpI9gM8nw.png"/></div></div></figure><p id="563d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">置信度</strong>是购买了产品A的顾客也购买了产品b的条件概率。棉花糖和全麦饼干之间的置信度可能很高，因为它们通常是一起购买的。置信度是一个介于0和1之间的数字。数学上:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/de67ac7ead6bb49109d13078294a0455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6Al3aOv_Ko7rF3P6uQ7tg.png"/></div></div></figure><p id="3760" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Lift </strong>是购买产品A时，产品B的销量增加。汉堡肉饼和小圆面包之间可能有很大的差距，因为随着肉饼的销量增加，它们会带动小圆面包的销量。数学上:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/d27dd266f8f5ac3716f9f770a0080a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*FfbVz69Bpqf-RSeQ6s7aBA.png"/></div></figure><p id="48cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与其他两种方法相比，Lift有点不同寻常。升力不是一个介于0和1之间的值，而是由它与1:</p><ul class=""><li id="5b87" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">Lift = 1表示产品之间没有关系</li><li id="18a1" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">lift &gt; 1表明产品之间存在正相关关系</li><li id="6573" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">lift &lt; 1表示产品之间存在负相关关系</li></ul><h1 id="36c9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Apriori算法</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/caa188d42f5be1635659ba6e9bb41a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FKHTqDYD6Ax6xywN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克莱顿·罗宾斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，执行购物篮分析最常用的方法是<a class="ae ky" href="https://en.wikipedia.org/wiki/Apriori_algorithm" rel="noopener ugc nofollow" target="_blank"> Apriori算法</a>。该算法由Agrawal和Srikant于1994年首次提出，由于其对零售商有意义地跟踪交易关联的影响，已经变得具有历史重要性。</p><p id="91b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然Apriori算法仍然有用并被广泛使用，但它在较大数据集上的计算时间也很长。幸运的是，大多数实现都提供了信心和支持的最小参数，并对每个事务的项目数进行了限制，以减少处理时间。</p><p id="6bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了演示，我将使用名为<a class="ae ky" href="https://pypi.org/project/efficient-apriori/" rel="noopener ugc nofollow" target="_blank"> <em class="nk">高效的Python实现——apriori</em></a>。注意，这个库是为Python 3.6和3.7设计的。老版本的Python可能会使用<em class="nk"/><a class="ae ky" href="https://pypi.org/project/apyori/" rel="noopener ugc nofollow" target="_blank"><em class="nk">apy ori</em></a>，支持2.7和3.3–3.5。</p><h1 id="89a4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据处理</h1><p id="7fe0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了展示Apriori算法的应用，我将使用在<a class="ae ky" href="https://www.kaggle.com/sulmansarwar/transactions-from-a-bakery" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上提供的一个面包店的交易数据集。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="b83c" class="nq lw it nm b gy nr ns l nt nu">import pandas as pd<br/>import numpy as np</span><span id="29d5" class="nq lw it nm b gy nv ns l nt nu"># Read the data<br/>df = pd.read_csv("BreadBasket_DMS.csv")</span><span id="fca2" class="nq lw it nm b gy nv ns l nt nu"># eliminate lines with "NONE" in items<br/>df = df[df["Item"] != "NONE"]</span></pre><p id="c006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在通常导入Pandas和Numpy来帮助处理数据之后，先前保存的CSV文件被读取到数据帧中。</p><p id="1e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几行数据在Item列中包含“NONE ”,这不是特别有用，所以这些数据被过滤掉了。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="641d" class="nq lw it nm b gy nr ns l nt nu"># Create and empty list for data processing<br/>transaction_items = []</span><span id="9404" class="nq lw it nm b gy nv ns l nt nu"># Get an array of transaction numbers<br/>transactions = df["Transaction"].unique()</span><span id="44eb" class="nq lw it nm b gy nv ns l nt nu">for transaction in transactions:<br/>    # Get an array of items per transaction number<br/>    items = df[df["Transaction"] == transaction]["Item"].unique()</span><span id="064f" class="nq lw it nm b gy nv ns l nt nu">    # Add the item to the list as a tuple<br/>    transaction_items.append(tuple(items))</span></pre><p id="5508" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与其他支持Pandas数据框的库不同，efficient-apriori需要事务行作为一个列表中的一系列元组。</p><p id="9b6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了创建这种数据结构，需要收集一系列唯一的事务ID号。对于每个事务ID，与该ID相关联的Numpy个项目数组被分组。最后，它们被转换成元组并放在一个列表中。</p><h1 id="fdc0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">执行Apriori算法</h1><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="63be" class="nq lw it nm b gy nr ns l nt nu"># import apriori algorithm<br/>from efficient_apriori import apriori</span><span id="9610" class="nq lw it nm b gy nv ns l nt nu"># Calculate support, confidence, &amp; lift<br/>itemsets, rules = apriori(transaction_items, min_support = 0.05, min_confidence = 0.1)</span></pre><p id="1549" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入库后，Apriori算法可以放在一行中。请注意min_support和min_confidence参数，它们指定了要计算的最小支持值和置信度值。这些的实际值在不同类型的数据之间会有所不同。将它们设置得太高不会产生任何结果。将它们设置得太低会产生太多的结果，并且需要很长时间来运行。</p><p id="b993" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个需要反复试验才能确定的金发女孩问题。对于特别大的数据集，可能需要一些初步的支持计算来确定一个好的基线。</p><p id="6f54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个特定的数据集，大多数交易包含一个单一的项目购买。虽然这本身是一个有趣的结果，但这意味着支持和信心的最小值需要设置得相对较低。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9ff3" class="nq lw it nm b gy nr ns l nt nu"># print the rules and corresponding values<br/>for rule in sorted(rules, key = lambda rule: rule.lift):<br/>    print(rule)</span></pre><p id="eaca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，结果被放入规则变量中，该变量可能会被打印出来。结果应该如下所示:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="4291" class="nq lw it nm b gy nr ns l nt nu">{Coffee} -&gt; {Cake} (conf: 0.114, supp: 0.055, lift: 1.102, conv: 1.012)<br/>{Cake} -&gt; {Coffee} (conf: 0.527, supp: 0.055, lift: 1.102, conv: 1.103)</span></pre><p id="913b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地理解输出，请看指定咖啡和蛋糕规则的两行。这两条线都给出了信心(conf)、支持(supp)和升力，但是两条线之间的顺序被交换了。</p><p id="8a3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一行中，概率被测量为以咖啡为条件的蛋糕，而在第二行中，概率被测量为以蛋糕为条件的咖啡。换句话说，在买了咖啡的顾客中，没有多少人还买了蛋糕。然而，在购买蛋糕的顾客中，大多数也购买了咖啡。这就是置信度值不同的原因。</p><p id="3020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个微妙但重要的区别，需要理解。</p><p id="91fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，提升值大于1，表明蛋糕的销售促进了咖啡的销售，反之亦然。</p><p id="3c8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解这一点后，面包店可以通过以下方式利用这一分析:</p><ul class=""><li id="70ae" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">将咖啡和蛋糕更紧密地放在菜单板上</li><li id="5de0" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">提供一餐蛋糕和一杯咖啡</li><li id="20cc" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">开展蛋糕优惠券活动，推动咖啡销售</li></ul><h1 id="a105" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="0e8a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">市场篮子分析是一套计算方法，旨在帮助企业了解其销售中的潜在模式。某些互补商品经常一起购买，Apriori算法可以隐藏它们。</p><p id="3d93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解产品销售如何应用于从促销、交叉销售到推荐的方方面面。虽然我给出的例子主要是零售驱动的，但任何行业都可以从更好地了解他们的产品如何移动中受益。</p></div></div>    
</body>
</html>