<html>
<head>
<title>GeoPandas: A Practical Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GeoPandas:实用指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geopandas-a-practical-guide-c1e15d4d58d5?source=collection_archive---------32-----------------------#2020-11-02">https://towardsdatascience.com/geopandas-a-practical-guide-c1e15d4d58d5?source=collection_archive---------32-----------------------#2020-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="83f1" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/getting-started" rel="noopener" target="_blank">入门</a></h2><div class=""/><div class=""><h2 id="2497" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">测绘1965年至2016年的地震</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/69dfa5a63a1442f09370f29b92693600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0SKTqP93vDAYt2EkwVzWw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@photoart2018?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Andrew Buchanan </a>在<a class="ae lh" href="https://unsplash.com/s/photos/earthquake?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d699" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GeoPandas是一个Python库，旨在处理地理空间数据。这使得基于地理位置创建可视化变得相当容易。</p><p id="654e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本帖中，我们将可视化1965年至2016年间发生的重大地震。数据集<a class="ae lh" href="https://www.kaggle.com/usgs/earthquake-database" rel="noopener ugc nofollow" target="_blank">可在Kaggle上获得。</a></p><p id="3578" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GeoPandas有两种主要的数据结构，即地理数据框架和地理系列。它们可以被认为是熊猫系列和数据框的子类。</p><p id="99be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们从安装和导入GeoPandas以及我们将使用的其他库开始。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="7a2e" class="mj mk it mf b gy ml mm l mn mo">pip install geopandas<br/>import geopandas</span><span id="7717" class="mj mk it mf b gy mp mm l mn mo">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline</span></pre><p id="969d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以通过修改熊猫数据框来创建地理数据框。因此，我们首先将数据集读入熊猫数据帧。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="6bd2" class="mj mk it mf b gy ml mm l mn mo">eq = pd.read_csv("/content/earthquakes.csv")</span><span id="fef1" class="mj mk it mf b gy mp mm l mn mo">eq.shape<br/>(23412, 21)</span></pre><p id="034f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该数据集包含超过23412个事件，其中大部分是地震。我们将过滤数据帧，使其仅包含地震数据。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="7a6f" class="mj mk it mf b gy ml mm l mn mo">eq = eq[eq['Type'] == 'Earthquake']</span></pre><p id="bf3a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的分析中还有一些冗余的列，因此我也将过滤掉这些列。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="4a09" class="mj mk it mf b gy ml mm l mn mo">eq = eq[['Date', 'Time', 'Latitude', 'Longitude', 'Depth', 'Magnitude']]</span><span id="4835" class="mj mk it mf b gy mp mm l mn mo">eq.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/7d509f3b9e5018f3dacfe598dbdb4b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*PUPx-vO0DmWSoAZy5OjDQA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="83a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们有一个数据框架，包含了两万多次地震的数据、位置、深度和震级。为了使用GeoPandas，我们需要将此Pandas数据框架转换为地理数据框架。</p><p id="fa9b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将按如下方式使用地理数据框架函数:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="2ec3" class="mj mk it mf b gy ml mm l mn mo">gdf = geopandas.GeoDataFrame(eq, geometry=geopandas.points_from_xy(eq.Longitude, eq.Latitude))</span><span id="63c1" class="mj mk it mf b gy mp mm l mn mo">gdf.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3521782c28ce876755ca86118ed85dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*4938nkN2QjkygUVRpugZXA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="e8a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">地理数据框架和pandas数据框架之间的区别是一个称为“几何”的地理系列。当空间方法应用于地理数据框架时，它将作用于几何列。</p><p id="fbe6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以将“geometry”列看作是纬度和经度值的重新格式化版本。</p><p id="da38" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在将地震数据存储在地理数据框架中。下一步是绘制世界地图，使用“世界”地理数据框架可以轻松完成。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="1190" class="mj mk it mf b gy ml mm l mn mo">world = geopandas\<br/>.read_file(geopandas.datasets.get_path('naturalearth_lowres'))</span><span id="ab5f" class="mj mk it mf b gy mp mm l mn mo">world.columns<br/>Index(['pop_est', 'continent', 'name', 'iso_a3', 'gdp_md_est', 'geometry'], dtype='object')</span></pre><p id="08c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它包含关于国家及其位置的基本信息。我们现在画一张空的世界地图。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b62c" class="mj mk it mf b gy ml mm l mn mo">world.plot(color='white', edgecolor='black', figsize=(12,8))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ms"><img src="../Images/3ce0b61e34cf894657159f816ef783ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpB_85v_1ygN0TIDrKXR8g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="6a7a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了绘制地震图，我们将创建一个世界地图的轴对象，然后根据“几何”列绘制地震。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="e1ea" class="mj mk it mf b gy ml mm l mn mo">ax = world.plot(color='white', edgecolor='black', figsize=(16,12))<br/>gdf.plot(ax=ax, color='red', markersize=2)<br/>plt.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mt"><img src="../Images/550fa9f5410ef292db5d4de153f1e62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TmlmdORISkeqN2830rI-_Q.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="296d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这张地图包含了1965年至2016年间发生的所有重大地震。如果你在谷歌上快速搜索地震断层线，你会发现它们与上面的地图重叠。</p><p id="d3ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">markersize参数调整定位地震的标记的大小。您还可以传递一个列名，标记的大小将根据该列中的值进行调整。我想过用大小来调整标记的大小，但是差别似乎并不明显。</p><p id="d67a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还可以画出特定地点的地震地图。例如，日本发生过多次地震。我不确定，但它可能是世界上地震最多的国家。</p><p id="5035" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关注特定国家的一种方法是根据纬度和经度值过滤地震。<a class="ae lh" href="https://developers.google.com/public-data/docs/canonical/countries_csv" rel="noopener ugc nofollow" target="_blank">日本</a>的纬度和经度值如下所示:</p><ul class=""><li id="4cfc" class="mu mv it lk b ll lm lo lp lr mw lv mx lz my md mz na nb nc bi translated">纬度= 36.204824</li><li id="8b2e" class="mu mv it lk b ll nd lo ne lr nf lv ng lz nh md mz na nb nc bi translated">经度= 138.252924</li></ul><p id="c759" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以围绕这些值创建一个范围，用作过滤范围。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="0be8" class="mj mk it mf b gy ml mm l mn mo">japan_lat = 36.204824<br/>japan_long = 138.252924</span><span id="b8e4" class="mj mk it mf b gy mp mm l mn mo">japan_eq = eq[(eq.Latitude &gt; 30) &amp; (eq.Latitude &lt; 42) &amp; (eq.Longitude &gt; 130) &amp; (eq.Longitude &lt; 145)]</span><span id="6ec5" class="mj mk it mf b gy mp mm l mn mo">japan_eq = japan_eq.reset_index(drop=True)</span></pre><p id="6f75" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我调整了范围，使位置占据了日本的面积。请注意，这些数值并不是日本的国界。</p><p id="44ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们创建一个仅包含日本境内或周边发生的地震的地理数据框架。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="96f7" class="mj mk it mf b gy ml mm l mn mo">japan_gdf = geopandas.GeoDataFrame(japan_eq, geometry=geopandas.points_from_xy(japan_eq.Longitude, japan_eq.Latitude))</span></pre><p id="c440" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将绘制日本地图，并在日本gdf中标记地震。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="ba7a" class="mj mk it mf b gy ml mm l mn mo">ax = world[world.name == 'Japan'].plot(color='white', edgecolor='black', figsize=(12,8))</span><span id="0490" class="mj mk it mf b gy mp mm l mn mo">japan_gdf.plot(ax=ax, color='blue', markersize=japan_gdf['Magnitude']*4)</span><span id="37f2" class="mj mk it mf b gy mp mm l mn mo">plt.title("Earthquakes, 1965-2016", fontsize=16)</span><span id="89b7" class="mj mk it mf b gy mp mm l mn mo">plt.show()</span></pre><p id="6152" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了过滤地图，我们使用了世界地理数据框的“名称”列。</p><p id="5bf4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是由此产生的日本地震地图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e2f3420359d5f3fa39d1213e9b178be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*xypH8bEErvHtod4mWhn9-A.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="aa8f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">日本发生过多次地震。标记的密度表明大部分都在东海岸。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="017c" class="nq mk it bd nr ns nt nu nv nw nx ny nz ki oa kj ob kl oc km od ko oe kp of og bi translated"><strong class="ak">结论</strong></h1><p id="1cb6" class="pw-post-body-paragraph li lj it lk b ll oh kd ln lo oi kg lq lr oj lt lu lv ok lx ly lz ol mb mc md im bi translated">GeoPandas是一个函数库，可以加速地理空间可视化的创建过程。它提供了许多功能和方法来丰富地图。</p><p id="4cbc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你正在或者计划使用地理空间数据，我强烈推荐你查看GeoPandas的<a class="ae lh" href="https://geopandas.org/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>。它们还提供了一些示例，有助于更容易地调整函数和方法。</p><p id="2ce3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>