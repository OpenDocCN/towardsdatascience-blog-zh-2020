<html>
<head>
<title>Market Basket Analysis with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫菜篮子分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/market-basket-analysis-with-pandas-246fb8ee10a5?source=collection_archive---------18-----------------------#2020-10-07">https://towardsdatascience.com/market-basket-analysis-with-pandas-246fb8ee10a5?source=collection_archive---------18-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b688" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一般有哪些物品是一起买的？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aaf1814ed8ce4324d619fdc35633c854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s9aLaVRWZIOmR2ZrQ9-XyQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Nathália Rosa 在<a class="ae ky" href="https://unsplash.com/s/photos/grocery-store?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1a13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">购物篮分析是零售商实施的常见数据科学实践。目标是发现项目之间的关联。了解人们倾向于一起购买什么是非常重要的。</p><p id="c824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一个像样的市场篮子分析提供了有用的洞察力过道组织，销售，营销活动，等等。</p><p id="ed25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将分析Kaggle上可用的杂货店<a class="ae ky" href="https://www.kaggle.com/heeraldedhia/groceries-dataset" rel="noopener ugc nofollow" target="_blank">数据集</a>。让我们从读取数据集开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cf58" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="5abc" class="ma mb it lw b gy mg md l me mf">groceries = pd.read_csv("/content/Groceries_dataset.csv")</span><span id="4762" class="ma mb it lw b gy mg md l me mf">groceries.shape<br/>(38765, 3)</span><span id="2a47" class="ma mb it lw b gy mg md l me mf">groceries.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/bb111ac2cb28fb5d91e373e5e4d1768b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*tsuTjL0T8AQdmBC39UwhbA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0d1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集的组织方式是每行代表特定客户在给定日期购买的商品。</p><p id="5479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开始分析之前，我们应该检查数据类型，以及是否有任何丢失的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3a23" class="ma mb it lw b gy mc md l me mf">groceries.isna().sum().sum()<br/>0</span><span id="bcb5" class="ma mb it lw b gy mg md l me mf">groceries.dtypes<br/>Member_number       int64 <br/>Date               object <br/>itemDescription    object</span></pre><p id="86e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有丢失值，但是“日期”列的数据类型应该转换为日期时间，这可以通过pandas的to_datetime函数来完成。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4d80" class="ma mb it lw b gy mc md l me mf">groceries.Date = pd.to_datetime(groceries.Date)</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="5c06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先来看看平均每天售出的商品数量。一种方法是按日期对项目进行分组并对项目进行计数。然后我们可以画出结果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="061e" class="ma mb it lw b gy mc md l me mf">import matplotlib.pyplot as plt</span><span id="41f8" class="ma mb it lw b gy mg md l me mf">groceries[['Date','itemDescription']].groupby('Date').count()\<br/>.plot(figsize=(12,6), legend=False, fontsize=14)</span><span id="825f" class="ma mb it lw b gy mg md l me mf">plt.title('Number of Items Sold per Day', fontsize=18)<br/>plt.xlabel('Date',fontsize=14)<br/>plt.ylabel('Qty', fontsize=14)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/dcaf99458ece8c07a83cf7c7455979c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cglUzqhuI6dp4bA83BmY9g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="97b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们降采样会更好看。我们可以使用重采样功能来降低频率。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ae1b" class="ma mb it lw b gy mc md l me mf">groceries[['Date','itemDescription']].groupby('Date').count()\<br/>.resample('M').mean()\<br/>.plot(figsize=(12,6), legend=False, fontsize=14)</span><span id="63be" class="ma mb it lw b gy mg md l me mf">plt.title('Number of Items Sold per Day', fontsize=18)<br/>plt.xlabel('Date',fontsize=14)<br/>plt.ylabel('Qty', fontsize=14)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/b1abb190c2c15ec65ff4500d503e23a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jorf8FPYzO1B3A0T7xJuJg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="a97f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看起来生意越来越好，因为商品数量呈普遍增长趋势。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="63bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集中的每一行都代表客户在某一天购买的一件商品。如果一个顾客一次购买了三件商品，将会有三行具有相同的顾客号和日期，但是具有不同的商品描述。</p><p id="3d81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个衡量标准是每次购物的平均商品数量，它可以通过按客户编号和日期对商品进行分组来计算。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b761" class="ma mb it lw b gy mc md l me mf">item_qty = groceries[['Member_number', 'Date','itemDescription']]\<br/>.groupby(['Member_number','Date']).count().reset_index()</span><span id="c181" class="ma mb it lw b gy mg md l me mf">item_qty.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/d9eabd27b2df1a0eaff1851268e3f663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*LgCnRENC3FXDeWzhofc9Lw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="afb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Item_qty dataframe显示每次购物的商品数量。例如，客户1000在2014年6月24日购买了3件商品。</p><p id="1bb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">平均每次购物的商品数量在2.5件左右。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1e32" class="ma mb it lw b gy mc md l me mf">item_qty.itemDescription.mean()<br/>2.5907</span></pre><p id="33a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还来看看每次购物的商品数量分布。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1442" class="ma mb it lw b gy mc md l me mf">item_qty.itemDescription.plot(figsize=(10,6), kind='hist',<br/>                              legend=False, fontsize=14)</span><span id="1447" class="ma mb it lw b gy mg md l me mf">plt.title('Histogram of Item Quantities per Shopping', fontsize=18)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/f42678597e076cd30dd5dba1d3d953d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*whFS6mOqyPe4NvmaEr6tfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="3e81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顾客最有可能一起购买2-3件商品。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="49cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">购物篮分析的主要焦点是一起购买哪些项目。一种常见的技术是关联规则学习，这是一种发现变量之间关系的机器学习方法。Apriori算法是一种常用的关联规则学习算法。</p><p id="4209" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们不会详细讨论apriori算法或关联规则学习。相反，我会告诉你一个简单的方法来检查哪些物品是经常一起购买的。</p><p id="2122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个包含每次购物的商品列表的数据框架。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1096" class="ma mb it lw b gy mc md l me mf">items = groceries.groupby(['Member_number', 'Date'])\<br/>.agg({'itemDescription': lambda x: x.ravel().tolist()}).reset_index()</span><span id="c0f5" class="ma mb it lw b gy mg md l me mf">items.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/5e6cc264d6face69a7c7236f596c7d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*FxyctVpeqhkfYofM18MXZA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="81e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">客户1000在2014年6月24日购买的三种商品是全脂牛奶、糕点和咸点心。</p><p id="3587" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要确定哪些项目经常出现在“itemDescription”列的相同行中。</p><p id="ec24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种方法是在每行中创建项目的组合，并计算每个组合的出现次数。python的itertools可以用来完成这项任务。</p><p id="ddbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是第一行的示例。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="aa54" class="ma mb it lw b gy mc md l me mf">import itertools</span><span id="e138" class="ma mb it lw b gy mg md l me mf">list(itertools.combinations(items.itemDescription[0], 2))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/70ec202d86d0fdc8e13ce138d423e2a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*9ZY9CSeSCTMsBbuT6GOobA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="8104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行有3个项目，所以我们有3对组合。Itertools.combinations不返回我们需要的重复组合(例如(' pastry '，' pastry '))。</p><p id="da55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码将对每一行执行该操作，并将组合添加到一个列表中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7c00" class="ma mb it lw b gy mc md l me mf">combinations_list = []<br/>for row in items.itemDescription:<br/>    combinations = list(itertools.combinations(row, 2))<br/>    combinations_list.append(combinations)</span></pre><p id="8c0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了一个列表列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/bb97084c389aafec7098517656032fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*A8TIHJ6zLZQw04xPcjmYBQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="cba5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过使用pandas的explode函数从这个列表中创建一个列表，但是我们需要首先将它转换成pandas系列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f6a8" class="ma mb it lw b gy mc md l me mf">combination_counts = pd.Series(combinations_list).explode().reset_index(drop=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d50be2f4509f7a6ccf6d3eba206eba0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*y6ZSxCBUQQe5KlA0DDVe0Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0b31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用value_counts函数来计算每个组合的出现次数。以下是十种最常见的组合:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/57bdb3e328a8ad1115497e8665e060e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*IDxtt0nXvWgB9zfYKIm_ew.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="4bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个是惊喜，因为它是重复的。我们已经做出了没有重复元素的组合。数据集可能包含repating元素。例如，如果一个顾客一次买了2瓶全脂牛奶，那就必须有两行全脂牛奶。</p><p id="c537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过计算每次购物时全脂牛奶的数量来确认。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="acef" class="ma mb it lw b gy mc md l me mf">whole_milk = groceries[groceries.itemDescription == 'whole milk']\<br/>.groupby(['Member_number','Date']).count()\<br/>.sort_values(by='itemDescription', ascending=False).reset_index()</span><span id="006a" class="ma mb it lw b gy mg md l me mf">whole_milk.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/3edb7474c3e95c699dcd64bf261b8c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*tU_qD9SJ9hFOqc8OkP0fQw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="3762" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看来我们怀疑的是正确的。例如，顾客1994在2015年11月3日购买了4瓶全脂牛奶。因此，最常见的组合是全脂牛奶和全脂牛奶是完全有道理的。</p><p id="60d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应该关注不重复的组合。例如，第二常见的组合是全脂牛奶和面包卷。全脂牛奶似乎主宰了购物清单。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="1157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经做了一个简单和基本的市场篮子分析。大型零售商正在做更复杂的事情，他们可能会从许多不同的角度进行分析。</p><p id="2686" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，总体目标通常是相同的，即能够预测客户的购买行为。</p><p id="1fa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>