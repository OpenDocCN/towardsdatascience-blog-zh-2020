<html>
<head>
<title>How to Detect Model Drift in MLOps Monitoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在MLOps监控中检测模型漂移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-detect-model-drift-in-mlops-monitoring-7a039c22eaf9?source=collection_archive---------3-----------------------#2020-11-02">https://towardsdatascience.com/how-to-detect-model-drift-in-mlops-monitoring-7a039c22eaf9?source=collection_archive---------3-----------------------#2020-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e40aa4d58034f3cdaa0bc1fe3f7d5521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMLG2VER4VYyQCP2aNkXug.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://unsplash.com/@tormius?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Adrià Tormo </a>在<a class="ae jd" href="https://unsplash.com/photos/YEWvMidcKkg" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><p id="9850" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">人工智能在各行各业的采用率都在迅速上升。随着新冠肺炎的出现，消费者和企业对数字技术的采用在T4的八周时间内已经向前跨越了五年。然而，部署ML的复杂性阻碍了AI系统的成功。MLOps，特别是ML模型的生产面临的挑战与DevOps监控出现之前困扰软件的挑战相似。</p><h1 id="30c4" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">ML中的运营挑战</strong></h1><p id="a376" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">与传统代码不同，ML模型是独特的软件实体，由于部署后输入到模型中的数据的变化，其性能会随着时间而波动。因此，成功的人工智能部署需要持续的ML监控，以在持续的基础上重新验证其商业价值。</p><p id="b84a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ML团队可以使用模型性能指标，如AUC、precision、recall等。监控生产模型的实时性能。然而，这些指标需要这些实时预测的“基础事实”或标签。虽然标签在训练数据集中总是可用的，但是对于给定的用例，它们可能不总是在生产中可用。例如，当一个模型对贷款风险进行预测时，贷方将只知道贷款是否违约或在贷款期限内是否得到全额偿付。在没有这些输入的情况下，或者为了补充这些性能指标的可见性，监控生产特征和预测分布的变化可以用作性能问题的领先指标和故障排除工具。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/0357b1344be0c50a3d4e996ed93fca44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9GoJLJSLjHQbs_dU"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">已部署模型中的数据更改(图片由作者提供)</p></figure><h1 id="3102" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">什么是漂移</strong></h1><p id="8a0b" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">漂移是实体相对于基线的变化。数据漂移是模型漂移的基础，被定义为数据分布的变化。在生产ML模型的情况下，这是实时生产数据和基准数据集(可能是训练集)之间的变化，基准数据集代表模型打算执行的任务。由于现实世界的变化，随着时间的推移，生产数据可能偏离或偏离基线数据。预测值的漂移是概念漂移或数据完整性问题的一个很好的代理，并且可以通知模型重新训练节奏</p><p id="9c85" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">最大似然漂移的类型<br/> </strong>根据所比较的数据分布，可能有四种类型的漂移</p><ol class=""><li id="9359" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated"><strong class="kf jh">概念漂移</strong>或P(Y|X)的变化是模型输入和输出之间实际关系的变化。概念漂移的一个例子是，当宏观经济因素使贷款风险更高，有资格获得贷款的标准更高。在这种情况下，以前被认为有信誉的收入水平不再有信誉。</li><li id="937a" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated"><strong class="kf jh">预测漂移</strong>或P(Y hat预测|X)的变化是模型预测的偏移。例如，当你的产品在更富裕的地区推出时，有更大比例的值得信赖的应用程序。您的模型仍然有效，但是您的企业可能还没有为这种情况做好准备</li><li id="371b" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated"><strong class="kf jh">标签漂移</strong>或P(Y地面真实值)的变化是模型输出或标签分布的变化</li><li id="432a" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated"><strong class="kf jh">特征漂移</strong>或P(X)的变化是模型输入数据分布的变化。例如，所有申请人的收入增加了5%，但经济基本面是一样的。</li></ol><p id="0c4e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">概念漂移本质上是真实决策边界和学习决策边界之间的差异。需要重新学习数据，以保持先前状态的错误率和准确性。如果地面实况标签可用并且足够实时，性能漂移是这种情况的最强指示器。在缺乏实时地面实况的情况下，预测和特征分布的漂移通常预示着世界上的重要变化。然而，与性能漂移不同，这些量可能会相对于精确建模的决策边界漂移(下面称为“虚拟漂移”)。在这种情况下，模型性能将保持不变。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/138df5305344ef79b35dbb337d4b905c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TwKZCvrsWe-ZDRUz"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">参考文献:<a class="ae jd" href="https://dl.acm.org/doi/10.1145/2523813" rel="noopener ugc nofollow" target="_blank">概念漂移适应研究综述——Joao Gama等</a></p></figure><p id="0eae" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">漂移的原因<br/> </strong>生产模型中出现漂移有多种原因。</p><p id="1890" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1.当外部性导致数据分布发生真正的变化时。这可能需要具有更新的代表性训练集的新模型。</p><ul class=""><li id="b63c" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated">基本事实或输入数据分布的变化，如由于疫情、在新市场推出产品等而改变客户偏好。</li><li id="7bde" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la my mp mq mr bi translated">有一个观念的转变。例如，竞争对手推出了一项新服务</li></ul><p id="a0d5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.当存在数据完整性问题时。这需要进一步的人体调查。</p><ul class=""><li id="6e7e" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated">正确的数据在源处输入，但由于错误的数据工程而被错误地修改。例如，债务收入比值和年龄值在模型输入中互换。</li><li id="91a4" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la my mp mq mr bi translated">来源处输入的数据不正确。例如，由于前端问题，网站表单接受将字段留空。</li></ul><p id="4005" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">如何计算数据漂移</strong> <br/>测量漂移有两种技术</p><ol class=""><li id="9e29" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated"><strong class="kf jh">统计</strong>:这种方法使用统计指标。这种方法的一个关键优势是用户对这些指标的理解，这些指标已经在多个行业中使用，尤其是金融和银行业。它们还有一个额外的好处，就是实现起来更简单。</li></ol><ul class=""><li id="2e5a" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated"><a class="ae jd" href="https://www.listendata.com/2015/05/population-stability-index.html" rel="noopener ugc nofollow" target="_blank"> <em class="mz">人口稳定指数</em> </a>，流行于金融服务业，是衡量两个人口样本之间人口稳定性的指标。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/c6ca110b2baea570c6e0b9b4405bd449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9O9Mf19WxdtkxKNU"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">人口稳定指数(<a class="ae jd" href="https://www.listendata.com/2015/05/population-stability-index.html" rel="noopener ugc nofollow" target="_blank">参考</a>)</p></figure><ul class=""><li id="830e" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated"><a class="ae jd" href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence" rel="noopener ugc nofollow" target="_blank"><em class="mz">kull back–lei bler</em></a><em class="mz"/>(或KL)散度是衡量一个概率分布与第二个，参考概率分布如何不同的指标。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/148b823c9fb8e453bf0292d949e94a04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/0*6T6ekbhU7UsKbTTA"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">参考:<a class="ae jd" href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><ul class=""><li id="56f7" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated"><a class="ae jd" href="https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence" rel="noopener ugc nofollow" target="_blank"><em class="mz">Jensen-Shannon</em></a>(或JS)散度是衡量两个概率分布之间相似性的一种方法。它基于KL散度，有一些显著的不同，包括它是对称的，并且它总是有一个有限的值。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/249c1b91147ee0bce96289e0d1394ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/0*H4jBU1sxv1ehSE-n"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">参考:<a class="ae jd" href="https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><ul class=""><li id="2f7e" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated"><a class="ae jd" href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test" rel="noopener ugc nofollow" target="_blank"> <em class="mz"> Kolmogorov-Smirnov检验</em> </a>(或KS检验)是连续(或不连续)一维概率分布相等的非参数检验，可用于比较样本与参考概率分布(单样本K–S检验)，或比较两个样本(双样本K–S检验)</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/fd1915e578fa7e2ba5b9f07c33b6e9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/0*A83gg9UUEkcqaDw1"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">参考:<a class="ae jd" href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><p id="d185" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.<strong class="kf jh">基于模型的</strong>:这种方法使用一个模型来确定给定点或点群与参考基线之间的相似性。虽然使用基于ML的技术可以给出更准确的漂移图像，但是解释该技术的基础对于形成直觉来说可能是一个挑战。</p><p id="bf7c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">如何识别漂移的原因</strong></p><p id="39e2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有<a class="ae jd" href="https://blog.fiddler.ai/2020/07/announcing-ml-monitoring-capabilities/" rel="noopener ugc nofollow" target="_blank">正确的工具</a>来监控预测和特征漂移可能是乏味的。负责维护生产模型的数据科学家或ML工程师必须使用上述技术之一，不断将选定的实时流量窗口与基线进行比较。</p><p id="28cd" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">捕捉到模型输出中的漂移后，下一步是确定哪些特征导致了漂移。很多时候，输入要素可能会漂移很多，但它可能不会在模型输出中造成有意义的漂移(即伪漂移)，因为该要素在模型中的重要性较低。识别漂移来源包括评估要素相对于其输入重要性的潜在漂移。</p><p id="3724" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Fiddler，我们使用JS-Divergence和可解释的人工智能来帮助在几个步骤中识别和排除预测和特征漂移</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/65c527b17a1a0ad9948a37b7e4c1e4ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CCtPqK7-PLqpCtiS"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">确定数据漂移原因(作者截图)</p></figure><ul class=""><li id="25a5" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la my mp mq mr bi translated"><strong class="kf jh">步骤1 </strong>:快速识别实时模型输出中的预测漂移，与训练或基线集进行比较，用您在生产数据漂移阈值方面的领域知识来补充JS-Divergence。</li><li id="ba61" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la my mp mq mr bi translated"><strong class="kf jh">步骤2 </strong>:再次使用JS-Divergence，向下钻取到所选的时间窗口，查看底层特征的漂移。使用可解释性查看漂移特征的特征重要性，并只关注那些有意义的影响，过滤掉虚假漂移。</li><li id="f4fd" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la my mp mq mr bi translated"><strong class="kf jh">第三步</strong>:比较数据分布，查看实际差异，围绕模型再训练的需要形成直觉。</li><li id="0473" class="mj mk jg kf b kg ms kk mt ko mu ks mv kw mw la my mp mq mr bi translated"><strong class="kf jh">步骤4 </strong>:进一步分析受影响的流量切片，了解漂移的性能</li></ul><p id="de0e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总之，数据变化可能是模型衰退的主要指标，因为ML模型是概率性的，并使用历史示例为高性能而训练。监控ML模型中的数据漂移有助于ML团队在生产中的性能问题上保持领先，可解释的AI通过提供强大的诊断工具来补充这一点，只需点击一下鼠标就可以找到任何可疑的时间片。</p></div></div>    
</body>
</html>