<html>
<head>
<title>Build solid foundations for your portfolio projects with SQLAlchemy and AWS RDS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SQLAlchemy和AWS RDS为您的投资组合项目构建坚实的基础</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-solid-foundations-for-your-data-science-projects-with-aws-rds-and-sqlalchemy-da8388e1e209?source=collection_archive---------28-----------------------#2020-10-04">https://towardsdatascience.com/build-solid-foundations-for-your-data-science-projects-with-aws-rds-and-sqlalchemy-da8388e1e209?source=collection_archive---------28-----------------------#2020-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="156d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">借助SQL Alchemy和AWS RDS，您可以将数据发送到云中，并在舒适的Jupyter中利用SQL。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d95f962c6e1ac17d2c91144dead6821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qbHq68nZKUYZjGYx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">法比奥在Unsplash上拍摄的照片</p></figure><p id="5095" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常情况下，项目所需的数据存储在一些关系数据库中……如果它目前以csv文件的形式四处传播，那么您也应该将它存储在安全的地方。最简单的方法当然是SQL。</p><p id="b162" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好消息是，如果您不喜欢使用MySql或其他关系数据库管理系统(RDBMS ),由于SQLAlchemy，您仍然可以在舒适的Jupyter上完成大部分工作！</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="d4d6" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">从AWS云服务入手比你想象的要容易！</h1><p id="291f" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">AWS、Azure或Google Cloud等云服务通常是部署模型的最简单方式，这使得它们成为申请数据科学职位时所需的技能。哪怕只有其中一种的基本经验，也会让您在数据科学之旅中有一个良好的开端。</p><p id="ab77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯……你已经完成了几门Coursera课程，参加了Kaggle比赛，掌握了Scikit-Learn但是云服务听起来像是很复杂，自己很难掌握的东西？你大错特错了…与理解机器学习的基础相比，这是小菜一碟。通过这一点额外的工作，你真的可以提高你创建E2E项目的技能。</p><p id="157a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我旨在向您展示如何轻松地开始使用AWS环境，并使用它来创建您的私有RDS。我选择AWS，因为我相信它是最好的学习材料之一，并且易于使用。在小规模学习项目方面，它也有不错的定价——你几乎可以免费获得所有东西。然而，在选择服务时要小心——我建议在任何变化后的几天内检查账单，以确保你在月底不会被收取太多费用。</p><p id="46f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在以后的文章中，我还将关注AWS的其他方面，比如EC2与Docker的结合，用于模型的稳定部署。由于数据不是数据科学中的第一个词，我决定建立一个稳定的数据基础将在未来节省您的时间和精力。</p><h1 id="9ebc" class="mb mc it bd md me my mg mh mi mz mk ml jz na ka mn kc nb kd mp kf nc kg mr ms bi translated">1.建立自己的MySql数据库</h1><p id="fdc6" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">如果你已经专业地处理数据，你可能熟悉你公司的关系数据库。然而，我相信至少整个数据管道的基本知识是有用的，包括建立一个数据库。</p><p id="081b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一方面，数据科学需要不断学习，参与私人项目是这一旅程的重要组成部分。出于这个原因，我建议你建立你的私人数据库。</p><p id="532a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我自己花了将近两年的时间，基于本地或GitHub上存储的csv和json输入构建自己的项目组合，相信我，过一段时间后，所有的输入和输出文件都变得一团糟，我真希望早点创建自己的私有DB。</p><p id="e52d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在AWS RDS上建立一个数据库需要大约10分钟，并且不需要任何经验:你需要做的就是遵循AWS本身的这份出色的入门材料——他们做得如此之好，以至于我自己都不会试图写它，因为它不可能更清楚了。按照下面的说明设置数据库，直到第1步结束-我们将直接从Python继续第2步:</p><div class="nd ne gp gr nf ng"><a href="https://aws.amazon.com/getting-started/hands-on/create-mysql-db/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">如何创建一个MySQL数据库-亚马逊网络服务</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">在本教程中，您将学习如何创建一个运行MySQL数据库的环境(我们称这个环境为…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">aws.amazon.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ks ng"/></div></div></a></div><p id="d1d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住选择免费层，记下所选密码(如果丢失，将无法找回)，并将Publicly Accessible设置为Yes —(您需要扩展附加连接配置)。要记住的另一个重要部分是在步骤e中设置数据库名称——忽略这一点会使以后的工作更加困难。一旦你准备好了，我们可以在舒适的Jupyter笔记本上做剩下的工作。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="db1c" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">2.使用SQL Alchemy连接到AWS RDS</h1><p id="4c2c" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">恭喜你！您已经创建了自己的基于私有云的关系数据库。现在让我们用SQL-Alchemy将我们的Jupyter笔记本连接到数据库。文章这一部分的代码和数据可以从<a class="ae nv" href="https://github.com/Jan-Majewski/Medium_articles/tree/master/02_AWS_RDS_with_SQLAlchemy" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得。</p><p id="8a5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要定义4个关键参数，它们允许SQLAlchemy连接到AWS RDS。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="1923" class="ob mc it nx b gy oc od l oe of">host="sqlalchemytutorial.*****.eu-central1.rds.amazonaws.com"<br/>port=3306<br/>dbname="TUTORIAL"<br/>user="admin"<br/>password="Baloney1" #now they make you add numbers...</span></pre><ul class=""><li id="291e" class="og oh it la b lb lc le lf lh oi ll oj lp ok lt ol om on oo bi translated">前两个参数可以在连接性和安全性详细信息中找到，一旦进入DB实例就会出现这些信息</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/a8aacebc54bae4264e794aae5c4bdc12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KM-xqFudrFsCrsqsPKEFXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">关于数据库实例的关键信息</p></figure><ul class=""><li id="b9ea" class="og oh it la b lb lc le lf lh oi ll oj lp ok lt ol om on oo bi translated">dbname是您在创建数据库期间定义的名称(或者您将来可能要使用的任何其他模式名称)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/a896402f8d011e506489439106aa1a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yL5Fl9suvhzT2s43qD7IKw.png"/></div></div></figure><ul class=""><li id="f00f" class="og oh it la b lb lc le lf lh oi ll oj lp ok lt ol om on oo bi translated">用户和口令已由您在设置数据库时的身份证明设置过程中定义</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/05bfbb68eb32e730b27cf33857767940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H682TQ2ocLfsA0sRDTuDqw.png"/></div></div></figure><p id="4c0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们完成了排序，我们需要做的就是用这个简单的查询建立一个连接</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="13a5" class="ob mc it nx b gy oc od l oe of">database_connection = sqlalchemy.create_engine('mysql+mysqlconnector://{0}:{1}@{2}/{3}'<br/>            .format(user, password,host, dbname)).connect()</span></pre><p id="e0b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们已经连接好了，准备向我们的数据库写入一些数据！</p><h1 id="e43a" class="mb mc it bd md me my mg mh mi mz mk ml jz na ka mn kc nb kd mp kf nc kg mr ms bi translated">3.将数据从csv文件写入数据库</h1><p id="374b" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">目前，我们的数据库是空的，我们需要填充它。出于本教程的目的，我将使用从Right move删除的伦敦租金数据的一个小样本:如果你对这个话题感兴趣，你可以在我的文章<a class="ae nv" href="https://medium.com/@janekmajewski/beginners-guide-to-web-scraping-with-beautiful-soup-on-london-rent-listings-1ab6824c11b8" rel="noopener">中阅读更多关于伦敦租金列表的漂亮汤的网络抓取初学者指南</a>。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="a6a7" class="ob mc it nx b gy oc od l oe of">#Reading data from csv file<br/>data = pd.read_csv(r"<a class="ae nv" href="https://raw.githubusercontent.com/Jan-Majewski/Medium_articles/master/02_AWS_RDS_with_SQLAlchemy/London_property_data.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/Jan-Majewski/Medium_articles/master/02_AWS_RDS_with_SQLAlchemy/London_property_data.csv</a>")</span><span id="c029" class="ob mc it nx b gy os od l oe of">data.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/36936a4bf8c813a16b5fc63f795df975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWoEgTKhw_VtD9QCHwi0ow.png"/></div></div></figure><p id="ec81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">目前，所有数据都存储在一个堆栈中，但这不是很容易扩展，让我们将它分成3个表，以利用SQL的优势。我们将能够根据“id”键加入数据。值得确保键列具有int类型，因为在floats上连接比较慢，并且可能由于舍入误差而导致困难。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="99f0" class="ob mc it nx b gy oc od l oe of">property_features=['id','bedrooms', 'bathrooms']<br/>location_features=['id','latitude','longitude','City', 'Country']<br/>price_features=['id', 'MonthlyPrice','download_time']</span><span id="7be5" class="ob mc it nx b gy os od l oe of">table_properties=data[property_features]<br/>table_locations=data[location_features]<br/>table_prices=data[price_features]</span><span id="e140" class="ob mc it nx b gy os od l oe of">table_price.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/f79af4026ac099d2a8d7af9d34055fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*HZErFi9gmLy_hHvNKMoFxQ.png"/></div></figure><p id="4688" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将我们的数据拆分到单独的表中有一个很大的优势，我们可以节省存储空间——在这种情况下，我们可以很有信心，一旦我们有了关于物业位置及其特征的数据，它就不太可能改变。然而，价格可能会经常变化，这就是为什么我只在table_price中包含download _ time我们可以追加更新的价格，而不必将我们已经拥有的位置和属性数据追加到其他表中。</p><p id="e911" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们已经准备好了数据，我们可以将它写入我们的数据库。我们不需要担心游标、数据类型等等，我们可以只使用pd.to_sql。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="3125" class="ob mc it nx b gy oc od l oe of">table_property.to_sql(con=database_connection, name="PROPERTIES", if_exists='replace',chunksize=100, index=False)</span><span id="dcd9" class="ob mc it nx b gy os od l oe of">table_location.to_sql(con=database_connection, name="LOCATIONS", if_exists='replace',chunksize=100, index=False)</span><span id="bdd4" class="ob mc it nx b gy os od l oe of">table_prices.to_sql(con=database_connection, name="PRICES", if_exists='replace',chunksize=100, index=False)</span></pre><p id="49bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我选择chunksize为100来批量写入数据，但是如果容量不大，您也可以一次写入所有数据。</p><p id="b2e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我们已经填充了数据库中的前3个表:属性、位置和价格。</p><h1 id="e350" class="mb mc it bd md me my mg mh mi mz mk ml jz na ka mn kc nb kd mp kf nc kg mr ms bi translated">4.使用SQL查询数据</h1><p id="90e3" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">测试data foundation的最后一步是查询保存的数据，这样我们就不需要再次使用csv文件。让我们编写一个简单的查询，其中我们连接“id”上的所有表并执行它。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="2180" class="ob mc it nx b gy oc od l oe of">sql_query='''<br/>SELECT * FROM PRICES a<br/>JOIN LOCATIONS b<br/>ON a.id=b.id<br/>JOIN PROPERTIES c<br/>ON a.id=c.id<br/>'''</span><span id="a793" class="ob mc it nx b gy os od l oe of">property_data=pd.read_sql(sql_query,con=database_connection)<br/>property_data.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/2f41d3f510575c63bcb9e0f50521ceb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYSjiE2UnhTaFYpcPQGYyg.png"/></div></div></figure><p id="1fd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们设法检索并连接存储在数据库中的财产数据。这个数据集非常简单，存储在关系数据库中没有什么优势，但是对于频繁更新的更大、更复杂的数据集，它有一个巨大的优势，您可以使用与这里演示的完全相同的方法。</p><h1 id="757e" class="mb mc it bd md me my mg mh mi mz mk ml jz na ka mn kc nb kd mp kf nc kg mr ms bi translated">5.创建新模式</h1><p id="fb7c" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">为了使您的数据库可伸缩，您可能需要不止一个模式，它很像数据库中的一个文件夹。您也可以从Python中添加它。但是，您需要安装sqlalchemy_utils库。您需要做的就是使用新模式的名称创建另一个连接。然后测试模式是否已经存在，如果不存在，则创建它—类似于在本地工作时检查文件夹并在需要时创建它。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="b8df" class="ob mc it nx b gy oc od l oe of">dbname_2='TUTORIAL_ADVANCED'<br/>database_connection_2 = 'mysql+mysqlconnector://{0}:{1}@{2}/{3}'.format(user, password,host, dbname_2)</span><span id="4520" class="ob mc it nx b gy os od l oe of">if not database_exists(database_connection_2):<br/>    create_database(database_connection_2)</span></pre><h1 id="1d3f" class="mb mc it bd md me my mg mh mi mz mk ml jz na ka mn kc nb kd mp kf nc kg mr ms bi translated">摘要</h1><p id="67a1" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在这篇简短的文章中，我旨在展示如何快速开始使用AWS RDS并为您的项目构建稳定的数据基础，同时通过使用SQL Alchemy将所有主要步骤都保留在笔记本中。</p><p id="2940" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这种方法能够帮助您构建可扩展的数据科学项目，并避免存储在几十个不同文件中的数据出现混乱。</p><p id="5b73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇文章是我计划在AWS上写的一系列文章中的第一篇，所以如果你对这个话题感兴趣，请关注我的简介，这样你就不会错过了！</p><p id="4a8d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的宝贵时间！希望你喜欢这篇文章。</p></div></div>    
</body>
</html>