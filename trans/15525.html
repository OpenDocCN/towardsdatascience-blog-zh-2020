<html>
<head>
<title>Understanding DICOM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解DICOM</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-dicom-bce665e62b72?source=collection_archive---------15-----------------------#2020-10-26">https://towardsdatascience.com/understanding-dicom-bce665e62b72?source=collection_archive---------15-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7a26" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何阅读、书写和组织医学图像</h2></div><p id="b963" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DICOM是在医院数据库中存储和传输医学图像的主要文件格式。</p><p id="d7ca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有其他存储图像的文件格式。除了DICOM，您还可以看到以NIFTI格式(文件后缀为。nii”)、PNG或JPEG格式，甚至像NumPy数组这样的Python文件对象。</p><p id="becf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么为什么要用DICOM呢？其他文件格式可能更方便，但在临床实践中，一切都使用DICOM格式。随着我的项目越来越先进，我经常发现自己重写代码来直接读写DICOM文件。此外，DICOM文件是明确的，因为每个文件都包含一个文件头，详尽地记录了医院、患者、扫描仪和图像信息，就像每次拍摄iPhone照片时，智能手机信息甚至GPS都被编码在元数据中一样。</p><p id="1b50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【DICOM的建议读数</p><p id="e953" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DICOM文件格式记录在<a class="ae lb" href="https://www.dicomstandard.org/" rel="noopener ugc nofollow" target="_blank"> DICOM标准</a>中，这是大多数信息学专家的必读文件。</p><p id="5a56" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于一个初学者的背景，<a class="ae lb" href="http://dicomiseasy.blogspot.com/" rel="noopener ugc nofollow" target="_blank">这个博客</a>也是一个很好的介绍。</p><p id="dfe0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">DICOM的挑战</strong></p><p id="83eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于深度学习任务，最终目的通常是将图像数据加载为NumPy或其他文件，在这种情况下，DICOM可能会很困难:</p><ol class=""><li id="046c" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la lh li lj lk bi translated">DICOM为每个切片保存一个文件，因此3D扫描可能有数百个文件</li><li id="73d3" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">DICOM文件以唯一标识符(UID)命名。这使得很难从文件夹级别对文件进行排序(在某些情况下，文件名太长，以至于超过了Windows计算机上256个字符的最大值，从而导致保存/加载问题)</li><li id="43b1" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">患者和医院信息嵌入在文件头中，这使得DICOM很难匿名</li></ol><p id="f763" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然混乱，但这种组织结构是DICOM的重要优势。稍后，我将分享一些我编写的示例Python代码，它们可以帮助绕过这些问题。</p><p id="ca7c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">识别DICOM文件</strong></p><p id="4239" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个DICOM文件都是独立的——识别文件所需的所有信息都嵌入在每个文件头中。这些信息分为4个层次——患者、研究、系列和实例。</p><ul class=""><li id="d912" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la lq li lj lk bi translated">“患者”是接受检查的人</li><li id="2662" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lq li lj lk bi translated">“研究”是在某个日期和时间在医院进行的成像程序</li><li id="5705" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lq li lj lk bi translated">“系列”—每个研究由多个系列组成。一个系列可以代表在一次研究中对患者进行多次物理扫描(通常用于MRI ),也可以是虚拟的，即对患者进行一次扫描，然后以不同的方式重建数据(通常用于CT)</li><li id="11c5" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lq li lj lk bi translated">“实例”-3D图像的每个切片都被视为一个单独的实例。在这种情况下，“实例”与DICOM文件本身同义</li></ul><p id="befa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了说明这种层次结构，这里有一些来自癌症成像档案馆 (TCIA) 的<a class="ae lb" href="https://www.cancerimagingarchive.net/" rel="noopener ugc nofollow" target="_blank"> <em class="lr">的公开胰腺癌数据集的文件:</em></a></p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ls"><img src="../Images/f7e3237c21d6d59095c5dff47b4031b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHlALSCzS5OSmULBYfwxeg.png"/></div></div><p class="me mf gj gh gi mg mh bd b be z dk translated">图一。按“患者”、“研究”、“系列”和“实例”级别组织的DICOM文件示例。图片作者。</p></figure><p id="eb26" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">表1显示了使用<a class="ae lb" href="https://pydicom.github.io/" rel="noopener ugc nofollow" target="_blank"> PyDicom </a>(一个允许读取和写入Dicom文件的python包)打印出的标题。我删除了大部分不相关的信息，还创建了一些“虚假”的患者数据。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ea77088b0d332d6dd690a238cd8f7114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*4fJeG9z7y3-69jUsov6vXw.png"/></div><p class="me mf gj gh gi mg mh bd b be z dk translated">表1:显示患者、系列、研究和实例uid和文本描述的DICOM标题部分的打印输出。图片作者。</p></figure><p id="179c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从表1中的两个描述字段中，我们可以看到该文件来自腹部的CT检查，该检查使用了对比剂，这与来自胰腺癌成像数据库的该扫描相一致。这个系列“ABD”可能是唯一的，也可能有其他的。在临床CT研究中，通常会看到定位扫描(“拓扑结构图”)以及“矢状”和“冠状”扫描，它们在不同的平面上突出显示解剖结构。</p><p id="02cc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">唯一标识符:uid</strong></p><p id="5b76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除文本描述外，扫描还通过唯一的患者ID (5553226)、研究ID(1 . 2 . 826 . 0 . 1 . 3680043 . 2 . 1125 . 1)进行识别。38381854871216336385978062044218957)，系列UID (1.2.826.0.1。3680043 . 2 . 1 . 1)和实例号(20)。</p><p id="cd61" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您要加载该文件夹中的下一个DICOM文件，患者ID、病历报告UID和系列图像UID将具有相同的值，只有实例编号不同(在本例中为“21”)。</p><p id="b1a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文本描述很有帮助，但uid是识别扫描的关键。与描述不同，uid对于在医院进行的每个患者、系列和研究都是独特的。</p><p id="f85d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，uid实际上不是随机数，它们编码了关于文件身份的信息，甚至是如何压缩的信息。UID的完整描述在Dicom标准的<a class="ae lb" href="http://dicom.nema.org/medical/dicom/current/output/pdf/part06.pdf" rel="noopener ugc nofollow" target="_blank">第6部分</a>中。</p><p id="122b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我见过的大多数DICOM病历报告都是以“三层”文件夹结构组织的，如图1所示，文件首先按患者UID排序，然后是病历报告实例UID，然后是系列图像实例UID，最后文件名本身就是实例编号。</p><p id="75e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">结论</strong></p><p id="7b20" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，我简要介绍了如何识别DICOM文件，以及如何使用这些信息对数据集进行排序。</p><p id="ad43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下一篇文章中，我将描述我写的一个python脚本，它可以根据文件头中的UID信息将一组DICOM文件重新组织到一个一致且易于理解的文件夹结构中。</p></div></div>    
</body>
</html>