<html>
<head>
<title>Custom Pandas Statistics Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义熊猫统计功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/custom-pandas-statistics-functions-731e767d4807?source=collection_archive---------33-----------------------#2020-11-07">https://towardsdatascience.com/custom-pandas-statistics-functions-731e767d4807?source=collection_archive---------33-----------------------#2020-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d1d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">生成统计数据的三个有用的Pandas函数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e9382282b262f54d9bc753fedc2712b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yg1Vv3WxuS-XbwCPJG83IQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/books-business-computer-connection-459654/" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae ky" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>拍摄</p></figure><p id="0486" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个有用的python库，可用于各种数据任务，包括统计分析、数据插补、数据争论等等。在本帖中，我们将介绍三个有用的自定义函数，它们允许我们从数据中生成统计数据。</p><p id="a055" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="f307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于我们的目的，我们将使用<em class="lv">葡萄酒评论</em>数据集，可以在<a class="ae ky" href="https://www.kaggle.com/zynicide/wine-reviews" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="2a15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们导入pandas和numpy包:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="71c3" class="mb mc it lx b gy md me l mf mg">import pandas as pd <br/>import numpy as np</span></pre><p id="7521" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们将显示列和行的最大数量设置为“None”:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="ff42" class="mb mc it lx b gy md me l mf mg">pd.set_option('display.max_columns', None)<br/>pd.set_option('display.max_rows', None)</span></pre><p id="b149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们读入数据:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="7519" class="mb mc it lx b gy md me l mf mg">df = pd.read_csv('winemag-data-130k-v2.csv')</span></pre><p id="cf4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将打印前五行数据，以了解列类型及其值(列结果被截断):</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="aa5c" class="mb mc it lx b gy md me l mf mg">print(df.head())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/4f999981097166754c36f69c29f1a01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFRZimtiDqXEWcQWZBN14Q.png"/></div></div></figure><p id="3e0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以考虑一个有趣的函数，它为分类列中的给定类别生成数值列的平均值。该函数将接受一个分类列名、该分类列的分类值和一个数字列名:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="8f4d" class="mb mc it lx b gy md me l mf mg">def get_category_mean(categorical_column, categorical_value, numerical_column):</span></pre><p id="f3d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在函数中，我们需要过滤该类别值的数据帧，并取该类别数值的平均值:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="0b89" class="mb mc it lx b gy md me l mf mg">def get_category_mean(categorical_column, categorical_value, numerical_column):<br/>    df_mean = df[df[categorical_column] == categorical_value]<br/>    mean_value = df_mean[numerical_column].mean()</span></pre><p id="95ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以使用python“f字符串”来打印结果:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="428b" class="mb mc it lx b gy md me l mf mg">def get_category_mean(categorical_column, categorical_value, numerical_column):<br/>    df_mean = df[df[categorical_column] == categorical_value]<br/>    mean_value = df_mean[numerical_column].mean()<br/>    print(f"Mean {categorical_column} for  {numerical_column}", np.round(mean_value, 2))</span></pre><p id="7b2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们调用包含分类列“国家”、国家值“意大利”和数字列“价格”的函数:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="f7c3" class="mb mc it lx b gy md me l mf mg">get_category_mean('country', 'Italy', 'price')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/5bd79e51492c44e0a1b55b9b518b475f.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*YElgrjigC_9fTCMPITBdOw.png"/></div></figure><p id="42e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以调用类别为“品种”、品种值为“黑皮诺”、数值列为“价格”的函数:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="3da2" class="mb mc it lx b gy md me l mf mg">get_category_mean('variety', 'Pinot Noir', 'price')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/e6b505cbc0d3b41bdecd25afd62e6ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*lDxyi9z9Xo6wNtjALuyNOA.png"/></div></figure><p id="65e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以考虑的另一个函数是为分类列中的每个分类值生成数字列的平均值。我们可以使用熊猫的“分组”方法来实现这一点:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="eac0" class="mb mc it lx b gy md me l mf mg">def groupby_category_mean(categorical_column, numerical_column):<br/>    df_groupby = df.groupby(categorical_column)[numerical_column].mean()<br/>    df_groupby = np.round(df_groupby,2)<br/>    print(df_groupby)</span></pre><p id="3014" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们用“国家”和“价格”调用我们的函数，我们将打印每个国家的平均价格(为了清楚起见，结果被截断):</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="64ab" class="mb mc it lx b gy md me l mf mg">groupby_category_mean('country', 'price')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4e5e661ea6bd5aef1d9beee90b8153f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*QkJV68P6infCE9nPnzofww.png"/></div></figure><p id="5bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了进行健全性检查，我们看到我们得到了与上一个函数中相同的意大利平均价格。我们还可以将该函数应用于葡萄酒品种和价格(为了清楚起见，结果被截断):</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="116f" class="mb mc it lx b gy md me l mf mg">groupby_category_mean('variety', 'price')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/0954f4602a851a41ddcaa8033f541c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*HTpExYj1QNkYnMwOvAwNPw.png"/></div></figure><p id="2a2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将讨论的最后一个函数为另一个分类列的每个值生成分类列的模式。我们也可以使用熊猫的“分组”方法来实现这一点:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="8f93" class="mb mc it lx b gy md me l mf mg">def groupby_category_mode(categorical_column1, categorical_column2):<br/>    df_groupby = df.groupby(categorical_column1)[categorical_column2].agg(pd.Series.mode)<br/>    print(df_groupby)</span></pre><p id="49bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们找到每个国家的葡萄酒品种。这将告诉我们每个国家最常出现的葡萄酒品种:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="e326" class="mb mc it lx b gy md me l mf mg">groupby_category_mode('country', 'variety')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/ad183718da2b36d797540bb547619463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XjrU5lVC6LYM0e1Rnaz1cg.png"/></div></div></figure><p id="2057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将在这里停下来，但是您可以自己随意摆弄代码和数据。</p><h2 id="671c" class="mb mc it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">结论</h2><p id="f9dd" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">总之，在这篇文章中，我们讨论了如何使用Pandas定义三个自定义函数来从数据中生成统计洞察。首先，我们展示了如何定义一个函数，在给定分类列和类别值的情况下，计算数字列的平均值。然后，我们展示了如何使用“groupby”方法为分类列中的每个类别生成数值列的平均值。最后，我们展示了如何为一个分类列的每个值生成另一个分类列的模式。如果你有兴趣学习更多关于熊猫的数据操作、机器学习甚至只是python编程的一些基础知识，请查看<a class="ae ky" href="https://www.amazon.com/dp/B08N38XW2Q/ref=sr_1_1?dchild=1&amp;keywords=sadrach+python&amp;qid=1604966500&amp;s=books&amp;sr=1-1" rel="noopener ugc nofollow" target="_blank"><em class="lv">Python for Data Science and Machine Learning:Python编程、熊猫和Scikit-初学者学习教程</em> </a>。我希望你觉得这篇文章有用/有趣。这篇文章中的代码可以在<a class="ae ky" href="https://github.com/spierre91/medium_code/blob/master/pandas_tutorials/pandas_custom_functions.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。感谢您的阅读！</p></div></div>    
</body>
</html>