<html>
<head>
<title>Data Lake -Comparing Performance of Known Big Data Formats</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据湖—比较已知大数据格式的性能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-lake-comparing-performance-of-known-big-data-formats-eace705b6fd8?source=collection_archive---------14-----------------------#2020-09-25">https://towardsdatascience.com/data-lake-comparing-performance-of-known-big-data-formats-eace705b6fd8?source=collection_archive---------14-----------------------#2020-09-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="da79" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">众所周知的大数据格式(CSV、JSON、AVRO、PARQUET和ORC)的性能比较</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/188e54a69d2943052f459671005b40e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTwZq7ceSHClNuAconBNig.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米卡·鲍梅斯特在<a class="ae ky" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3c39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去的几年里，我一直在大数据项目中使用各种数据格式。在这段时间里，我强烈倾向于一种形式，而不是另一种——我的失败给了我一些教训。在我的讲座中，我一直强调为正确的目的使用正确的<strong class="lb iu">数据格式</strong>的重要性——这让世界变得不同。</p><p id="a547" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一直以来，我都在想，我是否向我的客户和学生传授了正确的知识。我可以用数据来支持我的主张吗？因此，我决定做这个性能比较。</p><p id="e845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我开始比较之前，让我简要地向您描述一下所考虑的各种数据格式。</p><h2 id="cfc4" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">行格式</h2><p id="e509" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">CSV、JSON和Avro(二进制)</p><h2 id="a894" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">分栏格式</h2><p id="e3a0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">拼花地板和ORC(都是二元的)</p><p id="02ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信你一定想知道<em class="mt">行</em>和<em class="mt">列</em>格式之间的区别。<strong class="lb iu">数据在磁盘上的存储方式至关重要。</strong>行格式存储为<strong class="lb iu">行1 &gt;行2 &gt;行3 </strong>列格式存储到磁盘为<strong class="lb iu">列1 &gt;列2 &gt;列3 </strong></p><p id="5df3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切都好，但这有什么关系…数据就是数据。不完全是。如果我让你平均一下<strong class="lb iu">工资</strong>栏呢。对于数据的行格式，需要从磁盘中读取每一行，提取薪金列，然后进行平均。这消耗了大量的IO，因为需要读取大量的磁盘扇区。</p><p id="2215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于列格式，从磁盘中一次性读取连续的薪金列块，然后进行平均。更少的IO意味着更高的性能。像平均、求和等数学运算。包括很大一部分数据分析处理——自然，柱状格式在OLAP更受欢迎</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/5b39e31bf31d7d298985eea47a7d0662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*53dVv-Rlw9mer-ZDxj44ZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b644" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果行格式那么糟糕，为什么还在使用？如果您正在执行OLTP，行格式显然是最佳选择。在web/mobile应用程序中，您不太关心一系列行的数学处理，但是您确实希望快速访问单个行。<strong class="lb iu">这就是自动选择行格式的地方。由于这个原因，所有已知的关系数据库都以这种方式存储数据。</strong></p><h2 id="8cc3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">性能比较—平台</h2><p id="98c7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">存储层:</strong> Hadoop 3 .2.1— Hadoop文件系统(HDFS)</p><p id="53c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">计算层:</strong>Spark 3-4个工作线程-32个内核58GB</p><p id="2ecc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据样本量:</strong>HDFS存储5亿行</p><p id="ad5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">样本数据:</strong></p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="cca5" class="lv lw it mw b gy na nb l nc nd">+-----+---------+----------+<br/>|stock|    price|  timetamp|<br/>+-----+---------+----------+<br/>| AMZN| 121.1792|1600952178|<br/>| SBUX|132.03702|1600952178|<br/>|  MCD| 407.2828|1600952178|<br/>|  MCD| 43.12032|1600952178|<br/>| MSFT|115.79154|1600952178|<br/>+-----+---------+----------+</span></pre><p id="59a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">加工操作</strong></p><ol class=""><li id="290c" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">按照这个顺序[股票，价格，时间]对5亿行进行排序，并将结果保存到HDFS</li><li id="4c2e" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">按股票分组数据，找到最高价，并将结果保存到HDFS</li></ol><h2 id="581b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">性能比较结果</h2><p id="2b71" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">以下是不同格式的文件大小的结果。请注意5亿行文件大小的巨大差异。JSON的占地面积最大，而Parquet的占地面积最小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/867a23ce8016900fb7de06c68f615fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*QPvXVv76yBIx1CFzySbmyQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JSON占用的内存最大，因为它存储了每行的模式属性。因此，我很少将JSON或CSV格式存储在数据湖的管理和转换区域中。JSON和CSV格式仍然是最广泛使用的数据交换方法。我特别注意在从源代码中获取之后将它们转换成二进制格式。我的数据湖通常看起来像:</p><p id="ba88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">原始区域:JSON或CSV </strong></p><p id="4129" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">策划和改造区:Avro、ORC或拼花地板(或其组合)</strong></p><p id="7302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是不同格式的排序操作的结果。不出所料，JSON表现最慢，Parquet、ORC最快。我必须承认，看到AVRO表现得相当好，我有点惊讶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/3681952ee9ae27cdcea21ba344c506f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Wp88qLZ99Ij7XBVYn3LyBg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="07dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是分组操作的结果，并找出不同格式的最大值。注意，这个操作本质上是纯数学的。它非常类似于数据分析用例。我很高兴地证实，所有二进制格式(AVRO，拼花，ORC)表现相当不错。</p><p id="b5bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Parquet和ORC的性能几乎相同，但ORC的文件占用空间略小。看到近年来ORC的采用率大幅下降并不奇怪。我几乎不再遇到任何使用ORC格式的项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b84266e7cc97d6584c3d96b8af994fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*-Ah1fPvLLr55ShgEyWz4BA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="nt nu nv"><p id="96ff" class="kz la mt lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">总之，我现在可以有把握地推断，Parquet和ORC格式确实非常适合数据分析操作。从这篇文章中得到的另一个非常重要的启示是— <strong class="lb iu">立即停止在您的管理和转换区域中使用CSV、JSON。</strong>这似乎是显而易见的，但你会惊讶地发现，我遇到过多少次不遵循这一规则的部署。</p></blockquote><p id="717b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种比较的所有代码都可以在下面的链接中找到:</p><div class="nz oa gp gr ob oc"><a href="https://github.com/mkukreja1/blogs/tree/master/data-formats" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">mkukreja 1/博客</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div><p id="53cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章是有帮助的。由<a class="ae ky" href="http://www.datafence.com" rel="noopener ugc nofollow" target="_blank"> Datafence Cloud Academy </a>提供的<strong class="lb iu">大数据格式</strong>主题将作为大数据Hadoop、Spark &amp; Kafka课程的一部分进行详细介绍。课程是周末自己在网上教的。</p></div></div>    
</body>
</html>