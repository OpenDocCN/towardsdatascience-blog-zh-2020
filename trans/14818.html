<html>
<head>
<title>Python Pandas Merging DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python熊猫合并数据帧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-pandas-merging-dataframes-aebbf898a9ff?source=collection_archive---------50-----------------------#2020-10-12">https://towardsdatascience.com/python-pandas-merging-dataframes-aebbf898a9ff?source=collection_archive---------50-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d8a3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Python中合并熊猫数据帧的快速操作指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fefe52ab5b7f714ccc7bbd12fb24092e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VwBvzH0iKYboBBxe"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@milkovi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">milkoví</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="b973" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="b1eb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为数据科学家，我们经常会发现我们需要同时分析来自多个数据源的数据。为了成功实现这一点，我们需要能够使用各种方法有效地合并不同的数据源。今天我们将看看如何使用Pandas内置的<code class="fe mn mo mp mq b">.merge()</code>函数，通过几种不同的连接方法来连接两个数据源。</p><h1 id="c753" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">入门指南</h1><p id="6d85" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于那些刚刚接触数据科学或者还没有接触过Python Pandas的人，我们建议首先从<a class="ae ky" rel="noopener" target="_blank" href="/pandas-series-dataframe-explained-a178f9748d46"> Pandas系列&amp; DataFrame Explained </a>或<a class="ae ky" rel="noopener" target="_blank" href="/python-pandas-iterating-a-dataframe-eb7ce7db62f8"> Python Pandas迭代DataFrame </a>开始。这两篇文章都将为您提供安装说明和今天文章的背景知识。</p><h1 id="ca74" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">熊猫合并</h1><p id="d877" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Pandas内置函数<code class="fe mn mo mp mq b">.merge()</code>提供了一个强大的方法，使用数据库风格的连接来连接两个数据帧。</p><h2 id="f879" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">句法</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的Python片段显示了熊猫的语法。merge()函数。</p></figure><h2 id="010d" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">因素</h2><ul class=""><li id="80ea" class="nf ng it lt b lu lv lx ly ma nh me ni mi nj mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">right</code> —这将是您要加入的数据框架。</li><li id="acd1" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">how</code> —在此，您可以指定两个数据框的连接方式。缺省值是<code class="fe mn mo mp mq b">inner</code>，但是，对于左外连接，您可以通过<code class="fe mn mo mp mq b">left</code>，对于右外连接，您可以通过<code class="fe mn mo mp mq b">right</code>，对于全外连接，您可以通过<code class="fe mn mo mp mq b">outer</code>。</li><li id="401b" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">on</code> —如果两个数据帧都包含一个共享列或一组共享列，那么您可以将它们作为键传递给<code class="fe mn mo mp mq b">on</code>进行合并。</li><li id="9956" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">left_on</code> —在此，您可以指定一列或一列标签，您希望将这些标签加入左侧数据框。当您希望在两个数据框架中连接的列的名称不同时，此参数非常方便。</li><li id="f8c2" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">right_on</code> —与<code class="fe mn mo mp mq b">left_on</code>相同的条件适用于右侧数据帧。</li><li id="2408" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">left_index</code> —如果您想使用索引连接左侧数据框，则通过<code class="fe mn mo mp mq b">True</code>。</li><li id="481b" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">right_index</code> —如果您想使用索引连接正确的数据帧，则通过<code class="fe mn mo mp mq b">True.</code></li><li id="9058" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">sort</code> —如果你希望连接的键按字典顺序排序，你可以在这里输入<code class="fe mn mo mp mq b">True</code>。</li><li id="f279" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">suffixes</code> —如果两个数据框架共享列标签名，则可以指定要应用于重叠的后缀类型。左侧默认为<code class="fe mn mo mp mq b">_x</code>，右侧默认为<code class="fe mn mo mp mq b">_y</code>。</li><li id="80ba" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">indicator</code> —如果您想标记行的来源，您可以将该参数设置为<code class="fe mn mo mp mq b">True</code>。该标志将指示行关键字是只出现在左数据帧中，还是出现在右数据帧中，还是同时出现在两个数据帧中。</li><li id="9212" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe mn mo mp mq b">validate</code> —在这里，您可以查看数据帧是如何连接的，以及键之间的关系。您可以通过下面的<code class="fe mn mo mp mq b">1:1</code>来检查左右数据帧中的键是否唯一，<code class="fe mn mo mp mq b">1:m</code>来检查合并的键是否只对左数据帧唯一，<code class="fe mn mo mp mq b">m:1</code>来检查合并的键是否只对右数据帧唯一。</li></ul><h1 id="4140" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">实际应用</h1><p id="aa69" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下面我们将通过几个例子来学习如何使用合并功能。下面提供的代码片段将帮助您创建两个数据帧，我们将在故事的剩余部分使用它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的Python片段创建了两个数据帧，您可以使用它们来继续下面的示例。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/331e364a7ec02316fb0915a3cdf0fe33.png" data-original-src="https://miro.medium.com/v2/resize:fit:312/format:webp/1*kYTY3_bxXKyOTKpJ9lfzQQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的控制台输出显示了执行Python片段创建两个数据帧的结果。</p></figure><h2 id="22d8" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">内部连接</h2><p id="44f2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">内部连接方法是Pandas merge default。当您传递<code class="fe mn mo mp mq b">how='inner'</code>时，返回的数据帧将只包含来自两个数据帧之间共有的连接列的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的Python片段演示了如何使用内部连接来连接两个数据帧。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/eec5b9a28f07ff825e702e54e8137de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*LirofyExYpVnUP5WFUyItA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上图显示了内部连接两个数据帧后的控制台输出。</p></figure><p id="5150" class="pw-post-body-paragraph lr ls it lt b lu nv ju lw lx nw jx lz ma nx mc md me ny mg mh mi nz mk ml mm im bi translated">从上面控制台输出的屏幕截图中，我们可以看到内部连接对两个数据帧的影响。由于值<code class="fe mn mo mp mq b">a</code>、<code class="fe mn mo mp mq b">c</code>、<code class="fe mn mo mp mq b">e</code>和<code class="fe mn mo mp mq b">f</code>不在两个数据帧之间共享，因此它们不会出现在控制台输出中。输出还演示了在处理两个数据帧之间的共享列标签时的默认后缀应用程序。</p><h2 id="8db9" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">左连接</h2><p id="b7a4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Pandas left join的功能类似于SQL中的left outer join。返回的数据帧将包含来自左侧数据帧的所有值，以及在来自右侧数据帧的合并期间匹配连接键的任何值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的Python片段显示了使用左连接合并两个数据帧的语法。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/34b7f5d6a808e2cba849f4b2e2ee1a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*tWt7Em1nk2C8_I2HVWYpGw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的屏幕截图显示了使用左连接合并两个数据帧的控制台输出。</p></figure><p id="fa5e" class="pw-post-body-paragraph lr ls it lt b lu nv ju lw lx nw jx lz ma nx mc md me ny mg mh mi nz mk ml mm im bi translated">如果右边的数据帧与合并列<code class="fe mn mo mp mq b">NaN</code>中的值不匹配，则将在返回的数据帧中插入<em class="ob">而不是数字</em>。</p><h2 id="e7cc" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">右连接</h2><p id="ec33" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">熊猫右连接执行与左连接类似的功能，但是连接方法应用于右数据帧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的Python代码片段显示了使用Pandas right join合并两个数据帧的语法。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f6a9d6b31736957373fac1b3782398a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*TLJqrVfV1pM-zX9bPfgz9A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的屏幕截图显示了使用右连接合并两个数据帧的结果。</p></figure><p id="5629" class="pw-post-body-paragraph lr ls it lt b lu nv ju lw lx nw jx lz ma nx mc md me ny mg mh mi nz mk ml mm im bi translated">如上所述，在左侧数据帧中，右侧不存在的任何键都将插入一个<code class="fe mn mo mp mq b">NaN</code>值。</p><h2 id="3f89" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">外部连接</h2><p id="bff5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Pandas外部连接合并了两个数据帧，实质上反映了左右外部连接的组合结果。外部连接将从左右两个数据帧返回所有值。当Pandas在合并数据帧中找不到值时，将使用<code class="fe mn mo mp mq b">NaN</code>来代替。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的Python片段显示了使用外部连接来连接两个数据帧的语法。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/dc18bdf6bf753db34661a248af0bb89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*QZmchNlri02q1L1bEQhs7g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面的屏幕截图显示了使用外部连接合并两个数据帧的结果。</p></figure><p id="7b1d" class="pw-post-body-paragraph lr ls it lt b lu nv ju lw lx nw jx lz ma nx mc md me ny mg mh mi nz mk ml mm im bi translated">当使用外部连接合并两个数据帧时，了解新数据帧中的记录来自何处有时会很有用。您可以通过将<code class="fe mn mo mp mq b">indicator=True</code>作为参数传递给<code class="fe mn mo mp mq b">.merge()</code>函数来查看记录的来源，该函数将创建一个名为<code class="fe mn mo mp mq b">_merge</code>的新列。</p><h1 id="196c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">摘要</h1><p id="8d21" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要想成为一名成功的数据科学家，您需要经常同时熟练地处理来自多个数据源的数据。我们经常需要组合数据源，有时是为了丰富数据集或在当前数据中合并历史快照。Pandas使用内置的<code class="fe mn mo mp mq b">.merge()</code>函数为连接数据集提供了一个强大的方法。Pandas <code class="fe mn mo mp mq b">.merge()</code>函数在连接类型方面提供了灵活性，您可以创建这些类型来实现所需的输出。</p><p id="6b13" class="pw-post-body-paragraph lr ls it lt b lu nv ju lw lx nw jx lz ma nx mc md me ny mg mh mi nz mk ml mm im bi translated">感谢您花时间阅读我们的故事，我们希望您发现它有价值！</p></div></div>    
</body>
</html>