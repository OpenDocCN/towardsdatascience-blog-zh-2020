<html>
<head>
<title>Introduction to Big Data with Vaex — A Simple Code to Read 1.25 Billion Rows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vaex大数据简介—读取12.5亿行的简单代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-big-data-a-simple-code-to-read-1-25-billion-rows-c02f3f166ec9?source=collection_archive---------39-----------------------#2020-10-09">https://towardsdatascience.com/introduction-to-big-data-a-simple-code-to-read-1-25-billion-rows-c02f3f166ec9?source=collection_archive---------39-----------------------#2020-10-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/fe0471d26c47106046d4ff8979461281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtsAQFJLsBgd2cSXewYVQg.png"/></div></div></figure><h2 id="0aeb" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/making-sense-of-big-data" rel="noopener" target="_blank">理解大数据</a></h2><div class=""/><div class=""><h2 id="d032" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">用Python高效读取和可视化12.5亿行星系模拟数据</h2></div><p id="1158" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi ly translated">如今，我们正在进入各种各样的时代。有人说，我们正处于颠覆时代。为了理解它，我们可以使用Schwartz (1999)在他的书<em class="mh">中的一个术语，数字达尔文主义</em>。这个术语描述了我们正在进入一个时代，在这个时代，企业无法适应技术和科学的发展。数字平台和全球化改变了客户的范式，改变了他们的需求。</p><p id="728e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">另一方面，有人说我们正在进入大数据时代。几乎所有学科都经历过数据激增。其中之一是天文学。全世界的天文学家意识到他们需要建造越来越大的望远镜或天文台来收集更多的数据。例如，在2000年初，一项名为2微米全天巡天(<a class="ae mi" href="https://iopscience.iop.org/article/10.1086/498708" rel="noopener ugc nofollow" target="_blank"> 2MASS </a>)的全天巡天收集了大约4.7亿个天体。2016年年中，天基望远镜<a class="ae mi" href="https://www.aanda.org/articles/aa/pdf/2016/11/aa29272-16.pdf" rel="noopener ugc nofollow" target="_blank"> Gaia </a>发布了由约17亿个天体组成的第二次数据发布。天文学家是如何处理的？</p><p id="0cf9" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在本文中，我们将讨论如何实际处理大数据。我们将使用来自盖亚宇宙模型快照的星系模拟数据(<a class="ae mi" href="https://www.aanda.org/articles/aa/abs/2012/07/aa18646-11/aa18646-11.html" rel="noopener ugc nofollow" target="_blank"> GUMS </a>)。它有大约35亿个物体。你可以在这里访问它<a class="ae mi" href="https://gaia.obspm.fr/tap-server/tap" rel="noopener ugc nofollow" target="_blank">。例如，我们将只读取12.5亿行。</a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="4437" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">使用Vaex读取10亿行数据</strong></p><p id="5247" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">首先，我必须感谢<a class="ae mi" href="https://towardsdatascience.com/@maartenbreddels" rel="noopener" target="_blank"> Maarten Breddels </a>构建了Vaex，一个读取和可视化大数据的python模块。它可以在一秒钟内读取10亿行。你可以在这里阅读文档<a class="ae mi" href="https://vaex.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1710" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">Vaex将有效地读取hdf5和arrow格式的文件。这里，我们将使用一些hdf5文件。要在Vaex中读取文件，可以使用下面的代码</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="7cfe" class="mz na je mv b gy nb nc l nd ne">import vaex as vx</span><span id="9e86" class="mz na je mv b gy nf nc l nd ne">df = vx.open('filename.hdf5')</span></pre><p id="2a90" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">但是，如果您想同时读取一些hdf5文件，请使用以下代码</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="4d1c" class="mz na je mv b gy nb nc l nd ne">df = vx.open_many(['file1.hdf5', 'file2.hdf5'])</span></pre><p id="aec4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">可以分析下图。</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/fe0471d26c47106046d4ff8979461281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtsAQFJLsBgd2cSXewYVQg.png"/></div></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">读取12亿行数据</p></figure><p id="42db" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">变量<strong class="le jo">文件</strong>是工作目录中所有hdf5文件的数组。你可以在1秒钟内查看阅读所有文件所需的时间。在下一行，我检查行的总数。是12.5亿行。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="ad16" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">Vaex中的算术运算和虚拟列</strong></p><p id="fbc1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">你也可以快速地对所有的行做一些算术运算。这是一个例子</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/a4d701a40f1e181b43eaa4da9d66feb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*J_mX90RCTJz4D5QFYOoD0A.png"/></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">Vaex ( <em class="nk">图像由autho </em> r)中的算术运算</p></figure><p id="7977" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">Vaex可以毫秒级进行算术运算，将其应用于所有行(12.5亿)。如果要在Vaex数据框中分配一列，可以使用此代码</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="8119" class="mz na je mv b gy nb nc l nd ne">df['col_names'] = someoperations</span></pre><p id="6013" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这是一个例子</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/4bff1d5e76a90cd399f826063ab062b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*JKBL29tSqRF1m47Oa_YPZw.png"/></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">Vaex ( <em class="nk"> Image by autho </em> r)中的算术运算</p></figure><p id="b802" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">仔细看的话，代码和熊猫API差不多。Yups，据我所知，Vaex和熊猫用的是同一个API。您还可以像在Pandas中一样选择列，如下所示</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="9e2d" class="mz na je mv b gy nb nc l nd ne">df_selected = df[df.ag, df.age, df.distance]</span></pre><p id="6a0e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">回到上图，在第14行，添加了名为“new_col”的新列，这大约需要2.07毫秒。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="56ce" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 1D和2D宁滨</strong></p><p id="eab3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">您是否需要将宁滨统计数据快速应用到您的大数据中？Vaex也会是答案。要做一个1D宁滨并绘制它，您可以使用下面的代码</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="5de5" class="mz na je mv b gy nb nc l nd ne">df.plot1d(x-axis, shape=(number_of_bin))</span></pre><p id="15d2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这是我们数据的例子</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/a0db2e403ac7da3a77eb08e10314552a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*ZrMy3YCvld1ce_GlBQcfkg.png"/></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">1D·宁滨与Vaex ( <em class="nk">图片由autho </em> r提供)</p></figure><p id="5f95" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们在1D(直方图)中绘制列<strong class="le jo">距离</strong>的面元数为25。它会产生这样一个图形。Vaex需要大约2秒钟来可视化1D图。</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/62d6ba5b412c1070730d3976f4ba9148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i9EYU0ziuoKXoGf-pkmtYQ.png"/></div></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">Vaex中的1D图(直方图)</p></figure><p id="7df0" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">要应用2D·宁滨并将其可视化，您可以使用以下代码</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="a014" class="mz na je mv b gy nb nc l nd ne">df.plot(x-axis, y-axis, shape(shape_x, shape_y))</span></pre><p id="149c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">以下是我们数据中要应用的示例</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi np"><img src="../Images/2bd0c1de41d5b6c20c3f6080a0cce3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8BtuYTEN-ZEq8s92b9u17A.png"/></div></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">2D·宁滨和Vaex</p></figure><p id="ceec" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">可视化一个2D图大约需要4分钟。这是非常可以接受的。你可以想象另一个模块在2D图的密度中可视化12亿行需要多长时间。它会给你一个这样的数字。</p><figure class="mq mr ms mt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/e60e99500a4ee023e168e1965a9e9300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PsU0Rursh4HjGOgcHeNvA.png"/></div></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">Vaex中的2D密度图</p></figure><h2 id="fe15" class="mz na je bd nq nr ns dn nt nu nv dp nw ll nx ny nz lp oa ob oc lt od oe of jk bi translated">结论</h2><p id="0265" class="pw-post-body-paragraph lc ld je le b lf og ko lh li oh kr lk ll oi ln lo lp oj lr ls lt ok lv lw lx im bi translated">未来在这里，大数据时代已经到来。我们必须准备好所有需要的技术。准备工作之一是构建一个能够有效读取和可视化大数据的Python库。Vaex将作为它的解决方案推出。它声称Vaex一秒钟可以读取10亿行。我希望你能学会这个故事中提到的例子，并详细阐述到你的数据中。</p><h2 id="1e5e" class="mz na je bd nq nr ns dn nt nu nv dp nw ll nx ny nz lp oa ob oc lt od oe of jk bi translated">如果你喜欢这篇文章，这里有一些你可能喜欢的其他文章:</h2><div class="is it gp gr iu ol"><a rel="noopener follow" target="_blank" href="/visualizations-with-matplotlib-part-1-c9651008b6b8"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jo gy z fp oq fr fs or fu fw jn bi translated">使用Matplotlib实现Python数据可视化—第1部分</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">完成了从基础到高级的Python绘图的Matplotlib教程，包含90多个示例</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ja ol"/></div></div></a></div><div class="is it gp gr iu ol"><a rel="noopener follow" target="_blank" href="/5-powerful-tricks-to-visualize-your-data-with-matplotlib-16bc33747e05"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jo gy z fp oq fr fs or fu fw jn bi translated">使用Matplotlib可视化数据的5个强大技巧</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">如何使用LaTeX字体，创建缩放效果，发件箱图例，连续错误，以及调整框填充边距</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="pa l ow ox oy ou oz ja ol"/></div></div></a></div><div class="is it gp gr iu ol"><a rel="noopener follow" target="_blank" href="/matplotlib-styles-for-scientific-plotting-d023f74515b4"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jo gy z fp oq fr fs or fu fw jn bi translated">用于科学绘图的Matplotlib样式</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">为您的科学数据可视化定制Matplotlib</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="pb l ow ox oy ou oz ja ol"/></div></div></a></div><div class="is it gp gr iu ol"><a rel="noopener follow" target="_blank" href="/creating-colormaps-in-matplotlib-4d4de78a04b8"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jo gy z fp oq fr fs or fu fw jn bi translated">在Matplotlib中创建色彩映射表</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">从颜色列表中创建和定制自己的色彩映射表的指南</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="pc l ow ox oy ou oz ja ol"/></div></div></a></div><div class="is it gp gr iu ol"><a rel="noopener follow" target="_blank" href="/customizing-multiple-subplots-in-matplotlib-a3e1c2e099bc"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jo gy z fp oq fr fs or fu fw jn bi translated">在Matplotlib中自定义多个子情节</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">使用subplot、add_subplot和GridSpec在Matplotlib中创建复杂subplot的指南</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="pd l ow ox oy ou oz ja ol"/></div></div></a></div><p id="af5d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">仅此而已。感谢您阅读这个故事。喜欢就评论分享。我还建议您关注我的帐户，以便在我发布新故事时收到通知。</p><p id="4f72" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">参考文献:</strong></p><p id="d80b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">[1]施瓦茨，E. I .，<a class="ae mi" href="https://www.amazon.com/Digital-Darwinism-Evan-Schwartz-1999-06-08/dp/B01K13QB8A" rel="noopener ugc nofollow" target="_blank">数字达尔文主义</a> (1999)，百老汇图书公司</p><p id="1665" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">[2]张，赵，【大数据时代的天文学】 (2015)，数据科学杂志</p><p id="2fbd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">[3] Skrutskie，M. F .等人，<a class="ae mi" href="https://iopscience.iop.org/article/10.1086/498708" rel="noopener ugc nofollow" target="_blank">两微米全天巡天(2MASS) </a> (2006年)，《天文杂志》，131:1163–1183</p><p id="98d2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">[4]盖亚合作组织(Gaia Collaboration)，T. Prusti等人，<a class="ae mi" href="https://www.aanda.org/articles/aa/pdf/2016/11/aa29272-16.pdf" rel="noopener ugc nofollow" target="_blank">盖亚任务</a> (2016)天文学和天体物理学595，A1</p><p id="9a95" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">[5] Robin，A. C .等人，<a class="ae mi" href="https://www.aanda.org/articles/aa/abs/2012/07/aa18646-11/aa18646-11.html" rel="noopener ugc nofollow" target="_blank">盖亚宇宙模型快照</a> (2012)天文学和天体物理学543，A100</p></div></div>    
</body>
</html>