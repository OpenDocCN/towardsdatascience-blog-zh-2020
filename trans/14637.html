<html>
<head>
<title>Optimization of a weekly production plan with Python and Gurobi — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和Gurobi优化周生产计划—第1部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/optimization-of-a-weekly-production-plan-with-python-and-gurobi-part-1-d1257ad29a9?source=collection_archive---------12-----------------------#2020-10-09">https://towardsdatascience.com/optimization-of-a-weekly-production-plan-with-python-and-gurobi-part-1-d1257ad29a9?source=collection_archive---------12-----------------------#2020-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="766e" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="086e" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">了解如何使用Python和数学求解器Gurobi解决优化问题</h2></div><p id="ac77" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">即使在2020年，许多制造企业仍在手工进行生产规划，导致不必要的直接成本增加。让我们一起来看看如何使用Python和Gurobi优化求解器来降低这些成本。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/6c12a7d0749fa91205e2331d9dd482ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDHHh1Qst1vsUoIn0n1fCw.jpeg"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">由<a class="ae ma" href="https://unsplash.com/@lennykuhne" rel="noopener ugc nofollow" target="_blank">莱尼·屈尼</a>在<a class="ae ma" href="https://images.unsplash.com/photo-1567789884554-0b844b597180?" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="93c7" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">语境</h1><p id="6a06" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">你自豪地拥有一家制造公司，拥有三条生产线。在每一条生产线上，你都可以生产同样的产品，但不幸的是，每条生产线的设计都不一样，每条生产线的小时人工成本也不一样。您希望能够充分利用您的设备，以获得最大的成本效益。</p><p id="c908" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在本文中，我们将了解如何使用Python和Gurobi solver通过一个简单的模型来优化工作时间，以便熟悉这些工具。在第二部分中，我们将更深入地优化，添加更多的约束并比较结果。</p><h1 id="a10f" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">问题陈述</h1><p id="edb5" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">如上所述，贵厂拥有三条生产线。1号线和3号线的小时人工成本为245美元/小时，2号线为315美元/小时。由于目前的规章制度，你对每天的工作时间有一些限制:一条线每天不能运行少于7小时或超过12小时。</p><p id="5748" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">客户的要求是一周中每天的生产小时数，您希望在需要的那一天安排这些小时，这意味着没有提前或延迟计划。</p><p id="32f9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们深入研究一下，看看如何使用Gurobi solver来回答这个问题。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi my"><img src="../Images/5b8cb87e4422f86346149910c3a670af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKoIjItQH8lzx2SvqIH4lQ.png"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">问题图解|作者图片</p></figure><h1 id="45f4" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">一个简单的计划优化模型</h1><h2 id="e41c" class="mz mc iq bd md na nb dn mh nc nd dp ml kx ne nf mn lb ng nh mp lf ni nj mr iw bi translated">输入的创建</h2><p id="b677" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">第一步是定义将用于我们的问题的数据，在问题陈述中描述。我们将创建一些字典和pandas数据框，如下所示，其中包含与本周客户需求相关的信息、我们优化计划的时间表、可用生产线列表以及相关的小时成本。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="ed5d" class="mz mc iq bd md na nb dn mh nc nd dp ml kx ne nf mn lb ng nh mp lf ni nj mr iw bi translated">启动模型并创建变量</h2><p id="cb9d" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">我们现在已经定义了所有的输入；让我们建立我们的模型。我们需要初始化它，并创建将在我们的函数中使用的所有变量。</p><p id="2c31" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们将使用类型提示来获得更干净的代码，并确保变量的类型是正确的。我们函数的输入是我们希望实现计划的时间表、可用工作中心的列表、每天的需求以及每个工作中心的每小时成本。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7fc4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们启动我们的模型并创建决策变量。我们用<em class="nm"> addVars() </em>添加变量，并在属性中为每个变量设置大小、边界和类型。</p><ul class=""><li id="f082" class="nn no iq kq b kr ks ku kv kx np lb nq lf nr lj ns nt nu nv bi translated"><strong class="kq ja"> <em class="nm"> working_hours </em> </strong>:我们范围内每天由工作中心索引的整数变量。为了尊重您公司的规章制度，边界下限设置为7，上限设置为12。</li><li id="3707" class="nn no iq kq b kr nw ku nx kx ny lb nz lf oa lj ns nt nu nv bi translated"><strong class="kq ja"> <em class="nm"> line_opening </em> </strong>:表示每条生产线每天的状态的二进制变量，如果生产线关闭，取值0；如果生产线正在运行，取值1。</li><li id="5749" class="nn no iq kq b kr nw ku nx kx ny lb nz lf oa lj ns nt nu nv bi translated"><strong class="kq ja"> <em class="nm"> total_hours </em> </strong>:以天数和工作中心为索引的整数变量；它是每条线路的实际营业时间。</li><li id="6801" class="nn no iq kq b kr nw ku nx kx ny lb nz lf oa lj ns nt nu nv bi translated"><strong class="kq ja"> <em class="nm"> labor_cost </em> </strong>:一个整数值，衡量每行的每日人工成本。</li></ul><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ob"><img src="../Images/691f82b2e61ef266e7114d1e3b817dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAC6s0ac-Mqg6DIMFRhNXw.png"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">作者对total_hours变量的图解|图片</p></figure><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="bb5d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我们刚刚创建了每个变量，没有指定任何关系。一些变量相互关联，我们现在必须创建一些约束来设置它们的值。</p><h2 id="7141" class="mz mc iq bd md na nb dn mh nc nd dp ml kx ne nf mn lb ng nh mp lf ni nj mr iw bi translated">设置约束</h2><p id="3a81" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">类似地，让我们用<em class="nm">add consts()</em>创建约束。如果您只想创建一个约束，您应该使用不带“s”的<em class="nm">add const()</em>，但是在本例中，我们为每天和每条生产线创建多个约束。</p><p id="1447" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，我们需要链接之前创建的变量。总时数的价值是工时和线路开通的乘积，人工成本的价值是总时数和<em class="nm"> wc_reg_cost </em>中包含的每个工作中心的小时成本的乘积。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="40b2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，运行我们的模型的一切都准备好了。在解决它之前，我们需要创建最后一个来自我们与客户的协议的约束。事实上，如前所述，每天的需求必须在同一天得到满足。可以翻译如下:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oc"><img src="../Images/f2792c661af2d8c1b6ab2a87245c388a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ceACiSCP-C2AQGnVsxTgfA.png"/></div></div></figure><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="6e38" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">模型完全建立后，我们现在可以定义我们的目标函数并求解它。</p><h2 id="a8c9" class="mz mc iq bd md na nb dn mh nc nd dp ml kx ne nf mn lb ng nh mp lf ni nj mr iw bi translated">创建目标函数和解决方案</h2><p id="18ae" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">尽管所有这些都很有趣，但我们不要忘记我们的目标:我们希望通过更好地平衡3条生产线上的工作量来最大限度地降低劳动力成本。这是我们的目标函数！</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi od"><img src="../Images/07329d6c5c239597025546491c8ea2c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZlRWXRMZKCvgsxRJBDRtw.png"/></div></div></figure><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="75b2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我们刚刚完成的模型可以求解，并将为我们提供最具成本效益的规划。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="87a5" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">您可以使用以下代码来可视化您的模型，查看您的所有变量、约束和目标函数，这有助于纠正错误并检查模型是否是您想要的。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="19ed" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">当然，在这里，我们的模型是正确的，可以直接运行。我们可以提取溶液，并根据需要将其成型。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="ed01" class="mz mc iq bd md na nb dn mh nc nd dp ml kx ne nf mn lb ng nh mp lf ni nj mr iw bi translated">可视化解决方案</h2><p id="e2cf" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">我们现在拿出了最好的生产计划来满足客户的要求；我们需要提取并使其更加可视化。为此，我们将使用Altair库的直观界面和我们可以轻松创建的图形设计。由于这不是本文的目的，我不会详细说明我是如何做到这一步的，但您可以在我的<a class="ae ma" href="https://github.com/baptistesoulard/Production-plan-optimization/tree/master/Planning_optimization_part1" rel="noopener ugc nofollow" target="_blank"> GitHub </a> (Model1.py)上找到它，如果您需要任何解释，请联系我。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="oe nl l"/></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">我们的优化算法的结果用Altair库绘制</p></figure><p id="3783" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">正如预期的那样，当1号线和3号线在开通2号线之前达到最大负荷时，我们的生产计划得到优化，因为这条线上的每小时成本更高。我们可以看到，界限是受到尊重的，我们每天不开通少于7小时或超过12小时的线路。更重要的是，尊重客户的要求，当天满足每天的要求，不提前也不迟到。</p><h1 id="cfa2" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">限制和后续步骤</h1><p id="8a40" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">第一个模型是使用Gurobi求解器进行生产计划优化的第一种方法，但存在许多局限性。事实上，我们没有考虑因加班或周末工作而产生的额外成本。此外，需求可能不允许我们在同一天生产它；比如不到7个小时，我们就不能开通线路。这就是为什么我们将在第二部分添加更多的约束来考虑这个问题，并且我们将比较结果。</p><p id="4cd6" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">如果你需要进一步的信息或者想就这个话题交换意见，请随时联系我</strong>。你可以在<a class="ae ma" href="https://www.linkedin.com/in/baptistesoulard1994/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找到我。</p><h1 id="8df2" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">资源</h1><p id="b161" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">这个项目在我的GitHub上的资源库:<a class="ae ma" href="https://github.com/soulabat/Production-plan-optimization/tree/master/Planning_optimization_part1" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/baptistesoulard/Production-plan-optimization/tree/master/Planning _ optimization _ part 1</a></p><p id="516f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">解释SAP如何在其计划优化模块中使用线性优化:<a class="ae ma" href="https://www.gurobi.com/pdfs/user-events/2017-frankfurt/SAP.pdf" rel="noopener ugc nofollow" target="_blank">http://www . guro bi . com/pdf/user-events/2017-Frankfurt/SAP . pdf</a></p><p id="b4ff" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Gurobi文档:<a class="ae ma" href="https://www.gurobi.com/documentation/8.0/examples/workforce5_py.html" rel="noopener ugc nofollow" target="_blank">https://www . guro bi . com/documentation/8.0/examples/work force 5 _ py . html</a></p></div></div>    
</body>
</html>