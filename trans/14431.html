<html>
<head>
<title>Override date filter in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">覆盖Power BI中的日期过滤器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/override-date-filter-in-power-bi-743b9e8b9b2?source=collection_archive---------10-----------------------#2020-10-05">https://towardsdatascience.com/override-date-filter-in-power-bi-743b9e8b9b2?source=collection_archive---------10-----------------------#2020-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae21" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Power BI中覆盖标准的日期过滤可能比您想象的要复杂</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/447db77f645a3b471b26dd38a86884de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*KPfxshEI9MocmlIyvb4xeQ.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">伊加特·库尚列夫在Unsplash上拍摄的照片</p></figure><p id="1a82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最近，我的一个朋友从他的客户那里得到了一个有趣的请求。他们需要根据<a class="ae lq" rel="noopener" target="_blank" href="/tiq-part-3-ultimate-guide-to-date-dimension-creation-98b951ffa68c">日期选择</a>来查看过去指定时间段的值。</p><p id="cad4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果他们选择2020年3月31日，他们需要查看前12个月的值，因此从2019年4月1日开始。此外，他们需要一个选项来选择特定的日期，并查看所选日期的年初值。同样，如果他们选择2020年3月31日，他们需要查看从2020年1月1日开始的值。视觉效果将被调整为<a class="ae lq" rel="noopener" target="_blank" href="/dynamic-filtering-in-power-bi-5a3e2d2c1856">基于用户选择动态变化</a>。</p><p id="ea28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也就是说，编辑交互作为一种从特定视觉中移除过滤器的方式，并不是一种选择，因为它会完全拒绝用户选择任何特定的值进行过滤。</p><h2 id="454c" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">棘手的部分</h2><p id="bbaf" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">这里最棘手的事情是建立<a class="ae lq" rel="noopener" target="_blank" href="/role-playing-dimensions-in-power-bi-185dc58f90f1">日期维度和事实表之间的正确关系</a>。因为，如果您依赖于日期维度和事实数据表之间的“正常”关系，数据将根据日期选择进行筛选，日期选择充当这两个表之间的关系。</p><p id="c7da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们前往Power BI Desktop，看看是否可以做些什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/48d9ab3cae6dfdcad5f4260f634df5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgFDPW3-luoFOVFVSRhydw.png"/></div></div></figure><p id="a6ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如您在上面的模型视图中所看到的，DimDate和FactOnlineSales与DateKey列相连接。因此，只要我在切片器中选择日期，我的条形图就只显示那些由切片器选择过滤的值，如下面的屏幕截图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/fc1481a88d8203110e866b7178a4a553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MgGvKC-M9f_IObvrKTYs_w.png"/></div></div></figure><p id="7286" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里的主要问题是:我们如何“覆盖”从日期切片器传递的值。</p><h2 id="a98d" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">解决方案的关键</h2><p id="1270" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">这里的关键是断开日期维度和事实表之间的“常规”关系。我们需要一个独立的，不连续的日期表，这将有助于定义我们需要在条形图视觉显示值的时间框架。</p><p id="6963" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我将使用以下定义创建一个新表:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="28de" class="lr ls it mw b gy na nb l nc nd">Dates = DISTINCT(FactOnlineSales[DateKey])</span></pre><p id="fd85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将包括事实表中的所有日期。该表与我们的事实表保持断开，正如您在模型视图中看到的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ne"><img src="../Images/11794080a22558fb374c301993b50678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dg2_IqWaEt3E3S5hb76dNA.png"/></div></div></figure><p id="27bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们创建一个新的度量，它将计算我们指定的日期内的销售额:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="f8af" class="lr ls it mw b gy na nb l nc nd">Sales Amt = <br/>         VAR MaxDate = MAX(Dates[DatesDateKey])<br/>         VAR MinDate = CALCULATE(MIN(Dates[DatesDateKey]),<br/>                                ALLEXCEPT(Dates,Dates[DatesDateKey])<br/>                                )<br/>            VAR SalesAmt = CALCULATE(SUM(FactOnlineSales[SalesAmount]),<br/>                              FILTER(FactOnlineSales,FactOnlineSales[DateKey] &gt;= MinDate &amp;&amp; FactOnlineSales[DateKey] &lt;= MaxDate))<br/>            RETURN<br/>            SalesAmt</span></pre><p id="7c52" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在这里所做的基本上如下:我们正在定义一个变量，该变量将选择最后选择的日期(MaxDate)。然后，我们定义我们的起点:在这种情况下，它将在日期表中找到第一个日期，用<em class="nf"> ALLEXCEPT </em>函数覆盖现有的过滤器上下文。最后，我们使用<em class="nf">过滤器</em>函数计算SalesAmt值，以便根据变量中设置的日期限制时间范围。在我们将新的度量拖到条形图视觉效果后，我们将得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/8a3b82437f7d26d8f9229816ec9ab43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEGKbJb33QfUWMVEG7y8hw.png"/></div></div></figure><p id="807f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，如果我选择2008年的第4季度，我将看到从开始(事实表中的第一个日期值)到所选期间的所有值。如果我选择2009年第3季度，我将得到以下值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/6e54a24f2052deebbf50e3bcf93f5458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7yN5_k7u_RzQcI5dJdt9g.png"/></div></div></figure><p id="8732" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很酷吧，哈？</p><h2 id="de8a" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">微调我们的解决方案</h2><p id="4629" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">但是，如果我们只需要查看所选日期年初以来的值，或者所选日期之前12个月的值，该怎么办呢？</p><p id="1ff9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">断开连接的表保持不变，因为，别忘了，它是解决这个问题的关键要素。我们将稍微改变一下计算销售额的方法。</p><p id="1a06" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果要查看年初以来的所有值，可以像这样调整measure:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="3c24" class="lr ls it mw b gy na nb l nc nd">Sales Amt StartYear = <br/>        VAR MaxDate = MAX('Dates'[DatesDateKey])<br/>        VAR MinDate = STARTOFYEAR('Dates'[DatesDateKey])<br/>        VAR Result = CALCULATE(<br/>                            SUM(FactOnlineSales[SalesAmount]),<br/>                            FILTER(FactOnlineSales,<br/>                                FactOnlineSales[DateKey] &gt;=MinDate &amp;&amp; FactOnlineSales[DateKey]&lt;=MaxDate)<br/>        )<br/>        RETURN<br/>        Result</span></pre><p id="647f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以，唯一的区别是MinDate变量的定义。这里，我们使用DAX函数<em class="nf"> STARTOFYEAR </em>来获取所选日期的第一个日期。</p><p id="7754" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一个选项使您能够查看您根据需要定义的尾随期间:以下示例显示了过去12个月，但您可以轻松地修改它:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="b8fa" class="lr ls it mw b gy na nb l nc nd">Sales Amt -12 Months = <br/>        VAR MaxDate = MAX('Dates'[DatesDateKey])<br/>        VAR MinDate = DATE(YEAR(MaxDate),MONTH(MaxDate)-12,DAY(MaxDate))<br/>        VAR Result = CALCULATE(<br/>                            SUM(FactOnlineSales[SalesAmount]),<br/>                            FILTER(FactOnlineSales,<br/>                                FactOnlineSales[DateKey] &gt;=MinDate &amp;&amp; FactOnlineSales[DateKey]&lt;=MaxDate)<br/>        )<br/>        RETURN<br/>        Result</span></pre><p id="a468" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，唯一的区别在于起点的定义。通过组合<em class="nf">日期</em>和<em class="nf">月份</em>函数，我们告诉我们的度量我们想要计算过去多长时间。在这种情况下，它是-12个月，但您也可以使用年、季度、天作为标准。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/0f91aebe9874d8e55fceafb10efe29a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azhw4X8rSa5BemKq9rVd2g.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">年初的例子</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/47aee17cafceaee715adb35bb145b130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7z4e_igC5ZIQfLK8lQwxtg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">-12个月的示例</p></figure><h2 id="4dd5" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">结论</h2><p id="3f3d" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">正如您所看到的，我们可以使用一些非标准的技术来覆盖过滤器的常规行为，比如创建定制的非连接表。</p><p id="d8de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p><p id="ab76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读Medium上的每一个故事！</a></p></div></div>    
</body>
</html>