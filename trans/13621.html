<html>
<head>
<title>An End-To-End Time Series Data Science Project That Will Boost your portfolio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个端到端的时序数据科学项目，将提升您的投资组合</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-end-to-end-time-series-data-science-project-that-will-boost-your-portfolio-6086d0204189?source=collection_archive---------39-----------------------#2020-09-18">https://towardsdatascience.com/an-end-to-end-time-series-data-science-project-that-will-boost-your-portfolio-6086d0204189?source=collection_archive---------39-----------------------#2020-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="054e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">数据科学组合项目就像学习驾照实践考试，你不是在学习驾驶，而是在学习如何通过考试</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/590c5dbd903720b5c1d82082ce1e4419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkAykamy_tWurNCtS1jXkg.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由Pixabay拍摄</p></figure><p id="e006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">在本指南中，我想向您展示如何根据现实生活中的零售数据进行收入时间序列预测，为了完成这些任务，我将使用一个非常常见的库:Prophet，由脸书的科学家开发。</p><p id="c3ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为什么是先知？</strong></p><p id="67ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据先知GitHub页面:</p><blockquote class="me"><p id="dfa6" class="mf mg it bd mh mi mj mk ml mm mn lu dk translated"><em class="ki">“为具有线性或非线性增长的多重季节性时间序列数据生成高质量预测的工具”</em></p></blockquote><p id="6a51" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">而且，Prophet被集成到了<a class="ae mt" href="https://aws.amazon.com/forecast/" rel="noopener ugc nofollow" target="_blank"> AWS </a>生态系统中，成为时间序列分析最常用的库之一。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mu"><img src="../Images/2d2a35520cca1dbaf6c62ea5b5b77aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DeTQ0es57v4wGWE-yRDGMg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">来源:<a class="ae mt" href="https://facebook.github.io/prophet/docs/quick_start.html" rel="noopener ugc nofollow" target="_blank">脸书的Github </a></p></figure><h1 id="d21d" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">数据</h1><p id="9414" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">本教程中使用的数据来自一家零售公司，由于数据来源的业务性质，它具有很强的季节性。数据框已经被匿名化，它包含两列:交易的<code class="fe ns nt nu nv b">datetime</code>和交易的金额。</p><p id="4a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">交易出现在一天的不同时间，为了减少噪音，每天对数据进行重新采样，汇总总收入。</p><p id="0b28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，时间戳列已被转换为与CET时区相匹配，这样做的主要原因是能够以可理解的格式保存数据，使我们以及最终我们的客户更容易理解。以下是用于实现此目的的函数:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="a93f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">交易是在2018年6月至2019年10月期间收集的，它包含11284条销售记录。</p><p id="a36e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是让我们更深入地了解一下Prophet:根据脸书Prophet的文档，要放入Prophet的数据必须具有非常严格的格式:一个名为<code class="fe ns nt nu nv b">ds</code>的列表示时间点，另一个名为<code class="fe ns nt nu nv b">y</code>的列表示目标。</p><p id="02d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下代码片段很容易实现这一点:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b994" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一步，数据<strong class="lb iu">可能</strong>看起来准备好用于拟合模型，但是在绘制数据之后，必须进行一个非常重要的考虑:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/213b7795be6f1f8838bd45833412e470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tc275YuRIFVEB3wDQ2wycw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><p id="f19a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据似乎包含了一些看起来奇怪的值，非常极端的值，这些值会改变平均值:这是什么？</p><p id="8256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些观察值被称为异常值，异常值是与其他观察值显著不同的数据点，可能是由于测量中的一些误差造成的。</p><p id="f2a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据科学中，必须正确对待异常值，因为它们会严重误导分析和/或降低模型的质量。</p><p id="ef98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剔除异常值的一个很好且非常常用的策略是四分位间距(IQR)规则，通过查看低于Q1-1.5 IQR或高于Q3+ 1.5 * IQR的观测值，可以找到异常值。这可以用下面的语法在pandas中实现:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3d9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地理解发生了什么，方框图会很有帮助:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/52db3208cce344329bcc47992e67513f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWoON12jn6t9DKBB1VVp3A.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">在剔除异常值之前:显然有大量的异常值，这些是从顶部最大值中掉出的观察值。(自己阐述)</p></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/7feb47a2ed7b47e41f58c2da896bff3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qO3Krx6qg0z3ASvB-zH9SQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">剔除离群值后。(自己阐述)</p></figure><p id="7fb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，可以查看“干净”的数据集:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oa"><img src="../Images/26c3deb8839081869413d98fa1d6529c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xF4VjNMttj_cIKBBB9oB4g.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><p id="5c05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在构建机器(和深度)学习模型时，我们希望有一些指标来了解模型的表现，因此第一个拟合的模型是基线模型；该模型由Prophet提供的最基本的装配工组成，将用作衡量其他模型之间改进的基线。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模型被拟合并用于预测60天的窗口，并在第12天和第60天对其性能进行评估，以更好地了解短期和长期预测。</p><p id="cd1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程选择的评估模型的度量标准是MAE:平均绝对误差是一种用于测量预测中误差的平均大小的工具，它不考虑误差的方向，并且实际值和预测值之间的所有差异都具有相同的权重。</p><p id="7be0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MAE是这类任务的一个非常常见的指标，为了更深入的解释，我想提到这个<a class="ae mt" href="https://medium.com/human-in-a-machine-world/mae-and-rmse-which-metric-is-better-e60ac3bde13d" rel="noopener">帖子</a>。</p><p id="e27c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过绘制预测图可以看出，该模型以一种非常笨拙的方式捕捉了数据的趋势。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/62b10345105db9d5e26b798a325c5d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZklrrpTJw5DQmF4tJxhYw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><p id="6d86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是让我们检查一下MAE:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/8369ffb3b92c9a8faac8c8bb28ae12c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1V0WYJjbZ42Bv2N8sniC8A.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><p id="9ab4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个模型从第12天的MAE约为240开始，这意味着第1天的平均误差为240欧元(我们目标值的货币),而与60天的预测相比，误差达到450欧元。</p><p id="dd2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一点上，有可能更进一步，建立第二个模型，最终(并且有希望)能够胜过第一个模型；滚动prophet <a class="ae mt" href="https://facebook.github.io/prophet/docs/quick_start.html" rel="noopener ugc nofollow" target="_blank">文档</a>可以看到prophet有一个让用户按国家指定假日的方法。</p><p id="712c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假期是零售数据的一个非常好的预测指标，例如，想想圣诞节有多近，人们就会传统地争相寻找最完美的礼物。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="734b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个模型显示了一些改进，但是，该模型用拟合线上的一些奇怪尖峰来拟合数据:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/8265561e3d7c49cd29bb931718557a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*puZngvh42NljajUw2Jql_g.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/37292e1253a70e44e48353a6e6543b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYdWP9ygmGVo-JDPY1L_sA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><p id="1ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从图中可以看出，该模型从大约230的MAE开始，而在大约第60天达到360-370。因此，从短期来看，它往往是一个更好的模型，而从长期来看，它的表现略好于基线。</p><p id="f1fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">深入到Prophet文档中可以看到，通过指定周期的持续时间及其傅立叶阶，可以将自定义季节性添加到我们的模型中。</p><p id="6361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在尝试不同的自定义季节性时，我注意到数据每两个月就有一个增长趋势，这就是为什么我决定添加两个月的季节性成分:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="abd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模型不断更好地拟合数据，捕捉越来越多的季节性成分，这导致短期内的小幅度改善，而从长期来看，这种策略似乎并不奏效，从长期来看，最好的模型仍然是第二种。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/5d8f9b79b30b6630ba428620f4bef600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9S2SZxgo5UraZIAmcZZBg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/392cc7a1f243a43104aa39c27ee4c0a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lRtZNuaYoX9WkIGeItzEQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><p id="d5d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是怎样才能将长期误差降到最低呢？</p><p id="af0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经看到添加两个月的季节性项有助于捕捉一些趋势，这可能表明一个好的策略是添加更多的季节性项。它工作，但是…</p><p id="95ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是…要小心！添加大量季节性成分可能会导致强烈的过度拟合，这可以通过减少傅立叶项来部分避免，这不需要太深入，就可以使季节性“侵入性更小”。</p><p id="9df9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分别每一个月、两个月和三个月用三个自定义季节性来拟合最后一个模型，从长远来看会导致误差的显著减少，同时拟合线会稍微好一些:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/6b2f45ab8ce7fe2e8752bcc3742db6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fjsABh8NaKh4mm-bw73eAA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">(自己阐述)</p></figure><h1 id="83f7" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">结论</h1><p id="c091" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">从这个小指南中，可以推断出一个特定的模型在一个特定的时间范围内表现更好，而在另一个时间范围内可能表现很差。</p><p id="1937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常模型是在试错框架下训练的，换句话说:需要多次尝试才能获得可观的结果。这并不意味着只是随机尝试一切，而是更好地理解数据。</p><p id="30ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，数据来自时尚零售，时尚零售产品周期短，t恤(几乎)仅在夏季销售，套头衫仅在冬季销售，这就是为什么添加了不同的定制季节性术语。</p><p id="7c35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拟合时间序列模型可能是一项相当棘手的任务，部署阶段甚至可能更棘手，例如，考虑将模型部署到客户端:每次客户端希望获得一些预测时，模型都需要再次拟合，如果模型托管在一些云提供商上，您可以按需付费，费用可能会快速增长。</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><pre class="kk kl km kn gt ok nv ol om aw on bi"><span id="3f89" class="oo mw it nv b gy op oq l or os"><strong class="nv iu">I have a newsletter 📩.</strong></span><span id="f4bc" class="oo mw it nv b gy ot oq l or os">Every week I’ll send you a brief findings of articles, links, tutorials, and cool things that caught my attention. If tis sounds cool to you subscribe.</span><span id="be86" class="oo mw it nv b gy ot oq l or os"><em class="ou">That means </em><strong class="nv iu"><em class="ou">a lot</em></strong><em class="ou"> for me.</em></span></pre><div class="ov ow gp gr ox oy"><a href="https://relentless-creator-2481.ck.page/68d9def351" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd iu gy z fp pd fr fs pe fu fw is bi translated">5-bullet数据科学与技术📡</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">编辑描述</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">无情-创造者-2481.ck.page</p></div></div></div></a></div></div></div>    
</body>
</html>