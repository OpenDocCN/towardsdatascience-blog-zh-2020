<html>
<head>
<title>Dealing with Imbalanced dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理不平衡数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dealing-with-imbalanced-dataset-642a5f6ee297?source=collection_archive---------12-----------------------#2020-10-18">https://towardsdatascience.com/dealing-with-imbalanced-dataset-642a5f6ee297?source=collection_archive---------12-----------------------#2020-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="75a6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">处理不平衡数据的技术</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/58c81a68ae0f0ae208440c5f639e83f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUIIs0D85Ax_FPx8Eeqrig.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自<a class="ae kv" href="https://unsplash.com/photos/qEG6w8vqsaU" rel="noopener ugc nofollow" target="_blank">菲德尔·费尔南多</a>，来自Unsplash</p></figure><p id="4473" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现实问题中的不平衡数据集并不罕见。通俗地说，不平衡数据集就是类分布不均衡的数据集。不平衡的数据会在分类任务中产生问题。在深入研究不平衡数据的处理之前，我们应该知道不平衡数据集可能产生的问题。</p><p id="3189" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将以一个信用卡欺诈检测问题为例，来理解不平衡的数据集以及如何以更好的方式处理它。</p><p id="3463" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">示例—信用卡欺诈检测</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/92c2dcb29a013948b7618a1f6ce57541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nm0-a_bUXXZtpn-I4t_Ig.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://www.pexels.com/photo/working-macbook-computer-keyboard-34577/" rel="noopener ugc nofollow" target="_blank">负空间</a>拍摄，来自Pexels</p></figure><p id="a7fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">信用卡欺诈检测的数据集取自Kaggle。该数据集包含两天内发生的交易，其中</p><p id="869b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据中的总交易数= 284，807</p><p id="7772" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据有两类:<strong class="ky ir"> 0 </strong>和<strong class="ky ir"> 1 </strong>分别代表合法交易和欺诈交易。绘制等级分布图将使我们对不平衡(如果存在的话)有所了解。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/73ac7e7f0ba76e7c3fb51ff45c8f9181.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*BPkNzDlVT899ri9Y0HUdFw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d4ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">合法交易总数为284807笔中的284315笔，占<strong class="ky ir"> 99.83%。</strong>欺诈交易在整个数据集中只有492笔(<strong class="ky ir"> 0.17% </strong>)。不平衡的数据集可能出现在其他场景中，如癌症检测，其中大量受试者为阴性，只有少数人患有癌症。</p><h2 id="e3d7" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">不平衡数据集可能造成的问题</h2><p id="af1e" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">如果我们使用准确性作为性能指标，这可能会产生一个巨大的问题。假设我们的模型预测每个交易都是合法的(哑模型)。在信用卡数据集上使用准确性度量将给出99.83%的准确性，这是非常好的。<strong class="ky ir">是好结果吗？否</strong></p><p id="a36f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于不平衡数据集，应使用其他性能指标，如精确召回AUC分数、F1分数等..而且，模型会偏向多数阶级。由于大多数机器学习技术都被设计为能够很好地处理平衡的数据集，因此我们必须从不平衡的数据集创建平衡的数据。<strong class="ky ir">怎么做？</strong></p><p id="4204" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>在改变数据集之前，我们必须将数据集分为训练和测试，因为改变只是为了训练。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="af46" class="lu lv iq mt b gy mx my l mz na">&gt;&gt;&gt;from sklearn.model_selection import train_test_split<br/>&gt;&gt;&gt;X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.33, <br/>random_state = 2, shuffle = True, stratify = y)</span></pre><p id="ebe5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">训练数据集的形状:<br/> <strong class="ky ir"> 0: 190430事务<br/> 1: 330事务</strong></p><p id="ef61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在本文中讨论从不平衡数据创建平衡数据集的三种方法:</p><ul class=""><li id="4da0" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><strong class="ky ir">欠采样</strong></li><li id="2ddf" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><strong class="ky ir">过采样</strong></li><li id="e8c0" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><strong class="ky ir">创建合成数据</strong></li></ul><h2 id="fb86" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">1.欠采样</h2><p id="a23c" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">欠采样对数据中的多数类点进行重采样，使其等于少数类点。我们将使用欠采样从原始数据集创建一个新的数据集。我们将对信用卡欺诈检测中的合法交易(数量为190490)进行随机抽样，以使0类数据点等于330(少数类)。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="c87f" class="lu lv iq mt b gy mx my l mz na">&gt;&gt;&gt;from imblearn.under_sampling import RandomUnderSampler<br/>&gt;&gt;&gt;rus = RandomUnderSampler(random_state=0)<br/>&gt;&gt;&gt;X_resampled_under, y_resampled_under =rus.fit_resample(X_train, y_train)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/72f5deda42fc8850d39ca3a75ff93356.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*c2PhKHjBB1-X9kRUa8_5RQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="453a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">欠采样的主要缺点是我们没有使用大量的数据，其中包含一些信息<strong class="ky ir">。在我们的示例中，我们删除了190160(190490–330)个数据点。</strong>因此，我们在丢失信息，结果，我们不会得到显著的结果。</p><p id="945e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过使用一种称为过采样而不是欠采样的技术来避免这种情况。</p><h2 id="bfe0" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">2.过采样</h2><p id="b857" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">过采样是指对少数类点进行重采样，使其等于多数点的总数。少数类点的重复是一种这样的过采样技术。</p><p id="7720" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了重复之外，我们可以向两个类提供类权重。给少数类提供大的权重将会给出与复读相同的结果。</p><h2 id="c282" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">3.创建合成数据</h2><p id="71ca" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">重复数据的问题是它不提供任何额外的信息。增加数据信息的一种方法是创建合成数据点。一种这样的技术是<strong class="ky ir"> SMOTE(合成少数过采样技术)</strong>。顾名思义，SMOTE是一种过采样技术。通俗地说，SMOTE会为小众阶层创建合成数据点。它在少数阶级之间创造了新的实例。</p><p id="b483" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用<strong class="ky ir"> imblearn </strong>库对训练数据集应用SMOTE。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="291a" class="lu lv iq mt b gy mx my l mz na">&gt;&gt;&gt;from imblearn.over_sampling import SMOTE<br/>&gt;&gt;&gt;sm = SMOTE(random_state = 42)<br/>&gt;&gt;&gt;X_train_new, y_train_new = sm.fit_sample(X_train, y_train)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/bda3eb6cfbab9a4156514edd09e6ed8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*22VoOh0eiok_Ga8TMbc9Tg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="3844" class="nr lv iq bd lw ns nt nu lz nv nw nx mc jw ny jx mf jz nz ka mi kc oa kd ml ob bi translated">结论</h1><p id="c401" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">在处理现实世界的场景时，不平衡的数据集非常常见。如果机器学习模型出于训练目的而使用不平衡的数据集，则该模型是不健壮的。因此，平衡数据集是训练机器学习模型的首选。欠采样、过采样和SMOTE等技术可用于创建平衡数据。</p><p id="70da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>