<html>
<head>
<title>How to use R in Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Colab中使用R</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-r-in-google-colab-b6e02d736497?source=collection_archive---------1-----------------------#2020-11-04">https://towardsdatascience.com/how-to-use-r-in-google-colab-b6e02d736497?source=collection_archive---------1-----------------------#2020-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1801" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">GOOGLE COLAB | RSTATS |笔记本</h2><div class=""/><div class=""><h2 id="7b28" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">并使用来自您的驱动器和BigQuery的数据</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/5badaaea91e77e00e3d36be5ba860a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-UZzcgDlNJpLndIW"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">安妮·斯普拉特在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="101d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Colab，或<a class="ae lh" href="https://colab.research.google.com/notebooks/intro.ipynb#" rel="noopener ugc nofollow" target="_blank"> Colaboratory </a>是Google(主要)提供的一个交互式笔记本，用于通过浏览器编写和运行Python。我们可以在Colab中执行数据分析，创建模型，评估这些模型。这个过程是在谷歌拥有的云中服务器上完成的。我们只需要一个浏览器和一个相当稳定的互联网连接。</p><p id="3fa4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">无论是作为学生、专业人士还是研究人员，Colab都是促进我们工作的一个很好的替代工具。</p><p id="213f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然Colab主要用于Python中的编码，但显然我们也可以将其用于R ( <a class="ae lh" href="https://twitter.com/hashtag/rstats" rel="noopener ugc nofollow" target="_blank"> #Rstats </a>)。</p><p id="d4c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章将告诉你如何在Google Colab中运行R，以及如何在R笔记本中挂载Google Drive或访问BigQuery。</p><h1 id="b4cf" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">在Colab中运行R有两种方法</h1><ul class=""><li id="89c1" class="mw mx it lk b ll my lo mz lr na lv nb lz nc md nd ne nf ng bi translated">第一种方法是在Python运行时使用rpy2包。这个方法允许您一起执行R和Python语法。</li><li id="79a7" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md nd ne nf ng bi translated">第二种方式是<em class="nm">实际上</em>在R运行时启动笔记本。</li></ul><h2 id="b405" class="nn mf it bd mg no np dn mk nq nr dp mo lr ns nt mq lv nu nv ms lz nw nx mu iz bi translated">如何在Colab中一起使用R和Python</h2><ol class=""><li id="a7ad" class="mw mx it lk b ll my lo mz lr na lv nb lz nc md ny ne nf ng bi translated">打开你最喜欢的浏览器。</li><li id="edb8" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md ny ne nf ng bi translated">创建新笔记本:<a class="ae lh" href="https://colab.research.google.com/#create=true" rel="noopener ugc nofollow" target="_blank">https://colab.research.google.com/#create=true</a>。</li><li id="6078" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md ny ne nf ng bi translated">通过执行该命令<code class="fe nz oa ob oc b">%load_ext rpy2.ipython</code>运行<em class="nm"> rmagic </em>。</li><li id="78f2" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md ny ne nf ng bi translated">之后每次要用R的时候，在每个单元格的开头加<code class="fe nz oa ob oc b">%%R</code>。</li></ol><p id="4ee2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过在单元格中执行以下命令来启动<a class="ae lh" href="https://rpy2.github.io/doc/latest/html/interactive.html" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> rmagic </em> </a>:</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="c2e1" class="nn mf it oc b gy oh oi l oj ok">%load_ext rpy2.ipython</span></pre><p id="ac69" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用<code class="fe nz oa ob oc b">%%R</code>执行<strong class="lk jd">细胞魔法</strong>。如果您希望在r中执行单元格中的所有语法，请使用此选项。注意，它必须放在单元格的开头。</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="6619" class="nn mf it oc b gy oh oi l oj ok">%%R<br/>x &lt;- seq(0, 2*pi, length.out=50)<br/>x</span></pre><p id="318e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些行将返回一个变量<em class="nm"> x </em>，并将其显示在单元输出上:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/6e4de41025ddd42f91c841c1c7ce1059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*-4p3mgYtZDsNmJJqW--1cQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片作者，x </p></figure><p id="90a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Use  【T3】  to execute <strong class="lk jd">线魔</strong>。如果您希望单元格中的一行在r中执行，请使用此选项。</p><p id="15d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是如何使用这一行魔法将R变量复制到Python中:</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="b3e0" class="nn mf it oc b gy oh oi l oj ok">x = %R x</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi om"><img src="../Images/46ff4a9173b2ae3417edad493ef4d293.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*i5lrar6g2LvqJBTtWyBx0A.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者的图像，通过使用line magic在R和Python之间传递变量，并在Python中显示x</p></figure><h2 id="39cf" class="nn mf it bd mg no np dn mk nq nr dp mo lr ns nt mq lv nu nv ms lz nw nx mu iz bi translated">如何在Colab中使用R</h2><p id="866d" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">要直接用R使用笔记本:</p><ol class=""><li id="8bbe" class="mw mx it lk b ll lm lo lp lr oq lv or lz os md ny ne nf ng bi translated">打开你最喜欢的浏览器。</li><li id="bd7c" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md ny ne nf ng bi translated">转到这个网址:【https://colab.research.google.com/#create=true】T2&amp;language = r，或者这个短网址【https://colab.to/r】T4</li></ol><p id="7c7d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">访问URL后，您将被带到一个新的Colab笔记本，默认标题为<em class="nm"> Unitled.ipynb </em>。</p><p id="a2f6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">乍一看，使用Python和R运行时的笔记本没有区别。然而，如果我们转到“运行时”设置，并选择“更改运行时类型”，我们将得到一个对话框，确认我们已经在R运行时。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/adfa1e8d4b03be5969489992afb74cc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*TU9u5MqdIop1rNxMZ36mxw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者、运行时-&gt;更改运行时类型的图像</p></figure><p id="77cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您还可以通过尝试将您的驱动器安装到笔记本上来确认您处于R运行时环境中。这样做，你会得到这样一个不幸的消息:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/9d233ded73f95a986cee1901f6df63ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*c23lwqK1NoEtOUN47CykNg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片，啊哦，我们不能安装我们的谷歌驱动器！</p></figure><p id="dfe1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">消息<em class="nm">“挂载您的Google Drive仅在托管Python运行时上可用。”</em>明确表示你不是在Python运行时。</p><p id="f3d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">恭喜你，你现在已经成功地在Colab中运行R了。可以通过输入<code class="fe nz oa ob oc b">R.version.string</code>打印出R版本来查看R版本。</p><p id="e4f1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，已经有几个对数据处理和数据可视化有用的包。可以通过运行<code class="fe nz oa ob oc b">print(installed.packages())</code>来检查。</p><p id="9e5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你在安装软件包时遇到问题，这篇文章可能会帮助你:</p><div class="ov ow gp gr ox oy"><a rel="noopener follow" target="_blank" href="/how-to-install-packages-in-r-google-colab-423e8928cd2e"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jd gy z fp pd fr fs pe fu fw jc bi translated">如何在R Google Colab中安装包</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">一些限制以及如何克服其中一些限制</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">towardsdatascience.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm lb oy"/></div></div></a></div><h1 id="2176" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">如何在Colab R运行时挂载Google Drive</h1><p id="323c" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">这应该很容易做到。我们只需要安装“googledrive”包并执行认证过程。</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="b28b" class="nn mf it oc b gy oh oi l oj ok">install.packages("googledrive")<br/>library("googledrive")</span></pre><p id="827c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安装包之后，我们需要对googledrive包进行认证和授权。您可以在此处阅读软件包文档:</p><div class="ov ow gp gr ox oy"><a href="https://googledrive.tidyverse.org/" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd jd gy z fp pd fr fs pe fu fw jc bi translated">Google Drive的界面</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">大多数函数都以前缀drive_开头。自动完成是你的朋友。目标是让驾驶人员感觉…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">googledrive.tidyverse.org</p></div></div><div class="ph l"><div class="pn l pj pk pl ph pm lb oy"/></div></div></a></div><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="c356" class="nn mf it oc b gy oh oi l oj ok"># authorize google drive</span><span id="04b4" class="nn mf it oc b gy po oi l oj ok">drive_auth(<br/>  email = gargle::<a class="ae lh" href="https://gargle.r-lib.org/reference/gargle_options.html" rel="noopener ugc nofollow" target="_blank">gargle_oauth_email</a>(),<br/>  path = NULL,<br/>  scopes = "https://www.googleapis.com/auth/drive",<br/>  cache = gargle::<a class="ae lh" href="https://gargle.r-lib.org/reference/gargle_options.html" rel="noopener ugc nofollow" target="_blank">gargle_oauth_cache</a>(),<br/>  use_oob = gargle::<a class="ae lh" href="https://gargle.r-lib.org/reference/gargle_options.html" rel="noopener ugc nofollow" target="_blank">gargle_oob_default</a>(),<br/>  token = NULL<br/>)</span></pre><p id="bdde" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不幸的是，在尝试认证时，过程并不顺利。相反，我们面对的是这样一条错误消息:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/19c870d80fd8ca311915b13de4ec1495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mE1MBdcVpIQCMBOCplJgA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片作者，错误:无法获得谷歌证书。</p></figure><p id="a624" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">显然，错误的发生是因为<em class="nm"> httr </em>包中的交互函数无法执行。</p><p id="58bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里有一个我们可以使用的变通办法，由<a class="ae lh" href="https://github.com/r-lib/httr/pull/634" rel="noopener ugc nofollow" target="_blank"> jobdiogene </a>的提供:<a class="ae lh" href="https://gist.github.com/jobdiogenes/235620928c84e604c6e56211ccf681f0" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/jobdiogenes/235620928 c84 e 604 C6 e 56211 CCF 681 f 0</a></p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="ebeb" class="nn mf it oc b gy oh oi l oj ok"># Check if is running in Colab and redefine is_interactive()<br/>if (file.exists("/usr/local/lib/python3.6/dist-packages/google/colab/_ipython.py")) {<br/>  install.packages("R.utils")<br/>  library("R.utils")<br/>  library("httr")<br/>  my_check &lt;- function() {return(TRUE)}<br/>  reassignInPackage("is_interactive", pkgName = "httr", my_check) <br/>  options(rlang_interactive=TRUE)<br/>}</span></pre><p id="a2b8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行完那行代码后，我们可以再次尝试验证Google Drive，现在它可以工作了！</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="4ce7" class="nn mf it oc b gy oh oi l oj ok">drive_auth(use_oob = TRUE, cache = TRUE)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/71d49526bf57b405f4efcceaff062894.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*LD27aFv5J8u7ratVOutHAA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图像，交互式验证对话框</p></figure><p id="5092" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您需要点击链接并授予包访问您的Google Drive的权限。在此之后，您应该能够将授权代码粘贴到代码字段中。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/c28919d7ae160b50ce7870cd2872384a.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*Yyc2K4GvxeVTYp_Fve3U7Q.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由作者提供，授予许可</p></figure><h1 id="1a6d" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">如何在Colab R运行时使用BigQuery</h1><p id="7f70" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">对于业务人员，或者更习惯使用R的研究人员，也许我们需要从公司拥有的BigQuery或公开可用的数据集检索数据。</p><p id="8768" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们有了解决方法，授权BigQuery并从那里检索数据就很简单了:</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="e220" class="nn mf it oc b gy oh oi l oj ok">install.packages("bigrquery")<br/>library("bigrquery")<br/>bq_auth(use_oob = TRUE, cache = FALSE)</span></pre><p id="2177" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用自定义查询从BigQuery提取数据:</p><pre class="ks kt ku kv gt od oc oe of aw og bi"><span id="40ad" class="nn mf it oc b gy oh oi l oj ok"># Store the project id<br/>projectid = "your-project-id"</span><span id="b74d" class="nn mf it oc b gy po oi l oj ok"># Set the query<br/>sql &lt;- "SELECT * FROM your_table"</span><span id="1753" class="nn mf it oc b gy po oi l oj ok"># Run the query<br/>project_query &lt;- bq_project_query(projectid, sql, use_legacy_sql = FALSE)</span><span id="9752" class="nn mf it oc b gy po oi l oj ok"># Download result to dataframe<br/>df &lt;- bq_table_download(project_query)</span></pre><h2 id="5a13" class="nn mf it bd mg no np dn mk nq nr dp mo lr ns nt mq lv nu nv ms lz nw nx mu iz bi translated">结论</h2><p id="2a33" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">这是我认为我能为数据社区做出的贡献。正如我前面提到的，除了Kaggle和RStudio Cloud之外，Google Colab为我们提供了学习或使用R的另一种选择。它们都是很好的平台，尤其是用于学习的时候；可以缩短初始设置(下载和安装R，以及安装包)的时间。尽管在Google Colab中使用R的方式有点混乱，并且还没有与Python运行时相同的服务，但最终，它仍然工作得很好。</p><p id="3577" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢阅读！</p><p id="64d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您有任何问题，请拨打<a class="ae lh" href="https://www.showwcase.com/adityawarmanfw" rel="noopener ugc nofollow" target="_blank"> Showwcase </a>联系我！</p></div></div>    
</body>
</html>