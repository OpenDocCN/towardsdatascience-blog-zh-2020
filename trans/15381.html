<html>
<head>
<title>Exploring Time Series Uber Movement Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索时间序列优步运动数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-time-series-uber-movement-data-2a74f53178dc?source=collection_archive---------33-----------------------#2020-10-22">https://towardsdatascience.com/exploring-time-series-uber-movement-data-2a74f53178dc?source=collection_archive---------33-----------------------#2020-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/be82da34d76bf027b32b84502b5e530f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_ytANhMEoq820p61"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">伦敦经济学院图书馆在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。在https://unsplash.com/photos/yzrdcOgEs6c<a class="ae kc" href="https://unsplash.com/photos/yzrdcOgEs6c" rel="noopener ugc nofollow" target="_blank">有售</a></p></figure><p id="9c59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">优步运动允许用户选择出发地和目的地区域，以查看司机在给定的一天或时间间隔内在全球多个城市从A到B的平均、下限和上限行驶时间。</p><p id="b2cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将深入研究这些数据的样子及其一些特征，讨论其中的一些问题，并开始讨论如何从时间序列预测的角度来看待这些数据。</p><p id="af60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，如果你想自己下载数据，优步只提供最长3个月的横截面数据。</p><p id="6561" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">幸运的是，在之前的一篇<a class="ae kc" rel="noopener" target="_blank" href="/how-i-built-time-series-data-out-of-cross-sectional-uber-travel-times-data-e0de5013ace2">帖子</a>中，我详细介绍了我是如何从他们网站上可下载的数据中创建时间序列数据的，所以如果您对从中生成时间序列数据感兴趣，可以查看一下。</p><p id="83c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，聊够了…让我们打开csv文件！</p><h1 id="0673" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建每个日期的时间旅行值</h1><p id="b7c1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们看看伦敦市的数据集。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/54ae29c4bc227e1358c913a4af4e21e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHvhKNbRCI082wVco3JPng.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">df.head()。由我来算。</p></figure><p id="360e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的数据集范围从2016年1月2日到2020年3月31日，由数十万或数百万行组成(伦敦有100多万行)，其中每个日期包含许多平均旅行时间(从出发地到目的地的每次旅行一个时间)。因此，我们必须首先平均所有的平均旅行时间。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="f9d4" class="mo lc iq mk b gy mp mq l mr ms"># Plot average travel time per date<br/>avg_times = df.groupby('Date')['MeanTravelTimeSeconds'].mean()</span></pre><p id="4b4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了一个Series对象，它包含每个日期的一个值，本质上是将“date”列作为我们的索引。</p><p id="303b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们开始策划吧。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/eb89eed23321a535ef0002b05e3c8ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hB2XcE8wdjNGwx0ibmozYg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">以秒为单位的平均旅行时间(包括2020年)。由我来算。</p></figure><p id="e01d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们马上看到了一个重复的模式，在第三季度末大幅下降，然后突然上升，然后在每年年底再次下降。</p><p id="fa8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以看到2020年2月之后出现非常陡峭和非典型的下降。这就是新冠肺炎·疫情的效果。因此，出于本文的目的，我们将在我们的avg_times系列中添加一个“[:-90]”，忽略2019年之后的所有值。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="02c7" class="mo lc iq mk b gy mp mq l mr ms"># Excluding values after 2019 (ignoring COVID-19 impact)<br/>avg_times = avg_times[:-90]</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/c896f3dea839f326cbb38f0a0174c23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_UUWs4Nhti8PFN5Xdg5NxA.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">以秒为单位的平均行程时间(不包括2020年)。由我来算。</p></figure><p id="cdab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那更好(好像什么都没发生)。</p><p id="a495" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们来看几个统计数据。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="ce9a" class="mo lc iq mk b gy mp mq l mr ms">avg_times.describe()</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/672d11d4c25e77180b2db4dc8bc2ba4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*4IaeNDvCY3HAT_DzAUhISQ.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">汇总统计数据。由我来算。</p></figure><p id="7cbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从伦敦最中心的区域到任何其他区域平均需要1840秒或30分钟。</p><p id="8b2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到，我们的最大值(2363秒或39分钟)比最小值(957秒或16分钟)离平均值的标准偏差更小，这意味着我们的数据是左偏的，或者较长的行程比较短的行程更集中。</p><p id="faf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了证实这一点，我们绘制了一个直方图。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="b30c" class="mo lc iq mk b gy mp mq l mr ms">ax = sns.distplot(avg_times, bins=65)<br/>ax.set(xlabel='Average Travel Times')</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2cfa054fed9a93b42c2f1f33e8dec3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*t3TsQkciiUMIeU4V1_aDgA.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">直方图和核密度估计器(KDE)。由我来算。</p></figure><p id="8526" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可能是由于市中心交通拥挤和/或更多的人前往远离起点的区域，而不是短途旅行。</p><p id="da00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么旅行的次数是多少？它们可能会对旅行时间的行为产生影响。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="57a1" class="mo lc iq mk b gy mp mq l mr ms">trip_count = df.groupby('Date')['MeanTravelTimeSeconds'].count()</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/3602e168e62cca432e7f4810c678d03a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6MpB18Fvoba5THSYObD1g.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">目标区域的数量。由我来算。</p></figure><p id="5263" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两幅图看起来非常相似。有了这个，我们就承认出行次数可以代表一个城市的整体交通状况。更多的汽车意味着更多的交通，更多的交通意味着更长的旅行时间。</p><p id="15c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两者之间似乎存在线性关系:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="22c7" class="mo lc iq mk b gy mp mq l mr ms">sns.jointplot(x=daily_trip_count, y=avg_travel_times, kind='hex')</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/6f0397aa10ae2e3d6a8c76497c01eb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*xbpVwUBJCs9ysFkNQJcCjA.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">联合阴谋。由我来算。</p></figure><p id="32c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">需要注意的是，上面的散点图并不严格代表<em class="my">出行次数</em>，而是代表<strong class="kf ir">在某一天有足够的出行次数让优步能够匿名化他们的数据</strong>的区域数量。然而，我们会不精确地互换使用目的地区域的数量和行程的数量。</p><h1 id="73f4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将伦敦比作一张唱片</h1><p id="92aa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">城市中目的地区域的地理分布面临着重大挑战。</p><p id="1b1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让优步的司机到达远离市中心的目的地，他们必须通过中间的一些区域，为各自的道路交通做出贡献。</p><p id="a83a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应对数据中这种限制的一个想法是进行某种地理空间加权，其中可以对行程持续时间和从目的地到出发地的距离之间的内在联系所产生的差异进行归一化。</p><p id="20eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种有趣的方法可能是使用整个城市中出行的地理空间概率密度。</p><p id="7510" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想象一个2D圆盘。如果你向圆盘表面投掷无限数量的飞镖，随机飞镖和圆盘中心之间的平均距离或预期距离是多少？</p><p id="9ea6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个距离，类似于我们在一个随机的目的地区域和原点之间的距离，描述为</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/dd5bea89dd51fb2f778b83e18fb8f982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*3g2yQYflMeG8qDf-yir8vg.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">来源:<a class="ae kc" href="https://medium.com/@chaturv3di/solving-problems-step-by-step-5a4d019f4486" rel="noopener"> Namit Chatuverdi </a></p></figure><p id="2c93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中E[Y]是从随机投掷的镖或点到圆盘中心的距离的期望值(或平均值)。</p><p id="fb22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在他的<a class="ae kc" href="https://medium.com/@chaturv3di/solving-problems-step-by-step-5a4d019f4486" rel="noopener">文章</a>中，Namit Chaturvedi巧妙地解释了方程式背后的逻辑，但对我们来说重要的是，我们的旅行时间散点图的轮廓不是100%准确，因为它没有捕捉旅行距离的影响。</p><p id="cd09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，以某种方式将上述等式应用于我们的数据，以找出如何对不同的起点-目的地对进行加权，可能会使距离对我们的平均旅行时间的影响标准化。</p><p id="eac7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但这是另一个话题了。</p><p id="0a5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对我们来说，旅行时间是所有旅行持续时间的简单算术平均值，无论距离远近。</p><h1 id="c5b8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">时间序列呢？</h1><p id="fce6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们远离可怕的二重积分，回到我们漂亮的图表上来。</p><p id="f081" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再来看30日均线。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="b931" class="mo lc iq mk b gy mp mq l mr ms">rolling_mean = avg_times.rolling(window=30).mean().plot()</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/c7c4d5fa80fe6dd2d028c6a358fb13f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kOBKJqhybdbjF4_cNv0FwA.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">行程时间的30天移动平均值(秒)。由我来算。</p></figure><p id="1468" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们的数据中包含的模式或<strong class="kf ir">季节性</strong>更加清晰可辨。</p><p id="459b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想要对数据建模并预测未来值，手头有哪些选择？</p><p id="88b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的数据有季节性，但年度季节性是我们唯一能观察到的吗？说到城市交通，假设人类也有每周一次的习惯似乎是合理的。并非每天都是一样的，但人们通常会为每周的流动性做计划。</p><p id="4fc7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们使用statsmodels Python包将时间序列分解为趋势、季节性和残差。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="c00b" class="mo lc iq mk b gy mp mq l mr ms">from statsmodels.tsa.seasonal import seasonal_decompose</span><span id="0337" class="mo lc iq mk b gy na mq l mr ms">decomposition = seasonal_decompose(avg_times, model='additive', period=365)<br/>trend    = decomposition.trend<br/>seasonal = decomposition.seasonal<br/>residual = decomposition.resid</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/fce453ccaeb46038435e37e4667f58c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wZcSpdlnYBiDQGfmGSu2gw.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">时间序列的趋势、季节性和残差分解。由我来算。</p></figure><p id="2550" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用365天的时间来确定年度趋势和季节性，并使用<strong class="kf ir">加法模型</strong>，因为我们不相信方差会随着水平(或均值)而增加。这是<em class="my">的一个</em>指示，表明我们的数据是<strong class="kf ir">平稳的</strong>，也就是说，不存在异方差，这由残差的分布图来证明。我们必须通过运行一个增强的Dickey-Fuller测试来检查平稳性。</p><h1 id="430e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">预测优步旅行时间</h1><p id="1b81" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">预测模型将在以后的文章中讨论，但是我们需要注意的是不同的模型处理不同的时间序列。</p><p id="9e3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些模型即使有季节性项，也只能捕捉一个季节性(如SARIMAX)。其他人甚至能够捕捉多个非整数季节性(如TBATS)。当然，除了提及机器学习方法，如LSTM(长短期记忆)神经网络或其变体。</p><p id="1bba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一次，我们将应用其中一个模型，解释为什么选择它而不是其他模型，并验证它在不同城市的表现。</p></div></div>    
</body>
</html>