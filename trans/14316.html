<html>
<head>
<title>Analyze global COVID 19 data with Choropleth maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Choropleth图分析全球COVID 19数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyze-global-covid-19-data-with-choropleth-maps-2636f4a454d0?source=collection_archive---------40-----------------------#2020-10-02">https://towardsdatascience.com/analyze-global-covid-19-data-with-choropleth-maps-2636f4a454d0?source=collection_archive---------40-----------------------#2020-10-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="54db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python中与Plotly和Folium的比较</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b4cac0918458276e69edef1eabccb64f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z99p4IV8jcvFpmNDUEmCEQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚当·尼西奥鲁克在<a class="ae ky" href="https://unsplash.com/s/photos/pandemic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8c26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">新冠肺炎无需介绍——它是最近席卷全球的传染病。那么，你有没有想过在过去的几个月里世界发生了怎样的变化？我们能想象几个月内不同国家的这种变化吗？</p><blockquote class="lv lw lx"><p id="8e65" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">太多的问题，但我们有一个简单的答案——我们可以很容易地使用Choropleth地图，我会用最少的编码要求使它变得简单。</p></blockquote><p id="e12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以事不宜迟，让我们开始吧:</p><p id="f7dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是我们今天的议程:</p><ol class=""><li id="d791" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">什么是Choropleth地图</li><li id="a1be" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">叶子简介</li><li id="90da" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">使用叶绘制的Choropleth图</li><li id="527f" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">关于plotly的简介</li><li id="2be3" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">使用plotly绘制Choropleth地图</li><li id="3ed5" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">choropleth映射的一些限制</li></ol><h1 id="637c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">1.什么是Choropleth地图</h1><p id="7ec4" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Choropleth是基于统计变量或数据变量划分不同地理区域的地图或显示。这是一种专题地图，根据所考虑的变量和该变量在一个区域中所占的比例，对不同的区域进行着色。例如:考虑下面的图1，它显示了不同国家的人均GDP:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/e9247adb6ac1c671e96f6a475eab2bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBxF9txczYooKtKnB8NLrA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:人均GDP:作者图片</p></figure><p id="4b58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该地图使用与人均GDP相关的色阶来表示上图中的不同国家。</p><p id="d80a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，创建choropleth地图需要两件重要的事情:</p><p id="2136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">a)具有地理边界的地理空间数据，如geo json文件和</p><p id="6963" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">b)颜色编码的变量或数据点</p><h1 id="29ed" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">2.叶子简介</h1><p id="e029" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Folium是Python中的一个库，可用于可视化地理空间数据。fleed . js是一个用于创建地图的java脚本库，为了创建漂亮的交互式地图，它将fleed的功能与python的数据处理能力(即清理复杂的数据集并将其转换为简单的格式)相结合。</p><p id="02cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">follow有助于绑定数据以创建choropleth之类的地图，还支持HTML可视化的标记功能。</p><p id="b456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同的地图投影也可以像正交，自然地球等和不同的地图瓷砖像地图框，雄蕊调色剂等。</p><p id="497c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们考虑全局COVID 19数据集来创建choropleth图。您可以在参考资料中获得数据集链接。</p><h1 id="510e" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">3.使用叶绘制的Choropleth图</h1><p id="8fc4" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">a)首先，我们需要生成基本地图。以下代码可用于此:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="22df" class="nt mr it np b gy nu nv l nw nx">m = folium.Map(tiles = 'Stamen Terrain',min_zoom = 1.5)<br/>display(m)</span></pre><p id="9d91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将得到这样的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/c3ade53de8345dd95807d3bb1edc8f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OU7a2vByepwBppXV8IBVSw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:<a class="ae ky" href="https://medium.com/@krishnan.mythili" rel="noopener">作者</a>的底图</p></figure><p id="ef0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">b)我们必须从this <a class="ae ky" href="https://raw.githubusercontent.com/python-visualization/folium/master/examples/data" rel="noopener ugc nofollow" target="_blank">链接</a>获取地理数据，然后生成choropleth地图层，如下所示:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="fdca" class="nt mr it np b gy nu nv l nw nx">url = '<a class="ae ky" href="https://raw.githubusercontent.com/python-visualization/folium/master/examples/data'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/python-visualization/folium/master/examples/data'</a><br/>country_shapes = f'{url}/world-countries.json'</span><span id="d060" class="nt mr it np b gy nz nv l nw nx">folium.Choropleth(<br/>    geo_data = country_shapes,<br/>    min_zoom=2,<br/>    name='Covid-19',<br/>    data=df,<br/>    columns=['Country', 'Confirmed'],<br/>    key_on='feature.properties.name',<br/>    fill_color='OrRd',<br/>    nan_fill_color='black',<br/>    legend_name = 'Total Confirmed COVID cases',<br/>).add_to(m)<br/>m</span></pre><p id="e7ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">c)现在，我们将为具有该代码的每个国家添加带有确诊病例详细信息的标记。标记可以定制，我们在这里使用圆形标记:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="c11d" class="nt mr it np b gy nu nv l nw nx">def plotDot(point):<br/>    folium.CircleMarker(location = (point.latitude, point.longitude),<br/>                       radius = 5,<br/>                       weight = 2,<br/>                       popup = [point.Country, point.Confirmed, point.Recovered],<br/>                       fill_color = '#000000').add_to(m)</span><span id="173c" class="nt mr it np b gy nz nv l nw nx">covid_df.apply(plotDot, axis = 1)<br/>m.fit_bounds(m.get_bounds())<br/>m</span></pre><p id="067b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是带有已确认和已恢复病例标记的最终输出。我们可以将鼠标悬停在标记周围，按国家查看确诊和恢复病例的数量。在下图中，突出显示了印度的标记:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/6e2654d00684f3e92ce60f5d61f1c06d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuXu280GOwCKly8SOW5XRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:带有标记的Choropleth叶地图:作者提供的图片</p></figure><p id="3b4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用plotly创建一个类似的地图。</p><h1 id="77e0" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">4.关于plotly的简介</h1><p id="cc05" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Plotly是一个开源的Python可视化库。它也可以用来创建html可视化的伟大的动画。与leav一样，这些图形是交互式的，并带有动画特性。它构建在plotly.js之上，可视化也可以保存为图像。它还提供了许多定制和样式选项，实现非常简单。它还与dash兼容，这使得它很容易嵌入到博客或其他网络应用程序中。</p><blockquote class="lv lw lx"><p id="fa08" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">Dash是一个用于构建分析应用程序的开源框架，不需要Java脚本，并且与Plotly图形库紧密集成。点击了解更多<a class="ae ky" href="https://dash.plotly.com/" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="f8e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着更多的观察，plotly可能会导致性能问题。建议离线使用。</p><h1 id="c2bd" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">5.使用Plotly绘制Choropleth地图</h1><p id="9e6c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在让我们用plotly来构造choropleth图。这可以通过使用具有相同数据集的简单代码来实现，如下所示:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="a867" class="nt mr it np b gy nu nv l nw nx">fig = px.choropleth(df , locations = 'Country', locationmode = 'country names', color = 'Confirmed'<br/>                    ,animation_frame = 'Date')<br/>fig.update_layout(title_text = 'Global spread of Covid19')<br/>fig.show()</span></pre><p id="e2ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/852aad3c2bbbb2f6ae14fa140d143fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G4Q2VDDrwyo-DOKOz0q-rw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4: Plotly Choropleth地图(作者图片)</p></figure><p id="1962" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们可以看到按日期排列的动画窗格，它提供了几个月来确诊病例如何在不同国家传播以及病例增长率的视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动画冠状动脉分布图:数月来冠状病毒的全球传播(作者<a class="ae ky" href="https://medium.com/@krishnan.mythili" rel="noopener">作者</a></p></figure><p id="30cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地图的HTML可视化可以使用一行代码保存，您可以在这里访问地图的HTML版本<a class="ae ky" href="https://mythili7.github.io/" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="b045" class="nt mr it np b gy nu nv l nw nx">import plotly.offline as py</span><span id="69a1" class="nt mr it np b gy nz nv l nw nx"># html file<br/>py.offline.plot(fig, filename='C:/plotlyplots/Global_covid.html')</span></pre><h1 id="5fbd" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">总结:</h1><p id="ea5e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们今天学习了如何使用两个不同的python库来创建带有新冠肺炎数据的choropleth地图。Plotly在地图中通过简单的缩放、过滤和动画选项在该领域真正得分。但是，没有添加自定义标记的选项。叶尤其有助于choropleth和其他地图。自定义选项，如自定义弹出窗口、自定义平铺、标记和其他功能，使Folium成为一个可行的竞争者。此外，Folium是专为可视化地理空间数据而构建的，而Plotly的用途要广泛得多。</p><p id="5359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ly">Choropleth地图上最后几个字:</em></p><p id="d0bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Choropleth地图有利于整体观察，但一个国家/地区内的一些变化可能会被遗漏，因为它假设整个区域具有相同的值。很少有其他<strong class="lb iu"> <em class="ly">限制</em> </strong>为好，比如:</p><p id="4004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">a)使用绝对计数有时会产生误导，最好使用标准化的测量单位，如比例/比率</p><p id="5e47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">b)边界可能不连续，大面积可能会占据显示屏。</p><p id="8f3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">c)由于关于数据如何分类的分类问题，可能存在准确性问题。具有图形值的未分类choropleth图可以消除分类中的信息损失。</p><p id="91b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管有这些限制，但choropleth图仍是进行实证研究和地理空间分析的一种非常有用的方法。</p><p id="e6ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何问题，请联系我，并留下你的意见。</p><p id="773f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的代码可以在<a class="ae ky" href="https://github.com/Mythili7/Choropleth" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。</p><p id="3811" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以通过<a class="ae ky" href="https://medium.com/@krishnan.mythili" rel="noopener">媒体</a>、<a class="ae ky" href="https://www.linkedin.com/in/mythili-krishnan-94a5125" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae ky" href="https://twitter.com/KrisMythili" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系到我。</p><p id="a52b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly">参考文献</em> </strong>:</p><p id="c9df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[1] Jochen Schiewe，<a class="ae ky" href="https://link.springer.com/article/10.1007/s42489-019-00026-y" rel="noopener ugc nofollow" target="_blank">关于Choropleth地图中空间模式视觉感知的实证研究</a> (2019)，Springer</p><p id="4536" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2] Jeffrey S. Torguson，<a class="ae ky" href="https://onlinelibrary.wiley.com/doi/abs/10.1002/9781118786352.wbieg0951" rel="noopener ugc nofollow" target="_blank"> Choropleth地图</a> (2017)，威利在线图书馆</p><p id="fd16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]Robert G . Cromley和Ellen K Cromley，<a class="ae ky" href="https://ij-healthgeographics.biomedcentral.com/articles/10.1186/1476-072X-8-52" rel="noopener ugc nofollow" target="_blank"> Choropleth地图图例设计用于可视化社区健康差异</a> (2009年)，《国际卫生地理杂志》</p><p id="4c46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]<a class="ae ky" href="https://plotly.com/python/choropleth-maps/" rel="noopener ugc nofollow" target="_blank">Python中的Choropleth地图</a>，Plotly文档</p><p id="4392" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[4]<a class="ae ky" href="https://python-visualization.github.io/folium/quickstart.html" rel="noopener ugc nofollow" target="_blank">Python中的Choropleth地图</a>，leav文档</p><p id="67bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[5]约翰·霍普斯金大学，<a class="ae ky" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank">新冠肺炎数据集参考文献</a></p></div></div>    
</body>
</html>