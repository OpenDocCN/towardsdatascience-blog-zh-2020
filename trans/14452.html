<html>
<head>
<title>Building an Amazon-Like Recommendation Engine Using Slash GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Slash GraphQL构建类似亚马逊的推荐引擎</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-amazon-like-recommendation-engine-using-slash-graphql-9635f0ce49b1?source=collection_archive---------31-----------------------#2020-10-05">https://towardsdatascience.com/building-an-amazon-like-recommendation-engine-using-slash-graphql-9635f0ce49b1?source=collection_archive---------31-----------------------#2020-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4acb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">【TL；DR；开始使用Dgraph的Slash GraphQL产品，并连接到一个Spring Boot应用程序，它将充当一个简单的RESTful推荐服务。]</p><p id="1e49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">早在2000年代初，我就在做一个项目，实施一个由<a class="ae ko" href="https://en.wikipedia.org/wiki/Art_Technology_Group" rel="noopener ugc nofollow" target="_blank"> Art Technology Group </a> (ATG)开发的电子商务解决方案，该公司现在归甲骨文公司所有。ATG迪纳摩产品是一个令人印象深刻的解决方案，因为它包括持久层和<a class="ae ko" href="https://docs.oracle.com/cd/E24152_01/Platform.10-1/ATGPersBusinessGuide/html/s0102scenariosmodule01.html" rel="noopener ugc nofollow" target="_blank">场景模块</a>。当时，像Target和Best Buy这样的公司使用Dynamo解决方案，利用场景模块向客户提供建议。</p><p id="ba9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，Dynamo电子商务解决方案足够智能，可以记住客户何时将产品添加到购物车中，然后又将其删除。作为一种激励，场景服务器可以被设计为在未来的访问中向相同的客户提供适度的折扣，如果他们将产品重新添加到他们的购物车中并在接下来的24小时内购买它。</p><p id="02dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从那时起，我就一直想创建一个简单的推荐引擎，这也是我撰写这份出版物的目标。</p><h1 id="6056" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">关于建议示例</h1><p id="3659" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">我想保持简单，为推荐引擎创建一些基本的领域对象。在本例中，解决方案将为音乐艺术家提供推荐，底层艺术家对象非常简单:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="ddd6" class="mb kq it lx b gy mc md l me mf">@AllArgsConstructor</span><span id="b75c" class="mb kq it lx b gy mg md l me mf">@NoArgsConstructor</span><span id="53f6" class="mb kq it lx b gy mg md l me mf">@Data</span><span id="2cf4" class="mb kq it lx b gy mg md l me mf">public class Artist {</span><span id="54b9" class="mb kq it lx b gy mg md l me mf">  private String name;</span><span id="25c6" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="dcee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在一个真实的系统中，会有更多的属性需要跟踪。然而，在这个例子中，艺术家的名字就足够了。</p><p id="e69d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如人们所预料的，客户将对艺术家进行1到5分的评分，其中5分代表可能的最高分。当然，有可能(也在意料之中)客户不会给每个艺人打分。客户将(再次)由一个非常简单的客户对象表示:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="02a3" class="mb kq it lx b gy mc md l me mf">@AllArgsConstructor</span><span id="e18c" class="mb kq it lx b gy mg md l me mf">@NoArgsConstructor</span><span id="ccad" class="mb kq it lx b gy mg md l me mf">@Data</span><span id="ff5f" class="mb kq it lx b gy mg md l me mf">public class Customer {</span><span id="5039" class="mb kq it lx b gy mg md l me mf">  private String username;</span><span id="0786" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="3506" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">客户对艺术家进行评级的概念将在以下评级对象中得到体现:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="8b5f" class="mb kq it lx b gy mc md l me mf">@AllArgsConstructor</span><span id="7433" class="mb kq it lx b gy mg md l me mf">@NoArgsConstructor</span><span id="dbfa" class="mb kq it lx b gy mg md l me mf">@Data</span><span id="95a8" class="mb kq it lx b gy mg md l me mf">public class Rating {</span><span id="4f2f" class="mb kq it lx b gy mg md l me mf">  private String id;</span><span id="f0fa" class="mb kq it lx b gy mg md l me mf">  private double score;</span><span id="fd83" class="mb kq it lx b gy mg md l me mf">  private Customer by;</span><span id="59c6" class="mb kq it lx b gy mg md l me mf">  private Artist about;</span><span id="230d" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="e5e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我正常的Java编程工作中，我可能会对我的对象使用私人客户客户和私人艺术家艺术家，但是我想遵循图形数据库所使用的模式，在图形数据库中，我使用像‘by’和‘about’这样的变量..随着文章的继续，这一点会变得更加清楚。</p><h1 id="5228" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">图斜线图</h1><p id="b94f" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">随着图形数据库的流行，我觉得我创建推荐引擎的探索应该使用图形数据库。毕竟，GraphQL已经成为与服务讨论图形的流行语言。虽然我对图形数据库只有一些了解，但我的分析似乎得出结论，图形数据库是这个项目的正确选择，并且通常是现实世界中提供建议的服务的来源。当数据(节点)之间的关系(边)和数据本身一样重要时，图数据库是一个很好的解决方案，推荐引擎就是一个很好的例子。</p><p id="195e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，由于我刚刚开始使用图形数据库，我当然不想担心启动容器或在本地运行GraphQL数据库。相反，我想找到一个SaaS供应商。我决定使用Dgraph的完全托管后端服务，名为<a class="ae ko" href="https://dgraph.io/slash-graphql" rel="noopener ugc nofollow" target="_blank"> Slash GraphQL </a>。这是一个托管的本地GraphQL解决方案。Slash GraphQL服务于2020年9月10日刚刚发布，可以使用以下链接启用。该平台提供了一个适用于本文的免费试用版(然后移动到9.99美元/月的固定费用，最高5GB的数据)。</p><p id="1285" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">https://slash.dgraph.io/<a class="ae ko" href="https://slash.dgraph.io/_/billing" rel="noopener ugc nofollow" target="_blank"/></p><p id="979c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启动此URL后，可以使用常规授权服务创建新帐户:</p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/3daadd339ee77cc2599733a8f1824647.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/0*J9bGjRhDh0pchtLD"/></div></figure><p id="0c92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的例子中，我创建了一个名为“spring-boot-demo”的后端，最终产生了下面的仪表板:</p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/f68c4f49ef8fcb3fb5c681dc92e58684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JPEijVZ630voPCBb"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated"><em class="mu">斜线</em>T6】graph QL仪表盘</p></figure><p id="5fc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">开始的过程是快速和免费的，使得配置Slash GraphQL服务毫不费力。</p><h1 id="38a4" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">配置斜杠图表QL</h1><p id="a2c0" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">与任何数据库解决方案一样，我们必须编写一个模式并将其部署到数据库中。使用Slash GraphQL，这既快速又简单:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="b42a" class="mb kq it lx b gy mc md l me mf">type Artist {</span><span id="9e26" class="mb kq it lx b gy mg md l me mf">  name: String! @id @search(by: [hash, regexp])</span><span id="27c1" class="mb kq it lx b gy mg md l me mf">  ratings: [Rating] @hasInverse(field: about)</span><span id="9d74" class="mb kq it lx b gy mg md l me mf">}</span><span id="afca" class="mb kq it lx b gy mg md l me mf">type Customer {</span><span id="c55b" class="mb kq it lx b gy mg md l me mf">  username: String! @id @search(by: [hash, regexp])</span><span id="300d" class="mb kq it lx b gy mg md l me mf">  ratings: [Rating] @hasInverse(field: by)</span><span id="77d1" class="mb kq it lx b gy mg md l me mf">}</span><span id="7a8a" class="mb kq it lx b gy mg md l me mf">type Rating {</span><span id="81f7" class="mb kq it lx b gy mg md l me mf">  id: ID!</span><span id="68c6" class="mb kq it lx b gy mg md l me mf">  about: Artist!</span><span id="29d8" class="mb kq it lx b gy mg md l me mf">  by: Customer!</span><span id="8544" class="mb kq it lx b gy mg md l me mf">  score: Int @search</span><span id="dc6b" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="f2ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">事实上，我最初的设计比它需要的要复杂得多，而且修改背后的工作量也比我想象的要容易得多。我很快开始意识到作为一名开发人员不需要太多努力就能改变模式的价值。</p><p id="d59e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这个模式，我能够快速填充一些基本的艺术家信息:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="6701" class="mb kq it lx b gy mc md l me mf">mutation {</span><span id="bb6b" class="mb kq it lx b gy mg md l me mf">  addArtist(input: [</span><span id="29c2" class="mb kq it lx b gy mg md l me mf">    {name: “Eric Johnson”},</span><span id="7d7c" class="mb kq it lx b gy mg md l me mf">    {name: “Genesis”},</span><span id="8bdd" class="mb kq it lx b gy mg md l me mf">    {name: “Led Zeppelin”},</span><span id="5181" class="mb kq it lx b gy mg md l me mf">    {name: “Rush”},</span><span id="21d6" class="mb kq it lx b gy mg md l me mf">    {name: “Triumph”},</span><span id="93d1" class="mb kq it lx b gy mg md l me mf">    {name: “Van Halen”},</span><span id="1042" class="mb kq it lx b gy mg md l me mf">    {name: “Yes”}]) {</span><span id="b282" class="mb kq it lx b gy mg md l me mf">    artist {</span><span id="45e9" class="mb kq it lx b gy mg md l me mf">      name</span><span id="8b05" class="mb kq it lx b gy mg md l me mf">    }</span><span id="00f3" class="mb kq it lx b gy mg md l me mf">  }</span><span id="7186" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="b239" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同时，我添加了一些虚构的客户记录:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="2c4a" class="mb kq it lx b gy mc md l me mf">mutation {</span><span id="8ec9" class="mb kq it lx b gy mg md l me mf">  addCustomer(input: [</span><span id="d4a0" class="mb kq it lx b gy mg md l me mf">    {username: “Doug”},</span><span id="805d" class="mb kq it lx b gy mg md l me mf">    {username: “Jeff”},</span><span id="134c" class="mb kq it lx b gy mg md l me mf">    {username: “John”},</span><span id="b8af" class="mb kq it lx b gy mg md l me mf">    {username: “Russell”},</span><span id="cdeb" class="mb kq it lx b gy mg md l me mf">    {username: “Stacy”}]) {</span><span id="487f" class="mb kq it lx b gy mg md l me mf">    customer {</span><span id="2c83" class="mb kq it lx b gy mg md l me mf">      username</span><span id="7679" class="mb kq it lx b gy mg md l me mf">    }</span><span id="2ae2" class="mb kq it lx b gy mg md l me mf">  }</span><span id="e42a" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="b7a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，这五个客户将使用下表为七位艺术家提供评级:</p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/cf05c7f2b777ec1b46655173f56295f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/0*O0dmoKMhFccWlEMA"/></div></figure><p id="55a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">评级流程的示例如下所示:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f22d" class="mb kq it lx b gy mc md l me mf">mutation {</span><span id="ca4f" class="mb kq it lx b gy mg md l me mf">  addRating(input: [{</span><span id="9039" class="mb kq it lx b gy mg md l me mf">    by: {username: “Jeff”},</span><span id="3092" class="mb kq it lx b gy mg md l me mf">    about: { name: “Triumph”},</span><span id="9281" class="mb kq it lx b gy mg md l me mf">    score: 4}])</span><span id="24f1" class="mb kq it lx b gy mg md l me mf">  {</span><span id="6e78" class="mb kq it lx b gy mg md l me mf">    rating {</span><span id="c4fa" class="mb kq it lx b gy mg md l me mf">      score</span><span id="54b1" class="mb kq it lx b gy mg md l me mf">      by { username }</span><span id="dc8e" class="mb kq it lx b gy mg md l me mf">      about { name }</span><span id="8958" class="mb kq it lx b gy mg md l me mf">    }</span><span id="ad2e" class="mb kq it lx b gy mg md l me mf">  }</span><span id="e341" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="2426" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">配置并运行斜杠GraphQL数据后，我现在可以切换到Spring Boot服务了。</p><h1 id="91d1" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">斜率一评级算法</h1><p id="1075" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">2005年，丹尼尔·雷米尔和安娜·麦克拉钦的一篇研究论文介绍了Slope One系列的协同过滤算法。这种简单的基于项目的协作过滤看起来非常适合推荐服务，因为它考虑了其他客户的评级，以便对给定客户未评级的项目进行评分。</p><p id="de4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在伪代码中，推荐服务将实现以下目标:</p><ul class=""><li id="7ee9" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">检索所有艺术家的可用评级(由所有客户提供)</li><li id="a26c" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">从数据中创建一个地图<customer map="" double="">，这是一个客户地图，包含所有艺术家和他们的评级</customer></li><li id="f79c" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">1到5的评分将被转换为介于0.2(最差评分为1)和1.0(最佳评分为5)之间的简单范围。</li></ul><p id="c5dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建客户地图后，SlopeOne评级处理的核心将通过调用Slope One类来执行:</p><ul class=""><li id="ba60" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">填充用于跟踪不同客户评分差异的地图<artist map="" double=""/></li><li id="6507" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">填充地图<artist map="" integer="">&gt;用于跟踪相似评级的频率</artist></li><li id="90be" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">使用现有地图创建一个地图<customer hashmap="" double="">&gt;，其中包含未对给定客户评级的项目的预计评级</customer></li></ul><p id="6554" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本例中，随机选择了一个客户，并对Map <customer hashmap="" double=""> &gt; projectedData map中的相应对象进行分析，以返回以下结果:</customer></p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="3170" class="mb kq it lx b gy mc md l me mf">{</span><span id="12fb" class="mb kq it lx b gy mg md l me mf">  “matchedCustomer”: {</span><span id="b10c" class="mb kq it lx b gy mg md l me mf">    “username”: “Russell”</span><span id="e77b" class="mb kq it lx b gy mg md l me mf">  },</span><span id="34c2" class="mb kq it lx b gy mg md l me mf">  “recommendationsMap”: {</span><span id="677e" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Eric Johnson)”: 0.7765842245950264,</span><span id="9802" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Yes)”: 0.7661904474477843,</span><span id="3952" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Triumph)”: 0.7518039724158979,</span><span id="779c" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Van Halen)”: 0.7635436007978691</span><span id="1b37" class="mb kq it lx b gy mg md l me mf">  },</span><span id="7c58" class="mb kq it lx b gy mg md l me mf">  “ratingsMap”: {</span><span id="da0f" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Genesis)”: 0.4,</span><span id="7fe7" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Led Zeppelin)”: 1.0,</span><span id="a45f" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Rush)”: 0.6</span><span id="fbe6" class="mb kq it lx b gy mg md l me mf">  },</span><span id="3567" class="mb kq it lx b gy mg md l me mf">  “resultsMap”: {</span><span id="3c0f" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Eric Johnson)”: 0.7765842245950264,</span><span id="2cbb" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Genesis)”: 0.4,</span><span id="d22e" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Yes)”: 0.7661904474477843,</span><span id="0359" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Led Zeppelin)”: 1.0,</span><span id="e63b" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Rush)”: 0.6,</span><span id="9d15" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Triumph)”: 0.7518039724158979,</span><span id="3989" class="mb kq it lx b gy mg md l me mf">    “Artist(name=Van Halen)”: 0.7635436007978691</span><span id="7dd1" class="mb kq it lx b gy mg md l me mf">  }</span><span id="6761" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="19e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的例子中，“Russell”用户是随机选择的。在查看原始表格时，罗素只提供了《创世纪》、《齐柏林飞船》和《拉什》的评分。他唯一真正钦佩的艺术家是齐柏林飞船。该信息包含在ratingsMap对象和resultsMap对象中。</p><p id="f76f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">resultsMap对象包括其他四位艺术家的预计评分:埃里克·约翰逊、是的、黛安芬和范·海伦。为了使事情变得更简单，有效负载中包含了一个recommendationsMap，其中仅包含未被Russell评级的艺术家。</p><p id="00d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据其他评论，推荐服务将略微倾向于埃里克·约翰逊，得分为0.78，接近五分制中的四分。</p><h1 id="a75f" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">推荐服务</h1><p id="95bf" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">为了使用推荐服务，Spring Boot服务器只需要运行并配置为连接到Slash GraphQL基于云的实例。Slash GraphQL仪表板上的GraphQL端点可以在application.yml中指定为slash-graph-ql.hostname，或者通过＄{ Slash _ GRAPH _ QL _ HOSTNAME }环境变量传入值来指定。</p><p id="60ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可以使用以下RESTful URI调用基本建议引擎:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="1eac" class="mb kq it lx b gy mc md l me mf">GET — {spring-boot-service-host-name}/recommend</span></pre><p id="9f66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该操作由推荐控制器配置，如下所示:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="d4f8" class="mb kq it lx b gy mc md l me mf">@GetMapping(value = “/recommend”)</span><span id="e049" class="mb kq it lx b gy mg md l me mf">public ResponseEntity&lt;Recommendation&gt; recommend() {</span><span id="ab41" class="mb kq it lx b gy mg md l me mf">  try {</span><span id="0519" class="mb kq it lx b gy mg md l me mf">    return new ResponseEntity&lt;&gt;(recommendationService.recommend(), HttpStatus.OK);</span><span id="e4eb" class="mb kq it lx b gy mg md l me mf">  } catch (Exception e) {</span><span id="6492" class="mb kq it lx b gy mg md l me mf">    return new ResponseEntity&lt;&gt;(HttpStatus.BAD_REQUEST);</span><span id="2fa7" class="mb kq it lx b gy mg md l me mf">  }</span><span id="5e06" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="6163" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它调用推荐服务:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="2ee3" class="mb kq it lx b gy mc md l me mf">@Slf4j</span><span id="a2dc" class="mb kq it lx b gy mg md l me mf">@RequiredArgsConstructor</span><span id="98b0" class="mb kq it lx b gy mg md l me mf">@Service</span><span id="571e" class="mb kq it lx b gy mg md l me mf">public class RecommendationService {</span><span id="0f30" class="mb kq it lx b gy mg md l me mf">  private final ArtistService artistService;</span><span id="8a38" class="mb kq it lx b gy mg md l me mf">  private final CustomerService customerService;</span><span id="e5b9" class="mb kq it lx b gy mg md l me mf">  private final SlashGraphQlProperties slashGraphQlProperties;</span><span id="ce55" class="mb kq it lx b gy mg md l me mf">  private static final String RATING_QUERY = “query RatingQuery { queryRating { id, score, by { username }, about { name } } }”;</span><span id="ddb3" class="mb kq it lx b gy mg md l me mf">  public Recommendation recommend() throws Exception {</span><span id="204e" class="mb kq it lx b gy mg md l me mf">    ResponseEntity&lt;String&gt; responseEntity = RestTemplateUtils.query(slashGraphQlProperties.getHostname(), RATING_QUERY);</span><span id="702c" class="mb kq it lx b gy mg md l me mf">    try {</span><span id="20ad" class="mb kq it lx b gy mg md l me mf">      ObjectMapper objectMapper = new ObjectMapper();</span><span id="a494" class="mb kq it lx b gy mg md l me mf">      SlashGraphQlResultRating slashGraphQlResult = objectMapper.readValue(responseEntity.getBody(), SlashGraphQlResultRating.class);</span><span id="17d7" class="mb kq it lx b gy mg md l me mf">      log.debug(“slashGraphQlResult={}”, slashGraphQlResult);</span><span id="d31f" class="mb kq it lx b gy mg md l me mf">      return makeRecommendation(slashGraphQlResult.getData());</span><span id="7cf0" class="mb kq it lx b gy mg md l me mf">    } catch (JsonProcessingException e) {</span><span id="edd5" class="mb kq it lx b gy mg md l me mf">      throw new Exception(“An error was encountered processing responseEntity=” + responseEntity.getBody(), e);</span><span id="13a7" class="mb kq it lx b gy mg md l me mf">    }</span><span id="b598" class="mb kq it lx b gy mg md l me mf">  }</span><span id="affc" class="mb kq it lx b gy mg md l me mf">…</span><span id="e828" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="ce3a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意——快速浏览一下这段代码可能会忽略的一点是，能够拉出一个子图来执行推荐的功能和简易性。在上面的示例中,“slashGraphQlResult.getData()”行将子图提供给“makeRecommendation()”方法。</p><p id="2fb9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">RATING_QUERY是检索评级对象所需的斜杠GraphQL格式。RestTemplateUtils.query()方法是静态实用程序类的一部分，目的是保持干爽(不要重复):</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="33b8" class="mb kq it lx b gy mc md l me mf">public final class RestTemplateUtils {</span><span id="1718" class="mb kq it lx b gy mg md l me mf">  private RestTemplateUtils() { }</span><span id="51ab" class="mb kq it lx b gy mg md l me mf">  private static final String MEDIA_TYPE_GRAPH_QL = “application/graphql”;</span><span id="d312" class="mb kq it lx b gy mg md l me mf">  private static final String GRAPH_QL_URI = “/graphql”;</span><span id="29b7" class="mb kq it lx b gy mg md l me mf">  public static ResponseEntity&lt;String&gt; query(String hostname, String query) {</span><span id="c9f5" class="mb kq it lx b gy mg md l me mf">    RestTemplate restTemplate = new RestTemplate();</span><span id="30e3" class="mb kq it lx b gy mg md l me mf">    HttpHeaders headers = new HttpHeaders();</span><span id="cf25" class="mb kq it lx b gy mg md l me mf">    headers.setContentType(MediaType.valueOf(MEDIA_TYPE_GRAPH_QL));</span><span id="23c7" class="mb kq it lx b gy mg md l me mf">    HttpEntity&lt;String&gt; httpEntity = new HttpEntity&lt;&gt;(query,   headers);</span><span id="f539" class="mb kq it lx b gy mg md l me mf">    return restTemplate.exchange(hostname + GRAPH_QL_URI, HttpMethod.POST, httpEntity, String.class);</span><span id="2138" class="mb kq it lx b gy mg md l me mf">  }</span><span id="31ee" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="d54d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦检索到slashGraphQlResult对象，就会调用makeRecommendation()私有方法，该方法返回以下推荐对象。(上面以JSON格式显示了这一点):</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f3a6" class="mb kq it lx b gy mc md l me mf">@AllArgsConstructor</span><span id="eacb" class="mb kq it lx b gy mg md l me mf">@NoArgsConstructor</span><span id="ebb8" class="mb kq it lx b gy mg md l me mf">@Data</span><span id="3ce4" class="mb kq it lx b gy mg md l me mf">public class Recommendation {</span><span id="2e51" class="mb kq it lx b gy mg md l me mf">  private Customer matchedCustomer;</span><span id="0bea" class="mb kq it lx b gy mg md l me mf">  private HashMap&lt;Artist, Double&gt; recommendationsMap;</span><span id="01fb" class="mb kq it lx b gy mg md l me mf">  private HashMap&lt;Artist, Double&gt; ratingsMap;</span><span id="cf77" class="mb kq it lx b gy mg md l me mf">  private HashMap&lt;Artist, Double&gt; resultsMap;</span><span id="006e" class="mb kq it lx b gy mg md l me mf">}</span></pre><h1 id="2a31" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="2bc0" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在本文中，使用新的模式创建了一个Dgraph Slash GraphQL实例，并加载了示例数据。然后，Spring boot服务利用这些数据作为基本的推荐引擎。对于那些对完整源代码感兴趣的人，请查看<a class="ae ko" href="https://gitlab.com/johnjvester/slash-graph-ql" rel="noopener ugc nofollow" target="_blank"> GitLab资源库</a>:</p><p id="c04d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从成本角度来看，我对Slash GraphQL提供的结构印象颇深。新账户屏幕显示我每月有10，000信用点数可以免费使用。在我使用Slash GraphQL为本文构建原型和创建一切的整个过程中，我只使用了292个学分。对于那些需要超过10，000信用点的用户，每月45美元可获得100，000信用点，每月99美元可获得250，000信用点。</p><p id="7ce6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一次使用图形数据库确实呈现了一个小的学习曲线，我确信通过继续这个练习，我可以学到更多的东西。当我更多地了解我的需求时，我觉得Slash GraphQL改变模式的能力超出了我的预期。作为特性开发人员，这是应该认识到的一个非常重要的方面，尤其是与传统数据库的相同场景相比。</p><p id="0ab3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的下一篇文章中，我将在这个过程中引入一个Angular(或React)客户端，它将直接与GraphQL和运行在Spring Boot的推荐服务接口。</p><p id="57fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(经原作者许可发表，<a class="ae ko" href="https://www.linkedin.com/in/johnjvester/" rel="noopener ugc nofollow" target="_blank">约翰·维斯特</a></p></div></div>    
</body>
</html>