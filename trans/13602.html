<html>
<head>
<title>Python Bar Chart Race Animation: COVID-19 Cases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python条形图竞赛动画:新冠肺炎案例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bar-chart-race-animation-with-python-covid-19-cases-43655a47ed23?source=collection_archive---------20-----------------------#2020-09-18">https://towardsdatascience.com/bar-chart-race-animation-with-python-covid-19-cases-43655a47ed23?source=collection_archive---------20-----------------------#2020-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2e36" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/data-for-change" rel="noopener" target="_blank">变更数据</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/ceffd93f357458fdbd7dad0bb6d62ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FpiaRJz6Ii3XxYFWkx5IBg.gif"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">条形图比赛GIF</p></figure><p id="001e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">八个多月来，新冠肺炎已经摧毁了许多国家。100万病例已经得到证实，而且这个数字每天都在增加。</p><p id="41ff" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">感谢谷歌为我们公开和免费提供了Corona数据集。它使我们有可能做我们自己的与这个疫情相关的分析，例如，创建条形图比赛动画。数据存储在谷歌云平台上，可以在这里<a class="ae lj" href="https://console.cloud.google.com/bigquery?p=bigquery-public-data&amp;d=covid19_open_data&amp;page=dataset" rel="noopener ugc nofollow" target="_blank">访问</a>。</p><h1 id="b1dd" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak">收集数据</strong></h1><p id="24fa" class="pw-post-body-paragraph kl km iq kn b ko mi kq kr ks mj ku kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">首先在<code class="fe mn mo mp mq b">bigquery-public-data</code>数据集中找到名为<code class="fe mn mo mp mq b">covid19_open_data</code>的<a class="ae lj" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>表。</p><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mr"><img src="../Images/c07f75e4bd2d8a45bd1ee6b42753349c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EeAP3B5c3rzODspor7Kw7w.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">新冠肺炎数据集。<em class="mw">作者图片</em></p></figure><p id="2203" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">共45栏，逐日呈现各个国家(和地区)的电晕案例信息。您可以根据要进行的分析类型，专门选择要下载的数据。例如，我运行下面的SQL来检索日期、国家、地区和发生的案例数。</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="b655" class="nb ll iq mq b gy nc nd l ne nf">SELECT<br/>  date,<br/>  country_code,<br/>  country_name,<br/>  subregion1_name,<br/>  COALESCE(new_confirmed,0) AS new_confirmed,<br/>  COALESCE(new_deceased,0) AS new_deceased,<br/>  COALESCE(cumulative_confirmed,0) AS cumulative_confirmed,<br/>  COALESCE(cumulative_deceased,0) AS cumulative_deceased,<br/>  COALESCE(cumulative_tested,0) AS cumulative_tested<br/>FROM<br/>  `bigquery-public-data.covid19_open_data.covid19_open_data`</span></pre><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ng"><img src="../Images/3fe748ff0a0691fc0789891b3c752019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nOmUH9hAnINDbjacWYNhA.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">查询结果。<em class="mw">作者图片</em></p></figure><p id="088b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以将结果保存到。CSV文件，稍后使用Python打开它。</p><h1 id="e1b2" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">准备数据</h1><p id="aa8b" class="pw-post-body-paragraph kl km iq kn b ko mi kq kr ks mj ku kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">现在，让我们用Python来转换数据。首先要做的是打开Jupyter笔记本，然后导入必要的包来转换和可视化数据。之后，打开。csv文件并将其保存为DataFrame对象。</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="c20b" class="nb ll iq mq b gy nc nd l ne nf">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import matplotlib.ticker as ticker<br/>import matplotlib.animation as animation<br/>import numpy as np<br/>import matplotlib.colors as mcimport colorsys<br/>from IPython.display import HTML<br/>from datetime import datetime<br/>from random import randint</span><span id="7890" class="nb ll iq mq b gy nh nd l ne nf">df = pd.read_csv ('covid19-20200917.csv')</span></pre><p id="d7e0" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了利用数据，我们需要首先了解数据的特征。您可以通过查看数据类型和每一列的值来探索它。</p><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ni"><img src="../Images/7dad248d4b581cddcb901a73b68d7391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2c_Bfc3Xwgpc4EBqWDJRIQ.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><em class="mw">作者图片</em></p></figure><p id="042b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从上面的结果中，我们知道在<strong class="kn ja">国家代码</strong>和<strong class="kn ja">子区域1名称</strong>列中有空值。</p><p id="2c4f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">就我而言，分析的目的是创建一个从2020年初到去年8月每个国家确诊病例总数的条形图。我们可以依赖数据集中的三个主要列；<strong class="kn ja">日期</strong>、<strong class="kn ja">国家名称</strong>、<strong class="kn ja">累计确认</strong>。这些列没有空值，所以我们可以继续下一步。</p><p id="50c7" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">通过使用熊猫，总结每个国家每天的累计确认总数。然后，检查结果。例如，我使用<code class="fe mn mo mp mq b">2020-08-31</code>作为日期参数</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="f7aa" class="nb ll iq mq b gy nc nd l ne nf">df = pd.DataFrame(df.groupby(['country_name','date'])['cumulative_confirmed'].sum()).reset_index()</span><span id="48cb" class="nb ll iq mq b gy nh nd l ne nf">current_date = '2020-08-31'<br/>dff = df[df['date'].eq(current_date)].sort_values(by='cumulative_confirmed', ascending=False).head(15)</span></pre><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nj"><img src="../Images/4544ee2f1186108812d122dfa9e42337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zYTzl7WwkGQy0wrZS_T0g.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">8月确诊病例最多的15个国家。<em class="mw">作者图片</em></p></figure><h1 id="cf73" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">将数据可视化</h1><p id="bba5" class="pw-post-body-paragraph kl km iq kn b ko mi kq kr ks mj ku kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">然后，我们可以开始使用<a class="ae lj" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a>来可视化它。</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="ea17" class="nb ll iq mq b gy nc nd l ne nf">fig, ax = plt.subplots(figsize=(15, 8))<br/>sns.set(style="darkgrid")<br/>ax.barh(dff['country_name'], dff['cumulative_confirmed'])</span></pre><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nk"><img src="../Images/849870b94972145f163885a32abb9bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0tF4groEJO1qvW3bdSNow.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><em class="mw">作者图片</em></p></figure><p id="d9ad" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要创建条形图比赛动画，我们需要用某种颜色将每个国家分组。所以，不管国家的位置在哪里，看它的颜色还是可以追踪到的。</p><figure class="ms mt mu mv gt ka"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">主代码在。ipynb格式。由于美观的需要，这个特定的功能被分离到一个. py文件中。</p></figure><p id="19fc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这个方法的主要作用是给每个国家颜色，这个颜色是随机确定的。定义了颜色的变换方式后，我们就可以继续画柱状图了。</p><figure class="ms mt mu mv gt ka"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">主代码在。ipynb格式。由于美观的需要，这个特定的功能被分离到一个. py文件中。</p></figure><p id="5570" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在上面的方法中，我们对数据框中的数据进行了排序，因此只有每个日期确诊病例最多的15个国家将出现在条形图中。然后，我们给颜色的酒吧和它的属性。对于每个日期，我们提取要在条形右侧强调的月份名称。</p><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/a0a40ba7df4f8abb7a67c1bc1df6dac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAV1ts2cparZ4DprsSq9_A.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">条形图设计</p></figure><p id="537d" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果我们使用<code class="fe mn mo mp mq b">2020-08-31</code>作为日期参数，上面的图表就是draw_barchart方法的结果。你可以根据自己的喜好调整代码来装饰条形图。</p><p id="130b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">完成条形图设计后，我们需要做的就是定义将要出现在条形图动画范围内的日期。</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="306d" class="nb ll iq mq b gy nc nd l ne nf">dates=pd.Series(pd.to_datetime(df[‘date’].unique()))</span><span id="83d8" class="nb ll iq mq b gy nh nd l ne nf">dates=dates.where(dates &lt; ‘2020–09–01’)</span><span id="9454" class="nb ll iq mq b gy nh nd l ne nf">dates.dropna(inplace=True)<br/>dates = dates.astype(str)</span></pre><p id="5e9c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">就我而言，我排除了2020年9月之前的日期。日期范围如下所示:</p><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8448e207bd8b257c61bcb9804c1b7221.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*iIPNOYC3a6A1pMPeh5CCTA.png"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">日期范围。<em class="mw">作者图片</em></p></figure><p id="b116" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja">最后，</strong>我们到了神奇的部分，动画！我们可以利用<strong class="kn ja"> matplotlib.animation </strong>创建一个动画。</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="227f" class="nb ll iq mq b gy nc nd l ne nf">import matplotlib.animation as animation<br/>from IPython.display import HTML</span><span id="a41e" class="nb ll iq mq b gy nh nd l ne nf">fig, ax = plt.subplots(figsize=(15, 8 ))<br/>animator = animation.FuncAnimation(fig, draw_barchart, frames=dates)<br/>HTML(animator.to_jshtml())</span></pre><p id="ee08" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">瞧啊。这是结果。</p><figure class="ms mt mu mv gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/ceffd93f357458fdbd7dad0bb6d62ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FpiaRJz6Ii3XxYFWkx5IBg.gif"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">条形图竞赛</p></figure><p id="860f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要将动画保存为GIF格式，我们可以使用以下简单的代码行。</p><pre class="ms mt mu mv gt mx mq my mz aw na bi"><span id="8565" class="nb ll iq mq b gy nc nd l ne nf">animator.save('covid_til_august.gif', writer='Pillow')</span></pre></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="f321" class="lk ll iq bd lm ln nw lp lq lr nx lt lu lv ny lx ly lz nz mb mc md oa mf mg mh bi translated">结论</h1><p id="1f51" class="pw-post-body-paragraph kl km iq kn b ko mi kq kr ks mj ku kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">有很多方法可以处理数据，因为有很多工具可以支持我们。BigQuery帮助我们获取和查询数据，Pandas帮助我们转换和聚合数据，Matplotlib帮助我们可视化数据。尽管如此，仍有很大的探索空间。</p><p id="08bc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，您可以创建自己的条形图并进行自己的分析。你可以在这里看到<strong class="kn ja"> Jupyter笔记本</strong>文件<a class="ae lj" href="https://github.com/tazkianida/Covid/blob/master/covid_bar_chart_race.ipynb" rel="noopener ugc nofollow" target="_blank">的完整代码</a>。快乐尝试，保持健康！</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h2 id="c11d" class="nb ll iq bd lm ob oc dn lq od oe dp lu kw of og ly la oh oi mc le oj ok mg iw bi translated">参考</h2><p id="8a99" class="pw-post-body-paragraph kl km iq kn b ko mi kq kr ks mj ku kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">[1] P. Vardhan，用Matplotlib在Python中进行条形图竞赛(2019)，<a class="ae lj" href="https://pratapvardhan.com/blog/bar-chart-race-python-matplotlib/" rel="noopener ugc nofollow" target="_blank">https://medium.com/r/?URL = https % 3A % 2F % 2f pratapvardhan . com % 2f blog % 2f bar-chart-race-python-matplotlib % 2F</a></p><p id="1871" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">[2] G. Berardi，用Python创建平滑条形图竞赛(2020)，<a class="ae lj" href="https://www.datasciencecoffee.com/2020-smooth-bar-chart-race/" rel="noopener ugc nofollow" target="_blank">https://www . datasciencecoffee . com/2020-Smooth-Bar-Chart-Race/</a></p></div></div>    
</body>
</html>