<html>
<head>
<title>Single line distributed PyTorch training on AWS SageMaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS SageMaker上的单线分布式PyTorch培训</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/single-line-distributed-pytorch-training-on-aws-sagemaker-813df77530d8?source=collection_archive---------63-----------------------#2020-10-12">https://towardsdatascience.com/single-line-distributed-pytorch-training-on-aws-sagemaker-813df77530d8?source=collection_archive---------63-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b981" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何更快地迭代您的数据科学项目，让您的绝妙想法得以实现</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d1d3e5574e4aacc70efeca05a6fd6ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRuQu_bRWcJnXuCHEynQXA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="55ce" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不管我在做什么研究项目，拥有合适的基础设施总是成功的关键部分。很简单:假设所有其他“参数”都相同，迭代越快/越便宜，在同样的时间/成本预算下，可以获得更好的结果。由于这些总是有限的，良好的基础设施通常是取得突破的关键。</p><p id="f025" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">说到数据科学，特别是深度学习，在强大的硬件上轻松分布训练过程的能力是实现快速迭代的关键。即使是最聪明的想法也需要几次迭代才能得到完善和验证，例如检查不同的预处理选项、网络架构，以及批量大小和学习速率等标准超参数。</p><p id="1f7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我将向您展示在AWS SageMaker上使用<a class="ae lr" href="https://github.com/shiftan/simple_sagemaker" rel="noopener ugc nofollow" target="_blank"><em class="ls">simple-sage maker</em></a><em class="ls"/>分发现有的准备分发的PyTorch培训代码是多么容易(如果您愿意的话，还很便宜)(假设分发是在<a class="ae lr" href="https://sagemaker.readthedocs.io/en/stable/frameworks/pytorch/using_pytorch.html#distributed-pytorch-training" rel="noopener ugc nofollow" target="_blank">支持的gloo或nccl后端</a> ) <em class="ls">之上完成的)。</em>此外，您将了解如何在培训期间轻松地实时监控和分析资源利用率和关键培训指标。</p><h2 id="9d80" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">简单的sagemaker</h2><p id="2f99" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated"><a class="ae lr" href="https://github.com/shiftan/simple_sagemaker" rel="noopener ugc nofollow" target="_blank"> <em class="ls">简单——SageMaker</em></a>是围绕<a class="ae lr" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank"> AWS SageMaker </a>的薄包装器，这使得在<a class="ae lr" href="https://aws.amazon.com/sagemaker/pricing/" rel="noopener ugc nofollow" target="_blank">任何支持的实例类型</a> <strong class="kx ir">上的工作分配非常简单</strong>并且<strong class="kx ir">便宜</strong>。快速介绍可以在<a class="ae lr" rel="noopener" target="_blank" href="/a-very-simple-and-cheap-way-to-run-your-processing-job-on-the-cloud-c76af579f9e9">这篇博文</a>中找到。</p><h1 id="848f" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">在单行中分发PyTorch模型培训</h1><p id="65c3" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">我将基于PyTorch的官方ImageNet示例进行演示。事实上，我将只使用一个命令在AWS上运行它！</p><p id="be5a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更准确地说，我假设:</p><ol class=""><li id="7789" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">您已经安装了<a class="ae lr" href="https://github.com/shiftan/simple_sagemaker" rel="noopener ugc nofollow" target="_blank"><em class="ls">simple-sagemaker</em></a>:<br/><code class="fe nl nm nn no b">pip install simple-sagemaker</code></li><li id="5d08" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">您的AWS帐户凭证和默认区域是为boto3配置的，如<a class="ae lr" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html" rel="noopener ugc nofollow" target="_blank"> Boto3文档</a>中所述。</li><li id="eccb" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">ImageNet数据已经存储(和提取，稍后将详细介绍)在S3存储桶中，例如<code class="fe nl nm nn no b">s3://bucket/imagenet-data.</code></li><li id="87ee" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">您已经将训练代码<code class="fe nl nm nn no b"><a class="ae lr" href="https://raw.githubusercontent.com/pytorch/examples/master/imagenet/main.py" rel="noopener ugc nofollow" target="_blank">main.py</a></code>下载到当前工作目录。</li></ol><p id="192d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，要在单个p3.2xlarge实例上运行训练代码，只需运行以下命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ae07" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就这样，在培训作业运行时坐下来。实际上，您可能需要休息一下，因为在整个数据集(总共约120万张图像)上，10个时期需要约8小时。别急，训练好的模特到最后会在<code class="fe nl nm nn no b">output/state</code>下等你。</p><p id="4b0f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对<code class="fe nl nm nn no b">ssm</code>命令的一些解释:</p><ol class=""><li id="5428" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">shell</code> —运行一个shell任务。</li><li id="f357" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">-p imagenet -t 1-node</code> —命名项目和任务。</li><li id="80ae" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">-o ./output1 --download_state</code> —在训练结束时下载输出的本地路径+下载状态目录的请求(默认情况下也会下载日志)。</li><li id="f2e4" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">--iis</code> —使用来自<code class="fe nl nm nn no b">s3://bucket/imagenet-data</code>的imagenet数据作为映射到<code class="fe nl nm nn no b">$SM_CHANNEL_IMAGENET</code>路径的输入通道。</li><li id="13f5" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">--it ml.p3.2xlarge</code> —将实例类型设置为<code class="fe nl nm nn no b">ml.p3.2xlarge.</code></li><li id="ce85" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">-d main.py</code> —添加main.py作为依赖项。</li><li id="b010" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">-v 280</code> —将EBS卷大小设置为280 GB。</li><li id="c542" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">--no_spot</code> —使用按需实例而不是定点实例(默认)。更贵，但是时间是我们在努力节省的。</li><li id="ec35" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">--cmd_line</code>—执行培训脚本。</li></ol><p id="1d89" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一些注意事项:</p><ul class=""><li id="0e30" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nw ni nj nk bi translated">在<code class="fe nl nm nn no b">[Bucket name]/[Project name]/[Task name]</code>下，每个任务被分配一个专用的S3路径。<a class="ae lr" href="https://github.com/shiftan/simple_sagemaker#data-maintenance-on-s3" rel="noopener ugc nofollow" target="_blank">路径</a>下有几个目录，但是现在与我们相关的是<code class="fe nl nm nn no b">state</code>，它不断地与S3同步，并且在连续执行相同的任务时保持不变。</li><li id="5279" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nw ni nj nk bi translated">由于脚本在当前工作目录中保留了检查点，我们首先将它更改为state目录— <code class="fe nl nm nn no b">$SSM_INSTANCE_STATE</code></li><li id="5167" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nw ni nj nk bi translated">世界大小和节点等级是基于工作代码可访问的环境变量设置的。完整的列表可以在<a class="ae lr" href="https://github.com/shiftan/simple_sagemaker#worker-environment" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li><li id="a057" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nw ni nj nk bi translated"><code class="fe nl nm nn no b">--resume</code> —在训练停止的情况下，根据状态目录中保存的检查点恢复训练。</li><li id="c879" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nw ni nj nk bi translated">如果数据已经在您的本地机器上，您可以使用<code class="fe nl nm nn no b">-i</code>参数(而不是<code class="fe nl nm nn no b">--iis</code>)让它自动上传到S3，并用作“数据”输入通道。</li></ul><p id="6eee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有关更多信息和选项，例如，如果您需要定制docker映像或使用本地数据集进行培训，请阅读<a class="ae lr" href="https://github.com/shiftan/simple_sagemaker" rel="noopener ugc nofollow" target="_blank">文档</a>，运行<code class="fe nl nm nn no b">ssm shell -h</code>以获得命令行参数的帮助，和/或查看简介<a class="ae lr" rel="noopener" target="_blank" href="/a-very-simple-and-cheap-way-to-run-your-processing-job-on-the-cloud-c76af579f9e9">博客文章</a>。</p><p id="f011" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看<code class="fe nl nm nn no b">./output1/logs/log0</code>处输出日志的结尾:</p><pre class="kg kh ki kj gt nx no ny nz aw oa bi"><span id="8305" class="lt lu iq no b gy ob oc l od oe">* Acc@1 46.340 Acc@5 72.484<br/>Total time: 26614 seconds</span></pre><p id="d96e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们取得了46.3的前1名准确率和72.484的前5名准确率，总训练时间为26，614秒= ~7:23小时。总共8个小时的运行时间是由于开销，主要是由于下载(和提取)输入数据(~150 BG)。其中大约3-4分钟是由于“标准SageMaker开销”——启动和准备实例、下载输入数据和训练图像。在spot实例上训练时，这可能会变得有点长。</p><h2 id="1246" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">分发培训</h2><p id="0003" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">回到你的时间预算，8个小时对你来说可能太长了。如上所述，在某些情况下，这甚至意味着你的绝妙想法不会被公之于众。</p><p id="054c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，<a class="ae lr" href="https://github.com/pytorch/examples/tree/master/imagenet" rel="noopener ugc nofollow" target="_blank"> ImageNet示例</a>代码写得很好，并且可以通过在几个实例上分配培训来轻松加速。此外，这将只是一个额外的参数！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="256d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">又来了。将实例计数设置为3( <code class="fe nl nm nn no b">--ic 3</code>)就可以在3:51小时内完成同样的工作！</p><p id="720a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">查看输出日志<code class="fe nl nm nn no b">./output2/logs/log0</code>,我们看到在不到一半的训练时间内达到了相同的精度——11，605秒= ~3:13小时！</p><pre class="kg kh ki kj gt nx no ny nz aw oa bi"><span id="1723" class="lt lu iq no b gy ob oc l od oe">* Acc@1 46.516 Acc@5 72.688<br/>Total time: 11605 seconds</span></pre><h1 id="d5cf" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">监控和优化培训过程</h1><p id="d0fc" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">所以，你节省了时间，你的绝妙想法也更接近现实了。但是，如何轻松地观察和监控进展，使机会更高呢？</p><p id="d584" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，在<a class="ae lr" href="https://console.aws.amazon.com/sagemaker/home#/jobs" rel="noopener ugc nofollow" target="_blank"> SageMaker培训工作控制台</a>上查看，并选择<code class="fe nl nm nn no b">3-nodes</code>工作。这里应该可以得到关于它的所有可用信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/034def6f2b27f3c353bfbd9a393268d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJTqPk-HHDAjsC5ZgqT-hQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">培训工作信息</p></figure><p id="5bef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">那里有更多可用的信息，包括例如到州(检查站)的链接和S3的输出，请随意探索。</p><p id="8ced" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在最感兴趣的部分是“Monitor”部分，在这里您可以获得实例利用率(CPU、RAM、GPU、GPU内存、磁盘)和算法指标的图表(稍后将详细介绍)。</p><p id="a712" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">实例和算法指标的完整日志和动态CloudWatch图形系统的链接位于该部分的顶部，是进行分析的途径。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/c1f580cfaaeb307b5f04ee3c44819ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GTUpt8Yy4FIuxoZFFgLqrQ.png"/></div></div></figure><p id="635f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是两个培训周期的实例指标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/1ef09aa7be31a96ffccd962578bac9c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LEOFb7bAmC2agxwvDQ0nng.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/4af50599b10e20d7059c51af10d345c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*py2HsvBkXdd1vHrHBwS15A.jpeg"/></div></div></figure><p id="de1d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些图表会实时更新，可以让您确保一切按预期进行，以及是否有任何关键的瓶颈需要解决。</p><p id="4c45" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">经验法则是确保GPU负载大部分时间接近100%。以上图中的3个节点为例，可以看到GPU的负载仅为70%,这意味着我们可以从硬件中获得更多。一个好的猜测可能是有更多的数据加载工作线程，以更快地将数据推送到GPU。</p><h2 id="11ed" class="lt lu iq bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">算法度量</h2><p id="a043" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">为了进一步简化对培训过程的监控，我们可以使用<a class="ae lr" href="https://docs.aws.amazon.com/sagemaker/latest/dg/training-metrics.html" rel="noopener ugc nofollow" target="_blank"> SageMaker metrics </a>来实时获取特定于培训的指标。同样，我们只需要更新几个参数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c119" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nl nm nn no b">--md</code>用于定义指标，其中第一个参数是名称，例如<code class="fe nl nm nn no b">"loss"</code>，第二个参数是从输出日志中提取数值的正则表达式。</p><p id="8a4d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">快进一下，这是两个训练周期的算法指标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/b52fb6afa75b988bc516f6e5e7dff8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dI2Mr_0FyFRlX0JVu4P6AQ.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/ea123618aa8b2ac69ae6e67939a38c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrVCu-XF4AYkneedsDD5Tg.jpeg"/></div></div></figure><h1 id="6f87" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">完整的分布式ImageNet培训管道</h1><p id="6fd4" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">可以从<a class="ae lr" href="http://image-net.org/" rel="noopener ugc nofollow" target="_blank">image-net.org</a>网站下载<a class="ae lr" href="http://image-net.org/challenges/LSVRC/2012/ilsvrc2012.pdf" rel="noopener ugc nofollow" target="_blank"> LSVRC2012 ImageNet </a>数据。这里Google <a class="ae lr" href="https://cloud.google.com/tpu/docs/imagenet-setup#download_the_imagenet_dataset" rel="noopener ugc nofollow" target="_blank">描述的简单步骤</a>很有帮助。</p><p id="12ab" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于完整的数据集大约有120万张图片，总大小约为150GB，将其下载到本地，然后上传到S3水桶会花费很多时间。此外，在培训前将这么多文件从S3同步到培训实例也会非常慢。以下策略用于克服这些问题:</p><ol class=""><li id="e42e" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">使用专用的<em class="ls">处理</em>任务下载数据，配备更快的S3连接。</li><li id="c64c" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">S3的数据保持在1000年左右。tar文件，并在训练实例上提取，就在训练之前。</li></ol><p id="51bf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用下面的<code class="fe nl nm nn no b">ssm</code>命令可以轻松启动<em class="ls">处理</em>任务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0110" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中<code class="fe nl nm nn no b">download.sh</code>是一个bash脚本，它下载数据并把数据排列到它在第一个参数(<code class="fe nl nm nn no b">$SSM_OUTPUT/data</code>)上获得的路径。一旦该任务完成，带有<code class="fe nl nm nn no b">train</code>和<code class="fe nl nm nn no b">val</code>子文件夹的<code class="fe nl nm nn no b">data</code>目录被放置在任务专用S3路径<code class="fe nl nm nn no b">[Bucket name]/[Project name]/[Task name]</code>的<code class="fe nl nm nn no b">output</code>目录下。训练命令现在也应该更新了:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="fa13" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里引入了两个变化:</p><ol class=""><li id="d433" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">为了“链接”这两个任务，使处理任务的输出成为训练任务的输入，现在使用参数<code class="fe nl nm nn no b">--iit</code>代替<code class="fe nl nm nn no b">--iis</code>。这将<code class="fe nl nm nn no b">train</code>和<code class="fe nl nm nn no b">val</code>子文件夹映射到具有相同名称的输入通道，可通过<code class="fe nl nm nn no b">SSM_CHANNEL_TRAIN</code>和<code class="fe nl nm nn no b">SSM_CHANNEL_VAL</code>环境变量访问。</li><li id="6ddc" class="nc nd iq kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">shell脚本<code class="fe nl nm nn no b">extract.sh</code>用于在训练之前提取数据。</li></ol><p id="099d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<a class="ae lr" href="https://github.com/shiftan/simple_sagemaker/blob/master/examples/imagenet/run_remote.sh" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> simple-sagemaker </em>仓库</a>中可以找到下载数据和执行一些训练选项的完整管道。</p><h1 id="e853" class="mr lu iq bd lv ms mt mu ly mv mw mx mb jw my jx me jz mz ka mh kc na kd mk nb bi translated">摘要</h1><p id="02b6" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">简单的分布式模型培训设置是数据科学项目的必备工具。它现在触手可及，比您想象的更简单、更容易。利用它！</p></div></div>    
</body>
</html>