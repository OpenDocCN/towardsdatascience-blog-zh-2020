<html>
<head>
<title>What Makes Great Wine… Great?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">是什么造就了好酒…好酒？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-makes-a-wine-good-ea370601a8e4?source=collection_archive---------19-----------------------#2020-10-22">https://towardsdatascience.com/what-makes-a-wine-good-ea370601a8e4?source=collection_archive---------19-----------------------#2020-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="46d8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用机器学习和部分依赖图寻找好酒</h2></div><p id="1361" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不知道你怎么样，但我现在肯定想喝点酒。但不是一般的酒，而是好酒。品尝起来平衡、复杂而悠长的葡萄酒。很难说这些<em class="lb">实际上是什么意思</em>，Buzzfeed的这些家伙肯定很难用语言描述好酒。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="lh li l"/></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">BuzzFeed视频</p></figure><p id="af9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，<em class="lb">葡萄酒的复杂性和深度</em>是难以捉摸的概念。但是，如果我们能够用数字准确地描述是什么让葡萄酒如此令人愉快呢？</p><p id="9413" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇博文中，我会</p><ol class=""><li id="f9af" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ls lt lu lv bi translated">使用UCI葡萄酒质量数据集，定性解释葡萄酒的化学特性为何令人满意。</li><li id="3bf6" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated">解释如何使用<strong class="kh ir">部分相关图来解释葡萄酒的哪些化学特性是理想的。</strong></li><li id="7f53" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated">在数据集上建立机器学习模型。</li><li id="4634" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated">用python绘制并解释<strong class="kh ir">部分依赖图</strong>。</li></ol><p id="46bb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我做了一点研究，从一个化学家的角度观察了品酒的世界。</p><h1 id="32e0" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">1.用数据理解好酒</h1><h2 id="3d14" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">葡萄酒的什么化学特性使它令人向往？</h2><p id="f3b2" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">为了理解是什么造就了一款好酒，我使用了UCI【1】的<a class="ae nk" href="https://archive.ics.uci.edu/ml/datasets/wine+quality" rel="noopener ugc nofollow" target="_blank">葡萄酒质量数据集。该数据集包含了1599个葡萄酒样品的化学性质和口味测试结果。这项研究中的葡萄酒是葡萄牙Vinho Verde葡萄酒的红色和白色变种，尽管我在这篇文章中只使用红色变种的数据。</a></p><p id="53b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">葡萄酒由以下成分组成。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/e14292f06ec2de22a367056dfef48346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFSpzDQJK50ur8ilFN59mQ.png"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">葡萄酒的成分。作者插图</p></figure><ol class=""><li id="9ed6" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ls lt lu lv bi translated"><strong class="kh ir">酒精</strong>。葡萄酒通常含有5-15%的酒精。这就是让我们热爱葡萄酒的化合物。</li><li id="327d" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ls lt lu lv bi translated">酸:酸赋予葡萄酒独特的酸味。缺乏固定酸度的葡萄酒被认为是平淡的或松软的T21，这意味着它们的味道是单一的。葡萄酒中的酸度有两种来源。一种是天然存在于葡萄中的酸，用于发酵葡萄酒并带入葡萄酒中(固定酸<em class="lb"/>)。二、酵母或细菌发酵过程中产生的酸(<em class="lb">挥发性酸)。</em></li></ol><ul class=""><li id="0933" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ns lt lu lv bi translated">固定酸度。这些“固定酸”是不容易蒸发的酸。它们是<a class="ae nk" href="https://waterhouse.ucdavis.edu/whats-in-wine/fixed-acidity]" rel="noopener ugc nofollow" target="_blank">酒石酸、苹果酸、柠檬酸或琥珀酸，</a>它们大多来源于用来发酵葡萄酒的葡萄。</li><li id="f781" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ns lt lu lv bi translated">挥发性酸度。“挥发性酸”是在低温下挥发的酸。这些主要是醋酸，<a class="ae nk" href="https://rstudio-pubs-static.s3.amazonaws.com/57835_c4ace81da9dc45438ad0c286bcbb4224.html" rel="noopener ugc nofollow" target="_blank">能让酒尝起来像醋</a>。</li><li id="30a6" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ns lt lu lv bi translated">柠檬酸。柠檬酸被用作一种<a class="ae nk" href="https://www.randoxfood.com/why-is-testing-for-citric-acid-important-in-winemaking/" rel="noopener ugc nofollow" target="_blank">酸补充剂</a>，增加葡萄酒的酸度。</li></ul><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nt"><img src="../Images/c9859f7930d5566893a18792e8a58152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*owshvZ6BONVVBzXy"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">柠檬酸是水果中常见的天然酸。照片由<a class="ae nk" href="https://unsplash.com/@lee_jay_dee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莱斯利·戴维森</a>在<a class="ae nk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="4b54" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.<strong class="kh ir">残糖。</strong>发酵过程中，酵母消耗糖分产生酒精。<a class="ae nk" href="https://winefolly.com/deep-dive/what-is-residual-sugar-in-wine/" rel="noopener ugc nofollow" target="_blank">酵母发酵葡萄酒后剩下的糖量称为残糖。</a>不出所料，残糖越高，酒味越甜。另一方面，尝起来不甜的酒被认为是干的。</p><p id="8bfb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.<strong class="kh ir">含硫化合物。</strong>二氧化硫是酿酒中常用的化合物。它可以防止葡萄酒氧化和坏细菌的渗透，使其成为葡萄酒的神奇防腐剂。这些硫化合物可以进一步分为以下几种:</p><ul class=""><li id="0507" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ns lt lu lv bi translated"><em class="lb">游离二氧化硫。</em>当二氧化硫添加到葡萄酒中时，<a class="ae nk" href="https://www.terlatowines.com/knowledge/sulfur-dioxide-and-its-role-winemaking" rel="noopener ugc nofollow" target="_blank">只有35-40%以游离形式产生</a>。当以较大数量和较小批次添加时，可获得较高的游离SO2浓度。在其他条件不变的情况下，游离二氧化硫含量越高，防腐效果越强。</li><li id="5182" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ns lt lu lv bi translated"><em class="lb">固定二氧化硫。</em>游离SO2与葡萄酒中的微生物强烈结合，产生<em class="lb">固定</em> SO2。如果葡萄酒中固定二氧化硫含量很高，这可能意味着<a class="ae nk" href="https://www.awri.com.au/industry_support/winemaking_resources/fining-stabilities/microbiological/avoidance/sulfur_dioxide/" rel="noopener ugc nofollow" target="_blank">氧化或微生物腐败已经发生</a>。</li></ul><p id="3098" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 5。氯化物</strong>。葡萄酒中氯化物盐的含量。不同地理、地质和气候条件的<a class="ae nk" href="http://www.oiv.org/public/medias/2604/oiv-ma-d1-03.pdf" rel="noopener ugc nofollow" target="_blank">出产的葡萄酒会有所不同。例如，靠近海边的葡萄园生产的葡萄酒比远离海边的葡萄酒含有更多的氯化物。</a></p><h1 id="1c85" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">2.利用机器学习预测好酒</h1><h2 id="87e6" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated"><strong class="ak">如何用偏相关图解释预测的葡萄酒质量</strong></h2><p id="c0e7" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">有了对葡萄酒令人满意的原因的这种理解，我们可以建立一个机器学习模型，根据葡萄酒的化学性质来预测葡萄酒的高质量和低质量。机器学习模型的结果可以使用部分相关图来解释，部分相关图在机器学习模型的所有特征中“隔离”个体特征，并告诉我们个体特征如何影响葡萄酒质量预测。</p><blockquote class="nu nv nw"><p id="8ea9" class="kf kg lb kh b ki kj jr kk kl km ju kn nx kp kq kr ny kt ku kv nz kx ky kz la ij bi translated">M <!-- -->更正式地说，部分依赖图可视化了一个特性对机器学习模型预测结果的边际效应[2]。</p></blockquote><p id="607e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这似乎有点难以理解。我们从视觉上分解一下。</p><h2 id="6b9f" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">部分相关图的可视化指南</h2><p id="780a" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">想象一下，我们有一个经过训练的机器学习模型，它接受一些特征(酒精百分比、硫酸盐含量、pH值和密度)，并输出对葡萄酒质量的预测，如下所示。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi oa"><img src="../Images/3b9d864a5eda708c85ab314a0645fb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCEye_-kHGjjYEsZ8oSlOQ.png"/></div></div></figure><p id="1862" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们有以下表格格式的数据点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi ob"><img src="../Images/711ab00c3d9ad7fa18c8b5e779b1384a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRO-Qx_abgvza_IzpnuQKA.png"/></div></div></figure><p id="2ad2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们把这个输入到训练好的机器学习模型中。瞧，模型根据这些特征预测葡萄酒质量得分为5。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi oc"><img src="../Images/4d94ec24768e386f265cfa6af71e3abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*otEY2Sr64QpQfjBnMkttkw.png"/></div></div></figure><p id="2018" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们增加数据点的数量，这样我们就有5个数据点，而不是1个数据点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi od"><img src="../Images/ce89a97eca2ce11c201e621423b5328c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEEyjQnXN8IAY3ly6cBpjg.png"/></div></div></figure><p id="562a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们对酒精含量如何影响模型对葡萄酒质量的预测感兴趣。为了使“酒精含量”分布的模型边缘化，我们计算了所有其他特征(即硫酸盐含量、pH值和密度)的平均值，如下表最后一行<strong class="kh ir">所示。</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi oe"><img src="../Images/d2db12aeec6675c3e813fd5e86af2f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7CtnJ4AyM5BHSDgNtt_0w.png"/></div></div></figure><p id="bade" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将每种葡萄酒的酒精含量，以及硫酸盐含量、pH值和密度的平均值输入机器学习模型。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi of"><img src="../Images/d34505a69599d52e7d3e132b12145c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4NJMqtoPJNRAjYGO66orQ.png"/></div></div></figure><p id="8520" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用这个逻辑，我们制作了部分相关图的如下表格表示。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi og"><img src="../Images/a1c6c43975d292c1d511d0c09a41e92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hz3I-n_4M6ysPsmpoeUdEQ.png"/></div></div></figure><p id="0b40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用模型预测的葡萄酒质量对葡萄酒的酒精含量来绘制图表。这被称为<strong class="kh ir">部分依赖图</strong>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi oh"><img src="../Images/7a3e4e806eac61c346782c7cc007fa12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*apMxfvaaih1iK5_E3AbyqA.png"/></div></div></figure><h2 id="20c8" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">部分相关图背后的数学</h2><p id="3f44" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">下面是部分相关图的更严格的定义，它可以跳过而不损失连续性。</p><p id="8be4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们首先假设机器学习模型是一个函数f，它接受所有特征x并输出一个预测f(xs)。我们感兴趣的是发现输入特征xs的<em class="lb">之一</em>对预测的影响，而我们对所有其他输入特征xc对预测的影响不感兴趣。换句话说，我们希望隔离输入特征xs。为此，我们<em class="lb">在特征xc的分布上边缘化</em>机器学习模型，这被视为P(xc)。在这样的边缘化之后，我们获得机器学习模型对特定特征xs的<em class="lb">部分依赖函数。</em></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi oi"><img src="../Images/80310a9229f9360d04c1feb1ada85dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovJydzwOY_iCzQKLKgUrDg.png"/></div></div></figure><p id="9ea9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在统计学中，我们可以通过大数定律用xc的所有值的和来近似xc的分布上的积分。这里，n是数据集中的数据数量，而xc是来自我们不感兴趣的特征的数据集中的实际值。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/463dc002dd02b24a280bb9101968257d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*wOQhrII6EENAKaRG_5vrbQ.png"/></div></figure><p id="0163" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们在数据集中应用这个公式。为了获得特征<strong class="kh ir"> <em class="lb">酒精</em> </strong> <em class="lb">对预测结果</em> <strong class="kh ir"> <em class="lb">质量的部分依赖图，我们使用以下等式。</em>T15】</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi ok"><img src="../Images/557419f44ea5a88796e5f3b6a81f1d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_peDcgSDU-JTzj0HLWl5Q.png"/></div></div></figure><p id="dfb4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，在其他特征(如pH值、密度、硫酸盐)上有一个上标<em class="lb"> i </em>，但在酒精上没有这样的上标<em class="lb"> i </em>。这是因为我们对其他特征求和以获得其他特征的平均值。这些特征中的每一个的平均值与酒精的第I个值一起被输入到机器学习模型中以产生预测，如下例所示。</p><h1 id="ea3d" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">4.构建葡萄酒质量预测的机器学习模型</h1><h2 id="856d" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">数据导入</h2><p id="3dfe" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">既然我们理解了什么是部分相关图，让我们将它应用于我们的数据集。首先，我们把数据下载到<a class="ae nk" href="https://archive.ics.uci.edu/ml/datasets/wine+quality" rel="noopener ugc nofollow" target="_blank"> UCI站点</a>。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="457c" class="mt mc iq om b gy oq or l os ot">import pandas as pd</span><span id="adc9" class="mt mc iq om b gy ou or l os ot">df = pd.read_csv('winequality-red.csv',delimiter=';')</span></pre><h2 id="16eb" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">数据探索</h2><p id="d0ba" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">数据集不包含任何丢失的数据，并且被认为足够干净，可以按原样使用。因此，我们可以从一些数据探索开始:</p><ol class=""><li id="eec0" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ls lt lu lv bi translated">我们看到数据集主要包含中等质量的葡萄酒(得分为5-6)。</li></ol><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="ceb6" class="mt mc iq om b gy oq or l os ot">import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="d345" class="mt mc iq om b gy ou or l os ot">plt.figure(figsize=(10,5))<br/>sns.distplot(df['quality'],hist=True,kde=False,bins=6)<br/>plt.ylabel('Count')</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi ov"><img src="../Images/a2ca9c53a62d00ecccbb3b73277cf4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzR05UA3hX4JQDZDouZ1Cw.png"/></div></div></figure><p id="c358" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.我们看到一些变量，如硫酸盐、酒精和柠檬酸含量似乎与质量相关。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="e36e" class="mt mc iq om b gy oq or l os ot">fig = plt.figure(figsize=(15, 15))<br/>var = 'sulphates' #or alcohol, citric acid<br/>sns.boxplot(y=var, x='quality', data=df, palette='Reds')</span></pre><div class="lc ld le lf gt ab cb"><figure class="ow lg ox oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><img src="../Images/d650d467c5a17c91528293035a3175d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*euN_bpIkMizOSuff9AcnAw.png"/></div></figure><figure class="ow lg pc oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><img src="../Images/2a2bab30db6598f69a7dab6bca86aadc.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*E783FK0Z5smoZwttFVdWWQ.png"/></div></figure><figure class="ow lg pd oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><img src="../Images/19192ba35d2bd0d6c1f1ba2b6ee0a0c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*uUmW-8CgwI9D8qh9hitnkw.png"/></div></figure></div><p id="f57a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.我们还观察到，一些变量似乎与质量的相关性较弱，如氯化物和残糖含量。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pe"><img src="../Images/2d3d706c9b4700dfbdcaed3863beed68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kdDo5bg7tMP00xYGHrm4SA.png"/></div></div></figure><h2 id="b8b6" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">模型结构</h2><p id="598a" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">让我们快速建立一个机器学习模型，根据葡萄酒的所有化学性质来预测葡萄酒的质量分数。</p><p id="9ac5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们使用25–75的训练-测试分割比将数据分割成训练和测试数据集。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="ceeb" class="mt mc iq om b gy oq or l os ot"># Using Skicit-learn to split data into training and testing sets<br/>from sklearn.model_selection import train_test_split</span><span id="1137" class="mt mc iq om b gy ou or l os ot"># Split the data into training and testing sets<br/>features = df.drop(['quality','pH','pH_class'], axis=1)<br/>labels = df['quality']</span><span id="79d1" class="mt mc iq om b gy ou or l os ot">train_features, test_features, train_labels, test_labels = train_test_split(features, labels, test_size = 0.25, random_state = 42)</span></pre><p id="a384" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将训练数据输入随机森林回归器。这里，没有进行超参数调整，因为这不是本文的重点。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="099c" class="mt mc iq om b gy oq or l os ot">from sklearn.ensemble import RandomForestRegressor<br/>est = GradientBoostingRegressor()<br/>est.fit(train_features, train_labels)</span></pre><p id="d794" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们看看如何在python中使用！幸运的是，我们有一个优雅的包——<a class="ae nk" href="https://github.com/SauceCat/PDPbox" rel="noopener ugc nofollow" target="_blank"><em class="lb">PDP box包</em></a><em class="lb">——</em>，它允许我们轻松地绘制部分相关性图，该图可视化了某些特征对所有SKlearn监督学习算法的模型预测的影响。太神奇了！</p><p id="604b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们首先安装pdpbox包。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="09f6" class="mt mc iq om b gy oq or l os ot">!pip install pdpbox</span></pre><p id="49a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们绘制每个变量对质量分数的部分依赖图。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="4d9f" class="mt mc iq om b gy oq or l os ot">features = list(train_features.columns)</span><span id="b82a" class="mt mc iq om b gy ou or l os ot">for i in features:<br/>    pdp_weekofyear = pdp.pdp_isolate(model=est, dataset=train_features, model_features=features, feature=i)<br/>    fig, axes = pdp.pdp_plot(pdp_weekofyear, i)</span></pre><h1 id="800c" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">各特征对葡萄酒质量的偏相关图</h1><h2 id="e328" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">酸性</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pf"><img src="../Images/23cc900933bb9acf5d29c09342932bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ta9NaRK4nlYvg0Cn7iORyQ.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pg"><img src="../Images/e669d23ca71e328a7d4df4260e7c9866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ip-O2pLTwZQadGnNWA1aWA.png"/></div></div></figure><p id="efb4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们先来了解一下如何看这个图。纵轴是特征对目标变量预测的贡献，而横轴是数据集中特征的范围。例如，我们看到大约7.8的<strong class="kh ir">固定酸度</strong>(上面的第一张图表)将为预测的葡萄酒质量分数贡献大约0.75。</p><p id="559c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">品酒师似乎更喜欢pH值较低(酸度较高)的葡萄酒。特别是，他们似乎喜欢在葡萄酒中加入柠檬酸。这并不奇怪，因为好酒应该是酸性的(即不是平的)。然而，他们不喜欢挥发性酸(挥发性酸让葡萄酒尝起来像醋！)</p><h2 id="bbf5" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">酒精含量</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi ph"><img src="../Images/7d18c28e982a0c4a629c436e8cc965c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ihjkQgFlvqHKumsgiaGKEw.png"/></div></div></figure><p id="af5a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">葡萄酒的主要吸引力之一是它能帮助人们放松——这就是酒精的作用。品酒师似乎喜欢酒的酒精含量更高。</p><h2 id="0c75" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">硫酸盐含量</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pi"><img src="../Images/a29a40b08628f7fd8e8ba0324f8eca7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xtqtrpac2H1qMWPmEvty1A.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pj"><img src="../Images/a30e266b0b20c90ff228821d7d8cdd92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0Kss0zAHsrYvFxIxwCd2A.png"/></div></div></figure><ul class=""><li id="3cde" class="ln lo iq kh b ki kj kl km ko lp ks lq kw lr la ns lt lu lv bi translated">硫酸盐含量越高，模型对其质量达到某一阈值的预测就越高。为什么会这样呢？2018年《自然》杂志的一项研究表明，二氧化硫与葡萄酒中的其他化学化合物(代谢物)反应生成亚硫酸盐化合物，这是最古老葡萄酒的化学特征。<strong class="kh ir">看起来品酒师似乎喜欢较高的亚硫酸盐化合物，这可能使葡萄酒尝起来更陈年。</strong></li><li id="2550" class="ln lo iq kh b ki lw kl lx ko ly ks lz kw ma la ns lt lu lv bi translated">另一方面，模型认为二氧化硫含量高的葡萄酒质量较低。这并不奇怪，因为二氧化硫含量高通常与氧化和葡萄酒中细菌的存在有关。</li></ul><h2 id="8e6d" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">糖和氯化物</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pk"><img src="../Images/e27342acff0dcccd70e1fe69780705ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EBlyIN-dNSqMzWhClrOMoQ.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pg"><img src="../Images/8855a3e02e7329d5e8d8d29408fb6792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2eX6TMPxim62kEA0APMnEg.png"/></div></div></figure><p id="f73f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">一般来说，氯化物和残糖的量似乎对葡萄酒质量的预测影响不大。</strong>我们观察到，两个图都在特征的小幅度处具有聚类点，并且在特征的较高幅度处具有异常值。忽略异常值，我们看到特征量的变化似乎不会很大地改变质量预测，即点的梯度相对较小。因此，特征的改变不会导致葡萄酒质量预测的改变。</p><h2 id="7a83" class="mt mc iq bd md mu mv dn mh mw mx dp ml ko my mz mn ks na nb mp kw nc nd mr ne bi translated">二氧化硫+ pH水平对预测葡萄酒质量的影响</h2><p id="d176" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">我还对二氧化硫和pH值对预测质量的综合影响感兴趣。</p><p id="0c18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了对此进行研究，让我们首先将pH值分成4个具有相同数量数据点的区间。这一步不是完全必要的，尽管它使部分依赖图的可视化更容易。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="ad58" class="mt mc iq om b gy oq or l os ot">pd.qcut(df['pH'],q=4)<br/>&gt;&gt;  [(2.7390000000000003, 3.21] &lt; (3.21, 3.31] &lt; (3.31, 3.4] &lt; (3.4, 4.01]]</span><span id="c352" class="mt mc iq om b gy ou or l os ot"># Create a categorical feature 'pH_class'<br/>cut_labels_3 = ['low','medium','moderately high','high']<br/>cut_bins=  [2.739, 3.21, 3.31, 3.4, 4.01]<br/>df['pH_class'] = pd.cut(df['pH'], bins=cut_bins, labels=cut_labels_3)</span><span id="dbcf" class="mt mc iq om b gy ou or l os ot"># One-hot encode the categorical feature 'pH class' into 4 columns<br/>pH_class = pd.get_dummies(df['pH_class'])</span><span id="a09c" class="mt mc iq om b gy ou or l os ot"># Join the encoded df<br/>df = df.join(pH_class)</span></pre><p id="a3ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们也可以绘制两个变量对预测的部分依赖图作为等值线图。</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="d747" class="mt mc iq om b gy oq or l os ot">inter_rf = pdp.pdp_interact(<br/>    model=est, dataset=df, model_features=features, <br/>    features=['total sulfur dioxide', ['low','medium','moderately high','high']]<br/>)</span><span id="7ed6" class="mt mc iq om b gy ou or l os ot">fig, axes = pdp.pdp_interact_plot(inter_rf, ['total sulfure dioxide', 'pH_level'], x_quantile=True, plot_type='contour', plot_pdp=True)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi pl"><img src="../Images/7defb175d8026f8dffb2597653501a98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gjLQroXB7TP1y0Y-Ewd1g.png"/></div></div></figure><p id="700e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们改变y轴上的pH值(分类变量)和总二氧化硫含量(数值变量)时，等高线图的颜色显示了预测的质量。</p><p id="8f46" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">蓝色区域表示低预测质量，而黄色区域表示高预测质量。这告诉我们，葡萄酒的pH值越低，二氧化硫含量越低，葡萄酒的质量越高(这对应于图表的左下角)。另一方面，超过二氧化硫含量的某个阈值(~66)，我们看到pH不再对预测的质量分数有影响，因为在图表右侧的等高线图上只有垂直线。</p><h1 id="b70e" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">该喝一杯了！</h1><p id="126e" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">恭喜你坚持到现在。既然你是品酒的行家，是时候运用你的知识了。喝一杯，看看你能否将从部分依赖情节中学到的知识运用到实际中。(微妙的暗示:我随时都可以喝一杯——只要在LinkedIn上联系我就行了！)</p><div class="pm pn gp gr po pp"><a href="https://www.linkedin.com/in/voon-hao-tang/" rel="noopener  ugc nofollow" target="_blank"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">特拉维斯唐| LinkedIn</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">Gojek的数据分析师</h3></div></div><div class="px l"><div class="py l pz qa qb px qc nq pp"/></div></div></a></div><p id="e347" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PS/如果你对模型的可解释性感兴趣，一定要看看我的另一篇关于使用<a class="ae nk" rel="noopener" target="_blank" href="/interpreting-black-box-ml-models-using-lime-4fa439be9885">石灰解释黑盒模型对乳腺癌数据</a>的预测的文章。</p><h1 id="ec84" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">参考</h1><p id="4df8" class="pw-post-body-paragraph kf kg iq kh b ki nf jr kk kl ng ju kn ko nh kq kr ks ni ku kv kw nj ky kz la ij bi translated">[1] Paulo Cortez，葡萄牙吉马雷斯米尼奥大学，<a class="ae nk" href="http://www3.dsi.uminho.pt/pcortez" rel="noopener ugc nofollow" target="_blank">http://www3.dsi.uminho.pt/pcortez</a>A . Cerdeira，F. Almeida，T. Matos和J. Reis，葡萄牙波尔图Vinho Verde地区葡萄栽培委员会<br/>【2】Friedman，Jerome H .【贪婪函数逼近:梯度提升机器】统计年鉴(2001):1189–1232。</p><p id="bb0b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">插图由作者完成。</p></div></div>    
</body>
</html>