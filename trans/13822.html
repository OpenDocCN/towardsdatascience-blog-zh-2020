<html>
<head>
<title>How to use local storage withAWS Outposts for AI workloads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将本地存储与AWS前哨一起用于人工智能工作负载</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-high-performance-local-storage-for-ai-workloads-on-aws-outposts-3203b2853cc4?source=collection_archive---------42-----------------------#2020-09-22">https://towardsdatascience.com/how-to-use-high-performance-local-storage-for-ai-workloads-on-aws-outposts-3203b2853cc4?source=collection_archive---------42-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="122e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一起更好:内部云计算+共享数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/10a0a716b2287d9146c8c501b5061a5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IYc0K30ayTHDhoV4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米歇尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4c5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从无人驾驶汽车和金融交易到交通系统，许多用例需要近实时和本地<em class="lv">处理数据的能力。事情正在发生，我们需要尽快做出决定。没有时间将所有数据传输回公共云。</em></p><p id="22bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，许多组织选择将其公共云项目扩展到私有的本地位置，构建混合云解决方案。</p><p id="8c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://aws.amazon.com/outposts/" rel="noopener ugc nofollow" target="_blank"> AWS前哨</a>是采用云优先计划的组织满足本地数据处理或低延迟要求的方式之一。借助前哨机架，您可以在数据中心部署AWS计算硬件。</p><p id="9818" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章介绍了混合云人工智能工作流，并描述了如何将本地存储与AWS前哨配对。在本文中，我使用Pure Storage <a class="ae ky" href="https://www.purestorage.com/products/flashblade.html" rel="noopener ugc nofollow" target="_blank"> FlashBlade </a>作为示例存储服务器，因为它支持来自同一设备的文件和对象存储。</p><h1 id="a61b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">人工智能部署的混合云模型</h1><p id="302a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">随着数据科学团队将其模型投入生产，他们必须支持更大规模的数据接收和数据处理，作为推理的一部分。</p><p id="eb47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，将大型数据集转移到公共云中的性能损失(或成本)令人望而却步。或者，从边缘到公共云的连接可能不可靠。由于这些限制，拥有大量数据摄取的团队正在将人工智能推理从公共云迁移到边缘数据中心。</p><p id="1fc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:在这种情况下，我们使用“边缘”来表示分布式计算模型，其中服务交付在多个边缘站点执行，例如主机托管设施。</em></p><p id="eca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">团队可以在公共云中集中模型开发，然后将最终模型部署到边缘数据中心进行推理。团队可以在边缘执行初始分析，以识别异常或有趣的数据点，并将其发送回公共云进行进一步分析或重新培训。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/9d3332670875f210f201c62f33f45443.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/0*woGHjKitQf9bNH-e"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">混合云部署示例。(图片由作者提供)</p></figure><p id="1ca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，一家自动驾驶汽车公司可能有一个车队，每天每辆车都会产生2TB的数据日志。然而，他们的计算机视觉训练数据集可能没有足够的特定路标变体样本(汽车可能会遇到的其他东西)。因此，该公司的数据科学家可能会在边缘位置执行推理，以提取具有这些高价值异常的数据点，然后将这些数据点输入到模型再训练中。</p><p id="f688" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的数据集被摄取到本地服务器中，AWS前哨——甚至可能是一个<a class="ae ky" href="https://blogs.nvidia.com/blog/2019/12/03/aws-outposts-t4-gpus/" rel="noopener ugc nofollow" target="_blank"> GPU前哨配置</a>——可以用作推理的边缘计算。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="bbc9" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">从前哨EC2实例访问本地服务器上的数据</h1><p id="16f9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">亚马逊的高级解决方案架构师Josh Coen写了<a class="ae ky" href="https://aws.amazon.com/blogs/storage/connecting-aws-outposts-to-on-premises-data-sources/" rel="noopener ugc nofollow" target="_blank">一篇很棒的文章</a>，强调了前哨站和相邻存储设备之间联网路径的简单性。</p><p id="0ec7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建立连接后，很容易开始使用这些外部数据集。在这一节中，我将演示前哨站中的EC2实例如何与本地文件和对象数据进行交互。</p><p id="cc7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先决条件</p><ul class=""><li id="1815" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">前哨站配置:<a class="ae ky" href="https://medium.com/@emwatz/launch-ec2-instances-on-aws-outposts-fc4a0e12bd27" rel="noopener">在前哨站</a>中启动一个EC2实例(通过AWS前哨站控制台)。验证该实例可以ping通本地网络上的设备。</li><li id="264d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">FlashBlade配置:为文件测试创建一个子网、一个数据VIP和一个文件系统。为对象测试创建一个对象存储用户和一个存储桶。</li></ul><p id="29d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">连接到文件存储器</strong></p><p id="aee6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用data vip将文件系统挂载到实例内部的一个目录中。示例:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="98f9" class="nz lx it nv b gy oa ob l oc od">mkdir -p /mnt/datasets<br/>mount -t nfs 10.21.239.11:/datasets /mnt/datasets</span></pre><p id="a282" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！</p><p id="bec4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过<code class="fe oe of og nv b">ls</code>确认EC2实例中挂载的文件系统的内容是否如预期的那样出现。</p><blockquote class="oh oi oj"><p id="2957" class="kz la lv lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated"><em class="it">注意:为了通过每个挂载点的多个TCP连接提高性能，请使用nconnect挂载选项。了解更多:</em> <a class="ae ky" href="https://medium.com/@emwatz/use-nconnect-to-effortlessly-increase-nfs-performance-4ceb46c64089" rel="noopener"> <em class="it">使用nconnect轻松提升NFS性能</em> </a> <em class="it">。</em></p></blockquote><p id="7368" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">连接到对象存储器</strong></p><p id="de0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与区域内实例的流程一样，具有S3访问权限的IAM角色必须与实例关联，用户才能访问S3。(更多信息，请参考<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds" rel="noopener ugc nofollow" target="_blank"> AWS命令行界面用户指南</a>。)</p><p id="f6d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe oe of og nv b">aws configure</code>命令为FlashBlade对象存储用户添加<strong class="lb iu">访问密钥ID </strong>和<strong class="lb iu">秘密访问密钥</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/264c6cc4f562338fc973d3d8316c5c94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E-t0Yx8UxVHrm3aQ"/></div></div></figure><p id="4481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！</p><p id="518d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe oe of og nv b">aws s3 ls</code>命令验证EC2实例可以访问FlashBlade上的存储桶。因为系统使用自定义端点而不是默认的AWS S3，所以使用之前在FlashBlade上创建的数据VIP指定一个<code class="fe oe of og nv b">--endpoint-url</code>。</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="07c8" class="nz lx it nv b gy oa ob l oc od">aws --endpoint-url http://10.21.239.11 s3 ls</span></pre><p id="83ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，Outpost EC2实例已准备好使用存储在FlashBlade上的文件和对象数据。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="0d42" class="lw lx it bd ly lz nb mb mc md nc mf mg jz nd ka mi kc ne kd mk kf nf kg mm mn bi translated">访问前哨站内EMR集群的本地数据集</h1><p id="2d32" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通常，仅从边缘的原始数据直接进行推断是不够的。组织经常选择在运行推理之前对数据进行预处理或操作。你可以使用像<a class="ae ky" href="https://aws.amazon.com/emr/" rel="noopener ugc nofollow" target="_blank"> AWS EMR </a>这样的服务在哨站内部执行预处理步骤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/04b67ac90e314e6a3f32ea6191b84a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/0*XJySyfvz7dFWM2X7"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">内部推理管道示例。支持文件和对象协议工作负载。(图片由作者提供)</p></figure><p id="3b3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简化基础架构，组织可以在整个边缘分析管道中使用相同的共享存储。</p><p id="8363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">部署</strong></p><p id="8189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦运行了集群实例，集群工作负载就可以很容易地访问本地存储服务器上的数据。</p><blockquote class="oh oi oj"><p id="8db7" class="kz la lv lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">关于启动集群的说明，请参见我的帖子:<a class="ae ky" href="https://medium.com/@emwatz/create-amazon-emr-clusters-on-aws-outposts-bec702ec3bae" rel="noopener">在AWS前哨站上创建Amazon EMR集群</a></p></blockquote><p id="1f69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要从该群集访问FlashBlade S3上的对象，请提交包含FlashBlade端点和凭据的作业。示例:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="141c" class="nz lx it nv b gy oa ob l oc od">spark-submit --conf spark.hadoop.fs.s3a.endpoint=http://10.21.239.11 \<br/>             --conf "spark.hadoop.fs.s3a.access.key=####" \<br/>             --conf "spark.hadoop.fs.s3a.secret.key=####" \<br/>             --master yarn \<br/>             --deploy-mode cluster \<br/>             wordcount.py \<br/>             s3a://emily-outpost-bucket/sample.txt</span></pre><p id="f910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，在<strong class="lb iu"> spark-defaults.conf </strong>文件中记录FlashBlade规格，以便在默认情况下自动使用它们。</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="a323" class="nz lx it nv b gy oa ob l oc od">vi /etc/spark/conf.dist/spark-defaults.conf</span></pre><p id="b213" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下几行添加到文件的底部:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="6e85" class="nz lx it nv b gy oa ob l oc od">spark.hadoop.fs.s3a.endpoint 10.21.239.11  # YOUR DATA VIP<br/>spark.hadoop.fs.s3a.access.key=####<br/>spark.hadoop.fs.s3a.secret.key=####</span><span id="6f57" class="nz lx it nv b gy op ob l oc od"># Suggested tuning for FlashBlade performance <br/>performance.spark.hadoop.fs.s3a.fast.upload true<br/>spark.hadoop.fs.s3a.connection.ssl.enabled false<br/>spark.hadoop.mapreduce.fileoutputcommitter.algorithm.version 2<br/>spark.hadoop.mapreduce.input.fileinputformat.split.minsize 541073408</span></pre><p id="531b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以提交作业，而无需在线指定FlashBlade规格:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="9a49" class="nz lx it nv b gy oa ob l oc od">spark-submit --master yarn \<br/>             --deploy-mode cluster \<br/>             wordcount.py \<br/>             s3a://emily-outpost-bucket/sample.txt</span></pre><h1 id="a3eb" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">外卖食品</h1><p id="4930" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">混合云部署变得越来越普遍，尤其是为了支持边缘分析。使用FlashBlade作为示例存储服务器，我们演示了通过AWS outbound EC2实例使用本地文件和对象存储的快速步骤。这使得数据科学家能够部署边缘推理管道，这些管道可以使用大型数据集并在本地执行分析。</p><p id="159f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用带有前哨的高性能本地存储有助于消除向公共云发送分析查询的延迟，并有助于防止将所有边缘数据推送到公共云所带来的传输时间(甚至可能有助于遵守数据治理要求)。通过将易于管理的计算和存储基础架构配对，混合云部署变得更加容易。</p><p id="06f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关导航前哨的信息，另请参见:</p><div class="oq or gp gr os ot"><a href="https://medium.com/@emwatz/launch-ec2-instances-on-aws-outposts-fc4a0e12bd27" rel="noopener follow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">在AWS前哨上启动EC2实例</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">视觉向导</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">medium.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ks ot"/></div></div></a></div><div class="oq or gp gr os ot"><a href="https://medium.com/@emwatz/create-amazon-emr-clusters-on-aws-outposts-bec702ec3bae" rel="noopener follow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">在AWS前哨站上创建Amazon EMR集群</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">视觉向导</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">medium.com</p></div></div><div class="pc l"><div class="pi l pe pf pg pc ph ks ot"/></div></div></a></div></div></div>    
</body>
</html>