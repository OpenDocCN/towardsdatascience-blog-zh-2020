<html>
<head>
<title>How to Build and Deploy AWS Applications on Local Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在本地机器上构建和部署AWS应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-and-deploy-aws-applications-on-local-machine-562b112ecfb7?source=collection_archive---------23-----------------------#2020-10-26">https://towardsdatascience.com/how-to-build-and-deploy-aws-applications-on-local-machine-562b112ecfb7?source=collection_archive---------23-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="5484" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">动手教程</a>，云计算系列</h2><div class=""/><div class=""><h2 id="f7c4" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">在本地机器上构建和部署基于AWS的云应用程序</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/ba98534a0f799eb7c5d4fef227ab3ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtKMfrmaaRIn_McUsbmh6w.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。由<a class="ae le" href="https://www.canva.com/p/pixabay/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>通过<a class="ae le" href="https://www.canva.com/media/MADQ4_ajPZc" rel="noopener ugc nofollow" target="_blank"> Canva </a>生成的原始图像</p></figure><p id="603c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我以前的文章中，我谈到了使用<a class="ae le" rel="noopener" target="_blank" href="/how-to-build-a-serverless-application-using-aws-chalice-91024416d84f"> Chalice </a>和<a class="ae le" rel="noopener" target="_blank" href="/how-to-build-a-serverless-application-using-aws-sam-b4d595fe689f"> SAM </a>在AWS上构建和部署无服务器应用程序。这些是快速有趣的项目，利用了无服务器计算的能力，让我们在几分钟内就可以在AWS上部署无服务器应用程序。</p><p id="756f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但是由于没有AWS帐户，许多人不能完全利用这样的教程。设置AWS帐户和配置开发环境可能非常耗时，有时还会导致不必要的费用(如果配置不当)。</p><p id="d0cc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在本文中，我将带您完成构建和部署无服务器应用程序所需的步骤，而无需创建和设置实际的AWS帐户。</p><p id="25ee" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这一次，我们将使用Amazon API Gateway、AWS Lambda和Amazon DynamoDB创建一个样本宠物商店应用程序。这个应用程序将有API来添加一个新的宠物和获取可用宠物的列表。</p><h1 id="4861" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">先决条件</h1><p id="a78b" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">在本教程中，我们将使用AWS SAM。您可以按照之前的<a class="ae le" rel="noopener" target="_blank" href="/how-to-build-a-serverless-application-using-aws-sam-b4d595fe689f">文章</a>中的指导来安装和配置SAM。</p><h1 id="ef78" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何创建项目</h1><p id="7111" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">运行<code class="fe my mz na nb b">sam-init</code>命令创建一个新项目。这将在当前目录下创建一个<code class="fe my mz na nb b">pet-store</code>文件夹。</p><pre class="kp kq kr ks gt nc nb nd ne aw nf bi"><span id="0be9" class="ng mc iq nb b gy nh ni l nj nk">sam init -r java11 -d maven --app-template pet-store -n pet-store</span></pre><p id="b22c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">关于传递的参数的更多细节，请参考之前的<a class="ae le" rel="noopener" target="_blank" href="/how-to-build-a-serverless-application-using-aws-sam-b4d595fe689f">文章</a>。</p><p id="3f6a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们更改<code class="fe my mz na nb b">pom.xml</code>，将模块名称更新为<code class="fe my mz na nb b">PetStore</code>，并使用<code class="fe my mz na nb b">Java 11</code>而不是<code class="fe my mz na nb b">Java 8</code>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="2b61" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在让我们创建一个<code class="fe my mz na nb b">Pet</code>类来包含宠物的属性。我们将从简单的属性开始，如<code class="fe my mz na nb b">name</code>、<code class="fe my mz na nb b">age</code>和<code class="fe my mz na nb b">category</code>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0058" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">因为我们将使用Amazon DynamoDB作为我们的数据存储，所以让我们在<code class="fe my mz na nb b">pom.xml</code>中添加相应的SDK依赖项。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="bd4d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这将引入AWS SDK for DynamoDB和Apache HTTP Client的依赖项，这些依赖项将用于创建同步DynamoDB客户端。</p><h1 id="604e" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何读写项目</h1><p id="7f57" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们需要创建一个数据访问类来与Amazon DynamoDB交互，并运行我们的读/写查询。创建一个<code class="fe my mz na nb b">PetStoreClient</code>类并添加对<code class="fe my mz na nb b">DynamoDbClient</code>的依赖。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="2c6a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们现在将在<code class="fe my mz na nb b">PetStoreClient</code>类中创建两个函数来从DynamoDB中读取和写入项目。</p><h2 id="b995" class="ng mc iq bd md nn no dn mh np nq dp ml lo nr ns mn ls nt nu mp lw nv nw mr iw bi translated">写一个项目</h2><p id="aca1" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">在DynamoDB中添加一个条目是一个<code class="fe my mz na nb b">PUT</code>请求。我们将创建一个<code class="fe my mz na nb b">PutItemRequest</code>，并指定要添加的表名和项目属性。</p><p id="42cc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后我们将使用<code class="fe my mz na nb b">DynamoDbClient</code>把这个项目放到DynamoDB中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="bfb5" class="ng mc iq bd md nn no dn mh np nq dp ml lo nr ns mn ls nt nu mp lw nv nw mr iw bi translated">阅读项目</h2><p id="5962" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">读取DynamoDB中的项目列表是一个<code class="fe my mz na nb b">SCAN</code>请求。我们将创建一个<code class="fe my mz na nb b">ScanRequest</code>并指定要扫描的表名。</p><p id="498c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后我们将使用<code class="fe my mz na nb b">DynamoDbClient</code>来扫描DynamoDB中的表，并返回一个条目列表。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6be9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">注意:</strong>扫描请求会遍历表中的所有项目，因此不建议在真实情况下使用。</p><h1 id="75e4" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何解决依赖关系</h1><p id="1a5e" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们已经在我们的<code class="fe my mz na nb b">PetStoreClient</code>类中添加了<code class="fe my mz na nb b">DynamoDbClient</code>作为依赖项。作为一般的最佳实践，代码中的所有此类依赖都应该使用依赖注入(DI)来解决。</p><p id="4feb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">说起DI，春天是我们脑海里第一个蹦出来的名字。然而，Spring生态系统是巨大的，我们最终会引入很多它的框架，即使我们只想使用DI部分。喷射也在运行时完成，使得Lambda的冷启动时间更长。</p><p id="91a4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Guice是另一个很好的依赖注入框架，比Spring轻得多。但是就像Spring一样，它在运行时进行注入，因此也不适合DI。</p><p id="3bee" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后是Dagger，一个纯DI框架，在编译时注入依赖项！！它的小尺寸和编译时注入使它成为在Lambdas中实现DI的完美选择。</p><p id="c900" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我将更深入地研究DI的细节，并在另一篇文章中介绍Dagger的使用。然而在本文中，我们将使用静态工厂方法的永恒风格来提供依赖关系。</p><p id="b4a8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们创建一个类<code class="fe my mz na nb b">DependencyModule</code>，并在其中声明我们所有的依赖项。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b06a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这个类中，我们正在创建一个新的<code class="fe my mz na nb b">DynamoDbClient</code>实例，并将其注入到我们的<code class="fe my mz na nb b">PetStoreClient</code>中。我们还创建了一个<code class="fe my mz na nb b">ObjectMapper</code>的实例来帮助我们处理JSON对象的序列化和反序列化。</p><h1 id="79fb" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何更新Lambda和API端点</h1><p id="325b" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">接下来，我们需要更新Lambda函数的入口点，并为添加和检索宠物添加特定的端点。</p><p id="2c46" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">将下面的代码片段添加到<code class="fe my mz na nb b">template.yaml</code>文件的<code class="fe my mz na nb b">Resources</code>部分。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="7eb2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这更新了我们的函数来使用来自<code class="fe my mz na nb b">App</code>类的<code class="fe my mz na nb b">handleRequest</code>方法，并且还添加了两个API端点来添加和检索宠物。</p><p id="3683" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">更新<code class="fe my mz na nb b">Outputs</code>部分以反映新的函数名。</p><h1 id="067b" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何整合客户端</h1><p id="0746" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">既然我们已经准备好了与DynamoDB交互的代码，并且对依赖项进行了排序，那么我们需要在Lambda处理程序中进行一些更改来调用这些代码。</p><p id="3591" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">更新<code class="fe my mz na nb b">App.java</code>中的代码，以调用<code class="fe my mz na nb b">PetStoreClient</code>中的函数，并根据API请求执行动作。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="78ec" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">由于我们使用静态工厂进行依赖注入，我们将不能有效地测试我们的代码。我将在另一篇文章中介绍云应用程序的单元测试。现在，我们需要删除单元测试来构建项目。</p><h1 id="481d" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何构建项目</h1><p id="59b4" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">从<code class="fe my mz na nb b">pet-store</code>文件夹中，运行<code class="fe my mz na nb b">sam build</code>命令。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/1a38c73cb551b99193d65ec0393f83c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t42qUg4ZzF0BYQJfPSRz4A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="6eb7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这将编译您的源代码并构建您在应用程序中拥有的任何依赖项。然后，它将所有文件移动到<code class="fe my mz na nb b">.aws-sam/build</code>文件夹中，这样它们就可以打包和部署了。</p><h1 id="1c6c" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何进行本地测试(第1部分)</h1><p id="14f9" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">在之前的<a class="ae le" rel="noopener" target="_blank" href="/how-to-build-a-serverless-application-using-aws-sam-b4d595fe689f">文章</a>中，我们讨论了SAM CLI如何提供<code class="fe my mz na nb b">sam local</code>命令来本地运行您的应用程序。这在内部使用Docker来模拟Lambda的执行环境。如果没有安装Docker，可以从<a class="ae le" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">这里</a>获取。</p><p id="c3cc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这对Daily News API来说很好，因为它从互联网上获取数据，并且不依赖于任何其他AWS组件。然而，在当前的项目中，我们依赖Amazon DynamoDB作为我们的数据存储，并且需要访问它以便我们能够成功地运行我们的应用程序。</p><p id="33e1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">本质上，我们需要一种方法在本地机器上模拟AWS提供的服务，这样我们就可以在本地测试它们，而不需要使用实际的AWS帐户。</p><h1 id="6438" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何在本地运行AWS</h1><p id="7900" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated"><a class="ae le" href="https://localstack.cloud/" rel="noopener ugc nofollow" target="_blank"> LocalStack </a>就是为了解决这个问题而产生的。用它自己的话说:</p><blockquote class="ny nz oa"><p id="e1f4" class="lf lg ob lh b li lj ka lk ll lm kd ln oc lp lq lr od lt lu lv oe lx ly lz ma ij bi translated">LocalStack为开发云应用程序提供了一个易于使用的测试/模拟框架。它在您的本地机器上构建了一个测试环境，提供与真正的AWS云环境相同的功能和API。</p></blockquote><p id="c8e6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">简而言之，LocalStack将AWS cloud的所有功能都集成到一个docker容器中，该容器在我们的机器上本地运行。这使开发人员能够构建和测试他们的云应用程序，而不必在实际的AWS云帐户上部署它们。</p><p id="27d9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对一个开发者来说意味着什么？</p><ol class=""><li id="ea2e" class="of og iq lh b li lj ll lm lo oh ls oi lw oj ma ok ol om on bi translated">无需提供AWS帐户。</li><li id="ea3f" class="of og iq lh b li oo ll op lo oq ls or lw os ma ok ol om on bi translated">不需要设置开发环境和考虑安全性和其他配置。</li><li id="85ce" class="of og iq lh b li oo ll op lo oq ls or lw os ma ok ol om on bi translated">不需要在开发期间产生不必要的AWS成本。</li><li id="3e3a" class="of og iq lh b li oo ll op lo oq ls or lw os ma ok ol om on bi translated">完全模拟实际AWS环境的透明本地环境。</li></ol><h1 id="86a3" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何设置本地堆栈</h1><p id="2994" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">LocalStack非常容易设置和开始使用。我们将使用Docker获取LocalStack的最新映像，并启动一个运行Amazon DynamoDB模拟版本的容器。</p><p id="84c2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在<code class="fe my mz na nb b">pet-store</code>文件夹中创建一个<code class="fe my mz na nb b">docker-compose.yaml</code>文件，并添加以下内容。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="4ea5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们来看看我们正在使用的一些配置:</p><ul class=""><li id="9999" class="of og iq lh b li lj ll lm lo oh ls oi lw oj ma ot ol om on bi translated">服务——因为我们只依赖Amazon DynamoDB，所以我们将只启用这个特定的服务</li><li id="bd7d" class="of og iq lh b li oo ll op lo oq ls or lw os ma ot ol om on bi translated">DEFAULT_REGION —我们将使用us-west-1作为我们的AWS区域</li><li id="005b" class="of og iq lh b li oo ll op lo oq ls or lw os ma ot ol om on bi translated">LAMBDA _ EXECUTOR——将它设置为local意味着我们所有的LAMBDA函数都将在本地机器上的一个临时目录中运行</li><li id="5c2e" class="of og iq lh b li oo ll op lo oq ls or lw os ma ot ol om on bi translated">DATA_DIR —为Amazon DynamoDB等服务保存持久数据的位置</li></ul><p id="1941" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">注意:</strong>所有的LocalStack服务都是通过端口4566上的edge服务公开的。这是我们需要使用的唯一端口。</p><p id="daf5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们可以使用<code class="fe my mz na nb b">docker-compose</code>在它自己的容器中启动我们本地版本的Amazon DynamoDB。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/c1c754947c39f2ca59508a4ba582ffc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*84XQbyBH6IBrruJdvi4UpA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><h1 id="d318" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何创建表格</h1><p id="214b" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">既然我们已经运行了Amazon DynamoDB的本地设置，我们应该能够为我们的应用程序创建一个表。</p><p id="929d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们在代码中使用了<code class="fe my mz na nb b">pet-store</code>作为表名，所以让我们继续创建它。我们将使用AWS CLI访问运行在本地机器上的Amazon DynamoDB，并创建所需的表。</p><p id="970b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">运行下面的命令创建一个名为<code class="fe my mz na nb b">pet-store</code>的表，并将属性<code class="fe my mz na nb b">id</code>作为主键。</p><pre class="kp kq kr ks gt nc nb nd ne aw nf bi"><span id="75be" class="ng mc iq nb b gy nh ni l nj nk">aws --endpoint-url "<a class="ae le" href="http://localhost:4566" rel="noopener ugc nofollow" target="_blank">http://localhost:4566</a>" dynamodb create-table \<br/>    --table-name pet-store \<br/>    --attribute-definitions AttributeName=id,AttributeType=S \<br/>    --key-schema AttributeName=id,KeyType=HASH \<br/>    --billing-mode PAY_PER_REQUEST</span></pre><p id="d88d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">注意，我们使用了<code class="fe my mz na nb b">endpoint-url</code>参数来指定我们指向本地运行的AWS实例，而不是实际的实例。</p><h1 id="ed7e" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">如何进行本地测试(第2部分)</h1><p id="6701" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">对DynamoDbClient代码进行以下更改，使其指向本地运行的Amazon DynamoDB实例。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="a638" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">接下来，使用<code class="fe my mz na nb b">sam build</code>构建项目，并运行以下命令在本地启动API。</p><pre class="kp kq kr ks gt nc nb nd ne aw nf bi"><span id="1d2e" class="ng mc iq nb b gy nh ni l nj nk">sam local start-api</span></pre><p id="7fd8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这在内部创建了一个本地服务器，并公开了一个复制REST API的本地端点。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/fd2f7736f1b3b9d30c3e0131ed758314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qNtq8cYsCV_chS0gvcmpUg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="8740" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，让我们通过添加一只新宠物来测试我们的应用程序。运行下面的命令，通过调用我们之前指定的<code class="fe my mz na nb b">/pets</code>端点来添加一个新的宠物。</p><pre class="kp kq kr ks gt nc nb nd ne aw nf bi"><span id="b8f4" class="ng mc iq nb b gy nh ni l nj nk">curl --location --request PUT '<a class="ae le" href="http://127.0.0.1:3000/pet'" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3000/pets'</a> \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "name": "Rocket",<br/>    "age": 2,<br/>    "category": "Dog"<br/>}'</span></pre><p id="7c8f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这创建了一个新的宠物记录，将其添加到我们的本地Amazon DynamoDB，并在响应中返回生成的UUID。</p><p id="67f5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们店里再添一只宠物吧。</p><pre class="kp kq kr ks gt nc nb nd ne aw nf bi"><span id="5e11" class="ng mc iq nb b gy nh ni l nj nk">curl --location --request PUT '<a class="ae le" href="http://127.0.0.1:3000/pet'" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3000/pets'</a> \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "name": "Candle",<br/>    "age": 1,<br/>    "category": "Pig"<br/>}'</span></pre><p id="affe" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，让我们调用我们的<code class="fe my mz na nb b">/pets</code> API来获取数据存储中可用的宠物列表。我们应该会得到一个包含<code class="fe my mz na nb b">Rocket</code>和<code class="fe my mz na nb b">Candle</code>的宠物列表。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ow"><img src="../Images/a2c7e61ae739b62b6ee0e6fbd55f743c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOGjUOEPWhYVQnFNuouKeA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><h1 id="51bd" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">结论</h1><p id="876b" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">恭喜你！！您刚刚在本地机器上构建并部署了一个完全使用AWS DynamoDB的无服务器应用程序。</p><p id="628e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在您可以继续对您的<code class="fe my mz na nb b">App.java</code>文件进行任何修改。重新运行<code class="fe my mz na nb b">sam deploy</code>来重新部署您的更改，运行<code class="fe my mz na nb b">sam local start-api</code>来启动本地服务器并测试更改。</p><p id="c875" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦您为部署做好准备，您只需要删除端点覆盖，就万事大吉了。在理想情况下，这将由环境变量控制，并且绝对不需要修改代码就可以投入生产。</p><p id="e611" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">本教程的完整源代码可以在<a class="ae le" href="https://github.com/theawesomenayak/pet-store" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div></div>    
</body>
</html>