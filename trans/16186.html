<html>
<head>
<title>Tidy Mail Merge Using R Markdown</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用R Markdown整理邮件合并</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tidy-mail-merge-using-r-markdown-7c5a2ee1995e?source=collection_archive---------34-----------------------#2020-11-07">https://towardsdatascience.com/tidy-mail-merge-using-r-markdown-7c5a2ee1995e?source=collection_archive---------34-----------------------#2020-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/8461f514e5119fcbe62dfa155260ed14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-uIJV82NZyMHMFfw9gGNw.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">卡罗尔·郑在<a class="ae jd" href="https://unsplash.com/s/photos/mail?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="10ce" class="je jf jg bd b dl jh ji jj jk jl jm dk jn translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="4ad7" class="pw-subtitle-paragraph km jp jg bd b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dk translated">因为自动化枯燥的东西不只是Python才有的！</h2></div><p id="b144" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在现代社会，企业的生死取决于电子邮件。电子邮件(你还记得我们以前用连字符<a class="ae jd" href="http://www.future-perfect.co.uk/grammar-tip/is-it-e-mail-email-e-mail-or-email/" rel="noopener ugc nofollow" target="_blank">连接</a>吗？)是大多数行业的主要通信工具，也可能是所有行业的关键外部通信工具。</p><p id="ad48" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">从数据科学的角度来看，电子邮件很无聊，太平常了，不值得关注。但是关于电子邮件，有一件事我们可以说，但对于streamlit仪表板我们不能说，那就是如果我们用电子邮件向利益相关者发送消息，他们几乎肯定至少会看一眼。像仪表板这样的被动资源需要分析消费者选择并获得他们想要的结果。但是电子邮件可以主动推送给决策者。这是一个很小的差别，但不应该被低估。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ma"><img src="../Images/4d61f71eb41131f5fffacbdeb2fc3d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMCG3cu21W5MbODBbhI-sA.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">有了电子邮件报告手机嗡嗡声和你的分析会得到关注！</p></figure><p id="9730" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">当然，这并不意味着我们作为数据科学家想要花很多时间起草电子邮件。我们更愿意阅读媒体上的文章？).因此，我们希望通过电子邮件为任意长的收件人列表自动定制分析报告。</p><p id="2891" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">有趣的是，文字处理器在几年前用邮件合并打印解决了这个问题。细节因供应商而异，但实际上您可以用姓名、地址和其他特定于邮件的细节填充一个表，然后为表中的每条记录打印(或保存到文件中)一条单独的消息。虽然wordperfect在1990年能做的事情很明显，R在2020年也能复制，但令人惊讶的是，使用tidyverse、R markdown和R package blastula通过电子邮件向任意长的人发送定制分析列表是多么容易。</p><figure class="mb mc md me gt is"><div class="bz fp l di"><div class="mg mh l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">这些家伙在1990年有一首热门歌曲！</p></figure><p id="6c2c" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">举一个具体的例子，假设我们的任务是每天向三个人发送covid19新的阳性检测结果。我们将从<a class="ae jd" href="https://covidtracking.com/" rel="noopener ugc nofollow" target="_blank">https://covidtracking.com/</a>获取数据，并创建一封友好的电子邮件，在底部附上每个州的图表，这样我们的数据消费者就不必费力查看他们所在州的当前情况。这将避免每个同事需要打开单独的文件或访问特定的门户网站。我们可以快速轻松地设计出一个流程来创建类似这样的电子邮件:</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mi"><img src="../Images/a7246b50ba7c6d29d2025449476c468e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQgn48j_mgjzNe_8r9Qb_A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">您收件箱中的ggplot图形！</p></figure><p id="a567" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">虽然这种形式不会赢得任何美学奖项，但它非常干净，非常低调。而且，由于我们将把R markdown渲染成一个html文件，如果我们愿意进入html，它是100%可定制的(也许使用这里的<a class="ae jd" href="https://www.r-bloggers.com/2020/06/rmarkdown-css-selector-tips/" rel="noopener ugc nofollow" target="_blank">指针</a>)。</p><p id="6636" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们需要创建的第一个文件是邮件模板。在这种情况下，这将是一个使用输出类型blastula_email的R markdown文档，我们成功的一个关键因素是在文件顶部的YAML头块中创建参数，以便我们可以用每个收件人不同的细节来填充这些值。</p><p id="0efe" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">文件的其余部分非常简单，包括一个用于提取数据的块、一个用于观众的文本块和一个ggplot调用。</p><figure class="mb mc md me gt is"><div class="bz fp l di"><div class="mj mh l"/></div></figure><p id="a12b" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这里的另一个关键组件是一个R脚本，它将接受一个收件人列表及其相关细节(在本例中是他们所处的状态、他们的姓名以及与每个人一起使用的签名)，然后将markdown文件转换成适合他们每个人的消息，并发送出去。tidyverse lmap()函数(来自purrr包)允许我们将每个人的详细信息存储在tibble的一行中，然后应用blastula函数来编织和通过电子邮件发送消息，而无需任何显式循环。</p><figure class="mb mc md me gt is"><div class="bz fp l di"><div class="mj mh l"/></div></figure><p id="dd8e" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，我们仍然不得不承认发送这些邮件并不是完全自动的，因为每天我们都必须运行我们的R脚本。但是1)这意味着运行一个脚本，而不是潜在地写几十封电子邮件，2)我们可以使用一个任务调度器来使它成为一个“无按钮”的过程(奇妙的<a class="ae jd" href="https://cran.r-project.org/web/packages/taskscheduleR/vignettes/taskscheduleR.html" rel="noopener ugc nofollow" target="_blank"> taskscheduleR </a>包将在Windows机器上帮助实现这一点)。</p><p id="8cd6" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我鼓励每个人都使用调度作业来实现全自动解决方案，但是即使没有这一步，我们也可以用一百行代码每周节省几个小时。</p><blockquote class="mk ml mm"><p id="2593" class="le lf mf lg b lh li kq lj lk ll kt lm mn lo lp lq mo ls lt lu mp lw lx ly lz ij bi translated">有人曾经问爸爸:“但是你想节省时间做什么呢？”你打算用它做什么？"“工作，如果你最喜欢的话，”爸爸说。"为了教育，为了美丽，为了艺术，为了快乐。"他从夹鼻眼镜的上方看过去。"对曼波蒂-佩格来说，如果那是你的心所在。”<br/> ― <strong class="lg jq">欧内斯廷</strong> <a class="ae jd" href="https://www.goodreads.com/work/quotes/1925199" rel="noopener ugc nofollow" target="_blank"> <strong class="lg jq">按打便宜</strong> </a></p></blockquote><p id="b48d" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在我看来这是一个胜利！</p></div></div>    
</body>
</html>