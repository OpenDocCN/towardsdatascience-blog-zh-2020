<html>
<head>
<title>OpenCV + CUDA + AWS EC2 + (No More Tears)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenCV + CUDA + AWS EC2 +(不再流泪)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/opencv-cuda-aws-ec2-no-more-tears-60af2b751c46?source=collection_archive---------3-----------------------#2020-10-24">https://towardsdatascience.com/opencv-cuda-aws-ec2-no-more-tears-60af2b751c46?source=collection_archive---------3-----------------------#2020-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="71a1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将OpenCV库与CUDA驱动程序绑定以支持对OpenCV代码进行GPU处理的逐步说明。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2c61cdc7266eb08d9ff371ecef9fef07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8a5z9DrAxNXT0DwG"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯蒂安·威迪格在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="cb40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，不需要为GPU处理启用OpenCV和CUDA，但在生产过程中，当您需要对图像/视频文件进行大量OpenCV操作时，我们可以利用OpenCV CUDA库来使这些操作在GPU而不是CPU上运行，这样可以节省大量时间。</p><p id="a34a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">据说连接OpenCV库使其与CUDA兼容并不容易，我不得不经历一周的痛苦过程来正确地建立连接，这也是一个既费时又费钱的过程。所以这次我想记录下整个过程，为了我的未来，也为了别人。</p><p id="546d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了进行演示，我在AWS中租用了一个EC2实例和一个p3.8xlarge实例，它有4个Nvidia GPUs。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/d01ede1dc8accb27bed71aefd9d4d2e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cof2MSJMsjRAgIe1DU7ILQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源— <a class="ae kv" href="https://aws.amazon.com/ec2/pricing/on-demand/" rel="noopener ugc nofollow" target="_blank"> AWS EC2定价</a></p></figure><p id="d738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果你在第一次启动EC2实例时需要任何帮助，你可以参考我以前关于在AWS中逐步创建EC2实例的文章<a class="ae kv" href="https://medium.com/towards-artificial-intelligence/step-by-step-creation-of-an-ec2-instance-in-aws-and-access-it-via-putty-winscp-a6c28f2022be" rel="noopener">，并通过Putty &amp; WinSCP </a>访问它，在此过程中选择你需要的GPU实例。</p><p id="8a4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在进入实例之后，在我们进入流程之前，我们需要安装许多包来准备好环境。</p><blockquote class="lt lu lv"><p id="e806" class="kw kx lw ky b kz la jr lb lc ld ju le lx lg lh li ly lk ll lm lz lo lp lq lr ij bi translated">注意:我已经合并了我从头到尾运行的所有命令，并将它们添加在底部。如果你更好奇的话，可以在这个<a class="ae kv" href="https://gist.github.com/bala-codes/a3d5d79d3066ed39dfb6eabc587cdd7b" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">链接</strong> </a>中找到它们，然后跟着一起走。</p></blockquote><p id="6b01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的实例上一个接一个地运行下面的命令，并且我已经证实了截图，将输出与我的进行比较。</p><blockquote class="lt lu lv"><p id="4915" class="kw kx lw ky b kz la jr lb lc ld ju le lx lg lh li ly lk ll lm lz lo lp lq lr ij bi translated">下文使用的所有截图均来源于作者。</p></blockquote></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="c590" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated"><strong class="ak">目录:</strong></h1><ol class=""><li id="3d21" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated"><a class="ae kv" href="#361e" rel="noopener ugc nofollow">安装OpenCV依赖、Nvidia CUDA驱动、CUDA工具包</a></li><li id="2051" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#48e0" rel="noopener ugc nofollow">下载OpenCV源代码</a></li><li id="e390" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#9a44" rel="noopener ugc nofollow">配置Python虚拟环境</a></li><li id="9eb1" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#2438" rel="noopener ugc nofollow">确定你的CUDA架构版本</a></li><li id="edd5" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#c388" rel="noopener ugc nofollow">配置支持Nvidia GPU的OpenCV</a></li><li id="ff50" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#8486" rel="noopener ugc nofollow">编译OpenCV并创建一个符号链接</a></li><li id="a6b3" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#2716" rel="noopener ugc nofollow">参考文献</a></li><li id="d550" class="mz na iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="#66e7" rel="noopener ugc nofollow">命令历史</a></li></ol></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="361e" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">第一步:安装OpenCV依赖，Nvidia CUDA驱动，CUDA工具包。</h1><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="02bd" class="nu mi iq nq b gy nv nw l nx ny">sudo apt-get update<br/>sudo apt-get upgrade<br/>sudo apt-get install build-essential cmake unzip pkg-config<br/>sudo apt-get install gcc-6 g++-6<br/>sudo apt-get install screen<br/>sudo apt-get install libxmu-dev libxi-dev libglu1-mesa libglu1-mesa-dev</span><span id="ef8a" class="nu mi iq nq b gy nz nw l nx ny">sudo apt-get install libjpeg-dev libpng-dev libtiff-dev<br/>sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev</span><span id="7e56" class="nu mi iq nq b gy nz nw l nx ny">sudo apt-get install libxvidcore-dev libx264-dev<br/>sudo apt-get install libopenblas-dev libatlas-base-dev liblapack-dev gfortran</span><span id="b355" class="nu mi iq nq b gy nz nw l nx ny">sudo apt-get install libhdf5-serial-dev<br/>sudo apt-get install python3-dev python3-tk python-imaging-tk<br/>sudo apt-get install libgtk-3-dev<br/>sudo add-apt-repository ppa:graphics-drivers/ppa<br/>sudo apt-get update<br/>sudo apt-get install nvidia-driver-418<br/>sudo reboot</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/158fbd2d686dcb9dad88940c14046343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TywfpVU-FP_i4lrtJJMiVQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/370bd39bcc813de47f36bd9ef42af225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pW8mZpbnjMAHzN5lrWg0SA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/70a316b73204a05af7752db96c35198d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xd2CB3RnGJp4cNUWnvH3jA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/74849af265d9e700a724659a269c64fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sGR6GxdyOLqYNyHS-ketA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/5a14c4aa6deab9c5e4153378a9dfde9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEx6I0i2-j1_uRhTYlRZ1w.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/4bae98252a921fd57fb0587b897987ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65-hHkNJdUtV7lvBp9wQcg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/382b74a4e8e1c02f740392450afa8757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZlBEyYGqdWkc7mUm1cKumA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a66c43f71f535eb03384908b04730b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96SjQdBfv8JD17zIk6X6QQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a6a1367739b9e2db8ea0d0ebfd281ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7gG24tHVlVt-8W1Onhfs2Q.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/ddd7794a3c07a197ccd1113885a45031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuJ-frCNybZbNduoAD_HNA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a0b3f5bbc5c1b43b6fbe8c212c912c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ddh1btpWifIhnnbgLPAyEA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/bf3ba501ff3c52a3f7c49f9779c9238b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uV5lND7Tjr63BlIeh75pQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/e637c31ddd9ab5fff448423b7669c27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lz4M9RUbaYsDn9TgwKH5Kg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/07dd810bc07ce4a8677eb808cb8e9565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxx2-2opbi52vB5XudzMAA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/e635d8e9a2b27f6617b33816bea0b351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_iwZfOU2SzK4xLkHOvPhiA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/eab80a7caf0d8f867d600c9e5c04ce5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOuNFSAvDdjU7y4HkC17NA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/c00a76433d90a8f80f9c49a19e31f400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDx_VUj-rngVrqMU7CTdNw.png"/></div></div></figure><p id="4da4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装完成后，重新启动系统。一旦你的系统启动，键入<code class="fe od oe of nq b">nvidia-smi</code>，它应该会给出类似的输出，正如你在下面的代码片段中看到的，我用4个特斯拉v100 GPUs供电。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/328769538653d89b585660ef683f6aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTmiZzEeu74iSvwZ776rPg.png"/></div></div></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="694c" class="nu mi iq nq b gy nv nw l nx ny">mkdir installers<br/>cd installers/<br/>wget <a class="ae kv" href="https://developer.nvidia.com/compute/cuda/10.0/Prod/local_installers/cuda_10.0.130_410.48_linux" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/compute/cuda/10.0/Prod/local_installers/cuda_10.0.130_410.48_linux</a></span><span id="7543" class="nu mi iq nq b gy nz nw l nx ny">mv cuda_10.0.130_410.48_linux cuda_10.0.130_410.48_linux.run<br/>chmod +x cuda_10.0.130_410.48_linux.run<br/>sudo ./cuda_10.0.130_410.48_linux.run --override</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/f3e1fc6409a08ae132e7026438b622ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLx8egv0jUZ-v8URvw0hJQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/08ef6767e9da1dc439b3143660996d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNB9Goay9btGf1xtXCfqrQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/71fc51d63e25e30b9f91abaa9c7ee945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6kR9FDVsusHSCxZZh46pyw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/0d8adb9b37569c4178b0f9c9d5724a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FBn7nSGAcsv2xnJZVo0tYQ.png"/></div></div></figure><p id="db98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是所有步骤中最重要的一步，我在网上找到的大多数文章中都没有详细说明，并且花了一天多的时间来解决这个难题。</p><p id="fd2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您阅读并接受EULA协议后，有一些是(y)/否(n)命令，并根据下面的回答填写。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/32bb61718c54278bb7ae753f28ff157e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mO7asBgkaw6eTg4Clw_XOQ.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/55c74d3c449325425149d1ba87f95c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lEGeKwIA5yqN7MaTijyl0g.png"/></div></div></figure><p id="bc1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在你成功地安装之后，你将被提供需要被添加到bashrc文件的路径，并且以后来源它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/e7e903c722592691e5f7c01aaf59d9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HnfxMOPaCsIsLvXKUsh4g.png"/></div></div></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="dfab" class="nu mi iq nq b gy nv nw l nx ny">sudo vim ~/.bashrc<br/>source ~/.bashrc<br/>nvcc -V</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/205e1c4a9d35ffcee435eb9b7f7e0a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*76ufH5QGhTscHtN_oO7WNQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/790c13dc313d4e6569bcaa28e7540a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-aWwZirKRqnHDJzzM6yHeQ.png"/></div></div></figure><p id="cad4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记下#NVIDIA CUDA Toolkit下的命令，并根据您在之前的命令中获得的路径添加它们。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="04fd" class="nu mi iq nq b gy nv nw l nx ny"># NVIDIA CUDA Toolkit<br/>export PATH=/usr/local/cuda-10.0/bin:$PATH<br/>export LD_LIBRARY_PATH=/usr/local/cuda-10.0/lib64:$LD_LIBRARY_PATH</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/296e062b5ec83d232399a7b90366dc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6XSbCSppBU_TDkNy6XB1g.png"/></div></div></figure><p id="d9c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在找到它，保存更改并在以后安装一些依赖项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/977e8557bfd14604f99678b42ad91e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LARj-bWFJtb1MLI_TaK2TQ.png"/></div></div></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="8b19" class="nu mi iq nq b gy nv nw l nx ny">sudo apt-get update<br/>sudo apt-get upgrade<br/>sudo apt-get install build-essential cmake unzip pkg-config<br/>sudo apt-get install libjpeg-dev libpng-dev libtiff-dev<br/>sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev<br/>sudo apt-get install libgtk-3-dev</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/500d4658e5e4ccb2999a48ed4503060d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tbv1aUA76hBcsaaBjkhkew.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/c6e00ec1c0ed565c64de94196dd10769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fXZ87x_ybAWwz6hipPy_A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/835bd895806554e97fc34ba0a6a47d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4Q_jLa_tB5eaafv_P36Ow.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a6ac50aa4147806809d75f6f3a10f8e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HKt-Ns3n3ee-oZZBGi_Bmw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/6e35d7f59fb9dbdada8e7291031122e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XxEQoApFaZ_nltQrqaboA.png"/></div></div></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="48e0" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">第2步:下载OpenCV源代码</h1><p id="9054" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">现在我们需要下载OpenCV &amp; OpenCV contrib并手动运行它们的安装文件。这里我使用的是OpenCV包的4.2.0版本。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="d20c" class="nu mi iq nq b gy nv nw l nx ny">cd ~<br/>wget -O opencv_contrib.zip <a class="ae kv" href="https://github.com/opencv/opencv_contrib/archive/4.2.0.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/opencv/opencv_contrib/archive/4.2.0.zip</a></span><span id="d83c" class="nu mi iq nq b gy nz nw l nx ny">wget -O opencv.zip <a class="ae kv" href="https://github.com/opencv/opencv/archive/4.2.0.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/opencv/opencv/archive/4.2.0.zip</a></span><span id="7455" class="nu mi iq nq b gy nz nw l nx ny">unzip opencv.zip<br/>unzip opencv_contrib.zip<br/>mv opencv-4.2.0 opencv<br/>mv opencv_contrib-4.2.0 opencv_contrib</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/8fc3b0cc8cd262f1596683f8e7832519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_AqPLy24v7kbXKtkRouk1w.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/fdce23901eb5c902b75fb907381e5e5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D4m_JLs1qpfQ_ik140xf9A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/3658177d630148498a6c8ba66f8a5242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbXVc9alEQZJZJ4x_835_g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/c0e9ba4c123c7d2815eb9ff0488cf364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSvczkPDi_W8z0JJLvPXlQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/fd775ecf33cafa5775cf00bf2a1f3366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PE8mcR3dZf26q26l2PpPqw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/661b8476ea10c400ccee83122472675e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6L-P0_567ACODiLHOXVUg.png"/></div></div></figure><h1 id="9a44" class="mh mi iq bd mj mk ol mm mn mo om mq mr jw on jx mt jz oo ka mv kc op kd mx my bi translated">步骤3:配置Python虚拟环境</h1><p id="ff64" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">在这里，我们使用一个虚拟环境，并将在此后的环境中构建OpenCV CUDA的绑定。</p><p id="1717" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一部分，我将使用<code class="fe od oe of nq b">virtualenv</code>和<code class="fe od oe of nq b">virtualenvwrapper</code>作为虚拟环境。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="86f2" class="nu mi iq nq b gy nv nw l nx ny">wget <a class="ae kv" href="https://bootstrap.pypa.io/get-pip.py" rel="noopener ugc nofollow" target="_blank">https://bootstrap.pypa.io/get-pip.py</a><br/>sudo python3 get-pip.py<br/>sudo pip install virtualenv virtualenvwrapper<br/>sudo rm -rf ~/get-pip.py ~/.cache/pip</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/18dfc2cb47faaa3f6b7d2ccfcbc79d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gm0nFZ0b7y_1OcTcoqs7yQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/6506d1b01bd763e499ff3d328b96fd8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rsiygL4O6Mu8hEfXkA4oBw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/744097a13896fa3ed0da595c73f11ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ty7yMpYRJn7KASRGhBc4Rg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/7281d19c36a9313142f75866fddac3c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVCz3o9xBdsiTU2QwiHouQ.png"/></div></div></figure><p id="fe49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装完这些包后，您需要在<code class="fe od oe of nq b">~/.bashrc</code>中添加这些行，以便让bash在每次终端启动时加载virtualenv和virtualenvwrapper:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="3303" class="nu mi iq nq b gy nv nw l nx ny">sudo vim ~/.bashrc</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/5ca848f68e3de49f900a153894c40433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jp3HkOxZGIllhC0y9OtHgw.png"/></div></div></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="7a13" class="nu mi iq nq b gy nv nw l nx ny"># Add them inside bashrc</span><span id="e931" class="nu mi iq nq b gy nz nw l nx ny"># virtualenv and virtualenv wrapper<br/>export WORKON_HOME=$HOME/.virtualenvs<br/>export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3<br/>source /usr/local/bin/virtualenvwrapper.sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/7c425b5da45b0e039ceaf9e6fb0a633a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CUHzWunPuL8t8wN3vEa9A.png"/></div></div></figure><p id="51d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在在添加之后，来源它。现在跑<code class="fe od oe of nq b">source ~/.bashrc</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/3d2839389d6f923baf10ec5357000a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMrPXNFdYrZNiP-GPu5Sbw.png"/></div></div></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="636d" class="nu mi iq nq b gy nv nw l nx ny"># Create a virtual environment. The first step is to create a virtual environment:</span><span id="3308" class="nu mi iq nq b gy nz nw l nx ny">mkvirtualenv opencv_cuda -p python3<br/>pip install numpy<br/>nvidia-smi</span><span id="ba3d" class="nu mi iq nq b gy nz nw l nx ny">cd ~/opencv<br/>mkdir build<br/>cd build</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/19ee6d5ca81abc88ff66059d1f868a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9TP_LSOjaD-S1DUk7rb4Q.png"/></div></div></figure><p id="e480" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我在虚拟环境中安装Numpy库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/56cf6516f438d826b42d8614270b21a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0vRtKIodPENHoIvxU0MZwQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a679c2cc704bdc306b85ca38d81f9d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEe-W_3D0f4GPMSVWFE0tw.png"/></div></div></figure><h1 id="2438" class="mh mi iq bd mj mk ol mm mn mo om mq mr jw on jx mt jz oo ka mv kc op kd mx my bi translated">步骤4:确定您的CUDA架构版本</h1><p id="ae55" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">要找到架构，运行<code class="fe od oe of nq b">nvidia-smi</code>并记下您被分配到的Nvidia GPU的名称。对我来说，我有特斯拉v100</p><p id="6b22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一名经验丰富的CUDA程序员，确定CUDA架构版本是一项必需的实践，因为它让编译器在您的GPU上生成更高效的代码。此外，设置不包括Nvidia GPU架构的架构参数会让您的程序在执行时无法工作。</p><p id="c187" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以用<code class="fe od oe of nq b">nvidia-smi</code>算出你的Nvidia GPU是什么型号:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/9ec8eb7551ec56bb4958eb923a29055b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9bm4HJPck6jacGcEMEjXw.png"/></div></div></figure><p id="859d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">获得Nvidia GPU模型后，您可以使用此页面找到您的CUDA架构:</p><blockquote class="lt lu lv"><p id="e21f" class="kw kx lw ky b kz la jr lb lc ld ju le lx lg lh li ly lk ll lm lz lo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-gpus</a></p></blockquote><p id="d631" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向下滚动到“您的GPU计算能力”段落。由于我使用的是Nvidia Tesla v100，我将点击“<a class="ae kv" href="https://developer.nvidia.com/cuda-gpus#collapseOne" rel="noopener ugc nofollow" target="_blank">支持CUDA的Tesla产品</a>”部分。</p><p id="8d3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查后，我意识到我的Nvidia GPU架构版本是<code class="fe od oe of nq b">7.0</code>。提醒一下，您的GPU架构版本可能会有所不同。</p><p id="3cc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你得到了GPU架构版本，<em class="lw">请记下它</em>，因为我们将在下一步使用它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/07db642a5d7047dcba6c6b7fd3aad217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FE2JV9JV3_3Z3j-X56ciQA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源— <a class="ae kv" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank"> Nvidia的开发者网站</a></p></figure><h1 id="c388" class="mh mi iq bd mj mk ol mm mn mo om mq mr jw on jx mt jz oo ka mv kc op kd mx my bi translated">步骤5:用Nvidia GPU支持配置OpenCV</h1><p id="a737" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">OpenCV使用CMake来配置和生成构建。首先，激活<code class="fe od oe of nq b">opencv_cuda</code>虚拟环境，如果之前没有启用的话。</p><p id="96c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样在CMake命令中，在参数CUDA_ARCH_BIN=x.x中，将它替换为您在上一步中获得的计算容量版本。这里我用的是7.0，请换成你的版本。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="62b1" class="nu mi iq nq b gy nv nw l nx ny">cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D INSTALL_PYTHON_EXAMPLES=ON -D INSTALL_C_EXAMPLES=OFF -D OPENCV_ENABLE_NONFREE=ON -D WITH_CUDA=ON -D WITH_CUDNN=OFF -D OPENCV_DNN_CUDA=ON -D ENABLE_FAST_MATH=1 -D CUDA_FAST_MATH=1 -D CUDA_ARCH_BIN=7.0 -D WITH_CUBLAS=1 -D OPENCV_EXTRA_MODULES_PATH=~/opencv_contrib/modules -D HAVE_opencv_python3=ON -D PYTHON_EXECUTABLE=~/.virtualenvs/opencv_cuda/bin/python -D BUILD_EXAMPLES=ON ..</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/b6f9bb6a34b7c217f25eb8656bbd7f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVvxv3xolUbCJKZB0rKVLA.png"/></div></div></figure><p id="b701" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有一点，检查CMake输出的<code class="fe od oe of nq b">Python 3</code>部分的<code class="fe od oe of nq b">install path</code>。我们将使用<code class="fe od oe of nq b">install path</code>它。<strong class="ky ir">所以请留下</strong>T5的备注。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/f41ca1a40050185f8b52163fea6bc65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p6jklpD02xQANAFN0TlTFg.png"/></div></div></figure><h1 id="8486" class="mh mi iq bd mj mk ol mm mn mo om mq mr jw on jx mt jz oo ka mv kc op kd mx my bi translated">步骤6:编译OpenCV并创建一个符号链接</h1><p id="365e" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">如果<code class="fe od oe of nq b">cmake</code>没有错误地退出，那么用下面的命令编译OpenCV。</p><p id="0069" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的是，在运行下一个命令之前，最少需要45分钟，最多需要5个小时，请确保ssh连接没有超时，如果您通过putty访问它，请每隔15分钟按一次Enter键。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="1147" class="nu mi iq nq b gy nv nw l nx ny">make -j$(nproc)<br/>sudo make install<br/>sudo ldconfig</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/acd8e318e75df6b3b2bdea98ae7a5db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nbki_keqnh6gpsVLiQv8sw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/0920595be149036c7367d62cea284169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y5RjqIYymYMwP-UDjtv6LQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/08598a41ca078a6d11c17b7c458782ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39-wyHwS2hiSuCTA5a1aGw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/32da95ebb116b1068cdf876a82d55e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWab_gQ39mVrEcFDVAnzfg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/49dadf09d0dbfb4fb1f13622ceb736ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UYakpeoMoPlyPi5C3VJxw.png"/></div></div></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="72af" class="nu mi iq nq b gy nv nw l nx ny">ls -l /usr/local/lib/python3.6/site-packages/cv2/python-3.6</span><span id="675a" class="nu mi iq nq b gy nz nw l nx ny">cd ~/.virtualenvs/opencv_cuda/lib/python3.6/site-packages/</span><span id="ad56" class="nu mi iq nq b gy nz nw l nx ny"><br/>##Next, create a sym-link to your virtual environment: ##</span><span id="0771" class="nu mi iq nq b gy nz nw l nx ny">ln -s /usr/local/lib/python3.6/site-packages/cv2/python-3.6/cv2.cpython-36m-x86_64-linux-gnu.so cv2.so</span></pre><p id="7f0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将创建一个符号链接，将OpenCV Python绑定到您的Python虚拟环境中。如前一步所述，我们知道<code class="fe od oe of nq b">install path</code>就是<code class="fe od oe of nq b">/usr/local/lib/python3.6/site-packages/cv2/python-3.6</code>。</p><p id="567c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要确认，您可以使用<code class="fe od oe of nq b">ls</code>命令:</p><p id="365c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以看到我的OpenCV Python绑定的名称是<code class="fe od oe of nq b">cv2.cpython-36m-x86_64-linux-gnu.so</code>(您自己构建的绑定可能有一个类似的名称)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/05da06f4de924003d75ac0382bf2f45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mo26gquQrTJB6T6OUBmOQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/3268c0e76d0b8e716a6c125bf7d7c742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ew-GZi9nFyTZu3cVEb7d0Q.png"/></div></div></figure><p id="2a32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建一个指向虚拟环境的符号链接:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/714c78b0d63d0183ec976451673dd57a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C65Td_RlRPThJrylGUjsIw.png"/></div></div></figure><p id="3ea4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记得花点时间检查你的文件路径，因为如果OpenCV绑定的路径不正确的话，<code class="fe od oe of nq b">ln</code>会让<em class="lw">无声地失败</em>。</p><h1 id="3c98" class="mh mi iq bd mj mk ol mm mn mo om mq mr jw on jx mt jz oo ka mv kc op kd mx my bi translated">验证安装— OpenCV Python</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/c571c3863ebcd621db41e267a64010fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YxnU_mIK4etTR6O8j1-N1w.png"/></div></div></figure><p id="898f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行OpenCV + CUDA启用的代码，而不是OpenCV代码，这一次，它似乎工作。</p><p id="1329" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，大多数OpenCV函数都可以用CUDA包装，要查看可用的函数，请在Python IDE中运行命令。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="f019" class="nu mi iq nq b gy nv nw l nx ny">## To check the supported methods for opencv in CUDA ##<br/>import cv2</span><span id="5fa9" class="nu mi iq nq b gy nz nw l nx ny">print(dir(cv2.cuda))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/8065d6803a795472883c310e5b8cdfb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Ft6DAEJnPMujl82p8wFtA.png"/></div></div></figure><p id="b75b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查它在与我的实例连接的WinSCP中的相应输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/0a8a8d0e8839c05579e49bae4ac83077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*wHt3xat4zCFmOBnXFlFg9g.png"/></div></figure><p id="de12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OpenCV CUDA启用代码的输出，其中我调整了颜色通道的大小并将其转换为灰色。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/a71e0614ade0c03b9fc638534beff03d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxtAXMjZZBicA5aA-VXudQ.png"/></div></div></figure><p id="ae75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，当您下次登录到您的实例并希望进入OpenCV CUDA环境时，请使用该命令。</p><p id="4987" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我的虚拟环境的名字是“opencv_cuda”。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="c543" class="nu mi iq nq b gy nv nw l nx ny">source ~/.virtualenvs/opencv_cuda/bin/activate</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/3adb7b89d85802378435ddd2284dc35a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3PNx9DbpxZzXKPF0uYrUQ.png"/></div></div></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="9bdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你，如果你已经在文章和实现中达到了这一点，现在你可以在OpenCV CUDA支持下部署生产级应用了。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="2716" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">参考</h1><h2 id="dfc4" class="nu mi iq bd mj os ot dn mn ou ov dp mr lf ow ox mt lj oy oz mv ln pa pb mx pc bi translated">如果没有我在网上找到的这些惊人的参考资料，这对我来说是不可能的。</h2><p id="a116" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">要了解更多细节，你可以访问其中任何一个。</p><p id="778d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/spmallick/learnopencv/tree/master/Getting-Started-OpenCV-CUDA-Module" rel="noopener ugc nofollow" target="_blank">https://github . com/spmallick/learnopencv/tree/master/Getting-Started-OpenCV-CUDA-Module</a></p><p id="c8f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/codecentric/computer-vision-drone/blob/master/_posts/2017-02-18-install-opencv-on-aws-with-cuda.md" rel="noopener ugc nofollow" target="_blank">https://github . com/codecentric/computer-vision-drone/blob/master/_ posts/2017-02-18-install-opencv-on-AWS-with-cuda . MD</a></p><p id="b439" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://gist.github.com/raulqf/f42c718a658cddc16f9df07ecc627be7" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Raul qf/f42c 718 a 658 cddc 16 f 9 df 07 ECC 627 be 7</a></p><p id="639c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.nvidia.com/cuda-10.2-download-archive?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1804&amp;target_type=runfilelocal" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-10.2-download-archive?target _ OS = Linux&amp;target _ arch = x86 _ 64&amp;target _ distro = Ubuntu&amp;target _ version = 1804&amp;target _ type = runfile local</a></p><p id="2ed0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://medium.com/@sb.jaduniv/how-to-install-opencv-4-2-0-with-cuda-10-1-on-ubuntu-20-04-lts-focal-fossa-bdc034109df3" rel="noopener">https://medium . com/@ sb . jaduniv/how-to-install-opencv-4-2-0-with-cuda-10-1-on-Ubuntu-20-04-lts-focal-fossa-BDC 034109 df3</a></p><p id="4c15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://medium.com/@Linh.NG/installing-opencv-3-3-0-on-ubuntu-16-04-lts-7db376f93961" rel="noopener">https://medium.com/@Linh.NG/installing-opencv-3-3-0-on-Ubuntu-16-04-lts-7db 376 f 93961</a></p><p id="4416" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://cuda-chen.github.io/image%20processing/programming/2020/02/22/build-opencv-dnn-module-with-nvidia-gpu-support-on-ubuntu-1804.html" rel="noopener ugc nofollow" target="_blank">https://cuda-Chen . github . io/image % 20 processing/programming/2020/02/22/build-opencv-dnn-module-with-NVIDIA-GPU-support-on-Ubuntu-1804 . html</a></p><p id="6dd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.pyimagesearch.com/2020/02/03/how-to-use-opencvs-dnn-module-with-nvidia-gpus-cuda-and-cudnn/" rel="noopener ugc nofollow" target="_blank">https://www . pyimagesearch . com/2020/02/03/how-to-use-open CVS-dnn-module-with-NVIDIA-GPU-cuda-and-cud nn/</a></p><div class="pd pe gp gr pf pg"><a href="https://www.pyimagesearch.com/2016/07/11/compiling-opencv-with-cuda-support/" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab fo"><div class="pi ab pj cl cj pk"><h2 class="bd ir gy z fp pl fr fs pm fu fw ip bi translated">使用CUDA支持编译OpenCV-PyImageSearch</h2><div class="pn l"><h3 class="bd b gy z fp pl fr fs pm fu fw dk translated">light，这样您就在支持GPU的系统上安装了NVIDIA CUDA Toolkit和cuDNN库。接下来呢？让我们…</h3></div><div class="po l"><p class="bd b dl z fp pl fr fs pm fu fw dk translated">www.pyimagesearch.com</p></div></div><div class="pp l"><div class="pq l pr ps pt pp pu kp pg"/></div></div></a></div></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="66e7" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">命令的历史记录:</h1><p id="93bb" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf oi lh li lj oj ll lm ln ok lp lq lr ij bi translated">正如我所说的，我正在添加合并的代码，我已经运行了很长时间，你可以按照上面相应的截图进行操作。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pv pw l"/></div></figure><p id="3eb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，作为一个预防措施，它花费了我48美元来制作这个帖子，还花费了我以前的实例破损的杂项费用，因为我以前由于不正确的绑定不得不终止多个实例。</p><p id="7055" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保根据您的使用情况使用相应的GPU实例。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="189e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在那之前，下次见。</p><p id="c1b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">文章作者:</strong></p><p id="5734" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> BALAKRISHNAKUMAR V </strong></p></div></div>    
</body>
</html>