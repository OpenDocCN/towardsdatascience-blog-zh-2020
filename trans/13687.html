<html>
<head>
<title>Google Analytics Data with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌分析数据与R</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/google-analytics-data-with-r-32caf8956c94?source=collection_archive---------14-----------------------#2020-09-20">https://towardsdatascience.com/google-analytics-data-with-r-32caf8956c94?source=collection_archive---------14-----------------------#2020-09-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7026a166a6c809bedba50e44e012fc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8sH_Tq8bfPFJr54o"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">米利安·耶西耶在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2db4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">目标:</strong>以编程方式检索营销分析自动化的谷歌分析数据。</p><p id="4523" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">访问Google Analytics API来检索GA记录是构建端到端营销分析套件的基本要求之一。我们可以通过下面列出的四个主要步骤来实现这一目标:</p><ol class=""><li id="8804" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">在Google Cloud中生成客户端ID和密钥。</li><li id="cb59" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">更新。伦美龙变量。</li><li id="e41c" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">导入相关库并在本地刷新GA令牌。</li><li id="b9dc" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">最后，在r中构建GA数据集。</li></ol><p id="2ce0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第一步。在Google Cloud中生成客户端ID和密钥</strong></p><p id="9f25" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">步骤1.1。创建谷歌云项目:登录<a class="ae kf" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">谷歌云控制台</strong> </a>创建项目。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ls"><img src="../Images/a9c9bd65b313a9c65d616b89f6afdd24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbtrSxYjWHIA1P7CGgv7SQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建谷歌云项目(图片由作者提供)</p></figure><p id="3e7d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第1.2步。谷歌分析报告API:一旦你创建了项目，导航到项目的API和服务部分，并启用“谷歌分析报告API”。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lx"><img src="../Images/ac3f9c3578b43d88d6fa6e7fb2dc7775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bIlM-sclfK4roeQ-NfI9Q.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">谷歌分析报告API 1(图片由作者提供)</p></figure><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ly"><img src="../Images/6c44da62fa24f8d0a9e80a9b9499921b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tiNI74TfZ5k8lH215KgAiA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">谷歌分析报告API 2(图片由作者提供)</p></figure><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lz"><img src="../Images/2a9449d99c20f56e2a7b422cb21cb800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvAwx9-W9eZ9lWSePBmJOA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">谷歌分析报告API 3(图片由作者提供)</p></figure><p id="8bc8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第1.3步。配置OAuth同意屏幕:如果您是第一次设置Google Cloud项目，您必须在生成凭证之前配置OAuth同意屏幕。确保在项目范围中选择分析报告API，在同意屏幕中输入应用程序名称和支持电子邮件。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ma"><img src="../Images/080cf2455fb45011cd55af1a84e81204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9F6XSiY6QuB-nkel_l5umw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">配置OAuth同意屏幕1(图片由作者提供)</p></figure><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mb"><img src="../Images/573fa40b451a119d47aa1839d6531a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CmFaiMuw1bHvEdRhBlrwmw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">配置OAuth同意屏幕2(图片由作者提供)</p></figure><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/947a1f0664ab7e59af50425255bf33c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQNXAfCeCZHeR-_GD4T0Mw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">配置OAuth同意屏幕3(图片由作者提供)</p></figure><p id="8c21" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第1.4步。创建OAuth客户端ID:配置OAuth同意屏幕后，创建OAuth客户端ID凭据。以JSON文件的形式下载客户机ID和密钥，并将其存储在当前的工作目录中。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/8dbf98f74c0820ddfbe94c8ae02493a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QiHJPy88HeJMnNHfNOOz_A.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建OAuth客户端ID 1(图片由作者提供)</p></figure><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/0faf66eab3ef441508f94e9c79e495c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r2Ku_If8E5kzPrE4owiypQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建OAuth客户端ID 2(图片由作者提供)</p></figure><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/254c79e8a0bdd77742c70ee3ff96cb54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1MMlayrbViHHXqCtn4VmsQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建OAuth客户端ID 3(图片由作者提供)</p></figure><p id="7a9b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第二步。更新。Renviron:编辑。Renviron通过整合最新的谷歌云项目证书</strong></p><p id="7e06" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第2.1步。打开。Renviron在R中使用以下命令并更新参数:</p><pre class="lt lu lv lw gt mg mh mi mj aw mk bi"><span id="1873" class="ml mm it mh b gy mn mo l mp mq">usethis:: edit_r_environ()</span></pre><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/476a65c874f84aa33ed65314a9bae3ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhtQ6bh5vdmovGIbJXnF4A.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">更新。伦美龙<strong class="bd ms"> </strong>(图片由作者提供)</p></figure><p id="90ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第三步。GA认证:启动一个R会话并提前导入所有相关的库</strong></p><p id="7454" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">googleAnalyticsR和googleAuthR是列表中的必备。确保在加载googleAnalyticsR和googleAuthR包之前使用' gar_set_client()'函数。此外，指出gar_auth()函数中“刷新令牌”的位置。</p><pre class="lt lu lv lw gt mg mh mi mj aw mk bi"><span id="d41b" class="ml mm it mh b gy mn mo l mp mq">googleAuthR:: gar_set_client( "C:\\Users\\Sree\\gcp_client.json")</span><span id="1835" class="ml mm it mh b gy mt mo l mp mq">library(googleAnalyticsR)<br/>library(googleAuthR)<br/>library(tidyverse)<br/>library(lubridate)<br/>library(dplyr)</span><span id="76de" class="ml mm it mh b gy mt mo l mp mq">googleAuthR::gar_auth(token = "sc_ga.httr-oauth")</span></pre><p id="bbc7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在执行上述命令时，您将能够通过自动刷新令牌经由R成功登录到Google Analytics报告数据库。</p><p id="18b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第四步。Google分析报告API:在R中构建GA报告</strong></p><p id="639e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第4.1步。从GA获取视图列表:</p><p id="a198" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">确定您需要从谷歌分析的视图的完整列表。通过使用googleAuthR包中的“ga_account_list()”函数或通过从Google Analytics本身识别他们来获取他们的ViewId。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/24fb8202bf8d10a52fca6c65e0a7a2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SyK1_qrytbQpfYw45YCqqg.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">谷歌分析报告API(图片由作者提供)</p></figure><pre class="lt lu lv lw gt mg mh mi mj aw mk bi"><span id="b20c" class="ml mm it mh b gy mn mo l mp mq">my_accounts &lt;- ga_account_list()<br/>viewId &lt;- (my_accounts$viewId)</span></pre><p id="f396" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第4.2步。通过查询Google Analytics报告服务器构建数据集:</p><p id="49d1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了便于说明，我在这里构建了一个循环，为Google Analytics中设置的所有视图顺序下载数据。</p><pre class="lt lu lv lw gt mg mh mi mj aw mk bi"><span id="3763" class="ml mm it mh b gy mn mo l mp mq">ga_data_final &lt;- data.frame()</span><span id="b848" class="ml mm it mh b gy mt mo l mp mq">for (i in viewId) {<br/>  ga_data_temp &lt;- <br/>    google_analytics(i, <br/>                     date_range = c(GoogleA_Start, GoogleA_End),<br/>                     metrics = c("sessions"),<br/>                     dimensions = c("date"<br/>                                 ,"channelGrouping"<br/>                                 ,"deviceCategory"<br/>                                 ,"source"),<br/>                     anti_sample = TRUE,<br/>                     #slow_fetch = TRUE,<br/>                     max = c("-1"))<br/>  ga_data_temp$viewId &lt;- i<br/>  ga_data_final &lt;- rbind(ga_data_final, ga_data_temp)<br/>}</span></pre><p id="44e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第4.3步。清理数据集:</p><pre class="lt lu lv lw gt mg mh mi mj aw mk bi"><span id="8cf3" class="ml mm it mh b gy mn mo l mp mq">GA_export &lt;- <br/>  left_join(ga_data_final,my_accounts, by = "viewId") %&gt;%<br/>  select(date,channelGrouping,deviceCategory,source,sessions,Country) %&gt;%<br/>  mutate(channelGrouping_refined = if_else(<br/>  channelGrouping == 'Organic Search','SEO',<br/>  if_else(channelGrouping == 'Paid Search','PPC Search',<br/>  if_else(channelGrouping == 'Display', 'PPC Display',<br/>  if_else(channelGrouping == 'email,email','EDM',<br/>  if_else(channelGrouping == '(Other)', 'Unspecified', channelGrouping  <br/>  )))))) %&gt;% select(date,channelGrouping,deviceCategory,source<br/>  ,sessions,channelGrouping_refined,Country)</span><span id="b6ea" class="ml mm it mh b gy mt mo l mp mq">rm(my_accounts,ga_data_final,ga_data_temp,i, viewId)</span></pre><p id="45a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第4.4步。发布数据集:</p><p id="9cd9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是谷歌分析报告服务器最终输出的快照。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/36513ee3aecda2a80c4e86e19d80b70c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PagE1ReW2CzVL0lx1HMJg.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">发布数据集(按作者分类的图像)</p></figure><p id="b7ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，将带有时间戳的数据集发布到平面文件或云数据库中。</p><pre class="lt lu lv lw gt mg mh mi mj aw mk bi"><span id="ba9b" class="ml mm it mh b gy mn mo l mp mq">GA_data &lt;- <br/>  GA_export %&gt;%<br/>  write_csv("GA_data.csv")</span></pre><p id="84be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第五步:接下来是什么？</strong></p><p id="65dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这只是营销分析自动化的开始。因为我们可以在此基础上做更多的事情，比如:</p><p id="b338" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1)在虚拟机上自动化R脚本，并将增量数据存储在云数据库中。</p><p id="670a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2)重复相同的过程，建立一个自动化的跨渠道数据湖，带来增量脸书广告/谷歌广告/推特广告数据集。</p><p id="bd87" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3)使用时间序列预测来预测来自每个平台的用户会话/指标。</p><p id="7efc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4)最后，构建一个BI仪表板，从平面文件/云存储中检索数据，以可视化端到端营销分析套件。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="cf2d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">关于作者</strong></p><div class="nd ne gp gr nf ng"><a href="https://srees.org/about" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">Sreejith Sreedharan - Sree</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">数据爱好者。不多不少！你好！我是Sreejith Sreedharan，又名Sree一个永远好奇的数据驱动的…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">srees.org</p></div></div><div class="np l"><div class="nq l nr ns nt np nu jz ng"/></div></div></a></div><p id="b2b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您在理解r中GA自动化的基础知识方面需要任何帮助，请随时联系我。希望这有所帮助:)</p></div></div>    
</body>
</html>