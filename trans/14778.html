<html>
<head>
<title>Fixing the KeyError: ‘acc’ and KeyError: ‘val_acc’ Errors in Keras 2.3.x or Newer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修复Keras 2.3.x或更新版本中的key error:“ACC”和key error:“val _ ACC”错误</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fixing-the-keyerror-acc-and-keyerror-val-acc-errors-in-keras-2-3-x-or-newer-b29b52609af9?source=collection_archive---------10-----------------------#2020-10-12">https://towardsdatascience.com/fixing-the-keyerror-acc-and-keyerror-val-acc-errors-in-keras-2-3-x-or-newer-b29b52609af9?source=collection_archive---------10-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c549" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如果您的Keras代码中出现诸如KeyError: 'acc '或KeyError: 'val_acc '之类的错误，这可能是由于Keras 2.3.x中最近的一个更改。</h2></div><p id="d78d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Keras 2.3.0中，矩阵的报告方式被更改为与指定的名称完全一致。如果您使用的是旧代码或旧代码示例，那么您可能会遇到错误。以下是修复它们的方法。</p><p id="0609" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您是否使用过由Keras的fit()函数返回的“历史”对象来绘制或可视化您的模型的训练历史？自从最近的Keras升级以来，您是否遇到过类似下面这样的“KeyError”类型的错误，并想知道为什么？</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2070" class="lk ll iq lg b gy lm ln l lo lp">Traceback (most recent call last):<br/>  File "lenet_mnist_keras.py", line 163, in &lt;module&gt;<br/>    graph_training_history(history)<br/>  File "lenet_mnist_keras.py", line 87, in graph_training_history<br/>    plt.plot(history.history['acc'])<br/>KeyError: 'acc'</span></pre><figure class="lb lc ld le gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lq"><img src="../Images/53cc87aa9efa0d4992f9e3c7c682d0f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0whcygjBTltlQhYmvvQZuw.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">尝试读取历史记录对象时出现密钥错误:“acc”</p></figure><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="45cd" class="lk ll iq lg b gy lm ln l lo lp">Traceback (most recent call last):<br/>  File "lenet_mnist_keras.py", line 163, in &lt;module&gt;<br/>    graph_training_history(history)<br/>  File "lenet_mnist_keras.py", line 88, in graph_training_history<br/>    plt.plot(history.history['val_acc'])<br/>KeyError: 'val_acc'</span></pre><figure class="lb lc ld le gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lq"><img src="../Images/77b96d58ae8af6936593d1e9bc9b9303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W7Pvvb2LgwBpFSbkLbP9AA.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">尝试读取历史对象时出现密钥错误:“val_acc”</p></figure><p id="0b13" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这要归功于Keras 2 . 3 . 0版本中引入的一个突破性的变化。</p><p id="76c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据2.3.0发行说明:</p><blockquote class="mc md me"><p id="6bc0" class="kf kg mf kh b ki kj jr kk kl km ju kn mg kp kq kr mh kt ku kv mi kx ky kz la ij bi translated"><em class="iq">"指标和损失现在以用户指定的确切名称报告(例如，如果您通过指标=['acc']，您的指标将在字符串“acc”下报告，而不是“accuracy”，反之，指标=['accuracy']将在字符串“accuracy”下报告。</em></p></blockquote><p id="71a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在这里阅读官方发布说明:【https://github.com/keras-team/keras/releases/tag/2.3.0T2】</p><p id="0232" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着，如果您在<strong class="kh ir"> model.compile() </strong>中指定<strong class="kh ir"> metrics=["accuracy"] </strong>，那么历史对象将拥有关键字<strong class="kh ir"> 'accuracy' </strong>和<strong class="kh ir"> 'val_accuracy' </strong>。而如果您将其指定为<strong class="kh ir"> metrics=["acc"] </strong>，那么它们将使用关键字<strong class="kh ir"> 'acc' </strong>和<strong class="kh ir"> 'val_acc' </strong>进行报告。</p><p id="3e6c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，要修复这个错误，你应该在你的代码中使用一个标准。</p><p id="4579" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用“acc”，</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6c27" class="lk ll iq lg b gy lm ln l lo lp">...<br/><br/>model.compile(loss="categorical_crossentropy",<br/>              optimizer=opt, metrics=["acc"])<br/> <br/>...<br/> <br/>plt.figure(<strong class="lg ir">1</strong>)<br/><br/># summarize history for accuracy<br/><br/>plt.subplot(<strong class="lg ir">211</strong>)<br/>plt.plot(history.history['acc'])<br/>plt.plot(history.history['val_acc'])<br/>plt.title('Model Accuracy')<br/>plt.ylabel('Accuracy')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Training', 'Validation'], loc='lower right')<br/><br/># summarize history for loss<br/><br/>plt.subplot(<strong class="lg ir">212</strong>)<br/>plt.plot(history.history['loss'])<br/>plt.plot(history.history['val_loss'])<br/>plt.title('Model Loss')<br/>plt.ylabel('Loss')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Training', 'Validation'], loc='upper right')<br/><br/>plt.tight_layout()<br/><br/>plt.show()</span></pre><p id="5f60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，使用“准确性”。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e489" class="lk ll iq lg b gy lm ln l lo lp">...<br/><br/>model.compile(loss="categorical_crossentropy",<br/>              optimizer=opt, metrics=["accuracy"])<br/> <br/>...<br/> <br/>plt.figure(<strong class="lg ir">1</strong>)<br/><br/># summarize history for accuracy<br/><br/>plt.subplot(<strong class="lg ir">211</strong>)<br/>plt.plot(history.history['accuracy'])<br/>plt.plot(history.history['val_accuracy'])<br/>plt.title('Model Accuracy')<br/>plt.ylabel('Accuracy')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Training', 'Validation'], loc='lower right')<br/><br/># summarize history for loss<br/><br/>plt.subplot(<strong class="lg ir">212</strong>)<br/>plt.plot(history.history['loss'])<br/>plt.plot(history.history['val_loss'])<br/>plt.title('Model Loss')<br/>plt.ylabel('Loss')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Training', 'Validation'], loc='upper right')<br/><br/>plt.tight_layout()<br/><br/>plt.show()</span></pre><figure class="lb lc ld le gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mk"><img src="../Images/fefa004978e866350cc7d5d4f3c253e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jTCWT2KUGD4_ZLO9XH-mQ.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">可视化“修复”后的模型训练历史</p></figure><p id="d504" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要记住在metrics=[…]和从history对象访问键的地方使用相同的键。</p><p id="f345" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相关链接:<br/> <a class="ae mj" href="https://www.codesofinterest.com/2017/03/graph-model-training-history-keras.html" rel="noopener ugc nofollow" target="_blank">如何在Keras中绘制模型训练历史</a> <br/> <a class="ae mj" href="https://github.com/keras-team/keras/releases/tag/2.3.0" rel="noopener ugc nofollow" target="_blank"> Keras 2.3.0发行说明</a></p><p id="2911" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注:</strong>早在2020年1月，我第一次在我的博客上发表了这篇文章。但是我看到你们中的许多人仍然面临这个问题。所以我在这里重新发布它，希望能帮助许多人修复他们的代码。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="a66f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【https://www.codesofinterest.com】最初发表于<a class="ae mj" href="https://www.codesofinterest.com/2020/01/fixing-keyerror-acc-valacc-keras.html" rel="noopener ugc nofollow" target="_blank"><em class="mf"/></a><em class="mf">。</em></p></div></div>    
</body>
</html>