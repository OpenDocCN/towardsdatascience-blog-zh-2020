<html>
<head>
<title>Multivariate Normal Distribution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多元正态分布</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multivariate-normal-distribution-562b28ec0fe0?source=collection_archive---------7-----------------------#2020-11-01">https://towardsdatascience.com/multivariate-normal-distribution-562b28ec0fe0?source=collection_archive---------7-----------------------#2020-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dcf9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">多元正态分布呢？它们基本上是几个正态分布的变量捆绑在一起吗？让我们来看看。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1ddd02ce2d2b696748c331352120b45c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9Px_OMXp7a8LqJEv4e2nw.png"/></div></div></figure><p id="8d4f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正态分布，也称为高斯分布，是最常见的分布之一。一个主要原因是，独立随机变量的归一化和趋向于正态分布，而不管单个变量的分布如何(例如，您可以添加一组仅取值为-1和1的随机样本，然而随着样本数量的增加，和本身实际上变成正态分布)。这就是所谓的中心极限定理。但是当你有几个正态分布的时候，情况就变得有点复杂了(别担心，没那么多)。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="1cd5" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated"><strong class="ak">常态分布</strong></h1><p id="4c43" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">先说单个正态分布。</p><p id="c14e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设我有一个随机变量(比如我吃完午餐所花的时间…)，我对它进行10000次采样(28年来每天都做记录…)，结果会是什么样？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/11478653ed460a3c8760a218540e50b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*F8-di1XRUG2qYnBvpru_Dg.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">图一</p></figure><p id="fd0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对我来说，它可能看起来像上面的东西。由于明显的原因，它将高于0分钟，并将在20分钟左右达到峰值。当我没有太多事情要做的时候，有时我会花更长的时间来完成，有时我可能会在桌子上吃得很快，这样我就可以去工作了。</p><p id="5b44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是正态分布吗？号码</p><p id="cafe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，它的对数(自然对数)是正态分布:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/ccb53694103f9ab3fdcfde2a6e2b61dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Ym2G7c4oGcvQi9H5oPJY8Q.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">图2</p></figure><p id="4b61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:</p><ol class=""><li id="8987" class="mz na it kw b kx ky la lb ld nb lh nc ll nd lp ne nf ng nh bi translated">它是对称的。</li><li id="fc9d" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated">它的平均值是3。</li><li id="3f74" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated">它的标准差大约是0.5(相信我，我把它弄糊涂了)</li></ol><p id="7d99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">概率密度函数</strong>可以表示为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/fcd760e9bb48d0a77373e0484edae429.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*AjLU7P-ukSV45zKJBHViWw.png"/></div></figure><p id="d33f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是著名的正态分布，注意钟形！(顺便说一下，图1被称为对数正态分布，因为它的对数是正态分布)。</p><p id="425b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你的正态分布的均值是0，标准差是1，那么它就叫做<strong class="kw iu">标准正态分布</strong>。</p><p id="cdf8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一些看似随机但实际上定义了正态分布特征的事情:</p><ul class=""><li id="5834" class="mz na it kw b kx ky la lb ld nb lh nc ll nd lp no nf ng nh bi translated">样本有68.3%的概率在平均值的1个标准差之内(或31.7%的概率在平均值之外)。</li><li id="dc04" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp no nf ng nh bi translated">峰度为3。</li></ul><p id="0b44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是生成它们的python代码:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="5022" class="nu ly it nq b gy nv nw l nx ny">import numpy as np<br/>import pandas as pd<br/>from scipy.stats import norm</span><span id="d257" class="nu ly it nq b gy nz nw l nx ny">num_samples = 10000<br/>samples = norm.rvs(loc=3, scale=.5, size=(1, num_samples))[0]<br/><br/>lunch_time = pd.Series(np.exp(samples),<br/>                       name='lunch time in minutes')<br/><br/>log_lunch_time = pd.Series(samples,<br/>                           name='log of lunch time in minutes')</span></pre></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="4f19" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">不相关正态分布</h1><p id="f4bb" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在我们已经复习了正态分布，什么是多元正态分布？</p><p id="0f45" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先想到的是两个或更多的正态分布变量，这是真的。假设我生成两个正态分布变量的样本，每个样本5000个:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="e9e1" class="nu ly it nq b gy nv nw l nx ny">import numpy as np<br/>from scipy.stats import norm<br/><br/>num_samples = 5000<br/><br/>signal01 = norm.rvs(loc=0, scale=.5, size=(1, num_samples))[0]<br/>signal02 = norm.rvs(loc=0, scale=1, size=(1, num_samples))[0]</span></pre><p id="2647" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">信号01和信号02肯定是正态分布的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/a80112bb99027499a6a86b6e1ff53928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*CYL8FEeyurXJTlf3Ew_2Vg.png"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">不要介意蓝色直方图顶部的怪异，样本数量不够多</p></figure><p id="3b7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，还有更多的东西，让我们将它们绘制成散点图来看看:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7adbaa05696076020020d562b3d36fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*En87YCJBI6UbX--3EZ3TyQ.png"/></div></div></figure><p id="d617" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你看到这两个分布的散点图是如何关于x轴和y轴对称的了吗？这是因为这两种分布完全不相关:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="c129" class="nu ly it nq b gy nv nw l nx ny">np.corrcoef(signal01, signal02)<br/>'''<br/>Out[1]: <br/>array([[1.        , 0.00384419],<br/>       [0.00384419, 1.        ]])<br/>'''</span></pre><p id="ad54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是实现多变量正态分布的棘手部分，即使向量中的每个变量本身都是规则的正态分布，它们也可以彼此相关。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b76d" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">多元正态分布</h1><p id="bf94" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">让我们生成一些相关的二元正态分布。</p><p id="e4fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你会问，你如何着手做这件事？</p><p id="f8b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一步是生成2个样本标准法向量:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="422b" class="nu ly it nq b gy nv nw l nx ny">import numpy as np<br/>from scipy.stats import norm</span><span id="acff" class="nu ly it nq b gy nz nw l nx ny">num_samples = 5000<br/><br/>signal01 = norm.rvs(loc=0, scale=1, size=(1, num_samples))[0]<br/>signal02 = norm.rvs(loc=0, scale=1, size=(1, num_samples))[0]</span></pre><p id="1a1c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建所需的<strong class="kw iu">方差-协方差(vc)矩阵</strong>:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="65f2" class="nu ly it nq b gy nv nw l nx ny"># specify desired std<br/>std01 = 11.2<br/>std02 = 0.5<br/><br/>std_m = np.array([<br/>    [std01, 0],<br/>    [0, std02]<br/>])<br/><br/># specify desired correlation<br/>corr_m = np.array([<br/>    [1, .75],<br/>    [.75, 1]<br/>])<br/><br/># calc desired covariance (vc matrix)<br/>cov_m = np.dot(std_m, np.dot(corr_m, std_m))</span></pre><p id="5414" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后用Cholesky的算法分解vc矩阵:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="aeef" class="nu ly it nq b gy nv nw l nx ny">from scipy.linalg import cholesky<br/>cky = cholesky(cov_m, lower=True)</span></pre><p id="61f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，只需将该矩阵乘以不相关信号，即可获得相关信号:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="96b9" class="nu ly it nq b gy nv nw l nx ny">corr_data = np.dot(cky, [signal01, signal02])<br/><br/>signal01 = corr_data[0]<br/>signal02 = corr_data[1]<br/><br/>np.corrcoef(signal01, signal02)</span><span id="eb0c" class="nu ly it nq b gy nz nw l nx ny">'''<br/>Out[1]: <br/>array([[1.        , 0.75279088],<br/>       [0.75279088, 1.        ]])<br/>'''</span></pre><p id="05bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们来看看由此产生的散点图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bd656ed5568a5056665c1a5c7c74b814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KLh6tetwuBwt3MZHhL2-kA.png"/></div></div></figure><p id="ce72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看到散点图不再关于x轴或y轴对称，而是变得更像一条线了吗？这就是关联的效果。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="2e3c" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">衍生物</h1><p id="4f2a" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">这个过程为什么有效？</p><p id="9414" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这实际上是<strong class="kw iu">线性协方差</strong>定义的一个非常简单的结果:</p><p id="8587" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">给定一个随机变量向量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/4794ba810596ed024b2a8ec5e6462141.png" data-original-src="https://miro.medium.com/v2/resize:fit:364/format:webp/1*lG03mru5TAkRCLsOgriCXw.png"/></div></figure><p id="bdf1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">向量的方差协方差定义为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/0b997398b3474a066e65c179a6c71c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*MYW2iRNdQ3sEeagzmIdjxg.png"/></div></figure><p id="5878" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们将X乘以矩阵C，则所得向量的方差协方差为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/139c1d9af17ef2aad5a834b128bb8a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*XO9-uivgoTrBx1l4JHRpGQ.png"/></div></figure><p id="0de2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你看，由于原始X向量的分量是不相关的，方差协方差矩阵就等于:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c80790e464df8a5a825dd047d698a97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/format:webp/1*85wjPmdL4gpMSVeGxdgR0g.png"/></div></figure><p id="7d5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是我们使用Cholesky分解的原因！我们定义了一个期望的方差协方差矩阵:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="2f8e" class="nu ly it nq b gy nv nw l nx ny"># calc desired covariance (vc matrix)<br/>cov_m = np.dot(std_m, np.dot(corr_m, std_m))</span></pre><p id="b802" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它的乔莱斯基分解正好满足上面的等式！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="0605" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated"><strong class="ak">不是多元正态分布吗？</strong></h1><p id="df10" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">你可能会问:</p><blockquote class="oe of og"><p id="cc0d" class="ku kv oh kw b kx ky ju kz la lb jx lc oi le lf lg oj li lj lk ok lm ln lo lp im bi translated">什么时候随机向量不是多元正态分布的？</p></blockquote><p id="afd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">嗯，首先，如果向量中的随机变量分量本身不是正态分布的，那么结果肯定不是多元正态分布的。</p><p id="58c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">协方差矩阵也必须是半正定的，这意味着它必须是对称的:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="2518" class="nu ly it nq b gy nv nw l nx ny"># specify desired correlation<br/>corr_m = np.array([<br/>    [1, .75],<br/>    [.75, 1]<br/>])</span></pre><p id="02b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你把它改成这样:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="8198" class="nu ly it nq b gy nv nw l nx ny"># specify desired correlation<br/>corr_m = np.array([<br/>    [1, .75],<br/>    [.11, 1]<br/>])</span></pre><p id="b023" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么您得到的结果也肯定不是多元正态分布，因为这将意味着信号01和信号02的相关性不同于信号02和信号01的相关性…</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="30db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">哦，是的，你可以使用numpy的内置函数:multivariate _ normal:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="cd89" class="nu ly it nq b gy nv nw l nx ny">mean = [0, 0]<br/>cov = [[1, .5], [.5, 1]]<br/>s1, s2 = np.random.multivariate_normal(mean, cov, 5000).T</span></pre><p id="ffb8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是它一点也不酷。</p></div></div>    
</body>
</html>