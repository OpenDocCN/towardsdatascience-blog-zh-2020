<html>
<head>
<title>How to create a race bar animated plot in a single-long-piped R line of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在一行代码中创建一个种族栏动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-race-bar-animated-plot-in-a-single-long-piped-r-line-of-code-6216f09ed844?source=collection_archive---------55-----------------------#2020-10-26">https://towardsdatascience.com/how-to-create-a-race-bar-animated-plot-in-a-single-long-piped-r-line-of-code-6216f09ed844?source=collection_archive---------55-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4836" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">也许这不是最优雅的方式，但为了吸引人的标题，这是值得的</em></h2></div><p id="1d75" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">长管道R命令…有些人喜欢它，有些人不喜欢！</p><p id="68de" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">当你想要拍摄一个令人印象深刻的复杂的多米诺骨牌视频时，你是要冒险在完成之前意外地翻转一个立方体，并毁掉整个东西，还是更喜欢将它分成独立的单元，更好地隔离，这也将允许你探索和测试它的功能，而不伤害其他部分？</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/6d07b11cadb809a9a5a6881f4127e6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3suG0Ryoihwn_fuC_upWA.jpeg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated"><a class="ae ls" href="https://pixabay.com/photos/domino-hand-stop-corruption-665547/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/domino-hand-stop-corruption-665547/</a></p></figure><p id="e8bc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在R的情况下，管道操作符，最初来自包<a class="ae ls" href="https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.htmlhttps://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html" rel="noopener ugc nofollow" target="_blank">马格里特</a>，允许你传递一个对象到下一个函数。所以从技术上来说，你可以在不中断链的情况下，或者通过避免可读性较差的嵌套函数，将对象传递给其他函数。</p><p id="5cf7" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">就像上面的多米诺类比一样，我不认为有一个规则，它应该基于您对使用管道的舒适程度以及您可能具有的其他限制(如连接到数据框的外部源(或其他输入参数)、计算内存等)来自我指导。</p><p id="c2c3" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">建议打破链主要是为了可读性和文档，但就性能而言，可能不需要。这就像在一个长句子中阅读一长串步骤(功能)，而没有停下来喘口气。</p><p id="7efa" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在下面的例子中，为了便于演示，我创建了一个很长的R管道代码行，可以一次性运行。同样，这可能不是最推荐的风格，但为了吸引人的标题和{}中嵌套管道的使用，这种风格值得一试。</p><pre class="ld le lf lg gt lt lu lv lw aw lx bi"><span id="7e1f" class="ly lz iq lu b gy ma mb l mc md">JSON_object %&gt;% {setNames(data.frame(.$data), .$columns)}</span></pre><p id="6166" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我使用了新冠肺炎开放数据项目<a class="ae ls" href="https://github.com/GoogleCloudPlatform/covid-19-open-data" rel="noopener ugc nofollow" target="_blank">中美国各州的新冠肺炎累计死亡人数。</a></p><pre class="ld le lf lg gt lt lu lv lw aw lx bi"><span id="416a" class="ly lz iq lu b gy ma mb l mc md">library(robservable)<br/>library(jsonlite)<br/>library(tidyverse)</span><span id="b5cf" class="ly lz iq lu b gy me mb l mc md">robservable::robservable(<br/>  "<a class="ae ls" href="https://observablehq.com/@juba/bar-chart-race" rel="noopener ugc nofollow" target="_blank">https://observablehq.com/@juba/bar-chart-race</a>",<br/>  include = c("viewof date", "chart", "draw", "styles"),<br/>  hide = "draw",<br/>  input = list(<br/>  data = <br/>    fromJSON('<a class="ae ls" href="https://storage.googleapis.com/covid19-open-data/v2/epidemiology.json'" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/covid19-open-data/v2/epidemiology.json'</a>) %&gt;% <br/>    {setNames(data.frame(.$data), .$columns)}  %&gt;% as_tibble %&gt;% <br/>    filter(key %in% c("US", "US_AK", "US_AL", "US_AR", "US_AS", "US_AZ", "US_CA", <br/>"US_CA", "US_CO", "US_CT", "US_DC", "US_DE", "US_FL", "US_GA", <br/>"US_GA", "US_GU", "US_HI", "US_IA", "US_ID", "US_IL", "US_IN", <br/>"US_KS", "US_KY", "US_LA", "US_MA", "US_MD", "US_ME", "US_MI", <br/>"US_MN", "US_MO", "US_MP", "US_MS", "US_MT", "US_NC", "US_ND", <br/>"US_NE", "US_NH", "US_NJ", "US_NM", "US_NV", "US_NY", "US_NY", <br/>"US_OH", "US_OK", "US_OR", "US_PA", "US_PR", "US_RI", "US_SC", <br/>"US_SD", "US_TN", "US_TX", "US_UT", "US_VA", "US_VI", "US_VT", <br/>"US_WA", "US_WI", "US_WV", "US_WY")) %&gt;% <br/>    separate(key, c('US', 'state'), sep = '_') %&gt;% <br/>    mutate(month = month(date)) %&gt;%<br/>    arrange(date, state) %&gt;% <br/>    select(id = state, date = date, value = total_deceased) %&gt;% <br/>    filter(!is.na(value), value != 0),<br/>        title = "COVID-19 deaths count",<br/>        subtitle = "Cumulative number of COVID-19 deaths by US state",<br/>        source = "Source : Johns Hopkins University"<br/>    ),<br/>  width = 700,<br/>  height = 710<br/>)</span></pre><p id="b167" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">上面的代码将创建动画，以HTML文件格式保存。</p><p id="a8a8" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><a class="ae ls" href="https://github.com/drorberel/mediumHTML/blob/main/race2.html" rel="noopener ugc nofollow" target="_blank"> HTML动画文件</a>可以在我的GitHub repo找到。下面是从我的屏幕上录制的视频，因此质量下降。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mf mg l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated"><a class="ae ls" href="https://share.getcloudapp.com/6quPGBbN" rel="noopener ugc nofollow" target="_blank">https://share.getcloudapp.com/6quPGBbN</a>作者</p></figure><p id="041a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这篇博文与我前一天发表的标题与新冠肺炎相关的<a class="ae ls" href="https://drorberel.medium.com/covid-19-death-visualization-race-bar-chart-for-us-states-96edc59102a9" rel="noopener">博文非常相似。虽然侧重点不同，但发布类似帖子的原因是为了测试每个帖子会吸引多少“观众注意力”(掌声和观看次数)。当然，每篇文章都有不同的推广方式:在聚合出版物下发布，LinkedIn，脸书，Twitter，R-bloggers，发布日效应，等等。我很乐意稍后分享我的发现。</a></p></div></div>    
</body>
</html>