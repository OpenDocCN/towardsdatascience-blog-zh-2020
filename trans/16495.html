<html>
<head>
<title>Predict House Prices with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习预测房价</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predict-house-prices-with-machine-learning-5b475db4e1e?source=collection_archive---------4-----------------------#2020-11-14">https://towardsdatascience.com/predict-house-prices-with-machine-learning-5b475db4e1e?source=collection_archive---------4-----------------------#2020-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3b28" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对1，883个家庭进行回归模型训练</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/220db7348815317c22b4e1aea6f3422c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wu6ec7zO54fqqEk0lzrmw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://www.gregcarter.com.au/2018/11/07/when-can-real-estate-agent-be-held-liable-for-misleading-and-deceptive-conduct/" rel="noopener ugc nofollow" target="_blank">格雷戈·卡特</a>大律师&amp;事务律师。</p></figure><p id="7e61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">财产估价是一门不精确的科学。个人评估师和估价师把他们自己的经验、标准和技能带到工作中。一致性是很难的，英国和澳大利亚的研究表明，两个专业人士的估值<a class="ae ky" href="https://core.ac.uk/download/pdf/10879426.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">相差高达40% </strong> </a>。哎呀！</p><p id="d5ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也许一台训练有素的机器可以代替人类来完成这项任务，而且一致性和准确性更高。</p><p id="1b02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将这一想法原型化，并使用关于房屋的<strong class="lb iu"> <em class="lv">特征</em> </strong>、<strong class="lb iu"> <em class="lv">成本</em> </strong>和<strong class="lb iu"> <em class="lv">邻居简介</em> </strong>的数据来训练一些ML模型，以预测其价值。我们的目标变量<strong class="lb iu">房地产价格</strong>是数字，因此ML任务是<strong class="lb iu">回归</strong>。(对于分类目标，任务变为<a class="ae ky" rel="noopener" target="_blank" href="/will-your-employee-leave-a-machine-learning-model-8484c2a6663e">分类</a>。)</p><p id="9ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用来自elitedatascience.com的数据集来模拟属于房地产投资信托基金的1883处房产的投资组合。有26列。这里有一小段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/7184c412ab0212800ebcff682dbc3fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8M8iGLYHvjINKpwWvon1SQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/5b2ebdbe27cc3768453892581cf29c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpyiP5nDJ3kRkvuU8ikw4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始数据集的快照。</p></figure><p id="c93b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些步骤是:</p><ol class=""><li id="ab60" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu md me mf mg bi translated"><strong class="lb iu"> EDA &amp;数据处理:</strong>探索、可视化和清理数据。</li><li id="8901" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu md me mf mg bi translated"><strong class="lb iu">特性工程:</strong>利用领域专长，创造新特性。</li><li id="1047" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu md me mf mg bi translated"><strong class="lb iu">模型训练:</strong>我们将训练和调优一些屡试不爽的分类算法，比如岭和套索回归。</li><li id="8ab9" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu md me mf mg bi translated"><strong class="lb iu">性能评估:</strong>我们将看看常见的回归任务指标，如R分数和均方平均值。</li><li id="b7c0" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu md me mf mg bi translated"><strong class="lb iu">部署:</strong>批量运行还是弄几个数据工程师/ ML工程师来建一个自动化流水线？</li></ol><p id="fdc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加入Medium <a class="ae ky" href="https://col-jung.medium.com/membership" rel="noopener">这里</a>并获得<strong class="lb iu">无限制访问</strong>互联网上最好的数据科学文章。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="1e58" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">1.数据探索和处理</h1><p id="168e" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated"><strong class="lb iu">探索性数据分析(EDA) </strong>帮助我们理解数据，为<strong class="lb iu">数据清洗</strong>和<strong class="lb iu">特征工程</strong>提供思路和见解。数据清理为我们的算法准备数据，而特征工程是真正帮助我们的算法从数据集中提取潜在模式的神奇调味汁。请记住:</p><blockquote class="nq"><p id="2a5f" class="nr ns it bd nt nu nv nw nx ny nz lu dk translated">更好的数据总是胜过更好的算法！</p></blockquote><p id="5b62" class="pw-post-body-paragraph kz la it lb b lc oa ju le lf ob jx lh li oc lk ll lm od lo lp lq oe ls lt lu im bi translated">我们首先将一些标准数据科学Python包加载到<a class="ae ky" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> JupyterLab </a>中。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="cc59" class="ok mu it og b gy ol om l on oo">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sb</span><span id="95f6" class="ok mu it og b gy op om l on oo">from sklearn.linear_model import LinearRegression<br/>from sklearn.linear_model import Lasso, Ridge, ElasticNet<br/>from sklearn.ensemble import RandomForestRegressor,<br/>                             GradientBoostingRegressor</span><span id="e98a" class="ok mu it og b gy op om l on oo">from sklearn.model_selection import train_test_split<br/>from sklearn.pipeline import make_pipeline<br/>from sklearn.preprocessing import StandardScaler<br/>from sklearn.model_selection import GridSearchCV</span><span id="e70d" class="ok mu it og b gy op om l on oo">from sklearn.metrics import r2_score,<br/>                            mean_absolute_error </span><span id="d320" class="ok mu it og b gy op om l on oo">import pickle</span></pre><p id="a048" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入数据集:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="4f69" class="ok mu it og b gy ol om l on oo">df = pd.read_csv('real_estate_data.csv')</span></pre><p id="6886" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们数据帧的快照。形状是(1，883，26)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/074d42702b8f56f51d1091531da278bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PgTtMVD84thH8OQt3hTZxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始数据集的快照。单击以展开。</p></figure><p id="0fe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目标变量是<strong class="lb iu"> tx_price </strong>，它表示房产最后出售的价格。</p><p id="da06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">共有25个栏/特征。</p><ul class=""><li id="d4a4" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu or me mf mg bi translated">房产特征:<strong class="lb iu"> tx_year </strong> —最后出售的年份，<strong class="lb iu"> property_type </strong>(独栋与公寓/公寓/联排别墅)。</li><li id="2908" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">物业费:每月<strong class="lb iu">财产税</strong>和<strong class="lb iu">保险</strong>。</li><li id="815d" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">物业特点:<strong class="lb iu">床、浴池</strong>、<strong class="lb iu"> sqrt </strong>(建筑面积)、<strong class="lb iu"> lot_size </strong>(含套外面积)、<strong class="lb iu">year _ build</strong>&amp;<strong class="lb iu">地下室</strong>(是/否)。</li><li id="697c" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">邻里生活方式:数量<strong class="lb iu">餐厅</strong>、<strong class="lb iu">杂货</strong>、<strong class="lb iu">夜生活</strong>、<strong class="lb iu">咖啡馆</strong>、<strong class="lb iu">购物</strong>、<strong class="lb iu">艺术_娱乐</strong>、<strong class="lb iu">美容spa</strong>、&amp;、<strong class="lb iu">活跃_生活</strong>(健身房、瑜伽馆等。)半径1英里以内。</li><li id="8178" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">邻里人口统计:<strong class="lb iu">中位年龄</strong>、<strong class="lb iu">已婚</strong> (%)、<strong class="lb iu">大学毕业生</strong> (%)。</li><li id="60e1" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">邻里学校:<strong class="lb iu">数量_学校</strong>(区内)&amp; <strong class="lb iu">中位数_学校</strong>(区内公立学校10分中的中位数)。</li></ul></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="c5be" class="ok mu it bd mv os ot dn mz ou ov dp nd li ow ox nf lm oy oz nh lq pa pb nj pc bi translated"><strong class="ak"> 1.1数字特征</strong></h2><p id="8599" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们的数字特征列表可以通过代码获得:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="46ac" class="ok mu it og b gy ol om l on oo">df.dtypes[df.dtypes!=’object’]</span></pre><p id="f7e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在这里跳过它。相反，让我们直奔所有数字特征的直方图:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="4d46" class="ok mu it og b gy ol om l on oo">df.hist(figsize=(20,20), xrot=-45)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/e3f4b180f74b7d0cd33ddea82224d9c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NwrN7hk4vxOa850h1IDaGA.png"/></div></div></figure><p id="73eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这看起来基本没问题。我用红色留下了一些评论。</p><p id="69d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目标变量(tx_price)的分布:</strong></p><p id="b671" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有一个右尾分布，也可以通过看一个<strong class="lb iu">小提琴图</strong>来看。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="615b" class="ok mu it og b gy ol om l on oo">sns.violinplot(data=df, x=’tx_price’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/a8e75f4d0ca56d4b3288cdaf438042b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*mQyLGrnunpiqt3aAyb3-og.png"/></div></figure><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="010d" class="ok mu it og b gy ol om l on oo">df.tx_price.median()</span><span id="6043" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output: 392000</strong></span></pre><p id="3815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2020年10月，美国房价中值为325，000美元，因此平均而言，房地产投资信托组合中的房屋似乎更靠近住宅区。</p><p id="bfeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">缺失值:</strong></p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="9561" class="ok mu it og b gy ol om l on oo">df.select_dtypes(exclude=[‘object’]).isnull().sum()</span><span id="0129" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>tx_price              0<br/>beds                  0<br/>baths                 0<br/>sqft                  0<br/>year_built            0<br/>lot_size              0<br/>basement              223<br/>restaurants           0<br/>groceries             0<br/>nightlife             0<br/>cafes                 0<br/>shopping              0<br/>arts_entertainment    0<br/>beauty_spas           0<br/>active_life           0<br/>median_age            0<br/>married               0<br/>college_grad          0<br/>property_tax          0<br/>insurance             0<br/>median_school         0<br/>num_schools           0<br/>tx_year               0</strong></span></pre><p id="5821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对<strong class="lb iu">基底</strong>特性的进一步研究表明基底=0的行是用NaN编码的。因此，这实际上是一个<strong class="lb iu">标签不正确</strong>的问题。我们需要把NaN转换成0来进行运算。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="aff7" class="ok mu it og b gy ol om l on oo">df.basement.fillna(0, inplace=True)</span></pre><p id="4715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:如果这些NaN是真正缺失的值，我们应该在将</em> <strong class="lb iu"> <em class="lv">基底</em> </strong> <em class="lv">中的NaN转换为0之前，创建一个指示变量</em> <strong class="lb iu"> <em class="lv">基底_缺失</em> </strong> <em class="lv">(当基底=NaN时值为1)。</em></p><p id="9ba1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">异常值:lot _ size<strong class="lb iu">lot _ size</strong>的直方图表明我们有一些相当大的豪宅！</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="c8d0" class="ok mu it og b gy ol om l on oo">df.lot_size.sort_values(ascending=False)</span><span id="9f70" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>102     1220551<br/>1111     436471<br/>1876     436035<br/>1832     436035<br/>1115     435600<br/>Name: lot_size, dtype: int64</strong></span></pre><p id="12fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，只有一处房产比其他的大很多。让我们把它看作一个离群值，并为我们的建模过滤掉它。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="6ef2" class="ok mu it og b gy ol om l on oo">df = df[df.lot_size &lt; 500000]</span></pre><p id="9d22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一张<strong class="lb iu">关联热图</strong>来展示我们的数字特征。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="1a99" class="ok mu it og b gy ol om l on oo"># mask out upper triangle<br/>mask = np.zeros_like(df.corr(), dtype=np.bool)<br/>mask[np.triu_indices_from(mask)] = True</span><span id="3a30" class="ok mu it og b gy op om l on oo"># heatmap<br/>sb.heatmap(df.corr()*100, <br/>           cmap='RdBu_r', <br/>           annot = True, <br/>           mask = mask)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/2dc2647da211d4da771dbebf16339827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1gEMfg2Zem4Zti6eQ8aYg.png"/></div></div></figure><p id="46b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">红色的三角形块表明邻近地区的生活方式特征往往相互关联得很好。例如，<strong class="lb iu">活跃生活、美容水疗、咖啡馆、夜生活</strong>和<strong class="lb iu">餐馆</strong>都高度相关。这种多重共线性可能会影响模型性能，因为回归要素应该独立于<a class="ae ky" href="https://statisticsbyjim.com/regression/multicollinearity-in-regression-analysis/" rel="noopener ugc nofollow" target="_blank">和</a>。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="a2e4" class="ok mu it bd mv os ot dn mz ou ov dp nd li ow ox nf lm oy oz nh lq pa pb nj pc bi translated">1.2分类特征</h2><p id="723b" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们的分类变量可以用代码列出:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0fa2" class="ok mu it og b gy ol om l on oo">df.dtypes[df.dtypes==’object’]</span></pre><p id="dde2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是:<strong class="lb iu">物业_类型</strong>、<strong class="lb iu">外墙</strong>和<strong class="lb iu">屋顶。</strong></p><p id="58fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些分类特征中的每一个的类都可以用下列方式列出:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0407" class="ok mu it og b gy ol om l on oo">df.property_type.value_counts()</span><span id="94c3" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>Single-Family                    1080<br/>Apartment / Condo / Townhouse     802<br/>Name: property_type, dtype: int64</strong></span><span id="6296" class="ok mu it og b gy op om l on oo">df.exterior_walls.value_counts()</span><span id="d219" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>Brick                  686<br/>Siding (Alum/Vinyl)    503<br/>Metal                  120<br/>Combination            107<br/>Wood                    72<br/>Wood Siding             49<br/>Brick veneer            48<br/>Stucco                  26<br/>Other                   10<br/>Concrete                 8<br/>Concrete Block           7<br/>Block                    7<br/>Asbestos shingle         6<br/>Rock, Stone              5<br/>Masonry                  3<br/>Wood Shingle             2<br/>Name: exterior_walls, dtype: int64</strong></span><span id="006e" class="ok mu it og b gy op om l on oo">df.roof.value_counts()</span><span id="374e" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>Composition Shingle      1179<br/>Asphalt                   132<br/>Shake Shingle              55<br/>Other                      49<br/>Wood Shake/ Shingles       30<br/>Gravel/Rock                30<br/>Roll Composition           12<br/>Asbestos                    9<br/>Slate                       9<br/>Composition                 5<br/>asphalt                     5<br/>Metal                       4<br/>composition                 4<br/>shake-shingle               3<br/>Built-up                    2<br/>asphalt,shake-shingle       1<br/>Name: roof, dtype: int64</strong></span></pre><p id="13c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由此，我们可以稍微清理一下类。我们将</p><ul class=""><li id="b6e2" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu or me mf mg bi translated">将稀疏类合并在一起(那些观察值太少的类)</li><li id="4cd9" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">合并具有相似含义的类(例如将<em class="lv">混凝土</em>和<em class="lv">砌块</em>归入更一般的<em class="lv">混凝土砌块</em>类。</li><li id="82f6" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">修正标签错误(例如<em class="lv">混凝土</em>应为<em class="lv">混凝土</em>)。</li></ul><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="78c3" class="ok mu it og b gy ol om l on oo">df.exterior_walls.replace(['Wood Siding', 'Wood Shingle', 'Wood'],<br/>                           'Wood', inplace=True)</span><span id="b004" class="ok mu it og b gy op om l on oo">df.exterior_walls.replace(‘Rock, Stone’, ’Masonry’, inplace=True)</span><span id="6f05" class="ok mu it og b gy op om l on oo">df.exterior_walls.replace([‘Concrete’,’Block’], ’Concrete Block’,<br/>                            inplace=True)</span><span id="39c5" class="ok mu it og b gy op om l on oo">df.exterior_walls.replace(['Concrete Block', 'Stucco', 'Concrete',<br/>                           'Block', 'Masonry', 'Other', <br/>                           'Asbestos shingle', 'Rock, Stone'],<br/>                           'Other', inplace=True)</span><span id="854d" class="ok mu it og b gy op om l on oo">df.roof.replace(['Composition', 'Wood Shake/ Shingles', <br/>                 'Composition Shingle'], 'Composition Shingle',<br/>                  inplace=True)</span><span id="a650" class="ok mu it og b gy op om l on oo">df.roof.replace(['Other', 'Gravel/Rock', 'Roll Composition',<br/>                 'Slate', 'Built-up', 'Asbestos', 'Metal'], 'Other',<br/>                  inplace=True)</span><span id="271f" class="ok mu it og b gy op om l on oo">df.roof.replace(['asphalt','asphalt,shake-shingle',<br/>                 'shake-shingle'], 'Shake Shingle', inplace=True)</span><span id="ad90" class="ok mu it og b gy op om l on oo">df.roof.replace('composition', 'Composition',inplace=True)</span></pre><p id="d1ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">缺失值:</strong></p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="448b" class="ok mu it og b gy ol om l on oo">df.select_dtypes(include=[‘object’]).isnull().sum()</span><span id="1cf9" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>property_type       0<br/>exterior_walls    223<br/>roof              353<br/>dtype: int64</strong></span></pre><p id="afe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想告诉我们的算法，这些值是<em class="lv">缺少</em>。这比简单地删除行更有指导意义。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="2aa2" class="ok mu it og b gy ol om l on oo">for feat in df.select_dtypes(include=[‘object’]):<br/>    df[feat] = df[feat].fillna(“Missing”)</span></pre><p id="3e8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们画出三个分类特征的柱状图。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="01ca" class="ok mu it og b gy ol om l on oo">for feat in df.dtypes[df.dtypes==’object’].index:<br/>   sb.countplot(y=feat, data=df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/f15fe14067c6b5ea8d429328abd88d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wi8LElu6rCAsyz7XhsahGw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/e3b5e31cbec7a7dbb0341ac36c624c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ixSORtmJdSscCr3hidQEoQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/925c2ba9604705cb6e282c62d7374306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xJphIha8KA6OfwoDgNjcw.png"/></div></div></figure><p id="1b52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，对于我们的算法，分类特征必须是一次性编码的。我们现在就去做。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0f4a" class="ok mu it og b gy ol om l on oo">df = pd.get_dummies(df, columns = [‘exterior_walls’, <br/>                                   ‘roof’, <br/>                                   ‘property_type’])</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="1ef5" class="ok mu it bd mv os ot dn mz ou ov dp nd li ow ox nf lm oy oz nh lq pa pb nj pc bi translated">1.3细分</h2><p id="41ba" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">分割结合了数字和分类特征。</p><p id="19b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们根据我们的目标<strong class="lb iu"> tx_price </strong>来分割我们所有的分类变量(<strong class="lb iu"> property_type </strong>、<strong class="lb iu">外墙</strong>和<strong class="lb iu">屋顶</strong>)。这将提供一个可能驱动财产价值的细节。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="384e" class="ok mu it og b gy ol om l on oo">for feat in df.dtypes[df.dtypes==’object’].index:<br/>   sb.boxplot(data=df, x = ‘tx_price’, y = ‘{}’.format(feat))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/44c33714d27fcc5495561750f6b228cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*HpMYKMfia6ArPVUBaZ2CAA.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/6d28ec5690f992abbe286305291843f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*9rAM9I203zlLtR2duSWiGw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/aa57cf5588f7d3953afaceec46653d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*3iVpPgFNy4LZ7UxX80vQYA.png"/></div></figure><p id="19f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过使用<strong class="lb iu"> groupby </strong>来看看单户住宅和公寓/共管公寓/联排别墅之间的房产和街区特征有何不同。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="8c9f" class="ok mu it og b gy ol om l on oo">df.groupby('property_type').agg(['mean','median'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/e8683c0a50cad24a41f74d15768ac91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXqUJLcRaFAFiCgzbbXwQg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/4445613ccc742a4c2ace9254903687be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBmOxoR63Di5taOPzPMDfg.png"/></div></div></figure><p id="b262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，独栋房子更贵，面积更大，而公寓/公寓/联排别墅更靠近娱乐场所/商店，吸引更年轻的居民。这并不奇怪。家庭住宅往往位于郊区，而公寓和更高密度的居住往往更靠近市中心。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="4aea" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">2.特征工程</h1><p id="8ac4" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">许多特征工程依赖于领域专业知识。如果你有一个房地产方面的主题专家(SME)来提供指导，你将有更好的机会设计一些令人敬畏的功能，这些功能将真正使你的建模发光。</p><p id="e30d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将设计四个新功能:</p><ul class=""><li id="5d66" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu or me mf mg bi translated"><strong class="lb iu">两房两卫</strong>:两房两卫房产。为什么？通过领域专业知识，你可能知道这些财产受投资者欢迎。这是一个指示变量。</li><li id="2f98" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">衰退期间:美国房地产市场在2010年至2013年间陷入衰退。因此，处于这一时期可能会在很大程度上影响定价。</li><li id="3d47" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated"><strong class="lb iu"> property_age </strong>:这是一种常识。较新的物业应该吸引较高的价格，对不对？(回答:会但不一定。)</li><li id="acd3" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated"><strong class="lb iu"> school_score </strong>:我们将这个<em class="lv">交互特征</em>定义为<strong class="lb iu"> num_school </strong>和<strong class="lb iu"> median_school </strong>的乘积，它给出了代表该地区学校教育质量的单一分数。</li></ul><p id="9d80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下代码创建了这些新功能。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="06e4" class="ok mu it og b gy ol om l on oo">df[‘two_and_two’] = ((df.beds == 2) &amp; (df.baths == 2)).astype(int)</span><span id="e52c" class="ok mu it og b gy op om l on oo">df['during_recession'] = ((df.tx_year &gt;= 2010) &amp; <br/>                          (df.tx_year &lt;= 2013))<br/>                          .astype(int)</span><span id="81ad" class="ok mu it og b gy op om l on oo">df['property_age'] = df.tx_year - df.year_built<br/>df.drop(['tx_year', 'year_built'], axis=1, inplace=True)</span><span id="5a76" class="ok mu it og b gy op om l on oo">df['school_score'] = df.num_schools * df.median_school</span></pre><p id="be2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">新的<strong class="lb iu"> property_age </strong>功能可以说取代了原来的<strong class="lb iu"> tx_year </strong>和<strong class="lb iu">year _ build</strong>，因此我们将删除它们。</p><p id="6bff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，出于兴趣，我们可以看到大约9%的房产有两张床/两个浴室，26%是在2010年至2013年的房地产衰退期间出售的:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="ebcd" class="ok mu it og b gy ol om l on oo">df.two_and_two.mean()<br/>df.during_recession.mean()</span><span id="abc4" class="ok mu it og b gy op om l on oo"><strong class="og iu">Outputs:<br/>0.09458023379383634<br/>0.2635494155154091</strong></span></pre><p id="0ffa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">分析基表:</strong>应用所有这些数据清洗步骤和特征工程后的数据集就是我们的<strong class="lb iu">分析基表</strong>。这是我们训练模型的数据。</p><p id="5bd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的ABT有1863个属性和40列。<em class="lv">回想一下，我们的原始数据集只有26列！</em>通常，abt比原始数据集有更多的列，因为:</p><ul class=""><li id="f5b4" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu or me mf mg bi translated">one-hot编码，其中为<em class="lv">每个</em>分类特征中的每个类创建一个新列；和</li><li id="5a2b" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">特征工程。</li></ul><p id="ba9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与此相关，ML中的一个问题是<a class="ae ky" href="https://www.mygreatlearning.com/blog/understanding-curse-of-dimensionality/" rel="noopener ugc nofollow" target="_blank">维数灾难</a>，其中你的ABT有太多的列/特征。这是深度学习中的一个主要问题，在深度学习中，数据处理可能会产生具有数千个或更多特征的abt。<strong class="lb iu">主成分分析(PCA) </strong>是一种降维技术，将高维相关数据转化为一组低维的不相关成分，称为<strong class="lb iu">主成分</strong> (PC)。好消息是，低维的PCs捕获了高维数据集中的大部分信息。</p><p id="27eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我计划写一篇关于无监督学习技术的文章，包括PCA。睁大你的眼睛！</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="c092" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">3.系统模型化</h1><p id="faf6" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们将训练四个屡试不爽的回归模型:</p><ul class=""><li id="2a28" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu or me mf mg bi translated"><strong class="lb iu">正则化线性回归</strong>(山脊套索&amp;弹性网)</li><li id="3943" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated"><strong class="lb iu">随机森林</strong></li><li id="e9ba" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated"><strong class="lb iu">梯度增强树</strong></li></ul><p id="f00e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们拆分我们的分析基表。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0f68" class="ok mu it og b gy ol om l on oo">y = df.status<br/>X = df.drop('tx_price', axis=1)</span></pre><p id="303d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们将分成训练集和测试集。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="daf4" class="ok mu it og b gy ol om l on oo">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=1234)</span></pre><p id="35c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将设置一个<strong class="lb iu">管道对象</strong>来训练。这将简化我们的模型训练过程。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="5f50" class="ok mu it og b gy ol om l on oo">pipelines = {<br/>    'lasso' : make_pipeline(StandardScaler(),<br/>              Lasso(random_state=123)),<br/>    'ridge' : make_pipeline(StandardScaler(),<br/>              Ridge(random_state=123)),<br/>    'enet' :  make_pipeline(StandardScaler(),<br/>              ElasticNet(random_state=123)),<br/>    'rf' :    make_pipeline(<br/>              RandomForestRegressor(random_state=123)),<br/>    'gb' :    make_pipeline(<br/>              GradientBoostingRegressor(random_state=123))<br/>}</span></pre><p id="b760" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还想调整每个算法的<strong class="lb iu">超参数</strong>。</p><p id="f1ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于所有三个正则化回归，我们将调整<strong class="lb iu"> alpha </strong> (L1 &amp; L2惩罚强度)，以及弹性网的<strong class="lb iu"> l1_ratio </strong>(即L1 &amp; L2惩罚之间的权重)。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0c17" class="ok mu it og b gy ol om l on oo">lasso_hyperparameters = {<br/>    ‘lasso__alpha’ : [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1, 5, 10]}</span><span id="a817" class="ok mu it og b gy op om l on oo">ridge_hyperparameters = {<br/>    ‘ridge__alpha’ : [0.001, 0.005, 0.01, 0.1, 0.5, 1, 5, 10]}</span><span id="fba1" class="ok mu it og b gy op om l on oo">enet_hyperparameters = { <br/>    ‘elasticnet__alpha’: [0.001, 0.005, 0.01, 0.05, 0.1, 1, 5, 10], <br/>    ‘elasticnet__l1_ratio’ : [0.1, 0.3, 0.5, 0.7, 0.9]}</span></pre><p id="1efc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的随机森林，我们将调整估计器的数量(<strong class="lb iu"> n_estimators </strong>)和分割期间要考虑的最大特征数量(<strong class="lb iu"> max_features </strong>)，以及作为一片叶子的最小样本数量(<strong class="lb iu"> min_samples_leaf </strong>)。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="5a42" class="ok mu it og b gy ol om l on oo">rf_hyperparameters = {<br/>     ‘randomforestregressor__n_estimators’ : [100, 200],<br/>     ‘randomforestregressor__max_features’ : [‘auto’, ‘sqrt’, 0.33],<br/>     'randomforestregressor__min_samples_leaf' : [1, 3, 5, 10]}</span></pre><p id="1413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的梯度增强树，我们将调整估计器的数量(<strong class="lb iu"> n_estimators </strong>)、<strong class="lb iu">学习速率</strong>，以及每棵树的最大深度(<strong class="lb iu"> max_depth </strong>)。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="8c7e" class="ok mu it og b gy ol om l on oo">gb_hyperparameters = {<br/>      ‘gradientboostingregressor__n_estimators’ : [100, 200],<br/>      ‘gradientboostingregressor__learning_rate’ : [0.05, 0.1, 0.2],<br/>      ‘gradientboostingregressor__max_depth’ : [1, 3, 5]}</span></pre><p id="282f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将拟合和调整我们的模型。使用<strong class="lb iu"> GridSearchCV </strong>，我们可以用几行代码在我们声明的所有超参数上对所有这些模型进行交叉验证训练！</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="e98e" class="ok mu it og b gy ol om l on oo">fitted_models = {}<br/>for name, pipeline in pipelines.items():<br/>    model = GridSearchCV(pipeline, <br/>                         hyperparameters[name], <br/>                         cv=10, <br/>                         n_jobs=-1)<br/>    model.fit(X_train, y_train)<br/>    fitted_models[name] = model</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="1abf" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">4.估价</h1><p id="8cae" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我写了一篇关于流行的机器学习指标的<a class="ae ky" rel="noopener" target="_blank" href="/popular-machine-learning-performance-metrics-a2c33408f29">专门文章</a>，包括下面使用的那些。</p><h2 id="76e0" class="ok mu it bd mv os ot dn mz ou ov dp nd li ow ox nf lm oy oz nh lq pa pb nj pc bi translated">4.1绩效得分</h2><p id="1216" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们将从打印<strong class="lb iu">交叉验证分数</strong>开始。这是10个保留折叠的平均性能，是仅使用您的训练数据获得模型性能<strong class="lb iu">的可靠估计的一种方式。</strong></p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="7929" class="ok mu it og b gy ol om l on oo">for name, model in fitted_models.items():<br/>    print( name, model.best_score_ )</span><span id="4c44" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>lasso 0.3085486180300333<br/>ridge 0.3165464682513239<br/>enet 0.34280536738492506<br/>rf 0.4944720180590308<br/>gb 0.48797200970900745</strong></span></pre><p id="cbf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移动到<strong class="lb iu">测试数据</strong>，我们将输出<a class="ae ky" href="https://en.wikipedia.org/wiki/Coefficient_of_determination" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a>和<a class="ae ky" href="https://en.wikipedia.org/wiki/Mean_absolute_error" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">平均绝对误差</strong> </a> <strong class="lb iu"> (MAE) </strong>。</p><p id="6e40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">R -score代表模型解释的总方差的<a class="ae ky" href="https://www.bmc.com/blogs/mean-squared-error-r2-and-variance-in-regression-analysis/" rel="noopener ugc nofollow" target="_blank">比例，范围从0到100。如果R -score = 100，则因变量(<strong class="lb iu"> tx_price </strong>)与特征完全相关。</a></p><p id="6714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MAE是预测值和实际值之间的平均误差。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="130d" class="ok mu it og b gy ol om l on oo">for name, model in fitted_models.items():<br/>   pred = model.predict(X_test)<br/>   print(name)<br/>   print(‘ — — — — ‘)<br/>   print(‘R²:’, r2_score(y_test, pred))<br/>   print(‘MAE:’, mean_absolute_error(y_test, pred))<br/>   print()</span><span id="65a0" class="ok mu it og b gy op om l on oo"><strong class="og iu">Output:<br/>lasso<br/>--------<br/>R^2: 0.4088031693011063<br/>MAE: 85041.97658598644<br/><br/>ridge<br/>--------<br/>R^2: 0.4092637562314514<br/>MAE: 84982.89969349177<br/><br/>enet<br/>--------<br/>R^2: 0.40522476546064634<br/>MAE: 86297.65161608408<br/><br/>rf<br/>--------<br/>R^2: 0.5685576834419455<br/>MAE: 68825.53227240045<br/><br/>gb<br/>--------<br/>R^2: 0.5410951822821564<br/>MAE: 70601.60664940192</strong></span></pre><p id="31a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">胜出的算法是随机森林，R分最高0.57，MAE最低。我们实际上可以做得更好。</p><p id="ba02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还记得之前我们移除了<strong class="lb iu"> tx_year </strong>和<strong class="lb iu">year _ build</strong>特性后的工程<strong class="lb iu"> property_age </strong>吗？事实证明这是个错误的选择。如果将它们包括在内，模型的性能将大幅提升，达到R = 0.81。此外，省略一些高度相关的邻居简档特征(即<strong class="lb iu">活跃_生活、美容_水疗、咖啡馆、夜生活</strong>和<strong class="lb iu">餐馆</strong>)会进一步提高性能。这突出了<strong class="lb iu">特征工程</strong>和<strong class="lb iu">特征选择的重要性。</strong></p><p id="1d86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅供参考，这里是获胜随机森林的超参数，使用GridSearchCV进行了调整。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="1b65" class="ok mu it og b gy ol om l on oo">RandomForestRegressor(bootstrap=True, <br/>                      criterion='mse',<br/>                      max_depth=None,<br/>                      max_features='auto',<br/>                      max_leaf_nodes=None,<br/>                      min_impurity_decrease=0.0,<br/>                      min_impurity_split=None,<br/>                      min_samples_leaf=10, <br/>                      min_samples_split=2,<br/>                      min_weight_fraction_leaf=0.0,<br/>                      n_estimators=200, <br/>                      n_jobs=None,<br/>                      oob_score=False, <br/>                      random_state=123,<br/>                      verbose=0, <br/>                      warm_start=False))],</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="1693" class="ok mu it bd mv os ot dn mz ou ov dp nd li ow ox nf lm oy oz nh lq pa pb nj pc bi translated">4.2特性重要性</h2><p id="f335" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">考虑下面的代码。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="334d" class="ok mu it og b gy ol om l on oo">coef = winning_model.feature_importances_<br/>ind = np.argsort(-coef)</span><span id="e132" class="ok mu it og b gy op om l on oo">for i in range(X_train.shape[1]):<br/>    print("%d. %s (%f)" % (i + 1, X.columns[ind[i]], coef[ind[i]]))</span><span id="0173" class="ok mu it og b gy op om l on oo">x = range(X_train.shape[1])<br/>y = coef[ind][:X_train.shape[1]]</span><span id="055a" class="ok mu it og b gy op om l on oo">plt.title("Feature importances")<br/>ax = plt.subplot()<br/>plt.barh(x, y, color='red')<br/>ax.set_yticks(x)<br/>ax.set_yticklabels(X.columns[ind])<br/>plt.gca().invert_yaxis(</span></pre><p id="ae40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将打印按重要性排序的特性列表和相应的条形图。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="c982" class="ok mu it og b gy ol om l on oo"><strong class="og iu">1. insurance (0.580027)<br/>2. property_tax (0.148774)<br/>3. sqft (0.033958)<br/>4. property_age (0.031218)<br/>5. during_recession (0.027909)<br/>6. college_grad (0.022310)<br/>7. lot_size (0.020546)<br/>8. median_age (0.016930)<br/>9. married (0.015506)<br/>10. beauty_spas (0.013840)<br/>11. active_life (0.011257)<br/>12. shopping (0.010523)<br/>13. school_score (0.010032)<br/>14. restaurants (0.009975)<br/>15. median_school (0.007809)<br/>16. baths (0.007009)<br/>17. cafes (0.005914)<br/>18. groceries (0.005578)<br/>19. nightlife (0.004049)<br/>20. arts_entertainment (0.003944)<br/>21. beds (0.003364)<br/>22. exterior_walls_Siding (Alum/Vinyl) (0.001808)<br/>23. exterior_walls_Brick (0.001348)<br/>24. roof_Composition Shingle (0.001239)<br/>25. roof_Missing (0.000778)<br/>26. roof_Shake Shingle (0.000750)<br/>27. exterior_walls_Missing (0.000632)<br/>28. num_schools (0.000616)<br/>29. exterior_walls_Metal (0.000578)<br/>30. basement (0.000348)</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/5780ba3dfe1a74396e3ff79371ee9ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Dejb6bX5JKhv97NQVdZlA.png"/></div></div></figure><p id="1419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，前两个预测值是</p><ul class=""><li id="10eb" class="ly lz it lb b lc ld lf lg li ma lm mb lq mc lu or me mf mg bi translated">每月房主保险<strong class="lb iu">的费用</strong>和</li><li id="fd21" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">每月<strong class="lb iu">财产税</strong>。</li></ul><p id="0cb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这并不完全令人惊讶，因为保险费通常是由保险公司根据重置建筑物的成本来计算的。这需要——令人惊讶的是——对建筑物的价值进行良好的估价。同样，财产税的金额通常与房产价值挂钩。</p><p id="9b9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来的两个最强的预测器是资产的大小(<strong class="lb iu"> sqft </strong>)和它有多老(<strong class="lb iu"> property_age </strong>)。较大和较新的房产往往在市场上卖得更多，因此这些结果也符合预期。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="50cd" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">5.部署</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/31dd3261125fefcb14fdf597ea873c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iVqnRvZ4AQ0W-AjpYeZ9ag.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@thisisengineering" rel="noopener ugc nofollow" target="_blank"> ThisisEngineering RAEng </a>提供。</p></figure><p id="b3d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此模型的可执行版本(。pkl)可以从Jupyter笔记本中保存:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="7da5" class="ok mu it og b gy ol om l on oo">with open('final_model.pkl', 'wb') as f:<br/>    pickle.dump(fitted_models['rf'].best_estimator_, f)</span></pre><p id="97a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">房地产投资信托基金可以在将新的住房数据输入训练模型之前对其进行预处理。这称为批量运行。</p><p id="dfb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个大型组织中，REIT可能希望通过与<strong class="lb iu">数据工程师</strong>和<strong class="lb iu">机器学习工程师</strong>合作，将模型部署到<strong class="lb iu">生产环境</strong>中。这些专家将围绕我们的模型建立一个自动化的管道，确保新的属性数据可以通过我们的清洗和功能工程逻辑进行预处理，并自动和定期地将预测推送到下游决策者。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="89f4" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">最终意见</h1><p id="dd7e" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们从一个<strong class="lb iu">业务问题</strong>开始:一家从事购买、持有和出售大型<a class="ae ky" href="https://www.investopedia.com/terms/r/reit.asp" rel="noopener ugc nofollow" target="_blank">投资物业组合</a>业务的公司希望为其物业估值带来一致性和更高的表现。</p><p id="3498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在包含1800多项过去房地产交易的历史数据负载上训练了一个获胜的随机森林模型。</p><p id="cf48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">人力资源部可以在我们训练有素的员工身上运行新数据。pkl文件，或者可以由他们的工程部门构建自动管道。</p><p id="da02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的模型是一个<strong class="lb iu">回归模型</strong>，其中目标变量是数字。</p><p id="0736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">监督学习硬币的另一面是<strong class="lb iu">分类模型</strong>，其目标变量是分类的。在<a class="ae ky" rel="noopener" target="_blank" href="/will-your-employee-leave-a-machine-learning-model-8484c2a6663e">这里</a>，我训练了一个二元分类模型，预测员工是否有离开公司的风险。</p><p id="e0e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我在这里写了一篇关于机器学习在数学建模领域的位置的文章。</p><p id="d729" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在YouTube和Twitter上关注我。</p><h1 id="0807" class="mt mu it bd mv mw pq my mz na pr nc nd jz ps ka nf kc pt kd nh kf pu kg nj nk bi translated">无限制媒体访问</h1><p id="d4bb" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">提升你的知识和技能到一个新的水平。</p><p id="fb6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://col-jung.medium.com/membership" rel="noopener">加入Medium </a>享受<strong class="lb iu">无限制访问</strong>互联网上的<strong class="lb iu">最佳分析&amp;数据科学文章</strong>。你可以在这里加入<a class="ae ky" href="https://col-jung.medium.com/membership" rel="noopener">来支持我和其他顶级作家。</a></p><h1 id="2d17" class="mt mu it bd mv mw pq my mz na pr nc nd jz ps ka nf kc pt kd nh kf pu kg nj nk bi translated">我的数据科学文章</h1><ul class=""><li id="823b" class="ly lz it lb b lc nl lf nm li pv lm pw lq px lu or me mf mg bi translated">微分方程与机器学习——此处<a class="ae ky" href="https://medium.com/swlh/differential-equations-versus-machine-learning-78c3c0615055" rel="noopener">为</a></li><li id="b030" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">新冠肺炎的数学建模与机器学习— <a class="ae ky" href="https://medium.com/swlh/math-modelling-and-machine-learning-for-covid-19-646efcbe024e" rel="noopener">此处</a></li><li id="2170" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">回归预测房价— <a class="ae ky" rel="noopener" target="_blank" href="/predict-house-prices-with-machine-learning-5b475db4e1e">此处</a></li><li id="bbb7" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">分类预测员工流失— <a class="ae ky" rel="noopener" target="_blank" href="/will-your-employee-leave-a-machine-learning-model-8484c2a6663ea">此处</a></li><li id="3329" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">流行的机器学习性能指标— <a class="ae ky" rel="noopener" target="_blank" href="/popular-machine-learning-performance-metrics-a2c33408f29">此处</a></li><li id="513e" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">Jupyter笔记本与Dataiku DSS — <a class="ae ky" rel="noopener" target="_blank" href="/jupyter-notebooks-versus-dataiku-dss-for-data-science-e02264a753ca">此处</a></li><li id="81c4" class="ly lz it lb b lc mh lf mi li mj lm mk lq ml lu or me mf mg bi translated">Power BI —从数据建模到令人惊叹的报告— <a class="ae ky" rel="noopener" target="_blank" href="/intro-to-power-bi-from-data-modelling-to-stunning-reports-b34aac43d8a1">此处</a></li></ul></div></div>    
</body>
</html>