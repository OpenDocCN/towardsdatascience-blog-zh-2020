<html>
<head>
<title>How to Handle Cyclical Data in Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习中如何处理循环数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-handle-cyclical-data-in-machine-learning-3e0336f7f97c?source=collection_archive---------42-----------------------#2020-10-12">https://towardsdatascience.com/how-to-handle-cyclical-data-in-machine-learning-3e0336f7f97c?source=collection_archive---------42-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="12f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不要一次性编码日期信息。改为这样做。</h2></div><p id="ec81" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天，我们将探讨数据科学中一个常见但鲜为人知的话题——周期性数据。它是许多数据集的一部分，很容易被发现——日期信息是最常见的形式。有很多方法可以将日期信息编码成机器学习友好的东西，但有些方法比其他方法更好。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/84a0b67d5bec8f731750deafc7aa1f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75Rx8QpA9nYeJ9Yei-QvGA.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@arstyy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奥斯汀·尼尔</a>在<a class="ae lu" href="https://unsplash.com/s/photos/circle?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="d094" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是我被教导如何处理日期值的方法— <em class="lv">将它们视为分类</em>。不同的月/日/小时可以被视为单独的类别，因此为了对它们进行编码，可以创建一组虚拟变量。例如，在处理月度数据时，我们可以创建11个虚拟列(one-hot)，它们采用<code class="fe lw lx ly lz b">Is_January</code>、<code class="fe lw lx ly lz b">Is_February</code>等形式，其中一行中只有一列可以有非零值。</p><p id="7e14" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">那就不对了。</strong></p><p id="5027" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，你可以这样做，机器学习模型不会抱怨，但这并不意味着这是正确的方法。时间数据是循环的，一小时有60分钟，一天有24小时。当一个小时结束时，下一个小时开始从零开始计时。</p><p id="f64f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它使一个小时的第1分钟和第2分钟紧密相连，但也使第59分钟和第1分钟相连，因为只有一分钟的差异，<strong class="kk iu">而不是模型假设的</strong> 59。</p><p id="af10" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是我们想要的行为。下一节将使前面的观点更加清楚。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="4eda" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">数据集介绍和加载</h1><p id="8369" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">我们需要一个带有日期或其他循环属性的数据集——这是显而易见的。快速的Kaggle搜索产生了这个<a class="ae lu" href="https://www.kaggle.com/robikscube/hourly-energy-consumption" rel="noopener ugc nofollow" target="_blank">小时能耗</a>数据集，我们将使用其中的第一个<code class="fe lw lx ly lz b">AEP_hourly.csv</code>文件。它有几兆的大小，所以把它下载到你的机器上。</p><p id="6a62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦加载了<code class="fe lw lx ly lz b">Pandas</code>，前几行看起来是这样的:</p><pre class="lf lg lh li gt ne lz nf ng aw nh bi"><span id="ff3d" class="ni mi it lz b gy nj nk l nl nm">import pandas as pd<br/><br/>df = pd.read_csv('data/AEP_hourly.csv.zip')<br/>df.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/2cf6193ec40cc66f053cf540aea56ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/0*cuhvAUJZhArLM-sq.png"/></div></figure><p id="acc6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很好——我们有一些日期信息，但它是实际的日期还是字符串？</p><pre class="lf lg lh li gt ne lz nf ng aw nh bi"><span id="4c38" class="ni mi it lz b gy nj nk l nl nm">df.dtypes</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi no"><img src="../Images/fea7256d8ab1f56049a72a1ec2a566f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/0*R-B1AWumRX3Qxb4V.png"/></div></figure><p id="725a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">果然不出所料，所以我们来做个换算。我们还将从日期中提取小时信息，因为这是我们要处理的内容。</p><pre class="lf lg lh li gt ne lz nf ng aw nh bi"><span id="d097" class="ni mi it lz b gy nj nk l nl nm">df['Datetime'] = pd.to_datetime(df['Datetime'])<br/>df['Hour'] = df['Datetime'].dt.hour<br/><br/>df.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b4725f209c8768d63885ce8fedc4e00c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*YY5liJgP7OfToYLW.png"/></div></figure><p id="817d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在情况好多了。让我们分离出上周的数据(最后168条记录),来形象化地说明为什么一次性编码不是一件好事情。</p><pre class="lf lg lh li gt ne lz nf ng aw nh bi"><span id="7cbd" class="ni mi it lz b gy nj nk l nl nm">last_week = df.iloc[-168:]<br/>import matplotlib.pyplot as plt<br/><br/>plt.title('Individual hours', size=20)<br/>plt.plot(range(len(last_week)), last_week['Hour'])</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nq"><img src="../Images/a22ed37c0b390668a29ce3701a1a9d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GVBzCd0Vle6bM_Xz.png"/></div></div></figure><p id="c772" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">预期行为。这是一个重复七次(7天)的循环，在第23个小时之后每天都有一个粗略的切断。我认为您可以很容易地推理出为什么这种类型的行为对于周期性数据不是最佳的。</p><p id="17b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是我们能做些什么呢？幸运的是，很多。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="4c85" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">编码循环数据</h1><p id="0fdc" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">在这种情况下，一键编码不是明智之举。我们最终会得到23个附加属性(n-1)，这很糟糕，原因有二:</p><ol class=""><li id="5622" class="nr ns it kk b kl km ko kp kr nt kv nu kz nv ld nw nx ny nz bi translated">维度的巨大跳跃——从2到24</li><li id="0955" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated">属性之间没有连通性-23小时不知道它后面是0小时</li></ol><p id="6ef9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，我们能做什么呢？</p><p id="719c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">使用正弦和余弦变换。</strong>以下是我们将使用的公式:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/2924ab0ec1b38095874a1be7cee02460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cj1J9e3PEiERPUO6.png"/></div></div></figure><p id="ead4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者，在Python中:</p><pre class="lf lg lh li gt ne lz nf ng aw nh bi"><span id="c910" class="ni mi it lz b gy nj nk l nl nm">import numpy as np last_week['Sin_Hour'] = np.sin(2 * np.pi * last_week['Hour'] / max(last_week['Hour'])) last_week['Cos_Hour'] = np.cos(2 * np.pi * last_week['Hour'] / max(last_week['Hour']))</span></pre><p id="f40c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！以下是上周的数据:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi og"><img src="../Images/a7b86ca520c7f4efbe4fec007d714064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YTONetLuCGc1Y155.png"/></div></div></figure><p id="0004" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些转换使我们能够以更有意义和简洁的方式来表示时间数据。看一下最后两行。正弦值几乎相同，但仍有一点不同。这同样适用于接下来的每一个小时，因为它现在遵循一个波形。</p><p id="3a3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">太好了，但是为什么我们需要这两种功能呢？</strong></p><p id="3dd2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我给你答案之前，让我们先用图形来研究一下这些函数。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nq"><img src="../Images/9aff3fdf8b4da4c04fb232349cc564fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t2v_UGRwlIOKmWHo.png"/></div></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nq"><img src="../Images/8d1cc81a1ae7b0f57b5a5297ae3f5d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*57QKNKsuIyfjLJX-.png"/></div></div></figure><p id="388a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一次看一张图。有一个问题。这些值重复。看看正弦函数，在x轴的24到48之间。如果你要画一条直线，它将与同一天的两个点相交。这不是我们想要的行为。</p><p id="9c4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了进一步证明这一点，如果我们绘制正弦和余弦柱的散点图，会发生以下情况:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oh"><img src="../Images/7d3866f19ee8f63d55c575945e8510f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tUpYU4oACCn-kyL8.png"/></div></div></figure><p id="0671" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没错；我们得到了一个完美的循环。只有用周期来表示周期性数据才有意义，你不同意吗？</p><p id="6087" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你应该知道的就这些。让我们在下一部分总结一下。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="4d17" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">在你走之前</h1><p id="fe1c" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">这是一篇相对简短且切中要点的文章，但是我仍然希望我能够让您相信一键编码并不是所有问题的解决方案。当然，当分类属性不以任何方式“连接”时，它就像一种魅力，但这是任何周期性数据的首选方法。</p><p id="6f2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有人可能会说我们引入了两个新的维度，这并不理想。我同意，但是2比23好，23是一次性编码方法的结果。</p><p id="2e09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读。</p><p id="a521" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lu" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">加入我的私人邮件列表，获取更多有用的见解。</strong>T9】</a></p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="0c66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lv">喜欢这篇文章吗？成为</em> <a class="ae lu" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz lo ol"/></div></div></a></div></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="2a94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lv">原载于2020年10月12日</em><a class="ae lu" href="https://betterdatascience.com/cyclical-data-machine-learning/" rel="noopener ugc nofollow" target="_blank"><em class="lv">【https://betterdatascience.com】</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>