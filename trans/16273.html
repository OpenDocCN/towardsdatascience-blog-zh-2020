<html>
<head>
<title>A case study for transferring multi-format date data from Excel into MySQL through Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Python将多格式数据从Excel导入MySQL的案例研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-case-study-for-transferring-multi-format-date-data-from-excel-into-mysql-through-python-f87d3c2a1859?source=collection_archive---------49-----------------------#2020-11-09">https://towardsdatascience.com/a-case-study-for-transferring-multi-format-date-data-from-excel-into-mysql-through-python-f87d3c2a1859?source=collection_archive---------49-----------------------#2020-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="42ae" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/d93ff7ae718d6b347b4fac51f87dfc0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuEUDAkSJw0qIIAOK4qoiw.jpeg"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">照片由<a class="ae ko" href="https://unsplash.com/@cookiethepom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Cookie Pom</a>在<a class="ae ko" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="e131" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在数据分析中，日期格式和相关问题是令人头疼的问题。今天我想举一个例子来说明现实中的日期数据存在什么样的问题，如何用Python来处理，插入到MySQL数据库中。</p><h1 id="48ed" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><strong class="ak">案例分析</strong></h1><p id="f8cb" class="pw-post-body-paragraph kp kq it kr b ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li mp lk ll lm im bi translated">一家公司需要合并全球员工的信息，因为数据来自不同的国家，将生日输入到Excel中有不同的约定，并且也有错别字，所以当数据被合并时，生日看起来像:</p><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/d9fd74320a4828e5d0bffeb7b3ae1dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*iGw_OTZcSqniTDA7gg_5oA.png"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">Excel中的表格(图片由作者提供)</p></figure><p id="9610" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">生日1 </strong>:原来的生日是什么样子(为了表示，加了一个类似<code class="fe mv mw mx my b">'</code>的字符，使其显示原来的格式)<br/> <strong class="kr jd">生日2 </strong>:我电脑上Excel里的生日是什么样子</p><p id="3150" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果我们总结一下这个案例，有如下表的情况:</p><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mz"><img src="../Images/0c3a282be438bd5487b23aa56fe1b47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8fWuzORay5X-Qxa__xRBZg.png"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">可能的案例分析(图片由作者提供)</p></figure><p id="50af" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">你可能已经知道了，数据左对齐默认是字符串，比如' 2010–13–09 '，数据右对齐默认是日期或者数字，比如' 9/13/2010 '，我不确定20100913的类型，就这样吧。</p><p id="631b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我把日期分为两种情况:</p><h2 id="b1b6" class="na lo it bd lp nb nc dn lt nd ne dp lx la nf ng mb le nh ni mf li nj nk mj iz bi translated">1.有一个大于12的数字(年份除外)</h2><p id="19d0" class="pw-post-body-paragraph kp kq it kr b ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li mp lk ll lm im bi translated">在这种情况下，有三种情况，分别是:<br/> A. <strong class="kr jd">字符串包含正斜杠'/'或破折号'-' </strong>，例如:' 2010/09/13 '，' 2010–09–13 '<br/>b .<strong class="kr jd">字符串不包含正斜杠'/'或破折号'-' </strong>，而是包含其他类似逗号或Punkt的字符，例如:' 2010，09，13 '，' 2010.09。</p><h2 id="e445" class="na lo it bd lp nb nc dn lt nd ne dp lx la nf ng mb le nh ni mf li nj nk mj iz bi translated">2.如果没有大于12的数字(年份除外)</h2><p id="fc39" class="pw-post-body-paragraph kp kq it kr b ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li mp lk ll lm im bi translated">在这种情况下，还有三种情况，分别是:<br/> A. <strong class="kr jd">字符串中包含正斜杠'/'或破折号'-' </strong>，例如:' 2010/09/02 '，' 2010–09–02 '<br/>b .<strong class="kr jd">字符串中不包含正斜杠'/'或破折号'-' </strong>，而是包含其他类似逗号或Punkt的字符，例如:<strong class="kr jd"> '2010，09，02 '，' 2010</strong></p><p id="78b2" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在让我们将其导入Python:</p><pre class="mr ms mt mu gt nl my nm nn aw no bi"><span id="b85d" class="na lo it my b gy np nq l nr ns">df = pd.read_excel('employee.xlsx')</span></pre><p id="d795" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">看起来像是:</p><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/235623badc04ca776a9c6e293d003701.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*A9vVABPYZUMs5zCokBtr_A.png"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">Python中的数据(图片由作者提供)</p></figure><p id="bc83" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Excel中的日期在python中被转换成时间戳格式，现在右边是无日期数据，但不是时间戳格式。</p><p id="a1b9" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">表employee_birthday已经在MySQL中创建为:</p><figure class="mr ms mt mu gt kd"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="1ce8" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">让我们尝试将姓名和生日2的数据插入数据库。</p><figure class="mr ms mt mu gt kd"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="58c4" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">当第一个错误发生时，它停止了。错误信息如下所示:</p><p id="3db0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe mv mw mx my b"><strong class="kr jd">DataError: 1292 (22007): Incorrect date value: '2010-13-09' for column 'birthday' at row 1</strong></code></p><h1 id="cb87" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><strong class="ak">用Python传输多格式数据的解决方案</strong></h1><p id="9e95" class="pw-post-body-paragraph kp kq it kr b ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li mp lk ll lm im bi translated">因此，我们需要在插入之前更正所有不正确的日期值。</p><p id="3d11" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">首先，让我们检查错误日期值的类型，以“2010–13–09”和“20100913”为例。结果是:</p><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/4bdd27c075a4147a16137346fe76517d.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*HUb3lqiZeQH8KdGMXRcnnw.png"/></div></figure><ul class=""><li id="6dbf" class="nx ny it kr b ks kt kw kx la nz le oa li ob lm oc od oe of bi translated">对于数据类型为str，使用datetime.strptime进行测试:</li></ul><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f82d83e5a7886afa1e12cc2415be1f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*kB8uwLqdZbRVUHdAp1yjRQ.png"/></div></figure><ul class=""><li id="7227" class="nx ny it kr b ks kt kw kx la nz le oa li ob lm oc od oe of bi translated">对于int，首先将其转换为str，然后使用datetime.strptime，我们来试试:</li></ul><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7da6e30add808ee2f598ed4f7e00c537.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*0w1-IBzmWzQhdDDotnSpxA.png"/></div></figure><p id="7b97" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">它也能工作。</p><p id="99b4" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在进入正题:有这么多不同的格式，我们如何高效地处理它们？让我们将情况分为四种情况:</p><ol class=""><li id="ca87" class="nx ny it kr b ks kt kw kx la nz le oa li ob lm oi od oe of bi translated">如果类型(生日)是熊猫。时间戳，返回生日</li><li id="622b" class="nx ny it kr b ks oj kw ok la ol le om li on lm oi od oe of bi translated">如果类型(生日)是一个字符串，则创建一个格式列表，并与datetime.strptime组合以返回正确的日期</li><li id="2a4c" class="nx ny it kr b ks oj kw ok la ol le om li on lm oi od oe of bi translated">如果类型是int，首先将它转换成一个字符串，然后使用步骤2中的方法</li><li id="053b" class="nx ny it kr b ks oj kw ok la ol le om li on lm oi od oe of bi translated">其他例外</li></ol><p id="ec11" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">当数据类型为str时，格式列表中有一个窍门。</strong></p><blockquote class="oo op oq"><p id="c088" class="kp kq or kr b ks kt ku kv kw kx ky kz os lb lc ld ot lf lg lh ou lj lk ll lm im bi translated">1.如果连接符是正斜杠或破折号，如果没有大于12的数字(年份除外)，Excel将以“yyyy-mm-d”或“mm/d/yyyy”的格式将数据传输到date，如下所示:所有这些日期都将以熊猫的形式传输。时间戳</p></blockquote><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ov"><img src="../Images/06b6d3e34fe26ffa3232bbae12eaf91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D9vXMcNGNoY52dLn3NRF-A.png"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">作者图片</p></figure><blockquote class="oo op oq"><p id="03fd" class="kp kq or kr b ks kt ku kv kw kx ky kz os lb lc ld ot lf lg lh ou lj lk ll lm im bi translated">2.如果连接符是正斜杠或破折号，如果有一个大于12的数字(年份除外)，默认情况下，Excel将以“yyyy-m-d”或“m/d/yyyy”的格式传输数据，除非:如果日期(大于12)在默认月份中，则这些情况需要在“fmt”中列出，以用于正斜杠和破折号:</p></blockquote><ul class=""><li id="d15d" class="nx ny it kr b ks kt kw kx la nz le oa li ob lm oc od oe of bi translated">%Y-%d-%m，如“2010–13–09”</li><li id="c4b8" class="nx ny it kr b ks oj kw ok la ol le om li on lm oc od oe of bi translated">%d-%m -%Y，如“2010年13月9日”</li><li id="6a42" class="nx ny it kr b ks oj kw ok la ol le om li on lm oc od oe of bi translated">%d/%m%Y，如2010年13月9日</li><li id="a386" class="nx ny it kr b ks oj kw ok la ol le om li on lm oc od oe of bi translated">%Y/%d/%m，例如“2010/13/9”</li></ul><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ow"><img src="../Images/936019b58189627ef905cbf4a1990c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAe42Tn1fDKKEub6_d2syw.png"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">作者图片</p></figure><blockquote class="oo op oq"><p id="d5a8" class="kp kq or kr b ks kt ku kv kw kx ky kz os lb lc ld ot lf lg lh ou lj lk ll lm im bi translated">3.对于其他连接器，应列出所有可能的情况。它们是:' %Y.%m.%d '，' %Y.%d.%m '，' %m.%d.%Y '，' %d.%m.%Y '，' %Y，%m，%d '，' %Y，%d，%m '，' %m，%d，%Y '，' %m，%d，%Y '，' %d，%m，%Y '</p></blockquote><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ox"><img src="../Images/5a223bbbc01d02956ec90c3ff44c60f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oQaFu0JDQ8OldMNSxZNCYw.png"/></div></div><p class="kk kl gj gh gi km kn bd b be z dk translated">作者图片</p></figure><p id="50ec" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，填充列表应该类似于:<br/> ('%Y-%d-%m '，' %d-%m-%Y '，' %Y/%d/%m '，' %d/%m/%Y '，' %Y . %m . %d . %m '，' %m.%d.%Y '，' %d.%m.%Y '，' %Y，%m，%d . % m . %Y '，' %Y，% m，%d，%d '，' % Y，%d，% m，%d '，' % Y，%d，% d，% d '</p><p id="a391" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">完整的日期解析函数如下:</p><figure class="mr ms mt mu gt kd"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="ca58" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><strong class="ak">结果:</strong></h1><p id="5a0a" class="pw-post-body-paragraph kp kq it kr b ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li mp lk ll lm im bi translated">现在让我们再次尝试插入MySQL。使用以下代码从表中查询数据:</p><figure class="mr ms mt mu gt kd"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="afde" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">结果如下图所示:</p><figure class="mr ms mt mu gt kd gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/11a732494d6955263cc5d203ae6830bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*dMmcuPC0jneA7e7ntfZK4g.png"/></div><p class="kk kl gj gh gi km kn bd b be z dk translated">数据查询来自MySql</p></figure><h1 id="a19f" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><strong class="ak">备注:</strong></h1><p id="9272" class="pw-post-body-paragraph kp kq it kr b ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li mp lk ll lm im bi translated">在本文中，我将重点介绍如何使用Python自动更正多格式日期数据，以便将日期数据从Excel插入MySQL。</p><p id="ae34" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最后，我想澄清另外两点:</p><ol class=""><li id="eaa8" class="nx ny it kr b ks kt kw kx la nz le oa li ob lm oi od oe of bi translated">对于2010–9–2和2010–2–9这样的数据:当从Excel导入到python时，系统已经将其转换为yyyy-m-d格式，如果要解析为yyyy-d-m，这里解释的这种方法不起作用。</li><li id="7a58" class="nx ny it kr b ks oj kw ok la ol le om li on lm oi od oe of bi translated">对于<strong class="kr jd">Excel</strong>中不正确的日期，如果你想在Excel中进行处理，也有一些点击供你参考。</li></ol><ul class=""><li id="857e" class="nx ny it kr b ks kt kw kx la nz le oa li ob lm oc od oe of bi translated">使用“替换”来转移除正斜杠('/')和破折号('-')以外的连接器</li><li id="d268" class="nx ny it kr b ks oj kw ok la ol le om li on lm oc od oe of bi translated">使用函数<code class="fe mv mw mx my b">=Date+right(),left() and mid(),</code>将数字转换为日期，例如:对于20100209，使用' =DATE(LEFT(cell，4)，MID(cell，5，2)，RIGHT(cell，2))'将其转换为' 2/9/2010 '</li></ul><p id="c926" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">感谢阅读，并享受它。</p></div></div>    
</body>
</html>