<html>
<head>
<title>SQL Window (Analytic) Functions Explained in 4 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在4分钟内解释SQL窗口(分析)功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-window-analytic-functions-explained-in-4-minutes-6171c6983263?source=collection_archive---------20-----------------------#2020-09-26">https://towardsdatascience.com/sql-window-analytic-functions-explained-in-4-minutes-6171c6983263?source=collection_archive---------20-----------------------#2020-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9290" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用这个简单的解释来提升你的SQL技能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/03898b0dd3db4f76b5a802f71afb3190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSSAD1GDZPHmpzLHUuv1nw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">塞巴斯蒂安·斯坦尼斯在<a class="ae ky" href="https://unsplash.com/s/photos/window?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="3ebc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">目录</h1><ol class=""><li id="f63f" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">介绍</li><li id="1372" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">什么是窗口(分析)函数？</li><li id="edb5" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">窗口函数的剖析</li><li id="f089" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">聚合函数与窗口函数的示例</li><li id="c6e2" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">窗口功能的优势</li></ol></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="80ab" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">介绍</h1><p id="a4af" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">您习惯于简单的查询(从WHERE GROUP BY中选择)，并且希望将您的技能提升到一个新的水平。接下来应该学什么？</p><p id="78a7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated"><strong class="lt iu">窗口函数</strong>，也称为<strong class="lt iu">分析函数</strong>，是强大的SQL函数，将带你从初级SQL用户到中级SQL用户。在本文中，我们将简要介绍什么是窗口函数，然后提供一个简单的例子来说明这一点。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="22f6" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">什么是窗口(分析)函数？</h1><p id="7417" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">窗口函数类似于聚合函数，它返回聚合值(如SUM()、COUNT()、MAX())。</p><p id="b8c4" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">窗口函数的不同之处在于它不对结果集进行分组。输出中的行数与输入中的行数相同。</p><p id="059c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">如果这对你来说还没有意义，<strong class="lt iu">不要担心</strong>。坚持到例子，它会更有意义。:)</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="5d06" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">窗口函数的剖析</h1><p id="e831" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">窗口功能的基本结构如下:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="b166" class="nx la it nt b gy ny nz l oa ob">SELECT SUM() OVER(PARTITION BY ___ ORDER BY ___) FROM Table</span></pre><p id="894d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">为了更容易理解，需要记住三个主要部分:</p><ol class=""><li id="ac93" class="lr ls it lt b lu nn lw no ly oc ma od mc oe me mf mg mh mi bi translated"><strong class="lt iu">聚合函数</strong>:在上面的例子中，我使用了SUM()，但是你也可以使用COUNT()、AVG()等等</li><li id="c381" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><strong class="lt iu"> PARTITION BY: </strong>简单地把它想成一个GROUP BY子句，但实际上，它被称为PARTITION BY。</li><li id="2a21" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><strong class="lt iu"> ORDER BY: </strong> ORDER BY与您预期的一样。当输出的顺序很重要时，考虑这一点很重要。</li></ol></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="f9e1" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">聚合函数与窗口函数的示例</h1><p id="7e12" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">为了更清楚起见，假设我们有下表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/5a3c7e2e654108ab6ae1085ffea7e55d.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*tb6OeYzgAupfTHxrdkdAzQ.png"/></div></figure><p id="c702" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">如果我们想获得按性别划分的平均GPA，我们可以使用一个<strong class="lt iu">聚合函数</strong>并运行以下查询来获得以下结果:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="fe91" class="nx la it nt b gy ny nz l oa ob">SELECT Gender, AVG(GPA) as avg_gpa<br/>FROM students<br/>GROUP BY Gender</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/ac6e66986ac6bb619fde71dae9177dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*QP_NQMbb0-EGjht4FaIdyg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果</p></figure><p id="fce2" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">下一部分是关键。</p><p id="644e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">现在假设我们想要获得以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/cbfb74b01cb231e4e1eb7435cec97e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*WH9uiZ9OxCQrfBUy-xTyxQ.png"/></div></figure><p id="d6a2" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">我们<strong class="lt iu">可以</strong>使用一个聚合函数(就像上面的那个),然后将结果加入到初始表中，但是这需要两步。</p><p id="70a1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated"><strong class="lt iu">改为</strong>，我们可以用一个窗口函数来实现同样的输出:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="8458" class="nx la it nt b gy ny nz l oa ob">SELECT *,<br/>    AVG(GPA) OVER (PARTITION BY Gender) as avg_gpa<br/>FROM table</span></pre><p id="88de" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">通过上面的查询，我们按性别划分(分割)数据，并计算每个性别的平均GPA。然后，它创建一个名为avg_gpa的新列，并为每一行追加相关的平均gpa。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="a300" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">窗口功能的优势</h1><p id="6ef6" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">使用窗口函数有三个主要优点:</p><h2 id="1450" class="nx la it bd lb oi oj dn lf ok ol dp lj ly om on ll ma oo op ln mc oq or lp os bi translated">简单</h2><p id="c663" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">一旦你掌握了它，窗口函数使用起来就简单多了。注意，在上面的例子中，只需要一行额外的代码就可以使用窗口函数得到想要的输出，而不是使用聚合函数然后连接结果。</p><h2 id="797e" class="nx la it bd lb oi oj dn lf ok ol dp lj ly om on ll ma oo op ln mc oq or lp os bi translated">速度</h2><p id="c23c" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">与上述观点相关，使用窗口函数比使用替代方法要快得多。当您处理数百或数千千兆字节的数据时，这将派上用场。</p><h2 id="61ff" class="nx la it bd lb oi oj dn lf ok ol dp lj ly om on ll ma oo op ln mc oq or lp os bi translated">多才多艺</h2><p id="1241" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">最重要的是，窗口函数有大量的通用性，这超出了本文的范围。一些例子包括添加移动平均值、添加行号和滞后数据。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="d8e3" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">感谢阅读！</h1><p id="b995" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">读到这里，你应该对什么是窗口函数，如何写窗口函数，窗口函数的优点有所了解。</p><p id="edc7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly np nf ng ma nq ni nj mc nr nl nm me im bi translated">希望这些例子能让你更容易理解窗口函数是如何工作的。一如既往，我祝你在学习中好运！</p><h2 id="565a" class="nx la it bd lb oi oj dn lf ok ol dp lj ly om on ll ma oo op ln mc oq or lp os bi translated">特伦斯·申</h2><ul class=""><li id="c977" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me ot mg mh mi bi translated"><em class="ou">查看</em> <a class="ae ky" href="https://docs.google.com/document/d/1UV6pvCi9du37cYAcKNtuj-2rkCfbt7kBJieYhSRuwHw/edit#heading=h.m63uwvt9w358" rel="noopener ugc nofollow" target="_blank"> <em class="ou">我的免费数据科学资源</em> </a> <em class="ou">每周都有新素材！</em></li><li id="9126" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me ot mg mh mi bi translated"><em class="ou">如果你喜欢这个，</em> <a class="ae ky" href="https://medium.com/@terenceshin" rel="noopener"> <em class="ou">关注我的Medium </em> </a> <em class="ou">了解更多</em></li><li id="82dd" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me ot mg mh mi bi translated"><em class="ou">我们连线上</em><a class="ae ky" href="https://www.linkedin.com/in/terenceshin/" rel="noopener ugc nofollow" target="_blank"><em class="ou">LinkedIn</em></a></li></ul></div></div>    
</body>
</html>