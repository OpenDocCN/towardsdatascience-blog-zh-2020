<html>
<head>
<title>A Quick Experiment with the CARTO BigQuery Tiler!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CARTO BigQuery Tiler的快速实验！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-quick-experiment-with-the-carto-bigquery-tiler-b2ab37e48006?source=collection_archive---------59-----------------------#2020-10-26">https://towardsdatascience.com/a-quick-experiment-with-the-carto-bigquery-tiler-b2ab37e48006?source=collection_archive---------59-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d631" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从BigQuery和CARTO BigQuery Tiler的实践教程开始。</h2></div><p id="f160" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我和我的朋友、共同主持人、数据黑客同事<a class="ae lb" href="http://medium.com/@juliebprice" rel="noopener">朱莉</a> ( <a class="ae lb" href="https://twitter.com/juliepricetech" rel="noopener ugc nofollow" target="_blank">推特</a>)，以及CARTO的帮助下创建的！</p><h1 id="f458" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">你好，世界！</h1><p id="936d" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">最近，CARTO推出了BigQuery Tiler，我们有机会出席2020年<a class="ae lb" href="https://spatial-data-science-conference.com/" rel="noopener ugc nofollow" target="_blank">空间数据科学大会</a>，一睹Tiler的风采。</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="me mf l"/></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">我们做了一个报告！</p></figure><p id="e6be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为这个演示创建了几个演示，我们想把它作为一个“你好，世界”的练习分享给tiler！我们已经将数据和查询/代码加载到了一个<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo" rel="noopener ugc nofollow" target="_blank"> Github库</a>中，欢迎您尝试一下。当第一次构建这些组件时，我们发现了许多关于许多不同组件的有用信息，但试图将它们联系在一起并不总是直截了当的，因此这包括了我们在此过程中吸取的许多经验教训，并给出了从数据创建到可视化的完整端到端示例。</p><p id="2640" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在运行演示之前，需要回顾一些要点。readme文件中列出了它们<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo#read-me-first" rel="noopener ugc nofollow" target="_blank">，但这里也值得重申一下:</a></p><ul class=""><li id="9de4" class="mk ml iq kh b ki kj kl km ko mm ks mn kw mo la mp mq mr ms bi translated">这是演示代码，旨在用于学习，而不是用于生产。它不是受支持的产品，因此随着时间的推移，情况可能会发生变化和损坏，我们将尽力修复它！</li><li id="3b63" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">如果这是你第一次使用谷歌云，一定要开始你的<a class="ae lb" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">免费试用</a>并创建你的项目！</li><li id="f0b7" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">这使用了<a class="ae lb" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> Google BigQuery </a>，会产生成本。请务必通过<a class="ae lb" href="https://cloud.google.com/bigquery/pricing" rel="noopener ugc nofollow" target="_blank">定价页面</a>了解您的项目将如何产生成本，如果这是您的第一个项目，请务必了解<a class="ae lb" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank"> Google Cloud试用和免费等级</a>。</li><li id="5db7" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">这也使用CARTO BigQuery Tiler。你需要成为测试版的一员。在这里找到关于这个<a class="ae lb" href="https://carto.com/bigquery/beta/" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></li><li id="fa60" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">当然，你还需要一个<a class="ae lb" href="https://carto.com/signup" rel="noopener ugc nofollow" target="_blank">卡通账户</a>！</li><li id="abae" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">对于在Google Cloud和BigQuery的命令行中完成的任务，您可以利用预先安装了命令行工具的<a class="ae lb" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank">云外壳</a>，或者您可以<a class="ae lb" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">将Google Cloud SDK </a>安装到您的本地(或虚拟)机器上。</li><li id="6365" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">在命令行中，确保通过运行<code class="fe my mz na nb b">gcloud auth login</code>来设置您的用户，并运行<code class="fe my mz na nb b">gcloud init</code>来设置您的默认项目。</li></ul><h1 id="53c3" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">加载数据</h1><p id="f718" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">阅读完这些信息并设置好项目后，就可以加载数据集了。有两个数据集要加载；<a class="ae lb" href="https://data-nifc.opendata.arcgis.com/" rel="noopener ugc nofollow" target="_blank"> NIFS火灾周界数据</a>和<a class="ae lb" href="https://openaq.org/" rel="noopener ugc nofollow" target="_blank">来自OpenAQ </a>的数据。继续克隆/下载<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo" rel="noopener ugc nofollow" target="_blank"> Github库</a>，并按照<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo#load-the-data-before-starting-this" rel="noopener ugc nofollow" target="_blank">readme中的步骤加载数据</a>。完成后，BigQuery中应该有下面的表:</p><ul class=""><li id="ab58" class="mk ml iq kh b ki kj kl km ko mm ks mn kw mo la mp mq mr ms bi translated"><code class="fe my mz na nb b">geo.geo_dataset_nifs_perimeters</code></li><li id="f3b3" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated"><code class="fe my mz na nb b">geo.geo_dataset_openaq_demo</code></li><li id="5e9b" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated"><code class="fe my mz na nb b">geo.geo_dataset_osm_planet_features_buildings</code></li><li id="43ca" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated"><code class="fe my mz na nb b">geo.tileset_openaq_wildfire</code></li><li id="4959" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated"><code class="fe my mz na nb b">geo.tileset_osm_planet_features_buildings</code></li></ul><h1 id="55ee" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">可视化OpenStreetMaps (OSM)数据</h1><p id="2323" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">当加载地理数据集时，您可以直接在BigQuery界面中预览它们(T4 ),看看它们是什么样子。一旦你创建了一个tileset，你也可以预览它们，但因为它是原始的tileset数据，它可能不会有太大的意义。您可以使用QGIS、deck.gl和Carto的在线查看器等工具来可视化切片集。Carto Online Viewer是一个基于web的tilesets可视化工具，可以让您快速查看数据的外观。当加入测试版时，它的文档会让你知道如何设置在线查看器，使用本教程中创建的OSM tileset就是一个很好的例子。如果您已经加入了测试版，并且可以访问它，那么现在是使用<code class="fe my mz na nb b">geo.geo_dataset_osm_planet_features_buildings</code>表进行尝试的好时机。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/fda2c3de849ba05e5a0e68a876631ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*gSTLwCAhXbaeY3x8HEdgzQ.gif"/></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">CARTO Online Viewer中的OSM tileset将如下所示。(图片由作者提供)</p></figure><h1 id="96f2" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">可视化NIFS和OpenAQ数据</h1><p id="c094" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">为了制作演示中使用的第二个示例，我们使用<a class="ae lb" href="https://deck.gl/" rel="noopener ugc nofollow" target="_blank"> deck.gl </a>在网页中创建可视化效果。我们还使用了<a class="ae lb" href="http://codepen.io/" rel="noopener ugc nofollow" target="_blank"> codepen.io </a>来测试和显示网页和可视化效果，但是您也可以将代码粘贴到<a class="ae lb" href="http://gist.github.com/" rel="noopener ugc nofollow" target="_blank"> Github Gist </a>中，并使用<a class="ae lb" href="https://bl.ocks.org/-/about" rel="noopener ugc nofollow" target="_blank">bl.ocks.org</a>来呈现它，或者如果您有自己喜欢的编辑和服务工作流，请使用它！</p><p id="849f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了显示NIFS野火多边形，我们使用了<a class="ae lb" href="https://deck.gl/docs/api-reference/carto/carto-sql-layer" rel="noopener ugc nofollow" target="_blank">cartossqllayer</a>下拉数据并将其可视化。这意味着您还必须<a class="ae lb" href="https://carto.com/help/tutorials/big-query-connector/" rel="noopener ugc nofollow" target="_blank">在CARTO </a>中创建一个数据集才能使用它。在CARTO仪表板中，转到数据页面，创建一个新的BigQuery数据源，并使用您用来访问Google Cloud的帐户进行身份验证。在向导中，在BigQuery中选择存储您的<code class="fe my mz na nb b">geo</code>数据集的项目，将输出命名为<code class="fe my mz na nb b">geo_dataset_nifs_perimeters</code>，并使用以下查询:</p><pre class="lz ma mb mc gt nf nb ng nh aw ni bi"><span id="d590" class="nj ld iq nb b gy nk nl l nm nn">SELECT geom, IncidentNa as INCIDENT_NAME, GISAcres as ACRES FROM `geo.geo_dataset_nifs_perimeters`</span></pre><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/8967431f1580a11cb2d3004357d595c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KonkpNlcOPkutdtfv_lUEA.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">BigQuery数据的CARTO向导。(图片由作者提供)</p></figure><p id="b015" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选择不同步下一页中的数据(这只是静态数据的一次性提取，因此不需要同步)，并将数据导入！这将为您提供一个来自BigQuery的CARTO新数据集，您可以使用它。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nt"><img src="../Images/f81b2124bd49c8658a36673b9b355800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C8DcG88S5F7-MUs70sRmQ.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">闪亮的新数据！(图片由作者提供)</p></figure><p id="3569" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该数据集现在可用于查询。包含源代码的HTML页面在<code class="fe my mz na nb b"><a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo/tree/main/2_fire_perimeters" rel="noopener ugc nofollow" target="_blank">/2_fire_perimeters/index.html</a></code>的Github资源库中，需要做一些改动。</p><p id="7c7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先是API键。确保<a class="ae lb" href="https://carto.com/help/getting-started/get-api-key/" rel="noopener ugc nofollow" target="_blank">获得您的CARTO API密钥</a>，授予其访问<code class="fe my mz na nb b">geo_nifs_perimeters</code>数据集的权限，并使用这些凭证来填充index.html文件中<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo/blob/a65bc4ab505b5e8c2589f880c19003388fb12664/2_fire_perimeters/index.html#L259-L260" rel="noopener ugc nofollow" target="_blank">第259和260行的变量。</a></p><p id="ee9d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还需要获得一个Google Maps API密钥，因为我们将它用作可视化中的底图。按照<a class="ae lb" href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="noopener ugc nofollow" target="_blank">指令获取您的API密钥</a>，然后将其插入到第9行的<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo/blob/a65bc4ab505b5e8c2589f880c19003388fb12664/2_fire_perimeters/index.html#L9" rel="noopener ugc nofollow" target="_blank"> API调用中。</a></p><p id="c8e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，您需要为BigQuery中的tilesets添加数据访问。为此，我们使用了<a class="ae lb" href="https://deck.gl/docs/api-reference/geo-layers/mvt-layer" rel="noopener ugc nofollow" target="_blank">多视图层</a>。在<a class="ae lb" href="https://github.com/slagathorr/sdsc20-bqtiler-demo/blob/a65bc4ab505b5e8c2589f880c19003388fb12664/2_fire_perimeters/index.html#L9" rel="noopener ugc nofollow" target="_blank">第268行</a>中，用tileset的URL模板替换<code class="fe my mz na nb b">url</code>占位符。在BigQuery Tiler文档的“使用QGIS”一节中，有一节介绍了如何获取生成模板的URL。您将得到一个包含大量信息的JSON响应，但是所需的URL将是第一个对象，看起来像这样:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nu"><img src="../Images/8ff92f4b123a3d294f63e676b98734a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L976XqfMgBpBuLVuTe74MQ.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">原谅我的涂鸦。(图片由作者提供)</p></figure><p id="1106" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用生成的新URL替换<code class="fe my mz na nb b">urls</code>，您应该可以开始了！您将获得一个可视化效果，显示任何给定野火质心100公里范围内的OpenAQ中的测量点，并与野火本身的多边形分层。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nt"><img src="../Images/adea67c941834750ecddd0d524263ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pqSLZLSg6fRdYN-sis8y4g.gif"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">空气测量点和地图上的野火多边形。(图片由作者提供)</p></figure><p id="d615" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应该就是这样了！希望您能够浏览所有这些内容，作为CARTO BigQuery Tiler的介绍，以及可视化这些数据集的一些选项，这很有帮助。如果您遇到任何问题，请务必让我们知道。如果您有任何希望分享该功能帮助的使用案例，我们也很乐意听到！请务必在这里或在Twitter ( <a class="ae lb" href="http://twitter.com/brian_suk" rel="noopener ugc nofollow" target="_blank"> @brian_suk </a>和<a class="ae lb" href="http://twitter.com/juliepricetech" rel="noopener ugc nofollow" target="_blank"> @juliepricetech </a>)上发表评论，为我们呐喊！谢谢，祝映射愉快！</p></div></div>    
</body>
</html>