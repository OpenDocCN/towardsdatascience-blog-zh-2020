<html>
<head>
<title>Thousands of CSV files, Keras and TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数千个CSV文件，Keras和TensorFlow</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/thousands-of-csv-files-keras-and-tensorflow-96182f7fabac?source=collection_archive---------20-----------------------#2020-11-11">https://towardsdatascience.com/thousands-of-csv-files-keras-and-tensorflow-96182f7fabac?source=collection_archive---------20-----------------------#2020-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="0a13" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">操作方法</h2><div class=""/><div class=""><h2 id="fee6" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何应对这个地狱的指南</h2></div><p id="faa7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我有大约15 000个CSV文件，每个文件有6 000行，我需要使用所有这些数据训练一个神经网络:总共大约90 000 000个实例。真正的机器学习就是这个样子！</p><p id="b66b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我希望我能节省你的时间，告诉你如何使用<code class="fe lk ll lm ln b">generators</code>、<code class="fe lk ll lm ln b">tf.data.Dataset</code>和其他有趣的东西来训练神经网络。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/be2c2d966ef7d7aa7ca7239becf55fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07hpO2DN2umJLXZOpD0t-Q.png"/></div></div><p class="ma mb gj gh gi mc md bd b be z dk translated">他们喜欢你。图片作者:丹尼斯·希洛夫(就是我)。</p></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="3a76" class="ml mm iq bd mn mo mp mq mr ms mt mu mv kf mw kg mx ki my kj mz kl na km nb nc bi translated">介绍</h1><p id="76d4" class="pw-post-body-paragraph ko kp iq kq b kr nd ka kt ku ne kd kw kx nf kz la lb ng ld le lf nh lh li lj ij bi translated">没有办法将所有这些数据连接到一个文件或一个数组中，因为它会非常庞大。</p><p id="e9ed" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">因此，处理这个庞大数据阵列的唯一方法是分批处理:</p><ol class=""><li id="be98" class="ni nj iq kq b kr ks ku kv kx nk lb nl lf nm lj nn no np nq bi translated">我们得到一份文件清单</li><li id="4c98" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated">我们把它分成训练和测试数据集</li><li id="956f" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated">然后，我们使用一些东西将数据分批放入Keras</li></ol><h1 id="b51b" class="ml mm iq bd mn mo nw mq mr ms nx mu mv kf ny kg mx ki nz kj mz kl oa km nb nc bi translated">简单的部分</h1><p id="0295" class="pw-post-body-paragraph ko kp iq kq b kr nd ka kt ku ne kd kw kx nf kz la lb ng ld le lf nh lh li lj ij bi translated">心寒，那真的很容易。重要通知:所有文件都应该在一个目录中，这样代码才能运行。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="8339" class="ml mm iq bd mn mo nw mq mr ms nx mu mv kf ny kg mx ki nz kj mz kl oa km nb nc bi translated">棘手的第一部分</h1><p id="e420" class="pw-post-body-paragraph ko kp iq kq b kr nd ka kt ku ne kd kw kx nf kz la lb ng ld le lf nh lh li lj ij bi translated">分批处理有几种方法。</p><p id="1dc4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">例如，方法之一是使用<code class="fe lk ll lm ln b">generator</code>。它是一个返回迭代器的函数，我们可以遍历它的值:一次一个值。</p><p id="f145" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">默认情况下，Keras允许我们将这个<code class="fe lk ll lm ln b">generator</code>传递给<code class="fe lk ll lm ln b">.fit</code>。</p><p id="21cf" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">所以让我们写迭代器吧！</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="540b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">很简单:你传入了<code class="fe lk ll lm ln b">files</code>数组和<code class="fe lk ll lm ln b">batch_size</code>，相应的<code class="fe lk ll lm ln b">input</code>和<code class="fe lk ll lm ln b">output</code>现在被返回。</p><p id="ef1e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后，您可以通过以下方式初始化您的生成器:</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4ad4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">batch_size</code>是一次返回多少行。通常，您可以像初始化单个CSV中的行数一样初始化它，但是如果这个数字太大，那么就设置一个不那么大的值(我不知道，例如5 000)。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="01c3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你符合一个模型。</p><p id="389d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">callback_list</code>是监测训练的某个参数开始下降是否太慢，没有理由继续训练的东西。</p><p id="d27e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">steps_per_epoch</code>告知何时需要开始新的纪元。如果您不提供它，Keras将不会知道您的数据长度，并将在日志中打印“未知”。</p><p id="6b7c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">use_multiprocessing</code>表示是否要在多个线程中处理数据。</p><p id="adeb" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">workers</code>是若干个这样的线程。这个数字应该小于CPU的核心数。</p><p id="1904" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">x</code>是你的发电机。因为它既返回输入又返回输出，所以我们不设置<code class="fe lk ll lm ln b">y</code>。</p><p id="ee62" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">verbose</code>是日志有多详细。</p><p id="1bb7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">因为你有几个过程预处理数据进行训练，他们把这些数据添加到Keras的某个地方，让他们训练神经网络。而<code class="fe lk ll lm ln b">max_queue_size</code>指定了已存储但尚未处理的数据数量的限制。您应该设置它，因为没有必要预处理超过Keras一次可以消耗的数据:您的数据集非常大，内存将会过载。</p><p id="9ffb" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">epochs</code>是Keras对数据集进行迭代的次数</p><p id="5644" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">validation_data</code>是你将要用来验证准确性的数据。</p><p id="242f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">validation_steps</code>与<code class="fe lk ll lm ln b">steps_per_epoch</code>意思相同。</p><h1 id="2a4f" class="ml mm iq bd mn mo nw mq mr ms nx mu mv kf ny kg mx ki nz kj mz kl oa km nb nc bi translated">棘手的第二部分</h1><p id="a4e6" class="pw-post-body-paragraph ko kp iq kq b kr nd ka kt ku ne kd kw kx nf kz la lb ng ld le lf nh lh li lj ij bi translated">所以你试着开始训练，你看…你看…</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/99966f05337e0e8a30a56f9e04ce4184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boT2y5KjIbW6XtelILnn8w.png"/></div></div><p class="ma mb gj gh gi mc md bd b be z dk translated">图片作者:丹尼斯·希洛夫(就是我)</p></figure><p id="8c2c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在让我们更深入:我们将使用<code class="fe lk ll lm ln b">tf.data.Dataset</code>。处理数据集是一件特殊的事情:实际上，这也是不言自明的。</p><p id="868c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在我们的<code class="fe lk ll lm ln b">generator</code>中有一个简单的方法可以做到这一点<code class="fe lk ll lm ln b">Dataset</code>。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="d685" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们用<code class="fe lk ll lm ln b">generator</code>传递这个lambda，因为它应该是一个可执行的东西，我们需要在<code class="fe lk ll lm ln b">generator</code>中传递一些参数。</p><p id="3b7d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">output_types</code>是你的<code class="fe lk ll lm ln b">generator</code>在输入和输出中产生的东西。换成你的。</p><p id="a103" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe lk ll lm ln b">output_shapes</code>是输入和输出的形状。换成你的。</p><p id="0f12" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><em class="od">重要:</em> <code class="fe lk ll lm ln b"><strong class="kq ja">NOT</strong> [[None, 129], [None, 3]], <strong class="kq ja">NOT</strong> [(None, 129), (None, 3)]. <br/><strong class="kq ja">It is</strong> ([None, 129], [None, 3])</code>。</p><p id="53eb" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们没有设置，因为我们不想设置第一维。</p><h1 id="6ca8" class="ml mm iq bd mn mo nw mq mr ms nx mu mv kf ny kg mx ki nz kj mz kl oa km nb nc bi translated">最后一档</h1><p id="1400" class="pw-post-body-paragraph ko kp iq kq b kr nd ka kt ku ne kd kw kx nf kz la lb ng ld le lf nh lh li lj ij bi translated">将<code class="fe lk ll lm ln b">.fit</code>中的<code class="fe lk ll lm ln b">x</code>替换为等于<code class="fe lk ll lm ln b">train_dataset</code>并将<code class="fe lk ll lm ln b">validation_data</code>替换为等于<code class="fe lk ll lm ln b">test_dataset</code>。</p><p id="e718" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在开始训练，它应该工作得很好。</p><h1 id="a6d0" class="ml mm iq bd mn mo nw mq mr ms nx mu mv kf ny kg mx ki nz kj mz kl oa km nb nc bi translated">结尾部分</h1><p id="558f" class="pw-post-body-paragraph ko kp iq kq b kr nd ka kt ku ne kd kw kx nf kz la lb ng ld le lf nh lh li lj ij bi translated">希望我已经帮助了一些人，祝你们的项目好运，伙计们:)</p><p id="4d38" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">实际上，如果你现在不知道如何使用这篇文章——把它保存在某个地方以备后用，因为有一天你肯定会需要它。</p><p id="bc4f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个巨大的CSV编号及其正确处理的问题出现在我的项目<a class="ae oe" href="http://facel.tech" rel="noopener ugc nofollow" target="_blank"> Facel </a>的开发过程中。</p><p id="3f61" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们开发了一种设备，用于监控健康参数(机体疲劳、眼睛疲劳、压力、有效性和注意力水平)，并根据耳后2个点的信号控制小工具(例如，眨眼3次并停止音乐)。</p><p id="02c8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们以98%的准确率检测12种面部表情(眨眼、动眉毛等)。</p><p id="2803" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">目前，我们正在迪拜设计周的主要节目之一<a class="ae oe" href="https://globalgradshow.com/?project=facel" rel="noopener ugc nofollow" target="_blank"> GlobalGradShow </a>上展出。全世界毕业生的100个最具创新性的项目在那里展示，所以很酷。</p><p id="6b77" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们还赢得了全球创业挑战赛的俄罗斯赛段，并参加了<a class="ae oe" href="https://www.jamesdysonaward.org/" rel="noopener ugc nofollow" target="_blank">詹姆斯·戴森奖</a>(世界主要工业设计竞赛之一)的世界赛段。</p><p id="2203" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">请随时通过<a class="ae oe" href="https://www.linkedin.com/in/mixeden" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae oe" href="mailto:mixeden@facel.tech" rel="noopener ugc nofollow" target="_blank">电子邮件</a>或<a class="ae oe" href="http://t.me/mixedenn" rel="noopener ugc nofollow" target="_blank">电报</a>:)联系我</p></div></div>    
</body>
</html>