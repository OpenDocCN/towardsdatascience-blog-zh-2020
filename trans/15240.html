<html>
<head>
<title>Video Streaming in Web Browsers with OpenCV &amp; Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenCV &amp; Flask在Web浏览器中进行视频流传输</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/video-streaming-in-web-browsers-with-opencv-flask-93a38846fe00?source=collection_archive---------0-----------------------#2020-10-20">https://towardsdatascience.com/video-streaming-in-web-browsers-with-opencv-flask-93a38846fe00?source=collection_archive---------0-----------------------#2020-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e988" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">借助计算机视觉，从IP摄像机或网络摄像头传输实时视频</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/83e72bcff8cfaf89c550850b88add976.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KVG0oXKLLqoMufQG"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">罗布·萨米恩托在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1627" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你不厌其烦地在家里、办公室或任何你拥有的地方安装网络摄像头或监控摄像机。显然，你希望能够随时随地观看视频直播。</p><p id="5031" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数人使用<a class="ae kv" href="https://en.wikipedia.org/wiki/IP_camera" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> IP摄像机</strong> </a>(网络摄像机)而不是<a class="ae kv" href="https://en.wikipedia.org/wiki/Closed-circuit_television" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> CCTV </strong> </a> <strong class="ky ir"> </strong>(闭路电视)进行监控，因为它们的分辨率更高，布线成本更低。你可以在这里找到这两个系统的详细区别<a class="ae kv" href="https://www.taylored.com/blog/cctv-vs-ip-cameras-which-is-best-suited-for-your-business/" rel="noopener ugc nofollow" target="_blank">。在本文中，我们将重点关注IP摄像机。</a></p><blockquote class="ls lt lu"><p id="c6b9" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">IP摄像机是一种数字视频<strong class="ky ir"> </strong>摄像机，它通过IP网络接收控制数据并发送<strong class="ky ir">图像数据，不需要本地记录设备。大多数IP摄像机都是基于<strong class="ky ir"/><a class="ae kv" href="https://www.red5pro.com/blog/ip-camera-live-streaming-rtsp-to-webrtc/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">【RTSP】</strong>(实时流协议)</a>的，因此在互联网浏览器中“不支持”<strong class="ky ir"/>。</strong></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/fcd7c4e39fc6bbf45e400586e331720d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GyE09NsBamHiiHOnKfjpVA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由《RTSP议定书》作者提供</p></figure><h2 id="85a7" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">那么，你如何使用网络浏览器观看直播呢？</h2><p id="febc" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在这篇文章中，我们将学习如何使用<a class="ae kv" href="https://en.wikipedia.org/wiki/Computer_vision" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">计算机视觉</strong> </a>来做到这一点。</p><blockquote class="ls lt lu"><p id="38a4" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">计算机视觉</strong>是一个跨学科领域，研究如何让计算机从数字图像或视频中获得高层次的理解。</p></blockquote><p id="a5e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现计算机视觉部分，我们将使用Python中的<strong class="ky ir"> OpenCV </strong>模块，为了在网络浏览器中显示实时流，我们将使用<strong class="ky ir"> Flask </strong>网络框架。在进入编码部分之前，让我们先简单了解一下这些模块。如果你已经熟悉这些模块，你可以直接跳到下一节。</p><blockquote class="ls lt lu"><p id="096f" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">根据维基百科，Flask </strong>是一个用<a class="ae kv" href="https://en.wikipedia.org/wiki/Python_(programming_language)" rel="noopener ugc nofollow" target="_blank"> Python </a>编写的微型<a class="ae kv" href="https://en.wikipedia.org/wiki/Web_framework" rel="noopener ugc nofollow" target="_blank"> web框架</a>。它被归类为微框架，因为它不需要特殊的工具或库。它没有数据库抽象层、表单验证或任何其他组件，而现有的第三方库提供了通用功能。</p><p id="6e13" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">根据GeeksForGeeks的说法，OpenCV </strong>是用于计算机视觉、机器学习和图像处理的巨大开源库，现在它在实时操作中发挥着重要作用，这在当今的系统中非常重要。</p></blockquote></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="ab59" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated"><strong class="ak">步骤1-安装烧瓶&amp; OpenCV : </strong></h2><p id="4d4b" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">您可以使用'<em class="lv"> pip install </em> flask '和'<em class="lv">pip install opencv-python</em>命令。我使用PyCharm IDE开发flask应用程序。<strong class="ky ir"> <em class="lv">要在PyCharm </em> </strong>中轻松安装库，请遵循以下<a class="ae kv" href="https://www.jetbrains.com/help/pycharm/installing-uninstalling-and-upgrading-packages.html" rel="noopener ugc nofollow" target="_blank">步骤</a>。</p><h2 id="dc7d" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">步骤2- <strong class="ak">导入必要的库，初始化flask app : </strong></h2><p id="9b44" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我们现在将导入必要的库并初始化我们的flask应用程序。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="39a0" class="ma mb iq ng b gy nk nl l nm nn"><strong class="ng ir">#Import necessary libraries</strong><br/>from flask import Flask, render_template, Response<br/>import cv2<br/><strong class="ng ir">#Initialize the Flask app</strong><br/>app = Flask(__name__)</span></pre><h2 id="a364" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">第3步-使用OpenCV捕获视频:</h2><p id="7cd0" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">创建一个VideoCapture()对象来触发摄像机并读取视频的第一个图像/帧。我们既可以提供视频文件的路径，也可以使用数字来指定使用本地网络摄像头。为了触发网络摄像头，我们传递“0”作为参数。为了捕捉来自IP摄像机的实时反馈，我们提供了<strong class="ky ir"> RTSP链接</strong>作为参数。要知道你的IP摄像机的RTSP地址，请浏览这个— <a class="ae kv" href="http://help.angelcam.com/en/articles/372649-finding-rtsp-addresses-for-ip-cameras-nvrs-dvrs" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">查找RTSP地址</strong> </a>。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="23e5" class="ma mb iq ng b gy nk nl l nm nn">camera = cv2.VideoCapture(0)</span><span id="7cae" class="ma mb iq ng b gy no nl l nm nn">'''<br/>for ip camera use - rtsp://username:password@ip_address:554/user=username_password='password'_channel=channel_number_stream=0.sdp' </span><span id="a179" class="ma mb iq ng b gy no nl l nm nn">for local webcam use cv2.VideoCapture(0)<br/>'''</span></pre><h2 id="0066" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">步骤4-添加窗口并从相机生成帧:</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/5f5bb8e0f9b9a687fac27cadc94ef663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dl_yd70GJrHMRVKdzpsZTg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按作者分类的图像-帧生成功能</p></figure><p id="74d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">gen_frames()函数进入一个循环，在这个循环中，它不断地从摄像机返回帧作为响应块。该函数要求摄像机提供一个帧，然后它将这个帧格式化为一个内容类型为<code class="fe nq nr ns ng b">image/jpeg</code>的响应块，如上所示。代码如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">帧生成函数</p></figure><h2 id="128c" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated"><strong class="ak">第五步-定义网络应用默认页面的应用路径</strong>:</h2><p id="1132" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">路由是指某个app的URL模式(如myapp.com/home或myapp.com/about)。<code class="fe nq nr ns ng b">@app.route("/")</code>是Flask提供的一个Python装饰器，用于轻松地将我们应用程序中的URL分配给函数。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="e6ec" class="ma mb iq ng b gy nk nl l nm nn">@app.route('/')<br/>def index():<em class="lv"><br/>    </em>return render_template('index.html')</span></pre><p id="c9eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">装饰器告诉我们的<code class="fe nq nr ns ng b">@app</code>，每当用户在给定的<code class="fe nq nr ns ng b">.route()</code>访问我们的应用程序域(<em class="lv"> localhost:5000用于本地服务器)</em>，执行<code class="fe nq nr ns ng b">index()</code>函数。Flask使用Jinja模板库来渲染模板。在我们的应用程序中，我们将使用模板来呈现将在浏览器中显示的HTML。</p><h2 id="95ad" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">步骤6-定义视频馈送的应用程序路由:</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="137e" class="ma mb iq ng b gy nk nl l nm nn">@app.route('/video_feed')<br/>def video_feed():<br/>    return Response(gen_frames(), mimetype='multipart/x-mixed-replace; boundary=frame')</span></pre><p id="30ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“/video_feed”路由返回流响应。因为这个流返回要在网页中显示的图像，所以这个路由的URL在图像标记的“src”属性中(参见下面的“index.html”)。浏览器将通过在其中显示JPEG图像流来自动保持图像元素的更新，因为大多数/所有浏览器都支持多部分响应</p><p id="4b45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看我们的<strong class="ky ir">index.html</strong>文件:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="c47c" class="ma mb iq ng b gy nk nl l nm nn">&lt;body&gt;<br/>&lt;div class="container"&gt;<br/>    &lt;div class="row"&gt;<br/>        &lt;div class="col-lg-8  offset-lg-2"&gt;<br/>            &lt;h3 class="mt-5"&gt;Live Streaming&lt;/h3&gt;<br/>            <strong class="ng ir">&lt;img src="{{ url_for('video_feed') }}" width="100%"&gt;</strong><br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;/body&gt;</span></pre><h2 id="c6ad" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated"><strong class="ak">步骤7-启动Flask服务器</strong>:</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="6f9e" class="ma mb iq ng b gy nk nl l nm nn">if __name__ == "__main__":<br/>    app.run(debug=True)</span></pre><p id="bacb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">app.run()被调用，web应用程序被本地托管在<em class="lv">【localhost:5000】上。</em></p><p id="8362" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“debug=True”确保我们不需要在每次进行更改时都运行我们的应用程序，我们只需在服务器仍在运行时刷新我们的网页来查看更改。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="a83d" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">项目结构:</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/12aa5ca9d1dde94623f6d5cc500c5e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*LJolnUEN12K-QtM1oNmLuw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按作者分类的图像-项目结构</p></figure><p id="7f7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该项目保存在一个名为“相机检测”的文件夹中。我们运行“app.py”文件。在运行这个文件时，我们的应用程序被托管在端口5000的本地服务器上。</p><blockquote class="ls lt lu"><p id="70e1" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">运行“app.py”后，您只需在web浏览器上键入“localhost:5000”即可打开您的web应用程序</p></blockquote><ul class=""><li id="21da" class="nw nx iq ky b kz la lc ld lf ny lj nz ln oa lr ob oc od oe bi translated">app.py —这是我们在上面创建的Flask应用程序</li><li id="78d9" class="nw nx iq ky b kz of lc og lf oh lj oi ln oj lr ob oc od oe bi translated">模板—该文件夹包含我们的“index.html”文件。渲染模板时，这在Flask中是强制的。所有HTML文件都放在这个文件夹下。</li></ul><p id="92e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看运行“app.py”时会发生什么:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/ecb35a261a08c188adf26d8a324d3408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*S76P4h2eT-XvOTt28iaCEQ.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片Flask应用程序的本地服务器</p></figure><p id="2ed3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击提供的URL，我们的网络浏览器会打开实时提要。由于我使用了上面的<strong class="ky ir"> VideoCapture(0) </strong>，网络摄像头的视频显示在浏览器上:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/8e81933c007f6b484eb96b6d7b96ce3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKtZmrLaAMuKiNe2cmOmyA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供-本地网络摄像头在网络浏览器上提供</p></figure></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="9997" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！！</p><p id="36e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的网络浏览器上有来自IP摄像头/网络摄像头的实时视频流，可用于安全和监控目的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.buymeacoffee.com/nakullakhotia"><div class="gh gi om"><img src="../Images/ddf83bcb485f106561fc652826105be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VqLYs481X9kw_CTosgqlcg.png"/></div></a><p class="kr ks gj gh gi kt ku bd b be z dk translated">如果你喜欢读这篇文章，请支持我。点击上图。谢谢你</p></figure><p id="89a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参考我的<a class="ae kv" href="https://github.com/NakulLakhotia/Live-Streaming-using-OpenCV-Flask" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> GitHub代码</strong> </a>。</p><p id="fb15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">注意</em> </strong> <em class="lv">:本文中已经提到了开始工作所需的所有资源及其链接。希望你好好利用:)</em></p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="3583" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章能让你对尝试计算机视觉领域的新事物感兴趣，并帮助你增加知识。如果你喜欢读这篇文章，请与你的朋友和家人分享。谢谢你的时间。</p></div></div>    
</body>
</html>