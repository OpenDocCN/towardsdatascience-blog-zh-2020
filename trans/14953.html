<html>
<head>
<title>Interactive Visualization of the Outcome of Any Binary Classifier — in 5 Lines of Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">任何二元分类器结果的交互式可视化——用5行Python代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-visualization-of-binary-classification-in-5-lines-of-python-9c1f627ded8?source=collection_archive---------31-----------------------#2020-10-14">https://towardsdatascience.com/interactive-visualization-of-binary-classification-in-5-lines-of-python-9c1f627ded8?source=collection_archive---------31-----------------------#2020-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="edc9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用“混淆_viz”制作一个有影响力的模型结果图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8289fb0a20b2c53e51eab48d4e422771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*akBzwu5rojzhHkG5g7XbZA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">[图片由作者提供]</p></figure><h2 id="0ed7" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">TL；博士</strong></h2><p id="6e6d" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">给匆匆忙忙的人的5行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">片段:混淆的用法</p></figure><h1 id="fa38" class="mp kz it bd la mq mr ms ld mt mu mv lg jz mw ka lk kc mx kd lo kf my kg ls mz bi translated"><strong class="ak">简介</strong></h1><p id="bc16" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi na translated">二进制分类是机器学习中最常见的任务。它也很通用，因为n类问题和回归问题都可以简化为二元情况(当然会丢失一些信息)。</p><p id="de6f" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">假设您已经收集了数据，清理了数据并安装了分类器。可惜，工作结束的时候，工作才刚刚开始！事实上，你仍然需要处理很多东西:真阳性、假阳性、假阴性、准确度、精确度、召回率……而且，所有这些都要乘以可能的阈值数(很容易有数千个)。</p><p id="97b7" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">这就是为什么我开始寻找<strong class="lw iu">一个单一的(可能是图形化的和交互式的)表示，包含关于二进制分类任务</strong>的所有相关信息。鉴于这种可视化是建立在混淆矩阵之上的，我把它叫做“<em class="nj">混淆_viz </em>”。</p><h1 id="6338" class="mp kz it bd la mq mr ms ld mt mu mv lg jz mw ka lk kc mx kd lo kf my kg ls mz bi translated">来自混乱的知识(矩阵)</h1><p id="9b61" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">用来评估分类优劣的最初级工具(可能是机器学习模型，也可能是确定性规则)叫做<a class="ae np" href="https://en.wikipedia.org/wiki/Confusion_matrix" rel="noopener ugc nofollow" target="_blank">混淆矩阵</a>。这是一个表格，显示了每个班级有多少人被正确或错误地分类。</p><p id="fae0" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">例如，让我们对一些模拟数据做一个简单的分类问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">片段:生成数据、拟合分类器和打印混淆矩阵。</p></figure><p id="f0bb" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">这是混淆矩阵:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/536362bf0e34f8e61b9e41ceef26aa60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5e0lkEeqVwnXsvtCOKFjKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">二元分类器的混淆矩阵。[图片由作者提供]</p></figure><p id="2502" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">数字是“原始的”这一事实构成了混淆矩阵的优点和缺点。</p><ul class=""><li id="0d75" class="nr ns it lw b lx nk ma nl lh nt ll nu lp nv mm nw nx ny nz bi translated"><strong class="lw iu">优势</strong>:因为——与更具体的度量标准(如精确度、召回率或提升率)相比——<strong class="lw iu">混淆矩阵的含义是任何人都能立即理解的，包括非技术利益相关者</strong>。</li><li id="c553" class="nr ns it lw b lx oa ma ob lh oc ll od lp oe mm nw nx ny nz bi translated"><strong class="lw iu">缺点</strong>:因为<strong class="lw iu">原始数字不那么容易解读</strong>。</li></ul><p id="e19f" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">因此，可以采用几个选项来使混淆矩阵更具“表现力”。例如:</p><ol class=""><li id="1ad0" class="nr ns it lw b lx nk ma nl lh nt ll nu lp nv mm of nx ny nz bi translated">热图</li><li id="9eb7" class="nr ns it lw b lx oa ma ob lh oc ll od lp oe mm of nx ny nz bi translated">按列规范化</li><li id="6bf2" class="nr ns it lw b lx oa ma ob lh oc ll od lp oe mm of nx ny nz bi translated">按行规范化</li><li id="942c" class="nr ns it lw b lx oa ma ob lh oc ll od lp oe mm of nx ny nz bi translated">总计标准化</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/6d4a1450efd377e304bfec5274c1eede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8b0lnWhlusekyllNdGoH6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">混淆矩阵“操作”的一些简单例子。[图片由作者提供]</p></figure><h1 id="42bb" class="mp kz it bd la mq mr ms ld mt mu mv lg jz mw ka lk kc mx kd lo kf my kg ls mz bi translated">混淆矩阵的图形可视化</h1><p id="81cd" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">这些操作给出了模特表演的多面肖像。然而，问题是人类并不擅长存储大量的信息。这就是为什么我开始想知道如何得到一个有效的混乱矩阵的可视化，它可以“一目了然”地显示所有相关信息。</p><p id="046b" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">这种可视化的要求是:</p><ul class=""><li id="5e8d" class="nr ns it lw b lx nk ma nl lh nt ll nu lp nv mm nw nx ny nz bi translated">情节应该是二维的(当然)，</li><li id="b2de" class="nr ns it lw b lx oa ma ob lh oc ll od lp oe mm nw nx ny nz bi translated">涉及真阳性、假阳性、真阴性和假阴性的绘图区域应该与它们的数量成比例。</li></ul><p id="e49e" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">经过一些尝试后，我开始定义一个对我的目标来说足够直观的可视化。根据它，上面的混淆矩阵应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/3e12005f21afa3bf2757421de539552f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pI6mn4IlJbRlZ8ksUv7M2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">混乱矩阵的静态图。[图片由作者提供]</p></figure><p id="b3e4" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">带有粉红色边框的正方形代表阳性总数(即真阳性+假阴性)。这就像仪表板的靶心:我们希望我们的模型能够在这里投出大部分飞镖。</p><p id="b3df" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">带黑边的正方形准确地代表了模型的猜测:这些都是被标记为阳性的个体。因此，粉边方块和黑边方块之间的公共区域用绿色填充，代表真正的阳性。剩下的部分是由假阳性构成的，并被涂上红色。</p><h1 id="f377" class="mp kz it bd la mq mr ms ld mt mu mv lg jz mw ka lk kc mx kd lo kf my kg ls mz bi translated">一个问题，多个矩阵</h1><p id="6bd4" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">但是事情要比这复杂一些。事实上，对于每个模型，我们并不只有一个混淆矩阵。其实我们有很多。这怎么可能呢？对于非技术涉众来说，这通常难以理解。</p><p id="7308" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">这完全取决于“概率阈值”这个概念。大多数分类算法的输出实际上不是每个个体的0/1，而是一个介于0和1之间的数字，表示该个体成为阳性的可能性，我们称之为“概率”。</p><p id="2557" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">因此，最终的分类0/1不是自动的，而是从(商业)决策中派生出来的。决策在于确定概率阈值，高于该阈值的个体应被分类为1。</p><p id="c365" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">让我们更清楚地说明这一点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/62fc7b48541017c48e9e484ae2860c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJFL4fvKa--prB2kiAA0fA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个模型输出，许多混淆矩阵。[图片由作者提供]</p></figure><p id="bc47" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated"><strong class="lw iu">每一个可能的决策都与一个0/1的数组相关联。反过来，每个数组与不同的混淆矩阵相关联。</strong>这就是为什么，对于一个单一的模型，我们可能有数千(甚至数百万！)的可能混淆矩阵:每个阈值一个。</p><p id="f8e1" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">因此，问题变成:<strong class="lw iu">我们能在一个单独的图中表示不同的混淆矩阵(或者至少它们的一个代表子集)吗？</strong></p><p id="d9d6" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">通过使用<a class="ae np" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>，它可以通过一个滑块来完成:这就是交互图帮助我们的地方。这个想法是，当我们从左向右移动滑块时，相关的阈值增加，因此选择变得越来越“限制性”，也就是说，我们归类为阳性的观察数量越来越少。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c28af706fa456143c9dd9d06f2600f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BEC_U-sGf9esFM5JpWP9BQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">许多混淆矩阵的交互图(每个概率阈值一个)。注意:由于从html到gif的转换，一些颜色可能会改变。[图片由作者提供]</p></figure><p id="1fe9" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">滑块指示什么是当前概率阈值(“P ≥阈值”)。</p><p id="348c" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">如果你留意精度和回忆，你会注意到它们有相反的行为:当滑块向右移动时，回忆减少，而精度提高。这很有意义:如果你只选择最危险的个体，你可能会更精确，但代价是识别出更小部分的阳性(即更小的回忆)。</p><p id="9f5d" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">一般来说，图形的交互特性允许您选择一个适合您的特定用例的阈值。</p><h1 id="042b" class="mp kz it bd la mq mr ms ld mt mu mv lg jz mw ka lk kc mx kd lo kf my kg ls mz bi translated">我可以用我自己的数据做这个吗？</h1><p id="2251" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">其实很简单！</p><p id="f3be" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">你所要做的就是在你的环境中pip-安装包<em class="nj">混淆_即</em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">片段:安装混淆_viz。</p></figure><p id="da75" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">这个包包含一个名为ConfusionViz的类，所以您只需在Python代码中导入它。下一个片段展示了如何使用ConfusionViz:在笔记本模式下显示交互情节(命令<em class="nj">)。show() </em>)或将其导出为html文件(命令<em class="nj">)。to_html() </em>)，然后可以用任何浏览器打开。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">片段:混淆的用法。</p></figure><p id="4735" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">你只需要把<em class="nj"> y_test </em>和<em class="nj"> probas_test </em>换成你自己的数据，游戏就做好了！</p></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="c654" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">感谢您的阅读！我希望这篇文章对你有用。</p><p id="c21d" class="pw-post-body-paragraph lu lv it lw b lx nk ju lz ma nl jx mc lh nm me mf ll nn mh mi lp no mk ml mm im bi translated">我感谢反馈和建设性的批评。如果你想谈论这篇文章或其他相关话题，你可以发短信给我<a class="ae np" href="https://www.linkedin.com/in/samuelemazzanti/" rel="noopener ugc nofollow" target="_blank">我的Linkedin联系人</a>。</p></div></div>    
</body>
</html>