<html>
<head>
<title>Real Time Crypto Prices in Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Excel中的实时加密价格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/live-streaming-crypto-prices-in-excel-aaa41628bc53?source=collection_archive---------6-----------------------#2020-10-27">https://towardsdatascience.com/live-streaming-crypto-prices-in-excel-aaa41628bc53?source=collection_archive---------6-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="208d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何将实时加密价格导入Microsoft Excel</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ab9da308a051fce5fd3a61df5694d8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*t7Gy7CZb7LI-2g8cMfqJBA.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Excel中的实时BitMEX价格。图片作者。</p></figure><p id="7278" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> <em class="lr">注来自《走向数据科学》的编辑:</em> </strong> <em class="lr">虽然我们允许独立作者根据我们的</em> <a class="ae ls" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lr">规则和指导方针</em> </a> <em class="lr">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ls" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lr">读者术语</em> </a> <em class="lr">。</em></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="57a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">交易加密货币可能是一个非常有趣和有益的活动。有许多不同的交易平台和交易所将提供API访问他们的数据，允许精明的交易者围绕自己的策略和交易需求构建自己的工具。</p><p id="fe7b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Microsoft Excel是许多交易者的首选，因为它提供了巨大的潜力来创建定制工具和仪表板，以建立市场洞察力，用数据和想法进行测试和实验，以及监控投资组合表现和跟踪头寸。</p><p id="aa03" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更严肃的有技术头脑的交易者也会想用Python进行数据分析和回测交易策略，甚至建立系统化或自动化的交易策略。</p><p id="0bc4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">大多数加密交换提供了一种通过API以编程方式从其平台获取数据的方法。这是我们用来将基于Excel或Python的工具连接到平台以获取数据和管理订单的工具。</p><p id="3835" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr">在本文中，我们将使用BitMEX Python API将实时价格导入Microsoft Excel。</em></p><p id="18cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要将实时BitMEX价格导入Excel，您需要:</p><ul class=""><li id="d019" class="ma mb iq kx b ky kz lb lc le mc li md lm me lq mf mg mh mi bi translated">一个来自www.bitmex.com T21的BitMEX账户。</li><li id="653b" class="ma mb iq kx b ky mj lb mk le ml li mm lm mn lq mf mg mh mi bi translated">安装在你电脑上的Python 3来自www.python.org或其他Python发行版。</li><li id="adc5" class="ma mb iq kx b ky mj lb mk le ml li mm lm mn lq mf mg mh mi bi translated">PyXLL，Python Excel插件，来自www.pyxll.com。这是一个商业产品，但你可以使用30天的免费试用。</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="c28e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们将编写Python代码来获取Python中的实时价格并进行测试。一旦成功，我们将使用<a class="ae ls" href="https://www.pyxll.com/?utm_souce=medium" rel="noopener ugc nofollow" target="_blank"> PyXLL </a>从Excel调用Python代码。</p><p id="f290" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了通过websockets与BitMEX API对话，我们需要Python " <a class="ae ls" href="https://pypi.org/project/websockets/" rel="noopener ugc nofollow" target="_blank"> websockets </a>"包。打开命令提示符，使用Python包管理器“pip”通过运行“pip install websockets”来安装websockets包。</p><p id="7438" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下Python代码创建了一个到BitMEX API的websocket连接，订阅了对“<a class="ae ls" href="https://gist.github.com/tonyroberts/d5e9cc4bf6f512b2d3e2fd9097c088ac" rel="noopener ugc nofollow" target="_blank"> XBTUSD </a>”工具的更新，然后等待消息返回并在消息到达时打印它们。有了这段代码，我们现在可以使用Python从BitMEX实时传输价格了！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="89df" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以通过将此代码保存到名为“bitmex.py”的文件中，然后从命令提示符下运行“python bitmex.py”来运行它。对于开发Python代码，您会发现使用诸如IDLE(安装Python时标配)或PyCharm之类的Python IDE更容易。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="5c09" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的代码展示了如何使用websockets包连接到BitMex API，以接收Python中的价格更新。在我们可以在Excel中使用它之前，我们将对它稍加改进，以便我们可以“订阅”单个更新事件。</p><p id="354f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面我们用“subscribe”方法定义一个类“BitMex”。使用它，我们可以订阅个人更新。BitMex类将处理把它从websockets API接收的消息路由到已经订阅的每个符号和字段的相关回调。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="75d1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的“main”函数中，我们创建了一个“BitMex”类的实例，并订阅了对“XBTUSD”工具上“lastPrice”字段的更新。每当新的“lastPrice”事件发生时，就会调用回调并打印新的价格。</p><p id="fbc4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们有了这个BitMex类，并且能够订阅特定的字段和符号，接下来我们将使用PyXLL将它公开给Excel。这将使我们能够从BitMEX到Excel的实时流数据！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="a334" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要使用上面用Python编写的代码，我们需要安装PyXLL Excel插件。你可以找到安装说明，并从https://www.pyxll.com<a class="ae ls" href="https://www.pyxll.com?utm_source=medium" rel="noopener ugc nofollow" target="_blank">下载插件。</a></p><p id="75bf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦安装了PyXLL，就可以通过编辑pyxll.cfg配置文件向其中添加自己的Python模块。我们将编写一个使用<a class="ae ls" href="https://www.pyxll.com/docs/userguide/rtd.html?utm_source=medium" rel="noopener ugc nofollow" target="_blank"> PyXLL的实时数据特性</a>的新Python模块，你可以在这里阅读更多关于<a class="ae ls" href="https://www.pyxll.com/docs/userguide/rtd.html?utm_source=medium" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="cfbd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们用pyxll编写了一个RTD函数，方法是创建一个从“PyXLL”派生的新类。RTD”类，然后编写一个Python函数来返回它。Python函数是使用PyXLL的“@xl_func”装饰器来装饰的，以将其公开为Excel函数。RTD类有两个方法，“connect”和“disconnect ”,我们可以根据需要使用它们来订阅和取消订阅BitMex数据。当我们收到新的值时，我们更新RTD对象的“值”属性，这导致我们在Excel中看到的值更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="9a68" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过将这个新的Python模块添加到pyxll.cfg配置文件中的“modules”列表，可以将它添加到我们的PyXLL外接程序中。包含这个模块的文件夹，以及我们之前写的bitmex.py模块，也需要在“pythonpath”上，这样Python才能导入它们。pythonpath也可以在pyxll.cfg配置文件中设置。</p><p id="3116" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当我们启动Excel或重新加载PyXLL插件时，这个新模块将被加载，我们可以从Excel调用“bitmex_rtd”函数。如果有任何问题，请检查PyXLL日志文件，看看哪里出错了。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="0e1c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在在Excel中，我们可以像调用另一个Excel工作表函数一样调用新的“bitmex_rtd”函数。因为它是一个实时数据函数，所以每次通过BitMEX websockets API接收到对请求字段的更新时，该值都会继续更新。</p><p id="baaa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">=bitmex_rtd("XBTUSD "，" lastPrice ")</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/630fa15cba9f688b776f8fbd69664179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/1*PXA2nvEhNQwHcFbCmTwF3g.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从Excel调用bitmex_rtd Python函数。图片作者。</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="5f44" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">许多加密平台和交易所以类似于BitMEX的方式提供API访问。我们可以使用上面显示的相同技术在Python中访问这些价格。PyXLL在用于调用这些API的Python代码和Excel之间提供了一座优雅的桥梁。</p><p id="2c4e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们不仅仅局限于获取如上所示的数据。大多数平台API也允许我们通过他们的API下订单。我们可以使用它来构建和集成用Python编写的定制交易应用程序，但使用Excel作为这些工具的接口。</p><p id="81ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Python和Excel的结合为我们提供了现代和强大的编程语言的优点，并保持Excel作为灵活、直观的前端供我们使用。</p><h1 id="1ab9" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">参考</h1><ul class=""><li id="de5c" class="ma mb iq kx b ky nj lb nk le nl li nm lm nn lq mf mg mh mi bi translated"><a class="ae ls" href="https://www.pyxll.com?utm_source=medium" rel="noopener ugc nofollow" target="_blank"> PyXLL，Python Excel插件</a></li><li id="f815" class="ma mb iq kx b ky mj lb mk le ml li mm lm mn lq mf mg mh mi bi translated"><a class="ae ls" href="https://www.bitmex.com/app/wsAPI" rel="noopener ugc nofollow" target="_blank"> BitMEX Websocket API </a></li><li id="c5d1" class="ma mb iq kx b ky mj lb mk le ml li mm lm mn lq mf mg mh mi bi translated"><a class="ae ls" href="https://websockets.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Python Websockets文档</a></li><li id="2225" class="ma mb iq kx b ky mj lb mk le ml li mm lm mn lq mf mg mh mi bi translated"><a class="ae ls" href="https://github.com/pyxll/pyxll-examples/tree/master/bitmex" rel="noopener ugc nofollow" target="_blank">GitHub中的Python代码和电子表格</a></li><li id="7494" class="ma mb iq kx b ky mj lb mk le ml li mm lm mn lq mf mg mh mi bi translated"><a class="ae ls" href="https://www.youtube.com/watch?v=v2ig4w9GVlo" rel="noopener ugc nofollow" target="_blank">Excel中的实时加密价格(YouTube) </a></li></ul></div></div>    
</body>
</html>