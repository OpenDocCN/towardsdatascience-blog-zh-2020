<html>
<head>
<title>SQL Queries for Data Scientists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家的SQL查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-queries-for-data-scientists-5260737fc442?source=collection_archive---------23-----------------------#2020-11-01">https://towardsdatascience.com/sql-queries-for-data-scientists-5260737fc442?source=collection_archive---------23-----------------------#2020-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5129" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">举例说明。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4d6aab899f3fd18af4075009350b323d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5T5ZBMB1DE2Vqo7gNF78w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Miguel A. Amutio 在<a class="ae ky" href="https://unsplash.com/s/photos/overview?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="fe62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL是一种编程语言，大多数关系数据库管理系统(RDBMS)使用它来管理以表格形式存储的数据。</p><p id="80b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL是数据科学家应该具备的基本技能。你可能会说这是数据工程师的工作，但数据科学家的角色更倾向于全栈。此外，作为一名数据科学家，你不会希望依赖数据工程师从数据库中检索数据。</p><p id="dbdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将编写复杂的查询来检索存储在表中的数据。我已经将<a class="ae ky" href="https://www.kaggle.com/shubh0799/churn-modelling" rel="noopener ugc nofollow" target="_blank">的客户流失数据集</a>上传到MySQL数据库的一个表中。</p><p id="431a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从简单的查询开始，逐步增加复杂性。我将描述所需的数据，然后编写查询从表中检索数据。</p><p id="a3be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先来看看表中的列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/d0b569eeb4f607c429411b7c8c6b72ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*wfpesetqCyQCl-yZFq2H3Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="33d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">银行的客户及其账户有一些特征。“已离开”栏显示客户是否离开银行。</p><p id="16a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始查询了。</p><h2 id="4774" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">“客户Id”和“姓氏”列的前5行</h2><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7b70" class="lw lx it mq b gy mu mv l mw mx">SELECT CustomerId, Surname <br/>FROM CHURN<br/>LIMIT 5;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/c0707b2d9f424ca26339980444c4a870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*KUiteOgAE8bpeLAmav3vLg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="092c" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">具有最高余额的客户的ID</h2><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="6e2d" class="lw lx it mq b gy mu mv l mw mx">SELECT CustomerId, MAX(Balance)<br/>FROM CHURN;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/5eee9fbe598ae39cb53bfcbfec7cc62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*a5NnznGBGD4udAbepn20bA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="62d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们没有检索整个“Balance”列，而是使用MAX aggregate函数只选择该列中的最大值。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="2248" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">最高余额的前5名客户的位置</h2><p id="551f" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们无法使用最大值进行此查询，因为我们需要前5名客户。我们可以做的是根据余额对客户进行排序，然后使用限额选择前5名。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="11a9" class="lw lx it mq b gy mu mv l mw mx">SELECT Geography, Balance<br/>FROM CHURN<br/>ORDER BY Balance DESC<br/>LIMIT 5;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/2017c9bce03c54b07dec33b167f47d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*IXPDhUd2Rsg074dMeU3qaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="8c48" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">没有信用卡的顾客的平均年龄</h2><p id="30aa" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">有一个条件要求我们使用WHERE语句。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7396" class="lw lx it mq b gy mu mv l mw mx">SELECT AVG(Age)<br/>FROM CHURN<br/>WHERE HasCrCard = 0;</span><span id="13fe" class="lw lx it mq b gy nn mv l mw mx">39.1121</span></pre><p id="c2b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想知道，拥有信用卡的顾客的平均年龄是38.8424岁。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="0b78" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">每个国家拥有2种以上产品的顾客数量</h2><p id="86fb" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们将使用另一个聚合函数来计算客户数量。为了根据属性对客户进行分组，使用了GROUP BY语句。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="38e4" class="lw lx it mq b gy mu mv l mw mx">SELECT Geography, COUNT(CustomerId)<br/>FROM CHURN<br/>WHERE NumOfProducts &gt; 2<br/>GROUP BY Geography;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/de84d4bc6a1557275e2adc26fa6e0046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*sgzEuj2jmYKliMDf81GlqA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="ae06" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated"><strong class="ak">基于产品数量的平均预计工资</strong></h2><p id="0750" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们可以将AVG函数应用于工资，并根据产品数量进行分组。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="2383" class="lw lx it mq b gy mu mv l mw mx">SELECT NumOfProducts, AVG(EstimatedSalary)<br/>FROM CHURN<br/>GROUP BY NumOfProducts;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/a205b622c6540db22a4ffe1be662d615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*0Hml5BVksydlkiiARZKo3w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="6d8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想介绍另一个与条件有关的陈述。WHERE语句允许我们选择符合一个或多个条件的条目。但是，它不能与聚合函数一起使用。</p><p id="3882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于上面的查询，假设我们只对平均高于100000的产品类别的数量感兴趣。因此，我们需要对平均值应用一个条件，这可以使用HAVING语句来完成。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="1c86" class="lw lx it mq b gy mu mv l mw mx">SELECT NumOfProducts, AVG(EstimatedSalary)<br/>FROM CHURN<br/>GROUP BY NumOfProducts<br/>HAVING AVG(EstimatedSalary) &gt; 100000;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/1da8bbd40a6bcca64ac3ff7cca809a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*EyKmOzd6wpQVY0a7wxGH-g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="3ebb" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">年龄超过50岁且余额高于平均水平的客户</h2><p id="8664" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们在这里介绍两个新的话题。一种是使用多个条件(年龄和余额)，另一种是嵌套的SELECT语句。</p><p id="6c95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用逻辑运算符(如AND和OR)在WHERE语句中组合多个条件。一个条件是显式给出的(年龄&gt; 50)，但另一个条件需要使用另一个SELECT语句在表上计算。这就是我们需要嵌套SELECT语句的地方。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7574" class="lw lx it mq b gy mu mv l mw mx">SELECT CustomerId, Age, Balance <br/>FROM CHURN<br/>WHERE Age &gt; 50 AND Balance &gt; (<br/>    SELECT AVG(Balance)<br/>    FROM CHURN );</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d6560814f6fcb13a1369557f8a053dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*4D0OP2J-V8lA2EvZojEofg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果集的前7行(作者图片)</p></figure><p id="c3be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">余额上的条件是另一个SELECT语句。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="147f" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">留在银行的女性客户数量超过平均水平(任期)并受到影响</h2><p id="036e" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">它类似于前一个示例，但有一个附加条件。我们将根据三个条件来计算客户数量:</p><ul class=""><li id="03f8" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">性别</li><li id="3c06" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">搅动(退出=1)</li><li id="736d" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">成为客户的持续时间(任期)</li></ul><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="8a76" class="lw lx it mq b gy mu mv l mw mx">SELECT COUNT(CustomerId) AS 'Number of Customers'<br/>FROM CHURN<br/>WHERE Gender = 'Female' AND Exited=1 AND Tenure &gt; (<br/> SELECT AVG(Tenure)<br/>    FROM CHURN);</span></pre><p id="ce42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用“AS”关键字调整结果集中的列名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/a7738899d819a964982b85312603b570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ydxi-H6jUYHq12WCOu8UcA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="c4fd" class="of lx it bd ly og oh oi mb oj ok ol me jz om ka mh kc on kd mk kf oo kg mn op bi translated">结论</h1><p id="03de" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们已经讨论了一些基本和复杂的查询。我们通过查询实现的是，一些计算和过滤是在数据库级别完成的。因此，我们只能检索我们需要的数据，而不是获取所有数据，然后进行过滤和计算。</p><p id="ff6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为现实生活中的数据库包含更多的数据和许多关系表，所以能够使用SQL查询所需的数据非常重要。</p><p id="fa3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>