<html>
<head>
<title>Benchmarking Language Detection for NLP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自然语言处理的基准语言检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/benchmarking-language-detection-for-nlp-8250ea8b67c?source=collection_archive---------6-----------------------#2020-11-16">https://towardsdatascience.com/benchmarking-language-detection-for-nlp-8250ea8b67c?source=collection_archive---------6-----------------------#2020-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="b711" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/getting-started" rel="noopener" target="_blank">入门</a></h2><div class=""/><div class=""><h2 id="3ab5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用于识别文本语言的四个Python工具，以及速度和准确性测试</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/247febcb5c95276665382aa9351072eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWL9ILJlQQQT7N90PlMjRw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">杰奎琳·布兰德韦恩在<a class="ae lh" href="https://unsplash.com/s/photos/languages?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6234" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">大多数NLP应用程序往往是特定于语言的，因此需要单语数据。为了用目标语言构建应用程序，您可能需要应用一种预处理技术，过滤掉用非目标语言编写的文本。这需要正确识别每个输入示例的语言。下面我列出了一些工具，您可以使用它们作为Python模块来满足这个预处理需求，并提供了一个性能基准来评估每一个工具的速度和准确性。</p><h1 id="aabb" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">1)语言检测</h1><div class="mw mx gp gr my mz"><a href="https://pypi.org/project/langdetect/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd jd gy z fp ne fr fs nf fu fw jc bi translated">langdetect</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">Nakatani Shuyo的语言检测库(版本从03/03/2014)到Python的移植。$ pip安装语言检测…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">pypi.org</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn lb mz"/></div></div></a></div><p id="6c44" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe no np nq nr b">langdetect</code>是Google的<a class="ae lh" href="https://github.com/shuyo/language-detection" rel="noopener ugc nofollow" target="_blank">语言检测</a>库从Java到Python的重新实现。只需将您的文本传递给导入的<code class="fe no np nq nr b">detect</code>函数，它将输出模型给出最高置信度得分的语言的两个字母的ISO 693代码。(参见<a class="ae lh" href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes" rel="noopener ugc nofollow" target="_blank">本页</a>了解693个代码及其各自语言的完整列表。)如果你使用<code class="fe no np nq nr b">detect_langs</code>来代替，它将输出一个列表，列出模型已经预测到的顶级语言，以及它们的概率。</p><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="0b9d" class="nw mf it nr b gy nx ny l nz oa">from langdetect import DetectorFactory, detect, detect_langs</span><span id="247c" class="nw mf it nr b gy ob ny l nz oa">text = "My lubimy mleko i chleb."</span><span id="5b6a" class="nw mf it nr b gy ob ny l nz oa">detect(text) #  'cs'<br/>detect_langs(text)  # [cs:0.7142840957132709, pl:0.14285810606233737, sk:0.14285779665739756]</span></pre><p id="a0ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">几个点缀点:</p><ol class=""><li id="b42a" class="oc od it lk b ll lm lo lp lr oe lv of lz og md oh oi oj ok bi translated">库制作者建议您将<code class="fe no np nq nr b">DetectorFactory</code>种子设置为某个数字。这是因为langdetect的算法是不确定的，这意味着如果你试图在太短或太模糊的文本上运行它，你可能每次运行它都会得到不同的结果。设定种子在开发/评估期间强制执行一致的结果。</li><li id="e398" class="oc od it lk b ll ol lo om lr on lv oo lz op md oh oi oj ok bi translated">您可能还想在try/except块中用<code class="fe no np nq nr b">LanguageDetectException</code>包围<code class="fe no np nq nr b">detect</code>调用，否则您可能会得到一个<a class="ae lh" href="https://github.com/Mimino666/langdetect/issues/44" rel="noopener ugc nofollow" target="_blank">“文本中没有特性”错误</a>，当给定输入的语言不能被评估时，例如当它包含URL、数字、公式等字符串时，就会出现这个错误。</li></ol><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="b48f" class="nw mf it nr b gy nx ny l nz oa">from langdetect import DetectorFactory, detect<br/>from langdetect.lang_detect_exception import LangDetectException</span><span id="4b63" class="nw mf it nr b gy ob ny l nz oa">DetectorFactory.seed = 0</span><span id="56a2" class="nw mf it nr b gy ob ny l nz oa">def is_english(text):<br/>    try:<br/>        if detect(text) != "en":<br/>            return False<br/>    except LangDetectException:<br/>        return False<br/>    return True</span></pre><h1 id="56a3" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">2)空间语言检测器</h1><div class="mw mx gp gr my mz"><a href="https://spacy.io/universe/project/spacy-langdetect" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd jd gy z fp ne fr fs nf fu fw jc bi translated">空间探测空间宇宙</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">一个完全可定制的语言检测管道，用于空间安装</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">空间. io</p></div></div><div class="ni l"><div class="oq l nk nl nm ni nn lb mz"/></div></div></a></div><p id="0509" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您使用spaCy来满足您的NLP需求，您可以向您现有的spaCy管道添加一个定制的语言检测组件，这将使您能够在<code class="fe no np nq nr b">Doc</code>对象上设置一个名为<code class="fe no np nq nr b">.language</code>的扩展属性。然后可以通过<code class="fe no np nq nr b">Doc._.language</code>访问该属性，它将返回预测的语言及其概率。</p><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="3262" class="nw mf it nr b gy nx ny l nz oa">import spacy<br/>from spacy_langdetect import LanguageDetector</span><span id="e6b0" class="nw mf it nr b gy ob ny l nz oa">text2 = 'In 1793, Alexander Hamilton recruited Webster to move to New York City and become an editor for a Federalist Party newspaper.'</span><span id="6110" class="nw mf it nr b gy ob ny l nz oa">nlp = spacy.load('en_core_web_sm')<br/>nlp.add_pipe(LanguageDetector(), name='language_detector', last=True)</span><span id="0d56" class="nw mf it nr b gy ob ny l nz oa">doc = nlp(text)<br/>doc._.language  # {'language': 'en', 'score': 0.9999978351575265}</span></pre><h1 id="a1c9" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">3) langid</h1><p id="54ef" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">langid特别吹嘘它的速度(下面会详细介绍)。它的工作方式类似于上面的工具，但是它还可以通过运行<code class="fe no np nq nr b">python langid.py</code>作为命令行工具使用。查看他们的回购协议，了解更多细节和其他选择。</p><div class="mw mx gp gr my mz"><a href="https://github.com/saffsd/langid.py" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd jd gy z fp ne fr fs nf fu fw jc bi translated">saffsd/langid.py</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">py是一个独立的语言识别(langid)工具。设计原则如下:快速预训练…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">github.com</p></div></div><div class="ni l"><div class="ow l nk nl nm ni nn lb mz"/></div></div></a></div><p id="ffbb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要将langid用作Python库，请使用<code class="fe no np nq nr b">classify</code>函数:</p><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="38bc" class="nw mf it nr b gy nx ny l nz oa">import langid</span><span id="9c2a" class="nw mf it nr b gy ob ny l nz oa">langid.classify(text2)  # ('en', -127.75649309158325)</span></pre><p id="2652" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以将最初在对数概率空间中计算的概率预测校准为可以解释为0到1范围内的置信度得分:</p><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="29d4" class="nw mf it nr b gy nx ny l nz oa">from langid.langid import LanguageIdentifier, model</span><span id="fb23" class="nw mf it nr b gy ob ny l nz oa">lang_identifier = LanguageIdentifier.from_modelstring(model, norm_probs=True)<br/>lang_identifier.classify(text2) # ('en', 0.999999999999998)</span></pre><h1 id="8558" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">4)快速文本</h1><p id="1f1a" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">fasttext指出，其预训练的语言识别模型占用的内存不到1MB，但每秒钟能够分类数千份文件。</p><p id="1c57" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下载您选择的型号:</p><ul class=""><li id="c3de" class="oc od it lk b ll lm lo lp lr oe lv of lz og md ox oi oj ok bi translated"><a class="ae lh" href="https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.bin" rel="noopener ugc nofollow" target="_blank"> lid.176.bin </a>:速度更快，精度略高(文件大小=126MB)。</li><li id="3299" class="oc od it lk b ll ol lo om lr on lv oo lz op md ox oi oj ok bi translated"><a class="ae lh" href="https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.ftz" rel="noopener ugc nofollow" target="_blank"> lid.176.ftz </a>:模型的压缩版本(文件大小=917kB)。</li></ul><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="ff2c" class="nw mf it nr b gy nx ny l nz oa">import fasttext<br/><br/>path_to_pretrained_model = '/tmp/lid.176.bin'<br/>fmodel = fasttext.load_model(path_to_pretrained_model)<br/>fmodel.predict([text2])  # ([['__label__en']], [array([0.9331119], dtype=float32)]</span></pre><h1 id="6832" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">速度🚅</h1><p id="fbe5" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">如果您计划在生产中使用需要语言识别的应用程序，速度可能是一个重要的考虑因素。下面是上述四种工具的快速基准测试。</p><p id="8399" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我从Kaggle下载了一个包含10，502条推文的数据集，这些推文是从来自130个不同国家的公开发布的带地理标记的Twitter消息中随机抽取的。除了其他特征之外，它们还被标注为英语或非英语。</p><p id="ded5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据来源:<a class="ae lh" href="https://www.kaggle.com/rtatman/the-umass-global-english-on-twitter-dataset" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/rtatman/the-umass-global-English-on-Twitter-dataset</a>。</p><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="f5fb" class="nw mf it nr b gy nx ny l nz oa">import pandas as pd</span><span id="64bd" class="nw mf it nr b gy ob ny l nz oa">df = pd.read_csv('all_annotated.tsv', sep='\t')</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/252b3cac74cecf1fb5bb8d2e28ca7178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2G2H_FtdkJXtpR-_lAbL_w.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Kaggle数据集前六行</p></figure><p id="0f6a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">速度测试的结果！</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/142b47fe90bf242555d3698fcc4eb3a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlV94gjDIpvYJqScMzjIAQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">速度测试结果</p></figure><p id="8fa5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">fasttext只用了129毫秒就对10，000多个数据点进行了预测。兰吉德名列第二，其他竞争者慢了许多数量级。</p><h1 id="6de3" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">准确(性)🔬</h1><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="4282" class="nw mf it nr b gy nx ny l nz oa">from sklearn.metrics import accuracy_score</span><span id="c746" class="nw mf it nr b gy ob ny l nz oa">ytrue = df['Definitely English'].to_list()<br/>tweets = df['Tweet'].to_list()</span><span id="9d4a" class="nw mf it nr b gy ob ny l nz oa"># get the predictions of each detector</span><span id="145c" class="nw mf it nr b gy ob ny l nz oa">langdetect_preds = [lang_detect(t) for t in tweets]<br/>spacy_preds = [nlp(t)._.language['language'] for t in tweets]<br/>langid_preds = [lang_identifier.classify(text)[0] for t in tweets]<br/>fasttext_preds = [p[0].replace('__label__', '') for p in fmodel.predict(tweets)[0]]</span><span id="27d2" class="nw mf it nr b gy ob ny l nz oa"># binarize the labels</span><span id="e670" class="nw mf it nr b gy ob ny l nz oa">langdetect_preds_binary = [1 if p == 'en' else 0 for p in langdetect_preds]<br/>spacy_preds_binary = [1 if p == 'en' else 0 for p in spacy_preds]<br/>langid_preds_binary = [1 if p == 'en' else 0 for p in langid_preds]<br/>fasttext_preds_binary = [1 if p == 'en' else 0 for p in fasttext_preds]</span><span id="e74e" class="nw mf it nr b gy ob ny l nz oa"># evaluate accuracy against the true labels (1 for English, 0 otherwise)</span><span id="7953" class="nw mf it nr b gy ob ny l nz oa">accuracy_score(ytrue, langdetect_preds_binary)  # 0.8448866882498571 <br/>accuracy_score(ytrue, spacy_preds_binary)  # 0.8448866882498571<br/>accuracy_score(ytrue, langid_preds_binary)  # 0.8268901161683488<br/>accuracy_score(ytrue, fasttext_preds_binary)  #<strong class="nr jd"> 0.8598362216720624</strong></span></pre><p id="0e79" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">fasttext的准确率最高，其次是langdetect和spacy-langdetect。直觉告诉我spacy-langdetect只是引擎盖下的langdetect。；)(它们有完全相同的准确率……这也解释了相似的库名。)</p><p id="84fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了更好地衡量，这里是每个模型的精确度、召回率和f1值。</p><pre class="ks kt ku kv gt ns nr nt nu aw nv bi"><span id="d6bb" class="nw mf it nr b gy nx ny l nz oa">from sklearn.metrics import classification_report</span><span id="f465" class="nw mf it nr b gy ob ny l nz oa">print(classification_report(ytrue, langdetect_preds_binary))<br/>print(classification_report(ytrue, spacy_preds_binary))<br/>print(classification_report(ytrue, langid_preds_binary))<br/>print(classification_report(ytrue, fasttext_preds_binary))</span><span id="4d66" class="nw mf it nr b gy ob ny l nz oa"># langdetect<br/>              precision    recall  f1-score   support<br/><br/>           0       0.80      0.94      0.86      5416<br/>           1       0.92      0.75      0.82      5086<br/><br/>    accuracy                           0.84     10502<br/>   macro avg       0.86      0.84      0.84     10502<br/>weighted avg       0.86      0.84      0.84     10502</span><span id="9f28" class="nw mf it nr b gy ob ny l nz oa"># spacy-langdetect<br/>              precision    recall  f1-score   support<br/><br/>           0       0.80      0.94      0.86      5416<br/>           1       0.92      0.75      0.82      5086<br/><br/>    accuracy                           0.84     10502<br/>   macro avg       0.86      0.84      0.84     10502<br/>weighted avg       0.86      0.84      0.84     10502<br/></span><span id="4762" class="nw mf it nr b gy ob ny l nz oa"># langid<br/>              precision    recall  f1-score   support<br/><br/>           0       0.79      0.90      0.84      5416<br/>           1       0.88      0.74      0.81      5086<br/><br/>    accuracy                           0.83     10502<br/>   macro avg       0.83      0.82      0.82     10502<br/>weighted avg       0.83      0.83      0.83     10502</span><span id="cdde" class="nw mf it nr b gy ob ny l nz oa"># fasttext<br/>              precision    recall  f1-score   support<br/><br/>           0       0.91      0.80      0.86      5416<br/>           1       0.82      0.92      0.86      5086<br/><br/>    accuracy                           0.86     10502<br/>   macro avg       0.86      0.86      0.86     10502<br/>weighted avg       0.87      0.86      0.86     10502</span></pre><h1 id="c98d" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">外卖食品</h1><p id="9a1d" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">如果你要处理一个非常大的数据集，我会选择fasttext。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pa"><img src="../Images/4b734e79ed2a457b32f4c1a898fdb26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7T47jGZTFFTtTBhU6ZvGuA.png"/></div></div></figure></div></div>    
</body>
</html>