<html>
<head>
<title>Visualizing Houston violent crime trends via data collection and cleaning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过数据收集和清理可视化休斯顿暴力犯罪趋势</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-houston-violent-crime-trends-via-data-collection-and-cleaning-64592a8bac25?source=collection_archive---------43-----------------------#2020-09-18">https://towardsdatascience.com/visualizing-houston-violent-crime-trends-via-data-collection-and-cleaning-64592a8bac25?source=collection_archive---------43-----------------------#2020-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0245b2629bc4a872845b47e3bde3e55c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fT4lm0bemfZeMtU88rr-ow.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">黄昏时分的休斯顿市区。<a class="ae kf" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>供图。</p></figure><p id="6609" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">暴力犯罪是表明社会疾病的症状之一。这在很大程度上是因为一个社会及其政府未能提供人类繁荣所必需的要素:食物、住所、教育、职业培训和获得身心保健。与此同时，犯下滔天罪行和轻微罪行的人都具备这些基本条件。在本文中，我将使用暴力犯罪统计的例子来说明Python中的基本数据科学方法。特别是，我将关注我的家乡德克萨斯州休斯顿的暴力犯罪数据。</p><p id="873a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文的目标是展示</p><ol class=""><li id="035f" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><strong class="ki iu">数据采集</strong>:网页抓取将文件下载到本地目录</li><li id="111d" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="ki iu">数据清洗</strong>:仅提取并存储所需值</li><li id="57ea" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="ki iu">数据可视化</strong>:绘制数据揭示趋势</li></ol><p id="82f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ls">免责声明</em>:我不会逐行检查执行上述三个步骤所需的代码。我希望代码块的截图能够帮助您理解:(1)如何对数据文件执行web抓取(2)读取Excel文件并将其转换为Pandas dataframes (3)在Pandas中执行标准的数据清理操作(4)使用matplotlib库绘制Pandas dataframes中存储的数据。</p><h1 id="8b6f" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">一、利用网页抓取和浏览器自动化进行数据收集</strong></h1><p id="07f4" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">首先，我们去休斯顿警察局犯罪统计<a class="ae kf" href="https://www.houstontx.gov/police/cs/crime-stats-archives.htm" rel="noopener ugc nofollow" target="_blank">网页</a>。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/426bd8da36bbf3f0213b69531a2915fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6v8jdamj_OSIhyDyC65FvA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">休斯顿警察局2009年至2018年每月犯罪统计网页。</p></figure><p id="dca1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每月犯罪统计数据有Access和Excel两种格式。我将使用Excel文件。当您单击Excel链接时，包含该月统计数据的Excel文件会下载到您的本地计算机上。下面是2009年6月数据的前几列的示例。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/2b0cf31af2b09555d4b56f1c84fcee00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fK90OJS4WTRA4wXpzQ-J_g.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">2009年6月休斯顿犯罪数据</p></figure><p id="9bd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在继续讨论数据科学之前，让我们花一点时间来思考上述每一个事件所带来的痛苦，再花一点时间来思考无数未报告的此类事件。</p><p id="edb6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，有些行的日期不在2009年6月。这可能是由于以前的事故在以后的日期得到报告。我们必须在数据清理和处理步骤中处理这些情况。为了开始收集数据，我们注意到所有的Excel链接都有URL，当被访问时会启动相关文件的下载。所以首先我们需要收集上面网页上所有的Excel链接网址。我们将使用<strong class="ki iu">请求</strong>和<strong class="ki iu"> bs4 </strong>(也称为BeautifulSoup)库来完成这项工作。使用以下函数可以获得Excel链接。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/7801691d0d4a0e561a254ce763dbc3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gqmIjfMni4Z1Ma2a-irbg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">功能，以刮除每月犯罪统计网页上的Excel文件的所有网址</p></figure><p id="e06e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数将两个URL作为输入:一个<strong class="ki iu">主页URL </strong>和一个<strong class="ki iu">基本URL </strong>。因为这两个URL是固定的，所以可以在名为<strong class="ki iu"> config.py </strong>的配置文件中定义它们。以下是它们的定义:</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/a716546426c3a617de8615e6e90b9c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ey-t9LLvbJsvE1G8VE9sFg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">网页抓取步骤的固定网址</p></figure><p id="9d0a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了链接，我们需要编写浏览器自动化代码来访问它们，并将它们下载到我们选择的目录中。这个特殊数据集的一个障碍是文件名和扩展名是两种不同的格式。此外，包括字符串<strong class="ki iu">NIBRS _ Public _ Data _ Group _ A&amp;B</strong>在内的较长文件名的文件具有更复杂的结构，并且在使用<strong class="ki iu"> Pandas </strong>库导入时会产生官样文章。由于这些文件仅包含数据集中114个月中的最后6个月，我们现在将忽略这些文件。为了适当地忽略它们，我们将它们保存在一个名为<strong class="ki iu">凌乱</strong>的子目录中。这里有一个从URL链接下载文件到本地目录的功能</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/7bf82b6b61807881ebdb9d90299f9a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60zPlXbSS2o1reLQRNCzkQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">从HPD罪案统计网页下载Excel文件的功能</p></figure><p id="6500" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其中<strong class="ki iu"> data_dir </strong>是下载目录的路径，字典m_dict用于在3个字符的字母和2个字符的数字字符串之间进行转换，表示由</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/52d64fb2dc74c39290d4bbad724d5bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KF5dHN35Nva1KCXU3voRxA.png"/></div></div></figure><p id="afc0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">忽略<strong class="ki iu">乱七八糟的</strong>文件，其他都是格式<strong class="ki iu"> mm-yyyy.xlsx </strong>。我想把它们改成格式<strong class="ki iu"> yyyy-mm.xlsx </strong>，这样文件系统在按字母数字排序时会按时间顺序列出它们。下面的函数将完成这个任务</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/4a58a61a460980d8b5c1834d554312ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NUZZDc2PYj0L--FtJ3p-Zg.png"/></div></div></figure><p id="f637" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，非混乱文件按时间顺序列出，混乱文件存储在子目录中。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/d94de757e2e29c85a2ee5790ffe988b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eJyxubkTdnwKaoKY1SEREA.png"/></div></div></figure><p id="259b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据收集步骤现在已经完成。为了组织代码，我将上面显示的所有函数放入一个名为<strong class="ki iu"> helper_funcs.py </strong>的文件中，并导入了<strong class="ki iu">请求</strong>、<strong class="ki iu">操作系统</strong>和<strong class="ki iu"> bs4 </strong>库。然后，我创建了另一个名为<strong class="ki iu"> data_collection.py </strong>的文件来处理这个数据收集步骤。下面的屏幕截图提供了该文件的全部内容</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/8ecf302e7a0ce553f5748df942d06fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKNJYI3vxlT6fJLe27ak5A.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">网页抓取和文件重命名的完整代码(又名数据收集)</p></figure><h1 id="0e01" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">二。用熊猫清理数据</h1><p id="2299" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">现在我们准备清理数据并提取信息的子集。我们希望使用<strong class="ki iu"> read_excel </strong>函数将单个电子表格导入到Pandas数据框中。当我直接尝试这样做时，我遇到了以下文件重要子集的错误:</p><p id="c065" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">警告***文件大小(3085901)不是512 +扇区大小的倍数(512) <br/>警告*** OLE2不一致:SSCS大小为0，但SSAT大小为非零</p><p id="cb18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了绕过这些错误，我在这里找到了下面的hack <a class="ae kf" href="https://github.com/pandas-dev/pandas/issues/16620" rel="noopener ugc nofollow" target="_blank">，它需要导入<strong class="ki iu"> xlrd </strong>库。</a></p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b622e35c60426e88ddde804ae52c5645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*A1qwRyJQAaxwdk1QxjNUgQ.png"/></div></figure><p id="5e3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们将电子表格转换成Pandas数据框架，我们需要删除所有无关信息的列。在这种情况下，我们只对发生日期、犯罪类型和犯罪次数感兴趣。我们还将只记录暴力犯罪，因此将删除与非暴力事件相关的行。被认为是暴力和非暴力的犯罪列举如下</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/c5c2c319a1df63aadd6f23d67f4c2b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*AKQxk5U4F15uzQhrgAVinA.png"/></div></figure><p id="5193" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们稍后会把“严重人身攻击”改名为“人身攻击”。以下是数据集(2009年前后)开头的许多文件共有的所有列名的列表</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/4b5135cf00e9d4dbe8aa43fc94097f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*8SGpvkqKUeifTpdmTM3ewA.png"/></div></figure><p id="a648" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们感兴趣的列子集是['日期'，'犯罪类型'，'犯罪数量']。为简单起见，我们将把“冒犯类型”列重命名为“冒犯”，将“冒犯数量”重命名为“#”。然而，在浏览数据时，我注意到并非所有最后一栏都标有“犯罪数量”。事实上，以下是本专栏所有备选名称的详尽列表:</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/8984499285dbfbace67a5b1959a1dcca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*McYmRPsyfRRbs5IPz5ZUPQ.png"/></div></figure><p id="9be2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了处理这些不规则性，我们将查找上述项目的任何出现，并将它们重命名为' # '。这个问题正在处理，我们现在可以删除无关的列。以2009年6月的数据为例，下面是熊猫数据框架的打印结果，其中删除了一些列</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/275b321c613e4636f6a005edc0a7b128.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*7VpWiMAPPJfW5_zahY8AtA.png"/></div></div></figure><p id="83bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下函数将从Excel文件中创建一个Pandas数据框，并生成一个三列数据框作为输出，如上图所示</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/49daadd8b56e36560e00354157ee811a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SsmzMT9rDNDJECdH8hkV9g.png"/></div></div></figure><p id="dd88" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意<em class="ls"> inplace=True </em>参数的用法。这在将数据帧传递给函数时是必要的，因为它告诉Pandas更新原始数据帧，而不是创建一个副本并保持原始数据帧不变。最后一行是行条目重命名，而不是删除列。</p><p id="5044" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据清理操作中剩下的两个步骤是:(1)删除无关的行，以及(2)合计给定月份中发生的所有违规行为。为了删除无关的行，我们使用下面的代码删除与非暴力犯罪相关的行和包含空条目的行</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/baad1eba965922de8fa8bf49184a845a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iArWYYej3GK1B3tB_iLQgQ.png"/></div></div></figure><p id="664f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们需要合计每个月的暴力犯罪。在此之前，有几件事需要做。</p><p id="841f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，对于一些数据文件，与进攻类型相关的字符串包含额外的空格，需要清理。下面的代码将完成这个任务。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/45228c32f232ec462453b601b7a553ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7fWt_wpf4WB2IIjINyOUA.png"/></div></div></figure><p id="b152" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二，我想重新格式化事件日期的存储方式，因为我不想在演示如何将数据分成多列的同时使用Pandas的时间戳对象。下面的代码有两个函数:第一个函数将日期转换成数字格式，而第二个函数将数字信息拆分成年份和月份列。第二个函数也会删除缺少日期值的行。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/6343d77cd95f2a41a1e581a6d8a06311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMiBzdrO1d4tYhNRQdTNRg.png"/></div></div></figure><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/56fc82cc71a1130725d8d36cea17cac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OfUHDlkaz2hZf5jReTwKcQ.png"/></div></div></figure><p id="fb46" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据清理操作的最后一步涉及总结给定类型的所有违例，并将它们存储在输出数据帧中。下面的函数<strong class="ki iu"> append_monthly_sum </strong>实现了这一点:</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/4be3952e86002da6a7b65937d45a4bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*8FOZrbx4yKSDNXSym02UWg.png"/></div></figure><p id="405d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将所有这些放在一起，我们创建一个名为<strong class="ki iu"> data_collection.py </strong>的文件来执行上述步骤。首先，我们导入库和函数，然后创建一个空的Pandas数据框架，并遍历目录中的所有数据文件</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/5164a893f0815e6ab6dce9dd6c0634e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJXpme4l6pkU8vv5pZYv-w.png"/></div></div></figure><p id="e7d8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在循环内部，对于目录中的每个文件(对应于当月发生的犯罪统计数据)，我们调用上面定义的函数</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/8fb798f17f69815021258ee2410deaff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfg7DGWuypp_0gCBLtZetA.png"/></div></div></figure><p id="d786" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦所有月份都被添加到输出数据帧中，我们就可以使用<strong class="ki iu"> to_pickle </strong>命令将数据帧导出到pickle文件中。我们现在已经成功清理了数据。</p><h1 id="1598" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">三。使用<em class="nt"> matplotlib </em>进行数据可视化</h1><p id="0b73" class="pw-post-body-paragraph kg kh it ki b kj mr kl km kn ms kp kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">清理完数据后，让我们绘制九年数据期内每月报告的暴力犯罪事件，以直观地捕捉时间序列动态。我们将使用<a class="ae kf" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> matplotlib </strong> </a>库绘制数据。当然，还有更好的开源绘图库。特别是，我发现<a class="ae kf" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"/></a>库有更广泛的功能，更简单的语法和更漂亮的自然外观。但是，在写的时候，我用的是matplotlib。</p><p id="ed46" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在进入这个数据可视化步骤的最终代码版本之前，让我们先来看一下每月攻击数据的图表。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/47ff605c12e0810f4e049c407c8244a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*2JfcAYhboMdLAYE1KEpNnw.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">从2009年6月到2018年5月德克萨斯州休斯顿每月报告的攻击次数</p></figure><p id="160a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，每个月的数据都有很大的波动。使用移动平均线来消除这些波动会更容易确定数据的总体趋势。为了查看原始数据和平滑趋势，我绘制了月度数据和移动平均值。</p><p id="3252" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是计算一个名为<strong class="ki iu"> data </strong>的数组的移动平均值的函数，该数组带有大小为<strong class="ki iu"> w_size </strong>的<strong class="ki iu"> n </strong> _ <strong class="ki iu"> w </strong>个窗口。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/85ecfd6fd044bf7c057dbe41d8b27a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*MCCABSJqqM1ih0FBWFp22w.png"/></div></figure><p id="40e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是针对给定犯罪类型绘制月度和移动平均数据的函数:</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/795d9c6d75ddd416723c51cbea5493c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SVBll7-L3gOrsLi_xK4GWA.png"/></div></div></figure><p id="0f81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将所有内容放在一个名为<strong class="ki iu"> data_visualization.py </strong>的文件中，该文件简单地循环所有暴力犯罪类型并应用该函数。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/4004664954c06b21ff16b4458277e58d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*QWNG_F8vlnCQvr35ZgqdRA.png"/></div></figure><p id="536f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在名为<a class="ae kf" href="https://www.photopea.com/" rel="noopener ugc nofollow" target="_blank"> Photopea、</a>的免费在线照片编辑器中稍加欺骗，插入一个图例，这里是每种暴力犯罪类型的最终情节。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/ed7d3901945296a8d29198e8034277b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*fDhV4J9-c0VfWJwnXjQuag.png"/></div></figure><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/33d5c2389810fd0ba9cebc6092d6d03d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*uajaTSp4HkJNJK5TRqBiSQ.png"/></div></figure><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/c5868e449197e9593fe955c22d0cb24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*W6k7aRN987sZzebPIAvkvA.png"/></div></figure><figure class="mx my mz na gt ju gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/ee0e4971ec67e2871812e0d6ed2cbc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*JhcNAHovmigpXtqKYSweBA.png"/></div></figure><p id="e354" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据可视化的全部目的是获得关于整个时间序列数据集的直觉。事实上，上面的图表有助于我们确定每种犯罪类型发生的总体趋势。以上情节讲述的故事是:</p><p id="b50e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(1) <strong class="ki iu">袭击事件</strong>在2009年6月后的80个月开始的快速增长期之前，下降了最初水平的三分之一。</p><p id="c5aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谋杀案在整个九年期间大致保持不变。然而，前60个月有所下降，随后又有所上升。</p><p id="04d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在前70个月里，强奸案基本保持不变。之后，每月的事件数量急剧增加，到2018年5月，几乎是初始值的两倍。<em class="ls">这一趋势令人担忧，需要调查其根源</em>。</p><p id="54fb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在最初的两年里，的抢劫案几乎减少了一半。随后，它们反弹，并以略低于最初月值的价格稳定下来。</p></div></div>    
</body>
</html>