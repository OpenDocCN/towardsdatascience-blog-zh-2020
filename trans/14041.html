<html>
<head>
<title>5 Most Useful Window Functions In SQL You Should Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你应该知道的SQL中最有用的5个窗口函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-most-useful-window-functions-in-sql-you-should-know-35ea50ecd49e?source=collection_archive---------31-----------------------#2020-09-27">https://towardsdatascience.com/5-most-useful-window-functions-in-sql-you-should-know-35ea50ecd49e?source=collection_archive---------31-----------------------#2020-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9dcc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的SQL技能更上一层楼</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/991075910b1e8a8e930a42f9a62a5b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TW7q-Y97pR5esuaMysQmyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/window?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@fabrizioverrecchia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fabrizio Verrecchia </a>拍摄的照片</p></figure><h1 id="3452" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="a4af" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/sql-window-analytic-functions-explained-in-4-minutes-6171c6983263">在我的上一篇文章</a>中，我解释了什么是<strong class="lt iu"> SQL窗口函数</strong>以及如何使用它们。在这篇文章中，我将分享我认为最有用的5个窗口(分析)功能。</p><p id="346d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您在工作中与数据打交道，我强烈建议您尝试理解这些(即数据分析师、产品分析师、数据科学家、数据工程师等)。它们肯定会派上用场的！</p><p id="d750" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">说到这里，让我们开始吧。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="d79d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了帮助您理解这5个窗口功能是如何工作的，我将使用下表作为示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/3a0c1494f767fab9bd5e005a997fb520.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*PLcgH-rvofaGiHsafgr2zg.png"/></div></div></figure><h1 id="0ec4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">1.行号</h1><p id="b250" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">它有什么作用？<br/> </strong> ROW_NUMBER简单地返回每一行的编号，第一条记录从1开始。</p><p id="43b3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">什么时候有用？<br/> </strong>当你想得到一个特定表格的第一条或最后一条记录时，行号是非常有用的。例如，如果您有一个客户购买的表，并且您想获得每个客户的第一次购买，您可以按客户(姓名/id)进行分区，并按购买日期进行排序。然后，您可以筛选行数= 1的表。</p><p id="f95f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">示例:<br/> </strong>使用我上面的示例，假设我想对每一行应用一个行号，按性别并从最高GPA到最低GPA进行拆分。然后，我可以执行以下查询来获得以下结果:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="feee" class="nf la it nb b gy ng nh l ni nj">SELECT *,<br/>    ROW_NUMBER() OVER (PARTITION BY Gender ORDER BY GPA DESC) as rn<br/>FROM <br/>    students</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/18dbd4c50cbda2a11a03146a6fa44525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*7Z-_WyjkavGgPrnpJACb_g.png"/></div></figure><p id="0c61" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，因为按GPA desc排序，GPA最高的女性和男性的行号为1。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="f549" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">2.总和/计数</h1><p id="ba9a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">它有什么作用？<br/> </strong> SUM()和COUNT()是聚合函数，它们或者对列中的值求和，或者对列中非空的值进行计数。</p><p id="c820" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">什么时候有用？<br/> </strong>通过在窗口函数中使用SUM()或COUNT()，可以计算累计总和或累计计数。如果您想要创建显示特定指标(即订单数量、收入等)随时间增长的图表，这将非常有用。</p><p id="d89b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">虽然这个例子不一定公正，但它会让你了解它是如何工作的。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="5672" class="nf la it nb b gy ng nh l ni nj">SELECT *,<br/>    SUM(GPA) OVER (PARTITION BY Gender ORDER BY GPA DESC) as GPA_sum<br/>FROM <br/>    students</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/183694e900a7e8a41911a1a5fc03f517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*ozrDbeS60E7WpchNItXfkA.png"/></div></figure><p id="8027" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意GPA_sum列是如何计算累积GPA的(给定行的GPA加上之前所有行的GPA)。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="c3af" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">3.最小/最大</h1><p id="43c6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">它是做什么的？<br/> 就像在聚合函数中使用MIN()/MAX()一样，你也可以在窗口函数中使用它。</p><p id="a793" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">什么时候有用？<br/> </strong>如果你想比较每一行的最高/最低值，最小/最大是有用的。</p><p id="76ad" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">例子:<br/> </strong>在下面的例子中，我们可以用这个来比较每个学生的GPA与每个性别的最高GPA。您可以更进一步，创建一个新列来计算两者之间的差异。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8de7" class="nf la it nb b gy ng nh l ni nj">SELECT *,<br/>    MAX(GPA) OVER (PARTITION BY Gender ORDER BY GPA DESC) as Max_GPA</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ed7e197eb11015ed1006a7d59f703e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*R2EGsYlKcmFKmPNK100s9w.png"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="141d" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">4.滞后/领先</h1><p id="5c88" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">它是做什么的？/什么时候有用？<br/> </strong> LEAD()和LAG()在想要比较前几行或后几行的值时很有用。</p><p id="28d0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">示例:<br/> </strong>假设我想比较每个学生的平均绩点与下一个学生的平均绩点，后者刚好低于他/她的平均绩点。我可以使用LAG()函数来实现这一点。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ca50" class="nf la it nb b gy ng nh l ni nj">SELECT *,<br/>    LEAD(GPA) OVER (ORDER BY GPA ASC) as Lower_GPA<br/>FROM<br/>    students</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/1e7abfebf6aa0b48ed3b362f918cda3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*99Y7FAEV_5XSb1OGNkwPeg.png"/></div></figure><p id="3df3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，第一行是空的，因为它没有可以引用的前一行。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="421e" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">5.稠密秩</h1><p id="61be" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">它有什么作用？<br/> </strong> DENSE_RANK类似于ROW_NUMBER，只是对相等的值返回相同的秩(NUMBER)。</p><p id="a3b5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">什么时候有用？当您想要根据一个或多个特定变量对数据进行排序时，DENSE_RANK非常有用。</strong></p><p id="a3db" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">例如:<br/> </strong>如果我们想将学生的GPA从最低到最高排序，我们可以使用下面的代码来实现。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="af28" class="nf la it nb b gy ng nh l ni nj">SELECT *,<br/>    DENSE_RANK() OVER(ORDER BY GPA ASC) as Dense_rank</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/94ada000f134be20959d66d5f39b1c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*DzHE44sOG2fXjW6vzsjKXA.png"/></div></figure><p id="5f7d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，Martin和Jason有相同的GPA，因此，他们的Dense_rank都等于4。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="47f4" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">感谢阅读！</h1><p id="b009" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通过阅读这篇文章，你不仅应该知道什么是窗口函数，还应该很好地掌握它的通用性和功能性。你可以用更多的方式来使用窗口函数，但是这五个绝对是我职业生涯中最有用的！</p><h2 id="ae95" class="nf la it bd lb nr ns dn lf nt nu dp lj ma nv nw ll me nx ny ln mi nz oa lp ob bi translated">特伦斯·申</h2><ul class=""><li id="0189" class="oc od it lt b lu lv lx ly ma oe me of mi og mm oh oi oj ok bi translated"><em class="ol">查看</em> <a class="ae ky" href="https://docs.google.com/document/d/1UV6pvCi9du37cYAcKNtuj-2rkCfbt7kBJieYhSRuwHw/edit#heading=h.m63uwvt9w358" rel="noopener ugc nofollow" target="_blank"> <em class="ol">我的免费数据科学资源</em> </a> <em class="ol">每周都有新素材！</em></li><li id="dfb6" class="oc od it lt b lu om lx on ma oo me op mi oq mm oh oi oj ok bi translated"><em class="ol">如果你喜欢这个，</em> <a class="ae ky" href="https://medium.com/@terenceshin" rel="noopener"> <em class="ol">在Medium上关注我</em> </a> <em class="ol">了解更多</em></li><li id="fcf4" class="oc od it lt b lu om lx on ma oo me op mi oq mm oh oi oj ok bi translated"><em class="ol">让我们连线上</em><a class="ae ky" href="https://www.linkedin.com/in/terenceshin/" rel="noopener ugc nofollow" target="_blank"><em class="ol">LinkedIn</em></a></li></ul></div></div>    
</body>
</html>