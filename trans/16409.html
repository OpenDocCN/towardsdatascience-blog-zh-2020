<html>
<head>
<title>Add AD authentication to your Dash app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向您的Dash应用程序添加广告身份验证</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-way-to-integrate-dash-with-ldap-4d5d059ee3a6?source=collection_archive---------14-----------------------#2020-11-12">https://towardsdatascience.com/a-simple-way-to-integrate-dash-with-ldap-4d5d059ee3a6?source=collection_archive---------14-----------------------#2020-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e719" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Flask集成Dash和LDAP的一个非常简单的方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2d91e0c400751875ea7aa7d6d78fa764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lR5dPuc5n8lfkTpK"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@danedeaner?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Dane Deaner </a>拍摄的照片</p></figure><p id="df0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在大多数组织中，登录凭证由目录服务(如Active Directory)管理。如果您设法将<a class="ae kv" href="https://pypi.org/project/dash/" rel="noopener ugc nofollow" target="_blank"> Dash </a>与您组织的目录服务相集成，那么用户只需使用他们现有的凭证登录您的Dash应用程序。一种常见的方式是通过<a class="ae kv" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" rel="noopener ugc nofollow" target="_blank"> LDAP </a>(一种用于与Active Directory等目录服务对话的开放协议)和<a class="ae kv" href="https://pypi.org/project/Flask/" rel="noopener ugc nofollow" target="_blank"> Flask </a>(一种轻量级web应用程序框架)。在这篇文章中，我将演示如何用Python中的Dash以最简单的方式集成LDAP和FLASK。</p><h1 id="456d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><p id="0ede" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在进入任何代码之前，您需要已经启动并运行了LDAP。这是一个重要的步骤，超出了本文的范围，本文只关注Python方面的内容。然而，如果你需要广告整合，我假设你在一个有自己IT部门的大公司工作，希望这个部门(1)不是你,( 2)愿意帮助你！</p><p id="4a6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设LDAP已经启动并运行，继续运行以下命令，从<a class="ae kv" href="https://github.com/epetrovski/dash_ldap" rel="noopener ugc nofollow" target="_blank"> GitHub </a>克隆示例代码:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="838e" class="mu lt iq mq b gy mv mw l mx my">git clone https://github.com/epetrovski/dash_ldap</span></pre><p id="9bbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还需要几个库来构建一个Dash应用程序，并让它与LDAP一起工作——总共四个。如果您已经使用了<a class="ae kv" href="https://pypi.org/project/pipenv/" rel="noopener ugc nofollow" target="_blank"> Pipenv </a>，只需在克隆的dash_ldap目录内的终端中运行以下命令，即可获得一个安装了依赖项的完整的工作虚拟环境:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="f8b6" class="mu lt iq mq b gy mv mw l mx my">pipenv sync</span></pre><p id="351e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您不想弄乱Pipenv，只需安装您需要的依赖项:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="aaa2" class="mu lt iq mq b gy mv mw l mx my">pip install dash flask flask-simpleldap gunicorn</span></pre><h1 id="83ea" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">app.py演练</h1><p id="df2c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">你需要的所有代码都在<a class="ae kv" href="https://github.com/epetrovski/dash_ldap/blob/main/app.py" rel="noopener ugc nofollow" target="_blank"> app.py </a>里。让我们一行一行地过一遍。</p><p id="3955" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个技巧是让Dash在一个Flask应用程序中运行，这个应用程序向外界提供Dash应用程序。这是通过在初始化时将Flask对象传递给Dash应用程序的服务器参数来实现的，如下所示:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e9b4" class="mu lt iq mq b gy mv mw l mx my">app = Dash(__name__, server=Flask(__name__))</span></pre><p id="f6e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，为了举例，我们定义一个Dash应用程序。这个应用程序只是一个简单的占位符，但是不要担心，当你用高级回调等构建自己的应用程序时。，它不需要对LDAP集成设置进行任何更改。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="1b33" class="mu lt iq mq b gy mv mw l mx my">app.layout = html.P('Hello world!')</span></pre><p id="c260" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您现在需要通过更新Flask的配置字典来为LDAP配置Flask。下面的详细信息只是一个占位符，因为您的凭据将取决于您公司的LDAP设置—再次询问！</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="cc2d" class="mu lt iq mq b gy mv mw l mx my">app.server.config.update({<br/>   'LDAP_BASE_DN': 'OU=users,dc=example,dc=org',<br/>   'LDAP_USERNAME': 'CN=user,OU=Users,DC=example,DC=org',<br/>   'LDAP_PASSWORD': os.getenv('LDAP_PASSWORD')})</span></pre><p id="a0bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能已经注意到，我冒昧地在<code class="fe mz na nb mq b">LDAP_PASSWORD</code>后面加了一个<code class="fe mz na nb mq b">os.getenv()</code>。我假设你永远不会在代码中存储密码，而是使用类似于<a class="ae kv" href="https://help.ubuntu.com/community/EnvironmentVariables" rel="noopener ugc nofollow" target="_blank">环境变量</a>的东西。</p><p id="c6e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常重要的是，现在我们需要通过用<code class="fe mz na nb mq b">LDAP(app.server).basic_auth_required()</code>包装所有已经用Flask注册的视图函数来保护它们:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="6408" class="mu lt iq mq b gy mv mw l mx my">for view_func in app.server.view_functions:<br/>   app.server.view_functions[view_func] = LDAP(app.server).basic_auth_required(app.server.view_functions[view_func])</span></pre><p id="b9b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们可能需要一种方法来快速运行Flask应用程序以进行测试。通常我们会使用<code class="fe mz na nb mq b">app.run()</code>，但是因为这个应用是在Flask服务器上提供的，所以我们使用<code class="fe mz na nb mq b">app.run_server()</code>:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="5ab6" class="mu lt iq mq b gy mv mw l mx my">if __name__ == '__main__':<br/>   app.run_server()</span></pre><h1 id="2229" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">测试一下</h1><p id="9522" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您可以通过运行以下命令来确认AD集成正在运行:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="566f" class="mu lt iq mq b gy mv mw l mx my">python3 app.py</span></pre><p id="2f46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在导航到<a class="ae kv" href="http://127.0.0.1:8000" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000 </a>，您应该会看到一个登录提示。输入你的身份证明，你应该会看到“你好，世界！”首页。</p><p id="4baa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然您对一切顺利运行感到满意，请记住，使这一切工作的关键部分是<a class="ae kv" href="https://flask-simpleldap.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> flask-simpleldap </a>包。这是一个很棒的Python包，它可以解决一个非常乏味但却至关重要的It需求。</p><h1 id="675b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">投入生产</h1><p id="904a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果您在生产中运行Dash应用程序，您应该在生产级http服务器上运行该应用程序，如<a class="ae kv" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank"> gunicorn </a>。您已经安装了这个，所以只需运行:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e06a" class="mu lt iq mq b gy mv mw l mx my">gunicorn app:server</span></pre><p id="d191" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是因为在<code class="fe mz na nb mq b">app.py</code>中，我定义了:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9286" class="mu lt iq mq b gy mv mw l mx my">server = app.server</span></pre><p id="535d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是你要的，一个登录受保护的Dash应用程序，集成了一个目录服务，适合生产！</p></div></div>    
</body>
</html>