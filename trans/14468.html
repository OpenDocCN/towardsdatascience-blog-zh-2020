<html>
<head>
<title>Histograms with Plotly Express: Complete Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Plotly Express的直方图:完整指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/histograms-with-plotly-express-complete-guide-d483656c5ad7?source=collection_archive---------1-----------------------#2020-10-06">https://towardsdatascience.com/histograms-with-plotly-express-complete-guide-d483656c5ad7?source=collection_archive---------1-----------------------#2020-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b643" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个数据集，60多个图表，以及所有解释的参数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e51003b410d7660d1435298b37556cff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsW7as7G1ffBj5S9dwi04w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">大多数图形都是用canva创建的</p></figure><p id="11ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">直方图是一种特殊的条形图，显示变量的分布。<a class="ae lu" href="https://plotly.com/python/plotly-express/" rel="noopener ugc nofollow" target="_blank"> Plotly。Express </a>允许使用一个函数<code class="fe lv lw lx ly b">px.histogram(df, parameters)</code>从数据集创建几种类型的直方图。在本文中，我想探究所有的参数以及它们如何影响图表的外观和感觉。</p><p id="ffc8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">普洛特利。Express是python <a class="ae lu" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>库的高级API，专门用于处理数据帧。它创建交互式图表，您可以放大和缩小，打开和关闭图形的一部分，当您将鼠标悬停在图上的任何元素上时，会出现一个带有信息的工具提示。</p><p id="b46d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有的图表都可以使用<strong class="la iu">本笔记本上的</strong> <a class="ae lu" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Histogram/Histograms.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> GitHub </strong> </a>来创建。请随意下载、播放和更新它。</p><h2 id="e1cb" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">目录</h2><ul class=""><li id="0c62" class="ms mt it la b lb mu le mv lh mw ll mx lp my lt mz na nb nc bi translated"><a class="ae lu" href="#78e6" rel="noopener ugc nofollow">安装</a></li><li id="8743" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><a class="ae lu" href="#78e6" rel="noopener ugc nofollow">数据集</a> —在示例中使用</li><li id="627a" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><a class="ae lu" href="#05d6" rel="noopener ugc nofollow">直方图的类型</a></li><li id="3932" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><a class="ae lu" href="#c08f" rel="noopener ugc nofollow">直方图使用plotly条形图</a></li><li id="db96" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">参数:c <a class="ae lu" href="#0e45" rel="noopener ugc nofollow"> olor </a>，b <a class="ae lu" href="#6e00" rel="noopener ugc nofollow"> armode </a>，<a class="ae lu" href="#0b51" rel="noopener ugc nofollow"> nbins </a>，<a class="ae lu" href="#00d1" rel="noopener ugc nofollow"> histfunc </a>，c<a class="ae lu" href="#9a88" rel="noopener ugc nofollow">umulatual</a>，<a class="ae lu" href="#06d3" rel="noopener ugc nofollow"> barnorm </a>，<a class="ae lu" href="#9e5e" rel="noopener ugc nofollow"> histnorm </a>，<a class="ae lu" href="#d071" rel="noopener ugc nofollow"> category_orders </a>，<a class="ae lu" href="#6791" rel="noopener ugc nofollow"> range_x and range_y </a>，<a class="ae lu" href="#9567" rel="noopener ugc nofollow">color _ discrete _ sequence</a>，</li></ul><h1 id="78e6" class="ni ma it bd mb nj nk nl me nm nn no mh jz np ka mk kc nq kd mn kf nr kg mq ns bi translated">装置</h1><p id="ce7e" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">普洛特利。Express是在plotly库的4.0.0版本中引入的，您可以使用以下命令轻松安装它:</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="3c18" class="lz ma it ly b gy oa ob l oc od"># pip <br/>pip install plotly</span><span id="81f9" class="lz ma it ly b gy oe ob l oc od"># anaconda<br/>conda install -c anaconda plotly</span></pre><p id="4a9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly Express还要求安装pandas，否则当你尝试导入时会得到这个错误。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="3c00" class="lz ma it ly b gy oa ob l oc od">[In]: import plotly.express as px<br/>[Out]: <strong class="ly iu">ImportError</strong>: Plotly express requires pandas to be installed.</span></pre><p id="ea2d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想在Jupyter笔记本中使用plotly，还有其他要求。对于Jupyter实验室你需要<code class="fe lv lw lx ly b"><a class="ae lu" href="https://plotly.com/python/getting-started/#jupyterlab-support-python-35" rel="noopener ugc nofollow" target="_blank">jupyterlab-plotly</a></code>。在普通笔记本上，我必须安装<code class="fe lv lw lx ly b">nbformat</code> ( <code class="fe lv lw lx ly b">conda install -c anaconda nbformat</code>)</p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/visualization-with-plotly-express-comprehensive-guide-eb5ee4b50b57"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">用Plotly可视化。快递:综合指南</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">一个数据集和70多个图表。交互性和动画通常只需一行代码。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div><h1 id="6cb7" class="ni ma it bd mb nj nk nl me nm nn no mh jz np ka mk kc nq kd mn kf nr kg mq ns bi translated">数据集</h1><p id="d914" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">直方图可在您想要查看分布的任何时候使用:</p><ul class=""><li id="a2ea" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated">一段时间内出现的错误</li><li id="2ed0" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">每个班次的成品</li><li id="2da5" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">统计分布——身高、体重、年龄、价格、工资、速度、时间、温度、周期、差值范围</li></ul><p id="6163" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly的直方图很容易使用，不仅是常规直方图，而且也很容易用于创建一些类型的条形图。您可以通过间隙从条形图中识别直方图，因为直方图的条形之间没有间隙。</p><p id="e50b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将使用我最喜欢的数据集，了解世界各国的游客人数以及他们在假期的花费。数据被预处理成一个长格式——每个类别<code class="fe lv lw lx ly b">Country Name</code>、<code class="fe lv lw lx ly b">Region</code>、<code class="fe lv lw lx ly b">Year</code>是一列，这些类别的每个组合占据一行，显示两个数据值<code class="fe lv lw lx ly b"><a class="ae lu" href="https://data.worldbank.org/indicator/ST.INT.ARVL" rel="noopener ugc nofollow" target="_blank">number of visotors</a></code>和<code class="fe lv lw lx ly b"><a class="ae lu" href="https://data.worldbank.org/indicator/ST.INT.RCPT.CD" rel="noopener ugc nofollow" target="_blank">receipts</a></code>当地人从这些游客那里获得的美元。关于游客的数据从1995年到2018年。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/d48fe4aed3f8ef29a958b6d3b8d05578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*iOu1LvlhlZXChv33p2a44A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预处理数据集的样本-1995年至2018年关于2015个国家的数据</p></figure><p id="9a57" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">普洛特利。如果每个类别和每个值都是数据集的一列，Express可以创造奇迹。在这个例子中，我将使用:</p><ul class=""><li id="885f" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">long_df</code>—95年至2018年215个国家的完整数据集</li><li id="3199" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">yr2018</code>—2018年的数据</li><li id="e738" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">spfrit</code> —关于西班牙、法国和意大利的数据</li></ul><h1 id="05d6" class="ni ma it bd mb nj nk nl me nm nn no mh jz np ka mk kc nq kd mn kf nr kg mq ns bi translated">直方图的类型</h1><p id="70e7" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">最常见的直方图显示一个数字变量的分布，该分布被分成多个区间。在我们的案例中，2018年的访客数量分布在0到89 322 000之间。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="88ca" class="lz ma it ly b gy oa ob l oc od"># import the libraries<br/>import plotly.express as px<br/>import pandas as pd</span><span id="7c36" class="lz ma it ly b gy oe ob l oc od"># create the simples histogram<br/>px.histogram(yr2018, x="visitors")</span></pre><p id="012f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">simples直方图将215个国家分为18个区域，每个区域覆盖500万游客。第一层包括157个国家，游客数量在0-490万之间，第二层包括17个国家，游客数量在500-990万之间，依此类推。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/3f8a819afefb7885a4cfe24ffe036477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBaE_BgINdDJpx1YssCnSA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Simples直方图将国家划分为多个区域</p></figure><p id="e7fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于如何创建条块，您有更多的选择，它们可以基于一个类别(例如，我们的数据框架中的<code class="fe lv lw lx ly b">Region</code>)或一个日期值，该日期值被划分为包含几天、几个月或几年的条块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c97600f5d0d8f2976edc5f3fa2ed3f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieCEaIDCNeLvNURBW4pr9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将x变量指定为数值、分类或日期列会导致不同的箱。在这种情况下，年份可以是数值，生成的bin将是int(1995)到int(1999)或日期1995年1月到1999年1月。</p></figure><p id="42e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能已经注意到，范围直方图和分类直方图显示的是落入分类框的国家的数量，而日期直方图显示的是访问者的数量。您可以使用<code class="fe lv lw lx ly b">y</code> —参数指定将哪一列聚合到直方图中。因为我们的数据集每年包含215个国家，所以对行进行计数会产生一个平坦的直方图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/39b76ffb9ee7c0abb505f873a26e1b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrmIMP-h-vjLunGFOxOY1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Plotly Express直方图中指定Y会改变聚合</p></figure><h1 id="4657" class="ni ma it bd mb nj nk nl me nm nn no mh jz np ka mk kc nq kd mn kf nr kg mq ns bi translated">因素</h1><p id="7995" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">除了<code class="fe lv lw lx ly b">x</code>和<code class="fe lv lw lx ly b">y</code>之外，plotly的直方图还有许多其他参数，这些参数在<a class="ae lu" href="https://plotly.github.io/plotly.py-docs/generated/plotly.express.histogram.html" rel="noopener ugc nofollow" target="_blank">文档—直方图</a>中有所描述。让我们一个接一个地回顾它们，这样您就可以知道如何将直方图包含到您的下一个可视化中。</p><h2 id="0e45" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数:颜色</h2><p id="4f12" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">像所有其他情节一样。Express chart，<code class="fe lv lw lx ly b">color</code>参数需要一个包含某个类别的列，它将用单独的颜色对属于该类别的值进行着色。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="c592" class="lz ma it ly b gy oa ob l oc od">fig = px.histogram(yr2018, x="visitors", nbins=10, color="Region", title="Visitors per region")<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/f964cb7d4cb30fca1325b1ea6dc47365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vyctLHK8PTjmlN1IdZ3JJw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">定义颜色以指定按颜色分割直方图。</p></figure><h2 id="6e00" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数:Barmode</h2><p id="e90b" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">因为直方图实际上是一个条形图，所以您可以设置三种类型的条形图:</p><ul class=""><li id="73ff" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">stacked</code> —值堆叠在另一个之上</li><li id="82b2" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">grouped</code> —以分组条形图的形式显示直方图</li><li id="3149" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">overlayed</code> —在彼此顶部显示半透明条</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6a9dfed84a7672217af1d43cec3625b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MRocl3LlvchQFJrigTynUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将颜色和条形模式结合起来会产生不同的图表类型。没有按颜色划分组的Barmode结果总是在同一个图表中。</p></figure><p id="8701" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些条必须按颜色分开，这样<code class="fe lv lw lx ly b">barmode</code>才有效果。在上面的例子中，我们看到每年有50万游客参观阿拉比亚，但是土耳其和西班牙占据了更多的位置。</p><p id="0b72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对这些年来这些国家的旅游业如何发展感兴趣，你可以通过改变<code class="fe lv lw lx ly b">x</code>和<code class="fe lv lw lx ly b">y</code>参数来快速实现。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="5c9a" class="lz ma it ly b gy oa ob l oc od">fig = px.histogram(sptuar, <br/>            x="years", <br/>            y="visitors", <br/>            color="Country Name", <br/>            barmode="group",<br/>            title=f"Visitors in Aruba, Spain, Turkey - {barmode}")<br/>fig.update_layout(yaxis_title="Number of Visitors")<br/>fig.update_xaxes(type='category')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d9b01354855c40f5318e97a6b0ddaeda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sqq4mWOObwdX_2K06FQtHQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">普洛特利。Express是非常通用的，通过改变x和y参数可以得到不同的图。</p></figure><p id="b1d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了更改<code class="fe lv lw lx ly b">x</code>和<code class="fe lv lw lx ly b">y</code>之外，我还将图表分配给了一个变量<code class="fe lv lw lx ly b">fig</code>，这允许我们使用<code class="fe lv lw lx ly b">fig.update_layout(yaxis_title="title axis")</code>更新<code class="fe lv lw lx ly b">yaxis</code>，更重要的是，修改年份颜色，使其既不被视为<code class="fe lv lw lx ly b">int</code>也不被视为<code class="fe lv lw lx ly b">date</code>，而是被视为一个类别，这意味着每年都有一个单独的条形<code class="fe lv lw lx ly b">fig.update_xaxes(type="category")</code>。</p><blockquote class="pd pe pf"><p id="9bdd" class="ky kz pg la b lb lc ju ld le lf jx lg ph li lj lk pi lm ln lo pj lq lr ls lt im bi translated">Plotly图表在后台存储为字典，可以通过打印<code class="fe lv lw lx ly b">fig.to_dict()</code>来查看</p></blockquote><h2 id="0b51" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数:nbins</h2><p id="959a" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">如果使用类别，nbins参数将被忽略，并为每个类别绘制一个条形。但是如果你的<code class="fe lv lw lx ly b">x</code>是数字或日期类型，就把你的数据分成<code class="fe lv lw lx ly b">n</code>个区间。文件上说:</p><blockquote class="pd pe pf"><p id="ecae" class="ky kz pg la b lb lc ju ld le lf jx lg ph li lj lk pi lm ln lo pj lq lr ls lt im bi translated"><strong class="la iu">nbins</strong>(<a class="ae lu" href="https://docs.python.org/3/library/functions.html#int" rel="noopener ugc nofollow" target="_blank"><em class="it">int</em></a>)—正整数。设置箱子的数量。</p></blockquote><p id="349b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但实际上，箱的数量通常是不同的。我尝试用不同的<code class="fe lv lw lx ly b">nbins</code>运行我的图表，结果如下:</p><ul class=""><li id="da02" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated">nbins = 3–2箱</li><li id="482f" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">nbins = 5–5个箱</li><li id="a4ef" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">nbins = 10–9个箱子</li><li id="7f4e" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">nbins = 20–18箱</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9a275c53efcdbc6b8af4c1a967154aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4FlHoYTeiSYDOMEp7puVlQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">增加nbins参数会导致更多的箱数</p></figure><p id="3344" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">甚至关于<a class="ae lu" href="https://plotly.com/python/histograms/" rel="noopener ugc nofollow" target="_blank"> plotly直方图</a>的示例页面也有nbins=20，导致只有11个柱。尽管增加数量通常会导致箱的数量增加。Plotly还确定了箱的开始和结束位置。例如，使用宁滨的年份可以从1990、1994或1995年开始。</p><ul class=""><li id="7a93" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated">nbins = 3–3个箱(1990–1999，2000–2009，2010–2019)</li><li id="e984" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">nbins = 5–5个箱(95–99，00–04，05–09，10–14，15–19)</li><li id="3e19" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">nbins = 10–5个箱(95–99，00–04，05–09，10–14，15–19)</li><li id="2b81" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated">nbins = 20–13个箱(94–95，96–97，98–99，00–01…)</li></ul><blockquote class="pd pe pf"><p id="07c0" class="ky kz pg la b lb lc ju ld le lf jx lg ph li lj lk pi lm ln lo pj lq lr ls lt im bi translated">你影响箱子的数量和范围的能力有限，但是很快就会进化，所以这很可能会在未来的版本中得到改进。</p></blockquote><p id="f665" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要获得所有的能量，自己计算，然后用<a class="ae lu" href="#c08f" rel="noopener ugc nofollow"> plotly express条形图</a>绘制，如本文末尾所示。</p><h2 id="00d1" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数:histfunc</h2><p id="6fd1" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">到目前为止，我们已经看到直方图计数和求和的价值。Plotly的直方图允许使用5个函数来聚合值— <code class="fe lv lw lx ly b">count</code>、<code class="fe lv lw lx ly b">sum</code>、<code class="fe lv lw lx ly b">avg</code>、<code class="fe lv lw lx ly b">min</code>、<code class="fe lv lw lx ly b">max</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0cb8c284c02ede42f9044c1f625f3267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sbkf6bNoSvbktTqW6vsgzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly历史函数的各种参数。</p></figure><p id="a56b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，当我们使用分级箱时，avg产生箱的平均值，min产生最小值，max产生最大值，所以<code class="fe lv lw lx ly b">avg</code>、<code class="fe lv lw lx ly b">min</code>和<code class="fe lv lw lx ly b">max</code>总是形成某种上升的阶梯。在这种情况下，对分类值应用直方图更有意思，这在技术上创建了一个条形图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/beca4b9ddbe7a2141d9c52a9881236ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EN29oaf7ZZ4qpt_T0QMowA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将histfunc应用于分类箱显示，尽管我们在拉丁美洲、非洲、欧洲和东亚有类似数量的国家，但欧洲国家总体上是最多人访问的，而北美国家是平均水平。游客数量最多的非洲国家不超过1200万。</p></figure><h2 id="9a88" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数:累积</h2><p id="92d8" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">如果累积参数设置为<code class="fe lv lw lx ly b">False</code>，直方图会显示频率(sum，avg …)，但如果是<code class="fe lv lw lx ly b">True</code>，则每个后续柱会累积所有先前柱的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/94804b9d1077323e18e83a0cc8af931b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtNO22d3cSUo4LL0MeuU4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">累积直方图累积所有先前条形图的值。</p></figure><h2 id="06d3" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数:barnorm</h2><p id="c4e0" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">如果<code class="fe lv lw lx ly b">barnorm</code>为<code class="fe lv lw lx ly b">None</code>，该参数允许显示精确值，或者显示每个颜色类别的百分比。您可以通过将<code class="fe lv lw lx ly b">barnorm</code>设置为<code class="fe lv lw lx ly b">fraction</code>或<code class="fe lv lw lx ly b">percent</code>来实现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fe07604d7a92569ad0163b9849ed1cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dE8EoGznKfIr78XCwhK3Fw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Barnorm表示堆积直方图上的零、分数或百分比。</p></figure><p id="0608" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右边的最后一幅图像被<code class="fe lv lw lx ly b">fig.update_layout(yaxis={"ticksuffix":"%"})</code>修改，添加了一个百分号。</p><p id="6337" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果在分组图表上应用barnorm，比例保持不变，但绝对值变为分数或百分比:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d23dfa05bdf87b4403fd0bbf39fbfbf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7jheYUv1Psw4yQrts6ssQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">组合直方图保留条形的比例，但轴标签会改变。</p></figure><p id="a175" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe lv lw lx ly b">fig.update_layout(yaxis={"tickfont":{"size":18}})</code>对<code class="fe lv lw lx ly b">xaxis</code>进行格式化，使标签更大。</p><h2 id="9e5e" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数历史标准</h2><p id="4ac5" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">一个条柱的<code class="fe lv lw lx ly b">barnorm</code>百分比总和等于100%,而所有相同颜色的条柱相加后<code class="fe lv lw lx ly b">histnorm</code>达到100%。它提供了5个选项:</p><ul class=""><li id="9c50" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">None</code> —显示骨料的绝对值</li><li id="9ada" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">percent</code> —占箱中总值的百分比(0–100%)</li><li id="e236" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">probability</code> —容器中总量的分数(0–1)</li><li id="fbe7" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">density</code> —总面积除以总面积(所有条形面积之和等于样本点总数)</li><li id="68bf" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">probability density</code>—<code class="fe lv lw lx ly b">histfunc</code>对给定条柱的输出进行归一化，使其对应于随机事件落入该条柱的概率，该随机事件的分布由<code class="fe lv lw lx ly b">histfunc</code>的输出描述(所有条柱面积之和等于1)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7e9c6af2620d4fcb3f67f3224f2986a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vx0s1IMX7tlo8uripTMrYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">histnorm的前三个参数。</p></figure><p id="fc1a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我已经从几个角度研究了<code class="fe lv lw lx ly b">density</code>和<code class="fe lv lw lx ly b">probability density</code>，但是可能会有一个bug，因为每个bin的累积图和普通图的值是不同的。</p><h2 id="d071" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数类别_订单</h2><p id="7944" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">当你用<code class="fe lv lw lx ly b">color</code>划分图表时，你可能会对定义这些彩色类别的顺序感兴趣。默认情况下，顺序基于输入数据帧中的外观，这可能很难控制。使用<code class="fe lv lw lx ly b">category_order</code>让你对图上的类别进行排序。</p><p id="aa8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您必须指定为哪一列定义顺序(作为字典)。这是您在<code class="fe lv lw lx ly b">color</code>参数中使用的列。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="f82f" class="lz ma it ly b gy oa ob l oc od">fig = px.histogram(spfrit, <br/>      x="years",<br/>      y="visitors",<br/>      <strong class="ly iu">color="Country Name",</strong><br/>      barmode="group",<br/>      title=f"Ordered Italy, Spain, France",<br/>      category_orders={"<strong class="ly iu">Country Name</strong>":["Italy","Spain","France"]}<br/>      )<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7272c40e9328961f207db9a8978b041c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JQQIoPSHQcQcIvzqaRjaYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly表示直方图参数，允许改变类别的顺序</p></figure><h2 id="6791" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数range_x和range_y</h2><p id="48b2" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">这两个参数不会改变图表的范围，但它们会根据设定的边界放大数据。您可以随时使用Plotly的交互式菜单取消缩放。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="86b6" class="lz ma it ly b gy oa ob l oc od">fig = px.histogram(long_df, <br/>                   x="years", <br/>                   y="receipts", <br/>                   range_x=["2009","2018"],<br/>                   title="Yearly Histogram",<br/>                  )<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/cb3c84aacf51c50763297345be18d27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ZMxMJCUvrbXp_nqrFytn_A.gif"/></div></figure><p id="b53a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">放大很多可以看到plotly认为年份是<code class="fe lv lw lx ly b">floats</code>，因为会加上<code class="fe lv lw lx ly b">2016.5</code>这样的标签。如果您想确保Plotly显示的年份始终为<code class="fe lv lw lx ly b">"2016"</code>而不是小数<code class="fe lv lw lx ly b">2016.5</code>或月份<code class="fe lv lw lx ly b">Jan 2016</code>，请使用<code class="fe lv lw lx ly b">fig.update_xaxes(type='category')</code>。这将悬停改变直方图到一个条形图和差距之间的酒吧将出现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/12092733b5362a7a963e15a384b8efa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pbJuPFgMuCZ_o9B5ZIhXoA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数字形式的条柱可能会出现意外的带小数的网格线，而分类直方图会变成带缺口的条形图。</p></figure><h2 id="9567" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数颜色_离散_序列</h2><p id="6c5b" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">color_discrete_sequence参数允许您影响条形的颜色。simples直方图的所有条形都具有相同的颜色，您可以使用以下命令进行更改:</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="ba5a" class="lz ma it ly b gy oa ob l oc od">px.histogram(df, x="column", <br/>    color_discrete_sequence=["blue"])</span></pre><p id="7081" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly期望一个列表作为输入，因此您必须将您的颜色包装到一个列表中<code class="fe lv lw lx ly b">["#00ff00"]</code>。您可以使用任何颜色名称-蓝色、红色、浅灰色，如果您没有猜出正确的名称，plotly的错误将提供可通过名称访问的颜色的完整列表:</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="4956" class="lz ma it ly b gy oa ob l oc od"><strong class="ly iu">ValueError: </strong><br/>    Invalid value of type 'builtins.str' received for the 'color' property of histogram.marker<br/>        Received value: 'lightgreene'<br/><br/>    The 'color' property is a color and may be specified as:<br/>      - A hex string (e.g. '#ff0000')<br/>      - An rgb/rgba string (e.g. 'rgb(255,0,0)')<br/>      - An hsl/hsla string (e.g. 'hsl(0,100%,50%)')<br/>      - An hsv/hsva string (e.g. 'hsv(0,100%,100%)')<br/>      - A named CSS color:<br/><strong class="ly iu">            aliceblue, antiquewhite, aqua, aquamarine, azure,<br/>            beige, bisque, black, blanchedalmond, blue, ...</strong></span></pre><p id="a0ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也可以用hash string或者rgb/rgba，hsl/hsla和hsv/hsva(谷歌这个术语如果他们不对钟的话)。最后一个<code class="fe lv lw lx ly b">a</code>代表<code class="fe lv lw lx ly b">alpha</code>，它控制条的不透明度。</p><p id="1a66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在未使用<code class="fe lv lw lx ly b">color</code>参数的情况下为未分割直方图列出了多种颜色，则仅应用列表中的第一种颜色。当您使用<code class="fe lv lw lx ly b">color</code>分割条形时，您在<code class="fe lv lw lx ly b">color_discrete_sequence</code>中提供的色调将绘制每个类别的条形。您可以使用前面的参数category _ orders来更改顺序或类别。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/134ecc5d15d3ac2af6918083f53c2dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d9MMvNK0yjD_YpW-4tKwmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果您只能选择一个类别，列表中的第一种颜色将用于所有条形图。有多个类别，您可以指定更多的颜色。如果你设置的颜色没有你的类别多，那么第一种颜色将用于那些未指定的类别。</p></figure><p id="45ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你不确定选择哪种颜色，但你想让这些颜色搭配在一起，试试plotly的一些<a class="ae lu" href="https://plotly.com/python/builtin-colorscales/" rel="noopener ugc nofollow" target="_blank">预建颜色集</a>。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="4384" class="lz ma it ly b gy oa ob l oc od">fig = px.histogram(...                      color_discrete_sequence=px.colors.qualitative.Pastel2,<br/>...)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/b1823970ed9ad451d3a214eb88a6a7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lcg24NAxh6XQizM_d0nGHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用定性分析。Pastel2按颜色顺序构建。</p></figure><h2 id="db77" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数颜色_离散_映射</h2><p id="a8c6" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">您也可以使用字典来指定颜色。在这种情况下，您使用参数<code class="fe lv lw lx ly b">color_discrete_map</code>。这个字典的关键字是在<code class="fe lv lw lx ly b">color</code>中指定的列中的值。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="9e97" class="lz ma it ly b gy oa ob l oc od">px.histogram(df, x="column",<br/>color="Country Names",<br/>color_discrete_map={<br/>    "Spain":"lightgreen", <br/>    "France":"rgba(0,0,0,100)", <br/>    "Italy":"#FFFF00"}<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/790f73d90b95a6c2ec3c294aa8f3886f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eb0GCKGoQD06qQQWAveZtg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用颜色_离散_映射设置颜色</p></figure><p id="503c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有一个选项是在数据框中使用包含颜色名称或其哈希代码的列。在你使用<code class="fe lv lw lx ly b">color="column with colors name"</code>和<code class="fe lv lw lx ly b">color_discrete_map="identity"</code>的情况下。这种方法的缺点是会丢失交互式图例，因为它不再包含类别的名称(例如国家名称)，而是包含颜色的名称。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="ce08" class="lz ma it ly b gy oa ob l oc od"># create a color column specifying color for each of the countries</span><span id="bc5b" class="lz ma it ly b gy oe ob l oc od">spfrit["color"] = spfrit["Country Name"].map(<br/>{"Spain":"red", <br/>"France":"black", <br/>"Italy":"orange"}<br/>)</span><span id="fafd" class="lz ma it ly b gy oe ob l oc od"># spfrit now contains: <br/># country_name year visitors <strong class="ly iu">color</strong><br/># Spain        1995 32971000 <strong class="ly iu">red</strong><br/># France       1995 60033000 <strong class="ly iu">black</strong><br/># ...</span><span id="313c" class="lz ma it ly b gy oe ob l oc od">""" Parameter color_discrete_map using identity in case color contains real color names/hex codes """</span><span id="60d1" class="lz ma it ly b gy oe ob l oc od">fig = px.histogram(spfrit, <br/> x="year",<br/> y="visitors",<br/> color="color",<br/> barmode="group",<br/> title=f"Histnorm {histnorm} histogram",<br/> category_orders={"Country Name":["Italy","Spain","France"]},<br/> color_discrete_map="identity"<br/>)<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/91f16af5aa23a9f43fc288cf9e3a8e0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YIrxoY-FKMh8HAy2krS57A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果使用color_discrete_map="identity "，则缺少图例，但是可以使用带有颜色名称的现有列来指定条形的颜色</p></figure><h2 id="f308" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数facet_col和facet_row</h2><p id="d75d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">有时，您更喜欢在列中并排显示类别，或者在行中上下显示类别。<code class="fe lv lw lx ly b">facet_col</code>和<code class="fe lv lw lx ly b">facet_row</code>参数用于此目的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9d05131359912806e3cbdaa6067e22b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_t01V1mou4kVqU856h-5EQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Facet_row和facet_col可以与color参数结合使用，以不同的色调对条形进行着色。</p></figure><p id="55c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常，您可以将<code class="fe lv lw lx ly b">facet_col</code>或<code class="fe lv lw lx ly b">facet_row</code>与一个<code class="fe lv lw lx ly b">color</code>参数结合起来，以区分每一行或每一列中条形的颜色。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="2232" class="lz ma it ly b gy oa ob l oc od">px.histogram(df, <br/>  x="value column",<br/>  color="column",<br/>  facet_col="column")</span></pre><p id="fd3c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您有太多的列，您可以通过参数<code class="fe lv lw lx ly b">facet_col_wrap</code>在每第x列之后拆分它们。以下示例显示了由<code class="fe lv lw lx ly b">facet_col_wrap=3</code>在3列后拆分的9个类别</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="ba79" class="lz ma it ly b gy oa ob l oc od">px.histogram(df, x="value column",<br/>  color="column",<br/>  facet_col="column",<br/>  <!-- -->facet_col_wrap=n<!-- -->)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/5b4e760960b3c6435b9e139bab6da117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*kYptE_3bh2e2nFhmF18_pQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用<code class="fe lv lw lx ly b">facet_col_wrap=3</code>将9个不同的类别分成3行</p></figure><blockquote class="pd pe pf"><p id="b012" class="ky kz pg la b lb lc ju ld le lf jx lg ph li lj lk pi lm ln lo pj lq lr ls lt im bi translated">所有的图都是相连的，因此当您放大或平移其中一个图时，所有其他的图也会发生变化。</p></blockquote><p id="25c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">行没有facet_row_wrap参数，但是您可以通过<code class="fe lv lw lx ly b">facet_row_spacing</code>调整行之间的间距。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="cc4e" class="lz ma it ly b gy oa ob l oc od">px.histogram(df, x="value column",<br/>  color="column",<br/>  facet_row="column",<br/>  <!-- -->facet_row_spacing=0.2<!-- -->)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/00541635287ef8cc5dfb642933b39991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*-Bezf0bhTNZ2Ux0eXeIz5Q.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Facet_row_spacing在各行之间创建一个间隙。当您放大一行时，所有其他行也会放大。</p></figure><h2 id="d978" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数hover_name和hover_data</h2><p id="1cb2" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">Hover_name和hover_data影响工具提示的外观。<code class="fe lv lw lx ly b">hover_name</code>高亮显示工具提示顶部的列，使用<code class="fe lv lw lx ly b">hover_data</code>可以在工具提示中删除或添加列</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="819e" class="lz ma it ly b gy oa ob l oc od">hover_data={<br/># to remove<br/>"Column Name 1":False, </span><span id="5c5f" class="lz ma it ly b gy oe ob l oc od"># to add<br/>"Column Name 2":True<br/>}</span></pre><p id="bca9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些参数在plotly中总是工作得很好，但是在直方图的情况下有一些bug，并且<code class="fe lv lw lx ly b">hover_name</code>根本不工作，而<code class="fe lv lw lx ly b">hover_data</code>只是有时工作。</p><h2 id="8656" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数定向</h2><p id="6a59" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">直方图可以水平或垂直定向。<code class="fe lv lw lx ly b">Orientation</code>参数有两个值<code class="fe lv lw lx ly b">v</code>和<code class="fe lv lw lx ly b">h</code>，但是方向受<code class="fe lv lw lx ly b">x</code>和<code class="fe lv lw lx ly b">y</code>的影响较大。切换<code class="fe lv lw lx ly b">x</code>和<code class="fe lv lw lx ly b">y</code>的顺序，可以垂直旋转水平图表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f1914a212b62a79370188288236b1fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTRJhCgXBCaV5INyPtqaxA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">垂直或水平条受x和y参数影响，而不是受方向参数影响。</p></figure><p id="5dbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您需要颠倒轴的顺序，以便最小的数字框位于顶部而不是底部，请使用:</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="8d32" class="lz ma it ly b gy oa ob l oc od">fig.update_yaxes(autorange="reversed")</span></pre><p id="72ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这同样适用于同时指定<code class="fe lv lw lx ly b">x</code>和<code class="fe lv lw lx ly b">y</code>的情况。通过切换它们，你可以将水平图变成垂直图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d97c93d7857df1a3dcc90b853d8bfd65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lHlrfNZgpQ4Bbo4MDkp7lw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将x =“years”改为y =“years”会改变方向。</p></figure><p id="b986" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上图中，你可以看到悬停显示所有类别的工具提示。因为我点击了Plotly菜单中的<code class="fe lv lw lx ly b">Compare data on hover</code>图标(右数第二个)。</p><h2 id="032e" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数<strong class="ak">边际</strong></h2><p id="d470" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">我想向您展示的一个有趣的参数是，可以选择添加一个边缘子图来显示变量的详细分布。您可以从4种边际地块中进行选择:</p><ul class=""><li id="c604" class="ms mt it la b lb lc le lf lh ox ll oy lp oz lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">histogram</code> —与其下方的直方图基本相同</li><li id="2fa8" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">rug</code> —显示每个数据值在</li><li id="aedc" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">violin</code> —做小提琴图，估计变量的概率密度</li><li id="02f8" class="ms mt it la b lb nd le ne lh nf ll ng lp nh lt mz na nb nc bi translated"><code class="fe lv lw lx ly b">box</code> —突出显示中间值、第一个和第三个四分位数的箱形图</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9d1cdc6ba9fde7f8cdb0ecf68fef29ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDi1XJaDmFjvEw2-j3Kkfw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">4种边际参数——直方图、地毯、小提琴和盒子。这些图出现在垂直直方图的上方，也是交互式的。</p></figure><p id="40b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">甚至可以为多个类别绘制边际图。在这种情况下，将计算一个单独的边际图。注意，在这种情况下，你不能使用<code class="fe lv lw lx ly b">barmode="group"</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9c1e65be300245cb939957825530f725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-A4eFFf3gv9IIVq4N4emBw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多类别情况下四种类型的纵横军图</p></figure><h2 id="b4fd" class="lz ma it bd mb mc md dn me mf mg dp mh lh mi mj mk ll ml mm mn lp mo mp mq mr bi translated">参数动画_帧</h2><p id="881a" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">我们今天要讨论的最后一个参数是Plotly的另一个交互特性，它可以让您制作图表动画。添加单个参数<code class="fe lv lw lx ly b">animation_frame="years"</code>会将绘图变成动画，可通过<code class="fe lv lw lx ly b">play</code>和<code class="fe lv lw lx ly b">stop</code>按钮启动，或者您可以通过点击菜单导航至单独的幻灯片。</p><p id="c5e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常需要指定动画图表的范围，以避免网格尺寸的变化。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="fbfd" class="lz ma it ly b gy oa ob l oc od">px.histogram(spfrit, <br/>    y="Country Name", <br/>    x="visitors",<br/>    color="Country Name", <br/>    barmode="group", <br/>    # add the animation<br/>    animation_frame="years",<br/>    # anchor the ranges so that the chart doesn't change frame to frame  <br/>       <br/>    range_x=[0,spfrit["visitors"].max()*1.1]<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/84f31657cd8aef727ea746ab0262efa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*JXMOWLeoczIQgzIRvRMKFg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动画帧允许您设置值的进度动画</p></figure><p id="d6e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它也可以用于分类列。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="61e3" class="lz ma it ly b gy oa ob l oc od">px.histogram(long_df, <br/>    x="years",<br/>    y="visitors",<br/>    color="Region",<br/>    animation_frame="Region",<br/>    color_discrete_sequence=px.colors.qualitative.Safe,<br/>    range_y=[0,long_df.groupby(["Region","years"])["visitors"].sum().max()*1.1]<br/>            )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/c0e876d54f042661841727bb546d683a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*dkA3IKBZOwgX10ZMRB3arg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用分类列的动画可能不如动画有用，但是滑块可以帮助用户查看各种选项。</p></figure><h1 id="c08f" class="ni ma it bd mb nj nk nl me nm nn no mh jz np ka mk kc nq kd mn kf nr kg mq ns bi translated">使用plotly条形图的直方图</h1><p id="70e9" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">如你所见，当我们讨论<code class="fe lv lw lx ly b">nbins</code>参数时，Plotly对宁滨数据很固执。如果你想保持你的自由，你总是可以自己收集数据并绘制一个规则的条形图。使用<code class="fe lv lw lx ly b">pd.cut</code>对数据进行分类，<code class="fe lv lw lx ly b">groupby</code>对分类中的值进行聚合，并将结果传递给<code class="fe lv lw lx ly b">px.bar(df, parameter)</code>可以让您获得自己的直方图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="po pp l"/></div></figure><p id="6a33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这样你有更多的选择。您可以在x轴<code class="fe lv lw lx ly b">(5, 10]</code>上显示箱，或者当您使用<code class="fe lv lw lx ly b">pd.cut(df, bins=bins, labels=bins[1:])</code>装箱时，您可以只显示边界编号<code class="fe lv lw lx ly b">10M, 20M etc.</code>。您可以在条形中或条形上方添加标签，以显示每个条形包含的出现次数。使用<code class="fe lv lw lx ly b">fig.update_layout(bargap=0)</code>可以调整杆之间的间隙</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4404a4fdb4e6d32268d4aae7fded889f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VAryN4NtbTvrfk6sseQzOQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用pd.cut计算直方图，并通过px.bar绘制</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/aff55951d8b1ac1f1a00f697ebf587cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxVle1lPyNS6bIHvMcbBBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多个类别，当按媒体夹和类别分组时</p></figure><p id="1ce6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者，您可以通过numpy的<code class="fe lv lw lx ly b">np.histogram</code>来绑定数据。</p><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="a38b" class="lz ma it ly b gy oa ob l oc od"># bin with np.histogram<br/>counts, bins = np.histogram(yr2018["visitors"], bins=bins)</span><span id="3cd1" class="lz ma it ly b gy oe ob l oc od"># turn into data frame<br/>df = pd.DataFrame({"bins":bins[1:], "counts":counts})</span><span id="6021" class="lz ma it ly b gy oe ob l oc od"># chart using Plotly.Express<br/>fig = px.bar(df, x="bins", y="counts", text="counts")</span></pre><h1 id="bd94" class="ni ma it bd mb nj nk nl me nm nn no mh jz np ka mk kc nq kd mn kf nr kg mq ns bi translated">结论</h1><p id="7b63" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">Plotly的直方图是描绘数据变量分布的一种快速方法。Plotly Express直方图也有助于绘制多种条形图，将数据按类别或时间进行汇总。</p><p id="6ced" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，到目前为止，plotly直方图缺少一些功能(其他Plotly图表也有)，尤其是添加标签的选项。箱不容易修改，并且<code class="fe lv lw lx ly b">nbins</code>参数并不总是提供预期的结果。您可以随时自己进行计算，并使用<code class="fe lv lw lx ly b">px.bar()</code>得出结果。</p><p id="b207" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly正在定期改进，所以也许这些东西会很快更新，我们可能会选择添加一个估计分布曲线覆盖。</p><p id="ce7c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在轮到你研究直方图了。下载一个数据集，例如，世界各地<a class="ae lu" href="https://www.kaggle.com/sudalairajkumar/daily-temperature-of-major-cities?select=city_temperature.csv" rel="noopener ugc nofollow" target="_blank">城市</a>的历史温度，并研究各个地区的温度分布。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/7a85622cfa055f45334874c05a2d9694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hImhmvcBicT762vfL3Ui8Q.png"/></div></div></figure><pre class="kj kk kl km gt nw ly nx ny aw nz bi"><span id="6e1b" class="lz ma it ly b gy oa ob l oc od">If you liked this article, check other guidelines:<br/>* <a class="ae lu" rel="noopener" target="_blank" href="/visualize-error-log-with-pandas-and-plotly-d7796a629eaa">Visualize error log with Plotly</a><br/>* <a class="ae lu" rel="noopener" target="_blank" href="/complete-guide-to-pythons-cross-validation-with-examples-a9676b5cac12">How to split data into test and train set</a><br/>* <a class="ae lu" rel="noopener" target="_blank" href="/stop-persisting-pandas-data-frames-in-csvs-f369a6440af5">Various pandas persistance methods</a><br/>* <a class="ae lu" rel="noopener" target="_blank" href="/unzip-update-and-zip-again-xmls-in-a-folder-7d57f9710ddb">Unzip all archives in a folder</a></span><span id="fada" class="lz ma it ly b gy oe ob l oc od">Many graphics on this page were created using <a class="ae lu" href="https://partner.canva.com/vdek" rel="noopener ugc nofollow" target="_blank">canva.com</a> (affiliate link, when you click on it and purchase a product, you won't pay more, but I can receive a small reward; you can always write canva.com to your browser to avoid this). Canva offer some free templates and graphics too.</span></pre><p id="299e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有的图表都可以通过这个笔记本中的python脚本运行Github上的<a class="ae lu" href="https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Vizualizations/Plotly/Histogram/Histograms.ipynb" rel="noopener ugc nofollow" target="_blank">直方图与Plotly </a>。</p></div></div>    
</body>
</html>