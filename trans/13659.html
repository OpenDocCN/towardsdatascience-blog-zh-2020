<html>
<head>
<title>Using Machine Learning to Convert Your Image to Vaporwave or Other Artistic Styles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习将您的图像转换为Vaporwave或其他艺术风格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-machine-learning-to-convert-your-image-to-vaporwave-or-other-artistic-styles-df6fb9aa60e0?source=collection_archive---------27-----------------------#2020-09-19">https://towardsdatascience.com/using-machine-learning-to-convert-your-image-to-vaporwave-or-other-artistic-styles-df6fb9aa60e0?source=collection_archive---------27-----------------------#2020-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b4b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">TL；DR: </strong>这篇文章介绍了一种流行的机器学习算法的机制，这种算法被称为神经风格转移(NST)，它能够将你选择的任何图像转换为你最喜欢的艺术风格。该算法是著名的卷积神经网络的直接应用，并且巧妙地将问题框架化为对两个损失项的优化。凭借其简洁的公式，该算法提供了一种简单的方法来实现一个有趣的图像转换器(想想DeepArt或Prisma)。深度学习中的任何主题都是巨大的，本文仅简要介绍NST算法。虽然它的续集将处理算法的实现怪癖和一些其他有趣的应用，但现在让我们获得算法背后的一些直觉，并享受玩它的乐趣。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e0dbf9d5c5d2bcbbc1637d5fe7184fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vJr6pw78IA_G_G_f"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@yuhao?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">庞</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="9126" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">问题设置</h1><p id="772e" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">我们的目标很明确:让一个图像S采用另一个图像t的风格。在这一点上，这个目标可能听起来有点高，你可能会有一些合理的问题，例如我们如何在神经网络中表示一个图像，以及我们如何量化风格，这些将在下面的部分中得到适当的回答。</p><h2 id="33e9" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">数字表示</h2><p id="b0b6" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">简单来说，一幅图像被表示为一个张量，可以认为是一个矩阵的推广。例如，大小为512*512的彩色图像将被表示为大小为512*512*3的张量(3-D矩阵),数字3来自于任何颜色都可以被编码为R-G-B值的元组的事实，每个值的范围从0到255。这个矩阵将在以后用作算法的输入。</p><h2 id="a3f9" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">卷积神经网络基础</h2><p id="d4ec" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">由于该算法建立在卷积神经网络(CNN)架构上，因此事先澄清一些关于它的观点是有帮助的。</p><p id="a376" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CNN中与我们的任务相关的两个最重要的构件是卷积层和池层。我们首先来看看卷积层的内部工作原理。</p><p id="526b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么我们如何从输入层到第一个卷积层呢？让我们看看下图:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/bfa213c53f73198e3d6db3a70a91c424.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*7DnWefDbNhXjucUO9ciZ_g.png"/></div></figure><p id="92d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上图中，位于左上角的大小为3*3*3的子矩阵(为便于说明，此处仅显示了两个维度)将通过一个相同大小的滤波器，该滤波器通过对子矩阵应用卷积运算来转换子矩阵，其结果成为卷积层左上角神经元的激活。</p><p id="571b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是什么是过滤器呢？现在你可以把它理解为一种识别描述图像的某些特征的方法:直角、曲率、纹理等。它通过将自身与输入子矩阵进行卷积来实现这一点。要获得更全面的治疗，请遵循维基百科页面中的提示。</p><p id="a383" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将过滤器向右滑动一个像素，我们得到以下结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/31c95abf416dfcef0bc763be11750cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*vSGHOO8iOkqXOHzcuumbpg.png"/></div></figure><p id="ad05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该滤波器将应用于每个3*3*3子矩阵，我们将有我们的第一个完整的卷积层。</p><p id="2a65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以检查一下，如果我们对上述大小为6*6*3的输入矩阵使用大小为3*3*3的滤波器，那么得到的卷积层大小将为4*4*1。然而，一般来说，滤波器的数量大于1，这意味着我们可能要应用几个不同的滤波器，以便将输入矩阵转换为第一个卷积层。想象一下，我们将从4个不同的过滤器得到的大小为4*4*1的矩阵堆叠在彼此的顶部；我们将最终得到一个大小为4*4*4的卷积层，它又会成为下一层的输入，无论是另一个卷积层还是池化层。<strong class="js iu">注意，在计算机视觉行话中，每个大小为4*4*1的滤波器输出可以称为一个特征图；因此，这里我们有4个特征地图。</strong></p><p id="9808" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">池层的机制可以理解为降维。在下图中，池层的作用是将下一层中任何大小为2*2的子矩阵减少到1*1。进行这种下采样的流行方法包括取最大值或平均值。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/7c9d39e1c0f9629402e83688b98ac4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*anMGkrugBur4AAC2gcqXQw.png"/></div></figure><p id="927d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一般来说，CNN的架构将包括卷积层和池层的交替。典型架构的示例如下:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/3e6edacce9c4bb1ad9f0d72bb49d2d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*U6_b8aNUtOgdkRlP3b9Vpg.jpeg"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">VGG19架构，一般用于神经风格转移，此处采用自<a class="ae le" href="https://www.researchgate.net/publication/325137356_Breast_cancer_screening_using_convolutional_neural_network_and_follow-up_digital_mammography" rel="noopener ugc nofollow" target="_blank">的</a></p></figure><h1 id="d3f4" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">神经风格转移(NST)算法</h1><p id="e202" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">清楚了基本原理之后，让我们开始研究算法的细节。</p><p id="1e54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">NST利用了上面说明的VGG19神经网络，不包括右端的三个全连接层，它已经过预训练，可以使用ImageNet数据集执行对象识别。VGG19附带了PyTorch和TensorFlow等流行的深度学习框架，因此您不需要实际自己实现它。</p><p id="8613" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们回顾一下迄今为止我们所掌握的情况。我们有预先训练的VGG19 CNN，一个图像矩阵<em class="mx"> S </em>被转换成图像矩阵<em class="mx"> T </em>的样式，以及在网络的每个中间层的中间图像矩阵<em class="mx">S’</em>(可以将<em class="mx">S’</em>的初始值设置为白噪声，或者简单地设置为<em class="mx"> S </em>)。</p><p id="ef67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是将整个问题公式化为优化任务。NST将其分解为两个损失函数之和的最小化，即内容损失和风格损失。让我们开始吧。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi my"><img src="../Images/ad578faff6597485af73785121e9317a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RvfJ38Uwolh4TzOG"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">乔纳森·福门托在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f5a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">直观上，内容损失量化了我们在某一层的中间图像与内容图像之间的距离。</strong>因此在每一层<em class="mx"> l </em>，我们将<em class="mx">S’</em>的当前状态表示为<em class="mx"> x </em>，将原始图像表示为<em class="mx"> p </em>，并且进一步我们还有<em class="mx"> x </em>的特征图，表示为<em class="mx"> F </em>，以及<em class="mx"> p </em>的特征图，表示为<em class="mx"> P </em>。因此，层<em class="mx"> l </em>处的内容损失简单地为:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/beba04a12415281692d2cfa9cde32fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*G7VZPCIl0TClvk_LPjWZOg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">在层l，我们对F和P之间的平方误差求和，对所有特征图在I上循环，对给定特征图中的所有单元在j上循环</p></figure><p id="71ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了得到总的内容损失，简单地对所有层的项求和。</p><p id="5c58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们来看看风格的丧失。这里，风格可以被宽泛地定义为不同特征地图之间的相关性。对于我们的中间图像<em class="mx"> x </em>，让我们定义<em class="mx"> G </em>:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi na"><img src="../Images/e022201d1aa5400c027b6720e888b3d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/1*n0qrIS8axSOP_vjJaaMDMg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">这一项表示在层l的两个特征图I和j之间的相关性。求和是在所有特征图单元上进行的。</p></figure><p id="95f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">类似地，我们可以为原始内容图像<em class="mx"> p </em>定义一个矩阵<em class="mx"> A </em>。那么我们在层<em class="mx"> l </em>的风格损失可以定义为:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ffd6281dfea18dd020ff36b986a5924e.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*sjpTdtebjvK5j4SQi0X5WQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">n和M表示层l处的特征地图的数量和任何给定特征地图的大小</p></figure><p id="571c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对所有层求和，我们得到总风格损失:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/2577a9bb8ed0a7f471f46707bd6241af.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*nb1jAsfJNNOSqYvK7XG5jA.png"/></div></figure><p id="284f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在实际操作中，上面的权重项w可以设置为所有层都相等:1/(层数)，或者你可以根据<a class="ae le" href="https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf" rel="noopener ugc nofollow" target="_blank">原论文</a>进行更精细的决策。</p><p id="4145" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最终，总损失函数是内容损失和样式损失的加权和:<em class="mx"> </em> <strong class="js iu"> <em class="mx"> a*L(内容)+ b*L(样式)</em> </strong>，使用您最喜欢的优化器在每一层对F(i，j)进行最小化。<strong class="js iu">最终的<em class="mx"> F </em>矩阵将是你的结果图像。</strong></p><h1 id="3b35" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结果</h1><p id="dbd2" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">PyTorch提供了一些神经类型转换的示例代码，非常容易理解和实验。有关实施的更多信息，请参考下面的进一步阅读部分。</p><p id="e5c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">请注意，在将输入图像和样式图像提供给PyTorch实现之前，您需要使它们具有相同的大小。</strong></p><p id="1678" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是有趣的部分:作为乔尔乔·德·契里柯的粉丝，我做了以下实验，试图将他的作品变成类似蒸汽波的风格:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/cbf6f2db1330e7c2f0fff99baf975a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*k9EIuIeeU0sRWZ6EvY5tBQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">左:乔尔乔·德·契里柯。爱情之歌；右图:vaporwave股票图像</p></figure><p id="272c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用左边作为内容输入图像，右边作为样式图像，我们得到如下结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8c1e993f39bd265b9a01e15987315142.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*UzrMqZgxRszy634M36NORw.png"/></div></figure><p id="344f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，德·基里科的另一幅杰作具有与现代插画不同的化学风格:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/e0952ec67ea7850c7af017eaf694089b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*BdIeHeysUdG3i8DZsOLHrQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">左:乔尔乔·德·契里柯。一条街的神秘和忧郁；右:盖娜浩史。<em class="ng">南部高速公路</em></p></figure><p id="c4ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这给出了以下结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/6606f075cf9bc5f7efc5adbf6dc0a62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*l8T1TpRIJRe37oZk2NtFLA.png"/></div></figure><p id="ddc1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请按照下面的指示探索进一步的神经风格转换，并通过将它们转换成一些意想不到的风格来赋予您的照片或图像新的生命。</p><h1 id="3c6d" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">进一步阅读</h1><p id="2130" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><a class="ae le" href="https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf" rel="noopener ugc nofollow" target="_blank"> [1]使用卷积神经网络的图像风格转移</a></p><p id="e0f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[2]<a class="ae le" href="https://paperswithcode.com/paper/a-neural-algorithm-of-artistic-style" rel="noopener ugc nofollow" target="_blank">https://papers with code . com/paper/a-neural-algorithm-of-artistic-style</a></p><p id="b122" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">【3】<a class="ae le" href="https://pytorch.org/tutorials/advanced/neural_style_tutorial.html" rel="noopener ugc nofollow" target="_blank">使用PyTorch的神经转移</a></p></div></div>    
</body>
</html>