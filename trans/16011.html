<html>
<head>
<title>How to add API Keys to Your AWS API Gateway API?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何给你的AWS API网关API添加API键？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-add-api-keys-to-your-aws-api-gateway-api-691bd17c5924?source=collection_archive---------9-----------------------#2020-11-04">https://towardsdatascience.com/how-to-add-api-keys-to-your-aws-api-gateway-api-691bd17c5924?source=collection_archive---------9-----------------------#2020-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="fa28" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="96c4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">向AWS API添加API令牌以进行访问管理</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ef36ad0db79e1b8a4c1bb55ff93c68af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vsGBFEZKHXqdewK7"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">如何给你的AWS API网关API添加API键？由<a class="ae lh" href="https://unsplash.com/@glenncarstenspeters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">格伦·卡斯滕斯-彼得斯</a>在<a class="ae lh" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b680" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我将解释如何向使用AWS API Gateway制作的API添加基本安全级别。这将通过添加令牌来完成。</p><p id="c1dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">令牌是您需要随API请求一起发送的代码，其工作方式或多或少类似于密码。如果您的令牌允许您访问数据，API将向您发送数据。否则它会给你一个错误。</p><p id="9b52" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">按照这个例子，您可以使用在上一篇文章中创建的AWS API Gateway API，它发送回一个随机生成的密码。或者可以直接使用自己的AWS API。</p><p id="8818" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们开始吧:</p><h1 id="2b55" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">步骤1:创建使用计划</h1><p id="26b1" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">转到使用计划选项卡，然后单击创建。这将让你开始建立一个使用计划。</p><p id="6bcc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你必须选择你的客户可以提出多少个请求。对于我的基本计划，我想每月允许100个请求。我允许每秒9个请求。我允许一次最多有100个请求。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nb"><img src="../Images/ba6eb118cfcd2d9a3e04534fd717d37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNbGcxLRASpyrEXB_iLrfg.png"/></div></div></figure><p id="dc41" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，您需要将API及其阶段添加到使用计划中，如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nc"><img src="../Images/866e96826a51ccdc8ebed69f4190739a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cjvrr0jeZrEXNcLvEdWLjg.png"/></div></div></figure><p id="9171" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您有了一个使用计划，它为拥有该使用计划的用户发出的API请求指定了使用限制。为了将此使用计划传递给您的用户/客户，您需要一个与使用计划相关联的API密钥。让我们现在做那件事。</p><h1 id="b8a3" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">步骤2:在AWS API Gateway中设置API密钥</h1><p id="825f" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">点击“将API密钥添加到使用计划”。这将允许您向刚刚创建的使用计划添加API密钥。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nc"><img src="../Images/33baf06ed384c690936e5a6ef5573af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yr5voiUCa3Y-PvwlDN9s6Q.png"/></div></div></figure><p id="d83d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为API键创建名称和描述(可以是任何内容),并让API键自动生成:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/8a37603db1d9805c96876fab124be828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*aWK0562nhIMftZf4xhDSAw.png"/></div></figure><p id="3577" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后点击完成。现在，您拥有了与您的使用计划所指定的访问规则相关联的第一个API键。</p><h1 id="39cb" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">步骤3:不允许在AWS API网关中没有API密钥的访问</h1><p id="85ed" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">现在，我们已经允许使用API密钥进行访问。但是没有API密钥的访问仍然有效！我们必须改变这种状况。</p><p id="e200" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">转到您的API方法:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nc"><img src="../Images/72925ff0cda6bd741f3a43f18a327c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tPpdLg5X72KxbPczD4M0cA.png"/></div></div></figure><p id="0de9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">点击方法请求，进入以下菜单。一条警告信息已经在等着你了:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ne"><img src="../Images/a0ed42af287e8f9bfda616405a5fa0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9-nNe-TkIh6sVJbKGXWbw.png"/></div></div></figure><p id="f53b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您需要将“需要API密钥”更改为“真”，以确保API只接受带有API密钥的请求:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/55b400cc46724fa23e30642b1282fa21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*xwFQAbgx6DSFGyvMzqliOA.png"/></div></figure><h1 id="419e" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">步骤4:部署您的API</h1><p id="d13b" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">现在，要完成API键的添加，您需要部署API以使更改生效。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ng"><img src="../Images/e6392b097558420c67a87e3a7732b437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ln9o5brYYOrmZewqaLI3AQ.png"/></div></div></figure><p id="860c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个小示例中，我们只有一个prod阶段，因此我们可以直接部署到prod:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5c13554e4fa262a18e6b9b7c68893b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*5U1z-4d75tP5SYkOOYXOyg.png"/></div></figure><h1 id="4a48" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">步骤5:测试新的API</h1><p id="ca77" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">现在，当在没有指定API键的情况下测试API时，我们得到了正确的403“禁止访问”响应。可以从笔记本中执行以下Python代码来对此进行测试:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ni"><img src="../Images/2c4cb6db7eca2adf4f61031b0e1e4411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvURzuX_JoCzJ_lJkNVdIA.png"/></div></div></figure><p id="b982" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要找到您的API密钥，请转到API密钥，选择您的customer1 API密钥，然后单击显示。复制并粘贴它，以便测试API:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nj"><img src="../Images/69bd5e114700f59a2b2cc11eb10d6b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJxwl64vwY7Ld7plIvGBsQ.png"/></div></div></figure><p id="3795" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在Python代码中，现在需要在<em class="nk"> x-api-key </em>头中传递API键，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6a1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们所希望的，我们得到了一个生成的密码，但是现在开发者不得不使用API密匙！</p><p id="2ccc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nk">我希望这篇文章对你有用。不要犹豫，继续关注更多！</em></p></div></div>    
</body>
</html>