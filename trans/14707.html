<html>
<head>
<title>vcpkg: C++ Package Manager for Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">vcpkg:用于机器学习的C++包管理器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/vcpkg-c-package-manager-for-machine-learning-16c3b18c1ef2?source=collection_archive---------27-----------------------#2020-10-10">https://towardsdatascience.com/vcpkg-c-package-manager-for-machine-learning-16c3b18c1ef2?source=collection_archive---------27-----------------------#2020-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e972" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用vcpkg安装和使用C++ ML库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e524439a877b82da4ab6bb739dd476c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X3JaI9JpvBuiJsaRvklMEA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用TensorFlow C API的控制台应用程序</p></figure><p id="9aae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Vcpkg是微软提供的一个很棒的C++包管理器。它极大地简化了Windows、Linux和macOS上第三方库的获取和安装。</p><p id="92ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要在您的C++项目中使用它，您首先需要将存储库克隆到您的本地机器上。仓库位于<a class="ae lr" href="https://github.com/microsoft/vcpkg" rel="noopener ugc nofollow" target="_blank">这里</a>。克隆时，选择一个在路径上容易找到的文件夹很重要。类似于<strong class="kx ir"> C:\dev\vcpkg </strong>的东西。在命令提示符下，您可以这样做:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="de14" class="lx ly iq lt b gy lz ma l mb mc">git clone <a class="ae lr" href="https://github.com/microsoft/vcpkg.git" rel="noopener ugc nofollow" target="_blank">https://github.com/microsoft/vcpkg.git</a></span></pre><p id="30c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将存储库克隆到本地文件夹后，转到该文件夹并发出以下命令来构建可执行文件(vcpkg.exe):</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="e2dc" class="lx ly iq lt b gy lz ma l mb mc">.\bootstrap-vcpkg.bat</span></pre><p id="5f86" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在您已经构建了可执行文件，您可以使用它将vcpkg集成到您的构建环境中(如Visual Studio 2019)。从命令行执行以下操作:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ddfc" class="lx ly iq lt b gy lz ma l mb mc">.\vcpkg integrate install</span></pre><p id="b304" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设您想在您的计算机上安装OpenCV4，这样您就可以将它集成到您的C++程序中。你会这样做:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="9bbd" class="lx ly iq lt b gy lz ma l mb mc">.\vcpkg install opencv4 --triplet x64-windows</span></pre><p id="2139" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">三元组描述了您希望为其安装软件包的架构和环境。如果这是您安装的第一个软件包，vcpkg将下载并安装一个兼容的cmake，然后使用它来构建软件包。一旦完成，它将计算出opencv4的所有依赖项，并首先构建它们。最后，它将构建opencv4包并将其存储在包缓存中。一旦你安装了一个包，你就可以在你的c++项目中使用它。</p><h2 id="a71a" class="lx ly iq bd md me mf dn mg mh mi dp mj le mk ml mm li mn mo mp lm mq mr ms mt bi translated">创建自己的包</h2><p id="1841" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">创建自己的包非常简单。我在这里举一个例子，我用TensorFlow团队创建的预打包文件为TensforFlow C API(见https://www.tensorflow.org/install/lang_c<a class="ae lr" href="https://www.tensorflow.org/install/lang_c" rel="noopener ugc nofollow" target="_blank">)创建了一个。在命令提示符下，执行以下操作:</a></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="23fe" class="lx ly iq lt b gy lz ma l mb mc">.\vcpkg create tensorflow-c-gpu https://storage.googleapis.com/tensorflow/libtensorflow/libtensorflow-gpu-windows-x86_64-2.3.0.zip libtensorflow-gpu-windows-x86_64-2.3.0.zip</span></pre><p id="a7ee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里，您已经将您的包命名为<strong class="kx ir"> tensorflow-c-gpu </strong>，并告诉它从哪里下载zip文件，以及您将在本地将其命名为什么。发出这个命令将创建一个cmake文件，用于构建您的包。在我们的示例中，该文件将是<em class="mz">ports \ tensor flow-c-GPU \ tensor flow-c-GPU . cmake</em>。每个包还需要一个名为vcpkg.json的元数据文件。要开始编辑这些文件，您可以从命令提示符发出以下命令:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="bb5b" class="lx ly iq lt b gy lz ma l mb mc">.\vcpkg edit tensorflow-c-gpu</span></pre><p id="0cde" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我们的例子来说,<em class="mz"> vcpkg.json </em>文件应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="dac0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还应该编辑创建的cmake文件，以使用下载的zip文件，并将它放在正确的位置。下面是我的tensorflow-c-gpu.cmake文件的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="64fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从这个文件中可以看出，这个包只支持Windows上的x64版本。但这就是我现在所需要的🙂</p><h2 id="df1f" class="lx ly iq bd md me mf dn mg mh mi dp mj le mk ml mm li mn mo mp lm mq mr ms mt bi translated">使用包</h2><p id="9db4" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">让我们创建一个使用这个包的控制台应用程序。在Visual Studio中创建一个C++控制台应用程序。我把我的叫做<strong class="kx ir"> TfConsole </strong>。我将在本文末尾包含一个源代码链接。</p><p id="d3c2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦你创建了这个应用程序，添加一个名为<strong class="kx ir"> vcpkg.json </strong>的新文件。这将描述应用程序及其所有依赖项:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="46bf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以看到我们已经指定这个项目需要我们之前定义和安装的<strong class="kx ir"> tensorflow-c-gpu </strong>项目。</p><p id="9076" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您需要更改项目的构建属性，以包含此清单文件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/1cac3af5be1d6615e2de84d5e866ab96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PuSoFvWYamPxjtH4ekLGiQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">TfConsole生成属性</p></figure><p id="c8b4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将使用<strong class="kx ir"> Vcpkg清单</strong>选项更改为<strong class="kx ir">是</strong>，如此处所示。</p><p id="e202" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在配置属性中没有看到Vcpkg选项，这意味着您还没有运行前面显示的“integrate install”命令。</p><p id="82a3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还需要添加<strong class="kx ir"> tensorflow.lib </strong>库作为链接器的输入:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/27090328723c71ebae1006d220f67970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sONR6BGK0z4kI9lJX8wk0Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">链接器属性</p></figure><p id="31d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<em class="mz"> main.cpp </em>中，我们将对tensorflow C API进行简单的包含，然后使用它来显示tensorflow版本号:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6e14" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">需要注意的一点是，该包包含TensorFlow 2.3.0的GPU版本，因此您必须在您的机器上安装CUDA 10.1。</p><p id="c545" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果一切顺利，您将在控制台输出中看到版本号。应该是2.3.0。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e524439a877b82da4ab6bb739dd476c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X3JaI9JpvBuiJsaRvklMEA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">控制台应用程序正在运行</p></figure><h2 id="75d3" class="lx ly iq bd md me mf dn mg mh mi dp mj le mk ml mm li mn mo mp lm mq mr ms mt bi translated">结论</h2><p id="4a7a" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">我认为微软的vcpkg管理器是一个很棒的包管理器，越来越多的包被添加到它里面。我还向您展示了如何添加您自己的，一旦您知道自己在做什么，这可能会非常简单。我正计划写一系列关于在Windows环境下生产中使用机器学习模型的文章。它将涵盖一个Windows前端(这将是一个WPF C#桌面应用程序)使用各种不同的后端。其中一个后端将使用tensor flow C API——由于没有相关的文档和很少的使用示例，它被证明是非常核心的！但是它也非常快(它的推理速度比我的Python代码还要快)。</p><p id="52c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">观看此空间…</p><h2 id="2327" class="lx ly iq bd md me mf dn mg mh mi dp mj le mk ml mm li mn mo mp lm mq mr ms mt bi translated">资源</h2><ol class=""><li id="e283" class="nd ne iq kx b ky mu lb mv le nf li ng lm nh lq ni nj nk nl bi translated">https://docs.microsoft.com/en-us/cpp/build/vcpkg?view=vs-2019 </li><li id="9640" class="nd ne iq kx b ky nm lb nn le no li np lm nq lq ni nj nk nl bi translated">VCP kg GitHub:<a class="ae lr" href="https://github.com/Microsoft/vcpkg" rel="noopener ugc nofollow" target="_blank">https://github.com/Microsoft/vcpkg</a></li><li id="a2d9" class="nd ne iq kx b ky nm lb nn le no li np lm nq lq ni nj nk nl bi translated">TF console:<a class="ae lr" href="https://github.com/ianormy/TfConsole" rel="noopener ugc nofollow" target="_blank">https://github.com/ianormy/TfConsole</a></li></ol></div></div>    
</body>
</html>