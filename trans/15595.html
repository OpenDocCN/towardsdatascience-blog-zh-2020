<html>
<head>
<title>Deploy a Machine Learning Model from a Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Jupyter笔记本部署机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-a-machine-learning-model-from-a-jupyter-notebook-9257ae5a5f7c?source=collection_archive---------15-----------------------#2020-10-27">https://towardsdatascience.com/deploy-a-machine-learning-model-from-a-jupyter-notebook-9257ae5a5f7c?source=collection_archive---------15-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="73b5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">部署可以而且应该很容易</h2></div><p id="4099" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">坦率地说，如果你不能从笔记本中获得你的机器学习模型，它可能不会被使用。本文将帮助您尽快创建模型的部署，以便您可以将业务流程注入到模型中。这是一项重要的技能，因为这意味着你不再依赖软件工程师/开发人员来帮助你。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/d36718475ada61f9270add78c1c68d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rXejhcKLorK7JiXnQH-tg.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><a class="ae lr" href="https://unsplash.com/@sctgrhm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae lr" href="https://unsplash.com/s/photos/business?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="1950" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们将使用Watson机器学习和Jupyter笔记本。我假设您已经有了Anaconda或其他可以运行笔记本的环境。以下是我们将遵循的大纲，您可以随意跳过您可能已经完成的步骤:</p><ol class=""><li id="7f54" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la lx ly lz ma bi translated">创建一个IBM云帐户。(~2分钟)</li><li id="2c4b" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">创建Watson机器学习(WML)实例。(~2分钟)</li><li id="df5b" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">获取API密钥。(~1分钟)</li><li id="2c50" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">创建一个可以存储模型的部署空间。(~1分钟)</li><li id="2dbc" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">创建一个机器学习模型。(大约1分钟，除非您正在创建自己的模型)</li><li id="303e" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">部署您的模型。(~4分钟)</li><li id="bd9f" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">尝试发送您部署的模型数据。(~2分钟)</li></ol><h1 id="5867" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">创建IBM云帐户</h1><p id="524e" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">访问IBM Cloud 的<a class="ae lr" href="https://cloud.ibm.com/registration" rel="noopener ugc nofollow" target="_blank">注册页面，并遵循那里的指示。</a></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nd"><img src="../Images/a55cfec2720090deac8578fc4a1339e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SRoMBfZ1p9HECnbG83uiXA.png"/></div></div></figure><h1 id="5329" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">创建沃森机器学习实例</h1><p id="325c" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">登录后，这应该是您看到的屏幕。你可以点击顶部横幅中的目录按钮，滚动直到找到机器学习，或者使用搜索栏来找到它。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ne"><img src="../Images/56efd83f4a595eaa403a8a652bff6d1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJBDIdXq7yzNqidAsK776g.png"/></div></div></figure><p id="37ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选择Watson Machine Learning后，点击右下角的create按钮创建一个免费的Lite实例。一定要记住你选择的地区，对我来说就是达拉斯。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nf"><img src="../Images/d50e760f5b3c11686fbf30b3bcb2b317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tcpl6EAbHai6fedajTt9CQ.png"/></div></div></figure><p id="758e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如上所述，沃森机器学习每月提供20个自由容量单元，在此期间可以对模型进行训练、评估、部署和评分。如果您的预算有限，我建议您在本地环境中培训您的模型，并保存您的容量单位以用于评分。对于不会经常调用的较小型号，这可能就足够了。</p><h1 id="02ea" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">获取API密钥</h1><p id="5a9a" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">要获得密钥，请访问您的IBM Cloud帐户的<a class="ae lr" href="https://cloud.ibm.com/iam/apikeys" rel="noopener ugc nofollow" target="_blank"> API密钥管理页面</a>。然后，您可以单击“Create an IBM Cloud API key”来创建一个新的密钥，并提供密钥名称和描述。我给出了“wml-api-key”作为我的键的名称。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/fffd0ee95253964200721139d8c6b51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dw0NacnrL-Ju0TyYPr_eqw.png"/></div></div></figure><p id="b6ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建API密钥后，将其复制并粘贴到笔记本中，以便我们使用。</p><h1 id="d5fb" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">创建部署空间</h1><p id="fa26" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">部署空间是您可以存储和管理所有已部署模型的地方。我建议为每个业务目的准备一个部署空间。访问您的<a class="ae lr" href="https://dataplatform.cloud.ibm.com/ml-runtime/spaces?context=cpdaas" rel="noopener ugc nofollow" target="_blank">部署空间页面</a>以创建新的部署。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nh"><img src="../Images/99eef8caadb7e20b881ebb5cb7fe1fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQP8XsqeDHdk4tKh8zS-Ag.png"/></div></div></figure><p id="0b55" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从现在开始，我们将在笔记本上写python代码。</p><h1 id="04f0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">创建机器学习模型</h1><p id="a074" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我将保持简单，为虹膜数据集创建一个KNN模型。虽然您应该制作一些与您的业务用例相关的东西，但是这个模型足以演示如何使用WML。如果您没有制作自己的模型，可以复制并粘贴下面的单元格。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="d2f6" class="nn mh iq nj b gy no np l nq nr">import sklearn<br/>from sklearn.datasets import load_iris</span><span id="58e7" class="nn mh iq nj b gy ns np l nq nr">iris = load_iris()<br/>X = iris.data<br/>Y = iris.target<br/>clf = sklearn.neighbors.KNeighborsClassifier()<br/>clf.fit(X, Y)</span></pre><h1 id="ca14" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">部署您的模型</h1><h2 id="df61" class="nn mh iq bd mi nt nu dn mm nv nw dp mq ko nx ny ms ks nz oa mu kw ob oc mw od bi translated">安装Python SDK</h2><p id="85f3" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">您需要安装IBM Watson机器学习python SDK。您可以通过在命令行中运行<code class="fe oe of og nj b">pip install ibm-watson-machine-learning</code>来做到这一点。你也可以像这样在你的笔记本中运行它自己的单元格:<code class="fe oe of og nj b">!pip install ibm-watson-machine-learning</code>。</p><h2 id="36fa" class="nn mh iq bd mi nt nu dn mm nv nw dp mq ko nx ny ms ks nz oa mu kw ob oc mw od bi translated">设置您的客户端</h2><p id="9f69" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">您可以通过导入Watson Machine学习包并提供您的API键和区域来启动您的代码。如果您不知道应该为location提供什么值，您应该使用检查您的实例所在的城市。您通过查阅<a class="ae lr" href="https://cloud.ibm.com/docs/containers?topic=containers-regions-and-zones#zones-mz" rel="noopener ugc nofollow" target="_blank"> locations页面找到那个城市和地区。</a>因为我的实例在达拉斯，所以我为下面的位置变量提供了“美国南部”。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="b2b7" class="nn mh iq nj b gy no np l nq nr">from ibm_watson_machine_learning import APIClient</span><span id="9519" class="nn mh iq nj b gy ns np l nq nr">api_key = "&lt;your-key&gt;"<br/>location = "&lt;your-region&gt;"</span></pre><p id="34e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些可以作为凭证提供。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="e5c5" class="nn mh iq nj b gy no np l nq nr">wml_credentials = {<br/>    "apikey": api_key,<br/>    "url": '<a class="ae lr" rel="noopener ugc nofollow" target="_blank" href="/'">https://'</a> + location + '.ml.cloud.ibm.com'<br/>}</span><span id="37df" class="nn mh iq nj b gy ns np l nq nr">client = APIClient(wml_credentials)</span></pre><h2 id="bde0" class="nn mh iq bd mi nt nu dn mm nv nw dp mq ko nx ny ms ks nz oa mu kw ob oc mw od bi translated">设置您的部署空间</h2><p id="560e" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我们需要获得您的部署空间的ID。您可以通过运行下面的代码来做到这一点。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="d358" class="nn mh iq nj b gy no np l nq nr">client.spaces.list()</span></pre><p id="c402" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从上面的输出中，您将获得您的部署空间的ID。使用下面的代码设置您的APIClient来使用您的部署空间。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="b109" class="nn mh iq nj b gy no np l nq nr">client.set.default_space("&lt;ID&gt;")</span></pre><h2 id="4750" class="nn mh iq bd mi nt nu dn mm nv nw dp mq ko nx ny ms ks nz oa mu kw ob oc mw od bi translated">发布您的模型</h2><p id="483a" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">在我们部署我们的模型之前，我们需要发布它。首先，我们必须决定我们想要使用哪个版本的python，并设置一些元数据。如果你需要弄清楚你使用的是哪个版本的python，运行<code class="fe oe of og nj b">import sys</code>，然后运行<code class="fe oe of og nj b">sys.version</code>。</p><p id="9c08" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还部署了一个基于sklearn的模型，您将需要确定它的版本。你可以运行<code class="fe oe of og nj b">sklearn.__version__</code>来解决这个问题。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="2156" class="nn mh iq nj b gy no np l nq nr">metadata = {<br/>    client.repository.ModelMetaNames.NAME: 'Iris KNN Model',<br/>    client.repository.ModelMetaNames.TYPE: 'scikit-learn_0.22',<br/>    client.repository.ModelMetaNames.SOFTWARE_SPEC_UID: sofware_spec_uid<br/>}</span><span id="c283" class="nn mh iq nj b gy ns np l nq nr">published_model = client.repository.store_model(<br/>    model=clf,<br/>    meta_props=metadata,<br/>    training_data=iris.data,<br/>    training_target=iris.feature_names)</span></pre><p id="57c0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将需要获得您发布的模型的ID。您可以通过运行下面的代码来获得。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="a68c" class="nn mh iq nj b gy no np l nq nr">models_details = client.repository.list_models()</span></pre><h2 id="5baf" class="nn mh iq bd mi nt nu dn mm nv nw dp mq ko nx ny ms ks nz oa mu kw ob oc mw od bi translated">部署您的模型</h2><p id="1262" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">要部署您的模型，请使用上面单元格中您发布的模型的ID，并运行下面的代码。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="2672" class="nn mh iq nj b gy no np l nq nr">metadata = {<br/>    client.deployments.ConfigurationMetaNames.NAME: "Deployment of Iris KNN Model",<br/>    client.deployments.ConfigurationMetaNames.ONLINE: {}<br/>}<br/><br/>created_deployment = client.deployments.create("&lt;your-published-model-id&gt;", meta_props=metadata)</span></pre><h1 id="93d8" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">测试您的部署</h1><p id="e135" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">您的模型现在已经部署，我们现在可以向它发送数据并获得响应。首先，我们需要通过运行下面的代码来获取已部署模型的ID。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="6253" class="nn mh iq nj b gy no np l nq nr">client.deployments.list()</span></pre><p id="de54" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以使用该ID并在列表列表中发送观察结果。</p><pre class="lc ld le lf gt ni nj nk nl aw nm bi"><span id="a5df" class="nn mh iq nj b gy no np l nq nr">scoring_payload = {"input_data": [{"values": [[5.1, 3.5, 1.4, 0.2]]}]}<br/>predictions = client.deployments.score("&lt;your-deployment-id&gt;", scoring_payload)</span></pre><p id="b4d4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在预测变量中，我们现在已经存储了一个类的预测和每个类的概率。</p><h1 id="2c84" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="b32e" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">如果你的作品要产生巨大的影响，它必须出现在某个地方，而不是PowerPoint。对于许多数据科学家来说，笔记本是机器学习模型的主要开发环境，如果您不想将模型及其依赖项打包成可以在您的计算机和生产服务器上运行的东西，那么这是一种方法。除了所有这些复杂性之外，就你必须获得的知识而言，这是最简单的工作流程，以使ML模型在生产中工作，这可能是在你的业务中采用AI的最快方式。</p></div></div>    
</body>
</html>