<html>
<head>
<title>YOLOv4 — Ten Tactics to Build a Better Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">YOLOv4 —打造更好模型的十大策略</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/yolov4-ten-tactics-to-build-a-better-model-4c46869626a6?source=collection_archive---------15-----------------------#2020-11-13">https://towardsdatascience.com/yolov4-ten-tactics-to-build-a-better-model-4c46869626a6?source=collection_archive---------15-----------------------#2020-11-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="084c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用这些建议改善你的YOLOv4训练流程——请注意:我们也在我们的博客上发布了<a class="ae kf" href="https://blog.roboflow.com/yolov4-tactics/" rel="noopener ugc nofollow" target="_blank"> YOLOv4战术</a>。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/f58abf5e1e83c990f35d65d1650d3e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUMRFH7B9_ztFGwcd1BOWg.jpeg"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">(<a class="ae kf" href="https://unsplash.com/photos/_rw79d4UgSw" rel="noopener ugc nofollow" target="_blank">引用</a></p></figure><p id="1ed8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">YOLO v4模型是目前用于训练定制对象检测器的最佳架构之一，并且暗网库的能力是巨大的。在本帖中，我们讨论并实现了YOLO v4中的十个高级策略，这样你就可以从你的自定义数据集构建最佳的对象检测模型。</p><p id="d9bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:此讨论假设您已经培训过YOLO v4。首先，查看我们的<a class="ae kf" href="https://blog.roboflow.com/training-yolov4-on-a-custom-dataset/" rel="noopener ugc nofollow" target="_blank">培训指南YOLOv4 </a>。这里的高级战术将建立在基础训练流程的基础上。</p><p id="33a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">YOLO v4高级战术路线图:</p><ul class=""><li id="877b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">收集更多数据</li><li id="a7a4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">图像预处理和增强</li><li id="4727" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">图像输入分辨率大小</li><li id="a97a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">何时使用预训练砝码</li><li id="bf13" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">选择模型大小和架构</li><li id="83ad" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">从之前的训练中吸取经验</li><li id="1bdc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">训练后选择最佳模型</li><li id="414a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">跟踪您的模型评估</li><li id="7cf7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">导出您的模型</li><li id="bdcb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">优化推理时间</li></ul><p id="fefd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本教程中的资源:</p><h1 id="7572" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">1)收集更多数据</h1><p id="06c7" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">改进对象检测模型的最佳方式是收集更多的代表性数据，YOLO v4也不能逃避这一事实。正如特斯拉的人工智能高级总监Andrej Karpathy在解释<a class="ae kf" href="https://blog.roboflow.com/tesla-stop-signs-computer-vision/" rel="noopener ugc nofollow" target="_blank">特斯拉如何教汽车停止</a>时所说:</p><blockquote class="nd ne nf"><p id="4bf3" class="kw kx ng ky b kz la jr lb lc ld ju le nh lg lh li ni lk ll lm nj lo lp lq lr ij bi translated"><em class="iq">“你的数据集是活的，你的标注说明一直在变。你需要一直管理和改变你的数据集。”</em></p></blockquote><h1 id="ed1b" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">2) YOLOv4图像预处理和增强</h1><p id="731d" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">收集和标注更多数据的成本很高。幸运的是，有一些自动的方法可以通过增强来改善你的训练集的范围和规模。YOLO v4培训管道会自动进行增强(参见这篇关于YOLO v4 中<a class="ae kf" href="https://blog.roboflow.com/yolov4-data-augmentation/" rel="noopener ugc nofollow" target="_blank">数据增强的文章)，但是您可能需要考虑</a><a class="ae kf" href="https://blog.roboflow.com/boosting-image-detection-performance-with-data-augmentation/" rel="noopener ugc nofollow" target="_blank">在Roboflow </a>中添加额外的增强。</p><p id="9229" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图像预处理也是另一个重要的步骤，以确保您的图像是正确的图像分辨率大小，并且您已经标准化了一些方面，如<a class="ae kf" href="https://blog.roboflow.com/label-management-for-computer-vision/" rel="noopener ugc nofollow" target="_blank">类本体</a>、<a class="ae kf" href="https://blog.roboflow.com/when-to-use-grayscale-as-a-preprocessing-step/" rel="noopener ugc nofollow" target="_blank">灰度</a>和<a class="ae kf" href="https://blog.roboflow.com/when-to-use-contrast-as-a-preprocessing-step/" rel="noopener ugc nofollow" target="_blank">对比度</a>。</p><p id="4c0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要做出的最重要的预处理决定是图像输入分辨率。</p><h1 id="ceb1" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">3) YOLOv4输入分辨率大小</h1><p id="c9b5" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">输入分辨率决定了将传递到模型中进行学习和预测的像素数。大像素分辨率提高了准确性，但代价是训练和推理时间变慢。较大的像素分辨率可以帮助您的模型检测小对象。</p><p id="954e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ng"> YOLO模型的像素分辨率必须是32的倍数。</em>可供选择的标准分辨率尺寸为416x416。</p><p id="dd8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果在Roboflow中管理数据集，可以通过调整大小预处理步骤选择数据集输入分辨率大小。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nk"><img src="../Images/7bfc7e75e39f2efa8284db17c0d503be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H1GU0Mvi3lAlARxl.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">在<a class="ae kf" href="https://roboflow.com" rel="noopener ugc nofollow" target="_blank">robof flow</a>中调整图像大小</p></figure><p id="0c84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ng">重要提示:</em>为了确保您的输入分辨率大小能够传递到您的YOLOv4模型，您必须调整模型配置文件。在<code class="fe nl nm nn no b">cfg</code>文件夹中你指定你的型号配置，在这里修改<code class="fe nl nm nn no b">width</code>和<code class="fe nl nm nn no b">height</code>。</p><p id="7ffc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn no b">[net] batch=64 subdivisions=8 # Training #width=512 #height=512 width=608 height=608 channels=3 momentum=0.949 decay=0.0005 angle=0 saturation = 1.5 exposure = 1.5 hue=.1</code></p><p id="0e7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在YOLOv4模型cfg文件中更改宽度和高度</p><pre class="kh ki kj kk gt np no nq nr aw ns bi"><span id="3715" class="nt mh iq no b gy nu nv l nw nx">[net] <br/>batch=64 <br/>subdivisions=8 <br/><em class="ng"># Training</em> <br/><em class="ng">#width=512</em> <br/><em class="ng">#height=512</em> <br/>width=608 <br/>height=608 <br/>channels=3 <br/>momentum=0.949 <br/>decay=0.0005 <br/>angle=0 <br/>saturation = 1.5 <br/>exposure = 1.5 <br/>hue=.1</span></pre><h1 id="b0f1" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">4)何时使用预训练的YOLOv4砝码</h1><p id="aabd" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">要开始在YOLOv4上训练，我们通常会下载预训练的重量:</p><pre class="kh ki kj kk gt np no nq nr aw ns bi"><span id="0a3c" class="nt mh iq no b gy nu nv l nw nx">!wget <a class="ae kf" href="https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137" rel="noopener ugc nofollow" target="_blank">https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137</a></span></pre><p id="8b20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并且在训练期间从这个预先训练的检查点开始:</p><pre class="kh ki kj kk gt np no nq nr aw ns bi"><span id="0bef" class="nt mh iq no b gy nu nv l nw nx">!./darknet detector train data/obj.data cfg/custom-yolov4-detector.cfg yolov4.conv.137 -dont_show -map</span></pre><p id="3288" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些权重已经在COCO数据集上进行了预训练，该数据集包括人、自行车和汽车等常见对象。一般来说，从预训练的重量开始是一个好主意，特别是如果你认为你的物体与COCO中的物体相似。</p><p id="1bfc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，如果你的任务明显比COCO困难(航拍、文档等。)，你可能会从零开始训练中受益。</p><pre class="kh ki kj kk gt np no nq nr aw ns bi"><span id="a200" class="nt mh iq no b gy nu nv l nw nx">!./darknet detector train data/obj.data cfg/custom-yolov4-detector.cfg -dont_show -map</span></pre><p id="f395" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，对两者都进行实验总是有利的，并且根据经验来看哪一个最适合你的模型。</p><h1 id="c445" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">5)选择模型大小和架构</h1><p id="09a2" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">YOLOv4有两种口味<a class="ae kf" href="https://blog.roboflow.com/training-yolov4-on-a-custom-dataset/" rel="noopener ugc nofollow" target="_blank"> YOLOv4 </a>和<a class="ae kf" href="https://blog.roboflow.com/train-yolov4-tiny-on-custom-data-lighting-fast-detection/" rel="noopener ugc nofollow" target="_blank"> YOLOv4-tiny </a>。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/c3f013f2d4ca26a4a553864084e48e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*LcIHAF2aoqloiDxe.png"/></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><em class="nz">不同型号性能和推理速度对比(</em><a class="ae kf" href="https://github.com/AlexeyAB/darknet/issues/6067" rel="noopener ugc nofollow" target="_blank"><em class="nz">yolov 4-tiny</em></a><em class="nz">发布)</em></p></figure><p id="04bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果推理速度是你的最终目标，较小的模型可能会感兴趣。通过改进数据集，可能会降低精确度。</p><p id="87b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从YOLOv4转YOLOv4-tiny是车型配置的问题。您可以尝试中间配置来构建一个定制的YOLO模型。为此，查看<code class="fe nl nm nn no b">cfg</code>文件夹，尝试改变网络架构和层。如果你的对象形状与COCO数据集有很大不同，你可以考虑实现<a class="ae kf" href="https://blog.roboflow.com/what-is-an-anchor-box/" rel="noopener ugc nofollow" target="_blank">自定义锚框</a>。这是非常高级的战术！</p><pre class="kh ki kj kk gt np no nq nr aw ns bi"><span id="8e1b" class="nt mh iq no b gy nu nv l nw nx">[yolo] <br/>mask = 0,1,2 <br/>anchors = 12, 16, 19, 36, 40, 28, 36, 75, 76, 55, 72, 146, 142<br/>classes=80 <br/>num=9 <br/>jitter=.3 <br/>ignore_thresh = .7 <br/>truth_thresh = 1 <br/>scale_x_y = 1.2 <br/>iou_thresh=0.213 <br/>cls_normalizer=1.0 <br/>iou_normalizer=0.07 <br/>iou_loss=ciou <br/>nms_kind=greedynms <br/>beta_nms=0.6 <br/>max_delta=5</span></pre><h1 id="230a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">6)从之前的YOLOv4训练中恢复</h1><p id="15dd" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">在Darknet框架中训练您的YOLOv4模型可能需要一段时间。定期保存模型非常重要。您可以通过调用之前训练跑步重量的训练来恢复训练，如下所示:</p><pre class="kh ki kj kk gt np no nq nr aw ns bi"><span id="f483" class="nt mh iq no b gy nu nv l nw nx">!./darknet detector train data/obj.data cfg/custom-yolov4-detector.cfg [YOUR WEIGHTS HERE] -dont_show -map</span></pre><p id="bbdf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保权重是用相同的配置文件训练的，并且是在相同版本的Darknet框架下训练的！</p><p id="2282" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就像预训练的权重一样，您可以从以前的训练中学习，并将您的模型从其他数据集中获得的知识应用到新的数据集中。</p><h1 id="8aeb" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">7)训练后选择最佳的YOLOv4模型</h1><p id="b4dd" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">暗网模型权重保存在<code class="fe nl nm nn no b">backup</code>文件夹中，每1000次迭代自动保存。Darknet会自动为你保存最好的型号，扩展名为_ <code class="fe nl nm nn no b"><em class="ng">best.weights</em></code> <em class="ng">。这是基于您的验证集的性能。 Darknet还会用扩展功能<code class="fe nl nm nn no b">_last.weights</code>保存你训练跑步的最后重量。</em></p><h1 id="5099" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">8)跟踪您的YOLOv4型号评估</h1><p id="4da9" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">当您在数据集和YOLOv4建模中进行各种调整时，跟踪您的结果会很有用，这样您就可以看到哪种技术组合最适合您的数据集。</p><p id="26a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Darknet将输出一个<a class="ae kf" href="https://blog.roboflow.com/mean-average-precision/" rel="noopener ugc nofollow" target="_blank">平均精度</a>分数，这是在您决定哪个模型最适合您的数据时要跟踪的主要指标。另一个需要考虑的重要指标是推理的速度。</p><h1 id="bece" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">9)导出您的YOLOv4模型</h1><p id="8ae4" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">一旦你有了一个训练好的模型，它将会是暗网<code class="fe nl nm nn no b">.weights</code>格式。您可能希望将其转换为新的格式进行部署。</p><p id="49c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">YOLOv4 Darknet型号转换指南:</p><ul class=""><li id="4e36" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kf" href="https://blog.roboflow.com/how-to-train-a-custom-mobile-object-detection-model/" rel="noopener ugc nofollow" target="_blank">用于移动部署的yolov 4 TF lite</a></li><li id="c9f1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kf" href="https://blog.roboflow.com/deploy-luxonis-oak/" rel="noopener ugc nofollow" target="_blank"> YOLOv4 OpenVino和OAK展开</a></li><li id="7ef6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kf" href="https://github.com/hunglc007/tensorflow-yolov4-tflite" rel="noopener ugc nofollow" target="_blank"> YOLOv4 Tensorflow回购</a></li></ul><h1 id="49f3" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">10)优化YOLOv4推理时间</h1><p id="e446" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">加快你的模型推断时间的首要方法是使用YOLOv4-tiny这样的小一点的模型。通过硬件选择，如GPU或使用VPU上的OpenVino进行推断，可以进一步提高推断时间。对于GPU推断，建议用<a class="ae kf" href="https://github.com/CaoWGG/TensorRT-YOLOv4" rel="noopener ugc nofollow" target="_blank">yolov 4 tensort框架</a>部署。</p><h1 id="1aeb" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="ab22" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">恭喜你！现在，您有十种新的高级策略来最大限度地利用YOLO v4来创建对象检测器，从而为您的自定义数据集建模。</p><p id="8fb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一如既往，快乐训练。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="e259" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ng">原载于2020年11月13日https://blog.roboflow.com</em><a class="ae kf" href="https://blog.roboflow.com/yolov4-tactics/" rel="noopener ugc nofollow" target="_blank"><em class="ng"/></a><em class="ng">。</em></p></div></div>    
</body>
</html>