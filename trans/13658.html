<html>
<head>
<title>NLP Data Apps: Batteries Included with Streamlit and HuggingFace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NLP数据应用:Streamlit和HuggingFace附带的电池</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nlp-data-apps-batteries-included-with-streamlit-and-huggingface-828083a89bb2?source=collection_archive---------26-----------------------#2020-09-19">https://towardsdatascience.com/nlp-data-apps-batteries-included-with-streamlit-and-huggingface-828083a89bb2?source=collection_archive---------26-----------------------#2020-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f903" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解数据科学前端的运行速度有多快！</h2></div><p id="3480" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在构建数据科学项目时，需要完成的最后一项任务(但不是最重要的)是前端的<strong class="kk iu">实现，它使模型对最终用户可用，并从用户界面下的所有机器中抽象出来。</strong></p><p id="64fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样做的常见方法有:</p><ol class=""><li id="cd04" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated"><strong class="kk iu">用Angular/React或你选择的其他框架构建用户界面</strong></li><li id="12d7" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="kk iu">依托Tableau、Power Bi、Qlik等仪表盘工具… </strong></li></ol><p id="c772" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你真的不喜欢摆弄JS框架(像我一样)，或者希望能够构建一个真正的端到端管道，那么你必须至少使用一次Streamlit。</p><p id="f1ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如网站所说，Streamlit是构建数据应用的最快方式。虽然这听起来有些傲慢，但这绝对是事实。</p><p id="6346" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了展示弄脏手有多快，我用Streamlit和HuggingFace的变形金刚建立了一个原型，使用了一个预先训练好的问答模型。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="92d8" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">先决条件:安装变压器和简化</h1><p id="6fe7" class="pw-post-body-paragraph ki kj it kk b kl mr ju kn ko ms jx kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">是的，我说“包括电池”，但你必须先买！</p><p id="22d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开终端(或Anaconda提示符，取决于您的选择)并运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="3f79" class="nf ma it nb b gy ng nh l ni nj">pip install transformers<br/>pip install streamlit</span></pre><h1 id="7d94" class="lz ma it bd mb mc nk me mf mg nl mi mj jz nm ka ml kc nn kd mn kf no kg mp mq bi translated">代码和结果</h1><p id="de1c" class="pw-post-body-paragraph ki kj it kk b kl mr ju kn ko ms jx kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">安装完成后，获取您的编辑器并首先导入必要的包:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="8f10" class="nf ma it nb b gy ng nh l ni nj">import streamlit as st<br/>from transformers import AutoTokenizer,AutoModelForQuestionAnswering<br/>from transformers.pipelines import pipeline</span></pre><p id="a684" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这允许你使用预先训练的拥抱脸模型，因为我不想从头开始训练。然后，您可以构建一个函数来加载模型；注意，我使用了<strong class="kk iu"> @st.cache() </strong> decorator来避免每次都重新加载模型(至少它应该有助于减少一些开销，但是我必须更深入地研究Streamlit漂亮的文档):</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="c3de" class="nf ma it nb b gy ng nh l ni nj">st.cache(show_spinner=False)<br/>def load_model():<br/>    tokenizer = AutoTokenizer.from_pretrained("twmkn9/distilbert-  base-uncased-squad2")<br/>    model = AutoModelForQuestionAnswering.from_pretrained("twmkn9/distilbert-base-uncased-squad2")<br/>    nlp_pipe = pipeline('question-answering',model=model,tokenizer=tokenizer)</span><span id="ac64" class="nf ma it nb b gy np nh l ni nj">    return nlp_pipe</span><span id="0012" class="nf ma it nb b gy np nh l ni nj">npl_pipe = load_model()</span></pre><p id="320a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加一个标题和一些文本来填补空白，并添加一个侧边栏:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="c1a9" class="nf ma it nb b gy ng nh l ni nj">t.header("Prototyping an NLP solution")<br/>st.text("This demo uses a model for Question Answering.")</span><span id="37ce" class="nf ma it nb b gy np nh l ni nj">add_text_sidebar = st.sidebar.title("Menu")<br/>add_text_sidebar = st.sidebar.text("Just some random text.")</span></pre><p id="a676" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑到我选择了一个问题回答模型，我必须提供一个用于写问题的文本单元格和一个用于复制文本的文本区域，作为查找答案的上下文。这可以通过两行来完成:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="7fbb" class="nf ma it nb b gy ng nh l ni nj">question = st.text_input(label='Insert a question.')<br/>text = st.text_area(label="Context")</span></pre><p id="7b4f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在你可以调用模型来回答宇宙中最深最难的问题。为了避免第一次加载应用程序时出现错误，我将推理代码包装在一个if语句中(必须承认，这完全是糟糕的代码):</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="dfeb" class="nf ma it nb b gy ng nh l ni nj">if (not len(text)==0) and (not len(question)==0):<br/>    x_dict = npl_pipe(context=text,question=question)<br/>    st.text('Answer: ',x_dict['answer'])</span></pre><p id="9a24" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将输出您在提供的文本中提出的问题的答案。<br/>完整代码在此:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="703e" class="nf ma it nb b gy ng nh l ni nj">import streamlit as st</span><span id="ee6b" class="nf ma it nb b gy np nh l ni nj">from transformers import AutoTokenizer, AutoModelForQuestionAnswering<br/>from transformers.pipelines import pipeline</span><span id="25ae" class="nf ma it nb b gy np nh l ni nj">st.cache(show_spinner=False)<br/>def load_model():<br/>    tokenizer = AutoTokenizer.from_pretrained("twmkn9/distilbert-base-uncased-squad2")</span><span id="e0b9" class="nf ma it nb b gy np nh l ni nj">    model = AutoModelForQuestionAnswering.from_pretrained("twmkn9/distilbert-base-uncased-squad2")</span><span id="0954" class="nf ma it nb b gy np nh l ni nj">    nlp_pipe = pipeline('question-answering',model=model,tokenizer=tokenizer)</span><span id="f926" class="nf ma it nb b gy np nh l ni nj">    return nlp_pipe</span><span id="9e9a" class="nf ma it nb b gy np nh l ni nj">npl_pipe = load_model()</span><span id="1918" class="nf ma it nb b gy np nh l ni nj">st.header("Prototyping an NLP solution")<br/>st.text("This demo uses a model for Question Answering.")</span><span id="95b4" class="nf ma it nb b gy np nh l ni nj">add_text_sidebar = st.sidebar.title("Menu")<br/>add_text_sidebar = st.sidebar.text("Just some random text.")</span><span id="2521" class="nf ma it nb b gy np nh l ni nj">question = st.text_input(label='Insert a question.')<br/>text = st.text_area(label="Context")</span><span id="bd87" class="nf ma it nb b gy np nh l ni nj">if (not len(text)==0) and not (len(question)==0):<br/>    x_dict = npl_pipe(context=text,question=question<br/>    st.text('Answer: ',x_dict['answer'])</span></pre><p id="a51c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要运行该脚本，只需键入:<strong class="kk iu">streamlit run script _ _ name . py</strong>，它将默认在<strong class="kk iu"> localhost:8501，</strong>上运行，因此在浏览器中打开它。<br/>这里是输出的截图:</p><figure class="mw mx my mz gt nr gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nq"><img src="../Images/62584c1d9e64442663dc90ac5219b22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dt2QWFxWTmitvv-r04iqiA.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">代码的输出。</p></figure><p id="55c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，这并不意味着为Streamlit的每个特性提供详尽的指南，而只是一种让其他人像我一样通过实验来了解这个伟大工具的方式。</p><p id="6e30" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢，下次再见！</p></div></div>    
</body>
</html>