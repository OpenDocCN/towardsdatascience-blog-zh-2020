<html>
<head>
<title>How to Dockerize Any Machine Learning Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对任何机器学习应用进行分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-dockerize-any-machine-learning-application-f78db654c601?source=collection_archive---------20-----------------------#2020-10-13">https://towardsdatascience.com/how-to-dockerize-any-machine-learning-application-f78db654c601?source=collection_archive---------20-----------------------#2020-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="06bd" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="0dc7" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">我用这三个简单的步骤反复做这件事。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/7fc6e0f236672abcfe5c56fc619310c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AlF-vo8TEasnUEzW"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">用集装箱装运，模特们！(图片由<a class="ae lh" href="https://unsplash.com/@andasta?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安迪李</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="7922" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一个月后，作为一名刚毕业的大学生，我们人工智能创业公司的创始人走到我面前，问我，“Arunn，我想让你成为Docker方面的专家。你需要多长时间？” 。不确定Docker是什么，但又无法闪避问题，最终我回复了，<strong class="lk jd"> <em class="me">“两周，1次冲刺”。</em>T13】</strong></p><p id="acda" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我的经理也在附近，他试图打断我来救我，但我已经造成了伤害，我所能做的就是接下来的两个星期。</p><p id="422f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">回想起来，我从来都不是专家(<em class="me">现在也不是！但是我学到了足够做需要做的事情。在这篇文章中，我将告诉你什么才足以对任何机器学习web应用程序进行dockerize。</em></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="1317" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">Docker是什么？</h1><p id="e2f4" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated"><strong class="lk jd"> Docker </strong>是一个通过使用容器来创建、部署和运行应用程序的工具。一个<strong class="lk jd">容器</strong>是一个标准化的软件单元，简单来说——除了打包的应用程序代码、必需的库和其他依赖项之外，什么都没有。一个<strong class="lk jd"> Docker镜像</strong>是一个可执行的软件包，包括运行一个应用程序所需的一切，并在运行时成为一个<strong class="lk jd">容器</strong>。</p><p id="fd1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我试图理解Docker时，它是许多新的技术术语。但这个想法其实很简单。</p><p id="01a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">想象一下你得到了一台新的迷你Ubuntu机器。然后你在它上面安装一些包。然后在其上添加一些代码。最后，您执行代码来创建应用程序。所有这一切都发生在你现有的装有你所选择的操作系统的机器上。你所需要的就是在里面安装Docker。</p><p id="2521" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您的机器上没有安装Docker，请在此处找到<a class="ae lh" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">说明来设置Docker </a>。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="54d3" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">为什么Docker面向数据科学家？</h1><p id="7495" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">我明白了。你在数据科学领域。你觉得DevOps的人能搞定Docker吗？你老板没让你成为专家(<em class="me">不像我！)</em>。</p><p id="521d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你觉得其实不需要了解Docker。</p><p id="1e71" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那不是真的，让我告诉你为什么。</p><blockquote class="nj"><p id="30cc" class="nk nl it bd nm nn no np nq nr ns md dk translated">“不知道为什么它不能在你的机器上工作，但它能在我的机器上工作。要不要我看看？”</p></blockquote><p id="4400" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">在你的工作场所听过这些话吗？一旦你(和你的团队)理解了Docker，没有人会再说出那些话。事实上，你的代码可以在Ubuntu、Windows、AWS、Azure、Google Cloud或任何地方流畅运行。</p><p id="587d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">你构建的应用程序在任何地方都是可复制的。</strong></p><p id="b945" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您将更快地启动环境，并以正确的方式分发您的应用程序，并且您将节省大量时间。你将(最终)成为一名拥有软件工程最佳实践的数据科学家。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="f254" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">三个简单的步骤</h1><p id="4b47" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">正如我所承诺的，我已经将这个过程简化为3个简单的步骤。这里让我们使用一个糖尿病预测应用程序的用例，它可以根据诊断方法预测糖尿病的发作。这将让您了解我们如何在真实的用例场景中实现容器化。</p><p id="426d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我强烈推荐您阅读<a class="ae lh" href="https://medium.com/towards-artificial-intelligence/how-i-build-machine-learning-apps-in-hours-a1b1eaa642ed?source=friends_link&amp;sk=66a5df0a2570e1cf0f12211f3b4f2fc2" rel="noopener">这篇文章，在这篇文章中，我们使用Streamlit一步一步地从头开始构建这个机器学习应用程序。</a></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/dc1e1232da935824b6fd69e4d74970c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2ptAWR4T-iay5z6wF8Krlg.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者制作的糖尿病预测应用的截屏</p></figure><p id="e099" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请看一下<a class="ae lh" href="https://github.com/arunnthevapalan/diabetes-prediction-app" rel="noopener ugc nofollow" target="_blank">这个GitHub库，以及完整的实现</a>和示例。现在我们知道了背景，让我们开始我们的3个步骤吧！</p><h2 id="159b" class="nz mn it bd mo oa ob dn ms oc od dp mw lr oe of my lv og oh na lz oi oj nc iz bi translated">1.定义环境</h2><p id="dac2" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">第一步是确保应用程序正常运行所需的确切环境。有许多方法可以做到这一点，但最简单的一个想法是为项目定义<code class="fe ok ol om on b">requirements.txt</code>文件。</p><p id="1971" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请查看您的代码中使用的所有库，并在名为<code class="fe ok ol om on b">requirements.txt</code>的文本文件中列出它们。列出库的确切版本是一个很好的做法，当您在环境的终端上运行<code class="fe ok ol om on b">pip freeze</code>时就可以找到。我的糖尿病预测示例的<a class="ae lh" href="https://github.com/arunnthevapalan/diabetes-prediction-app/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank">需求</a>文件如下所示，</p><pre class="ks kt ku kv gt oo on op oq aw or bi"><span id="8350" class="nz mn it on b gy os ot l ou ov">joblib==0.16.0<br/>numpy==1.19.1<br/>pandas==1.1.0<br/>pandas-profiling==2.8.0<br/>scikit-learn==0.23.2<br/>streamlit==0.64.0</span></pre><h2 id="0ab5" class="nz mn it bd mo oa ob dn ms oc od dp mw lr oe of my lv og oh na lz oi oj nc iz bi translated">2.编写Dockerfile文件</h2><p id="dac7" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">这里的想法是我们试图创建一个名为<code class="fe ok ol om on b">Dockerfile</code>的文件，它可以用来构建我们的应用程序运行所需的虚拟环境。请将它视为我们在任何系统之上构建所需环境的指导手册！</p><p id="27e0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们为手头的例子编写docker文件，</p><pre class="ks kt ku kv gt oo on op oq aw or bi"><span id="76e0" class="nz mn it on b gy os ot l ou ov">FROM python:3.7<br/>EXPOSE 8501<br/>WORKDIR /app<br/>COPY . .<br/>RUN pip install -r requirements.txt<br/>CMD streamlit run app.py</span></pre><p id="8d3d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样。6行代码。一切按顺序进行。每一行都建立在前一行之上。我们来剖析一下台词。</p><ol class=""><li id="6c82" class="ow ox it lk b ll lm lo lp lr oy lv oz lz pa md pb pc pd pe bi translated">每个Dockerfile都必须从 命令的<strong class="lk jd"> <em class="me">开始。从</em> </strong>跟随<strong class="lk jd"> <em class="me">的必须是已经存在的映像(或者在您的机器上，或者来自<a class="ae lh" href="https://hub.docker.com/search?type=image" rel="noopener ugc nofollow" target="_blank">docker hub库</a>)。因为我们的环境是基于python的，所以我们使用<code class="fe ok ol om on b">python:3.7</code>作为我们的基本映像，并最终使用这个docker文件创建一个新映像。</em></strong></li><li id="05f5" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated">Streamlit在默认端口8501上运行。因此，为了让应用程序运行，公开特定的端口非常重要。为此我们使用<strong class="lk jd"> <em class="me">曝光</em> </strong>命令。</li><li id="3b46" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated"><strong class="lk jd"> <em class="me">工作目录</em> </strong>设置应用程序的工作目录。其余的命令将从此路径执行。</li><li id="47f1" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated">这里的<strong class="lk jd"> <em class="me">复制</em> </strong>命令将所有的文件从你的Docker客户端的当前目录复制到镜像的工作目录。</li><li id="9b39" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated"><strong class="lk jd"> <em class="me">运行</em> </strong>命令确保我们在<code class="fe ok ol om on b">requirements.txt</code>中定义的库被正确安装。</li><li id="8e8f" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated"><strong class="lk jd"> <em class="me"> CMD </em> </strong>指定启动时在容器内运行什么命令。因此<code class="fe ok ol om on b">streamlit run app.py</code>确保了容器一启动，Streamlit应用就会运行。</li></ol><p id="6208" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">编写Docker文件需要一些练习，除非你花很多时间使用Docker，否则你不可能掌握所有可用的命令。我建议熟悉一些基本命令，并参考docker的官方文档了解其他信息。</p><h2 id="f361" class="nz mn it bd mo oa ob dn ms oc od dp mw lr oe of my lv og oh na lz oi oj nc iz bi translated">3.建立形象</h2><p id="0c98" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">既然我们已经定义了Dockerfile，那么是时候构建它并创建一个映像了。这个想法是，我们创建的这个图像是与底层系统无关的可再生环境。</p><pre class="ks kt ku kv gt oo on op oq aw or bi"><span id="0476" class="nz mn it on b gy os ot l ou ov">docker build --tag app:1.0 .<!-- --> </span></pre><p id="9521" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">顾名思义<code class="fe ok ol om on b">build</code>命令按照Dockerfile中的定义一层一层地构建图像。用名称和版本号将图像标记为<code class="fe ok ol om on b">&lt;name&gt;:version.number</code>是一个很好的做法。末尾的点表示Dockerfile的路径，即当前目录。</p><p id="9eac" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">等等，我建立了图像，但是我该怎么做呢？根据需求，你可以<a class="ae lh" href="https://docs.docker.com/get-started/part3/" rel="noopener ugc nofollow" target="_blank">在DockerHub </a>上共享构建好的映像或者<a class="ae lh" href="https://docs.docker.com/engine/context/aci-integration/" rel="noopener ugc nofollow" target="_blank">在云</a>上部署它们等等。但是首先，现在您运行图像来获取容器。</p><p id="e514" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">顾名思义，<code class="fe ok ol om on b">run</code>命令在主机上运行指定的容器。<code class="fe ok ol om on b">--publish 8501:8501</code>让容器的端口8501映射到主机的端口8501，而<code class="fe ok ol om on b">-it</code>是运行交互进程(比如shell/terminal)所需要的。</p><pre class="ks kt ku kv gt oo on op oq aw or bi"><span id="d8f8" class="nz mn it on b gy os ot l ou ov">docker run --publish 8501:8501 -it app:1.0</span></pre><p id="b421" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在按照你的终端上提示的链接，自己去看魔术吧！；)</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/700806aa4909da356b55e4858f36e086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FonkgYURJC_bMQmT"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">你做到了！(照片由<a class="ae lh" href="https://unsplash.com/@lephunghia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊亚勒</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄)</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="9aa5" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">在你走之前</h1><pre class="ks kt ku kv gt oo on op oq aw or bi"><span id="5394" class="nz mn it on b gy os ot l ou ov">This article is a part of my series on <strong class="on jd">Machine Learning in Production</strong>:<br/>- <a class="ae lh" href="https://medium.com/towards-artificial-intelligence/how-i-build-machine-learning-apps-in-hours-a1b1eaa642ed" rel="noopener">How I Build Machine Learning Apps in Hours</a><br/>- <a class="ae lh" rel="noopener" target="_blank" href="/how-to-dockerize-any-machine-learning-application-f78db654c601">How to Dockerize Any Machine Learning Application</a><br/>- <a class="ae lh" rel="noopener" target="_blank" href="/deploying-your-machine-learning-apps-in-2021-a3471c049507">Deploying Your Machine Learning Apps in 2021</a></span></pre><p id="8e99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">谢谢你读到这里。我希望这篇文章为您增加一些价值，并帮助您开始使用Docker for data science。尽管我已经用了好几年了，但我并不认为自己是专家。但是我觉得我知道的足够多了，我想和大家分享我所知道的一点点。我迫不及待地想看到你们都开始扮演码头工人。<strong class="lk jd"> </strong> <a class="ae lh" href="https://arunnthevapalan.medium.com/" rel="noopener">我写了很多我在数据科学方面的经历</a> <strong class="lk jd"> </strong>，非常感谢您的反馈。</p><p id="b179" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">想保持联系？</em> <a class="ae lh" href="https://friends.arunnthevapalan.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> <em class="me">加入我的私人邮箱好友列表</em> </strong> <em class="me">。</em> </a></p></div></div>    
</body>
</html>