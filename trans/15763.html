<html>
<head>
<title>Explainable AI: Application of shapely values in Marketing Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可解释的人工智能:shapely值在营销分析中的应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/explainable-ai-application-of-shapely-values-in-marketing-analytics-57b716fc9d1f?source=collection_archive---------8-----------------------#2020-10-30">https://towardsdatascience.com/explainable-ai-application-of-shapely-values-in-marketing-analytics-57b716fc9d1f?source=collection_archive---------8-----------------------#2020-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b874" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">直觉的介绍性指南，以及用Python实现营销分析的SHAP</h2></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/c2e7e88f7d890a0eae59cce5f5d15a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K2jZxX05hLbk4urE"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@nezelenoe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Artyom Kim </a>在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lg"><img src="../Images/3bac2d4e8c5ab0fd65dda5912feb29f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3KjMb5KenBGjcqu61oxcg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh"> XAI:可解释的AI </strong>。来源:作者图片</p></figure><p id="5c70" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最近，我偶然发现了一份白皮书，其中谈到了人工智能在营销分析中的最新应用。具体讲了XAI(可解释AI)在营销组合建模<a class="ae lf" href="https://www.h2o.ai/blog/the-benefits-of-budget-allocation-with-ai-driven-marketing-mix-models/" rel="noopener ugc nofollow" target="_blank">【白皮书】</a>中的应用。这引起了我的注意，我开始探索三件事:XAI，营销分析的现状，以及XAI在营销分析中的潜在应用。在浏览了所有可用资源后，我意识到XAI在重塑营销分析方面有着巨大的潜力。</p><p id="5ca6" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，首先我们将讨论与营销分析现状相关的具体挑战及其解决方案。其次，我们将尝试开发一个关于XAI的直觉，最后，我们将在一些公开可用的营销数据集上实现XAI。</p><h2 id="7b9d" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">与营销分析现状相关的挑战及其可能的解决方案:</h2><p id="2247" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">存在许多挑战，但与营销分析现状相关的三个重大挑战与<strong class="lk iu">所用模型(GLMs:广义线性模型)的准确性、渠道属性以及市场反应中固有的非线性相关</strong>。鉴于这些挑战，我们将讨论XAI如何解决与GLMs、渠道归属相关的问题，以及与非线性相关的其他问题。作为介绍，我们将在本节非常简要地讨论一些挑战及其解决方案；然而，随着本文的深入，我们将详细讨论每一件事。</p><ol class=""><li id="1012" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md nh ni nj nk bi translated"><strong class="lk iu"> GLMs </strong></li></ol><p id="f999" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">现有挑战:</strong>广义线性模型(GLMs)被广泛用于整个行业的营销组合建模。GLM的附加性质有助于我们很容易地确定营销渠道对销售收入的贡献。与GLMs相比，现代算法要精确得多，但这些算法更像是黑盒模型，缺乏可解释性。因此，工业上广泛使用GLM的唯一原因是因为它易于解释。</p><p id="2604" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">可能的解决方案:</strong> XAI为我们提供了一种解释任何黑箱模型的极好方法，因此它为我们使用高度精确的集合模型代替GLMs打开了大门。因此，现在在高精度集合模型的帮助下，我们不仅在精度上而且在可解释性上胜过GLMs。</p><p id="75c2" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> 2。频道归属</strong></p><p id="9f33" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">现有挑战:</strong>这是营销人员最大的痛点之一。由于渠道之间存在相互作用，因此几乎不可能公平地将收益分配给不同的渠道。</p><p id="ca3b" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">可能的解决方案:</strong>来自合作博弈理论的匀称的价值观来拯救这里。<em class="nl">Shapley值是一种将总增量收益公平分配给游戏中合作玩家的方法。</em>在我们的案例中，营销渠道是玩家相互合作以增加收入等指标；我们的目标是将增加的收入公平地分配给营销渠道。谷歌分析也在其数据驱动的归因方法中使用shapely值。<a class="ae lf" href="https://support.google.com/analytics/answer/3191594?hl=en" rel="noopener ugc nofollow" target="_blank">【来源】</a></p><p id="4937" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> 3。不同营销渠道的互动</strong></p><p id="1f09" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">现有挑战:</strong>有一些渠道，作为独立渠道，并不是重要的贡献者；然而，与其他渠道相结合可以发挥重要作用。因此，对于营销人员来说，了解互动渠道的不同组合是很重要的。随着通道数量的增加，相互作用的数量显著增加，并且在GLMs中包括所有这样的相互作用项变得非常麻烦。</p><p id="bf1a" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">可能的解决方案:</strong>为了应对这一挑战，我们将再次使用shapely值，但方式不同。我们将使用<a class="ae lf" href="https://shap.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> SHAP </a>算法来研究大规模渠道的相互作用。【<em class="nl"> SHAP算法是机器学习中shapely值的实现，用来解释和诠释任何黑盒ML模型。因为，在我们的例子中，我们将用高度精确的基于树的集合模型代替GLMs，因此我们将使用SHAP来解释和说明我们的模型中的通道相互作用。</em></p><p id="6be2" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> 4。正面影响阈值</strong></p><p id="7405" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">现有挑战:</strong>例如，在电视广告方面，较低的支出可能不会产生任何收入；然而，在一定的最低消费后，电视广告开始显示其积极的影响。另一方面，数字渠道的市场反应函数通常是陡峭的，这意味着您在数字渠道上增加的支出越多，在达到饱和点之前，您看到的对您收入的影响就越大。<em class="nl">由于市场固有的动态非线性性质，使用线性模型获得正面影响阈值变得非常具有挑战性。</em></p><p id="a103" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">可能的解决方案:</strong>我们可以使用非线性的、基于树的集成模型以及解释器模型，而不是使用线性模型。从explainer模型中，我们将获得shapely值(每个渠道单独的贡献)，然后我们可以绘制这些shapely值，以获得每个渠道的积极影响阈值。下图显示了电视正面影响阈值的一个例子。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/17bf650c160a50cc4df55ed8256af703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*kEggWN6MtFRXRGvEjbqr2g.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">显示电视广告正面影响阈值的图表:Y轴是电视广告带来的增量收入(Shapely Value)。x轴显示电视广告支出。</strong>来源:作者图片</p></figure><p id="8f94" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> 5。每个渠道的最佳支出</strong></p><p id="0e50" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">现有挑战:</strong>最佳支出取决于不同渠道的营销响应函数，通常这些营销响应函数本质上是非线性的。例如，如果我们不断增加在某个渠道上的支出，那么在某次支出后，增加的积极影响开始减少。增量影响开始饱和然后最终下降的点，就是我们在该渠道上实现最佳支出的点。</p><p id="6a13" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">可能的解决方案:</strong>同样，解决方案与第3点相同，基于shapely值。然而，唯一的区别是，这里我们必须得到一个点，从这个点开始，我们的图变得渐近，或者在某些情况下开始下降。</p><p id="52f1" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">鉴于所有这些挑战和解决方案，你可能很想知道与匀称的价值观相关的5个问题的答案:</p><ol class=""><li id="1eca" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md nh ni nj nk bi translated"><strong class="lk iu">为什么我们一直在使用GLMs？</strong></li><li id="ef08" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><strong class="lk iu">什么是匀称的价值观？</strong></li><li id="daa9" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><strong class="lk iu">shapely值如何用于归因？</strong></li><li id="a839" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><strong class="lk iu">对于复杂的机器学习模型是如何实现的？</strong></li><li id="fbd6" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">如何解释它，以获得可操作的见解？</li></ol><p id="f5d7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，本文将尝试回答上述问题。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="25da" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">目录</h1><ol class=""><li id="49b4" class="nc nd it lk b ll mx lo my lr od lv oe lz of md nh ni nj nk bi translated">为什么选择营销分析中的GLMs？</li><li id="4ad7" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">得体的价值观</li><li id="73a0" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">匀称的价值观:直觉与实例</li><li id="49ee" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">使用Shapely值的机器学习可解释性</li><li id="7625" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">SHAP:营销分析中的一个用例</li><li id="ed37" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">结束注释</li><li id="1e61" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">更多阅读和参考资料</li></ol></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="bdb4" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">为什么选择营销分析中的GLMs？</h1><p id="6806" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">为了理解这一点，让我们将机器学习模型分为两类:一类是简单模型，另一类是复杂模型。简单模型是那些非常容易解释/说明并且准确性低的模型；然而，复杂的模型本质上是黑箱，几乎不可能解释，而且精确度非常高。</p><p id="f997" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">简单模型的例子是线性回归模型和决策树。线性模型很容易解释，例如:借助模型方程中特征权重的大小和符号，我们可以了解特征对输出的影响。在决策树的情况下，我们可以通过分裂(基于基尼系数、信息增益或熵)从根节点向下移动到叶节点，并解析树以容易地理解/解释模型。虽然这些模型是高度可解释的，但是这些模型有几个问题:线性模型不准确，因为它们不能解释特征的非线性行为，而决策树也不准确，并且有过拟合的问题。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi og"><img src="../Images/9365ee9688c271961ff9b13a70599153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*CtbLbJYniuh51CNv59wjVQ.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">随着模型复杂性和准确性的增加，模型的可解释性降低。来源:作者图片</p></figure><p id="103b" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与决策树相比，随机森林具有高准确性和非常低的方差/过拟合，但是随机森林具有非常大量的树，这些树不能以如此大的数量来解释。因此，这种模型的可解释性是一个大问题。</p><p id="1cff" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">如果我有精确的模型，那我为什么要用不太精确的呢？</strong></p><p id="1f93" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们应该理解正确解释模型输出的能力是非常重要的。它有助于建立利益相关者的信任。我们只是不能对我们的利益相关者说，我们应该实施某个模型，因为它非常准确，具有良好的AUC/ ROC数，或者具有非常低的均方误差。利益相关者总是对知道一个模型如何做决策感兴趣。</p><p id="7f09" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，模型中每个特征的可解释性在营销分析中起着非常重要的作用。我们应该知道所有重要特性影响模型结果的方向和程度。这可以通过GLMs容易地实现；然而，在复杂模型的情况下，我们确实获得了特征的相对重要性值，但是这些值不是很有帮助，因为它没有告诉我们关于对模型输出的影响的大小和方向的任何事情。</p><p id="673b" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在营销分析中，线性模型因其易于解释而受到青睐，即使不如复杂模型准确。</p><p id="0fe7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了解决复杂模型的可解释性，有一些技术(LIME、Shapely等)可以用来创建解释模型，这是一个简单的线性模型，可以非常容易地解释复杂模型。我们将在本文中讨论的方法使用合作博弈论中的shapely值来创建解释模型。</p><blockquote class="oh oi oj"><p id="179c" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated">这里要注意的有趣的事情是，当这些复杂模型与解释模型相结合时，它们不仅在准确性上(很明显)而且在可解释性/可解释性上都优于GLMs。</p></blockquote><p id="ed76" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，我们将试图通过它的定义和一个例子来发展一种关于匀称的价值观的直觉。然后，我们将继续使用一个非常简单的数据集来实现它的机器学习。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="f10a" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">得体的价值观</h1><p id="6641" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated"><em class="nl">沙普利值</em>是由诺贝尔经济学奖获得者罗伊德·S·沙普利开发的，作为一种在团队成员中公平分配团队产出的方法。</p><p id="c49c" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将讨论shapely value的定义，但为了更好地理解这个概念，我建议你先跳到示例部分(Shapely Values:直觉和示例)，然后再回到定义部分。</p><h2 id="20cf" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">定义</h2><blockquote class="oh oi oj"><p id="a373" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated">形式上，联盟博弈被定义为:给定一个联盟博弈<strong class="lk iu"> G(N，ν) </strong>，其中<strong class="lk iu"> N </strong>是博弈中玩家的集合，<strong class="lk iu"> ν </strong> <em class="it"> </em>是一个函数(一个特征函数)，当这个特征函数作为<strong class="lk iu"> ν(S)应用于每个子集S时，它给每个子集<strong class="lk iu"> S </strong>分配一个实数。</strong>我们也称ν(S)为<em class="it">联盟</em> <strong class="lk iu">的价值。</strong></p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi on"><img src="../Images/59134afc89a3d524df84cc07fe87c2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*-_jHF7lQi9uBZEcoRTnMMw.png"/></div></figure><p id="ba05" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果有2个玩家(A，B)，那么将有4个子集{Null，A，B，AB}。因此，对于子集AB，我们有ν(AB)作为A和b的联合值。</p><blockquote class="oh oi oj"><p id="6902" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated">ν(S)描述了S的成员通过合作可以获得的总期望收益。</p><p id="302a" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated">Shapley值是将总收益分配给参与者的一种方式，假设他们都合作。根据Shapley值，给定一个联盟博弈G(N，ν),玩家<strong class="lk iu">I</strong>得到的金额为</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b55b826e76ab21c77562a02a730cba6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*J1ov7Za-VOC6pwaHZXq9rA.png"/></div></figure><p id="182d" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，<strong class="lk iu"> n </strong>是N个玩家的总数，‘<strong class="lk iu">N \ { I }</strong>’表示不包括玩家‘I’的玩家集合。因此，这里的“S”包括可以从“N \ { 1 }”中的玩家中得到的所有子集。对于每个S，'<strong class="lk iu"> |S|' </strong>表示每个子集中玩家的数量。</p><p id="2c7e" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于S中的每个子集，'<strong class="lk iu"> |S|！'</strong>表示排列的数目，可以从S中的玩家中创建。<strong class="lk iu"> (n-|S|-1) </strong>表示除玩家I之外的剩余玩家的数目。<strong class="lk iu"> (n-|S|-1)！</strong>’代表除了玩家I之外的剩余玩家可以形成的排列总数</p><p id="85e8" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于S中的每个子集，<strong class="lk iu"> |S|的乘积！</strong>和<strong class="lk iu"> (n-|S|-1)！</strong>代表S和S之外的玩家可以形成的排列总数，使用这个乘法是因为对于这些(|S|！*(n-|S|-1)！)组合数参与人‘I’的边际贡献保持不变。</p><p id="24e2" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">注意:公式考虑了排列，因为玩家的顺序在这里起着重要的作用。这里的事件不是独立的；因此，shapely值计算考虑了所有可能的排列，然后最终取平均值来计算每个玩家的贡献。</em></p><p id="79d6" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">喏，<strong class="lk iu"> n！</strong>显示<strong class="lk iu"> </strong>游戏中所有玩家的所有组合所能形成的排列总数，它用于计算可能形成联盟的不同排列的平均贡献。</p><p id="e4b2" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">这个公式乍一看似乎有点令人生畏，但是一旦我们借助一个例子来理解它，它就会变得非常容易理解。在下一节中，我们将通过一个示例计算来培养直觉。</strong></p><p id="596a" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">注意:特性函数应满足某些最低属性:</em></p><ol class=""><li id="fd21" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md nh ni nj nk bi translated"><em class="nl">单调性:如果联盟中玩家数量增加，收益应该不会减少。</em></li><li id="c907" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><em class="nl">超可加性:ν(S ∪ T) ≥ ν(S)+ν(T)，若ν(s∪t)=∅；这意味着大联盟的收益最高。</em></li></ol></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="c649" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">匀称的价值观:直觉与实例</h1><p id="382d" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">为了进一步简化和更好地理解shapely价值观，我们举一个非常简单的例子，一个虚构的新零售店，它只通过电视广告、平面广告和广播广告进行营销。这些营销媒介的结合有助于零售店获得顾客并产生收入。</p><p id="fd99" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">零售店的老板观察到这些营销媒体的组合为商店带来了更高的收入，但是<em class="nl">问题在于通过每种营销媒体获得的收入份额的归属</em>。这些信息非常重要，因为拥有者可以利用这些信息优化营销预算。</p><p id="117e" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个问题(或游戏)可以借助shapely价值观来解决。为了推进这个过程，让我们看看“表A”的内容，并在上面的shapely值的定义和游戏的实际数据之间画出一些平行关系。</p><p id="c14d" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">“表A”中的第一列显示了联盟(<strong class="lk iu"> S，如上面定义</strong>中所表示的)，其可以使用游戏的参与者(参与者是电视、广播、印刷品)来形成，包括空集(其中没有参与者)。第二列显示对应于第一列中每个联盟的符号。第三列(<strong class="lk iu"> ν(S)或定义</strong>中的“联盟价值”)显示了与第一列中给出的每个子集/联盟相对应的收入。</p><p id="f72f" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">换句话说，当只显示电视广告时，商店获得3000美元的收入，当只显示广播广告时，收入为1000美元，类似地，当只显示印刷广告时，收入为1000美元。然而，当广播或印刷与电视结合时，收入是其个人贡献总和的两倍，当三者结合时，收入为10，000美元。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi op"><img src="../Images/c97a943415a532ac1ec02e8c055ccfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T02nSSCDjoRup5Pb3h4BKw.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">表A:显示了联盟和联盟的价值。</strong>来源:作者图片</p></figure><p id="7c08" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将使用“表A”中给出的信息，并使用这些值得出每台电视、收音机和印刷品的shapely值(平均边际贡献)。</p><p id="4c40" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下表B显示了电视、广播和印刷品的shapely值的计算。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oq"><img src="../Images/e78e79014399bf3697ebaeb1a354ed83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U18CKk3eFImk2e8P6-YiUw.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">表B:显示每种营销媒体的平均边际贡献或匀称价值的计算</strong>。来源:作者图片</p></figure><p id="f30c" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看看“表B”中给出的电视shapely值的计算方法。第一栏显示不包括电视的联盟。所以有<strong class="lk iu"> 2 </strong>这样的组合包括一个空集<strong class="lk iu"> {} </strong>。第二列显示没有电视的收入，即<strong class="lk iu"> v(S) </strong>或没有电视的联盟对子集的价值。</p><p id="8121" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第三列示出了包括电视和在表格中表示为'<strong class="lk iu">S ∨{ I }</strong>'的联盟。第四列显示包括电视在内的联盟收入或价值。第五列显示添加电视后的收入变化或电视的边际贡献，表示为“<strong class="lk iu">v(S ∨{ I })-v(S)</strong>”。第六列显示玩家总数(<strong class="lk iu"> n </strong>)。</p><p id="bced" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第七列显示了每个子集 <strong class="lk iu"> S </strong>中的<strong class="lk iu">玩家数量。第八列是对于S中子集的边际贡献的出现的可能排列总数<strong class="lk iu">以及进一步除以<strong class="lk iu"> n！对该贡献进行平均。最后一栏是电视机的平均边际贡献总和(6000美元)。</strong></strong></strong></p><p id="ae8e" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">类似地，也计算了印刷品(2000美元)和广播(2000美元)的平均边际贡献或合理价值。我希望表A和表B以及它们的计算有助于发展对匀称的价值观的基本理解和直觉。</p><p id="ee57" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对shapely值的基本理解和直觉很重要，因为本文的下一部分是关于使用shapely值的机器学习可解释性。我们将讨论并了解这些匀称的值如何被用于机器学习，特别是在媒体混合建模中。</p><p id="c6c7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> <em class="nl">注1: </em> </strong> <em class="nl">定义联盟的特征功能或“价值”是一个关键步骤，应极其谨慎。在现实世界中，它的定义严重依赖于数据收集的方法。如果您有兴趣阅读在线广告活动归因模型中如何定义特征函数，请参考本文</em><a class="ae lf" href="https://arxiv.org/ftp/arxiv/papers/1804/1804.05327.pdf" rel="noopener ugc nofollow" target="_blank"><em class="nl"/></a><em class="nl">。</em></p><p id="520d" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> <em class="nl">注2: </em> </strong> <em class="nl"> Shapely值保证解中的唯一性。Shapley值是唯一满足属性</em> <strong class="lk iu"> <em class="nl">效率</em></strong><em class="nl"/><strong class="lk iu"><em class="nl">对称性</em></strong><em class="nl"/><strong class="lk iu"><em class="nl">哑元</em> </strong> <em class="nl">和</em><strong class="lk iu"><em class="nl"/></strong><em class="nl">的归属方法，这些属性合起来可以认为是一个公平支付的定义。</em> <a class="ae lf" href="https://christophm.github.io/interpretable-ml-book/shapley.html" rel="noopener ugc nofollow" target="_blank"> <em class="nl">【出处】</em> </a></p><p id="0175" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">效率:所有玩家的Shapley值之和等于大联盟的值，这样所有的收益都在玩家之间分配。</em></p><p id="07c1" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对称:如果两个玩家对所有可能的联盟贡献相等，那么他们的贡献应该是相同的。</p><p id="8965" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">哑元:如果玩家I没有给任何联盟增加价值，那么玩家I将获得零的有形价值，或者换句话说，获得零奖励。</p><p id="1f3a" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">可加性:设‘a’是来自游戏‘x’的shapely值，‘b’是来自游戏‘y’的shapely值。那么游戏‘x+y’的shapely值就是‘a+b’。</em></p><p id="a409" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">关于公理的更多细节，</em> <a class="ae lf" href="https://christophm.github.io/interpretable-ml-book/shapley.html" rel="noopener ugc nofollow" target="_blank"> <em class="nl">参见本书的这一节。</em>T59】</a></p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="b067" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">使用Shapely值的机器学习可解释性</h1><p id="ac2f" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">现在，既然我们对shapely值有了基本的了解，那么接下来我们应该讨论如何在机器学习解释中使用shapely值，然后我们将讨论它在营销分析中的效用。</p><p id="f610" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看看合作/联盟博弈论中的shapely值计算和它在机器学习中的使用之间的并行性。</p><blockquote class="oh oi oj"><p id="1f22" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated"><em class="it">在机器学习模型的情况下，用作生成机器学习模型的数据的特征值的每个实例充当团队成员，并且机器学习模型的预测充当输出或回报。</em></p></blockquote><p id="7893" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了更直观地理解它，让我们假设我们已经训练了一个机器学习模型，以根据在不同营销渠道上的花费来预测收入。在数据集中，我们有一个数据实例，其中电视等营销渠道的支出为2000美元，广播支出为500美元，印刷支出为800美元。该数据实例的收入预测值为10万美元；然而，来自所有数据实例的收入的平均预测值是$80k(基础值)。<em class="nl">鉴于这种情况，我们想了解并解释电视、广播和印刷品是如何造成基础价值(8万美元)和预测价值(10万美元)之间的差异的</em>。因此，在本例中，电视、广播和印刷品的实例值(支出)充当玩家，任何实例的预测收入充当产出或回报。在这种情况下，每个频道的归属收入可能类似于电视的归属收入为1万美元，而广播的归属收入为6000美元，印刷品的归属收入为4000美元。因此，每个营销渠道的这些归属值有助于我们了解不同营销渠道的支出如何影响我们的增量收入。</p><blockquote class="oh oi oj"><p id="5b9d" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated">在上面的例子中，有两件事情是并行发生的:首先，我们使用了一些机器学习算法进行预测，其次，我们使用shapely值来理解数据行/实例的特征行为。因此，对于最准确的预测，我们可以使用任何黑盒复杂模型，同时我们可以使用非常简单的可解释/可解释的shapely值来解释特征行为。这种结合解决了复杂模型的可解释性/可解释性的主要问题。</p></blockquote><p id="fc53" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们对shapely值如何适应复杂模型的可解释性有了更高层次的理解。因此，现在是时候更深入地研究和理解shapely值的算法实现了。</p><h2 id="5b28" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">得体的附加解释(SHAP)</h2><blockquote class="oh oi oj"><p id="f6fa" class="li lj nl lk b ll lm ju ln lo lp jx lq ok ls lt lu ol lw lx ly om ma mb mc md im bi translated">SHAP(SHapley Additive explaints)是一种解释任何机器学习模型输出的博弈论方法。它将最优信用分配与使用博弈论及其相关扩展的经典Shapley值的本地解释联系起来。<a class="ae lf" href="https://shap.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">【来源】</a></p></blockquote><p id="cfba" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">SHAP是一个解释者模型，它有优化的功能，可以借助shapely值来解释任何黑盒模型。为了理解SHAP，我们首先需要知道解释者模型的概念，然后我们将看到这个解释者模型如何适应任何黑盒模型的可解释性。</p><h2 id="cadc" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">解释者模型</h2><p id="726e" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">对于复杂的黑盒模型(如集成模型或深度学习模型)，我们使用不同的模型来解释复杂的模型。这样的模型被称为<strong class="lk iu">解释者模型</strong>，它是原始模型的一个可解释的近似。解释者模型是一个简单的线性加性归因模型，作用于二元变量。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi or"><img src="../Images/f0ffd65eeb0d10e9c0f97ac2a4690b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*kGpfAY56vGu0rch_vJLZUA.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">讲解器型号</strong></p></figure><p id="7b19" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，g(z′)是一个解释函数。∅o是基础值，它代表所有输入关闭时的模型输出。∅i是要素I的shapely值。z’要么为零(要素不存在时)，要么为一(要素存在时)。m是简化输入特征的数量。</p><p id="7b3e" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还应该注意到，g(z′)的值与原始模型f(x)的输出相匹配，它也被称为<strong class="lk iu">局部精度</strong>。局部精度也是一个方法获得唯一解所需的三个属性之一。另外两个属性是<strong class="lk iu">缺失和一致性</strong>。这三个属性保证了博弈论中Shapley值的唯一性，因为它们适用于机器学习模型预测的局部解释。要了解更多关于这些属性的信息，请阅读<a class="ae lf" href="https://papers.nips.cc/paper/7062-a-unified-approach-to-interpreting-model-predictions.pdf" rel="noopener ugc nofollow" target="_blank">这篇文章。</a></p><p id="16b3" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为简单起见，让我们假设我们有一个数据集，其中有3个特征电视、广播、印刷作为预测变量，收入作为目标变量。我们有100行/实例的数据，对于每一行/实例，我们将计算g(z′)。</p><p id="4bed" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于特征变量(电视、收音机、印刷品)的任何数据实例“j”:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi os"><img src="../Images/5cc90d7fdd930c062ad9f3856f5baee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*ILXEyUxM-JWHQe_bfd-WaA.png"/></div></div></figure><p id="cc30" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">g(z′)等于特征值实例的模型预测值。对于电视、广播、印刷品，z’的值是1，因为它们有一些实例值。如果有这样一个例子，电视花费了$x_tv，广播花费了$x_radio，但是印刷品没有花费，那么在这种情况下我们的g(z′)将如下。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/12655dd394aef5e4d3aa982ce4bf0321.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*4Tg_EAoMBATdIt_PfsEjgA.png"/></div></figure><p id="ece4" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于解释器模型在实例或行级别的特征数据上工作，因此它也被称为预测的<strong class="lk iu">局部解释</strong>。这个解释模型以shapely值的形式直接测量局部特征重要性(<em class="nl">也称为</em> <strong class="lk iu"> <em class="nl"> SHAP值</em> </strong> <em class="nl">用于局部特征归属</em>)。当我们组合每个预测的局部解释时，我们得到了全局解释的全局模型结构。</p><p id="7d86" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将讨论局部和全局解释，当我们以python为例讨论SHAP库的用法时，这将变得更加清晰。</p><p id="7308" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">这个解释器模型如何与黑盒模型一起工作？</strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ou"><img src="../Images/bd290d43bd0242a51a581f94898abe2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niJ3PYNIAi7Q78JA7y_s6Q.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">流程图显示解释器模型将数据和预测值作为输入，并基于shapely值创建解释。</strong>资料来源——瑞典PyCon:用拉维·辛格的SHAP解释ML模型</p></figure><p id="468d" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个流程图让我们很好地了解了解释器模型如何与黑盒模型协同工作。</p><p id="0de8" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">利用数据，我们训练黑盒模型，然后将训练好模型与数据一起传递给解释器模型。</p><p id="9fe8" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该黑盒模型然后被用作预测函数，并且连同特征值一起，该函数被用于计算每个特征的特征重要性(SHAP值)。SHAP值是使用下述公式计算的，该公式与shapely值计算公式非常相似。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ov"><img src="../Images/473c842fe0d4392f410e4952eeeea2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l8glTd4KrD4NC_JR4PILzA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">计算特征I的SHAP值的公式，例如x。</strong>来源:ML解释能力的SHAP值- Adi Watzman</p></figure><p id="61b4" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在正在计算∅i，它是特征I在预测中的贡献，它分三步计算，如下所示。</p><ol class=""><li id="3b46" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md nh ni nj nk bi translated">首先，我们创建没有特征i (表示为<strong class="lk iu"> S </strong>)的所有特征的<em class="nl">子集，然后针对S中的每个子集，计算具有(<strong class="lk iu"> f(S U {i}) </strong>)和没有(<strong class="lk iu"> f(S) </strong>)特征I的预测值</em></li><li id="2dea" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">其次，我们减去两个预测(<strong class="lk iu"> f(S U {i})-f(S) </strong>)，以获得该特征对于每个子集的边际贡献。</li><li id="9681" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">最后，我们<strong class="lk iu">取上一步计算的所有边际贡献的平均值</strong>来得到特征I对预测的贡献。</li></ol><p id="e1a1" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上述SHAP值的计算与合作游戏的shapely值的计算非常相似。这里唯一的区别是特征函数被黑盒模型代替，这里我们计算的是特征I对预测的贡献，而不是对游戏的贡献。</p><p id="918e" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦我们获得了所有特征实例的所有SHAP值，那么这些SHAP值将用于解释模型的局部和全局。</p><p id="b909" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要获得关于SHAP价值观的详细信息，请阅读《SHAP价值观》作者斯科特·M·伦德伯格的论文。</p><p id="6495" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在下一节中，我们将看到如何局部和全局地解释模型，以获得可操作的见解。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="7fea" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">SHAP价值观:营销分析中的一个用例</h1><p id="0e75" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">了解了SHAP值后，现在让我们看看如何将它应用到一些营销数据集中。</p><p id="beb7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的数据集包括电视广告支出、广播广告支出、报纸广告支出等特征，我们的目标变量是每周产生的销售收入。</p><p id="7d87" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以假设这些数据是从营销组合的时间序列数据中创建的横截面数据。尽管这些数据与真实世界的营销组合数据集相差甚远，但即使如此，它也将为我们提供一个很好的想法，即当我们使用它进行营销组合建模时，SHAP值如何帮助我们获得可操作的见解。</p><h2 id="e66b" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">导入库并读取数据集。</h2><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/53b061dc1f671a257f4347f971d468ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*gnx-QfwOSFNhi2fAn9UYeA.png"/></div></figure><p id="1218" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个数据集可以在<a class="ae lf" href="https://www.kaggle.com/sazid28/advertising.csv" rel="noopener ugc nofollow" target="_blank"> Kaggle上找到。</a>我对该数据集所做的唯一更改是将“销售”列乘以100。以便它看起来更接近产生销售收入。</p><p id="fbcd" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我没有关于这个数据集的太多细节，我只是用它来展示SHAP值在营销数据集中的应用。</p><h2 id="eafa" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">创建训练测试分割，拟合随机森林回归方程，预测并检查误差。</h2><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><h2 id="57aa" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated"><strong class="ak">创建解释器模型，然后从shapely值创建一个数据框架</strong></h2><p id="f15a" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">有几种方法可以让我们使用python中的<strong class="lk iu"> shap库</strong>创建解释器模型。我们有形状。<strong class="lk iu"> KernelExplainer </strong>，它是模型不可知的，可以用来解释任何机器学习模型。我们也有shap。<strong class="lk iu"> TreeExplainer </strong>，针对基于树的机器学习模型进行了优化。在我们的例子中，我们使用随机森林算法，这是一个基于树的模型，所以我们将使用TreeExplainer。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="b38f" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们仔细看看SHAP价值数据框架。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oz"><img src="../Images/16daf29e591a290c6e782442bc86872a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmvuNG0elrMRegz-SvscRg.png"/></div></div></figure><p id="f912" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以从上面的数据帧中清楚地看到，对应于测试或训练数据帧中的每个特征值，我们在测试和训练数据集的shap数据帧(df_shap_train，df_shap_test)中有一个shap值。因此，我们可以看到，对于每个要素的每个数据实例，我们都有一个SHAP值。</p><h2 id="398c" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">检查基础值</h2><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/3f4714be29a0ae4b84020500a6440885.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*9Vak0JLn_wVHdKGtjPOdZg.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">来源:作者图片</p></figure><p id="1f9b" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们在上面讨论解释者模型时，我们已经讨论了基本值。这个∅o是基础值。</p><p id="5a18" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">注意:TreeExplainer的基值是训练数据集上模型输出的平均值。</em> <a class="ae lf" href="http://24.&#9;https://github.com/slundberg/shap/issues/352" rel="noopener ugc nofollow" target="_blank"> <em class="nl">【源* *】</em></a></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/4e16df2c932d61903b6936c0df458d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*SzIneWbH_jB0NAQWWHB1lA.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">基本值</strong></p></figure><p id="8e37" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">方法“base”为我们提供了每个数据实例的数组列表。每个数组的前3个元素包含要素的SHAP值，第4个值是基值。在我们的例子中，基础值是1429.31875。</p><p id="327d" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">基础值+ SHAP值=预测值</strong></p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="39dd" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们比较(基础值+ SHAP值)和预测值的值。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/4b842b0e5ae1769cea7f62214ce9e70b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*AiZDDaZkTNqgWjQMxaP9_Q.png"/></div></figure><p id="a02c" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从该数据框中，我们可以很容易地看到，每个实例的要素的基础值+ SHAP值等于预测值。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/3fb82c3f758322c1a3daeb1baedec769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*OlaD0ceqF2xIbNx2RVDIGA.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">我们在讨论解释者模型的时候讨论过这个关系。因此，对于数据帧的每一行，我们可以看到这种关系是如何成立的。</strong></p></figure><h2 id="087d" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated">模型解释</h2><p id="a730" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated"><strong class="lk iu">汇总图</strong></p><p id="8c62" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">汇总图旨在从全局层面解释模型。汇总图有两种类型:第一种显示所有要素的所有SHAP值，第二种显示所有要素的聚合值(绝对SHAP值的平均值)。我们会看到这些情节，然后讨论如何解读。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="dd17" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">训练数据的汇总图:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pe"><img src="../Images/a453eec74372b3eeeb0590f131ae65f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jORdnyb7SIQAUEHh03NTfQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">显示特征平均绝对SHAP值的汇总图</strong></p></figure><p id="82ed" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上图显示了对应于每个要素的SHAP值的汇总视图。它显示了特性的重要性。上面的情节是不言自明的，我不认为它需要任何详细的解释；但是，下面的情节解读起来很有趣。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lg"><img src="../Images/88a15c2e61f526e1a687529b8914b990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjLt-ngYl24y2dacPQfB2Q.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">显示每个特征的所有SHAP值的汇总图</strong></p></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pf"><img src="../Images/d6a2a61636319bb29119b164b50188f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*smRgNImvXJHQAUwBXCktsA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">显示每个特征的所有SHAP值的汇总图</strong></p></figure><p id="dc94" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">显示所有SHAP值的汇总图的组成部分:</strong>在<strong class="lk iu"> Y轴上</strong>我们可以看到电视、广播、报纸。<strong class="lk iu"> X轴</strong>显示SHAP值的范围。每个特征对应的<strong class="lk iu">个体点</strong>就是训练数据集中所有实例的SHAP值。右侧的<strong class="lk iu">垂直色阶</strong>显示特征值是偏高还是偏低。此外，要注意的是，<strong class="lk iu">特征以特征的聚合<strong class="lk iu">平均绝对SHAP值</strong>的降序排列。</strong></p><p id="054e" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">释义:</strong></p><p id="a1e3" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">哪个功能的影响最大？</strong>由于TV具有最高的平均绝对SHAP值，因此它对模型输出的影响最大。在我们的例子中，模型输出是销售收入。因此，<strong class="lk iu">电视对销售收入的影响最大。同样，我们也可以说收音机和报纸。因为收音机一直排在第二位，所以它对销售收入的影响第二大。</strong></p><p id="fce3" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">营销渠道的支出对销售收入有何影响？</strong>要回答这个问题，看一下分配给每个特征实例的SHAP值的颜色。对于电视来说，剧情右手边(正面)的大部分点都是红色的。这意味着<strong class="lk iu">更高的电视广告支出会带来更高的SHAP价值</strong>或增量销售收入。曲线图还显示，对于较低的电视广告支出(蓝色)，我们有负的SHAP值。负SHAP值表明我们在电视广告上的低支出甚至不能产生与其在该渠道上的支出相等的销售收入。同样，我们可以解释其他渠道的影响。<strong class="lk iu">报纸对销售收入的影响不显著</strong>，这一点从汇总图中可以明显看出。</p><p id="d2e1" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">依赖图(无交互作用):</strong></p><p id="72cf" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">我的电视广告和广播广告支出的市场反应如何？</strong>要回答这个问题，我们可以画出单个特征与其SHAP值之间的关系图。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pg"><img src="../Images/6faa0a54fbec34d1173bfdbbffd5e439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_GCGnwFNfh5CkCehjDieQ.png"/></div></div></figure><p id="576a" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">广告支出和SHAP价值之间的关系是市场对广告支出反应的一个很好的指标。从上面的图中可以明显看出，随着我们增加电视广告支出，我们的SHAP价值增加，在特定的电视广告支出后，它开始变得停滞不前。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pf"><img src="../Images/449353b7661440f51ceb567f073264ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssFG2f0AoTFYKJ9rN27iQg.png"/></div></div></figure><p id="45fd" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样，我们可以为广播广告绘制图表，观察到随着广播广告支出的增加，SHAP值也在增加。因为我们的计划中没有任何停滞点，所以我们需要继续增加广播广告的支出，直到我们到达任何停滞点。</p><p id="ffea" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">电视广告的正面影响阈值是多少？</strong>为了回答这个问题，我们将使用电视广告和SHAP值之间相同的相关性图，并查看Y轴上SHAP值为零的地方。对应于该点，我们将在X轴上得到一个点，该点是电视广告支出的阈值，从该点开始，电视广告开始对销售收入产生积极影响。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/ee5aa005ec068a50968988b0fe90aa48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*bwa19fs54urV1ow0WKJC6w.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">电视广告的正面影响阈值。</strong>来源:作者图片</p></figure><p id="f444" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">类似地，我们可以计算收音机的阈值。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/68c4f5e9bd7c860385e7ae8a42103f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*0bUK8ewbcN-2RVbOQ94ANw.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">广播广告的正面影响阈值</strong>。来源:作者图片</p></figure><h2 id="d24a" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv mw bi translated"><strong class="ak">交互概要图:</strong></h2><p id="4f6b" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">这个图非常重要，它在一个视图中给出了不同频道之间的交互。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pj"><img src="../Images/dbdc066e400d3f3c732ab8c170cdfe9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVhp6JzrPUegE8QFI7nUDQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">互动总结</strong>。来源:作者图片</p></figure><p id="eb05" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的图显示了交互总结。我们可以看到对角线外的相互作用。我已经用红圈标出了可能的相互作用。我们在这里能看到的唯一重要的互动是电视广告和广播广告之间的互动。</p><p id="f828" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">既然我们现在知道电视广告和广播广告之间的互动是显著的，那么另一个问题应该是了解它们互动的本质。</p><p id="f31b" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">依赖图(有交互作用):</strong></p><p id="305f" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">电视和广播之间互动的本质是什么？</strong>为了回答这个问题，我们将再次绘制一个依赖图，但这一次是通过交互作用。这是最有趣的情节之一，也有点难以理解。我们先把这个画出来，然后一步一步地去解读它。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pk"><img src="../Images/666af3f9b0ab6967de743953cd2ead8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fUzSjFsFcOHwReEXIROGvA.png"/></div></div></figure><p id="f02f" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">每个点代表对应于特定电视广告支出实例的SHAP值。y轴是SHAP价值观，X轴是电视广告支出。颜色基于每个实例的广播广告支出。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/ce3ad1b21f114f5ccc5b9ca93f4dffb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*2nkhBSpaXSxvdsmyQ7NFYw.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">对于低于150英镑和高于150英镑的电视广告支出，电视和广播的互动性质正好相反。</strong>来源:作者图片</p></figure><p id="72a7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了理解这个情节，让我们看看150到300之间的电视广告花费窗口。在电视广告花费窗口中，SHAP值范围从较高到较低的SHAP值(0到600)。在该窗口中，我们假设电视广告支出约为220美元(显示为带黑边的矩形框)，对于该特定支出，我们有不同的SHAP值，但较高的SHAP值也与较高的广播支出相关联。这意味着该窗口的广播广告支出和电视广告支出之间存在积极的互动关系(电视广告支出为150-300英镑)。</p><p id="18c7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一方面，在0到150的电视广告花费之间的电视广告花费窗口中存在负交互作用。</p><p id="95b7" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，我们已经完成了对SHAP价值观的全球解读，但现在我们将看到对SHAP价值观的一些本地解读。可以使用力图进行局部解释。</p><p id="c2b9" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">局部解释力图:</strong></p><p id="2a23" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">局部解释是指实例级别的解释。我们的实例级别是周的粒度。因此，如果我们想解释营销渠道对特定一周的影响，那么我们应该使用这个图。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pm"><img src="../Images/76f62d84334889d5323a0c55dad6edd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTyqEm0fgO7_8D5P3N3V6A.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lh">为数据实例强制绘图</strong></p></figure><p id="1ed2" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上图中，我们可以看到蓝色条和红色条显示了电视、广播和报纸的SHAP值。条形的长度代表SHAP值的大小。条形的颜色显示SHAP值的方向(正或负)。正的SHAP值为红色，负的为蓝色。预测值以黑色粗体显示。基准值也已经在线图上标出。每个渠道的实例价值或广告花费价值也会显示出来。我们可以将这些值与上一节中计算的值进行比较，如下所示。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/6a839c86b31fadfb163961189affb288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*N5fIEl_TGzKHT2ufDdY2mw.png"/></div></figure><p id="f625" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">TV SHAP值是负的，并且条的长度在负方向上最长，显示-563.6值。广播和报纸是积极的，但非常小，震级分别为164.7和25.96。由于电视、广播和报纸的SHAP值之和为负，所以一旦将其加到基值上，我们就得到了预测值，在这种情况下，预测值低于基值。总之，本周业绩不佳的主要原因是电视广告支出低。</p><p id="72fc" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，到目前为止，我们已经看到了如何在SHAP的帮助下，有效地解释任何黑盒模型。还有许多其他变量，如价格、地区、季节性、趋势、广告库存、市场饱和度等；这可以通过一些特征工程包含在营销数据中。即使有这些额外的变量和更多，我们现在可以使用最准确的模型和SHAP来整体地解释它们，并获得大规模的可操作的见解。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="3aaa" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">结束注释</h1><p id="798c" class="pw-post-body-paragraph li lj it lk b ll mx ju ln lo my jx lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">在这篇文章中，我们主要关注属性和媒体混合建模；然而，XAI在营销和客户分析的其他领域也有巨大的应用，如流失预测、客户保持和决策支持。例如，在客户流失预测的情况下，XAI(本文中讨论的本地解释)可以帮助我们解释特定客户流失的原因或特定客户流失概率高的原因。根据这一解释，我们可以为特定客户量身定制保留策略。此外，XAI还通过比较业务领域知识和模型行为来帮助我们调试模型。因此，总而言之，XAI有可能成为分析行业的游戏规则改变者。</p><p id="ca33" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我希望在读完这篇文章后，你对合作博弈理论中的价值以及它在营销分析中的高层次应用有一点了解。</p><p id="8178" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请随时发表评论，提出修改建议，并在评论区分享您的观点。</p></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="484b" class="ns mf it bd mg nt nu nv mj nw nx ny mm jz nz ka mp kc oa kd ms kf ob kg mv oc bi translated">进一步阅读和参考</h1><ol class=""><li id="7d62" class="nc nd it lk b ll mx lo my lr od lv oe lz of md nh ni nj nk bi translated"><a class="ae lf" href="https://www.nature.com/articles/s42256-019-0138-9.epdf" rel="noopener ugc nofollow" target="_blank">https://www.nature.com/articles/s42256-019-0138-9.epdf</a></li><li id="d1b8" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://papers.nips.cc/paper/7062-a-unified-approach-to-interpreting-model-predictions.pdf" rel="noopener ugc nofollow" target="_blank">https://papers . nips . cc/paper/7062-a-unified-approach-to-interpretation-model-predictions . pdf</a></li><li id="d214" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://econpapers.repec.org/paper/urvwpaper/2072_2f290758.htm" rel="noopener ugc nofollow" target="_blank">归因模型和合作博弈理论</a></li><li id="3e93" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://github.com/slundberg/shap" rel="noopener ugc nofollow" target="_blank">https://github.com/slundberg/shap</a></li><li id="f382" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://www.h2o.ai/blog/the-benefits-of-budget-allocation-with-ai-driven-marketing-mix-models/" rel="noopener ugc nofollow" target="_blank">https://www . H2O . ai/blog/the-benefits-of-budget-allocation-with-ai-driven-marketing-mix-models/</a></li><li id="3382" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://youtu.be/B-c8tIgchu0" rel="noopener ugc nofollow" target="_blank">用于科学和医学的可解释人工智能</a></li><li id="89a4" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated">https://edden-gerber.github.io/shapley-part-1/<a class="ae lf" href="https://edden-gerber.github.io/shapley-part-1/" rel="noopener ugc nofollow" target="_blank"/></li><li id="d509" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://christophm.github.io/interpretable-ml-book/shapley.html" rel="noopener ugc nofollow" target="_blank">https://christophm . github . io/interpretable-ml-book/Shapley . html</a></li><li id="a81d" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://shap.readthedocs.io/en/latest/examples.html#tree-explainer" rel="noopener ugc nofollow" target="_blank">https://shap . readthe docs . io/en/latest/examples . html # tree-explainer</a></li><li id="9f6c" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://github.com/slundberg/shap/issues/352" rel="noopener ugc nofollow" target="_blank">https://github.com/slundberg/shap/issues/352</a>* *</li><li id="33c0" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://youtu.be/0yXtdkIL3Xk" rel="noopener ugc nofollow" target="_blank">PyData Tel Aviv Meetup:ML可解释性的SHAP值— Adi Watzman </a></li><li id="34ac" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://youtu.be/Wl9L592ycc4" rel="noopener ugc nofollow" target="_blank">瑞典PyCon:理解ML黑箱:使用SHAP解释ML模型</a></li><li id="bdf8" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" href="https://medium.com/@gabrieltseng/interpreting-complex-models-with-shap-values-1c187db6ec83" rel="noopener">https://medium . com/@ Gabriel Tseng/interpreting-complex-models-with-shap-values-1c 187 db 6 EC 83</a></li><li id="2b54" class="nc nd it lk b ll nn lo no lr np lv nq lz nr md nh ni nj nk bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/explain-your-model-with-the-shap-values-bc36aac4de3d">https://towards data science . com/explain-your-model-with-the-shap-values-BC 36 AAC 4 de 3d</a></li></ol></div></div>    
</body>
</html>