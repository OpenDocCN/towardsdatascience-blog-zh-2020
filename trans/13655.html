<html>
<head>
<title>Pandas Beyond Numbers: Working with Textual Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数字之外的熊猫:使用文本数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-beyond-numbers-working-with-textual-data-19cf353b23a5?source=collection_archive---------23-----------------------#2020-09-19">https://towardsdatascience.com/pandas-beyond-numbers-working-with-textual-data-19cf353b23a5?source=collection_archive---------23-----------------------#2020-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d5ce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">举例说明。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f885fd478a9ebd2f17023c2408afc6fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OdxJdQYGBfK9hcLiAUn9mQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@aaronburden?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Aaron Burden </a>在<a class="ae ky" href="https://unsplash.com/s/photos/write?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="b42e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是使用最广泛的Python数据分析和操作库。由于数据并不总是以清晰的数字表示，数据分析库应该能够处理任何格式的数据。熊猫做到了，而且做得很好。</p><p id="cc3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将探索熊猫的文本数据(如字符串)的能力。让我们从文本数据的数据类型开始。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="69e5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">对象与字符串</h1><p id="7469" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在pandas 1.0之前，只有“object”数据类型用于存储字符串，这导致了一些缺点，因为非字符串数据也可以使用“object”数据类型来存储。例如，具有对象数据类型的列可以包含数字、文本、日期和列表，这对于数据分析来说不是最佳方式。</p><p id="d91e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 1.0引入了一种新的特定于字符串数据的数据类型，即<strong class="lb iu">string type</strong>。到目前为止，我们仍然可以使用object或string type来存储字符串，但是在将来，我们可能会被要求只使用string type。</p><p id="5e03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，“object”仍然是存储字符串的默认数据类型。为了使用StringDtype，我们需要显式地声明它。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8876" class="ne md it na b gy nf ng l nh ni">import pandas as pd</span><span id="c5b7" class="ne md it na b gy nj ng l nh ni">pd.Series(['aaa','bbb','ccc']).dtype<br/>dtype('O')</span><span id="4c9c" class="ne md it na b gy nj ng l nh ni">pd.Series(['aaa','bbb','ccc'], dtype='string').dtype<br/>StringDtype</span><span id="9180" class="ne md it na b gy nj ng l nh ni">pd.Series(['aaa','bbb','ccc'], dtype=pd.StringDtype()).dtype<br/>StringDtype</span></pre><p id="7145" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果“<strong class="lb iu">字符串</strong>或<strong class="lb iu"> pd，则使用StringDtype。string type()</strong>作为参数传递给Dtype参数。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="7acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要文本数据来处理。我会先从熊猫的<a class="ae ky" href="https://en.wikipedia.org/wiki/Pandas_(software)" rel="noopener ugc nofollow" target="_blank">维基百科</a>页面获取一段，并存储在一个列表中。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="39e1" class="ne md it na b gy nf ng l nh ni">text = ["Developer Wes McKinney started working on pandas in 2008 while at AQR Capital Management out of the need for a high performance, flexible tool to perform quantitative analysis on financial data. Before leaving AQR he was able to convince management to allow him to open source the library."]</span></pre><p id="9833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文本是只有一项的列表。我将把它转换成一个熊猫系列，将每个单词作为一个单独的项目。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="eafd" class="ne md it na b gy nf ng l nh ni">A = pd.Series(text).str.split().explode().reset_index(drop=True)</span><span id="6d07" class="ne md it na b gy nj ng l nh ni">A[:5]<br/>0    Developer <br/>1          Wes <br/>2     McKinney <br/>3      started <br/>4      working <br/>dtype: object</span></pre><p id="e3ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Str是访问字符串操作的属性。顾名思义，Split根据指定的字符(默认为空格)拆分数据。然后，我们使用explode函数将每个分离的单词作为系列中的一个新项目。</p><p id="ebf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们不重置索引，由于explode函数的性质，序列A中的所有项目的索引都将为0。值得一提的是，还有其他方法来创建一个文字系列，这是关于熊猫的一件好事。它几乎总是提供多种方法来完成一项任务。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="7ae7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些单词以大写字母开头，这在数据分析中是不可取的。我们希望尽可能有一个标准。我们可以将它们全部转换成大写或小写字母。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="df8c" class="ne md it na b gy nf ng l nh ni">A.str.upper()[0]<br/>'DEVELOPER'</span><span id="42dc" class="ne md it na b gy nj ng l nh ni">A.str.lower()[0]<br/>'developer'</span></pre><p id="0719" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有项目都已转换，但我们只访问了第一个项目。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">len函数返回对象的长度。如果是列表，len返回列表中的项数。如果len与str属性一起使用，它将返回每个字符串的长度。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fb66" class="ne md it na b gy nf ng l nh ni">A.str.len()[:5]<br/>0    9 <br/>1    3 <br/>2    8 <br/>3    7 <br/>4    7</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="40a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想将此系列中的所有字符串组合回其原始格式，您可能会使用的函数是<strong class="lb iu"> cat </strong>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a6d8" class="ne md it na b gy nf ng l nh ni">A.str.cat(sep=" ")</span><span id="3914" class="ne md it na b gy nj ng l nh ni">developer wes mckinney started working on pandas in 2008 while at aqr capital management out of the need for a high performance, flexible tool to perform quantitative analysis on financial data. before leaving aqr he was able to convince management to allow him to open source the library.</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="e5a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字符串操作提供了很大的灵活性。例如，我们不仅可以用其他字符串替换一个字符串，还可以替换一个字符串的一部分(即按字符)。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2f1f" class="ne md it na b gy nf ng l nh ni">A.str.replace('the', 'not-a-word')[-3:]<br/>45        source <br/>46    not-a-word <br/>47      library.</span><span id="19ed" class="ne md it na b gy nj ng l nh ni">A.str.replace('deve', ' ')[:3]<br/>0       loper <br/>1         wes <br/>2    mckinney</span></pre><p id="aa5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">str访问器提供对字符串字符的索引。例如，我们只能得到前3个字符。如果在一个字符串的末尾或开头有一些多余的字符，这就很方便了。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7f49" class="ne md it na b gy nf ng l nh ni">first_three = A.str[:3]</span><span id="9748" class="ne md it na b gy nj ng l nh ni">first_three[:2]<br/>0    dev <br/>1    wes</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="9a24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫字符串方法也兼容<strong class="lb iu">正则表达式</strong> (regex)。正则表达式的整个范围太详细了，但是我们将做几个简单的例子。假设我们有包含一个字母和一个数字的字符串，那么模式就是字母-数字。我们可以用这个模式提取部分字符串。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="501d" class="ne md it na b gy nf ng l nh ni">B = pd.Series(['a1','b4','c3','d4','e3'])</span><span id="9d11" class="ne md it na b gy nj ng l nh ni">B.str.extract(r'([a-z])([0-9])')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/d431387fca366079e6213c417bf59ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*KuRLFMDu5ua7CMUAn84QeQ.png"/></div></figure><p id="3afc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可能还想检查是否所有的字符串都有相同的模式。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e9ef" class="ne md it na b gy nf ng l nh ni">C = pd.Series(['a1','4b','c3','d4','e3'])</span><span id="8fb7" class="ne md it na b gy nj ng l nh ni">C.str.contains(r'[a-z][0-9]')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/5f4fe013e329b3b26293f431a0a8d5fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*L-t5MwNU4PSH8v3Hc2IjEQ.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="2e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以计算字符串中特定字符的数量。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b588" class="ne md it na b gy nf ng l nh ni">B = pd.Series(['aa','ab','a','aaa','aaac'])</span><span id="f934" class="ne md it na b gy nj ng l nh ni">B.str.count('a')<br/>0    2 <br/>1    1 <br/>2    1 <br/>3    3 <br/>4    3</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="f569" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，我们可能需要根据条件过滤字符串。例如，startswith和endswith函数可以与str属性一起使用。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="682e" class="ne md it na b gy nf ng l nh ni">B = pd.Series(['aa','ba','ad'])</span><span id="8503" class="ne md it na b gy nj ng l nh ni">B.str.startswith('a')<br/>0     True <br/>1    False <br/>2     True</span><span id="bd97" class="ne md it na b gy nj ng l nh ni">B.str.endswith('d')<br/>0    False <br/>1    False <br/>2     True</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="656f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些机器学习算法需要对分类变量进行编码。str属性支持get_dummies函数。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="056b" class="ne md it na b gy nf ng l nh ni">cities = ['New York', 'Rome', 'Madrid', 'Istanbul', 'Rome']</span><span id="cba7" class="ne md it na b gy nj ng l nh ni">pd.Series(cities).str.get_dummies()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/3d08f9e66ae6f9c2a6706cd4359339d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*BmmK8Xushneim6MgQfu0Lw.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1637" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas字符串操作并不局限于我们在这里讨论的内容，但是我们讨论的函数和方法肯定会有助于处理字符串数据并加快数据清理和准备过程。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="91c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>