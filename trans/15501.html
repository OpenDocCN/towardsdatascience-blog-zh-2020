<html>
<head>
<title>Fixing data files — adding a missing date column</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修复数据文件-添加缺失的日期列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fixing-data-files-adding-a-missing-date-column-dc42d7106325?source=collection_archive---------26-----------------------#2020-10-25">https://towardsdatascience.com/fixing-data-files-adding-a-missing-date-column-dc42d7106325?source=collection_archive---------26-----------------------#2020-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0023" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用python在4个快速步骤中为多个文件添加日期？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f5b167102f8cd94655a33341ebb87f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SP09eLe4w5szvMEnXaIkhA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=318359" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的<a class="ae ky" href="https://pixabay.com/users/hans-2/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=318359" rel="noopener ugc nofollow" target="_blank">汉斯·布拉克斯米尔</a>拍摄</p></figure><p id="5517" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有一整个文件夹的文件准备分析。仔细看，你会发现每个文件名都有日期，但记录上没有相应的日期。要将数据加载到数据框或表中，您需要一些日期或时间戳来维护记录的顺序。内心深处，你在呻吟。怎么办？</p><p id="bc39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用python读入文件，并根据文件名日期添加一个新列。</p><h2 id="8b17" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">方案</h2><p id="559f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您需要创建2020年10月第一周糖果销售的可视化。</p><p id="fc34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些文件是每天创建的，包含不同的糖果和销售量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/b46f31ba5999439b90062d880ebaf127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEx1Uqc9YtB-w5b7NioALA.png"/></div></div></figure><p id="6f9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些文件位于一个文件夹中。文件名因销售日期而异。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/e345aeb353d5c2e904491b7533c90c34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3m8LmbGNFea2X3aeVDzQTw.png"/></div></div></figure><h2 id="85a8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">解决办法</h2><p id="fabf" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果缺少日期列，将日期列添加到所有文件的4个步骤</p><ol class=""><li id="e4af" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">使用前面我为<a class="ae ky" rel="noopener" target="_blank" href="/using-data-science-skills-now-text-scraping-8847ca4825fd">文本抓取任务</a>使用的python glob，我创建了一个文件夹中所有文件的列表。</li><li id="e374" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">遍历文件列表。从文件名中获取日期。</li><li id="1955" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">接下来，打开文件并将其读入数据框。添加(或更新，如果已经存在)日期列。</li><li id="ce8d" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">将更新的数据写回文件。</li></ol><p id="6071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行这个简单的脚本后，文件现已更新:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/cc7e2ba0c75bcb7a27be3164b8b32aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*czL8qJdCoGWaMbgDNxlW8Q.png"/></div></figure><p id="1c1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，将这些文件放入一个文件中变得容易多了。我也在剧本中加入了这一点。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="4f69" class="lv lw it nl b gy np nq l nr ns"># import required packages<br/>import pandas as pd<br/>import glob<br/>import os<br/>import re<br/>import sys</span><span id="0bab" class="lv lw it nl b gy nt nq l nr ns"># where is your folder?</span><span id="fe65" class="lv lw it nl b gy nt nq l nr ns">folderPath  = '&lt;path to your top folder&gt;'</span><span id="7b25" class="lv lw it nl b gy nt nq l nr ns"># Find the candy sales files<br/>files = glob.glob(folderPath + '/**/*candy_sales*',recursive=True)</span><span id="b80a" class="lv lw it nl b gy nt nq l nr ns">viz_df = pd.DataFrame()</span><span id="24c0" class="lv lw it nl b gy nt nq l nr ns">"""Loop through all the files , remove punctuationn, split each line into elements and match the elements to the list of words"""<br/>for file in files:<br/>    basic_file_name = file.replace(folderPath,'')<br/>    <br/>    basic_file_date = basic_file_name[14:22]<br/>    <br/>    # yyyy-mm-dd<br/>    #file_date = str(basic_file_name[14:18]) + '-' + str(basic_file_name[18:20])  + '-' + str(basic_file_name[20:22])<br/>   <br/>    # mm/dd/yyyy<br/>    file_date = str(basic_file_name[18:20])  + '-' + str(basic_file_name[20:22]) + '-' + str(basic_file_name[14:18])</span><span id="a502" class="lv lw it nl b gy nt nq l nr ns">df = pd.DataFrame()<br/>    df = pd.read_excel(file, header=0)<br/>   <br/>    df['date'] = file_date</span><span id="2a09" class="lv lw it nl b gy nt nq l nr ns">df.to_excel(file, header=True, index=False)<br/>            <br/>print('Done updating files')</span><span id="f01f" class="lv lw it nl b gy nt nq l nr ns"># Create a viz file<br/>for file in files:<br/>    df = pd.DataFrame()<br/>    df = pd.read_excel(file, header=0)<br/>    viz_df = viz_df.append(df)<br/>        <br/>viz_df.to_excel(folderPath + '/viz_file.xlsx', header=True, index=False)<br/>print('Done printing viz file')</span></pre><p id="413b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你有了最终的文件，把它放到一个Viz工具中——比如Tableau Public。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/0a4e6d4a8dd803b866e27b37eb2c2592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-wqqvEBVaMQ2h_RbUbO4A.png"/></div></div></figure><h2 id="4d9b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="beb8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在短短几分钟内，您已经从一堆无用的无日期记录变成了一个带有时间戳的行文件，以备分析。</p></div></div>    
</body>
</html>