<html>
<head>
<title>PyQGIS — Join Table — International visitors in Natural Protected Areas in Ecuador</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyQGIS连接表-厄瓜多尔自然保护区的国际游客</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pyqgis-join-table-international-visitors-in-natural-protected-areas-in-ecuador-7deb7ed8d868?source=collection_archive---------41-----------------------#2020-09-22">https://towardsdatascience.com/pyqgis-join-table-international-visitors-in-natural-protected-areas-in-ecuador-7deb7ed8d868?source=collection_archive---------41-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b7aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在PyQGIS 3.10中使用连接表创建choropleth地图</h2></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><p id="1274" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">PyQGIS为管理GIS过程中的自动化提供了一个很好的解决方案。厄瓜多尔国家保护区系统(SNAP)以电子表格形式获取国际游客的<a class="ae ll" href="http://areasprotegidas.ambiente.gob.ec/reporte-de-visitas#" rel="noopener ugc nofollow" target="_blank">信息，但不一定是地图。因此，如果需要地图，可以使用一个python/PyQGIS脚本来创建地图，该脚本可以输出适当的图层，包括受保护区域的游客数量。此处</a>可在厄瓜多<a class="ae ll" href="http://ide.ambiente.gob.ec/mapainteractivo/" rel="noopener ugc nofollow" target="_blank">环境信息地理门户下载快照图层。</a></p><p id="6963" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在这篇文章/教程中，我将向你展示如何在Qgis 3.10中将<strong class="kr iu">连接表</strong>自动化为Shapefile。这个脚本最好的一点是，它通过<strong class="kr iu"> QInputDialog() </strong>与用户(在本例中是您)进行交互，因此您必须使用的输入只是您的数据的URL。</p><p id="3172" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">所以，我们来看看这个剧本的产物。如上所述，该脚本生成了一个<em class="lm">新图层</em>，其中包含添加到<strong class="kr iu"> <em class="lm">自然保护区</em> </strong>的shapefile中的<strong class="kr iu"> <em class="lm">游客数量</em> </strong>的附加信息。如果你不熟悉<em class="lm">加入</em>，看看这里的<a class="ae ll" href="https://www.qgistutorials.com/en/docs/performing_table_joins.html" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/37e050f488fc32e7b2383d490876d5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQjwkkA6hPTv2k9D3Zdzpg.jpeg"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片由作者提供，choropleth地图包含国际游客数量的相关信息</p></figure><p id="7ac0" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">首先，您必须在Qgis中打开python控制台并打开编辑器。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi md"><img src="../Images/bbe286760eec6c443e314aa0c411c18d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdZfeiiolmCDbFgeQ7IOHQ.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片由作者提供，Python控制台，编辑器窗口“无标题-0”位于右侧</p></figure><p id="011d" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我们的第一个任务是打开shapefile，并在Qgis中打开表。在本教程中，您唯一需要做的就是复制和编辑数据的URL。我的例子的URL如下:<strong class="kr iu"><em class="lm">C:\ Desktop \ Pyqgis \ data \ natural _ areas . shp</em></strong></p><p id="38c6" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">首先，将下面的代码复制并粘贴到python编辑器中，然后运行。然后，您将看到一个新的对话窗口打开。</p><pre class="lo lp lq lr gt me mf mg mh aw mi bi"><span id="40fa" class="mj mk it mf b gy ml mm l mn mo">#Dialog <br/>qid1 = QInputDialog()<br/>title = ‘Write the URL’<br/>label = ‘Shapefile url: ‘<br/>mode = QLineEdit.Normal<br/>default = ‘&lt;shp url here&gt;’<br/>snapUrl, ok = QInputDialog.getText(qid1, title, label,mode, default)</span><span id="e819" class="mj mk it mf b gy mp mm l mn mo">#Adding Layer <br/>snap_layer = iface.addVectorLayer(snapUrl,’Natural Areas’,’ogr’)</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/37c6f04d652920063c7fe0d9a53b7a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*CMVsjcz9JA26Wx-kiDaCsQ.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片作者，输入框添加您的shapefile的URL</p></figure><p id="a01a" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">然后，您将看到shapefile如何像图层一样添加到内容列表中。添加shapefile时，您只需注意正确书写您计算机的URL，包括扩展名<strong class="kr iu"> shp </strong>。<br/> ( <em class="lm">例如\…\…\areas.shp </em>)</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mr"><img src="../Images/db0991b5b35a3e789cd90c55e2722b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_uMBBx7TAEaRXsFvC5u8JA.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">作者的图片，屏幕上的shapefile。</p></figure><p id="9672" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如您所见，您正在与python控制台进行交互。基本上就是在问你开什么，你在回复一个网址。下一步是执行相同的过程，但是包括显示的表格，在本例中是<strong class="kr iu"> <em class="lm">。csv </em> </strong>，要与<strong class="kr iu"><em class="lm">Natural areas . shp .</em></strong>进行连接记住，要正确处理连接表，两边需要有相似的属性。在这种情况下，shapefile和表都有一个包含自然区域代码的列。<br/>按照下面的代码打开表格。</p><pre class="lo lp lq lr gt me mf mg mh aw mi bi"><span id="db5c" class="mj mk it mf b gy ml mm l mn mo">#Dialog CSV june<br/>qid2 = QInputDialog()<br/>title = ‘url of table’<br/>label = ‘csv url: ‘<br/>mode = QLineEdit.Normal<br/>default = ‘&lt;csv url here&gt;’<br/>juncsvUrl, ok = QInputDialog.getText(qid2, title, label,mode, default)</span><span id="8ddb" class="mj mk it mf b gy mp mm l mn mo">#Adding csv june</span><span id="d5c6" class="mj mk it mf b gy mp mm l mn mo">urljun = r’file:\\’+juncsvUrl+’?delimiter={}’.format(“,”)<br/>juncsv = QgsVectorLayer(urljun, “June 2019”, “delimitedtext”)<br/>iface.addVectorLayer(juncsvUrl, “June visitors”, “ogr”)</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/bec367f143df74f1787f139760480b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*JHCmZHWjrNjWJkMOoAdDOg.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片作者，输入收件箱添加您的CSV表的网址</p></figure><p id="932a" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">然后，您将看到该表被添加到屏幕上。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mt"><img src="../Images/8beb5832574ab462e80ed28500169f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZc-M10HhfpSTNodZF6uEA.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片由作者提供，屏幕上的CSV表。</p></figure><p id="23e2" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">目前，我们已经获得了<em class="lm">连接表</em>所需的数据。现在我们运行下面的代码来处理连接。你会看到一个新的消息框打开，要求一个网址，你必须写下你要保存新层的文件夹的网址。不要忘记包括扩展名。例如:①..\…\join.shp )。</p><blockquote class="mu mv mw"><p id="0c46" class="kp kq lm kr b ks kt ju ku kv kw jx kx mx kz la lb my ld le lf mz lh li lj lk im bi translated">如果你用的是自己的数据。请注意，在行<strong class="kr iu">字段</strong>中必须包含shapefile的列名，在<strong class="kr iu">字段2 </strong>中必须包含CSV表的列名。</p></blockquote><pre class="lo lp lq lr gt me mf mg mh aw mi bi"><span id="f923" class="mj mk it mf b gy ml mm l mn mo">#Dialog JOIN <br/>qid4 = QInputDialog()<br/>title = ‘Output layer of Join’<br/>label = ‘url + \name.shp: ‘<br/>mode = QLineEdit.Normal<br/>default = ‘&lt;new layer url here&gt;’<br/>out, ok = QInputDialog.getText(qid4, title, label,mode, default)</span><span id="fe03" class="mj mk it mf b gy mp mm l mn mo">#Join Table June<br/>processing.run(“native:joinattributestable”, \<br/>{‘INPUT’:snapUrl,\<br/>‘FIELD’:’csnap’,\<br/>‘INPUT_2’:juncsvUrl,\<br/>‘FIELD_2’:’codt_snap’,\<br/>‘FIELDS_TO_COPY’:[],\<br/>‘METHOD’:1,\<br/>‘DISCARD_NONMATCHING’:True,\<br/>‘PREFIX’:’’,\<br/>‘OUTPUT’: out,})</span><span id="5c48" class="mj mk it mf b gy mp mm l mn mo">jun_visitors = iface.addVectorLayer(out,’Visitors in June 2019',’ogr’)</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5c17b17565053277ae29f5b9bf5f59ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*jhlUjFz8D8ED6s_rwH-lZw.png"/></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">作者的图像，新图层URL的消息框。</p></figure><p id="4a3f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">最后，您会看到新层被添加。包含访问者数量的那个。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nb"><img src="../Images/aa33ed7a7473e850c5e754fa8e03abfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u8L-kMGX-pgIeyiZHWqNww.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图像由作者创建，屏幕上的新图层包含表中的数据。</p></figure><p id="025e" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">这是您应该知道的关于将表连接到shapefiles的全部内容。您可以轻松地重写代码，并使其与您自己的数据一起工作。本教程是我关于PyQGIS的一个简短课程的一部分。如果您对更大的项目有任何疑问，请访问我的<a class="ae ll" href="https://www.linkedin.com/in/bryanrvallejo/" rel="noopener ugc nofollow" target="_blank">个人资料</a>。</p></div></div>    
</body>
</html>