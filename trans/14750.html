<html>
<head>
<title>Predicting vehicle accident severity using ensemble classifiers and AutoML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于集成分类器和自动建模的车辆事故严重度预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-vehicle-accident-severity-using-ensemble-classifiers-and-automl-17ced9495932?source=collection_archive---------26-----------------------#2020-10-11">https://towardsdatascience.com/predicting-vehicle-accident-severity-using-ensemble-classifiers-and-automl-17ced9495932?source=collection_archive---------26-----------------------#2020-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="38ef" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Coursera上IBM数据科学认证的顶点项目摘要</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3bfdee8622506ddbaa31e5d7e204cc91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rfBjpERIK0g9pzNQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马修·T·雷德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b76f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">简介/商务问题</strong></p><p id="66c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章详细介绍了使用西雅图市交通局登记的车辆事故公开数据集的工作。这项工作通过识别导致各种类型交通事故的因素，预测事故严重程度，并利用这些信息将风险降至最低，从而使美国公众受益。</p><p id="e8f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的代码可以在我的GitHub <a class="ae kv" href="https://github.com/Ranga2904/Coursera_Capstone/blob/master/Ranga_Coursera_Capstone.ipynb" rel="noopener ugc nofollow" target="_blank"> repo </a>找到</p><p id="d12a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">目标</strong></p><p id="a38f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用包括汽车和人的数量、交通、天气状况等特征，预测事故的严重程度为“1”或“2”。这是一个分类问题，一旦建模，西雅图市当局就可以获得以前无法获得的事故风险因素的洞察力，也让作者获得必要的完成以获得Coursera专业认证。</p><p id="b434" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">使用的数据和采取的步骤</strong></p><p id="84bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所用的原始数据由西雅图交通部提供，采用了以下步骤:</p><p id="7c1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤1: </strong>数据加载和初步观察</p><p id="c602" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第二步:</strong>特征可视化详细分析。目标是理解潜在的利用输入变量</p><p id="dfca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤3: </strong>特征工程和选择</p><p id="f6e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第四步</strong>:模型拟合和训练</p><p id="2541" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤5 </strong>:模型评估，使用自动机器学习(也称为AutoML)进行灵敏度检查</p><p id="1530" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤6 </strong>:为客户总结外卖</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="31d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第1步和第2步:</strong>此处一并考虑。使用Seaborn可视化工具加载和分析交通数据，我们的目标是了解数据分布、属性和预测车辆事故严重程度的意义。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/96485ac7c75e8852db75121b658e682d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nbpNZg1f2RbMJqh62JDfA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图1:。describe()命令应用于数据集</p></figure><p id="c544" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Seaborn可视化是无信息的，可以在<a class="ae kv" href="https://github.com/Ranga2904/Coursera_Capstone/blob/master/Ranga_Coursera_Capstone.ipynb" rel="noopener ugc nofollow" target="_blank"> repo </a>上找到——它们没有在这里发表，因为这篇文章没有附加价值。因此，我分析了数据和一些解释性的西雅图点文献来破译特征。</p><p id="b79a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我学到了什么？</p><p id="db23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">许多特征是交通部使用的唯一标识符，并在<strong class="ky ir">预测</strong>事故时提供。这些包括事故钥匙、十字路口钥匙、碰撞细节钥匙、分隔车道钥匙和人行横道钥匙。</p><p id="9e04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ObjectID的独特之处在于，虽然它也是一个由点提供的分类器，但它不会复制在另一个特性中显式可用的信息。</p><p id="246f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多特征是二进制的和非数字的，即可以通过简单的是或否来回答。这些特征包括检查是否:超速是一个因素，行人有通行权，注意力不集中或酒后驾车是促成因素，或一辆停放的汽车被撞。</p><p id="0e87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，还有其他非数字特征，它们有两个以上的可能条目。这些因素包括照明和路况、发生事故的路口类型以及事故发生的日期/时间。出于本文的目的，我将时间归类为非数字，因为它是每个Python的一个<em class="ma">日期时间</em>对象。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="dbb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第三步:</strong>当考虑包括/排除什么以及可能需要什么类型的特征工程时，上面指定的列表要求一种系统的方法。我们希望确保包含有影响的因素，而不增加导致过度拟合的不必要的复杂性</p><p id="803d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哪种方法保留了最有用的信息，并删除了增加复杂性的不必要的功能？</p><p id="c106" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们首先删除作为西雅图点管理工具的特性。这些包括<strong class="ky ir">报告号</strong>、<strong class="ky ir">事件键</strong>、<strong class="ky ir">交叉键</strong>和<strong class="ky ir">状态</strong>。我们也删除“EXCEPTRSNCODE”和“EXCEPTRSNDESC”列，在这些列中删除有条目的行，这些条目的存在只是为了通知读者某个事件缺少足够的信息。</p><p id="898c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们也去掉坐标x和y，因为它们以一两个特定区域为中心，并被认为没有预测洞察力。</p><p id="7fe1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">任何非数字特征都需要编码来转换成机器学习算法可以处理的数字。编码可以是顺序的，也可以是一次性的:我选择了后者，因为这些变量都没有我想要保留的固有顺序。受此方法影响的要素包括地址类型、道路和照明条件、停放的汽车是否被撞、碰撞键、天气和交叉口类型。</p><p id="0306" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我使用事件日期和时间提取月份和时间。时间被转换为早上、中午或晚上，随后，这个细节被一次性编码。我认为这是有意义的，因为在深夜/清晨或者季节变化使得道路更难行驶时，驾驶事故会增加</p><p id="cd5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们继续进行模型评估之前，让我们看看上面的步骤是如何改变我们数据集中的一些关键特征的。以下是之前的快照:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mb"><img src="../Images/82e59ebc315172763789e61da01aedcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QXh8s5YjWN_UMoEm-TG53Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2:显示分类、连续、字母和数字数据的原始数据集快照</p></figure><p id="3c11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是数据集的快照，在此摘录中，我们看到地址类型被编码为超速和行人是否有通行权。这是训练数据，之前已经完成了训练-测试-分割:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/f33cb2f744f62b84f4f80634d5d1ea31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4KBoS0ymqLrPVA1o4xMwVQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3:带编码的原始数据快照</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="a10e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">模型拟合和训练</strong></p><p id="fd2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成必要的特征工程和选择后，我选择了一系列分类器——包括用于基线的虚拟分类器，训练它们，并使用许多指标评估它们在测试集上的性能。代码片段如下。</p><pre class="kg kh ki kj gt md me mf mg aw mh bi"><span id="daa4" class="mi mj iq me b gy mk ml l mm mn">dum = DummyClassifier()<br/>xgb = XGBClassifier()<br/>dt = DecisionTreeClassifier()<br/>gbc = GradientBoostingClassifier()<br/>rfc = RandomForestClassifier()</span><span id="ee84" class="mi mj iq me b gy mo ml l mm mn">clfs = [dum,xgb,dt,gbc,rfc]<br/>f1_Scores = []<br/>jaccard_Scores = []<br/>log_loss_Scores = []</span><span id="bf59" class="mi mj iq me b gy mo ml l mm mn">for clf in clfs:<br/>    clf.fit(x_train,y_train)<br/>    ypred = clf.predict(x_test)<br/>    ypred_proba = clf.predict_proba(x_test)<br/>    f1score = f1_score(y_test,ypred)<br/>    logloss = log_loss(y_test,ypred_proba)<br/>    jaccard = jaccard_score(y_test,ypred)<br/>    f1_Scores.append(f1score)<br/>    jaccard_Scores.append(jaccard)<br/>    log_loss_Scores.append(logloss)</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="0999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第五步</strong>:我在下面的Excel表格中总结了模型性能。最佳实践建议使用多个指标来评估性能:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/53f1e4b0692ffddc25e601d8b3487190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dT12mvXvFdxmZDbq-nxxA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4；绩效总结</p></figure><p id="ebe7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上表显示了80年代中期的F1分数和低于0.5的对数损失分数，这是对虚拟分类器基线性能的改进。我们将在结论中讨论上述指标对我们客户的影响，但我想先谈谈另外两个话题:</p><ul class=""><li id="f07d" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">XGBoost上的GridSearchCV在上述分数上没有提供任何改进</li><li id="587e" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我用了TPOT的AutoML软件包。请参见下面的代码片段，了解由此产生的性能:</li></ul><pre class="kg kh ki kj gt md me mf mg aw mh bi"><span id="65c6" class="mi mj iq me b gy mk ml l mm mn">%pip install tpot --user</span><span id="c3ed" class="mi mj iq me b gy mo ml l mm mn">import tpot<br/>from tpot import TPOTClassifier</span><span id="efed" class="mi mj iq me b gy mo ml l mm mn"># define model evaluation<br/>cv = RepeatedStratifiedKFold(n_splits=10, n_repeats=3, random_state=1)<br/># define search<br/>model = TPOTClassifier(generations=5, population_size=50, cv=cv, scoring='f1', verbosity=2, random_state=1, n_jobs=-1)<br/># perform the search<br/>model.fit(x_train,y_train)<br/># export the best model<br/>model.export('tpot_capstone_best_model.py')</span></pre><p id="2629" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后将导出的模型重新引入数据集中进行训练，并在测试集上进行评估。正如在下面的代码片段中观察到的，TPOT选择对性能最高的49%的特性使用决策树分类器，结果F1值为0.84，logloss值为0.5。<strong class="ky ir"> AutoML更快，但是没有返回比传统方法更有希望的结果。</strong></p><pre class="kg kh ki kj gt md me mf mg aw mh bi"><span id="b84e" class="mi mj iq me b gy mk ml l mm mn">from sklearn.pipeline import make_pipeline<br/>from tpot.export_utils import set_param_recursive<br/>from sklearn.feature_selection import SelectPercentile, f_classif</span><span id="5fc1" class="mi mj iq me b gy mo ml l mm mn">exported_pipeline = make_pipeline(<br/>    SelectPercentile(score_func=f_classif, percentile=49),<br/>    DecisionTreeClassifier(criterion="entropy", max_depth=6, min_samples_leaf=19, min_samples_split=7)<br/>)<br/># Fix random state for all the steps in exported pipeline<br/>set_param_recursive(exported_pipeline.steps, 'random_state', 1)</span><span id="7358" class="mi mj iq me b gy mo ml l mm mn">exported_pipeline.fit(x_train, y_train)<br/>tpot_y_pred = exported_pipeline.predict(x_test)<br/>tpot_y_pred_prob = exported_pipeline.predict_proba(x_test)</span><span id="b64e" class="mi mj iq me b gy mo ml l mm mn">f1score = f1_score(y_test,tpot_y_pred)<br/>logloss = log_loss(y_test,tpot_y_pred_prob)<br/>jaccard = jaccard_score(y_test,tpot_y_pred)</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="ffb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第六步:我们可以给我们的客户——西雅图交通部——一个模型，展示在识别什么会导致特别严重的事故以及什么不会导致特别严重的事故方面的表现。</p><p id="88c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的模型比盲目猜测要好，因为log_loss分数0.47比基于类分布的“哑分数”0.59要好。它不仅能够准确地预测严重性，而且能够区分不同的类别——通过超过基准执行者(虚拟分类器)的高F1分数来衡量。</p><p id="d59b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">西雅图交通部的见解:</p><ul class=""><li id="6bb0" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">在预测事故严重程度时，一年中的月份是第二个最有影响力的变量。某些月份天气状况不佳，司机注意力不集中，这是有道理的。<strong class="ky ir">西雅图市应该考虑安全计划，在一年中有问题的时候加大交通事故预防力度</strong></li><li id="3036" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">事故中涉及的人员和车辆数量对严重程度有影响。<strong class="ky ir">西雅图市应考虑在一个月或一天的特定时间限制乘客乘车，以最大限度地降低风险。</strong></li><li id="04af" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">车道钥匙和人行横道钥匙代表事件发生的区域——了解这些特定区域意味着<strong class="ky ir">城市可以安装更多的摄像头和更多的标志，以阻止这些特定十字路口的鲁莽行为。</strong></li><li id="6164" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">注意力不集中的影响明显不如以上这些，但城市仍然可以影响它。<strong class="ky ir">西雅图市应该考虑增加对分心驾驶的罚款，并张贴更多的公益广告来阻止这种行为。</strong></li><li id="7582" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">碰撞的类型对预测严重程度影响最大。这并不奇怪，但这本身并不可行</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="4fd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一如既往，我欢迎想法、建议和反馈。</p></div></div>    
</body>
</html>