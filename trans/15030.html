<html>
<head>
<title>Histogram Matching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">直方图匹配</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/histogram-matching-ee3a67b4cbc1?source=collection_archive---------2-----------------------#2020-10-16">https://towardsdatascience.com/histogram-matching-ee3a67b4cbc1?source=collection_archive---------2-----------------------#2020-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="09bf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何为一幅图像生成直方图，如何均衡化直方图，最后如何修改你的图像直方图，使其与另一幅直方图相似。</h2></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="24b3" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这里的代码可以在<a class="ae li" href="https://github.com/aliprf/CV-HistogramMatching" rel="noopener ugc nofollow" target="_blank"> <strong class="ko ir"> Github </strong> </a>上找到。</p><p id="d987" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">如果你喜欢这个帖子，请<strong class="ko ir">鼓掌</strong>。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h2 id="be6c" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kv ls lt lu kz lv lw lx ld ly lz ma mb bi translated">什么是图像直方图？</h2><p id="4192" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv me kx ky kz mf lb lc ld mg lf lg lh ij bi translated">在开始定义直方图之前，为了简单起见，我们使用灰度图像。然后，我解释了彩色图像的过程。</p><p id="f5e7" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">图像直方图表示图像的强度分布。换句话说，图像直方图显示了图像中具有特定强度值的像素数量。例如，假设像素强度从0到255变化的正常图像。为了生成直方图，我们只需要计算亮度值为0的像素的数量，然后是1，直到255。在图1中，我们有一个样本5*5的图像，像素差异从0到4。在生成直方图的第一步中，我们通过计算每个像素强度的数量来创建直方图表格。然后，我们可以通过基于直方图表创建条形图来轻松生成直方图。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/f6ef2f8d34cc9f88e4105f36c132f652.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*6j0SnETZhsWQDhrNVnyUWg.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="bd mt">图1 </strong>:生成图像直方图的过程</p></figure><h2 id="6ff7" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kv ls lt lu kz lv lw lx ld ly lz ma mb bi translated">如何生成图像直方图？</h2><p id="7369" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv me kx ky kz mf lb lc ld mg lf lg lh ij bi translated">在python中，我们可以使用以下两个函数来创建并显示图像的直方图。</p><figure class="mi mj mk ml gt mm"><div class="bz fp l di"><div class="mu mv l"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="ak">代码1 </strong>:生成直方图</p></figure><p id="0af6" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">大多数情况下，当我们创建直方图时，我们通过将每个亮度值的像素数除以归一化因子来归一化直方图，归一化因子是图像宽度和图像高度的乘积。为了便于使用，如果generate_histogram函数的输入图像是一幅彩色图像，我们首先转换成一幅灰度图像(见第6行)。</p><h2 id="21d1" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kv ls lt lu kz lv lw lx ld ly lz ma mb bi translated">如何均衡一个图像直方图？</h2><p id="8980" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv me kx ky kz mf lb lc ld mg lf lg lh ij bi translated">直方图均衡化通常用于增强图像的对比度。因此，这种技术不能保证总是提高图像质量。计算CDF(累积分布函数)是均衡图像直方图的常用方法。在图2中，我们已经计算了我们在图1中创建的样本图像的CDF。此外，在图3中，我们显示了先前样本的均衡直方图。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/df0b8227937a031b4fc89729f0090776.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*9ggWFSfndPjGR0ZvpyQMLg.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="bd mt">图2: </strong>计算CDF。</p></figure><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/18469a69e9d93612d6bd606d5571fd24.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*-BatxG3iJYny8C__lW2W1w.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="bd mt">图3: </strong>均衡直方图。</p></figure><p id="374b" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">为了用python计算均衡直方图，我创建了以下代码:</p><figure class="mi mj mk ml gt mm"><div class="bz fp l di"><div class="mu mv l"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="ak">代码2: </strong>均衡直方图</p></figure><p id="f2a5" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这是我拍摄的三张不同的照片，作为例子。如图4所示，对于第一幅图像，直方图显示低强度像素的数量多于较亮像素。第二幅图像的情况完全相反，较亮像素的密度比较暗像素的密度大得多。第三个图像似乎有一个半正态直方图。</p><div class="mi mj mk ml gt ab cb"><figure class="my mm mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/aa7dd0993db010a1b09cd2b4829fc97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*UwhrSg6bqo6_Tyvkqfy0aw.jpeg"/></div></figure><figure class="my mm ni na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/c19ddd7e4c539a49922e138787ba917f.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*ZMQqp0f23PhjJiBDFJzDcA.png"/></div></figure><figure class="my mm ni na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/d9fcefc165dc0f10b4d8792f20f8387b.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*Lwa9bcxaLf8zUnUkyq0xVA.png"/></div></figure></div><div class="ab cb"><figure class="my mm nj na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/342e8b99ecfafcf4f083f006c1469d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*cbgEHnGOojOY3leGrGRq1Q.jpeg"/></div></figure><figure class="my mm nk na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/c44ff07ed4a718e158365c5adff63ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*v-hL3voou5nV8w7yqT_Fkg.png"/></div></figure><figure class="my mm nk na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/e306a835b27bd47f0c41d35a5af3596d.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*_aXGckqLXUf4X4k_D3QTzw.png"/></div></figure></div><div class="ab cb"><figure class="my mm nl na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/a1ae5e5b72f70cffa221675df94ca0e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*viAG1o-BgIiTONVav0likA.jpeg"/></div></figure><figure class="my mm nm na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/6dc190cf75b7d388d1ed677217b7c7bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*v_h6VOh9MH8GFstR3VnWpw.png"/></div></figure><figure class="my mm nm na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/4b15c4bf904a5adde184f48d0b531005.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*mXikHg3uyZ8ya_yQC17iGw.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk nn di no np translated"><strong class="bd mt">图4 </strong>:三种不同类型的图像及其直方图以及均衡直方图。</p></figure></div><h2 id="c624" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kv ls lt lu kz lv lw lx ld ly lz ma mb bi translated">使用均衡直方图增强图像</h2><p id="2742" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv me kx ky kz mf lb lc ld mg lf lg lh ij bi translated">如上所述，我们可以使用图像的均衡直方图来修改图像的对比度。如Code.2第12行所示，对于输入图像中的每个像素，我们可以使用其均衡值。结果可能比原始图像更好，但不能保证。在图5中，我们描绘了3个图像的修改版本。如图所示，使用图像的均衡直方图修改图像会产生具有更高对比度的图像。这一特性在许多计算机视觉任务中非常有用。</p><div class="mi mj mk ml gt ab cb"><figure class="my mm nq na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/2cff6d2680266cb9df4ba27411484637.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*UwhrSg6bqo6_Tyvkqfy0aw.jpeg"/></div></figure><figure class="my mm nr na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/42fb2cdb7cc92a2bfac29a821c328d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*e-h-19MM0e8qT4bhlIbXIw.png"/></div></figure><figure class="my mm ns na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/c674fb7d8b77e7f7e9220d63e84ae257.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*RzC1bGdl6lmO-h05QVrONQ.png"/></div></figure></div><div class="ab cb"><figure class="my mm nt na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/5ad407f486871b22c2110620fa466816.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*cbgEHnGOojOY3leGrGRq1Q.jpeg"/></div></figure><figure class="my mm nu na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/f8950ff0611a63c58cf1e123c15c5099.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*IBiWnFzTeobQO2Pgo9KpxA.png"/></div></figure><figure class="my mm nv na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/9381bf434d4f41f2417ca28507600ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*EKGGZH7HLkESS1ZFTsoOpw.png"/></div></figure></div><div class="ab cb"><figure class="my mm nw na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/7cbe78f75fde9cb03a336f742447fa18.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*viAG1o-BgIiTONVav0likA.jpeg"/></div></figure><figure class="my mm nx na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/1056bf0da75ddea7b8c909a729d5f5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*t3J_oaW6POrgMrAafE1UQw.png"/></div></figure><figure class="my mm ny na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/a31e895d8f8647724f2e318831dc816e.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*BsYfu72jsnqgHpZvZpx2Vw.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk nz di oa np translated"><strong class="bd mt">图5: </strong>使用均衡直方图的对比度修改。最左边一列是原始图像。中间的列是对比度修改的结果。最右边的列是修改图像的直方图。</p></figure></div><h2 id="9c01" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kv ls lt lu kz lv lw lx ld ly lz ma mb bi translated">什么是直方图匹配？</h2><p id="415f" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv me kx ky kz mf lb lc ld mg lf lg lh ij bi translated">假设我们有两幅图像，每幅图像都有其特定的直方图。所以我们想在更进一步之前回答这个问题，<em class="ob">有没有可能根据一个图像的对比度来修改另一个图像</em>？答案是肯定的。事实上，这就是直方图匹配的定义。换句话说，给定图像A和B，可以根据B修改A的对比度级别。</p><p id="06de" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">当我们想要统一一组图像的对比度时，直方图匹配是有用的。事实上，直方图均衡化也可以看作是直方图匹配，因为我们将输入图像的直方图修改为类似于正态分布。</p><p id="7da4" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">为了匹配图像A和B的直方图，我们需要首先均衡两个图像的直方图。然后，我们需要使用均衡直方图将A的每个像素映射到B。然后我们基于b修改A的每个像素。</p><p id="e8ec" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">让我们用图6中的例子来阐明上面的段落</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/40f91276bb73f2faf2e0e0b73f4e1309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*2dr6lEj1nAo8R1JRBmO1sw.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="bd mt">图6: </strong>直方图匹配</p></figure><p id="3d03" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在图6中，我们将图像A作为输入图像，将图像B作为目标图像。我们希望根据b的分布修改A的直方图。在第一步中，我们计算A和b的直方图和均衡直方图。然后，我们需要根据均衡直方图的值将A的每个像素映射到b的值。因此，例如，对于A中亮度级别为<em class="ob"> 0 </em>的像素，均衡直方图的对应值为<em class="ob"> 4。</em>现在我们看一下B均衡直方图，找到4对应的强度值，也就是0。因此，我们将A的<em class="ob"> 0 </em>强度映射到B的<em class="ob"> 0 </em>强度。我们继续对A的所有强度值进行映射。如果A到B的均衡直方图中没有映射，我们只需选取最接近的值。</p><p id="3fe8" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我也用Python实现了上述过程</p><figure class="mi mj mk ml gt mm"><div class="bz fp l di"><div class="mu mv l"/></div><p class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="ak">代码3:</strong>Python中的直方图匹配</p></figure><div class="mi mj mk ml gt ab cb"><figure class="my mm od na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/f010ed0dfacefeb7b5a530b7de966b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*cbgEHnGOojOY3leGrGRq1Q.jpeg"/></div></figure><figure class="my mm oe na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/4076f7f29fa370632a9cdee893587c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*viAG1o-BgIiTONVav0likA.jpeg"/></div></figure><figure class="my mm of na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><img src="../Images/a28c600982b716e6d8e29538e61324e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*ksZCuBe_lFzIwnCZA3dLhg.png"/></div><p class="mp mq gj gh gi mr ms bd b be z dk og di oh np translated"><strong class="bd mt">图7: </strong>直方图匹配示例。我们修改了左边图像的直方图以匹配中间图像的直方图。</p></figure></div><p id="edf9" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">图7示出了直方图匹配的例子。如您所见，虽然最左边的图像是明亮的图像，但就对比度而言，中间的图像可以被认为是更好的图像。所以，我们决定使用中心图像的契约来修改最左边的。结果，也就是最右边的图像得到了改善。</p><h2 id="d988" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kv ls lt lu kz lv lw lx ld ly lz ma mb bi translated">结论</h2><p id="ef5f" class="pw-post-body-paragraph km kn iq ko b kp mc jr kr ks md ju ku kv me kx ky kz mf lb lc ld mg lf lg lh ij bi translated">在这篇文章中，我解释了<em class="ob">直方图匹配</em>，这是一个有用的方法，当我们处理图像。我首先解释了如何生成图像<em class="ob">直方图</em>。然后如何<em class="ob">均衡</em>生成的直方图，最后如何根据另一张图片的对比度修改一张图片，称为直方图匹配。带有解释的代码也可以在<a class="ae li" href="https://github.com/aliprf/CV-HistogramMatching" rel="noopener ugc nofollow" target="_blank"> <strong class="ko ir"> Github </strong> </a>上找到。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="ff56" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这里的代码可以在<a class="ae li" href="https://github.com/aliprf/CV-HistogramMatching" rel="noopener ugc nofollow" target="_blank"> <strong class="ko ir"> Github </strong> </a>上找到。</p><p id="c320" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">如果你喜欢这个帖子，请鼓掌。</p></div></div>    
</body>
</html>