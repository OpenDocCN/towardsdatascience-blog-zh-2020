<html>
<head>
<title>Spark vs Pandas, part 1 — Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">星火大战熊猫，第一部分——熊猫</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spark-vs-pandas-part-1-pandas-10d768b979f5?source=collection_archive---------6-----------------------#2020-10-21">https://towardsdatascience.com/spark-vs-pandas-part-1-pandas-10d768b979f5?source=collection_archive---------6-----------------------#2020-10-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8217" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">为什么熊猫是表格数据的瑞士军刀？</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b72d70fac1dc52a91e5c6fd0906b9390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TuxAJD-ZZsO1i7lV"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kz" href="https://unsplash.com/@billow926?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">翻滚926 </a>拍照</p></figure><p id="c607" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最近在Medium上有一篇很好的文章，解释了为什么<a class="ae kz" rel="noopener" target="_blank" href="/stop-using-pandas-and-start-using-spark-with-scala-f7364077c2e0">的数据科学家应该开始使用Spark和Scala而不是Pandas </a>。虽然这篇文章包含了许多有效的观点，但我提出了一个更加不同的观点，这也反映在我个人的工作中，我使用两者，但用于不同类型的任务。</p><p id="baaf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每当我给数据科学家做PySpark的培训时，我总是被问到他们是否应该从现在开始完全停止使用Pandas，或者什么时候更喜欢Pandas和Spark这两个框架中的哪一个。要回答这个问题，您需要了解每种工具的优势和局限性，并且您应该了解这两种框架都是为了解决类似的问题而开发的，但是各有不同的侧重点。</p><p id="2d30" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是比较Spark和熊猫的小编的第一部分。</p><ul class=""><li id="5da7" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">星火大战熊猫，第一部分——熊猫</li><li id="c3ab" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/spark-vs-pandas-part-2-spark-c57f8ea3a781">星火大战熊猫，第二部——星火</a></li></ul><h2 id="0762" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">期待什么</h2><p id="4b0e" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">我将介绍Pandas和Spark这两个框架，并讨论它们的优缺点，为公平的比较奠定基础。最初我想写一篇关于这个主题的文章，但是它一直在增长，直到我决定把它分开。</p><p id="9719" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我不会得出A比B更好的结论，但是我会给你一些关于每个框架的焦点和局限性的见解。最后，我将给出一些建议，说明如何在这两种技术中选择一种来实现给定的任务。</p><p id="fe07" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这第一篇文章会给你一个关于熊猫的概述，它的优点和缺点以及它独特的卖点。</p></div><div class="ab cl ni nj hy nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="in io ip iq ir"><h1 id="5f92" class="np ml iu bd mm nq nr ns mp nt nu nv ms ka nw kb mv kd nx ke my kg ny kh nb nz bi translated">熊猫是什么？</h1><p id="028f" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas是一个Python库，也是在Python上处理结构化表格数据的事实上的标准。Pandas提供了转换和预处理数据的简单方法，特别关注数字数据，但是它也可以用于其他数据，只要它的结构是表格。</p><p id="b25e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">许多读者会理解为什么Pandas现在如此重要，因为可能大多数数据科学项目在某个时间点使用Python作为编程语言。因此，这些项目依赖熊猫来读取、转换和可能写入数据。</p><p id="409f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">熊猫在Python世界中受欢迎的原因是它简单但强大的编程接口，以及它与<a class="ae kz" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> NumPy </a>以及大多数统计和机器学习库良好交互的事实。</p><h2 id="f84d" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">熊猫数据模型</h2><p id="ca87" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">基本上，Pandas将你的数据存储在所谓的<em class="oa">数据帧</em>中，这些数据帧本质上看起来<em class="oa"> </em>像<em class="oa">表</em>，你可能从数据库<em class="oa">中知道。</em>数据帧有一组列和一组行，其中每一行包含所有列的条目(即使它们是<em class="oa"> NaN </em>或<em class="oa"> None </em>值，以表示缺失的信息)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ob"><img src="../Images/0b73a8aa76ec33efd2960f547bba74b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZ2K4JEZ7Pg_5EZapHWjLA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一个简单的熊猫表的例子，以“资产”作为索引和各种数字列</p></figure><p id="8b8d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与数据库中的表类似，每个数据帧也有一个带有唯一键的索引<em class="oa">以有效地访问单个行或整个范围的行。Pandas数据帧的命名列也可以看作是一个<em class="oa">水平索引</em>，它再次允许您有效地访问单个列或列的范围。</em></p><p id="d9e8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">垂直行索引和水平列索引也可以包含多个级别，这可能非常有用，例如，在一段时间内对多种不同资产的股票价格进行建模:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oc"><img src="../Images/3d686081ea27e33e239850bdda5b4c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTxaSltCWVL4F-BVAGYYAA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">嵌套列索引和日期作为行索引的示例</p></figure><p id="348e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pandas提供了关于行和列的非常正交的设计，它们在大多数(但不是所有)函数中是可互换的。如果这是不可能的，你可以很容易地<em class="oa">转置</em>一个数据帧，即把表格旋转90度，把所有的行变成列，反之亦然。注意，这种操作是传统数据库不可能完成的。</p><h1 id="c27f" class="np ml iu bd mm nq od ns mp nt oe nv ms ka of kb mv kd og ke my kg oh kh nb nz bi translated">熊猫的灵活性</h1><p id="1ce1" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas DataFrame API非常灵活，提供了比传统数据库中的<code class="fe oi oj ok ol b">SELECT</code>语句更多的功能。在本系列的下一部分中，让我们快速浏览一下最基本的，以便获得一种感觉，并能够比较Spark的功能。</p><p id="a5cd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于下面的小例子，假设我们使用具有以下内容的数据帧<code class="fe oi oj ok ol b">persons</code>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj om"><img src="../Images/7963e4d760fad4dae046618d430ae9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*YRUHhtUCe6RMfJzMAqY5Aw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一个包含一些人的熊猫数据框</p></figure><p id="c19d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于大多数(但不是全部)操作也可以在传统数据库中执行，我也将提到相应的操作，以便将它们放入关系代数的视角中。</p><h2 id="725e" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">预测</h2><p id="6f53" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">可能最简单的转换之一是投影，它只是用现有列的子集创建一个新的DataFrame。这个操作叫做<em class="oa">投影</em>，因为它类似于高维空间到低维空间的数学投影(例如3d到2d)。具体来说，投影减少了维数，并且是等幂的，即，对结果第二次执行相同的投影将不再改变数据。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj on"><img src="../Images/80aa472a21b677e6555a3cfeb5775bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*gQCwRjdM-6bKXdvjJPXZzA.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">将人员数据框投影到“年龄”和“身高”列</p></figure><p id="f106" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">SQL中的投影是一个非常简单的<code class="fe oi oj ok ol b">SELECT</code>语句，包含所有可用列的子集。</p><h2 id="5bd7" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">过滤</h2><p id="39ec" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">过滤中的下一个简单转换，它只选择可用行的子集。它类似于投影，但作用于行而不是列。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oo"><img src="../Images/ac7948550d7e85c5edc7883d5b7b45b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*Tabm9_OVWbmfOujF1nIblw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">过滤21岁以上的人。</p></figure><p id="6cbf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">SQL中的过滤通常在<code class="fe oi oj ok ol b">WHERE</code>子句中执行。</p><h2 id="d58a" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">连接</h2><p id="f8e2" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">连接是关系数据库中的基本操作——没有它们，术语<em class="oa">关系</em>就没有什么意义了。Pandas连接要求正确的数据帧已经被连接列索引。</p><p id="e1df" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于一个小的演示，我首先加载第二个数据帧，其中包含一些人居住的城市的名称:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj op"><img src="../Images/c4eee78f67fedddb652d7b13c0f6db0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*EJpI3LHjGNWc2Wfr4d1obw.png"/></div></figure><p id="8a41" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们需要为该数据帧创建一个适当的索引，否则Pandas将拒绝执行连接操作:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oq"><img src="../Images/e114fb99d39c9f2b4380b232b83cb755.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*tVKnfE4lAzg3v4KvaWPzSQ.png"/></div></figure><p id="4dd9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我们现在可以执行连接操作:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj or"><img src="../Images/8aab20bd2293004cfcdf50e49b3f7ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*x3LPMicv6ZNYnWOsEoPJNQ.png"/></div></figure><p id="e394" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意，这个例子表明术语<em class="oa">索引</em>确实是合适的，因为它提供了快速查找机制，这是连接操作所需要的。</p><p id="1d64" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在SQL中，连接操作是通过作为<code class="fe oi oj ok ol b">SELECT</code>语句一部分的<code class="fe oi oj ok ol b">JOIN</code>子句来执行的。</p><h2 id="9494" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">串联</h2><p id="1e09" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">在Pandas中，您还可以水平连接(粘合)数据帧(即从第二个数据帧中添加相同行数的列)或垂直连接(即从第二个数据帧中添加相同行数的行)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj os"><img src="../Images/cca909ef0119ed86ef4f97a0e38a3800.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*p21oXJqMs3jMW3ZeniqWeA.png"/></div></figure><p id="7c84" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于水平连接不同数据帧的列(未示出), Pandas将在索引上匹配，类似于通过匹配列来完成水平连接。</p><p id="bf27" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在SQL中，垂直连接可以使用<code class="fe oi oj ok ol b">UNION</code>轻松完成，而水平连接需要更昂贵的<code class="fe oi oj ok ol b">JOIN</code>操作。</p><h2 id="94f6" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">聚合(水平+垂直)</h2><p id="50c2" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">熊猫也很好地支持简单的总聚合。以下示例计算了我们的<code class="fe oi oj ok ol b">persons</code>数据框架中所有列的最小值、最大值和平均值:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj or"><img src="../Images/e0af43e6e39f3b059dd2448972a6847d.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JYMn9PYxO18Mc23l3YdZjw.png"/></div></figure><p id="2a3d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对所有行的每一列执行聚合。SQL还通过一个<code class="fe oi oj ok ol b">SELECT</code>语句中的聚合函数(如<code class="fe oi oj ok ol b">SUM</code>、<code class="fe oi oj ok ol b">MIN</code>、<code class="fe oi oj ok ol b">AVG</code>等)很好地支持总聚合。</p><p id="3a0f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pandas还可以对列执行逐行聚合，这在某些情况下很方便。例如，当查看约翰·霍普金斯大学系统科学与工程中心(CSSE)在GitHub 上提供的一些<a class="ae kz" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank">新冠肺炎数据时，最初看起来如下:</a></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ot"><img src="../Images/b5b101e50e5c9ef742466848c6288c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LhxmdkTyx4QUao0sabg5Rw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">新冠肺炎数据</p></figure><p id="2f34" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每行代表一个国家或州，并包含一列迄今为止的新冠肺炎病例总数。这种数据模式实际上对于存储在传统数据库中非常不友好，传统数据库通常只有有限的一组列，新的条目应该通过新的行来添加。但是这个表示将为每个日期添加一个新列。稍后，我们将看到如何将这些数据转换成一种更加数据库友好的格式。</p><p id="e28c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是现在，假设我们想计算每个不同地区的所有日期列的一些指标，比如新日冕的平均数量。这可以通过Pandas的几个小步骤轻松实现，包括水平聚合(与上面的垂直聚合相反):</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ou"><img src="../Images/0fcc4397c52565034f3c0bdc457f3182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Woir1ooqcR91ie2YOfvqCQ.png"/></div></figure><p id="29c5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个例子显示了Pandas的灵活性，与关系数据库相反，关系数据库中的聚合本质上总是水平的，但是无论如何也不能以原始格式存储数据。</p><h2 id="5619" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">分组聚合</h2><p id="962b" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas还支持<em class="oa">分组聚合</em>，例如<code class="fe oi oj ok ol b">persons</code>数据帧中每个性别的平均年龄和身高:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ov"><img src="../Images/35fe40e5f107de7a092a4a2dc41eb17d.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*BrGjpe67tL6FINlTTypCNw.png"/></div></figure><p id="b3cb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">SQL还通过<code class="fe oi oj ok ol b">GROUP BY</code>子句和<code class="fe oi oj ok ol b">SELECT</code>语句中的聚合函数支持分组聚合。</p><h2 id="da1a" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">重塑</h2><p id="a5b2" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">让我们回到上面的新冠肺炎数据集:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ot"><img src="../Images/b5b101e50e5c9ef742466848c6288c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LhxmdkTyx4QUao0sabg5Rw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">新冠肺炎数据</p></figure><p id="b11e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每天的病例数存储在单独的列中。不幸的是，这种表示可能并不适合每个用例，为每个日期提供单独的行可能更好。例如，如果您想将信息存储在关系数据库中，您应该定义一组固定的列，独立于存储的时间范围。</p><p id="5061" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所需的转换可以通过两行Pandas代码轻松完成:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/1d5a9dce5e9777cc070431ec8957eff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YKaxfAPrCH7Vja-M6bLyag.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">相同数据的整形表示。</p></figure><p id="6c48" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这种表示现在非常适合存储在关系数据库中。其思想是每一行都包含维度的组合(“省/州”、“国家/地区”和“日期”)，这些维度唯一地标识该行。也就是说，这些列提供了一个复合主键。此外，每一行包含一个或多个指标(在这种情况下，它只是“计数”)。在分析数据库的世界里，这将被称为<em class="oa">事实表</em>。</p><h2 id="db22" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">数据源</h2><p id="fd62" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas提供了对CSV、JSON、Excel、固定宽度格式(FWF)、HDF5、Parquet、ORC、SAS、SPSS的内置读写支持，它可以访问SQL数据库甚至Google BigQuery中的数据。</p><p id="3509" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了访问本地文件系统上的数据，Pandas还支持两个远程文件系统，其中最重要的一个可能是S3。</p><p id="e49b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这种对文件格式和存储系统的广泛支持，使Pandas成为一个需要处理非常不同数据源的世界中的一员。</p><h2 id="4fec" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">结论</h2><p id="e3a3" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas支持您在<code class="fe oi oj ok ol b">SELECT </code>语句中可以找到的大多数类似数据库的操作，但是它提供了更大的灵活性，并且更侧重于数字操作。它支持更多的操作，如滚动窗口计算和旋转，这只是两个常用的例子。</p><p id="b1f3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在内部，Pandas使用NumPy数组，可以很容易地访问这些数组，并将其输入各种附加库，如<a class="ae kz" href="https://scikit-learn.org/" rel="noopener ugc nofollow" target="_blank"> scikit-learn、</a>、T5】 statsmodels 甚至<a class="ae kz" href="https://tensorflow.org" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>。同样，这使Pandas不同于传统的数据库，后者不提供这种集成。</p><h1 id="3455" class="np ml iu bd mm nq od ns mp nt oe nv ms ka of kb mv kd og ke my kg oh kh nb nz bi translated">Pandas运行时特征</h1><p id="c915" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">到目前为止，一切听起来都很完美。但是，让我们稍微看一下引擎盖下面，检查熊猫的一些设计决策，以及这些决策的含义。</p><h2 id="a182" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">运行时平台</h2><p id="9491" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas本身是用Python和<a class="ae kz" href="https://en.wikipedia.org/wiki/Cython" rel="noopener ugc nofollow" target="_blank">cy thon</a>(Python的一个超集，支持静态类型，将Python代码转换为C，然后编译C代码以提供类似C的性能)混合编写的，具有解释型和动态类型语言的所有优点和缺点。但是由于大多数转换最终都是由一些低级和优化的C代码执行的，因此性能对于大多数用例来说已经足够了。</p><h2 id="2a8a" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">执行模型</h2><p id="1944" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas实现了一个所谓的<em class="oa"> eager </em>执行模型，这仅仅意味着你对数据帧的任何转换都会被立即执行。这种<em class="oa">最不令用户惊讶</em>的方法非常适合交互式工作(就像数据科学家经常做的那样)，但它也有一些缺点:Pandas无法通过融合多个操作来创建类似于<em class="oa">优化执行计划</em>的东西，因为每个转换都会立即执行。</p><p id="0ba2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="oa">优化执行计划</em>的想法是相当古老的，它帮助许多SQL数据库透明地提高它们的性能——但是当然这些数据库一次看到一个完整的SQL查询，而不是一个接一个地看到每个微小的步骤。稍后我们将看到Spark实现的l <em class="oa"> azy执行</em>的一些更重要的优点。</p><p id="7c59" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">顺便提一下，Tensorflow同时支持惰性和急切执行模型，明确建议只在开发期间使用急切执行模型，因为惰性执行由于全图优化而更快。</p><h2 id="9869" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated"><strong class="ak">处理扩展性</strong></h2><p id="82bd" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">处理本身是单线程的，不能分布到不同的机器上。一些项目如Dask试图通过使用完全不同的后端重新实现Pandas API来克服这个限制。但是熊猫本身仅限于单线程。</p><p id="6a58" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然听起来很糟糕，但Pandas仍然非常有用，而且速度非常快，因为大部分工作都是在高度优化的C/C++后端完成的。有时也可以用<a class="ae kz" href="https://docs.python.org/3/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank">多处理</a>或<a class="ae kz" href="https://joblib.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> joblib </a>库在Pandas上实现一些并行性。</p><h2 id="a526" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated"><strong class="ak">数据可扩展性</strong></h2><p id="52dc" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas要求您的所有数据都要放入本地计算机的主内存中。它既不能将数据溢出到磁盘，也不能在机器集群内分发数据。同样，像<a class="ae kz" href="https://dask.org/" rel="noopener ugc nofollow" target="_blank"> Dask </a>或<a class="ae kz" href="https://vaex.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Vaex </a>这样的项目试图通过实现分布式和/或核外处理来克服这种限制，同时提供Pandas兼容的(或Pandas-like for Vaex) API。</p><h2 id="e74a" class="mk ml iu bd mm mn mo dn mp mq mr dp ms lj mt mu mv ln mw mx my lr mz na nb nc bi translated">结论</h2><p id="fe96" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">熊猫没有规模——就这么简单。如果您的数据集增长，您需要更多的RAM，可能还需要更快的CPU(就单核性能而言更快)。虽然这对某些人来说可能是限制性的，但这使整个库(相对)保持简单。</p></div><div class="ab cl ni nj hy nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="in io ip iq ir"><h1 id="4857" class="np ml iu bd mm nq nr ns mp nt nu nv ms ka nw kb mv kd nx ke my kg ny kh nb nz bi translated">结论</h1><p id="d2b7" class="pw-post-body-paragraph la lb iu lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv in bi translated">Pandas是一个非常通用的Python库，用于操作表格数据。与关系数据库相比，它为操纵和重新塑造表格数据提供了更大的灵活性，因此它不仅是数据科学项目(预)处理的瑞士军刀。</p><p id="bd44" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pandas的主要限制是你的数据需要放入RAM，而且它不能很好地利用多个CPU。但是，如果你的数据足够小，可以避开这些限制(这很可能仍然是数百万条记录)，Pandas是一个非常好的灵活的库，它可以很好地集成到整个Python机器学习生态系统中。</p><p id="59b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下一次，我们将近距离观察竞争对手阿帕奇火花。</p></div></div>    
</body>
</html>