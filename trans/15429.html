<html>
<head>
<title>6 hidden SQL mistakes to avoid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">要避免的6个隐藏的SQL错误</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-hidden-sql-mistakes-to-avoid-2e771bed085b?source=collection_archive---------36-----------------------#2020-10-23">https://towardsdatascience.com/6-hidden-sql-mistakes-to-avoid-2e771bed085b?source=collection_archive---------36-----------------------#2020-10-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/51192a148068294a4278dbff82047d70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2L1qTY5h7dut1UFKz8ntRA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">尤金·希斯蒂科夫在<a class="ae jg" href="https://unsplash.com/s/photos/peek-a-boo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><div class=""><h2 id="f1eb" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">他们在雷达下飞行，给你带来麻烦</h2></div><p id="653f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SQL很棒。它是人类可读和高效的。这很容易掌握。</p><p id="fd93" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不幸的是，也很容易犯令人讨厌的SQL错误。那些不突出的，不会被你的编辑发现的，会让你头疼的。</p><p id="7c64" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将强调一些隐藏的错误，当你浏览数据分析时要注意。</p><h1 id="e53d" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">1.操作中的空值</h1><p id="692a" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">SQL有各种各样的常见和有用的运算符，用于算术(例如，+，-)，比较(例如。&gt;，</p><p id="4b38" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Use them, enjoy them, but don’t forget that they won’t do anything with null values. <strong class="la jk">对空值的操作将返回空值。</strong></p><p id="c5b7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是几个例子:</p><p id="00ee" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> a .添加列</strong></p><p id="6b5c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们有一个2019年销售额的列和一个2020年销售额的列。在2019年的一行中有一个空值。</p><p id="1999" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们把它们加在一起时，我们得到一个空值:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mr"><img src="../Images/0f2153c8d0eb5c49cc78163edd89b328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhphVslFzgM7rtw0YK3pyw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="c150" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是个坏消息。我们可能知道将空值视为0，但是SQL不知道。</p><p id="122f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> b .“不在”运算符</strong></p><p id="b5c7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，假设我们有一个关于产品的调查结果表。我们只想排除非常差或非常好的评论。</p><p id="06f9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们查询评级不在(“非常好”、“非常差”)时，我们得到以下结果:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mw"><img src="../Images/f5bb5ca8c3e409c24a201a8645f5603d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuvPI30zuDFaj4Ivnz_ZsA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="6bc0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可能期望返回空值(毕竟，null不在我们提供的列表中)，但是SQL会将它们排除在结果集中。</p><p id="dc64" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mx">解决方法:</em> </strong>每当我们执行操作时，我们都应该确保知道列中的任何空值。如果我们希望它们被视为不同的值，我们可以使用“coalesce”语句轻松实现:</p><pre class="ms mt mu mv gt my mz na nb aw nc bi"><span id="7682" class="nd lv jj mz b gy ne nf l ng nh">coalesce(rating, ‘’) </span></pre><h1 id="bd75" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">2.聚合中的空值</h1><p id="4f72" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">这是与上一个问题相反的问题。当我们运行聚合函数时，SQL忽略空值。在许多情况下，这是可取的。</p><p id="e922" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是如果空值真的是0呢？</p><p id="fd18" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，让我们计算2020年的平均销售额:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/d6c1e63780854a2eb85f5b03e5ae97f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kbbxxaPRG3Lp6yE4j-OpNg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="95bc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，SQL排除了空值，并计算出410 / 4 = 102.5，而不是410 / 5 = 82。</p><p id="e75a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很容易被忽略——102.5听起来是一个真实的、完全合理的值。</p><p id="5100" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mx">修复:</em> </strong>同#1。让我们合并空值，如果它们真的表示0。</p><h1 id="58b6" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">3.错误的连接</h1><p id="82ad" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">连接是一个关键的SQL功能，它可以帮助我们组合两个表中的数据。</p><p id="9d75" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是当我们使用错误的连接类型时，我们可能会丢失我们需要的数据。</p><p id="da6a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，假设我们有一个地理表和一个销售表，我们希望将所有联系人的州和销售额列表发送给我们的营销团队。</p><p id="cf7a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左联接为我们提供所有联系人及其销售额，但内联接会删除所有没有任何销售额的联系人:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/987312d4ded27e46e39c5a2f916544c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-Ci_5V16GoLIET0Hkygrg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="ce9e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们在这种情况下使用内部连接，我们会丢失可能很重要的数据(也许市场营销想要锁定潜在客户！).</p><p id="51ea" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mx">解决方法:</em> </strong>注意我们使用的连接类型。</p><p id="1250" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要了解更多信息，请查看我关于连接数据的介绍文章:</p><div class="is it gp gr iu nk"><a rel="noopener follow" target="_blank" href="/a-beginners-guide-to-joining-data-935c8e579fb7"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd jk gy z fp np fr fs nq fu fw ji bi translated">连接数据的初学者指南</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">左接合。内部联接。外部联接。啊？</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ja nk"/></div></div></a></div><p id="9d4f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">顺便说一下，如果我们真的执行左连接，我们应该确保将我们的销售列合并为0，否则，我们可能会遇到上面的问题#1或#2！</p><h1 id="5fcc" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">4.右表中的重复键</h1><p id="2694" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">当我们连接数据集并且我们的右表在连接键中有重复项时，我们会得到比开始时更多的记录。</p><p id="c734" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时候这就是我们想要的。但是其他时候，我们可能会在右边的表中出现令人惊讶的重复数据——这可能是由于数据质量问题(真实世界的数据是混乱的，你没听说过吗？).</p><p id="646d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，假设我们想在一个“增强的”城市表中用更多的信息来丰富我们的联系人/地理表。</p><p id="f9b8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们加入on state，我们会得到重复的联系人:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/73150fad53ef652d1bbd69c20a7a144f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k4whOw3n159ZJ1vZLPlxlw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="ddb3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">解决方法:</strong>确保我们知道我们的右连接键列是否不同。一种简单的检查方法是运行计数和非重复计数，并确保它们相同:</p><pre class="ms mt mu mv gt my mz na nb aw nc bi"><span id="189f" class="nd lv jj mz b gy ne nf l ng nh">#these will be equal if there are no duplicates<br/>select count(state), count(distinct state) from mytable;</span></pre><h1 id="f021" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">5.运算符优先级问题(注意你的and和or！)</h1><p id="5ae1" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">当创建复杂的条件语句时，很容易犯操作符优先的错误。</p><p id="c8fd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最常见的例子:当我们编写SQL查询时，“And”在“Or”之前被处理。</p><p id="1901" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们有一个包含客户销售额和细分市场的表，我们希望返回细分市场A或B中销售额也必须大于100的客户。</p><p id="c4f4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们在编写查询时不注意优先级，我们会得到:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nz"><img src="../Images/d82f47def39927bc327c5d07267c183b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vubs3votvoh-y5VSfoON-A.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="b80e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，即使client 1记录的销售额低于100，它也会被返回。这是因为查询首先解析“and”语句。</p><p id="f2d0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们在适当的位置添加括号时，我们得到了我们想要的:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/c121d5b87b849987c42a2fd46236c49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HncUOy9VLt43kxc-SQXoCA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="ccd6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mx">解决方法:</em> </strong>当我们使用多个操作符时，总是使用括号。它防止错误，使我们的代码更具可读性。</p><h1 id="dc6c" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">6.删除逗号</h1><p id="d20e" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">这可能会因我们使用的数据库管理系统而异。</p><p id="24b4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于Postgres，我们在命名列时不需要包含“as”关键字。</p><p id="4e75" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这意味着，如果我们从查询中删除一个逗号，SQL将使用列后面的列名重命名逗号前面的列:</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/53bec66647a0c9c6874fcc25c02e6ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCwlbQK7DpK2NHl9b8vE_w.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="19fd" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个双重打击——我们不仅丢失了我们要寻找的一个列，而且我们的一个列也留下了不正确的名称。</p><p id="4d13" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mx">修复:</em> </strong>在运行之前仔细检查我们的select语句，确保我们没有遗漏任何逗号。</p><h1 id="a5a2" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">结束语</h1><p id="a99e" class="pw-post-body-paragraph ky kz jj la b lb mm kk ld le mn kn lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在这篇文章中，我们介绍了运行SQL查询时需要注意的几个场景。当有疑问时，放慢速度，进行测试，并确保你没有成为这些常见错误的受害者总是有帮助的。</p><p id="8bb1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="mx"> P.S. →如果你想了解更多关于SQL、Python、数据科学的知识，订阅我的</em> </strong> <a class="ae jg" href="https://subscribe.to/everythingdata" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk"> <em class="mx">免费邮件列表</em> </strong> </a> <strong class="la jk"> <em class="mx">。</em> </strong></p></div></div>    
</body>
</html>