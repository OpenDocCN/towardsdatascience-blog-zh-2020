<html>
<head>
<title>Simple Versioned Datasets With Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有Github操作的简单版本化数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simple-versioned-datasets-with-github-actions-bd7adb37f04b?source=collection_archive---------48-----------------------#2020-10-12">https://towardsdatascience.com/simple-versioned-datasets-with-github-actions-bd7adb37f04b?source=collection_archive---------48-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2c07" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="dc85" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">不到10行Python代码，保存了著名CEO的历史</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/1e61ae1c710a26b0ad16fb818431a034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOyzJ7yr3TAVc-vbB-4L6w.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">凯文·Ku拍摄于<a class="ae lh" href="https://www.pexels.com/photo/coding-computer-data-depth-of-field-577585/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a></p></figure><h1 id="be00" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">背景</h1><p id="cd40" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">几天前偶然发现了一篇关于作者创造的“git抓取”概念的文章。这个过程最引人注目的方面是，作为开发人员，我不必维护服务器或大型代码库来获得最新的版本化数据集。我实际上可以利用git的版本控制功能和Github的动作。这个过程对我来说太有趣了，我不得不亲自尝试一下。这是我记录的旅程，所以你可以对你自己的数据集做同样的事情。</p><h1 id="5e62" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">查找我的数据集</h1><p id="6924" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">为了充分利用我的数据集的git版本控制，我想寻找一个数据集，在这个数据集上，随着时间的推移，查看它的变化会有附加值。我也不希望这些更改过于频繁，这样提交就会变得稀疏，这样单独的更新就更容易被识别出来。</p><p id="92e6" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在未能找到一个好的啤酒厂数据集后，我决定监控这张著名公司首席执行官(CEO)的表格。这个列表以表格的形式出现在维基百科页面上。</p><div class="nb nc gp gr nd ne"><a href="https://en.wikipedia.org/wiki/List_of_chief_executive_officers" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">首席执行官名单</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">以下是著名公司首席执行官的名单。的…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">en.wikipedia.org</p></div></div></div></a></div><h1 id="161b" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">抓取维基百科</h1><p id="eca1" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">现在我的数据集已经确定了，我只需要编写一些代码来检索我们想要存储的信息。我还想确保以一种将来易于接收的方式公开它，以一种自动化的方式，因此考虑到这一点，我决定将这些数据存储为CSV文件。</p><h2 id="c13b" class="nn lj it bd lk no np dn lo nq nr dp ls mj ns nt lu mn nu nv lw mr nw nx ly iz bi translated">要求</h2><p id="f92a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">对于我提出的解决方案，需要以下Python 3包。在最终的存储库中，这些显示在<code class="fe ny nz oa ob b">requirements.txt</code>文件中。</p><ul class=""><li id="8fd9" class="oc od it mc b md mw mg mx mj oe mn of mr og mv oh oi oj ok bi translated">熊猫——这可能是另一个类似于<strong class="mc jd"> tablib </strong>的库，但是为了以防万一，我选择了<strong class="mc jd">熊猫</strong>。</li><li id="680a" class="oc od it mc b md ol mg om mj on mn oo mr op mv oh oi oj ok bi translated"><strong class="mc jd"> lxml </strong> —这个库在从html表格中获取表格的函数中得到利用。</li></ul><h2 id="4323" class="nn lj it bd lk no np dn lo nq nr dp ls mj ns nt lu mn nu nv lw mr nw nx ly iz bi translated">摄入代码</h2><p id="05af" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">我需要做的第一件事是从维基百科获取表格。幸运的是熊猫正好有这个功能。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="f3fe" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在上面的代码中，我使用<code class="fe ny nz oa ob b">read_html</code>检索该表，将标题标识为第一行，并选择第一个表添加到DataFrame中。此时，我已经将文件加载到Pandas Dataframe中，但是仍然需要将该文件导出为CSV文件格式。在此之前，我注意到摄取的数据有问题。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="781a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">如您所见，我仍然需要删除显示在结果中的引用注释。为此，我添加了一个正则表达式来去掉这些注释。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="c5e9" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">首先将数据帧转换成CSV文件更容易，所以在应用正则表达式去除注释之前，我先转换了数据格式。在这一点上，我需要做的只是写入我希望数据驻留的文件，数据集已经成功地到达了预期的目的地。</p><p id="38a7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">如果您想将此代码用作参考实现，这里是运行来更新数据集的最后一个main函数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由Github操作运行的main.py</p></figure><h1 id="f74a" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">Github操作工作流程</h1><p id="463c" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">此时，我能够从Wikipedia获取该表，并将清理后的结果写入CSV文件。下一步是现在安排这个过程，当且仅当数据改变时，将结果提交给Github。</p><p id="b5de" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在我构建动作工作流的步骤之前，我需要安排它每小时运行刚刚开发的代码。为了做到这一点，我需要以预定义的yaml格式为每小时的频率定义cron调度。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="6b62" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在构建我的工作流之前，我想定义Github动作需要运行的图像。为了简单起见，我只是让它使用最新版本的ubuntu运行，但在未来，一旦我有时间更深入地进行操作，我会使用一些更轻松的图像，如python slim版本或alpine。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="ff89" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这个Github动作在它的工作流程中有许多步骤，在此之前，数据集可以被监控是否有变化。我们cron工作流的第一步是签出我们主分支的工作副本。我最近在实验中注意到，这通常是我利用的大多数行动的第一步。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="0483" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在上面的第4行和第5行中，我们实际上不需要指定提取深度，因为默认值是1，但是这定义了要提取的提交数量。起初，我打算尝试用它来比较数据集的版本，但正如你稍后会注意到的，这是一个不需要探索的兔子洞。我能够使所有这些工作合理化的方法是在我的文章中保留对该功能的引用，以供将来的读者查看。</p><p id="6287" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">既然我已经有了在动作工作流中运行的代码的工作副本，下一步将是让Python 3.8设置开始运行代码。和前面的步骤一样，下面你可以看到Github也为此提供了一个动作。Python版本很容易设置，但是对于我的例子来说，目标是3.8。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="f7b2" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在我们已经安装了Python，我们希望安装所需的库。我在这个repo中包含了一个requirements.txt文件，但是这个步骤也可能是一个<code class="fe ny nz oa ob b">pip insall pandas lxml</code>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="61d1" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在工作流中的这一点上，运行我们的代码以更新数据集所需的一切都已经提供给了环境，因此在这一步中，我们现在将这样做。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="9128" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">此时，我们拥有数据集的最新版本，该版本可能已更改，也可能未更改。因此，我们在这里要做的只是提交，如果数据已经更新，就推送。注意这里我们提前退出动作，如果是这样就不要推了。这里可以使用一些不同的模式，但是如果你好奇的话，Simon Wilson在这里提到了一些<a class="ae lh" href="https://til.simonwillison.net/til/til/github-actions_commit-if-file-changed.md" rel="noopener ugc nofollow" target="_blank"/>。否则，一个干净的方式来实现我们想要的可以在下面找到。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="dcf5" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这是其全部荣耀中的操作流程，您可以随意使用，但此时只需提交不到10行的Python代码和带有操作工作流的yaml，一切都应设置为保存历史的版本化数据集。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="1c2b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我通常会发现，当我有一个参考实现时，工作起来会更容易，所以这里是包含完整代码库的repo，其中包含我刚才单步执行的操作工作流。</p><div class="nb nc gp gr nd ne"><a href="https://github.com/dylanroy/ceo-dataset" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">Dylan Roy/CEO-数据集</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox lb ne"/></div></div></a></div><h1 id="3389" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">关键要点</h1><p id="2f06" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">正如你所看到的，它实际上很容易接收，并保持数据集最新，而不需要你自己的基础设施和一点点代码。Github动作为简单的自动化提供了更多的选择。在这篇文章的例子中，我的回购是公开的，所以为了支持开源项目，Github完全免费。</p><p id="e302" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">正如你从我的旅程中看到的，用一点Python知识，利用Github动作开始保持数据集更新并不困难。</p><p id="5fca" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我有另一个教程，我将在本周出版，所以请随时关注我，这样你就不会错过它，如果你对我的其他教程感兴趣，我将它们列在下面。</p><h1 id="7fe1" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">阅读迪伦的其他教程</h1><div class="nb nc gp gr nd ne"><a rel="noopener follow" target="_blank" href="/create-beautiful-architecture-diagrams-with-python-7792a1485f97"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">用Python创建漂亮的架构图</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">停止花费时间手动调整未对准的箭头</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="oy l ou ov ow os ox lb ne"/></div></div></a></div><h1 id="d3e7" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">资源</h1><ul class=""><li id="fb3a" class="oc od it mc b md me mg mh mj oz mn pa mr pb mv oh oi oj ok bi translated"><a class="ae lh" href="https://simonwillison.net/2020/Oct/9/git-scraping/" rel="noopener ugc nofollow" target="_blank">https://simonwillison.net/2020/Oct/9/git-scraping/</a></li><li id="7ef1" class="oc od it mc b md ol mg om mj on mn oo mr op mv oh oi oj ok bi translated"><a class="ae lh" href="https://til.simonwillison.net/til/til/github-actions_commit-if-file-changed.md" rel="noopener ugc nofollow" target="_blank">https://til . simonwillison . net/til/til/github-actions _ commit-if-file-changed . MD</a></li><li id="ac5b" class="oc od it mc b md ol mg om mj on mn oo mr op mv oh oi oj ok bi translated"><a class="ae lh" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_html.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/reference/API/pandas . read _ html . html</a></li></ul></div></div>    
</body>
</html>